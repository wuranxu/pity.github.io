{"config":{"indexing":"full","lang":["ja"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"\u4f5c\u8005\u4ecb\u7ecd \u5927\u5bb6\u597d\uff0c\u6211\u662f\u7c73\u6d1b\uff0c\u4e00\u4e2a\u4e50\u4e8e\u5206\u4eab\uff0c\u559c\u6b22\u94bb\u7814\u6280\u672f\u7684\u6d4b\u8bd5\u5f00\u53d1\u5de5\u7a0b\u5e08\uff0c\u76ee\u524d\u5c31\u804c\u4e8e\u4e0a\u6d77\u67d0\u4e09\u7ebf\u4e92\u8054\u7f51\u516c\u53f8\u3002\u559c\u6b22\u5b9e\u51b58\uff0c\u4ed9\u5251\uff0clol\u7b49\u7b49\uff0c\u6807\u51c6\u768490\u540e\u3002 \u4e2a\u4eba\u6280\u672f\u516c\u4f17\u53f7: \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u6b22\u8fce\u5927\u5bb6\u5173\u6ce8\u6211\uff0c\u638c\u63e1\u6700\u65b0\u6d4b\u8bd5\u5f00\u53d1\u77e5\u8bc6\u3002 \u5173\u4e8ePity\u5e73\u53f0 pity\u662f\u4e00\u6b3e\u4e13\u6ce8\u4e8eapi\u81ea\u52a8\u5316\u7684\u5de5\u5177\uff0c\u91c7\u7528 Python + FastApi + React \u5f00\u53d1\uff0c\u76ee\u524d\u8fd8\u4e0d\u80fd\u4f5c\u4e3a\u751f\u4ea7\u7ea7\u522b\u7684\u5de5\u5177\uff0c\u4f5c\u8005\u6b63\u5728\u52aa\u529b\u4e4b\u4e2d\u3002 \u5e73\u53f0\u521d\u5fc3 \u867d\u8bf4\u5404\u5927\u516c\u53f8\u90fd\u6709\u81ea\u5df1\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0\uff0c\u5e76\u4e14\u505a\u7684\u80af\u5b9a\u6bd4\u6211\u7684\u5f3a\u3002\u4f46\u662f\u8fd8\u662f\u6709 \u5f88\u591a\u516c\u53f8 \uff0c\u5e76\u6ca1\u6709\u8fd9\u6837\u7684\u6761\u4ef6\u53bb\u6295\u5165\u4eba\u529b\u4e13\u804c\u5f00\u53d1\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0\u3002 \u535a\u4e3b\u6211\u572818\u5e74\u7684\u65f6\u5019\u63a5\u89e6\u5230\u4e86Yapi\u8fd9\u6b3e\u63a5\u53e3\u6587\u6863\u7ba1\u7406\u5de5\u5177\uff0c\u90a3\u662f\u53bb\u54ea\u513f\u56e2\u961f\u5f00\u53d1\u7684\uff0c\u4f46\u73b0\u5728\u5df2\u7ecf\u8fde\u5b98\u7f51\u90fd\u627e\u4e0d\u5230\u4e86\uff0c\u4ec5\u4ec5\u53ea\u7559\u4e0b\u4e00\u4e2agithub.io\u7684\u5730\u5740\uff0c\u8ba9\u4eba\u53f9\u606f\u3002 \u626f\u8fdc\u4e86\uff0c\u6211\u770b\u5230\u4ed6\u4eec\u5927\u524d\u7aef\u56e2\u961f\u5f00\u6e90\u4e86\u5982\u6b64\u4e00\u6b3e\u7cbe\u7f8e\u7684\u5de5\u5177\uff0c\u5185\u5fc3\u4e5f\u662f\u6fc0\u52a8\u4e07\u5206\u3002 \u4eba\u6d3b\u4e00\u8f88\u5b50\uff0c\u5e76\u4e0d\u957f\u4e45\uff0c\u603b\u5f97\u505a\u4e9b\u6709\u610f\u4e49\u7684\u4e8b\u60c5\u3002\u867d\u7136\u5f00\u6e90\u8fd9\u4ef6\u4e8b\u60c5\u57fa\u672c\u4e0a\u6ca1\u6709\u4ec0\u4e48\u6536\u76ca\u53ef\u8a00\uff0c\u4f46\u603b\u5f97\u6709\u4eba\u505a\uff0c\u4e16\u754c\u624d\u4f1a \u66f4\u7f8e\u597d \u662f\u4e0d\uff1f \u6240\u4ee5\u6211\u6253\u7b97\u5236\u4f5c\u8fd9\u6837\u4e00\u6b3e\u5de5\u5177\uff0c\u9762\u5411\u7684\u5c31\u662f\u4e2d\u5c0f\u578b\u516c\u53f8\uff0c\u4ed6\u4eec\u6ca1\u6709\u90a3\u4e48\u591a\u65f6\u95f4/\u4eba\u529b\u6210\u672c\uff0c\u751a\u81f3\u662f\u6d4b\u8bd5\u8d44\u6e90\u8f83\u4e3a\u532e\u4e4f\uff0c\u90a3\u4e48\u5982\u679c\u4f60\u6765\u5230\u4e86\u8fd9\u513f\uff0c\u6211\u60f3\u8fd9\u6b3e\u5de5\u5177\u53ef\u4ee5\u7ed9\u4f60\u4eec\u5e26\u6765\u5e2e\u52a9\uff01\u5982\u679c\u662f\u6709\u4e00\u5b9a\u7684\u7ecf\u9a8c\u7684Python\u6d4b\u8bd5\u5f00\u53d1\uff0c\u8fd9\u6b3e\u5de5\u5177\u4e5f\u53ef\u4ee5\u7ed9\u4f60\u5e26\u6765\u4e00\u5b9a\u7684\u501f\u9274\u4f5c\u7528\u3002 \u843d\u5730\u6548\u679c \u53ef\u80fd\u6709\u4eba\u4f1a\u6000\u7591\u9879\u76ee\u662f\u5426\u80fd\u771f\u6b63\u8fd0\u7528\u5230\u751f\u4ea7\u7cfb\u7edf\u91cc\uff0c\u8fd9\u6b3e\u5de5\u5177\u5176\u5b9e\u662f\u6211\u5728\u67d0\u5927\u578b\u5171\u4eab\u5355\u8f66\u516c\u53f8\u5b9e\u8df52\u5e74\u591a\u7684\u4e00\u6b3e\u5de5\u5177\u3002\u4e4b\u524d\u662fgolang\u5f00\u53d1\uff0c\u5982\u4eca\u6211\u79bb\u5f00\u90a3\u5bb6\u516c\u53f8\uff0c\u6253\u7b97\u4fdd\u7559\u539f\u672c\u529f\u80fd\u7684\u57fa\u7840\u4e4b\u4e0a\u8fdb\u4e00\u6b65\u4f18\u5316\uff0c\u5e76\u65b0\u589e\u66f4\u591a\u4e30\u5bcc\u7684\u7279\u6027\u3002\u6240\u4ee5\u5927\u5bb6\u53ef\u4ee5\u653e\u5fc3\uff0c\u5b83\u7edd\u5bf9\u662f\u4e00\u6b3e\u80fd\u65b9\u4fbf\u89e3\u51b3\u4f60api\u81ea\u52a8\u5316\u6d4b\u8bd5\u7684\u5229\u5668\u3002 \u5df2\u6709\u529f\u80fd \ud83d\udd25 \u5b8c\u5584\u7684\u7528\u6237\u767b\u5f55/\u6ce8\u518c\u673a\u5236\uff0c\u63d0\u4f9b\u7b2c\u4e09\u65b9(github)\u767b\u5f55 \ud83c\udc04 \u5b8c\u5584\u7684\u9879\u76ee\u7ba1\u7406\u673a\u5236 \ud83d\udeb4 \u7ed3\u5408FastApi\uff0c\u5229\u7528asyncio\u8ba9Python\u4ee3\u7801\u4e5f\u53ef\u4ee5\u8d77\u98de \ud83d\udc8e \u5b8c\u6574\u7684\u63a5\u53e3\u6d4b\u8bd5\u6d41\u7a0b \ud83d\udcdd \u5f3a\u5927\u7684\u6570\u636e\u6784\u9020\u5668, \u89e3\u51b3\u63a5\u53e3\u6570\u636e\u4f9d\u8d56\u95ee\u9898 \ud83c\udfa8 \u5728\u7ebf\u8c03\u8bd5http\u8bf7\u6c42\uff0c\u582a\u6bd4\u7f51\u9875\u7248\u672cpostman \ud83c\udf77 \u5b8c\u5584\u7684\u5168\u5c40\u53d8\u91cf\u673a\u5236\uff0c\u62d2\u7eddcase\u4e2d\u7684\u6b7b\u6570\u636e \ud83d\ude80 \u98de\u4e00\u822c\u7684\u901f\u5ea6 \ud83d\udc0d \u5728\u7ebfredis\u8bf7\u6c42 \ud83d\udc0e \u6d4b\u8bd5\u8ba1\u5212/\u96c6\u5408 \ud83d\ude48 \u5728\u7ebf\u6570\u636e\u5e93ide\uff0c\u6570\u636e\u5e93\u7ba1\u7406\u529f\u80fd \ud83d\udcf0 \u6f02\u4eae\u7684\u90ae\u4ef6\u901a\u77e5 \ud83d\ude39 \u5b9a\u65f6\u6784\u5efa\u6d4b\u8bd5\u7528\u4f8b \ud83d\udc27 \u7cbe\u7f8e\u7684\u6d4b\u8bd5\u62a5\u544a\u5c55\u793a\u9875\u9762 \u5f85\u5f00\u53d1\u7684\u529f\u80fd \ud83d\udc80 app\u7ba1\u7406\u529f\u80fd\uff0c\u652f\u6301app\u7684\u5bfc\u5165\u548c\u5bfc\u51fa \ud83d\ude3c ~~\u4ee3\u7801\u8986\u76d6\u7387\u589e\u91cf/\u5168\u91cf\u7edf\u8ba1\u529f\u80fd~~ \ud83d\udc18 \u5fae\u670d\u52a1\u5316 \ud83d\udc04 \u6570\u636e\u5de5\u5382\uff0c\u5f3a\u5927\u7684\u9020\u6570\u529f\u80fd \ud83d\udc38 \u7528\u4f8b\u652f\u6301har\uff0cjmx\u7b49\u683c\u5f0f\u5bfc\u5165 \ud83d\udc4d CI/CD\uff0c\u7c7bpipeline\u529f\u80fd \ud83c\udf3c \u63a8\u9001\u529f\u80fd\uff0c\u652f\u6301\u9489\u9489/\u4f01\u4fe1\u63a8\u9001 \ud83c\udf1b \u652f\u6301dubbo/grpc \ud83d\udc1b \u6253\u901ayapi \ud83c\udf3d \u7b49\u7b49\u7b49\u7b49","title":"\u9879\u76ee\u4ecb\u7ecd"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%28%E5%BA%8F%29/","text":"\u6d4b\u8bd5\u5e73\u53f0(\u5e8f) \u8d77\u56e0 \u5176\u5b9e\u4e5f\u6ca1\u6709\u4ec0\u4e48\u80cc\u666f\u53ef\u8a00\uff0c\u7b14\u8005\u5176\u5b9e\u5df2\u7ecf\u5f00\u4e86\u5f88\u591a\u4e2a\u9879\u76ee\uff0c\u4f8b\u5982 Lamb \u548c Eagle \uff0c\u90fd\u662f\u6ca1\u5934\u6ca1\u5c3e\u7684\u9879\u76ee\u3002 \u6700\u8fd1\u4e5f\u662f\u56e0\u4e3a\u9057\u61be\u9519\u5931\u4e86\u67d0\u9e45\u4e91\u7684offer\uff0c\u8ba9\u6211\u611f\u5230\u5f88 \u6cae\u4e27 \u5427\u3002\u60f3\u7740\u7684\u662f\u628a\u81ea\u5df1\u6700\u8fd1\u51e0\u5e74\u7684\u4e00\u4e9b\u5de5\u4f5c\u4e0a\u7684\u5185\u5bb9\u5c55\u793a\u51fa\u6765\uff0c\u5c31\u6253\u7b97\u5148\u5f00\u4e2a\u597d\u5934\u5427\u3002 @\u6211\u53bb\u70ed\u996d \u996d\u4f6c \u575a\u6301\u66f4\u65b0\u7684\u6001\u5ea6\u6fc0\u52b1\u4e86\u6211\uff0c\u867d\u7136\u8fd9\u4e2a\u9879\u76ee\u53ef\u80fd\u53c8\u66f4\u4e0d\u4e0b\u53bb\uff0c\u5df2\u7ecf\u5931\u8d25\u4e862\u6b21\u4e86\uff0c\u6211\u8fd9\u4e2a\u4eba\u8fd8\u662f\u6bd4\u8f83\u61d2\uff0c\u65e5\u66f4\u5bf9\u6211\u6765\u8bf4\u5f88\u96be\uff0c\u53ea\u80fd\u8bf4\u5e0c\u671b \u6709\u751f\u4e4b\u5e74 \u80fd\u591f\u6162\u6162\u5199\u4e0b\u53bb\u5427\u3002 \u5982\u679c\u4ee5\u540e\u5199\u5b8c\u4e86\u4e14\u5e7f\u4e3a\u4eba\u77e5\u4e86\uff0c\u5e0c\u671b\u8fd8\u80fd\u6709\u673a\u4f1a\u53bb\ud83d\udc27\uff01\u54c8\u54c8\uff01 \u8bf4\u660e \u521a\u624d\u5728\u516c\u4ea4\u8f66\u4e0a\uff0c\u5927\u6982\u6784\u601d\u4e86\u4e00\u4e9b\u9879\u76ee\u7684\u60f3\u6cd5\uff0c\u6253\u7b97\u8fd9\u6b21\u91c7\u7528\u591a\u79cd\u8bed\u8a00\u6765\u505a\uff0c\u5927\u6982\u68b3\u7406\u4e00\u4e0b\u662f\u8fd9\u6837\u7684: Python \u65ad\u8a00\u670d\u52a1 \u90ae\u4ef6\u670d\u52a1 Golang Job\u670d\u52a1 Java \u9020\u6570\u670d\u52a1 \u8fd8\u6709\u5f88\u591a\u7ec6\u8282\u6ca1\u6709\u53bb\u7ec6\u5316\uff0c \u4e07\u4e8b\u5f00\u5934\u96be \uff0c\u6253\u7b97\u501f\u7740\u8fd9\u80a1\u52b2\u513f\uff0c\u597d\u597d\u7406\u4e00\u7406\uff0c\u51b2\uff01 \u672c\u6765\u6253\u7b97\u4e0d\u547d\u540d\u7684\uff0c\u4f46\u662f\u53c8\u597d\u50cf\u9700\u8981\u5728github\u5bf9\u4ee3\u7801\u6709\u6240\u5c55\u73b0\u3002\u90a3\u4e48\u5c31\u4ee5 \u9057\u61be \u4e3a\u4e3b\u9898\uff0c\u5c31\u53eb\u505a Pity \u5427\uff01 \u5982\u679c\u5c06\u6765\u4f60\u9700\u8981\u505a\u4e8c\u6b21\u5f00\u53d1\u7684\u8bdd\uff0c\u9700\u8981\u638c\u63e1\u4ee5\u4e0b\u6280\u672f\u6808\uff1a Golang: go\u76f8\u5173\u57fa\u7840\u77e5\u8bc6\u548cgorm, gin web\u6846\u67b6\u7b49 Python: Python\u4f1a\u63d0\u4f9b\u4e00\u7cfb\u5217\u7684\u9020\u6570\u548c\u4fbf\u6377\u7684\u529f\u80fd Java: \u7b14\u8005\u7684Java\u4e5f\u5f88\u5dee, \u4e3a\u4e86\u5e73\u53f0\u80fd\u591f\u63a5\u5165\u7684\u7528\u6237\u66f4\u591a\uff0c\u8ba9Java\u540c\u5b66\u4e5f\u80fd\u591f\u4f7f\u7528 grpc\u76f8\u5173\u77e5\u8bc6 react\u76f8\u5173\u6280\u672f\u6808 \u542bantd umi JavaScript es6\u7b49 \u5982\u679c\u4f60\u53ea\u662f\u4f7f\u7528, \u4e0d\u8fdb\u884c\u4e8c\u6b21\u5f00\u53d1, \u90a3\u4e48\u4f60\u638c\u63e12\u6216\u80053\u5373\u53ef\u3002 \u5168\u90e8\u4ee3\u7801\u5730\u5740: https://github.com/wuranxu/pity \u89c9\u5f97\u6709\u7528\u7684\u8bdd\u53ef\u4ee5\u5e2e\u5fd9\u70b9\u4e2aStar\u54e6QAQ","title":"\u6d4b\u8bd5\u5e73\u53f0(\u5e8f)"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%281%29%20%E6%90%AD%E5%BB%BAFlask%20Web%E6%9C%8D%E5%8A%A1/","text":"\u642d\u5efaFlask\u670d\u52a1 \u9879\u76ee\u5730\u5740 \u70b9\u6211\u8fdb\u5165\u9879\u76ee\u5730\u5740 \u4ee3\u7801\u90fd\u4f1a\u5728\u8fd9\u91cc\u6709\u6240\u5c55\u793a\uff0c\u559c\u6b22\u7684\u8bdd\u53ef\u4ee5\u5e2e\u70b9\u4e2astar\uff0c\u8c22\u8c22\u5927\u5bb6\u4e86\uff01\u5982\u679c\u4f60\u559c\u6b22\u8be5\u6559\u7a0b\uff0c\u4e5f\u53ef\u4ee5\u5206\u4eab\u7ed9\u5176\u4ed6\u4eba\u3002 \u5173\u4e8e\u9009\u578b \u60f3\u4e86\u5f88\u4e45\uff0c\u672c\u6765\u6253\u7b97\u7528 Gin \u505a\u4e3a\u540e\u7aef\u670d\u52a1\uff0c\u6216\u8005\u4f5c\u4e3a\u7f51\u5173\u5c42\uff0c\u540e\u9762\u60f3\u4e86\u4e00\u4e0b\u597d\u50cf\u6ca1\u8fd9\u4e2a\u5fc5\u8981\u3002\u8fd9\u4e2a\u5e73\u53f0\u7684\u7528\u6237\u91cf\u4f1a\u6bd4\u8f83\u6709\u9650\uff0c\u800c\u4e14\u4e5f\u4f1a\u505a\u4e00\u5b9a\u7684 \u670d\u52a1\u62c6\u5206 \u3002\u4e8e\u662f\u8fd8\u662f\u91c7\u7528\u4e86\u66f4\u5927\u4f17\u4e00\u70b9\u7684\u53e3\u5473: Flask \uff0c\u6709\u7684\u540c\u5b66\u53ef\u80fd\u4f1a\u8bf4\uff0c\u90a3\u600e\u4e48\u4e0d\u7528 Django \uff1f \u54c8\u54c8\uff0c\u95ee\u5230\u70b9\u4e86\uff0c Django \u7b14\u8005\u662f\u771f\u4e0d\u4f1a\uff0c\u57fa\u672c\u4e0a\u6ca1\u6709\u63a5\u89e6\u8fc7\uff0c\u4ece\u63a5\u89e6 Python Web\u5f00\u53d1 \u7684\u65f6\u5019\uff0c\u6211\u5c31\u7528\u7684\u662f Flask \u3002\u597d\u5728 Flask \u6bd4\u8f83\u7cbe\u7b80\uff0cdjango\u7528\u6237\u4e5f\u80fd\u6bd4\u8f83\u5feb\u7684\u4e0a\u624b\u3002 \u73af\u5883\u51c6\u5907 \u7b14\u8005\u5176\u5b9e\u6bd4\u8f83\u597d\u5947\uff0c\u4e0d\u77e5\u9053\u5927\u5bb6\u662f\u8981\u770b\u4e00\u4e2a\u5f88\u5b8c\u6574\u7684\u8fc7\u7a0b\uff0c\u8fd8\u662f\u4e00\u4e2a\u5927\u6982\u7684\uff0c\u6240\u4ee5\u53ef\u80fd\u6bd4\u8f83\u968f\u6027\u54c8\uff0c\u590d\u6742\u7684\u5730\u65b9\u5c3d\u91cf\u5b8c\u6574\uff0c\u6bd5\u7adf\u53c8\u5199\u6587\u7ae0\u53c8\u5199\u4ee3\u7801\u7684\u8bdd\uff0c\u8fd8\u662f\u6bd4\u8f83\u8d39\u4e8b\u7684\u3002\u524d\u671f\u53ef\u80fd\u8bb2\u7684\u6bd4\u8f83\u4ed4\u7ec6\uff0c\u540e\u671f\u53ef\u80fd\u4ee5\u4ee3\u7801\u4e3a\u4e3b\u3002\u6240\u4ee5\u6709\u7684\u5730\u65b9\u5982\u679c\u6709\u7591\u95ee\u7684\u8bdd\uff0c\u53ef\u4ee5\u5728\u6587\u7ae0\u4e0b\u9762\u8bc4\u8bba\u6216\u8005\u8054\u7cfb\u672c\u4eba\u3002 \u9884\u5907\u77e5\u8bc6 \u719f\u6089pip\u7684\u4f7f\u7528\u65b9\u6cd5 \u719f\u6089Python\u8bed\u6cd5 \u719f\u6089Pycharm\u7528\u6cd5 \u5de5\u5177/\u8f6f\u4ef6\u51c6\u5907 IDE: Pycharm Python3.4 \u4ee5\u4e0a \u6700\u597d\u662f3.4\u4ee5\u4e0a\uff0c\u7b14\u8005\u8fd9\u91cc\u6bd4\u8f83\u968f\u610f\uff0c\u7528\u7684\u662f3.7\u7248\u672c\uff0c\u6ca1\u6709\u592a\u5927\u7684\u533a\u522b\u3002 \u6700\u7b80\u5355\u7684\u4f8b\u5b50 \u7b14\u8005\u76ee\u524d\u7684\u76ee\u5f55\u5728: J:\\projects\\github.com\\wuranxu \u4ee5\u540e\u7684\u4ee3\u7801\u90fd\u4f1a\u4ee5\u8fd9\u4e2a\u76ee\u5f55\u4e3a\u51c6\uff0c\u4ec5\u4f9b\u53c2\u8003\u3002 \u521b\u5efa\u9879\u76ee\u5e76\u901a\u8fc7Pycharm\u6253\u5f00 \u5b89\u88c5Flask\u5305 \u5728\u5f53\u524d\u76ee\u5f55(pity)\u4e0b\u6253\u5f00\u7ec8\u7aef\u5e76\u8f93\u5165: pip3 install flask \u5982\u679c\u5b89\u88c5\u8fc7\u7a0b\u5f88\u7f13\u6162\uff0c\u53ef\u4ee5\u52a0\u4e0a\u8c46\u74e3\u6e90: pip3 install flask -i https://pypi.douban.com/simple \u7531\u4e8e\u7b14\u8005\u5df2\u7ecf\u5b89\u88c5\u597d\u4e86\uff0c\u6240\u4ee5\u6ca1\u6709\u8be6\u7ec6\u7684\u5b89\u88c5\u8fc7\u7a0b\u3002 \u521d\u59cb\u5316app \u5efa\u7acb pity/app/__init__.py \u7f16\u8f91 __init__.py from flask import Flask pity = Flask(__name__) \u4ee3\u7801\u8bb2\u89e3: \u8fd9\u662fflask\u7684 \u7ea6\u5b9a\u7528\u6cd5 , \u5f15\u5165Flask\u7c7b\u5e76\u5b9e\u4f8b\u5316\u4e86\u4e00\u4e2aFlask\u5bf9\u8c61, \u5176\u4e2d__name__\u4e3a\u901a\u4fd7\u5199\u6cd5\u3002 \u81f3\u6b64\uff0c\u6211\u4eec\u5c31\u5f97\u5230\u4e86\u8fd9\u6837\u7684\u4e00\u4e2a\u540d\u4e3a\"pity\"\u7684Flask \u5b9e\u4f8b \u3002 \u7f16\u5199Web\u670d\u52a1\u6587\u4ef6 \u7f16\u5199 pity/run.py from app import pity @pity.route('/') def hello_world () : return 'Hello World!' if __name__ == \"__main__\" : pity.run( \"0.0.0.0\" , threaded= True , port= \"7777\" ) \u5176\u4e2d @pity.route(\"/\") \u662f\u4e00\u4e2a \u88c5\u9970\u5668 , \u4ee3\u8868hello_world\u8fd9\u4e2a\u51fd\u6570\u4e0e\u8def\u7531 / \u8fdb\u884c\u7ed1\u5b9a\uff0c\u4e5f\u5c31\u662f\u8bf4\u5f53\u8bbf\u95ee\u5230 / \u8def\u7531\u7684\u65f6\u5019\uff0c\u51fd\u6570hello_world\u4f1a\u81ea\u52a8\u6267\u884c\u3002 pity.run(\"0.0.0.0\", threaded=True, port=\"7777\") \u8fd9\u53e5\u8bdd\u8868\u793a\u542f\u52a8web\u670d\u52a1, \u7b2c\u4e00\u4e2a\u53c2\u65700.0.0.0\u8868\u793a\u63a5\u53d7\u4efb\u4f55ip\u7684\u8bbf\u95ee\uff0cthreaded\u8868\u793a\u5982\u679c\u6709\u591a\u4eba\u540c\u65f6\u8bbf\u95ee\u4e00\u4e2a\u63a5\u53e3\u65f6\u662f\u975e\u963b\u585e\u7684\uff0cport\u4ee3\u8868\u670d\u52a1\u6302\u8f7d\u7684\u7aef\u53e3\uff0c\u8fd9\u91cc\u6211\u4eec\u4ee5 clearlove \u4e3a\u7aef\u53e3\u53f7: 7777\u3002 \u5c1d\u8bd5\u4e00\u4e0b\u5427\uff01 \u8fd0\u884crun.py\uff0c\u53ef\u5728pycharm\u8fd0\u884c\u4e5f\u53ef\u4ee5\u5728\u7ec8\u7aef\u91cc\u8f93\u5165 python3 run.py \u8fd0\u884c\u3002 \u53ef\u4ee5\u770b\u5230 Running on http://0.0.0.0:7777 , \u8bf4\u660e\u670d\u52a1\u542f\u52a8\u6210\u529f\u4e86\uff01 \u9a8c\u8bc1\u4e00\u4e0b \u54b1\u4eec\u90fd\u77e5\u9053 HTTP \u662f\u6709\u5f88\u591a\u79cd\u65b9\u6cd5\u7684\uff0c\u54b1\u4eec\u8fd9\u79cdpity.route\u5982\u679c\u6ca1\u6709\u6307\u5b9a\u65b9\u6cd5\u7684\u8bdd\uff0c\u9ed8\u8ba4\u5c31\u662f GET \u65b9\u6cd5\u3002 \u6253\u5f00\u6d4f\u89c8\u5668\u8f93\u5165: http://localhost:7777/ \u5982\u679c\u770b\u5230\u8fd9\u4e2ahello world\u8bf4\u660e\u4f60\u6210\u529f\u4e86\uff01 \u4eca\u5929\u7684\u8bfe\u7a0b\u5c31\u5230\u8fd9\u91cc\u4e86\uff0c\u4e0b\u671f\u89c1\u3002\u8bf4\u5b9e\u8bdd\u5199\u7684\u6709\u70b9\u7d2f\uff0c\u4ee3\u7801\u6ca1\u5199\u51e0\u884c\uff0c\u5c41\u8bdd\u5199\u4e86\u4e00\u5927\u5806\uff0c\u540e\u9762\u53ef\u80fd\u8981\u52a0\u5feb\u901f\u5ea6\u4e86\uff01 \u5168\u90e8\u4ee3\u7801\u5730\u5740: https://github.com/wuranxu/pity \u89c9\u5f97\u6709\u7528\u7684\u8bdd\u53ef\u4ee5\u5e2e\u5fd9\u70b9\u4e2aStar\u54e6QAQ","title":"1.\u642d\u5efaFlask Web\u670d\u52a1"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2810%29%20%E7%BC%96%E5%86%99%E6%B3%A8%E5%86%8C%E9%A1%B5%E9%9D%A2/","text":"\u7f16\u5199\u6ce8\u518c\u9875\u9762 \u56de\u987e \u4e0a\u4e00\u8282\u8bfe\u6211\u4eec\u5df2\u7ecf\u7f16\u5199\u597d\u4e86\u767b\u5f55\u9875\u9762\uff0c\u7528\u6237\u4e5f\u53ef\u4ee5\u6b63\u5e38\u767b\u5f55\u4e86\uff0c\u4e0d\u8fc7\u6211\u4eec\u4e0d\u80fd\u8ba9\u7528\u6237\u4e0d\u80fd\u6ce8\u518c\u5440\uff0c\u800c\u4e14\u6ce8\u518c\u4e5f\u4e0d\u80fd\u5b8c\u5168\u9760\u63a5\u53e3\u53bb\u505a\uff0c\u524d\u7aef\u4e5f\u9700\u8981\u63d0\u4f9b\u9875\u9762\u8fdb\u884c\u64cd\u4f5c\u7684\u3002 \u6ce8\u518c\u9875\u9762\u7f16\u5199 \u6211\u4eec\u7684\u76ee\u7684\u662f\uff0c\u628a\u8fd9\u91cc\u7684 \u624b\u673a\u53f7\u767b\u5f55 \u6539\u4e3a \u6ce8\u518c \uff0c\u5e76\u63d0\u4f9b\u5bf9\u5e94\u7684\u8f93\u5165\u6846\u3002 \u9996\u5148\u8fdb\u884c\u540d\u5b57\u4e0a\u7684\u4fee\u6539: \u5c06tab\u6539\u4e3a\u6ce8\u518c \u524d\u7aef\u5c31\u662f\u8fd9\u4e2a\u597d\uff0c\u6240\u89c1\u5373\u6240\u5f97\uff0c\u54b1\u4eec\u6765\u770b\u770b\u767b\u5f55\u9875\u9762\u7684\u6548\u679c: \u4fee\u6539\u6210\u529f \u6309\u7167\u4e0a\u56fe\u7684\u683c\u5f0f\uff0c\u6dfb\u52a04\u4e2a\u5b57\u6bb5: \u7528\u6237\u540d\u3001\u59d3\u540d\u3001\u90ae\u7bb1\u3001\u5bc6\u7801\u3002 \u4e3a\u4e86\u65b9\u4fbf\u8d77\u89c1\uff0c\u6211\u5c31\u6ca1\u6709\u8bbe\u7f6e\u4e8c\u6b21\u786e\u8ba4\u5bc6\u7801\uff0c\u548c\u90ae\u7bb1\u683c\u5f0f\u6821\u9a8c\uff0c\u8fd9\u4e2a\u5728\u6b63\u5e38\u7684web\u7cfb\u7edf\u90fd\u662f\u5fc5\u4e0d\u53ef\u5c11\u7684\uff0c\u4f46\u662f\u6211\u4eec\u662f\u4e00\u4e2a\u5feb\u9910\uff0c\u54c8\u54c8\u54c8\u3002\u80fd\u7701\u5219\u7701\uff0c\u7ecf\u8d39\u6709\u9650 \u3002 \u5b8c\u6574\u4ee3\u7801: {type === 'register' && ( <> < ProFormText fieldProps = {{ size: ' large ', prefix: < UserOutlined className = {styles.prefixIcon} /> , }} name=\"username\" placeholder=\"\u8bf7\u8f93\u5165\u7528\u6237\u540d\" rules={[ { required: true, message: \"\u8bf7\u8f93\u5165\u7528\u6237\u540d\", } ]} /> < ProFormText fieldProps = {{ size: ' large ', prefix: < MobileOutlined className = {styles.prefixIcon} /> , }} name=\"name\" placeholder=\"\u8bf7\u8f93\u5165\u59d3\u540d\" rules={[ { required: true, message: \"\u8bf7\u8f93\u5165\u59d3\u540d\", } ]} /> < ProFormText fieldProps = {{ size: ' large ', prefix: < MobileOutlined className = {styles.prefixIcon} /> , }} name=\"email\" placeholder=\"\u8bf7\u8f93\u5165\u7528\u6237\u90ae\u7bb1\" rules={[ { required: true, message: \"\u8bf7\u8f93\u5165\u7528\u6237\u90ae\u7bb1\", } ]} /> < ProFormText.Password fieldProps = {{ size: ' large ', prefix: < LockOutlined className = {styles.prefixIcon} /> , type: 'password' }} name=\"password\" placeholder=\"\u8bf7\u8f93\u5165\u7528\u6237\u5bc6\u7801\" rules={[ { required: true, message: \"\u8bf7\u8f93\u5165\u7528\u6237\u5bc6\u7801\", } ]} /> </> )} \u65b0\u589e\u6ce8\u518c\u65b9\u6cd5 \u56e0\u4e3a\u4e4b\u524d\u63d0\u4ea4\u51fd\u6570\u90fd\u662f\u7528\u6765\u767b\u5f55\u7684\uff0c\u8fd9\u6b21\u6211\u4eec\u9700\u8981type='register'\u7684\u65f6\u5019\u6ce8\u518c\uff0c\u800ctype='account'\u7684\u65f6\u5019\u767b\u5f55\u3002 \u5728model\u4e2d\u65b0\u589eregister\u526f\u4f5c\u7528 \u53c2\u8003*login\u65b9\u6cd5 \u9996\u5148\u662f\u8c03\u7528\u6ce8\u518c\u65b9\u6cd5\uff0c\u5982\u679c\u6210\u529f\u5219\u56de\u5230\u767b\u5f55\u9875\u9762\uff0c\u5931\u8d25\u5219\u8f93\u51fa\u9519\u8bef\u4fe1\u606f\u3002 \u6ce8\u610f\uff0c\u8fd9\u91cc\u7684setType\u5c31\u662findex.js\u4e2d\u7684setType\u65b9\u6cd5\uff0c\u56e0\u4e3adispatch\u4e0d\u8fd4\u56de\u7ed3\u679c\uff0c\u6240\u4ee5\u6211\u4eec\u628a\u6539\u53d8\u72b6\u6001\u7684\u65b9\u6cd5\u4f20\u5165\uff0c\u5728effects\u4e2d\u8fdb\u884c\u6539\u53d8 \u4fee\u6539submit\uff08\u63d0\u4ea4\uff09\u65b9\u6cd5 \u4e0a\u9762\u8bf4\u5230\uff0c\u6211\u4eec\u63d0\u4ea4\u6709\u65f6\u5019\u662f\u6ce8\u518c \u6709\u65f6\u5019\u662f\u767b\u5f55\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u4fee\u6539\u4e00\u4e0b: \u7b2c\u4e00\u5904\u5c31\u662f\u8981\u4fee\u6539\u8fd9\u91cc\u7684values\uff0c\u4e4b\u524d\u662f\u53d6\u51fausername\u548cpassword\uff0c\u800c\u73b0\u5728\u6211\u4eec\u9700\u8981\u5168\u90e8\u5b57\u6bb5\u7684\u503c\uff0c\u6240\u4ee5\u76f4\u63a5\u53d6\u5230 values \u5373\u53ef\u3002 \u6ce8\u91ca: \u8fd9\u91ccvalues\u5176\u5b9e\u662f\u8868\u5355\u7684\u6240\u6709\u503c\uff0c\u662f\u4e00\u4e2amap\uff0c\u6bd4\u5982values\u53ef\u80fd\u662f{username: \"woody\"}\u8fd9\u6837\u7684\u5f62\u5f0f\u3002 \u63a5\u7740\u6539\u9020onFinish\u65b9\u6cd5\uff0c\u4e5f\u5c31\u662f\u63d0\u4ea4\u7684\u5b9e\u9645\u8c03\u7528\u65b9\u6cd5: \u53ef\u4ee5\u770b\u5230\uff0c\u6211\u5bf9type\u8fdb\u884c\u4e86\u5224\u65ad\uff0c\u5982\u679c\u662faccount\u5219\u8c03\u7528login/login\u65b9\u6cd5\uff0c\u5426\u5219\u8c03\u7528login/register\u65b9\u6cd5\u3002\u8fd9\u91cc\u628asetType\u4e5f\u4f20\u9012\u4e86\u8fdb\u53bb\u3002 \u6d4b\u8bd5\u4e00\u4e0b \u6ce8\u518c\u5931\u8d25\u5373\u7528\u6237\u540d\u6216\u5bc6\u7801\u5b58\u5728\u65f6\uff0c\u505c\u7559\u5728\u6ce8\u518c\u9875\u9762 \u6ce8\u518c\u6210\u529f\u65f6\uff0c\u8df3\u56de\u767b\u5f55\u9875\u9762 \u7528\u521a\u624d\u6ce8\u518c\u7684\u8d26\u53f7\u767b\u5f55 \u641e\u5b9a\uff01\u8fd9\u7bc7\u6587\u7ae0\u53ef\u80fd\u4ee5\u56fe\u7247\u7684\u5f62\u5f0f\u5c45\u591a\uff0c\u4f46\u662f\u4e5f\u89e3\u51b3\u4e86\u65e0\u6cd5\u6ce8\u518c\u7684\u6838\u5fc3\u95ee\u9898\u3002\u559c\u6b22\u7684\u670b\u53cb\u53ef\u4ee5\u70b9\u4e2a\u8d5e\u652f\u6301\u4e00\u4e0b\u5440\uff01 ant design\u7684\u6807\u9898\u6709\u70b9\u591a \u6211\u4eec\u901a\u8fc7\u5168\u5c40\u641c\u7d22\u90fd\u66ff\u6362\u6210 Pity \u3002 \u540e\u7aef\u4ee3\u7801\u5730\u5740: https://github.com/wuranxu/pity \u524d\u7aef\u4ee3\u7801\u5730\u5740: https://github.com/wuranxu/pityWeb","title":"10.\u7f16\u5199\u6ce8\u518c\u9875\u9762"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28100%29%20%E5%AE%8C%E5%96%84%E4%B8%AA%E4%BA%BA%E4%B8%BB%E9%A1%B5/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \u56de\u987e \u4e0a\u4e00\u8282\u54b1\u4eec\u7f16\u5199\u597d\u4e86 \u64cd\u4f5c\u65e5\u5fd7 \u76f8\u5173\u529f\u80fd\uff0c\u8fd9\u4e00\u8282\u6211\u4eec\u5c31\u6765\u804a\u804a\u600e\u4e48\u5c55\u793a\u5b83\uff0c\u5c55\u793a\u64cd\u4f5c\u65e5\u5fd7\u662f\u4e00\u90e8\u5206\uff0c\u4e2a\u4eba\u4e3b\u9875\u4e5f\u662f\u53e6\u4e00\u90e8\u5206\u3002 \u5f53\u6211\u4eec \u8111\u6d77 \u91cc\u6ca1\u6709\u7c7b\u4f3c\u7684\u84dd\u56fe\u65f6\uff0c\u53ef\u4ee5\u501f\u9274\u4e0b\u5176\u4ed6web\u7684\u6548\u679c\u3002\u6bd4\u5982\u6398\u91d1(\u6ce8\u610f\u8fd9\u4e0d\u662f\u786c\u5e7f): \u53ef\u4ee5\u770b\u5230\u4ed6\u5927\u81f4\u5206\u6210\u4e863\u5757: \u7528\u6237\u4fe1\u606f\uff0c\u4f60\u662f\u8c01\uff0c\u4f60\u7684\u7b80\u4ecb\uff0c\u8054\u7cfb\u65b9\u5f0f\u7b49 \u4e2a\u4eba\u52a8\u6001 \u4e2a\u4eba\u6210\u5c31\u4ee5\u53ca\u7c89\u4e1d\u7b49\u6570\u636e \u8003\u8651\u5230\u6210\u5c31\u548c \u7c89\u4e1d \u8fd9\u4e2a\u6982\u5ff5\u6211\u4eec\u5185\u90e8\u53ef\u80fd\u4e0d\u592a\u5b9e\u7528\uff0c\u6240\u4ee5\u6211\u4eec\u4ee5\u4e2a\u4eba\u8d44\u6599\u548c\u4e2a\u4eba\u52a8\u6001\u4e3a\u4e3b\u9898\uff0c\u6784\u5efa\u6211\u4eec\u7684\u4e2a\u4eba\u9996\u9875\u3002 \u53c2\u8003\u4e00\u5bb6\u80af\u5b9a\u4e0d\u591f\u7684\uff0c\u6211\u4eec\u770b\u770bgithub: \u8fd9\u4e2a \u70ed\u529b\u56fe \u548c \u52a8\u6001 \u662f\u6211\u4eec\u60f3\u8981\u5c55\u793a\u7684\u3002\u6240\u4ee5\u6211\u4eec\u91c7\u7528\u5de6\u4fa7\u4e2a\u4eba\u4fe1\u606f+\u53f3\u4fa7\u70ed\u529b\u56fe/\u52a8\u6001\u7684\u65b9\u5f0f\u5c55\u793a\u4e2a\u4eba\u9875\u3002 \u5148\u6765\u770b\u770b\u6700\u7ec8\u6548\u679c: \u7f16\u5199\u83b7\u53d6\u64cd\u4f5c\u8bb0\u5f55\u7684\u63a5\u53e3 \u6839\u636e\u65f6\u95f4\u83b7\u53d6\u7528\u6237\u7684\u64cd\u4f5c\u6570\u636e(\u5bf9\u5e94\u70ed\u529b\u56fe) \u4fee\u6539PityOperationDao.py from sqlalchemy import func , select from app.crud import Mapper from app.models import async_session from app.models.operation_log import PityOperationLog from app.utils.decorator import dao from app.utils.logger import Log @dao ( PityOperationLog , Log ( \"PityOperationDao\" )) class PityOperationDao ( Mapper ): @classmethod async def count_user_activities ( cls , user_id , start_time : str , end_time : str ): \"\"\" \u6839\u636e\u5f00\u59cb/\u7ed3\u675f\u65f6\u95f4 \u83b7\u53d6\u7528\u6237\u7684\u6d3b\u52a8\u65e5\u5386\uff08\u64cd\u4f5c\u8bb0\u5f55\u7684\u6570\u91cf\uff09 :param user_id: :param start_time: :param end_time: :return: \"\"\" async with async_session () as session : async with session . begin (): format_date = func . date_format ( PityOperationLog . operate_time , \"%Y-%m- %d \" ) sql = select ( format_date , func . count ( PityOperationLog . id )) . where ( PityOperationLog . operate_time . between ( start_time , end_time ), PityOperationLog . user_id == user_id ) \\ . group_by ( format_date ) . order_by ( format_date ) data = await session . execute ( sql ) return data . all () \u8fd9\u91cc\u7684sqlalchemy\u8bed\u53e5\u6bd4\u8f83\u590d\u6742\uff0c\u6ce8\u610f2\u4e2a\u70b9\u5373\u53ef: func \u8fd9\u91cc\u7684func\u662f\u65f6\u95f4\u8f6c\u6362\u7684func\uff0c\u6211\u4eec\u64cd\u4f5c\u8bb0\u5f55\u5b58\u653e\u7684\u662f\u5177\u4f53\u7684\u65e5\u671f+\u65f6\u95f4\uff0c\u4f46\u6211\u4eec\u67e5\u8be2\u7528\u6237\u64cd\u4f5c\u4e00\u822c\u662f\u6309\u65e5\u671f\u6765\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u8f6c\u6362\u4e0b: func.date_format \u5e72\u7684\u5c31\u662f\u8fd9\u4e2a\u4e8b\u60c5\uff0c\u4e3a\u4e86group_by\u3002 \u8fd9\u4e2asql\u5c31\u662f\u7b5b\u9009\u51fauser_id\u7b49\u4e8e\u8981\u67e5\u8be2\u7528\u6237\uff0c\u5e76\u4e14\u65f6\u95f4\u5728 \u6307\u5b9a\u65e5\u671f \u4e4b\u5185\u7684\u6570\u636e\uff0c\u901a\u8fc7group_by\u62ff\u5230\u6bcf\u4e00\u5929\u7684\u64cd\u4f5c\u6b21\u6570\uff0c\u6700\u540e\u6839\u636e\u65e5\u671f\u6392\u5e8f\u540e\u8fd4\u56de\u3002 \u63a5\u7740\u521b\u5efaapp/router/operation/operation_log.py from fastapi import APIRouter , Depends from sqlalchemy import desc from app.crud.operation.PityOperationDao import PityOperationDao from app.handler.fatcory import PityResponse from app.models.operation_log import PityOperationLog from app.routers import Permission router = APIRouter ( prefix = \"/operation\" ) # \u83b7\u53d6\u7528\u6237\u64cd\u4f5c\u8bb0\u5f55\u70ed\u529b\u56fe\u4ee5\u53ca\u53c2\u4e0e\u7684\u9879\u76ee\u6570\u91cf @router . get ( \"/count\" ) async def list_user_activities ( user_id : int , start_time : str , end_time : str , _ = Depends ( Permission ())): try : records = await PityOperationDao . count_user_activities ( user_id , start_time , end_time ) ans = list () for r in records : # \u89e3\u5305\u65e5\u671f\u548c\u6570\u91cf date , count = r ans . append ( dict ( date = date , count = count )) return PityResponse . success ( ans ) except Exception as e : return PityResponse . failed ( e ) \u83b7\u53d6\u5230\u6570\u636e\u540e\uff0c\u628a\u65e5\u671f\u548cdate\u7ec4\u5408\u6210json\u6570\u7ec4\u3002 \u7f16\u5199\u83b7\u53d6\u7528\u6237\u64cd\u4f5c\u65e5\u5fd7\u8be6\u60c5\u7684\u63a5\u53e3 # \u83b7\u53d6\u7528\u6237\u64cd\u4f5c\u8bb0\u5f55 @router . get ( \"/list\" ) async def list_user_operation ( start_time : str , end_time : str , user_id : int , tag : str = None , _ = Depends ( Permission ())): try : records = await PityOperationDao . list_record ( user_id = user_id , tag = tag , condition = [ PityOperationLog . operate_time . between ( start_time , end_time )], desc = [ desc ( PityOperationLog . operate_time )]) return PityResponse . records ( records ) except Exception as e : return PityResponse . failed ( e ) \u8c03\u7528Mapper\u81ea\u5e26\u7684list_record\u65b9\u6cd5\uff0c\u6839\u636e\u6761\u4ef6\u7b5b\u9009\u51fa\u5bf9\u5e94\u7684\u6570\u636e\u5e76 \u8fd4\u56de \u3002\u8fd9\u628a\u5728 PityResponse \u91cc\u5c01\u88c5\u4e86\u4e00\u4e2arecords\u65b9\u6cd5: @staticmethod def records ( data : list , code = 0 , msg = \"\u64cd\u4f5c\u6210\u529f\" ): return dict ( code = code , msg = msg , data = PityResponse . model_to_list ( data )) \u8fd9\u6837\u5c31\u4e0d\u7528\u6bcf\u6b21\u90fdmodel_to_list\u4e86\u3002 \u524d\u7aef\u9875\u9762 \u5728route.js\u52a0\u5165member\u8def\u7531\uff0c\u4e0d\u5728\u83dc\u5355\u91cc\u5c55\u793a \u63a5\u7740\u662f\u7f16\u5199UserInfo.jsx \u4ee3\u7801\u6211\u5c31\u4e0d\u8d34\u4e86\uff0cgithub\u90fd\u6709\u8be6\u7ec6\u7684\uff0c\u6709\u5174\u8da3\u7684\u53ef\u4ee5\u62c9\u4e0b\u6765\u770b\u770b\u3002 \u5927\u6982\u4e5f\u5c31\u662f\u6839\u636e\u63a5\u53e3\u7684\u8fd4\u56de\uff0c\u751f\u6210\u5bf9\u5e94\u7684 \u52a8\u6001 \u548c\u4e2a\u4eba\u8d44\u6599\u9875\u9762\u3002 \u5c01\u88c5\u4e2a\u4eba\u7528\u6237\u7ec4\u4ef6 import React from 'react'; import {Avatar} from \"antd\"; import styles from \"@/components/GlobalHeader/index.less\"; import {CONFIG} from \"@/consts/config\"; import {Tooltip} from \"antd\"; export default ({user, size = 24, marginLeft = 4}) => { if (user === undefined) { return '\u52a0\u8f7d\u4e2d...' } // \u662f\u5426\u548c\u5de6\u8fb9\u6709\u8ddd\u79bb\uff0c\u6709\u7684\u8bdd\u5219\u4e3a2 return ( <> <Avatar size={size} className={styles.avatar} src={user.avatar || `${CONFIG.AVATAR_URL}${user.name}`} alt=\"avatar\"/> <Tooltip title=\"\u70b9\u51fb\u53ef\u67e5\u770b\u7528\u6237\u8d44\u6599\"> <a style={{marginLeft: marginLeft}} href={`/#/member/${user.id}`} target=\"_blank\" rel=\"noreferrer\">{user.name}</a> </Tooltip> </> ) } \u8fd9\u4e2a\u7ec4\u4ef6\u63a5\u53d7\u7528\u6237\u4fe1\u606f\uff0c\u548c \u5934\u50cf\u5c3a\u5bf8 \u3002\u4e3a\u5565\u8981\u8fd9\u4e2a\u7ec4\u4ef6\u5462\uff1f \u56e0\u4e3a\u6211\u4eec\u7684\u7528\u6237\u8d44\u6599\u9875\u9762\u6ca1\u6709\u63d0\u4f9b\u5165\u53e3\uff0c\u4e5f\u5c31\u662f\u8bf4\u83dc\u5355\u91cc\u627e\u4e0d\u5230\u3002\u518d\u8005\uff0c\u6211\u4eec\u9700\u8981\u628a\u7528\u6237\u540d\u6539\u4e3a\u5934\u50cf+\u7528\u6237\u540d\uff0c\u8fd9\u6837\u770b\u8d77\u6765\u66f4nice\u3002 \u770b\u770b\u5b9e\u6218\u6548\u679c: \u70b9\u51fb\u94fe\u63a5\u5c31\u53ef\u4ee5\u5230 \u4e2a\u4eba\u8d44\u6599 \u4e86\u3002 \u4eca\u5929\u7684\u5185\u5bb9\u5c31\u8bf4\u5230\u8fd9\u91cc\u4e86\uff0c\u5e0c\u671b\u5bf9\u5927\u5bb6\u6709\u5e2e\u52a9\u3002","title":"100.\u5b8c\u5584\u4e2a\u4eba\u4e3b\u9875"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28100%29%20%E5%AE%8C%E5%96%84%E4%B8%AA%E4%BA%BA%E4%B8%BB%E9%A1%B5/#_1","text":"\u4e0a\u4e00\u8282\u54b1\u4eec\u7f16\u5199\u597d\u4e86 \u64cd\u4f5c\u65e5\u5fd7 \u76f8\u5173\u529f\u80fd\uff0c\u8fd9\u4e00\u8282\u6211\u4eec\u5c31\u6765\u804a\u804a\u600e\u4e48\u5c55\u793a\u5b83\uff0c\u5c55\u793a\u64cd\u4f5c\u65e5\u5fd7\u662f\u4e00\u90e8\u5206\uff0c\u4e2a\u4eba\u4e3b\u9875\u4e5f\u662f\u53e6\u4e00\u90e8\u5206\u3002 \u5f53\u6211\u4eec \u8111\u6d77 \u91cc\u6ca1\u6709\u7c7b\u4f3c\u7684\u84dd\u56fe\u65f6\uff0c\u53ef\u4ee5\u501f\u9274\u4e0b\u5176\u4ed6web\u7684\u6548\u679c\u3002\u6bd4\u5982\u6398\u91d1(\u6ce8\u610f\u8fd9\u4e0d\u662f\u786c\u5e7f): \u53ef\u4ee5\u770b\u5230\u4ed6\u5927\u81f4\u5206\u6210\u4e863\u5757: \u7528\u6237\u4fe1\u606f\uff0c\u4f60\u662f\u8c01\uff0c\u4f60\u7684\u7b80\u4ecb\uff0c\u8054\u7cfb\u65b9\u5f0f\u7b49 \u4e2a\u4eba\u52a8\u6001 \u4e2a\u4eba\u6210\u5c31\u4ee5\u53ca\u7c89\u4e1d\u7b49\u6570\u636e \u8003\u8651\u5230\u6210\u5c31\u548c \u7c89\u4e1d \u8fd9\u4e2a\u6982\u5ff5\u6211\u4eec\u5185\u90e8\u53ef\u80fd\u4e0d\u592a\u5b9e\u7528\uff0c\u6240\u4ee5\u6211\u4eec\u4ee5\u4e2a\u4eba\u8d44\u6599\u548c\u4e2a\u4eba\u52a8\u6001\u4e3a\u4e3b\u9898\uff0c\u6784\u5efa\u6211\u4eec\u7684\u4e2a\u4eba\u9996\u9875\u3002 \u53c2\u8003\u4e00\u5bb6\u80af\u5b9a\u4e0d\u591f\u7684\uff0c\u6211\u4eec\u770b\u770bgithub: \u8fd9\u4e2a \u70ed\u529b\u56fe \u548c \u52a8\u6001 \u662f\u6211\u4eec\u60f3\u8981\u5c55\u793a\u7684\u3002\u6240\u4ee5\u6211\u4eec\u91c7\u7528\u5de6\u4fa7\u4e2a\u4eba\u4fe1\u606f+\u53f3\u4fa7\u70ed\u529b\u56fe/\u52a8\u6001\u7684\u65b9\u5f0f\u5c55\u793a\u4e2a\u4eba\u9875\u3002 \u5148\u6765\u770b\u770b\u6700\u7ec8\u6548\u679c:","title":"\u56de\u987e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28100%29%20%E5%AE%8C%E5%96%84%E4%B8%AA%E4%BA%BA%E4%B8%BB%E9%A1%B5/#_2","text":"\u6839\u636e\u65f6\u95f4\u83b7\u53d6\u7528\u6237\u7684\u64cd\u4f5c\u6570\u636e(\u5bf9\u5e94\u70ed\u529b\u56fe) \u4fee\u6539PityOperationDao.py from sqlalchemy import func , select from app.crud import Mapper from app.models import async_session from app.models.operation_log import PityOperationLog from app.utils.decorator import dao from app.utils.logger import Log @dao ( PityOperationLog , Log ( \"PityOperationDao\" )) class PityOperationDao ( Mapper ): @classmethod async def count_user_activities ( cls , user_id , start_time : str , end_time : str ): \"\"\" \u6839\u636e\u5f00\u59cb/\u7ed3\u675f\u65f6\u95f4 \u83b7\u53d6\u7528\u6237\u7684\u6d3b\u52a8\u65e5\u5386\uff08\u64cd\u4f5c\u8bb0\u5f55\u7684\u6570\u91cf\uff09 :param user_id: :param start_time: :param end_time: :return: \"\"\" async with async_session () as session : async with session . begin (): format_date = func . date_format ( PityOperationLog . operate_time , \"%Y-%m- %d \" ) sql = select ( format_date , func . count ( PityOperationLog . id )) . where ( PityOperationLog . operate_time . between ( start_time , end_time ), PityOperationLog . user_id == user_id ) \\ . group_by ( format_date ) . order_by ( format_date ) data = await session . execute ( sql ) return data . all () \u8fd9\u91cc\u7684sqlalchemy\u8bed\u53e5\u6bd4\u8f83\u590d\u6742\uff0c\u6ce8\u610f2\u4e2a\u70b9\u5373\u53ef: func \u8fd9\u91cc\u7684func\u662f\u65f6\u95f4\u8f6c\u6362\u7684func\uff0c\u6211\u4eec\u64cd\u4f5c\u8bb0\u5f55\u5b58\u653e\u7684\u662f\u5177\u4f53\u7684\u65e5\u671f+\u65f6\u95f4\uff0c\u4f46\u6211\u4eec\u67e5\u8be2\u7528\u6237\u64cd\u4f5c\u4e00\u822c\u662f\u6309\u65e5\u671f\u6765\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u8f6c\u6362\u4e0b: func.date_format \u5e72\u7684\u5c31\u662f\u8fd9\u4e2a\u4e8b\u60c5\uff0c\u4e3a\u4e86group_by\u3002 \u8fd9\u4e2asql\u5c31\u662f\u7b5b\u9009\u51fauser_id\u7b49\u4e8e\u8981\u67e5\u8be2\u7528\u6237\uff0c\u5e76\u4e14\u65f6\u95f4\u5728 \u6307\u5b9a\u65e5\u671f \u4e4b\u5185\u7684\u6570\u636e\uff0c\u901a\u8fc7group_by\u62ff\u5230\u6bcf\u4e00\u5929\u7684\u64cd\u4f5c\u6b21\u6570\uff0c\u6700\u540e\u6839\u636e\u65e5\u671f\u6392\u5e8f\u540e\u8fd4\u56de\u3002 \u63a5\u7740\u521b\u5efaapp/router/operation/operation_log.py from fastapi import APIRouter , Depends from sqlalchemy import desc from app.crud.operation.PityOperationDao import PityOperationDao from app.handler.fatcory import PityResponse from app.models.operation_log import PityOperationLog from app.routers import Permission router = APIRouter ( prefix = \"/operation\" ) # \u83b7\u53d6\u7528\u6237\u64cd\u4f5c\u8bb0\u5f55\u70ed\u529b\u56fe\u4ee5\u53ca\u53c2\u4e0e\u7684\u9879\u76ee\u6570\u91cf @router . get ( \"/count\" ) async def list_user_activities ( user_id : int , start_time : str , end_time : str , _ = Depends ( Permission ())): try : records = await PityOperationDao . count_user_activities ( user_id , start_time , end_time ) ans = list () for r in records : # \u89e3\u5305\u65e5\u671f\u548c\u6570\u91cf date , count = r ans . append ( dict ( date = date , count = count )) return PityResponse . success ( ans ) except Exception as e : return PityResponse . failed ( e ) \u83b7\u53d6\u5230\u6570\u636e\u540e\uff0c\u628a\u65e5\u671f\u548cdate\u7ec4\u5408\u6210json\u6570\u7ec4\u3002 \u7f16\u5199\u83b7\u53d6\u7528\u6237\u64cd\u4f5c\u65e5\u5fd7\u8be6\u60c5\u7684\u63a5\u53e3 # \u83b7\u53d6\u7528\u6237\u64cd\u4f5c\u8bb0\u5f55 @router . get ( \"/list\" ) async def list_user_operation ( start_time : str , end_time : str , user_id : int , tag : str = None , _ = Depends ( Permission ())): try : records = await PityOperationDao . list_record ( user_id = user_id , tag = tag , condition = [ PityOperationLog . operate_time . between ( start_time , end_time )], desc = [ desc ( PityOperationLog . operate_time )]) return PityResponse . records ( records ) except Exception as e : return PityResponse . failed ( e ) \u8c03\u7528Mapper\u81ea\u5e26\u7684list_record\u65b9\u6cd5\uff0c\u6839\u636e\u6761\u4ef6\u7b5b\u9009\u51fa\u5bf9\u5e94\u7684\u6570\u636e\u5e76 \u8fd4\u56de \u3002\u8fd9\u628a\u5728 PityResponse \u91cc\u5c01\u88c5\u4e86\u4e00\u4e2arecords\u65b9\u6cd5: @staticmethod def records ( data : list , code = 0 , msg = \"\u64cd\u4f5c\u6210\u529f\" ): return dict ( code = code , msg = msg , data = PityResponse . model_to_list ( data )) \u8fd9\u6837\u5c31\u4e0d\u7528\u6bcf\u6b21\u90fdmodel_to_list\u4e86\u3002","title":"\u7f16\u5199\u83b7\u53d6\u64cd\u4f5c\u8bb0\u5f55\u7684\u63a5\u53e3"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28100%29%20%E5%AE%8C%E5%96%84%E4%B8%AA%E4%BA%BA%E4%B8%BB%E9%A1%B5/#_3","text":"\u5728route.js\u52a0\u5165member\u8def\u7531\uff0c\u4e0d\u5728\u83dc\u5355\u91cc\u5c55\u793a \u63a5\u7740\u662f\u7f16\u5199UserInfo.jsx \u4ee3\u7801\u6211\u5c31\u4e0d\u8d34\u4e86\uff0cgithub\u90fd\u6709\u8be6\u7ec6\u7684\uff0c\u6709\u5174\u8da3\u7684\u53ef\u4ee5\u62c9\u4e0b\u6765\u770b\u770b\u3002 \u5927\u6982\u4e5f\u5c31\u662f\u6839\u636e\u63a5\u53e3\u7684\u8fd4\u56de\uff0c\u751f\u6210\u5bf9\u5e94\u7684 \u52a8\u6001 \u548c\u4e2a\u4eba\u8d44\u6599\u9875\u9762\u3002","title":"\u524d\u7aef\u9875\u9762"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28100%29%20%E5%AE%8C%E5%96%84%E4%B8%AA%E4%BA%BA%E4%B8%BB%E9%A1%B5/#_4","text":"import React from 'react'; import {Avatar} from \"antd\"; import styles from \"@/components/GlobalHeader/index.less\"; import {CONFIG} from \"@/consts/config\"; import {Tooltip} from \"antd\"; export default ({user, size = 24, marginLeft = 4}) => { if (user === undefined) { return '\u52a0\u8f7d\u4e2d...' } // \u662f\u5426\u548c\u5de6\u8fb9\u6709\u8ddd\u79bb\uff0c\u6709\u7684\u8bdd\u5219\u4e3a2 return ( <> <Avatar size={size} className={styles.avatar} src={user.avatar || `${CONFIG.AVATAR_URL}${user.name}`} alt=\"avatar\"/> <Tooltip title=\"\u70b9\u51fb\u53ef\u67e5\u770b\u7528\u6237\u8d44\u6599\"> <a style={{marginLeft: marginLeft}} href={`/#/member/${user.id}`} target=\"_blank\" rel=\"noreferrer\">{user.name}</a> </Tooltip> </> ) } \u8fd9\u4e2a\u7ec4\u4ef6\u63a5\u53d7\u7528\u6237\u4fe1\u606f\uff0c\u548c \u5934\u50cf\u5c3a\u5bf8 \u3002\u4e3a\u5565\u8981\u8fd9\u4e2a\u7ec4\u4ef6\u5462\uff1f \u56e0\u4e3a\u6211\u4eec\u7684\u7528\u6237\u8d44\u6599\u9875\u9762\u6ca1\u6709\u63d0\u4f9b\u5165\u53e3\uff0c\u4e5f\u5c31\u662f\u8bf4\u83dc\u5355\u91cc\u627e\u4e0d\u5230\u3002\u518d\u8005\uff0c\u6211\u4eec\u9700\u8981\u628a\u7528\u6237\u540d\u6539\u4e3a\u5934\u50cf+\u7528\u6237\u540d\uff0c\u8fd9\u6837\u770b\u8d77\u6765\u66f4nice\u3002 \u770b\u770b\u5b9e\u6218\u6548\u679c: \u70b9\u51fb\u94fe\u63a5\u5c31\u53ef\u4ee5\u5230 \u4e2a\u4eba\u8d44\u6599 \u4e86\u3002 \u4eca\u5929\u7684\u5185\u5bb9\u5c31\u8bf4\u5230\u8fd9\u91cc\u4e86\uff0c\u5e0c\u671b\u5bf9\u5927\u5bb6\u6709\u5e2e\u52a9\u3002","title":"\u5c01\u88c5\u4e2a\u4eba\u7528\u6237\u7ec4\u4ef6"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28101%29%20%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u5b8c\u5584\u4e86 \u64cd\u4f5c\u8bb0\u5f55 \u9875\u9762\uff0c\u8fd9\u6b21\u6211\u4eec\u6765\u8bb2\u8bb2\u7528\u6237\u7ba1\u7406\u76f8\u5173\u7684\u529f\u80fd\u3002\u505a\u8fd9\u4e2a\u7684\u76ee\u7684\u5462\uff0c\u4e3b\u8981\u662f\u4e3a\u4e86\u7ed9 \u7ba1\u7406\u5458 \u4e00\u4e2a\u8c03\u6574\u7528\u6237\u4fe1\u606f\u548c\u6743\u9650\u7684\u673a\u4f1a\u3002\u6bd4\u5982\u5c01\u7981\u8d26\u53f7\uff0c\u5f00\u901a \u7ec4\u957f\u6743\u9650 \u7684\u3002 \u8bf4\u4e2a\u9898\u5916\u8bdd \u6d4b\u8bd5\u5e73\u53f0\u7cfb\u5217\uff0c\u6ee1\u6253\u6ee1\u7b97\uff0c\u5199\u5230\u8fd9\u513f\u5df2\u7ecf\u6709100\u8282\u4e86\u3002\u76f8\u4fe1\u80fd\u8ddf\u968f\u5230\u8fd9\u4e00\u8282\u7684\u670b\u53cb\uff0c\u5df2\u7ecf\u5bf9pity\u6bd4\u8f83\u719f\u6089\u4e86\uff0c\u8d77\u7801\u6574\u4f53\u601d\u8def\u662f\u6ca1\u95ee\u9898\u4e86\u3002\u63a5\u4e0b\u6765\u6211\u53ef\u80fd\u4f1a\u4e0d\u592a\u8be6\u7ec6\u5f3a\u8c03\u5b9e\u73b0\uff0c\u53ea\u4f1a\u7528\u601d\u8def+\u6838\u5fc3\u4ee3\u7801\u7684\u65b9\u5f0f\u6765\u8bb2\u89e3\u3002 \u9488\u5bf9\u6211\u7684\u7ec6\u81f4\u6539\u52a8\uff0c\u53ef\u4ee5\u53bb\u770b\u770bgithub main\u5206\u652f\u7684\u63d0\u4ea4\u8bb0\u5f55\u3002 \u83b7\u53d6\u7528\u6237\u5217\u8868 \u8fd9\u4e2a\u63a5\u53e3\u662f\u6211\u4eec\u5df2\u7ecf\u6709\u4e86\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u4e0d\u9700\u8981 \u989d\u5916\u7f16\u5199 \u4e86\uff0c\u76f4\u63a5\u8c03\u7528\u5373\u53ef\u3002 \u66f4\u65b0\u7528\u6237\u4fe1\u606f \u56e0\u4e3a\u4e0a\u9762\u6211\u4eec\u8bf4\u5230\u4e86\u5c01\u7981\u7528\u6237\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u5b9a\u4e49\u4e00\u4e2a is_valid \u5b57\u6bb5\uff0c\u5f53\u5b57\u6bb5\u4e3aTrue\u7684\u65f6\u5019\uff0c\u4ee3\u8868\u7528\u6237\u662f\u6b63\u5e38\u7684(\u6ca1\u6709\u88ab\u5c01\u7981)\u3002 \u63a5\u7740\u5c31\u5f88\u81ea\u7136\u4e86\uff0c\u5c31\u662f\u666e\u901a\u7684 \u7f16\u8f91\u529f\u80fd \u3002 \u4fee\u6539\u7528\u6237\u8868 \u65b0\u589eis_valid\u5b57\u6bb5\uff0c\u9ed8\u8ba4\u503c\u4e3aTrue. \u65b0\u589e\u7f16\u8f91\u65b9\u6cd5 \u5728\u6b64\u4e4b\u524d\u6211\u4eec\u8981\u5148\u5b9a\u4e49\u597d \u8bf7\u6c42\u53c2\u6570 : \u53c2\u6570\u63a5\u53d7\u80fd\u591f\u6539\u52a8\u7684\u51e0\u4e2a\u5b57\u6bb5: id \u786e\u5b9a\u7528\u6237 name \u7528\u6237\u59d3\u540d email \u7528\u6237\u90ae\u7bb1 role \u7528\u6237\u89d2\u8272 is_valid \u662f\u5426\u5c01\u7981 \u76ee\u524d\u6211\u4eec\u53ea\u652f\u6301\u8fd9\u4e9b\u5185\u5bb9\u7684\u4fee\u6539\uff0c\u5982\u679c \u524d\u7aef\u4e0d\u4f20\u5165 \u6216\u8005\u4f20\u5165\u7a7a\u503c\uff0c\u6211\u4eec\u5c31\u4e0d\u4fee\u6539\u6570\u636e\uff0c\u6240\u4ee5\u9664\u4e86id\u5fc5\u586b\u4ee5\u5916\uff0c\u5176\u4ed6\u90fd\u662f\u53ef\u9009\u7684\u3002 \u63a5\u7740\u6211\u4eec\u53bb\u7f16\u8f91dao\u5c42\u7684\u7f16\u8f91\u65b9\u6cd5: \u5185\u5bb9\u4e5f\u5f88\u7b80\u5355\uff0c\u6839\u636eid\u67e5\u627e\u5230\u7528\u6237\uff0c\u5982\u679c\u4e0d\u5b58\u5728\u5219 \u629b\u5f02\u5e38 \u3002\u5426\u5219\u5219\u66f4\u65b0\u6570\u636e\u4e2d\u7684\u975e0\u5b57\u6bb5\u3002 \u6ce8\u610f\u8fd9\u91cc\u8fd8\u6709\u4e2aredis\u64cd\u4f5c\uff0c\u56e0\u4e3a\u6211\u4eec\u6539\u4e86\u6570\u636e\u7684\u8bdd\uff0credis\u662f\u9700\u8981\u5220\u9664\u7684\uff0c\u4e0d\u7136\u67e5\u8be2\u63a5\u53e3\u8fd8\u662f\u7528\u7684\u65e7\u6570\u636e \u7f16\u5199\u63a5\u53e3 router\u5f80\u5f80\u90fd\u5f88\u7b80\u5355\uff0c\u90fd\u662f\u8c03\u7528dao\u7684\u65b9\u6cd5\u5373\u53ef\u3002\u5c31\u4e0d\u9700\u8981\u8fc7\u591a\u5f3a\u8c03\u4e86\u3002 \u7f16\u5199\u524d\u7aef \u524d\u7aef\u6bd4\u8f83\u7b80\u5355\uff0c\u4e0a\u4e0b\u7ed3\u6784: \u641c\u7d22\u6846 \u7528\u6237\u8868\u683c \u7f16\u8f91\u7684\u65f6\u5019\uff0c\u81ea\u52a8\u5e26\u5165\u7528\u6237\u6570\u636e\u539f\u59cb\u503c\uff0c\u70b9\u51fb\u786e\u5b9a\u6309\u94ae\u7684\u65f6\u5019\u8c03\u7528\u521a\u624d\u7f16\u5199\u7684 \u66f4\u65b0\u63a5\u53e3 \u5373\u53ef\u3002 \u5bc6\u7801\u95ee\u9898 \u4e3a\u4ec0\u4e48\u4e0d\u8ba9\u7ba1\u7406\u5458\u4fee\u6539\u5bc6\u7801\uff0c\u56e0\u4e3a\u6211\u89c9\u5f97\u7ba1\u7406\u5458\u6700\u591a\u5141\u8bb8\u91cd\u7f6e\u7528\u6237\u7684\u5bc6\u7801\uff0c\u800c\u4e0d\u662f\u76f4\u63a5\u638c\u63a7\u4ed6\u4eba\u7684\u5bc6\u7801\u3002\u4e0d\u7136\u53ef\u80fd\u5c31\u6beb\u65e0\u9690\u79c1\u53ef\u8a00\u4e86\uff0c\u4e5f\u5bb9\u6613\u88ab\u4eba\u5229\u7528\u3002","title":"101.\u7528\u6237\u7ba1\u7406\u529f\u80fd\u5b9e\u73b0"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28101%29%20%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0/#_1","text":"\u4e0a\u4e00\u8282\u6211\u4eec\u5b8c\u5584\u4e86 \u64cd\u4f5c\u8bb0\u5f55 \u9875\u9762\uff0c\u8fd9\u6b21\u6211\u4eec\u6765\u8bb2\u8bb2\u7528\u6237\u7ba1\u7406\u76f8\u5173\u7684\u529f\u80fd\u3002\u505a\u8fd9\u4e2a\u7684\u76ee\u7684\u5462\uff0c\u4e3b\u8981\u662f\u4e3a\u4e86\u7ed9 \u7ba1\u7406\u5458 \u4e00\u4e2a\u8c03\u6574\u7528\u6237\u4fe1\u606f\u548c\u6743\u9650\u7684\u673a\u4f1a\u3002\u6bd4\u5982\u5c01\u7981\u8d26\u53f7\uff0c\u5f00\u901a \u7ec4\u957f\u6743\u9650 \u7684\u3002","title":"\u56de\u987e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28101%29%20%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0/#_2","text":"\u6d4b\u8bd5\u5e73\u53f0\u7cfb\u5217\uff0c\u6ee1\u6253\u6ee1\u7b97\uff0c\u5199\u5230\u8fd9\u513f\u5df2\u7ecf\u6709100\u8282\u4e86\u3002\u76f8\u4fe1\u80fd\u8ddf\u968f\u5230\u8fd9\u4e00\u8282\u7684\u670b\u53cb\uff0c\u5df2\u7ecf\u5bf9pity\u6bd4\u8f83\u719f\u6089\u4e86\uff0c\u8d77\u7801\u6574\u4f53\u601d\u8def\u662f\u6ca1\u95ee\u9898\u4e86\u3002\u63a5\u4e0b\u6765\u6211\u53ef\u80fd\u4f1a\u4e0d\u592a\u8be6\u7ec6\u5f3a\u8c03\u5b9e\u73b0\uff0c\u53ea\u4f1a\u7528\u601d\u8def+\u6838\u5fc3\u4ee3\u7801\u7684\u65b9\u5f0f\u6765\u8bb2\u89e3\u3002 \u9488\u5bf9\u6211\u7684\u7ec6\u81f4\u6539\u52a8\uff0c\u53ef\u4ee5\u53bb\u770b\u770bgithub main\u5206\u652f\u7684\u63d0\u4ea4\u8bb0\u5f55\u3002","title":"\u8bf4\u4e2a\u9898\u5916\u8bdd"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28101%29%20%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0/#_3","text":"\u8fd9\u4e2a\u63a5\u53e3\u662f\u6211\u4eec\u5df2\u7ecf\u6709\u4e86\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u4e0d\u9700\u8981 \u989d\u5916\u7f16\u5199 \u4e86\uff0c\u76f4\u63a5\u8c03\u7528\u5373\u53ef\u3002","title":"\u83b7\u53d6\u7528\u6237\u5217\u8868"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28101%29%20%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0/#_4","text":"\u56e0\u4e3a\u4e0a\u9762\u6211\u4eec\u8bf4\u5230\u4e86\u5c01\u7981\u7528\u6237\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u5b9a\u4e49\u4e00\u4e2a is_valid \u5b57\u6bb5\uff0c\u5f53\u5b57\u6bb5\u4e3aTrue\u7684\u65f6\u5019\uff0c\u4ee3\u8868\u7528\u6237\u662f\u6b63\u5e38\u7684(\u6ca1\u6709\u88ab\u5c01\u7981)\u3002 \u63a5\u7740\u5c31\u5f88\u81ea\u7136\u4e86\uff0c\u5c31\u662f\u666e\u901a\u7684 \u7f16\u8f91\u529f\u80fd \u3002 \u4fee\u6539\u7528\u6237\u8868 \u65b0\u589eis_valid\u5b57\u6bb5\uff0c\u9ed8\u8ba4\u503c\u4e3aTrue. \u65b0\u589e\u7f16\u8f91\u65b9\u6cd5 \u5728\u6b64\u4e4b\u524d\u6211\u4eec\u8981\u5148\u5b9a\u4e49\u597d \u8bf7\u6c42\u53c2\u6570 : \u53c2\u6570\u63a5\u53d7\u80fd\u591f\u6539\u52a8\u7684\u51e0\u4e2a\u5b57\u6bb5: id \u786e\u5b9a\u7528\u6237 name \u7528\u6237\u59d3\u540d email \u7528\u6237\u90ae\u7bb1 role \u7528\u6237\u89d2\u8272 is_valid \u662f\u5426\u5c01\u7981 \u76ee\u524d\u6211\u4eec\u53ea\u652f\u6301\u8fd9\u4e9b\u5185\u5bb9\u7684\u4fee\u6539\uff0c\u5982\u679c \u524d\u7aef\u4e0d\u4f20\u5165 \u6216\u8005\u4f20\u5165\u7a7a\u503c\uff0c\u6211\u4eec\u5c31\u4e0d\u4fee\u6539\u6570\u636e\uff0c\u6240\u4ee5\u9664\u4e86id\u5fc5\u586b\u4ee5\u5916\uff0c\u5176\u4ed6\u90fd\u662f\u53ef\u9009\u7684\u3002 \u63a5\u7740\u6211\u4eec\u53bb\u7f16\u8f91dao\u5c42\u7684\u7f16\u8f91\u65b9\u6cd5: \u5185\u5bb9\u4e5f\u5f88\u7b80\u5355\uff0c\u6839\u636eid\u67e5\u627e\u5230\u7528\u6237\uff0c\u5982\u679c\u4e0d\u5b58\u5728\u5219 \u629b\u5f02\u5e38 \u3002\u5426\u5219\u5219\u66f4\u65b0\u6570\u636e\u4e2d\u7684\u975e0\u5b57\u6bb5\u3002 \u6ce8\u610f\u8fd9\u91cc\u8fd8\u6709\u4e2aredis\u64cd\u4f5c\uff0c\u56e0\u4e3a\u6211\u4eec\u6539\u4e86\u6570\u636e\u7684\u8bdd\uff0credis\u662f\u9700\u8981\u5220\u9664\u7684\uff0c\u4e0d\u7136\u67e5\u8be2\u63a5\u53e3\u8fd8\u662f\u7528\u7684\u65e7\u6570\u636e \u7f16\u5199\u63a5\u53e3 router\u5f80\u5f80\u90fd\u5f88\u7b80\u5355\uff0c\u90fd\u662f\u8c03\u7528dao\u7684\u65b9\u6cd5\u5373\u53ef\u3002\u5c31\u4e0d\u9700\u8981\u8fc7\u591a\u5f3a\u8c03\u4e86\u3002","title":"\u66f4\u65b0\u7528\u6237\u4fe1\u606f"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28101%29%20%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0/#_5","text":"\u524d\u7aef\u6bd4\u8f83\u7b80\u5355\uff0c\u4e0a\u4e0b\u7ed3\u6784: \u641c\u7d22\u6846 \u7528\u6237\u8868\u683c \u7f16\u8f91\u7684\u65f6\u5019\uff0c\u81ea\u52a8\u5e26\u5165\u7528\u6237\u6570\u636e\u539f\u59cb\u503c\uff0c\u70b9\u51fb\u786e\u5b9a\u6309\u94ae\u7684\u65f6\u5019\u8c03\u7528\u521a\u624d\u7f16\u5199\u7684 \u66f4\u65b0\u63a5\u53e3 \u5373\u53ef\u3002","title":"\u7f16\u5199\u524d\u7aef"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28101%29%20%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0/#_6","text":"\u4e3a\u4ec0\u4e48\u4e0d\u8ba9\u7ba1\u7406\u5458\u4fee\u6539\u5bc6\u7801\uff0c\u56e0\u4e3a\u6211\u89c9\u5f97\u7ba1\u7406\u5458\u6700\u591a\u5141\u8bb8\u91cd\u7f6e\u7528\u6237\u7684\u5bc6\u7801\uff0c\u800c\u4e0d\u662f\u76f4\u63a5\u638c\u63a7\u4ed6\u4eba\u7684\u5bc6\u7801\u3002\u4e0d\u7136\u53ef\u80fd\u5c31\u6beb\u65e0\u9690\u79c1\u53ef\u8a00\u4e86\uff0c\u4e5f\u5bb9\u6613\u88ab\u4eba\u5229\u7528\u3002","title":"\u5bc6\u7801\u95ee\u9898"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28102%29%20%E5%AE%8C%E5%96%84%E4%B8%AA%E4%BA%BA%E8%B5%84%E6%96%99%E8%AE%BE%E7%BD%AE%E9%A1%B5%E9%9D%A2/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u5b9e\u73b0\u4e86 \u7528\u6237\u7ba1\u7406 \u529f\u80fd\uff0c\u80fd\u591f\u5bf9\u7528\u6237\u8fdb\u884c\u4e00\u4e9bCRUD\u7684\u64cd\u4f5c\u3002\u4f46\u90a3\u4ec5\u4ec5\u4e5f\u53ea\u662f\u9488\u5bf9\u7ba1\u7406\u5458\uff0c\u5047\u8bbe\u6211\u4eec\u60f3\u8c03\u6574\u6211\u4eec\u7684\u6635\u79f0\uff0c\u6216\u8005 \u5934\u50cf \uff0c\u6211\u4eec\u4f3c\u4e4e\u6ca1\u6709\u8fd9\u6837\u7684\u5165\u53e3\u3002 \u6240\u4ee5\u4eca\u5929\u6211\u4eec\u5c31\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002 \u601d\u8003 \u7531\u4e8e\u4e2a\u4eba\u8d44\u6599\u7684\u4fee\u6539\uff0c\u5176\u5b9e\u6539\u7684\u4e5f\u5c31\u662f PityUser \u8868\u91cc\u7684\u6570\u636e\uff0c\u6240\u4ee5\u5e76\u4e0d\u9700\u8981\u592a\u590d\u6742\u7684\u4e1c\u897f\u3002\u53cd\u800c\u524d\u7aef\u90e8\u5206\u662f\u91cd\u70b9\u5de5\u7a0b\u3002 \u6211\u4eec\u51e1\u662f\u5199\u9875\u9762\uff0c\u8111\u6d77\u91cc\u4e00\u5b9a\u8981\u6709\u4e2a\u53c2\u8003\u7684\u56fe\uff0c\u6bd5\u7adf\u5bf9\u4e8e\u6d4b\u8bd5\u5e73\u53f0\u7684\u5f00\u53d1\u6765\u8bf4\uff0c\u662f\u6ca1\u6709\u4e13\u95e8\u7684\u8bbe\u8ba1\u7a3f\u7684\uff0c\u8fd9\u4e2a\u4e1c\u897f\u53ea\u80fd\u6211\u4eec\u81ea\u5df1\u60f3\u3002 \u65e2\u7136\u81ea\u5df1\u5f88\u96be\u60f3\u5230\uff0c\u90a3\u6211\u4eec\u5c31\u53bb\u53c2\u8003\u522b\u4eba\u7684: \u53ef\u4ee5\u770b\u5230\u4ed6\u6709\u4e2a \u4e2a\u4eba\u8bbe\u7f6e \u9875\u9762\uff0c\u6211\u4eec\u70b9\u8fdb\u53bb\u770b\u4e0b: \u53ef\u4ee5\u8bf4\u662f\u5f00\u7bb1\u5373\u7528\u3002 \u65e2\u7136\u5982\u6b64\uff0c\u90a3\u6211\u4eec\u76f4\u63a5COPY\u4ed6\u7684\u4ee3\u7801\u7136\u540e\u8fdb\u884c \u5fae\u8c03 \u5373\u53ef\u3002 \u4fee\u6539\u5b57\u6bb5\u6570\u636e antd pro\u91cc\u9762\u6709\u8bb8\u591a\u7684\u4e2a\u4eba\u7b80\u4ecb\uff0c\u5730\u533a\u7b49\u7b49\u6211\u4eec\u4e0d\u9700\u8981\u586b\u7684\u4fe1\u606f\uff0c\u6211\u4eec\u8981\u91cd\u65b0\u68b3\u7406\u4e00\u904d\uff0c\u5728pity\u91cc\u9762\u5c31\u662f: \u59d3\u540d \u90ae\u7bb1 \u8054\u7cfb\u7535\u8bdd \u5934\u50cf \u57fa\u672c\u4e0a\u76ee\u524d\u8fd9\u56db\u4e2a\u6570\u636e\u5c31\u53ef\u4ee5cover\u4f4f\u6211\u4eec\u7684\u6570\u636e\u4e86\uff0c\u5f53\u7136\u5982\u679c\u4ee5\u540e\u63a5\u5165\u4f01\u4e1a\u5185\u90e8 SSO \u7684\u8bdd\uff0c\u8fd9\u4e2a\u9875\u9762\u5c31\u6ca1\u4ec0\u4e48\u5b58\u5728\u7684\u5fc5\u8981\u4e86\u3002 \u770b\u770b\u6548\u679c\u56fe: \u6570\u636e\u5462\uff0c\u6211\u662f\u968f\u4fbf\u5199\u7684\u3002 \u5b9e\u73b0 \u53ef\u4ee5\u770b\u51fa\uff0c\u4e0a\u8ff0\u6211\u4eec\u5b9e\u9645\u4e0a\u8c03\u7528\u7684\u662f \u7f16\u8f91\u7528\u6237\u7684\u63a5\u53e3 \uff0c\u4f46\u8fd9\u91cc\u6709\u4e2a\u5c0f\u5c0f\u7684\u4e0d\u540c\uff0c\u5f85\u4f1a\u4f1a\u8bb2\u3002\u63a5\u7740\u6211\u4eec\u9700\u8981\u6709\u4e2a \u4e0a\u4f20\u5934\u50cf \u7684\u63a5\u53e3\uff0c\u4e13\u95e8\u5904\u7406\u7528\u6237\u7684\u5934\u50cf\u3002 \u524d\u7aef\u4ee3\u7801 \u7531\u4e8e\u57fa\u672c\u4e0a\u662f\u62ff\u7684 antd pro \u7684\u6e90\u7801\uff0c\u6240\u4ee5\u6211\u8fd9\u8fb9\u53ea\u7ed9\u5927\u5bb6commit\uff0c\u5927\u5bb6\u8981\u81ea\u5df1\u53bb\u770b\u4e86\u3002 https://github.com/wuranxu/pityWeb/commit/39ff80dead3f15e1f199a903245db780f4da9e23#diff-55da039e17685acda9ab06fde7f12e2935c50ee93fd866e5be338059d6e1af43R1 \u540e\u7aef\u4ee3\u7801 \u6ce8\u610f\uff0c\u7531\u4e8e\u6211\u8c03\u6574\u8fc7oss\u7684\u6570\u636e\uff0c\u4f46\u662f\u6ca1\u6709\u8865\u5145\u5bf9\u5e94\u7684\u6587\u7ae0\u3002\u56e0\u4e3a\u6ca1\u6709\u592a\u5927\u5fc5\u8981\uff0c\u5c31\u662f\u4e2acurd\u7684\u64cd\u4f5c\uff0c\u5927\u5bb6\u53ef\u4ee5\u6284\u4e00\u4e0b\u8fd9\u4e2a\u7248\u672c\u7684\u4ee3\u7801 https://github.com/wuranxu/pity/commit/7e578e1d037b4cc111a7b2394d0d03ecea473f4f#diff-854061f75e79217e573fa174ca72e5414551d3ebd43a800a7ab8f4f4975604c7R1 \u91cc\u9762\u5173\u4e8eoss\u7684\u6539\u52a8\uff0c\u5927\u5bb6\u90fd\u53ef\u4ee5\u6284\u8d77\u6765\u3002\u4e3a\u4e86\u4fdd\u8bc1\u8d28\u91cf\uff0c\u6211\u5c31\u6ca1\u6709\u7ee7\u7eed\u6c34\u4e00\u7bc7\u8fd9\u5757\u7684\u5185\u5bb9\u3002 \u53bb\u7528\u6237\u8868/UserUpdateForm\u6dfb\u52a0phone\u5b57\u6bb5 \u4fee\u6539app/routers/auth/user.py\u4e0b\u7684update_user\u63a5\u53e3 \u6ce8\u91ca\u5199\u7684\u5f88\u8be6\u7ec6\uff0c\u56e0\u4e3a\u8fd9\u4e2a\u63a5\u53e3\u662f \u7528\u6237\u7ba1\u7406 \u548c \u4e2a\u4eba\u8d44\u6599\u8bbe\u7f6e \u516c\u7528\u7684\uff0c\u6240\u4ee5 \u666e\u901a\u6210\u5458 \u662f\u53ef\u4ee5\u7f16\u8f91\u81ea\u5df1\u7684\u7528\u6237\u4fe1\u606f\u7684\u3002 \u4f46\u662f\u4e00\u65e6\u4ed6\u6539\u522b\u4eba\u7684\u6570\u636e\uff0c\u90a3\u5c31\u7ed9\u4ed6\u76f4\u63a5 \u5f39\u51fa\u6743\u9650\u4e0d\u8db3 \u7684\u63d0\u793a\u3002\u63a5\u7740\u5982\u679c\u4ed6\u5bf9role\u6570\u636e\u8fdb\u884c\u4e86\u4fee\u6539\uff0c\u6211\u4eec\u76f4\u63a5\u62d2\u7edd\uff0c\u675c\u7edd\u8d8a\u6743\u73b0\u8c61\u3002 \u7f16\u8f91\u7528\u6237\u5934\u50cf\u4e0a\u4f20\u529f\u80fd \u6211\u4eec\u5728UserDao\u7f16\u5199update_avatar\u65b9\u6cd5: \u53c2\u6570\u662fuser_id\u548c\u56fe\u7247\u5730\u5740\uff0c\u63a5\u7740\u628a\u56fe\u7247\u5730\u5740\u7ed1\u5b9a\u5230user\u8eab\u4e0a\u3002\u90a3\u4e48\u600e\u4e48\u83b7\u53d6\u5230\u56fe\u7247\u5730\u5740\u5462\uff1f \u6211\u4eec\u9700\u8981\u5148\u4e0a\u4f20\u6570\u636e\u5230oss\uff0c\u63a5\u7740\u62ff\u5230oss\u7684url\u5373\u53ef\u3002\u6240\u4ee5\u8fd9\u5757oss\u505a\u4e86\u4e00\u4e9b\u5f88\u5927\u7684\u6539\u53d8\uff0c\u5927\u5bb6\u8fd8\u662f\u770b\u4e0a\u9762\u90a3\u4e2aoss\u7684\u64cd\u4f5c\u3002 \u7f16\u5199\u7528\u6237\u5934\u50cf\u4e0a\u4f20\u63a5\u53e3 \u63a5\u6536\u6587\u4ef6 \u5224\u65ad\u6587\u4ef6\u540e\u7f00\uff08\u8fd9\u91cc\u9700\u8981\u5224\u65ad\u662f\u4e0d\u662f\u56fe\u7247\u683c\u5f0f\uff0c\u7b14\u8005\u540e\u7eed\u4f1a\u8865\u5145\uff09 \u4e0a\u4f20\u5230oss\u5ba2\u6237\u7aef\u5e76\u62ff\u5230url \u66f4\u65b0\u5934\u50cf \u7531\u4e8e\u4ee3\u7801\u548c\u6559\u7a0b\u9694\u4e86 \u6bd4\u8f83\u4e45 \u7684\u5468\u671f\uff0c\u6240\u4ee5\u5bfc\u81f4\u8fd9\u7bc7\u6587\u7ae0\u53ef\u80fd\u5927\u5bb6\u770b\u7684\u4e91\u91cc\u96fe\u91cc\u3002\u4f46\u662f\u6ca1\u5173\u7cfb\uff0c\u6587\u7ae0\u7684\u76ee\u7684\u66f4\u91cd\u8981\u7684\u662f\u63d0\u4f9b\u4e00\u4e9b\u601d\u8def\u548c\u65b9\u6cd5\uff0c\u800c\u4e0d\u662f\u4e00\u6b65\u4e00\u6b65\u7684\u64cd\u4f5c\u6559\u7a0b\u3002\u6709\u601d\u8003\u624d\u6709\u8fdb\u6b65~\u5171\u52c9=\u3002= \u6240\u4ee5\u5176\u5b9e\u4ee3\u7801\u548c\u6587\u7ae0\u7ed3\u5408\u624d\u884c\u3002\u3002\u3002","title":"102.\u5b8c\u5584\u4e2a\u4eba\u8d44\u6599\u8bbe\u7f6e\u9875\u9762"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28102%29%20%E5%AE%8C%E5%96%84%E4%B8%AA%E4%BA%BA%E8%B5%84%E6%96%99%E8%AE%BE%E7%BD%AE%E9%A1%B5%E9%9D%A2/#_1","text":"\u4e0a\u4e00\u8282\u6211\u4eec\u5b9e\u73b0\u4e86 \u7528\u6237\u7ba1\u7406 \u529f\u80fd\uff0c\u80fd\u591f\u5bf9\u7528\u6237\u8fdb\u884c\u4e00\u4e9bCRUD\u7684\u64cd\u4f5c\u3002\u4f46\u90a3\u4ec5\u4ec5\u4e5f\u53ea\u662f\u9488\u5bf9\u7ba1\u7406\u5458\uff0c\u5047\u8bbe\u6211\u4eec\u60f3\u8c03\u6574\u6211\u4eec\u7684\u6635\u79f0\uff0c\u6216\u8005 \u5934\u50cf \uff0c\u6211\u4eec\u4f3c\u4e4e\u6ca1\u6709\u8fd9\u6837\u7684\u5165\u53e3\u3002 \u6240\u4ee5\u4eca\u5929\u6211\u4eec\u5c31\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002","title":"\u56de\u987e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28102%29%20%E5%AE%8C%E5%96%84%E4%B8%AA%E4%BA%BA%E8%B5%84%E6%96%99%E8%AE%BE%E7%BD%AE%E9%A1%B5%E9%9D%A2/#_2","text":"\u7531\u4e8e\u4e2a\u4eba\u8d44\u6599\u7684\u4fee\u6539\uff0c\u5176\u5b9e\u6539\u7684\u4e5f\u5c31\u662f PityUser \u8868\u91cc\u7684\u6570\u636e\uff0c\u6240\u4ee5\u5e76\u4e0d\u9700\u8981\u592a\u590d\u6742\u7684\u4e1c\u897f\u3002\u53cd\u800c\u524d\u7aef\u90e8\u5206\u662f\u91cd\u70b9\u5de5\u7a0b\u3002 \u6211\u4eec\u51e1\u662f\u5199\u9875\u9762\uff0c\u8111\u6d77\u91cc\u4e00\u5b9a\u8981\u6709\u4e2a\u53c2\u8003\u7684\u56fe\uff0c\u6bd5\u7adf\u5bf9\u4e8e\u6d4b\u8bd5\u5e73\u53f0\u7684\u5f00\u53d1\u6765\u8bf4\uff0c\u662f\u6ca1\u6709\u4e13\u95e8\u7684\u8bbe\u8ba1\u7a3f\u7684\uff0c\u8fd9\u4e2a\u4e1c\u897f\u53ea\u80fd\u6211\u4eec\u81ea\u5df1\u60f3\u3002 \u65e2\u7136\u81ea\u5df1\u5f88\u96be\u60f3\u5230\uff0c\u90a3\u6211\u4eec\u5c31\u53bb\u53c2\u8003\u522b\u4eba\u7684: \u53ef\u4ee5\u770b\u5230\u4ed6\u6709\u4e2a \u4e2a\u4eba\u8bbe\u7f6e \u9875\u9762\uff0c\u6211\u4eec\u70b9\u8fdb\u53bb\u770b\u4e0b: \u53ef\u4ee5\u8bf4\u662f\u5f00\u7bb1\u5373\u7528\u3002 \u65e2\u7136\u5982\u6b64\uff0c\u90a3\u6211\u4eec\u76f4\u63a5COPY\u4ed6\u7684\u4ee3\u7801\u7136\u540e\u8fdb\u884c \u5fae\u8c03 \u5373\u53ef\u3002","title":"\u601d\u8003"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28102%29%20%E5%AE%8C%E5%96%84%E4%B8%AA%E4%BA%BA%E8%B5%84%E6%96%99%E8%AE%BE%E7%BD%AE%E9%A1%B5%E9%9D%A2/#_3","text":"antd pro\u91cc\u9762\u6709\u8bb8\u591a\u7684\u4e2a\u4eba\u7b80\u4ecb\uff0c\u5730\u533a\u7b49\u7b49\u6211\u4eec\u4e0d\u9700\u8981\u586b\u7684\u4fe1\u606f\uff0c\u6211\u4eec\u8981\u91cd\u65b0\u68b3\u7406\u4e00\u904d\uff0c\u5728pity\u91cc\u9762\u5c31\u662f: \u59d3\u540d \u90ae\u7bb1 \u8054\u7cfb\u7535\u8bdd \u5934\u50cf \u57fa\u672c\u4e0a\u76ee\u524d\u8fd9\u56db\u4e2a\u6570\u636e\u5c31\u53ef\u4ee5cover\u4f4f\u6211\u4eec\u7684\u6570\u636e\u4e86\uff0c\u5f53\u7136\u5982\u679c\u4ee5\u540e\u63a5\u5165\u4f01\u4e1a\u5185\u90e8 SSO \u7684\u8bdd\uff0c\u8fd9\u4e2a\u9875\u9762\u5c31\u6ca1\u4ec0\u4e48\u5b58\u5728\u7684\u5fc5\u8981\u4e86\u3002 \u770b\u770b\u6548\u679c\u56fe: \u6570\u636e\u5462\uff0c\u6211\u662f\u968f\u4fbf\u5199\u7684\u3002","title":"\u4fee\u6539\u5b57\u6bb5\u6570\u636e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28102%29%20%E5%AE%8C%E5%96%84%E4%B8%AA%E4%BA%BA%E8%B5%84%E6%96%99%E8%AE%BE%E7%BD%AE%E9%A1%B5%E9%9D%A2/#_4","text":"\u53ef\u4ee5\u770b\u51fa\uff0c\u4e0a\u8ff0\u6211\u4eec\u5b9e\u9645\u4e0a\u8c03\u7528\u7684\u662f \u7f16\u8f91\u7528\u6237\u7684\u63a5\u53e3 \uff0c\u4f46\u8fd9\u91cc\u6709\u4e2a\u5c0f\u5c0f\u7684\u4e0d\u540c\uff0c\u5f85\u4f1a\u4f1a\u8bb2\u3002\u63a5\u7740\u6211\u4eec\u9700\u8981\u6709\u4e2a \u4e0a\u4f20\u5934\u50cf \u7684\u63a5\u53e3\uff0c\u4e13\u95e8\u5904\u7406\u7528\u6237\u7684\u5934\u50cf\u3002","title":"\u5b9e\u73b0"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28102%29%20%E5%AE%8C%E5%96%84%E4%B8%AA%E4%BA%BA%E8%B5%84%E6%96%99%E8%AE%BE%E7%BD%AE%E9%A1%B5%E9%9D%A2/#_5","text":"\u7531\u4e8e\u57fa\u672c\u4e0a\u662f\u62ff\u7684 antd pro \u7684\u6e90\u7801\uff0c\u6240\u4ee5\u6211\u8fd9\u8fb9\u53ea\u7ed9\u5927\u5bb6commit\uff0c\u5927\u5bb6\u8981\u81ea\u5df1\u53bb\u770b\u4e86\u3002 https://github.com/wuranxu/pityWeb/commit/39ff80dead3f15e1f199a903245db780f4da9e23#diff-55da039e17685acda9ab06fde7f12e2935c50ee93fd866e5be338059d6e1af43R1","title":"\u524d\u7aef\u4ee3\u7801"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28102%29%20%E5%AE%8C%E5%96%84%E4%B8%AA%E4%BA%BA%E8%B5%84%E6%96%99%E8%AE%BE%E7%BD%AE%E9%A1%B5%E9%9D%A2/#_6","text":"\u6ce8\u610f\uff0c\u7531\u4e8e\u6211\u8c03\u6574\u8fc7oss\u7684\u6570\u636e\uff0c\u4f46\u662f\u6ca1\u6709\u8865\u5145\u5bf9\u5e94\u7684\u6587\u7ae0\u3002\u56e0\u4e3a\u6ca1\u6709\u592a\u5927\u5fc5\u8981\uff0c\u5c31\u662f\u4e2acurd\u7684\u64cd\u4f5c\uff0c\u5927\u5bb6\u53ef\u4ee5\u6284\u4e00\u4e0b\u8fd9\u4e2a\u7248\u672c\u7684\u4ee3\u7801 https://github.com/wuranxu/pity/commit/7e578e1d037b4cc111a7b2394d0d03ecea473f4f#diff-854061f75e79217e573fa174ca72e5414551d3ebd43a800a7ab8f4f4975604c7R1 \u91cc\u9762\u5173\u4e8eoss\u7684\u6539\u52a8\uff0c\u5927\u5bb6\u90fd\u53ef\u4ee5\u6284\u8d77\u6765\u3002\u4e3a\u4e86\u4fdd\u8bc1\u8d28\u91cf\uff0c\u6211\u5c31\u6ca1\u6709\u7ee7\u7eed\u6c34\u4e00\u7bc7\u8fd9\u5757\u7684\u5185\u5bb9\u3002 \u53bb\u7528\u6237\u8868/UserUpdateForm\u6dfb\u52a0phone\u5b57\u6bb5 \u4fee\u6539app/routers/auth/user.py\u4e0b\u7684update_user\u63a5\u53e3 \u6ce8\u91ca\u5199\u7684\u5f88\u8be6\u7ec6\uff0c\u56e0\u4e3a\u8fd9\u4e2a\u63a5\u53e3\u662f \u7528\u6237\u7ba1\u7406 \u548c \u4e2a\u4eba\u8d44\u6599\u8bbe\u7f6e \u516c\u7528\u7684\uff0c\u6240\u4ee5 \u666e\u901a\u6210\u5458 \u662f\u53ef\u4ee5\u7f16\u8f91\u81ea\u5df1\u7684\u7528\u6237\u4fe1\u606f\u7684\u3002 \u4f46\u662f\u4e00\u65e6\u4ed6\u6539\u522b\u4eba\u7684\u6570\u636e\uff0c\u90a3\u5c31\u7ed9\u4ed6\u76f4\u63a5 \u5f39\u51fa\u6743\u9650\u4e0d\u8db3 \u7684\u63d0\u793a\u3002\u63a5\u7740\u5982\u679c\u4ed6\u5bf9role\u6570\u636e\u8fdb\u884c\u4e86\u4fee\u6539\uff0c\u6211\u4eec\u76f4\u63a5\u62d2\u7edd\uff0c\u675c\u7edd\u8d8a\u6743\u73b0\u8c61\u3002 \u7f16\u8f91\u7528\u6237\u5934\u50cf\u4e0a\u4f20\u529f\u80fd \u6211\u4eec\u5728UserDao\u7f16\u5199update_avatar\u65b9\u6cd5: \u53c2\u6570\u662fuser_id\u548c\u56fe\u7247\u5730\u5740\uff0c\u63a5\u7740\u628a\u56fe\u7247\u5730\u5740\u7ed1\u5b9a\u5230user\u8eab\u4e0a\u3002\u90a3\u4e48\u600e\u4e48\u83b7\u53d6\u5230\u56fe\u7247\u5730\u5740\u5462\uff1f \u6211\u4eec\u9700\u8981\u5148\u4e0a\u4f20\u6570\u636e\u5230oss\uff0c\u63a5\u7740\u62ff\u5230oss\u7684url\u5373\u53ef\u3002\u6240\u4ee5\u8fd9\u5757oss\u505a\u4e86\u4e00\u4e9b\u5f88\u5927\u7684\u6539\u53d8\uff0c\u5927\u5bb6\u8fd8\u662f\u770b\u4e0a\u9762\u90a3\u4e2aoss\u7684\u64cd\u4f5c\u3002 \u7f16\u5199\u7528\u6237\u5934\u50cf\u4e0a\u4f20\u63a5\u53e3 \u63a5\u6536\u6587\u4ef6 \u5224\u65ad\u6587\u4ef6\u540e\u7f00\uff08\u8fd9\u91cc\u9700\u8981\u5224\u65ad\u662f\u4e0d\u662f\u56fe\u7247\u683c\u5f0f\uff0c\u7b14\u8005\u540e\u7eed\u4f1a\u8865\u5145\uff09 \u4e0a\u4f20\u5230oss\u5ba2\u6237\u7aef\u5e76\u62ff\u5230url \u66f4\u65b0\u5934\u50cf \u7531\u4e8e\u4ee3\u7801\u548c\u6559\u7a0b\u9694\u4e86 \u6bd4\u8f83\u4e45 \u7684\u5468\u671f\uff0c\u6240\u4ee5\u5bfc\u81f4\u8fd9\u7bc7\u6587\u7ae0\u53ef\u80fd\u5927\u5bb6\u770b\u7684\u4e91\u91cc\u96fe\u91cc\u3002\u4f46\u662f\u6ca1\u5173\u7cfb\uff0c\u6587\u7ae0\u7684\u76ee\u7684\u66f4\u91cd\u8981\u7684\u662f\u63d0\u4f9b\u4e00\u4e9b\u601d\u8def\u548c\u65b9\u6cd5\uff0c\u800c\u4e0d\u662f\u4e00\u6b65\u4e00\u6b65\u7684\u64cd\u4f5c\u6559\u7a0b\u3002\u6709\u601d\u8003\u624d\u6709\u8fdb\u6b65~\u5171\u52c9=\u3002= \u6240\u4ee5\u5176\u5b9e\u4ee3\u7801\u548c\u6587\u7ae0\u7ed3\u5408\u624d\u884c\u3002\u3002\u3002","title":"\u540e\u7aef\u4ee3\u7801"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28103%29%20%E7%BC%96%E5%86%99%E7%B3%BB%E7%BB%9F%E8%AE%BE%E7%BD%AE%E9%A1%B5%E9%9D%A2/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u8bb2\u4e86 \u5b8c\u5584\u4e2a\u4eba\u8d44\u6599 \u529f\u80fd\uff0c\u5e76\u80fd\u591f\u5229\u7528oss\u5bf9\u6211\u4eec\u7684\u7528\u6237\u5934\u50cf\u8fdb\u884c\u7ba1\u7406\u3002 \u8fd8\u8bb0\u5f97\u6211\u4eec\u4e4b\u524d\u7684 configuration.json \u6587\u4ef6\uff08\u7cfb\u7edf\u914d\u7f6e\u6587\u4ef6\uff09\u5417\uff1f \u90a3\u8fd9\u4e00\u8282\u6211\u4eec\u5c31\u6765\u8bb2\u4e0b \u7cfb\u7edf\u914d\u7f6e \u529f\u80fd\uff0c\u4e5f\u5c31\u662f\u80fd\u591f\u5728\u524d\u7aef\u9875\u9762\u914d\u7f6econfiguration.json\u3002 \u56de\u5fc6\u7ec6\u8282 \u4e4b\u524d\u6211\u4eec\u662f\u7f16\u5199\u4e86 \u914d\u7f6e\u7ba1\u7406 \u529f\u80fd\u7684\uff0c\u867d\u7136\u6709\u66f4\u65b0\u7684\u64cd\u4f5c\uff0c\u4f46\u662f\u6ca1\u6709\u5b9e\u9645\u7684\u8fd0\u7528\u3002 oss\u90a3\u5757\u8bfb\u53d6oss\u7c7b\u578b\u548c\u8d26\u53f7\u5bc6\u7801\uff0c\u4ee5\u53ca\u90ae\u7bb1\u90e8\u5206\u6709\u7528\u5230\u3002 \u6709\u4e86\u5b9e\u9645\u7684\u65b9\u6cd5\uff0c\u90a3\u6211\u4eec\u7f16\u5199curd\u63a5\u53e3\u5c31\u7b80\u5355\u5f88\u591a\u3002 \u5b9e\u73b0 \u540e\u7aef\u903b\u8f91 \u4fee\u6539\u7f16\u8f91\u90e8\u5206 \u7f16\u8f91\u7684\u5730\u65b9\uff0c\u6211\u4eec\u9700\u8981\u8c03\u6574\u4e00\u4e0b\uff0c\u5199\u5165json\u6587\u4ef6\u7684\u65f6\u5019\uff0c\u6ce8\u610fensure_ascii\u8fd9\u4e2a\u53c2\u6570\u7684\u5173\u95ed\uff0c\u4ee5\u53caindent(\u7f29\u8fdb)\u3002 \u65b0\u589eapp/routers/config/system.py\u6587\u4ef6 from fastapi import Depends from app.core.configuration import SystemConfiguration from app.handler.fatcory import PityResponse from app.routers import Permission from app.routers.config.gconfig import router from config import Config @router . get ( \"/system\" , description = \"\u83b7\u53d6\u7cfb\u7edf\u914d\u7f6e\" ) def get_system_config ( _ = Depends ( Permission ( Config . ADMIN ))): configuration = SystemConfiguration . get_config () return PityResponse . success ( configuration ) @router . post ( \"/system/update\" , description = \"\u66f4\u65b0\u7cfb\u7edf\u914d\u7f6e\" ) def get_system_config ( data : dict , _ = Depends ( Permission ( Config . ADMIN ))): SystemConfiguration . update_config ( data ) return PityResponse . success () \u6211\u4eec\u628a\u8def\u7531\u5199\u5728config\u4e0b\uff0c\u90a3\u4e48 /config/system \u662f\u83b7\u53d6\u914d\u7f6e\u63a5\u53e3\uff0c /config/system/update \u662f\u4fee\u6539\u63a5\u53e3\u3002 \u6700\u540e\u6211\u4eec\u5728app/ init .py\u628a\u7f16\u5199\u597d\u7684\u8def\u7531\u6ce8\u518c\u8fdb\u53bb\u5373\u53ef\u3002 \u524d\u7aef\u903b\u8f91 \u7f16\u5199service\u5c42 \u5206\u522b\u7f16\u5199\u597d\u8c03\u7528\u83b7\u53d6/\u66f4\u65b0\u7684\u63a5\u53e3\u5373\u53ef\u3002 \u7f16\u5199model\u5c42 \u5728models/gconfig.js\u91cc\u9762\u65b0\u589e2\u4e2a\u65b9\u6cd5\uff0c\u8c03\u7528\u521a\u624dservice\u5c42\u7f16\u5199\u76842\u4e2a\u63a5\u53e3\u3002 \u7f16\u5199view\u5c42 \u9996\u5148\u6211\u4eec\u5c06\u9875\u9762\u62c6\u5206\u4e3a3\u4e2atab: oss email yapi \u8fd9\u6837\u5c31\u5bf9\u5e943\u4e2a\u5b50\u7ec4\u4ef6\uff0c\u5148\u770b\u4e0b\u7406\u60f3\u7684\u6548\u679c\u56fe: \u6240\u4ee5\u6211\u4eec\u65b0\u5efa\u4e00\u4e2a src/pages/Config/SystemConfig.jsx \u6587\u4ef6: import {PageContainer} from \"@ant-design/pro-layout\"; import {Button, Card, Col, Form, message, Row, Spin, Tabs} from \"antd\"; import OssConfig from \"@/components/System/OssConfig\"; import EmailConfig from \"@/components/System/EmailConfig\"; import YapiConfig from \"@/components/System/YapiConfig\"; import {SaveOutlined} from \"@ant-design/icons\"; import {connect} from \"umi\"; import {useEffect} from \"react\"; const {TabPane} = Tabs; const SystemConfig = ({dispatch, gconfig, loading}) => { const [form] = Form.useForm() const {configuration} = gconfig; const onSetField = () => { const {email, oss, yapi} = configuration; form.setFieldsValue(email); form.setFieldsValue(oss); form.setFieldsValue(yapi); } useEffect(() => { dispatch({ type: 'gconfig/fetchSystemConfig' }) }, []) useEffect(() => { // \u8fd9\u91cc\u6279\u91cf\u53d8\u66f4\u8868\u5355\u6570\u636e onSetField() }, [configuration]) const onSubmit = async () => { let values; try { values = await form.validateFields(); } catch (e) { message.info(\"\u6709\u5fc5\u586b\u5b57\u6bb5\u672a\u586b\u5199\uff0c\u8bf7\u68c0\u67e5\") return; } const requestData = { email: { \"sender\": values.sender, \"password\": values.password, \"host\": values.host, \"to\": values.to }, yapi: { \"token\": values.token, }, oss: { \"oss_type\": values.oss_type, \"access_key_id\": values.access_key_id, \"access_key_secret\": values.access_key_secret, \"bucket\": values.bucket, \"endpoint\": values.endpoint } } dispatch({ type: \"gconfig/updateConfiguration\", payload: requestData, }) } return ( <PageContainer title=\"\u7cfb\u7edf\u8bbe\u7f6e\" breadcrumb={null}> <Spin spinning={loading.effects['gconfig/updateConfiguration'] || loading.effects['gconfig/fetchSystemConfig']}> <Card> <Row> <Col span={24}> <Tabs tabPosition=\"left\"> <TabPane key=\"1\" tab=\"\u90ae\u4ef6\u8bbe\u7f6e\" forceRender> <EmailConfig form={form}/> </TabPane> <TabPane key=\"2\" tab=\"OSS\u8bbe\u7f6e\" forceRender> <OssConfig form={form}/> </TabPane> <TabPane key=\"3\" tab=\"Yapi\u8bbe\u7f6e\" forceRender> <YapiConfig form={form}/> </TabPane> </Tabs> </Col> </Row> <Row> <div style={{margin: '16px auto'}}> <Button type=\"primary\" icon={<SaveOutlined/>} onClick={onSubmit}>\u4fdd\u5b58</Button> </div> </Row> </Card> </Spin> </PageContainer> ) } export default connect(({gconfig, loading}) => ({gconfig, loading}))(SystemConfig); \u53ef\u4ee5\u770b\u5230\uff0c\u7ed3\u6784\u5f88\u7b80\u5355\uff0c\u4e3b\u8981\u662f\u4e00\u4e2a tabs \u52a0\u4e0a\u5177\u4f53tab\u9875\u91cc\u9762\u7684\u5185\u5bb9\uff0c\u6bcf\u4e2a\u7c7b\u578b\u7684tab\u53c8\u5bf9\u5e94\u4e86\u4e0d\u540c\u7684\u7ec4\u4ef6: \u5206\u522b\u5728src/components/System\u5efa\u7acb\u4e0b\u97623\u4e2a\u7ec4\u4ef6\u7684jsx: \u90ae\u4ef6\u7ec4\u4ef6EmailConfig.jsx: import {Col, Form, Input, Row} from \"antd\"; import {CONFIG} from \"@/consts/config\"; export default ({form}) => { return ( <Row gutter={8}> <Col span={4}/> <Col span={16}> <Form form={form} {...CONFIG.LAYOUT}> <Form.Item label=\"\u53d1\u4ef6\u4eba\" name=\"sender\" rules={[{required: true, message: '\u8bf7\u8f93\u5165\u53d1\u4ef6\u4eba\u90ae\u7bb1'}]}> <Input placeholder=\"\u8bf7\u8f93\u5165\u53d1\u4ef6\u4eba\u90ae\u7bb1\"/> </Form.Item> <Form.Item label=\"host\" name=\"host\" rules={[{required: true, message: '\u8bf7\u8f93\u5165\u670d\u52a1\u5668host'}]}> <Input placeholder=\"\u8bf7\u8f93\u5165\u670d\u52a1\u5668host\"/> </Form.Item> <Form.Item label=\"\u90ae\u7bb1\u79d8\u94a5\" name=\"password\" rules={[{required: true, message: '\u8bf7\u8f93\u5165\u90ae\u7bb1\u79d8\u94a5'}]}> <Input placeholder=\"\u8bf7\u8f93\u5165\u90ae\u7bb1\u79d8\u94a5\"/> </Form.Item> <Form.Item label=\"\u6536\u4ef6\u4eba\u540d\u79f0\" name=\"to\" rules={[{required: true, message: '\u8bf7\u8f93\u5165\u6536\u4ef6\u4eba\u540d\u79f0'}]}> <Input placeholder=\"\u8bf7\u8f93\u5165\u6536\u4ef6\u4eba\u540d\u79f0\"/> </Form.Item> </Form> </Col> <Col span={4}/> </Row> ) } yapi\u7ec4\u4ef6YapiConfig.jsx import {Button, Col, Form, Input, Row} from \"antd\"; import {CONFIG} from \"@/consts/config\"; export default ({form}) => { return ( <Row gutter={8}> <Col span={4}/> <Col span={16}> <Form form={form} {...CONFIG.LAYOUT}> <Form.Item label=\"token\" name=\"token\"> <Input placeholder=\"\u8bf7\u8f93\u5165yapi token\"/> </Form.Item> </Form> </Col> <Col span={4}/> </Row> ) } OssConfig.jsx import {Col, Form, Input, Row, Select} from \"antd\"; import {CONFIG} from \"@/consts/config\"; export default ({form}) => { return ( <Row gutter={8}> <Col span={4}/> <Col span={16}> <Form form={form} {...CONFIG.LAYOUT}> <Form.Item label=\"\u7c7b\u578b\" name=\"oss_type\" rules={[{required: true, message: '\u8bf7\u9009\u62e9oss\u7c7b\u578b'}]}> <Select placeholder=\"\u8bf7\u9009\u62e9oss\u7c7b\u578b\"> <Select.Option value=\"aliyun\">\u963f\u91cc\u4e91</Select.Option> <Select.Option value=\"gitee\">gitee</Select.Option> <Select.Option value=\"cos\">\u817e\u8baf\u4e91</Select.Option> <Select.Option value=\"qiniu\">\u4e03\u725b\u4e91</Select.Option> </Select> </Form.Item> <Form.Item label=\"access_id\" name=\"access_key_id\" rules={[{required: true, message: '\u8bf7\u8f93\u5165access_key_id'}]}> <Input placeholder=\"\u8bf7\u8f93\u5165access_key_id\"/> </Form.Item> <Form.Item label=\"access_secret\" name=\"access_key_secret\" rules={[{required: true, message: '\u8bf7\u8f93\u5165access_secret'}]}> <Input placeholder=\"\u8bf7\u8f93\u5165access_secret\"/> </Form.Item> <Form.Item label=\"bucket\" name=\"bucket\" rules={[{required: true, message: '\u8bf7\u8f93\u5165bucket'}]}> <Input placeholder=\"\u8bf7\u8f93\u5165bucket\"/> </Form.Item> <Form.Item label=\"endpoint\" name=\"endpoint\"> <Input placeholder=\"\u8bf7\u8f93\u5165endpoint, \u53ef\u4e0d\u586b\"/> </Form.Item> </Form> </Col> <Col span={4}/> </Row> ) } \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u4fdd\u5b58\u6309\u94ae\u6309\u4e0b\u7684\u65f6\u5019\uff0c\u9700\u8981 \u83b7\u53d6 3\u4e2a\u7ec4\u4ef6\u7684 \u6570\u636e \uff0c\u6240\u4ee5\u6bcf\u4e2a\u7ec4\u4ef6\u90fd\u63a5\u53d7\u4e86\u7236\u7ec4\u4ef6\u7684 form \u3002 forceRender\u53ef\u4ee5\u5f3a\u5236\u6e32\u67d3\u6bcf\u4e2atab\u9875\u9762\uff0c\u5c31\u7b97\u5b83\u6ca1\u6709\u88ab\u6253\u5f00\u8fc7\u3002 \u6700\u7ec8\u6548\u679c\u56fe \u7ed3\u8bed \u7cfb\u7edf\u8bbe\u7f6e\u6682\u65f6\u53ea\u6709\u8fd9 \u51e0\u5757 \u7684\u529f\u80fd\uff0c\u540e\u7eed\u6211\u4eec\u4e5f\u8bb8\u4f1a\u6709\u5305\u62ec \u4e3b\u9898 \uff0c jira\u8d26\u53f7\u5bc6\u7801 \u7b49\u7684\u914d\u7f6e\u9879\u3002","title":"103.\u7f16\u5199\u7cfb\u7edf\u8bbe\u7f6e\u9875\u9762"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28103%29%20%E7%BC%96%E5%86%99%E7%B3%BB%E7%BB%9F%E8%AE%BE%E7%BD%AE%E9%A1%B5%E9%9D%A2/#_1","text":"\u4e0a\u4e00\u8282\u6211\u4eec\u8bb2\u4e86 \u5b8c\u5584\u4e2a\u4eba\u8d44\u6599 \u529f\u80fd\uff0c\u5e76\u80fd\u591f\u5229\u7528oss\u5bf9\u6211\u4eec\u7684\u7528\u6237\u5934\u50cf\u8fdb\u884c\u7ba1\u7406\u3002 \u8fd8\u8bb0\u5f97\u6211\u4eec\u4e4b\u524d\u7684 configuration.json \u6587\u4ef6\uff08\u7cfb\u7edf\u914d\u7f6e\u6587\u4ef6\uff09\u5417\uff1f \u90a3\u8fd9\u4e00\u8282\u6211\u4eec\u5c31\u6765\u8bb2\u4e0b \u7cfb\u7edf\u914d\u7f6e \u529f\u80fd\uff0c\u4e5f\u5c31\u662f\u80fd\u591f\u5728\u524d\u7aef\u9875\u9762\u914d\u7f6econfiguration.json\u3002","title":"\u56de\u987e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28103%29%20%E7%BC%96%E5%86%99%E7%B3%BB%E7%BB%9F%E8%AE%BE%E7%BD%AE%E9%A1%B5%E9%9D%A2/#_2","text":"\u4e4b\u524d\u6211\u4eec\u662f\u7f16\u5199\u4e86 \u914d\u7f6e\u7ba1\u7406 \u529f\u80fd\u7684\uff0c\u867d\u7136\u6709\u66f4\u65b0\u7684\u64cd\u4f5c\uff0c\u4f46\u662f\u6ca1\u6709\u5b9e\u9645\u7684\u8fd0\u7528\u3002 oss\u90a3\u5757\u8bfb\u53d6oss\u7c7b\u578b\u548c\u8d26\u53f7\u5bc6\u7801\uff0c\u4ee5\u53ca\u90ae\u7bb1\u90e8\u5206\u6709\u7528\u5230\u3002 \u6709\u4e86\u5b9e\u9645\u7684\u65b9\u6cd5\uff0c\u90a3\u6211\u4eec\u7f16\u5199curd\u63a5\u53e3\u5c31\u7b80\u5355\u5f88\u591a\u3002","title":"\u56de\u5fc6\u7ec6\u8282"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28103%29%20%E7%BC%96%E5%86%99%E7%B3%BB%E7%BB%9F%E8%AE%BE%E7%BD%AE%E9%A1%B5%E9%9D%A2/#_3","text":"","title":"\u5b9e\u73b0"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28103%29%20%E7%BC%96%E5%86%99%E7%B3%BB%E7%BB%9F%E8%AE%BE%E7%BD%AE%E9%A1%B5%E9%9D%A2/#_4","text":"\u4fee\u6539\u7f16\u8f91\u90e8\u5206 \u7f16\u8f91\u7684\u5730\u65b9\uff0c\u6211\u4eec\u9700\u8981\u8c03\u6574\u4e00\u4e0b\uff0c\u5199\u5165json\u6587\u4ef6\u7684\u65f6\u5019\uff0c\u6ce8\u610fensure_ascii\u8fd9\u4e2a\u53c2\u6570\u7684\u5173\u95ed\uff0c\u4ee5\u53caindent(\u7f29\u8fdb)\u3002 \u65b0\u589eapp/routers/config/system.py\u6587\u4ef6 from fastapi import Depends from app.core.configuration import SystemConfiguration from app.handler.fatcory import PityResponse from app.routers import Permission from app.routers.config.gconfig import router from config import Config @router . get ( \"/system\" , description = \"\u83b7\u53d6\u7cfb\u7edf\u914d\u7f6e\" ) def get_system_config ( _ = Depends ( Permission ( Config . ADMIN ))): configuration = SystemConfiguration . get_config () return PityResponse . success ( configuration ) @router . post ( \"/system/update\" , description = \"\u66f4\u65b0\u7cfb\u7edf\u914d\u7f6e\" ) def get_system_config ( data : dict , _ = Depends ( Permission ( Config . ADMIN ))): SystemConfiguration . update_config ( data ) return PityResponse . success () \u6211\u4eec\u628a\u8def\u7531\u5199\u5728config\u4e0b\uff0c\u90a3\u4e48 /config/system \u662f\u83b7\u53d6\u914d\u7f6e\u63a5\u53e3\uff0c /config/system/update \u662f\u4fee\u6539\u63a5\u53e3\u3002 \u6700\u540e\u6211\u4eec\u5728app/ init .py\u628a\u7f16\u5199\u597d\u7684\u8def\u7531\u6ce8\u518c\u8fdb\u53bb\u5373\u53ef\u3002","title":"\u540e\u7aef\u903b\u8f91"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28103%29%20%E7%BC%96%E5%86%99%E7%B3%BB%E7%BB%9F%E8%AE%BE%E7%BD%AE%E9%A1%B5%E9%9D%A2/#_5","text":"\u7f16\u5199service\u5c42 \u5206\u522b\u7f16\u5199\u597d\u8c03\u7528\u83b7\u53d6/\u66f4\u65b0\u7684\u63a5\u53e3\u5373\u53ef\u3002 \u7f16\u5199model\u5c42 \u5728models/gconfig.js\u91cc\u9762\u65b0\u589e2\u4e2a\u65b9\u6cd5\uff0c\u8c03\u7528\u521a\u624dservice\u5c42\u7f16\u5199\u76842\u4e2a\u63a5\u53e3\u3002 \u7f16\u5199view\u5c42 \u9996\u5148\u6211\u4eec\u5c06\u9875\u9762\u62c6\u5206\u4e3a3\u4e2atab: oss email yapi \u8fd9\u6837\u5c31\u5bf9\u5e943\u4e2a\u5b50\u7ec4\u4ef6\uff0c\u5148\u770b\u4e0b\u7406\u60f3\u7684\u6548\u679c\u56fe: \u6240\u4ee5\u6211\u4eec\u65b0\u5efa\u4e00\u4e2a src/pages/Config/SystemConfig.jsx \u6587\u4ef6: import {PageContainer} from \"@ant-design/pro-layout\"; import {Button, Card, Col, Form, message, Row, Spin, Tabs} from \"antd\"; import OssConfig from \"@/components/System/OssConfig\"; import EmailConfig from \"@/components/System/EmailConfig\"; import YapiConfig from \"@/components/System/YapiConfig\"; import {SaveOutlined} from \"@ant-design/icons\"; import {connect} from \"umi\"; import {useEffect} from \"react\"; const {TabPane} = Tabs; const SystemConfig = ({dispatch, gconfig, loading}) => { const [form] = Form.useForm() const {configuration} = gconfig; const onSetField = () => { const {email, oss, yapi} = configuration; form.setFieldsValue(email); form.setFieldsValue(oss); form.setFieldsValue(yapi); } useEffect(() => { dispatch({ type: 'gconfig/fetchSystemConfig' }) }, []) useEffect(() => { // \u8fd9\u91cc\u6279\u91cf\u53d8\u66f4\u8868\u5355\u6570\u636e onSetField() }, [configuration]) const onSubmit = async () => { let values; try { values = await form.validateFields(); } catch (e) { message.info(\"\u6709\u5fc5\u586b\u5b57\u6bb5\u672a\u586b\u5199\uff0c\u8bf7\u68c0\u67e5\") return; } const requestData = { email: { \"sender\": values.sender, \"password\": values.password, \"host\": values.host, \"to\": values.to }, yapi: { \"token\": values.token, }, oss: { \"oss_type\": values.oss_type, \"access_key_id\": values.access_key_id, \"access_key_secret\": values.access_key_secret, \"bucket\": values.bucket, \"endpoint\": values.endpoint } } dispatch({ type: \"gconfig/updateConfiguration\", payload: requestData, }) } return ( <PageContainer title=\"\u7cfb\u7edf\u8bbe\u7f6e\" breadcrumb={null}> <Spin spinning={loading.effects['gconfig/updateConfiguration'] || loading.effects['gconfig/fetchSystemConfig']}> <Card> <Row> <Col span={24}> <Tabs tabPosition=\"left\"> <TabPane key=\"1\" tab=\"\u90ae\u4ef6\u8bbe\u7f6e\" forceRender> <EmailConfig form={form}/> </TabPane> <TabPane key=\"2\" tab=\"OSS\u8bbe\u7f6e\" forceRender> <OssConfig form={form}/> </TabPane> <TabPane key=\"3\" tab=\"Yapi\u8bbe\u7f6e\" forceRender> <YapiConfig form={form}/> </TabPane> </Tabs> </Col> </Row> <Row> <div style={{margin: '16px auto'}}> <Button type=\"primary\" icon={<SaveOutlined/>} onClick={onSubmit}>\u4fdd\u5b58</Button> </div> </Row> </Card> </Spin> </PageContainer> ) } export default connect(({gconfig, loading}) => ({gconfig, loading}))(SystemConfig); \u53ef\u4ee5\u770b\u5230\uff0c\u7ed3\u6784\u5f88\u7b80\u5355\uff0c\u4e3b\u8981\u662f\u4e00\u4e2a tabs \u52a0\u4e0a\u5177\u4f53tab\u9875\u91cc\u9762\u7684\u5185\u5bb9\uff0c\u6bcf\u4e2a\u7c7b\u578b\u7684tab\u53c8\u5bf9\u5e94\u4e86\u4e0d\u540c\u7684\u7ec4\u4ef6: \u5206\u522b\u5728src/components/System\u5efa\u7acb\u4e0b\u97623\u4e2a\u7ec4\u4ef6\u7684jsx: \u90ae\u4ef6\u7ec4\u4ef6EmailConfig.jsx: import {Col, Form, Input, Row} from \"antd\"; import {CONFIG} from \"@/consts/config\"; export default ({form}) => { return ( <Row gutter={8}> <Col span={4}/> <Col span={16}> <Form form={form} {...CONFIG.LAYOUT}> <Form.Item label=\"\u53d1\u4ef6\u4eba\" name=\"sender\" rules={[{required: true, message: '\u8bf7\u8f93\u5165\u53d1\u4ef6\u4eba\u90ae\u7bb1'}]}> <Input placeholder=\"\u8bf7\u8f93\u5165\u53d1\u4ef6\u4eba\u90ae\u7bb1\"/> </Form.Item> <Form.Item label=\"host\" name=\"host\" rules={[{required: true, message: '\u8bf7\u8f93\u5165\u670d\u52a1\u5668host'}]}> <Input placeholder=\"\u8bf7\u8f93\u5165\u670d\u52a1\u5668host\"/> </Form.Item> <Form.Item label=\"\u90ae\u7bb1\u79d8\u94a5\" name=\"password\" rules={[{required: true, message: '\u8bf7\u8f93\u5165\u90ae\u7bb1\u79d8\u94a5'}]}> <Input placeholder=\"\u8bf7\u8f93\u5165\u90ae\u7bb1\u79d8\u94a5\"/> </Form.Item> <Form.Item label=\"\u6536\u4ef6\u4eba\u540d\u79f0\" name=\"to\" rules={[{required: true, message: '\u8bf7\u8f93\u5165\u6536\u4ef6\u4eba\u540d\u79f0'}]}> <Input placeholder=\"\u8bf7\u8f93\u5165\u6536\u4ef6\u4eba\u540d\u79f0\"/> </Form.Item> </Form> </Col> <Col span={4}/> </Row> ) } yapi\u7ec4\u4ef6YapiConfig.jsx import {Button, Col, Form, Input, Row} from \"antd\"; import {CONFIG} from \"@/consts/config\"; export default ({form}) => { return ( <Row gutter={8}> <Col span={4}/> <Col span={16}> <Form form={form} {...CONFIG.LAYOUT}> <Form.Item label=\"token\" name=\"token\"> <Input placeholder=\"\u8bf7\u8f93\u5165yapi token\"/> </Form.Item> </Form> </Col> <Col span={4}/> </Row> ) } OssConfig.jsx import {Col, Form, Input, Row, Select} from \"antd\"; import {CONFIG} from \"@/consts/config\"; export default ({form}) => { return ( <Row gutter={8}> <Col span={4}/> <Col span={16}> <Form form={form} {...CONFIG.LAYOUT}> <Form.Item label=\"\u7c7b\u578b\" name=\"oss_type\" rules={[{required: true, message: '\u8bf7\u9009\u62e9oss\u7c7b\u578b'}]}> <Select placeholder=\"\u8bf7\u9009\u62e9oss\u7c7b\u578b\"> <Select.Option value=\"aliyun\">\u963f\u91cc\u4e91</Select.Option> <Select.Option value=\"gitee\">gitee</Select.Option> <Select.Option value=\"cos\">\u817e\u8baf\u4e91</Select.Option> <Select.Option value=\"qiniu\">\u4e03\u725b\u4e91</Select.Option> </Select> </Form.Item> <Form.Item label=\"access_id\" name=\"access_key_id\" rules={[{required: true, message: '\u8bf7\u8f93\u5165access_key_id'}]}> <Input placeholder=\"\u8bf7\u8f93\u5165access_key_id\"/> </Form.Item> <Form.Item label=\"access_secret\" name=\"access_key_secret\" rules={[{required: true, message: '\u8bf7\u8f93\u5165access_secret'}]}> <Input placeholder=\"\u8bf7\u8f93\u5165access_secret\"/> </Form.Item> <Form.Item label=\"bucket\" name=\"bucket\" rules={[{required: true, message: '\u8bf7\u8f93\u5165bucket'}]}> <Input placeholder=\"\u8bf7\u8f93\u5165bucket\"/> </Form.Item> <Form.Item label=\"endpoint\" name=\"endpoint\"> <Input placeholder=\"\u8bf7\u8f93\u5165endpoint, \u53ef\u4e0d\u586b\"/> </Form.Item> </Form> </Col> <Col span={4}/> </Row> ) } \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u4fdd\u5b58\u6309\u94ae\u6309\u4e0b\u7684\u65f6\u5019\uff0c\u9700\u8981 \u83b7\u53d6 3\u4e2a\u7ec4\u4ef6\u7684 \u6570\u636e \uff0c\u6240\u4ee5\u6bcf\u4e2a\u7ec4\u4ef6\u90fd\u63a5\u53d7\u4e86\u7236\u7ec4\u4ef6\u7684 form \u3002 forceRender\u53ef\u4ee5\u5f3a\u5236\u6e32\u67d3\u6bcf\u4e2atab\u9875\u9762\uff0c\u5c31\u7b97\u5b83\u6ca1\u6709\u88ab\u6253\u5f00\u8fc7\u3002","title":"\u524d\u7aef\u903b\u8f91"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28103%29%20%E7%BC%96%E5%86%99%E7%B3%BB%E7%BB%9F%E8%AE%BE%E7%BD%AE%E9%A1%B5%E9%9D%A2/#_6","text":"","title":"\u6700\u7ec8\u6548\u679c\u56fe"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28103%29%20%E7%BC%96%E5%86%99%E7%B3%BB%E7%BB%9F%E8%AE%BE%E7%BD%AE%E9%A1%B5%E9%9D%A2/#_7","text":"\u7cfb\u7edf\u8bbe\u7f6e\u6682\u65f6\u53ea\u6709\u8fd9 \u51e0\u5757 \u7684\u529f\u80fd\uff0c\u540e\u7eed\u6211\u4eec\u4e5f\u8bb8\u4f1a\u6709\u5305\u62ec \u4e3b\u9898 \uff0c jira\u8d26\u53f7\u5bc6\u7801 \u7b49\u7684\u914d\u7f6e\u9879\u3002","title":"\u7ed3\u8bed"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28104%29%20%E5%AE%9E%E7%8E%B0%E7%94%A8%E4%BE%8B%E7%9B%AE%E5%BD%95case%E5%88%86%E5%B1%8F%E5%8A%9F%E8%83%BD/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \u56de\u987e \u4e0a\u4e00\u8282\uff0c\u54b1\u4eec\u7f16\u5199\u4e86 \u7cfb\u7edf\u8bbe\u7f6e \u9875\u9762\u7684\u76f8\u5173\u529f\u80fd\uff0c\u8fd9\u4e00\u8282\u5462\uff0c\u6211\u4eec\u6765\u4f18\u5316\u4e00\u4e0b\u7528\u4f8b\u76ee\u5f55\u548c\u7528\u4f8b\u9875\u9762\u7684\u663e\u793a\u3002 \u6211\u4eec\u6765\u7814\u7a76\u4e0b\u600e\u4e48\u5b9e\u73b0\u4e00\u4e2a \u5206\u5c4f\u529f\u80fd \u3002 \u4ec0\u4e48\u662f\u5206\u5c4f \u6211\u4eec\u73b0\u5728\u7684 \u7528\u4f8b\u5217\u8868\u9875 \u5c31\u4e0d\u652f\u6301\u5206\u5c4f\uff0c\u53ea\u56e0\u5de6\u53f3\u4fa7 \u5361\u7247 \u7684\u5bbd\u5ea6\u90fd\u662f\u76f8\u5bf9\u56fa\u5b9a\u7684\uff0c\u4e5f\u5c31\u662f\u4e0d\u80fd\u5de6\u53f3\u62d6\u62fd\u653e\u5927/\u7f29\u5c0f\u7684\u3002 \u5982\u56fe\u6240\u793a\uff0c\u5047\u8bbe\u73b0\u5728\u6211\u7684\u76ee\u5f55\u540d\u5b57\u5f88\u957f\uff0c\u90a3\u53ef\u80fd \u663e\u793a\u6548\u679c \u5c31\u4f1a\u5f88\u5dee\u3002\uff08\u56e0\u4e3a\u5de6\u8fb9\u5bbd\u5ea6\u4e0d\u591f\u7528\u5440\uff09 \u518d\u6765\u770b\u770b\u5206\u5c4f\u4e86\u7684\u7ec4\u4ef6\uff0c\u6211\u4eec\u7528\u4e00\u4e2agif\u6765\u5c55\u793a: \u7ec4\u4ef6\u8c03\u7814 \u8d77\u521d\u8e29\u4e86\u4e0d\u5c11\u5751\uff0c\u4e5f\u4e0d\u77e5\u9053\u8be5\u600e\u4e48\u5728 github \u641c\u7d22\u5bf9\u5e94\u7684\u7ec4\u4ef6\uff0c\u5f53\u7136\uff0c\u8981\u81ea\u5df1\u5199\u662f\u4e0d\u53ef\u80fd\u7684\uff08\u6bd5\u7adf\u4e0d\u4f1a\uff09\u3002 \u540e\u6765\u5728ant.design\u5b98\u7f51\u770b\u5230\u4e86\u4e00\u4e9b\u63a8\u8350\u7684\u7ec4\u4ef6: \u8fd9\u5c31\u662f\u751f\u6001\u7684\u529b\u91cf\u5417\uff01 \u63a5\u7740\u6211\u4eec\u4ece\u91cc\u9762\u627e\u5230\u4e86\u4e0d\u8d77\u773c\u7684\u5206\u5c4f\u7ec4\u4ef6: \u770b\u770b\u5b98\u7f51\u7684demo \u5b98\u7f51\u7684demo\u7ed9\u7684\u771f\u7684\u662f\uff0c\u76f8\u5f53\u7684 \u7c97\u7cd9 \uff0c\u8fdeimport\u90fd\u6ca1\u6709\u5199\u3002\u8fd9\u4e0d\u7981\u8ba9\u6211\u60f3\u8d77\u67d0\u4e2astar\u7b2c\u4e00\u7684Java\u64cd\u4f5cexcel\u7684\u5e93\uff0c\u8fdemaven/gradle\u4f9d\u8d56\u90fd\u6ca1\u6709\u7ed9\u51fa\u6765\u3002 \u7b80\u5355\u8bb2\u4e0b\u4ed6\u7684api: split \u5206\u5272\u7684\u6a21\u5f0f\uff0c\u6709vertical\u548chorizontal\uff0c\u5373\u5782\u76f4\u548c\u6c34\u5e73\uff0c\u5373\u5de6\u53f3\u5206\u5c4f\u548c\u4e0a\u4e0b\u5206\u5c4f\uff0c\u6211\u4eec\u8fd9\u91cc\u9700\u8981\u91c7\u7528vertical\u3002 minSize \u6700\u5c0f\u5c3a\u5bf8\uff0c\u4e00\u822c\u4ee5\u5de6\u4fa7\u7684div\u4e3a\u4e3b\u3002 defaultSize \u9ed8\u8ba4\u5c3a\u5bf8 maxSize \u6700\u5927\u5c3a\u5bf8\uff0c\u4e5f\u5c31\u662f\u5de6\u8fb9div\u53ef\u4ee5\u62d6\u5230\u7684\u6700\u5927\u5bbd\u5ea6\u3002 \u6ce8\u610f\u4e8b\u9879 \u5728\u56fe\u4e2d\uff0c\u53ef\u4ee5\u770b\u5230SplitPane\u5305\u88f9\u76842\u4e2adiv\u8fdb\u884c\u4e86\u5206\u5c4f\u64cd\u4f5c\uff0c\u90a3\u6211\u4eec\u8981\u5bf9 antd \u7684Col\u8fdb\u884c\u540c\u6837\u7684\u64cd\u4f5c\u53ef\u884c\u5417\uff1f \u535a\u4e3b\u4eb2\u81ea\u8bd5\u4e86\u4e00\u4e0b\uff0c\u4e0d\u53ef\u4ee5\uff0c\u8fd9\u6837\u4f1a\u5bfc\u81f4 \u9875\u9762\u9519\u4e71 \u3002\u6240\u4ee5\u6211\u4eec\u8fd8\u662f\u6309\u7167\u4ed6\u7684\u610f\u601d\uff0c\u4f7f\u7528div\u6807\u7b7e\u3002 \u8fd0\u7528\u5230pity\u4e2d \u5b89\u88c5\u4f9d\u8d56 npm install --save react-split-pane \u6211\u4eec\u4e3b\u8981\u662f\u60f3\u8ba9case\u548c\u76ee\u5f55\u8fdb\u884c\u5206\u79bb\uff0c\u6240\u4ee5\u6211\u4eec\u627e\u5230\u76ee\u5f55\u90a3\u5757jsx: src/pages/ApiTest/TestCaseDirectory.jsx\u8c03\u6574\u4ee5\u4e0b\u5185\u5bb9: \u65b0\u589e\u5f15\u7528 import SplitPane from 'react-split-pane'; \u4fee\u6539case\u548c\u7528\u4f8b\u89c6\u56fe \u627e\u5230\u6b64\u5904\u7684Row\uff0c\u5e76\u5728\u4e0b\u9762\u52a0\u5165SplitPane\u7ec4\u4ef6\uff0c\u628a2\u4e2aCol\u7684\u7ec4\u4ef6\u6539\u4e3a div \u3002 \u6211\u4eec\u770b\u4e0b\u6548\u679c: \u53ef\u4ee5\u770b\u5230\u6837\u5f0f\u53d8\u4e86\uff0c\u4f46\u662f\u5b9e\u9645\u4e0a\u5e76\u672a\u751f\u6548\u3002 \u6392\u67e5\u95ee\u9898 \u6240\u4ee5\u8fd9\u5c31\u662f\u6211\u8bf4\u5b98\u7f51\u7684demo\u4e0d\u662f\u592a\u597d\uff0c\u56e0\u4e3a\u6211\u4eec\u8fd8\u9700\u8981\u989d\u5916\u5199\u4e00\u4e9bcss\u6837\u5f0f\u3002 \u7f16\u5199src/pages/ApiTest/TestCaseDirectory.less\u6587\u4ef6(\u6ca1\u6709\u5219\u65b0\u5efa) . Resizer { background : #000 ; opacity : 0.2 ; z-index : 1 ; -moz- box-sizing : border-box ; -webkit- box-sizing : border-box ; box-sizing : border-box ; -moz- background-clip : padding ; -webkit- background-clip : padding ; background-clip : padding-box ; } . Resizer : hover { -webkit- transition : all 2 s ease ; transition : all 2 s ease ; } . Resizer . horizontal { height : 11 px ; margin : -5 px 0 ; border-top : 5 px solid rgba ( 255 , 255 , 255 , 0 ); border-bottom : 5 px solid rgba ( 255 , 255 , 255 , 0 ); cursor : row-resize ; width : 100 % ; } . Resizer . horizontal : hover { border-top : 5 px solid rgba ( 0 , 0 , 0 , 0.5 ); border-bottom : 5 px solid rgba ( 0 , 0 , 0 , 0.5 ); } . Resizer . vertical { width : 11 px ; margin : 0 -5 px ; border-left : 5 px solid rgba ( 255 , 255 , 255 , 0 ); border-right : 5 px solid rgba ( 255 , 255 , 255 , 0 ); cursor : col-resize ; } . Resizer . vertical : hover { border-left : 5 px solid rgba ( 0 , 0 , 0 , 0.5 ); border-right : 5 px solid rgba ( 0 , 0 , 0 , 0.5 ); } . Resizer . disabled { cursor : not-allowed ; } . Resizer . disabled : hover { border-color : transparent ; } \u5f15\u5165 \u6700\u7ec8\u6548\u679c \u6709\u4e86\u8fd9\u4e2a\u529f\u80fd\u4e4b\u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u8f7b\u677e\u7f16\u5199 \u7c7b\u4f3c \u7684\u7ec4\u4ef6\u4e86\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u8f7b\u677e\u5206\u5272\u5176\u4ed6\u9875\u9762\u7684div\u5566\u3002","title":"104.\u5b9e\u73b0\u7528\u4f8b\u76ee\u5f55case\u5206\u5c4f\u529f\u80fd"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28104%29%20%E5%AE%9E%E7%8E%B0%E7%94%A8%E4%BE%8B%E7%9B%AE%E5%BD%95case%E5%88%86%E5%B1%8F%E5%8A%9F%E8%83%BD/#_1","text":"\u4e0a\u4e00\u8282\uff0c\u54b1\u4eec\u7f16\u5199\u4e86 \u7cfb\u7edf\u8bbe\u7f6e \u9875\u9762\u7684\u76f8\u5173\u529f\u80fd\uff0c\u8fd9\u4e00\u8282\u5462\uff0c\u6211\u4eec\u6765\u4f18\u5316\u4e00\u4e0b\u7528\u4f8b\u76ee\u5f55\u548c\u7528\u4f8b\u9875\u9762\u7684\u663e\u793a\u3002 \u6211\u4eec\u6765\u7814\u7a76\u4e0b\u600e\u4e48\u5b9e\u73b0\u4e00\u4e2a \u5206\u5c4f\u529f\u80fd \u3002","title":"\u56de\u987e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28104%29%20%E5%AE%9E%E7%8E%B0%E7%94%A8%E4%BE%8B%E7%9B%AE%E5%BD%95case%E5%88%86%E5%B1%8F%E5%8A%9F%E8%83%BD/#_2","text":"\u6211\u4eec\u73b0\u5728\u7684 \u7528\u4f8b\u5217\u8868\u9875 \u5c31\u4e0d\u652f\u6301\u5206\u5c4f\uff0c\u53ea\u56e0\u5de6\u53f3\u4fa7 \u5361\u7247 \u7684\u5bbd\u5ea6\u90fd\u662f\u76f8\u5bf9\u56fa\u5b9a\u7684\uff0c\u4e5f\u5c31\u662f\u4e0d\u80fd\u5de6\u53f3\u62d6\u62fd\u653e\u5927/\u7f29\u5c0f\u7684\u3002 \u5982\u56fe\u6240\u793a\uff0c\u5047\u8bbe\u73b0\u5728\u6211\u7684\u76ee\u5f55\u540d\u5b57\u5f88\u957f\uff0c\u90a3\u53ef\u80fd \u663e\u793a\u6548\u679c \u5c31\u4f1a\u5f88\u5dee\u3002\uff08\u56e0\u4e3a\u5de6\u8fb9\u5bbd\u5ea6\u4e0d\u591f\u7528\u5440\uff09 \u518d\u6765\u770b\u770b\u5206\u5c4f\u4e86\u7684\u7ec4\u4ef6\uff0c\u6211\u4eec\u7528\u4e00\u4e2agif\u6765\u5c55\u793a:","title":"\u4ec0\u4e48\u662f\u5206\u5c4f"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28104%29%20%E5%AE%9E%E7%8E%B0%E7%94%A8%E4%BE%8B%E7%9B%AE%E5%BD%95case%E5%88%86%E5%B1%8F%E5%8A%9F%E8%83%BD/#_3","text":"\u8d77\u521d\u8e29\u4e86\u4e0d\u5c11\u5751\uff0c\u4e5f\u4e0d\u77e5\u9053\u8be5\u600e\u4e48\u5728 github \u641c\u7d22\u5bf9\u5e94\u7684\u7ec4\u4ef6\uff0c\u5f53\u7136\uff0c\u8981\u81ea\u5df1\u5199\u662f\u4e0d\u53ef\u80fd\u7684\uff08\u6bd5\u7adf\u4e0d\u4f1a\uff09\u3002 \u540e\u6765\u5728ant.design\u5b98\u7f51\u770b\u5230\u4e86\u4e00\u4e9b\u63a8\u8350\u7684\u7ec4\u4ef6: \u8fd9\u5c31\u662f\u751f\u6001\u7684\u529b\u91cf\u5417\uff01 \u63a5\u7740\u6211\u4eec\u4ece\u91cc\u9762\u627e\u5230\u4e86\u4e0d\u8d77\u773c\u7684\u5206\u5c4f\u7ec4\u4ef6:","title":"\u7ec4\u4ef6\u8c03\u7814"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28104%29%20%E5%AE%9E%E7%8E%B0%E7%94%A8%E4%BE%8B%E7%9B%AE%E5%BD%95case%E5%88%86%E5%B1%8F%E5%8A%9F%E8%83%BD/#demo","text":"\u5b98\u7f51\u7684demo\u7ed9\u7684\u771f\u7684\u662f\uff0c\u76f8\u5f53\u7684 \u7c97\u7cd9 \uff0c\u8fdeimport\u90fd\u6ca1\u6709\u5199\u3002\u8fd9\u4e0d\u7981\u8ba9\u6211\u60f3\u8d77\u67d0\u4e2astar\u7b2c\u4e00\u7684Java\u64cd\u4f5cexcel\u7684\u5e93\uff0c\u8fdemaven/gradle\u4f9d\u8d56\u90fd\u6ca1\u6709\u7ed9\u51fa\u6765\u3002 \u7b80\u5355\u8bb2\u4e0b\u4ed6\u7684api: split \u5206\u5272\u7684\u6a21\u5f0f\uff0c\u6709vertical\u548chorizontal\uff0c\u5373\u5782\u76f4\u548c\u6c34\u5e73\uff0c\u5373\u5de6\u53f3\u5206\u5c4f\u548c\u4e0a\u4e0b\u5206\u5c4f\uff0c\u6211\u4eec\u8fd9\u91cc\u9700\u8981\u91c7\u7528vertical\u3002 minSize \u6700\u5c0f\u5c3a\u5bf8\uff0c\u4e00\u822c\u4ee5\u5de6\u4fa7\u7684div\u4e3a\u4e3b\u3002 defaultSize \u9ed8\u8ba4\u5c3a\u5bf8 maxSize \u6700\u5927\u5c3a\u5bf8\uff0c\u4e5f\u5c31\u662f\u5de6\u8fb9div\u53ef\u4ee5\u62d6\u5230\u7684\u6700\u5927\u5bbd\u5ea6\u3002","title":"\u770b\u770b\u5b98\u7f51\u7684demo"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28104%29%20%E5%AE%9E%E7%8E%B0%E7%94%A8%E4%BE%8B%E7%9B%AE%E5%BD%95case%E5%88%86%E5%B1%8F%E5%8A%9F%E8%83%BD/#_4","text":"\u5728\u56fe\u4e2d\uff0c\u53ef\u4ee5\u770b\u5230SplitPane\u5305\u88f9\u76842\u4e2adiv\u8fdb\u884c\u4e86\u5206\u5c4f\u64cd\u4f5c\uff0c\u90a3\u6211\u4eec\u8981\u5bf9 antd \u7684Col\u8fdb\u884c\u540c\u6837\u7684\u64cd\u4f5c\u53ef\u884c\u5417\uff1f \u535a\u4e3b\u4eb2\u81ea\u8bd5\u4e86\u4e00\u4e0b\uff0c\u4e0d\u53ef\u4ee5\uff0c\u8fd9\u6837\u4f1a\u5bfc\u81f4 \u9875\u9762\u9519\u4e71 \u3002\u6240\u4ee5\u6211\u4eec\u8fd8\u662f\u6309\u7167\u4ed6\u7684\u610f\u601d\uff0c\u4f7f\u7528div\u6807\u7b7e\u3002","title":"\u6ce8\u610f\u4e8b\u9879"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28104%29%20%E5%AE%9E%E7%8E%B0%E7%94%A8%E4%BE%8B%E7%9B%AE%E5%BD%95case%E5%88%86%E5%B1%8F%E5%8A%9F%E8%83%BD/#pity","text":"\u5b89\u88c5\u4f9d\u8d56 npm install --save react-split-pane \u6211\u4eec\u4e3b\u8981\u662f\u60f3\u8ba9case\u548c\u76ee\u5f55\u8fdb\u884c\u5206\u79bb\uff0c\u6240\u4ee5\u6211\u4eec\u627e\u5230\u76ee\u5f55\u90a3\u5757jsx: src/pages/ApiTest/TestCaseDirectory.jsx\u8c03\u6574\u4ee5\u4e0b\u5185\u5bb9: \u65b0\u589e\u5f15\u7528 import SplitPane from 'react-split-pane'; \u4fee\u6539case\u548c\u7528\u4f8b\u89c6\u56fe \u627e\u5230\u6b64\u5904\u7684Row\uff0c\u5e76\u5728\u4e0b\u9762\u52a0\u5165SplitPane\u7ec4\u4ef6\uff0c\u628a2\u4e2aCol\u7684\u7ec4\u4ef6\u6539\u4e3a div \u3002 \u6211\u4eec\u770b\u4e0b\u6548\u679c: \u53ef\u4ee5\u770b\u5230\u6837\u5f0f\u53d8\u4e86\uff0c\u4f46\u662f\u5b9e\u9645\u4e0a\u5e76\u672a\u751f\u6548\u3002","title":"\u8fd0\u7528\u5230pity\u4e2d"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28104%29%20%E5%AE%9E%E7%8E%B0%E7%94%A8%E4%BE%8B%E7%9B%AE%E5%BD%95case%E5%88%86%E5%B1%8F%E5%8A%9F%E8%83%BD/#_5","text":"\u6240\u4ee5\u8fd9\u5c31\u662f\u6211\u8bf4\u5b98\u7f51\u7684demo\u4e0d\u662f\u592a\u597d\uff0c\u56e0\u4e3a\u6211\u4eec\u8fd8\u9700\u8981\u989d\u5916\u5199\u4e00\u4e9bcss\u6837\u5f0f\u3002 \u7f16\u5199src/pages/ApiTest/TestCaseDirectory.less\u6587\u4ef6(\u6ca1\u6709\u5219\u65b0\u5efa) . Resizer { background : #000 ; opacity : 0.2 ; z-index : 1 ; -moz- box-sizing : border-box ; -webkit- box-sizing : border-box ; box-sizing : border-box ; -moz- background-clip : padding ; -webkit- background-clip : padding ; background-clip : padding-box ; } . Resizer : hover { -webkit- transition : all 2 s ease ; transition : all 2 s ease ; } . Resizer . horizontal { height : 11 px ; margin : -5 px 0 ; border-top : 5 px solid rgba ( 255 , 255 , 255 , 0 ); border-bottom : 5 px solid rgba ( 255 , 255 , 255 , 0 ); cursor : row-resize ; width : 100 % ; } . Resizer . horizontal : hover { border-top : 5 px solid rgba ( 0 , 0 , 0 , 0.5 ); border-bottom : 5 px solid rgba ( 0 , 0 , 0 , 0.5 ); } . Resizer . vertical { width : 11 px ; margin : 0 -5 px ; border-left : 5 px solid rgba ( 255 , 255 , 255 , 0 ); border-right : 5 px solid rgba ( 255 , 255 , 255 , 0 ); cursor : col-resize ; } . Resizer . vertical : hover { border-left : 5 px solid rgba ( 0 , 0 , 0 , 0.5 ); border-right : 5 px solid rgba ( 0 , 0 , 0 , 0.5 ); } . Resizer . disabled { cursor : not-allowed ; } . Resizer . disabled : hover { border-color : transparent ; } \u5f15\u5165","title":"\u6392\u67e5\u95ee\u9898"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28104%29%20%E5%AE%9E%E7%8E%B0%E7%94%A8%E4%BE%8B%E7%9B%AE%E5%BD%95case%E5%88%86%E5%B1%8F%E5%8A%9F%E8%83%BD/#_6","text":"\u6709\u4e86\u8fd9\u4e2a\u529f\u80fd\u4e4b\u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u8f7b\u677e\u7f16\u5199 \u7c7b\u4f3c \u7684\u7ec4\u4ef6\u4e86\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u8f7b\u677e\u5206\u5272\u5176\u4ed6\u9875\u9762\u7684div\u5566\u3002","title":"\u6700\u7ec8\u6548\u679c"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28105%29%20%E7%BC%96%E5%86%99%E6%B6%88%E6%81%AF%E9%80%9A%E7%9F%A5%E5%8A%9F%E8%83%BD%281%29/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u7f16\u5199\u4e86\u7528\u4f8b/\u76ee\u5f55\u5206\u5c4f\u7684\u529f\u80fd\uff0c\u5c5e\u4e8e\u63d0\u5347 \u7528\u6237\u4f53\u9a8c \u76f8\u5173\u7684\u5185\u5bb9\u3002\u63a5\u4e0b\u6765\u6211\u4eec\u8981\u57fa\u4e8ewebsocket\uff0c\u5b8c\u6210\u6d88\u606f\u4e2d\u5fc3\u76f8\u5173\u529f\u80fd\u3002\u8fd9\u5757\u535a\u4e3b\u4e5f\u6ca1\u4ec0\u4e48\u7ecf\u9a8c\uff0c\u5982\u679c\u6709\u4e0d\u5bf9\u7684\u5730\u65b9\u6b22\u8fce\u5927\u5bb6 \u6307\u6b63 \u3002 \u672c\u6a21\u5757\u7531\u4e8e\u7bc7\u5e45\u95ee\u9898\uff0c\u4f1a\u5206\u4e3a3~5\u7bc7\u3002 \u9700\u6c42\u80cc\u666f \u6211\u4eec\u7684\u4ea7\u54c1\u8981\u60f3\u505a\u4e00\u4e9b\u4e1c\u897f\uff0c\u5fc5\u987b\u5f97\u6709\u4e00\u4e2a\u80cc\u666f\u5728\u91cc\u5934\u3002\u6bd4\u5982\u6211\u4e3a\u5565\u8981\u505a\u8fd9\u4e2a\u529f\u80fd\uff0c\u6709\u4ec0\u4e48\u7528\u5904\u3002\u867d\u7136\u54b1\u4eec\u6bd4\u4e0d\u4e0a\u4e13\u4e1a\u7684\u4ea7\u54c1\uff0c\u4f46\u662f\u4e5f\u53ef\u4ee5\u5728\u505a\u9879\u76ee\u7684\u8fc7\u7a0b\u4e2d\u57f9\u517b\u81ea\u5df1\u8fd9\u5757 \u80fd\u529b \u3002 \u6211\u4e2a\u4eba\u7684\u60f3\u6cd5\u662f\uff0c\u5f53\u6211\u4eec\u6267\u884ccase\uff0c\u6216\u8005\u6307\u6d3e\u4e00\u4e9b\u7528\u4f8b\u7ed9\u4ed6\u4eba\u7f16\u5199\uff0c\u6216\u8005\u672a\u6765\u6709\u4e00\u4e9b\u4efb\u52a1\u5b89\u6392\u7684\u65f6\u5019\uff0c\u6211\u4eec\u53ef\u4ee5\u5148\u6307\u6d3e\uff0c\u63a5\u7740 \u63a8\u9001 \u7ed9\u5bf9\u65b9\uff0c\u8ba9\u5bf9\u65b9\u80fd\u77e5\u9053\u4f60\u7684\u5b89\u6392\u3002 \u4f46\u53ef\u80fd\u76ee\u524d\u6211\u4eec\u6700\u9700\u8981\u7684\u5c31\u662f\uff0c\u6d4b\u8bd5\u4efb\u52a1\u5b8c\u6210\u4ee5\u540e\u7684\u901a\u77e5\u529f\u80fd\u3002\u6240\u4ee5\u6211\u4eec\u9700\u8981\u8c03\u7814\u4e00\u4e0b\u7b80\u5355\u7684\u9875\u9762\u3002 \u53c2\u8003\u4e0b\u8bed\u96c0\u7684\u9875\u9762: \u53ef\u4ee5\u770b\u5230\u5341\u5206\u6e05\u723d\uff0c\u5de6\u4fa7tab\u663e\u793a\u6d88\u606f\u7c7b\u578b\uff0c\u53f3\u4fa7tab\u663e\u793a\u5df2\u8bfb/\u672a\u8bfb\u6d88\u606f\u6570\u91cf\u548c\u5217\u8868\u3002 \u7f16\u5199\u6d88\u606f\u8868 \u6d88\u606f\u7684\u8bdd\uff0c\u6211\u4eec\u9700\u8981\u5148\u5b9a\u4e49\u4e00\u4e0b\u6d88\u606f\u8868\u3002\u6765\u770b\u770b\u6709\u54ea\u4e9b\u5b57\u6bb5\u5427: from sqlalchemy import SMALLINT , Column , VARCHAR , INT from app.models.basic import PityBase class PityNotification ( PityBase ): msg_type = Column ( SMALLINT , comment = \"\u6d88\u606f\u7c7b\u578b 0: \u7528\u4f8b\u6267\u884c 1: \u4efb\u52a1\u5206\u914d\" ) msg_content = Column ( VARCHAR ( 200 ), comment = \"\u6d88\u606f\u5185\u5bb9\" , nullable = True ) msg_link = Column ( VARCHAR ( 128 ), comment = \"\u6d88\u606f\u94fe\u63a5\" ) msg_status = Column ( SMALLINT , comment = \"\u6d88\u606f\u72b6\u6001 0: \u672a\u8bfb 1: \u5df2\u8bfb\" ) sender = Column ( INT , comment = \"\u6d88\u606f\u53d1\u9001\u4eba, 0\u5219\u662fCPU \u975e0\u5219\u662f\u5176\u4ed6\u7528\u6237\" ) receiver = Column ( INT , comment = \"\u6d88\u606f\u63a5\u6536\u4eba, 0\u4e3a\u5e7f\u64ad\u6d88\u606f\" ) __tablename__ = \"pity_notification\" def __init__ ( self , msg_type , msg_content , sender , receiver , user , msg_link = None , msg_status = 0 ): super () . __init__ ( user ) self . msg_type = msg_type self . receiver = receiver self . msg_content = msg_content self . sender = sender self . msg_link = msg_link self . msg_status = msg_status \u5b9a\u4e49\u4e86\u4e00\u4e2a\u901a\u77e5\u8868\uff0c\u91cc\u9762\u6709\u51e0\u4e2a\u6838\u5fc3\u5b57\u6bb5: \u7c7b\u578b\uff08\u9884\u7559\u5b57\u6bb5\uff09 \u5185\u5bb9 \u94fe\u63a5\uff08\u65b9\u4fbf\u7528\u6237\u8df3\u8f6c\uff0c\u53ef\u4e3a\u7a7a\uff09 \u72b6\u6001 \u53d1\u9001\u4eba \u63a5\u6536\u4eba\uff08\u8fd9\u91cc\u6709\u4e2a\u5e7f\u64ad\u6d88\u606f\u7684\u533a\u5206\uff09 \u7f16\u5199\u540e\u7aef\u67e5\u8be2/\u5df2\u8bfb\u529f\u80fd \u4e00\u822c\u6211\u4eec\u5728\u9875\u9762\u4e0a\u7684\u64cd\u4f5c\uff0c\u4e5f\u5c31\u662f \u67e5\u8be2 \u548c \u5df2\u8bfb \u529f\u80fd\uff0c\u6240\u4ee5\u5bf9\u5916\u66b4\u9732\u7684\u63a5\u53e3\uff0c\u6682\u65f6\u53ea\u8003\u8651\u8fd92\u5757\u5c31\u53ef\u4ee5\u4e86\u3002 \u5982\u679c\u4e0d\u5b58\u5728\u7684\u76ee\u5f55\u548c\u6587\u4ef6\uff0c\u5927\u5bb6\u5c31\u65b0\u5efa\uff0c\u5426\u5219\u5c31\u4fee\u6539\u3002\u653e\u4e0a\u8def\u5f84\u7684\u539f\u56e0\u4fbf\u662f\u5982\u6b64\u3002 \u7f16\u5199Dao\u65b9\u6cd5(app/crud/notification/NotificationDao.py) from app.crud import Mapper from app.models.notification import PityNotification from app.utils.decorator import dao from app.utils.logger import Log @dao ( PityNotification , Log ( \"PityNotificationDao\" )) class PityNotificationDao ( Mapper ): pass \u7531\u4e8e\u4e4b\u524d\u7f16\u5199\u4e86\u4e00\u4e9b\u516c\u6709\u65b9\u6cd5\uff0c\u6240\u4ee5\u73b0\u5728\u5f88\u65b9\u4fbf\uff0c\u6211\u4eec\u4e0d\u518d\u9700\u8981\u5199\u5f88\u91cd\u590d\u7684\u4ee3\u7801\u4e86\u3002 \u7f16\u5199\u63a5\u53e3 \u5728\u6b64\u4e4b\u524d\uff0c\u6211\u4eec\u9700\u8981\u4e3aapp/crud/ init .py/Mapper\u7c7b\u65b0\u589e\u4e00\u4e2aupdate\u65b9\u6cd5: @classmethod async def update_by_map ( cls , * condition , ** kwargs ): try : async with async_session () as session : async with session . begin (): sql = update ( cls . model ) . where ( * condition ) . values ( ** kwargs , updated_at = datetime . now ()) await session . execute ( sql ) except Exception as e : cls . log . error ( f \"\u66f4\u65b0\u6570\u636e\u5931\u8d25: { e } \" ) raise Exception ( \"\u66f4\u65b0\u6570\u636e\u5931\u8d25\" ) \u4ee5\u5f80\u6211\u4eec\u7f16\u5199\u7684update\uff0c\u90fd\u662f\u5148\u67e5\u8be2\u6570\u636e\uff0c\u5982\u679c\u6ca1\u6709\u6570\u636e\u5219\u8fd4\u56de\u5f02\u5e38\uff0c\u5982\u679c\u6709\u5219\u66f4\u65b0\u6570\u636e\u3002 \u8fd9\u6837\u505a\u7684\u7f3a\u70b9\u662f\u591a\u67e5\u8be2\u4e86\u4e00\u6b21\u6570\u636e\u5e93\uff0c\u4f18\u70b9\u662f \u80fd\u591f\u9632\u6b62\u610f\u5916\u6570\u636e \u3002 \u4e0a\u8ff0\u7684\u65b9\u6cd5\uff0c\u662f\u6839\u636econdition(\u67e5\u8be2\u6761\u4ef6)\u53cakwargs(\u53d8\u66f4\u5b57\u5178)\u66f4\u65b0\u3002\u8c03\u7528\u7684\u4e5f\u90fd\u662fsqlalchemy\u57fa\u672c\u7684\u65b9\u6cd5\u3002 \u540e\u7eed\u6709\u7a7a\u6211\u4e5f\u4f1a\u51fa\u4e00\u4e2asqlalchemy crud\u76f8\u5173demo\uff0c\u5305\u62ecjoin\uff08\u53ea\u80fd\u8bf4\u4e0b\u6b21\u4e00\u5b9a\uff09\u3002 \u63a5\u7740\u6211\u4eec\u7167\u5e38\u7f16\u5199crud\u63a5\u53e3\u5c31\u53ef\u4ee5\u4e86\u3002 \u65b0\u5efaapp/routers/notification/message.py\u6587\u4ef6\uff08\u4e5f\u522b\u5fd8\u4e86\u5728main.py\u5f15\u5165\u8fd9\u4e2arouter \u4ee3\u7801\u5927\u5bb6\u53ef\u4ee5\u53c2\u8003\u4e4b\u524d\u7684routers\u76ee\u5f55\uff09 from typing import List from fastapi import APIRouter , Depends from app.crud.notification.NotificationDao import PityNotificationDao from app.handler.fatcory import PityResponse from app.models.notification import PityNotification from app.routers import Permission router = APIRouter ( prefix = \"/notification\" ) @router . get ( \"/list\" , description = \"\u83b7\u53d6\u7528\u6237\u6d88\u606f\u5217\u8868\" ) async def list_msg ( msg_status : int = 0 , msg_type : int = 0 , user_info = Depends ( Permission ())): try : data = await PityNotificationDao . list_record ( msg_type = msg_type , msg_status = msg_status , receiver = user_info [ 'id' ]) return PityResponse . success ( data ) except Exception as e : return PityResponse . failed ( str ( e )) @router . post ( \"/read\" , description = \"\u7528\u6237\u8bfb\u53d6\u6d88\u606f\" ) async def read_msg ( msg_id : List [ int ], user_info = Depends ( Permission ())): try : await PityNotificationDao . update_by_map ( PityNotification . id . in_ ( msg_id ), PityNotification . receiver == user_info [ 'id' ], msg_status = 1 ) return PityResponse . success () except Exception as e : return PityResponse . failed ( str ( e )) \u8fd9\u8fb9\u8981\u6ce8\u610f\u7684\u5730\u65b9\u662f \u5df2\u8bfb\u6d88\u606f \u7684\u63a5\u53e3\uff0c\u63a5\u53d7\u7684\u662f\u4e00\u4e2amsg_id\u5217\u8868\uff0c\u56e0\u4e3a\u6211\u4eec\u9700\u8981\u4e00\u4e2a \u4e00\u952e\u5df2\u8bfb \u7684\u529f\u80fd\uff0c\u8fd9\u6837\u4f1a\u6bd4\u8f83\u65b9\u4fbf\u3002\u5176\u5b9e\u4e5f\u5c31\u662f\u4e00\u4e2a\u6279\u91cf\u548c\u5355\u4e2a\u7684\u63a5\u53e3\uff0c\u4e3a\u4e86\u7701\u4e8b\uff0c\u6211\u4eec\u4f7f\u7528\u4e00\u4e2a\u5373\u53ef\u3002 \u4eca\u5929\u7684\u5185\u5bb9\u5c31\u4ecb\u7ecd\u5230\u8fd9\u91cc\u4e86\uff0c\u4f46\u5176\u5b9e\u8fd9\u6837\u8fd8\u6709\u4e2a\u5927\u95ee\u9898: \u5bf9\u4e8e\u5e7f\u64ad\u6d88\u606f\uff0c\u8fd9\u4e2a\u67e5\u8be2\u548c\u66f4\u65b0\u90fd\u662f\u64cd\u4f5c\u4e0d\u5230\u7684\u3002 \u8fd9\u4e2a\u95ee\u9898\u5c31\u8981\u7559\u5230\u6211\u4eec\u4e0b\u4e00\u8282\u6765\u5904\u7406\u4e86\u3002","title":"105.\u7f16\u5199\u6d88\u606f\u901a\u77e5\u529f\u80fd(1)"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28105%29%20%E7%BC%96%E5%86%99%E6%B6%88%E6%81%AF%E9%80%9A%E7%9F%A5%E5%8A%9F%E8%83%BD%281%29/#_1","text":"\u4e0a\u4e00\u8282\u6211\u4eec\u7f16\u5199\u4e86\u7528\u4f8b/\u76ee\u5f55\u5206\u5c4f\u7684\u529f\u80fd\uff0c\u5c5e\u4e8e\u63d0\u5347 \u7528\u6237\u4f53\u9a8c \u76f8\u5173\u7684\u5185\u5bb9\u3002\u63a5\u4e0b\u6765\u6211\u4eec\u8981\u57fa\u4e8ewebsocket\uff0c\u5b8c\u6210\u6d88\u606f\u4e2d\u5fc3\u76f8\u5173\u529f\u80fd\u3002\u8fd9\u5757\u535a\u4e3b\u4e5f\u6ca1\u4ec0\u4e48\u7ecf\u9a8c\uff0c\u5982\u679c\u6709\u4e0d\u5bf9\u7684\u5730\u65b9\u6b22\u8fce\u5927\u5bb6 \u6307\u6b63 \u3002 \u672c\u6a21\u5757\u7531\u4e8e\u7bc7\u5e45\u95ee\u9898\uff0c\u4f1a\u5206\u4e3a3~5\u7bc7\u3002","title":"\u56de\u987e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28105%29%20%E7%BC%96%E5%86%99%E6%B6%88%E6%81%AF%E9%80%9A%E7%9F%A5%E5%8A%9F%E8%83%BD%281%29/#_2","text":"\u6211\u4eec\u7684\u4ea7\u54c1\u8981\u60f3\u505a\u4e00\u4e9b\u4e1c\u897f\uff0c\u5fc5\u987b\u5f97\u6709\u4e00\u4e2a\u80cc\u666f\u5728\u91cc\u5934\u3002\u6bd4\u5982\u6211\u4e3a\u5565\u8981\u505a\u8fd9\u4e2a\u529f\u80fd\uff0c\u6709\u4ec0\u4e48\u7528\u5904\u3002\u867d\u7136\u54b1\u4eec\u6bd4\u4e0d\u4e0a\u4e13\u4e1a\u7684\u4ea7\u54c1\uff0c\u4f46\u662f\u4e5f\u53ef\u4ee5\u5728\u505a\u9879\u76ee\u7684\u8fc7\u7a0b\u4e2d\u57f9\u517b\u81ea\u5df1\u8fd9\u5757 \u80fd\u529b \u3002 \u6211\u4e2a\u4eba\u7684\u60f3\u6cd5\u662f\uff0c\u5f53\u6211\u4eec\u6267\u884ccase\uff0c\u6216\u8005\u6307\u6d3e\u4e00\u4e9b\u7528\u4f8b\u7ed9\u4ed6\u4eba\u7f16\u5199\uff0c\u6216\u8005\u672a\u6765\u6709\u4e00\u4e9b\u4efb\u52a1\u5b89\u6392\u7684\u65f6\u5019\uff0c\u6211\u4eec\u53ef\u4ee5\u5148\u6307\u6d3e\uff0c\u63a5\u7740 \u63a8\u9001 \u7ed9\u5bf9\u65b9\uff0c\u8ba9\u5bf9\u65b9\u80fd\u77e5\u9053\u4f60\u7684\u5b89\u6392\u3002 \u4f46\u53ef\u80fd\u76ee\u524d\u6211\u4eec\u6700\u9700\u8981\u7684\u5c31\u662f\uff0c\u6d4b\u8bd5\u4efb\u52a1\u5b8c\u6210\u4ee5\u540e\u7684\u901a\u77e5\u529f\u80fd\u3002\u6240\u4ee5\u6211\u4eec\u9700\u8981\u8c03\u7814\u4e00\u4e0b\u7b80\u5355\u7684\u9875\u9762\u3002 \u53c2\u8003\u4e0b\u8bed\u96c0\u7684\u9875\u9762: \u53ef\u4ee5\u770b\u5230\u5341\u5206\u6e05\u723d\uff0c\u5de6\u4fa7tab\u663e\u793a\u6d88\u606f\u7c7b\u578b\uff0c\u53f3\u4fa7tab\u663e\u793a\u5df2\u8bfb/\u672a\u8bfb\u6d88\u606f\u6570\u91cf\u548c\u5217\u8868\u3002","title":"\u9700\u6c42\u80cc\u666f"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28105%29%20%E7%BC%96%E5%86%99%E6%B6%88%E6%81%AF%E9%80%9A%E7%9F%A5%E5%8A%9F%E8%83%BD%281%29/#_3","text":"\u6d88\u606f\u7684\u8bdd\uff0c\u6211\u4eec\u9700\u8981\u5148\u5b9a\u4e49\u4e00\u4e0b\u6d88\u606f\u8868\u3002\u6765\u770b\u770b\u6709\u54ea\u4e9b\u5b57\u6bb5\u5427: from sqlalchemy import SMALLINT , Column , VARCHAR , INT from app.models.basic import PityBase class PityNotification ( PityBase ): msg_type = Column ( SMALLINT , comment = \"\u6d88\u606f\u7c7b\u578b 0: \u7528\u4f8b\u6267\u884c 1: \u4efb\u52a1\u5206\u914d\" ) msg_content = Column ( VARCHAR ( 200 ), comment = \"\u6d88\u606f\u5185\u5bb9\" , nullable = True ) msg_link = Column ( VARCHAR ( 128 ), comment = \"\u6d88\u606f\u94fe\u63a5\" ) msg_status = Column ( SMALLINT , comment = \"\u6d88\u606f\u72b6\u6001 0: \u672a\u8bfb 1: \u5df2\u8bfb\" ) sender = Column ( INT , comment = \"\u6d88\u606f\u53d1\u9001\u4eba, 0\u5219\u662fCPU \u975e0\u5219\u662f\u5176\u4ed6\u7528\u6237\" ) receiver = Column ( INT , comment = \"\u6d88\u606f\u63a5\u6536\u4eba, 0\u4e3a\u5e7f\u64ad\u6d88\u606f\" ) __tablename__ = \"pity_notification\" def __init__ ( self , msg_type , msg_content , sender , receiver , user , msg_link = None , msg_status = 0 ): super () . __init__ ( user ) self . msg_type = msg_type self . receiver = receiver self . msg_content = msg_content self . sender = sender self . msg_link = msg_link self . msg_status = msg_status \u5b9a\u4e49\u4e86\u4e00\u4e2a\u901a\u77e5\u8868\uff0c\u91cc\u9762\u6709\u51e0\u4e2a\u6838\u5fc3\u5b57\u6bb5: \u7c7b\u578b\uff08\u9884\u7559\u5b57\u6bb5\uff09 \u5185\u5bb9 \u94fe\u63a5\uff08\u65b9\u4fbf\u7528\u6237\u8df3\u8f6c\uff0c\u53ef\u4e3a\u7a7a\uff09 \u72b6\u6001 \u53d1\u9001\u4eba \u63a5\u6536\u4eba\uff08\u8fd9\u91cc\u6709\u4e2a\u5e7f\u64ad\u6d88\u606f\u7684\u533a\u5206\uff09","title":"\u7f16\u5199\u6d88\u606f\u8868"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28105%29%20%E7%BC%96%E5%86%99%E6%B6%88%E6%81%AF%E9%80%9A%E7%9F%A5%E5%8A%9F%E8%83%BD%281%29/#_4","text":"\u4e00\u822c\u6211\u4eec\u5728\u9875\u9762\u4e0a\u7684\u64cd\u4f5c\uff0c\u4e5f\u5c31\u662f \u67e5\u8be2 \u548c \u5df2\u8bfb \u529f\u80fd\uff0c\u6240\u4ee5\u5bf9\u5916\u66b4\u9732\u7684\u63a5\u53e3\uff0c\u6682\u65f6\u53ea\u8003\u8651\u8fd92\u5757\u5c31\u53ef\u4ee5\u4e86\u3002 \u5982\u679c\u4e0d\u5b58\u5728\u7684\u76ee\u5f55\u548c\u6587\u4ef6\uff0c\u5927\u5bb6\u5c31\u65b0\u5efa\uff0c\u5426\u5219\u5c31\u4fee\u6539\u3002\u653e\u4e0a\u8def\u5f84\u7684\u539f\u56e0\u4fbf\u662f\u5982\u6b64\u3002 \u7f16\u5199Dao\u65b9\u6cd5(app/crud/notification/NotificationDao.py) from app.crud import Mapper from app.models.notification import PityNotification from app.utils.decorator import dao from app.utils.logger import Log @dao ( PityNotification , Log ( \"PityNotificationDao\" )) class PityNotificationDao ( Mapper ): pass \u7531\u4e8e\u4e4b\u524d\u7f16\u5199\u4e86\u4e00\u4e9b\u516c\u6709\u65b9\u6cd5\uff0c\u6240\u4ee5\u73b0\u5728\u5f88\u65b9\u4fbf\uff0c\u6211\u4eec\u4e0d\u518d\u9700\u8981\u5199\u5f88\u91cd\u590d\u7684\u4ee3\u7801\u4e86\u3002 \u7f16\u5199\u63a5\u53e3 \u5728\u6b64\u4e4b\u524d\uff0c\u6211\u4eec\u9700\u8981\u4e3aapp/crud/ init .py/Mapper\u7c7b\u65b0\u589e\u4e00\u4e2aupdate\u65b9\u6cd5: @classmethod async def update_by_map ( cls , * condition , ** kwargs ): try : async with async_session () as session : async with session . begin (): sql = update ( cls . model ) . where ( * condition ) . values ( ** kwargs , updated_at = datetime . now ()) await session . execute ( sql ) except Exception as e : cls . log . error ( f \"\u66f4\u65b0\u6570\u636e\u5931\u8d25: { e } \" ) raise Exception ( \"\u66f4\u65b0\u6570\u636e\u5931\u8d25\" ) \u4ee5\u5f80\u6211\u4eec\u7f16\u5199\u7684update\uff0c\u90fd\u662f\u5148\u67e5\u8be2\u6570\u636e\uff0c\u5982\u679c\u6ca1\u6709\u6570\u636e\u5219\u8fd4\u56de\u5f02\u5e38\uff0c\u5982\u679c\u6709\u5219\u66f4\u65b0\u6570\u636e\u3002 \u8fd9\u6837\u505a\u7684\u7f3a\u70b9\u662f\u591a\u67e5\u8be2\u4e86\u4e00\u6b21\u6570\u636e\u5e93\uff0c\u4f18\u70b9\u662f \u80fd\u591f\u9632\u6b62\u610f\u5916\u6570\u636e \u3002 \u4e0a\u8ff0\u7684\u65b9\u6cd5\uff0c\u662f\u6839\u636econdition(\u67e5\u8be2\u6761\u4ef6)\u53cakwargs(\u53d8\u66f4\u5b57\u5178)\u66f4\u65b0\u3002\u8c03\u7528\u7684\u4e5f\u90fd\u662fsqlalchemy\u57fa\u672c\u7684\u65b9\u6cd5\u3002 \u540e\u7eed\u6709\u7a7a\u6211\u4e5f\u4f1a\u51fa\u4e00\u4e2asqlalchemy crud\u76f8\u5173demo\uff0c\u5305\u62ecjoin\uff08\u53ea\u80fd\u8bf4\u4e0b\u6b21\u4e00\u5b9a\uff09\u3002 \u63a5\u7740\u6211\u4eec\u7167\u5e38\u7f16\u5199crud\u63a5\u53e3\u5c31\u53ef\u4ee5\u4e86\u3002 \u65b0\u5efaapp/routers/notification/message.py\u6587\u4ef6\uff08\u4e5f\u522b\u5fd8\u4e86\u5728main.py\u5f15\u5165\u8fd9\u4e2arouter \u4ee3\u7801\u5927\u5bb6\u53ef\u4ee5\u53c2\u8003\u4e4b\u524d\u7684routers\u76ee\u5f55\uff09 from typing import List from fastapi import APIRouter , Depends from app.crud.notification.NotificationDao import PityNotificationDao from app.handler.fatcory import PityResponse from app.models.notification import PityNotification from app.routers import Permission router = APIRouter ( prefix = \"/notification\" ) @router . get ( \"/list\" , description = \"\u83b7\u53d6\u7528\u6237\u6d88\u606f\u5217\u8868\" ) async def list_msg ( msg_status : int = 0 , msg_type : int = 0 , user_info = Depends ( Permission ())): try : data = await PityNotificationDao . list_record ( msg_type = msg_type , msg_status = msg_status , receiver = user_info [ 'id' ]) return PityResponse . success ( data ) except Exception as e : return PityResponse . failed ( str ( e )) @router . post ( \"/read\" , description = \"\u7528\u6237\u8bfb\u53d6\u6d88\u606f\" ) async def read_msg ( msg_id : List [ int ], user_info = Depends ( Permission ())): try : await PityNotificationDao . update_by_map ( PityNotification . id . in_ ( msg_id ), PityNotification . receiver == user_info [ 'id' ], msg_status = 1 ) return PityResponse . success () except Exception as e : return PityResponse . failed ( str ( e )) \u8fd9\u8fb9\u8981\u6ce8\u610f\u7684\u5730\u65b9\u662f \u5df2\u8bfb\u6d88\u606f \u7684\u63a5\u53e3\uff0c\u63a5\u53d7\u7684\u662f\u4e00\u4e2amsg_id\u5217\u8868\uff0c\u56e0\u4e3a\u6211\u4eec\u9700\u8981\u4e00\u4e2a \u4e00\u952e\u5df2\u8bfb \u7684\u529f\u80fd\uff0c\u8fd9\u6837\u4f1a\u6bd4\u8f83\u65b9\u4fbf\u3002\u5176\u5b9e\u4e5f\u5c31\u662f\u4e00\u4e2a\u6279\u91cf\u548c\u5355\u4e2a\u7684\u63a5\u53e3\uff0c\u4e3a\u4e86\u7701\u4e8b\uff0c\u6211\u4eec\u4f7f\u7528\u4e00\u4e2a\u5373\u53ef\u3002 \u4eca\u5929\u7684\u5185\u5bb9\u5c31\u4ecb\u7ecd\u5230\u8fd9\u91cc\u4e86\uff0c\u4f46\u5176\u5b9e\u8fd9\u6837\u8fd8\u6709\u4e2a\u5927\u95ee\u9898: \u5bf9\u4e8e\u5e7f\u64ad\u6d88\u606f\uff0c\u8fd9\u4e2a\u67e5\u8be2\u548c\u66f4\u65b0\u90fd\u662f\u64cd\u4f5c\u4e0d\u5230\u7684\u3002 \u8fd9\u4e2a\u95ee\u9898\u5c31\u8981\u7559\u5230\u6211\u4eec\u4e0b\u4e00\u8282\u6765\u5904\u7406\u4e86\u3002","title":"\u7f16\u5199\u540e\u7aef\u67e5\u8be2/\u5df2\u8bfb\u529f\u80fd"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28106%29%20%E7%BC%96%E5%86%99%E6%B6%88%E6%81%AF%E9%80%9A%E7%9F%A5%E5%8A%9F%E8%83%BD%282%29/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u7f16\u5199\"\u597d\u4e86\"\u83b7\u53d6\u6d88\u606f/\u5df2\u8bfb\u6d88\u606f\u76f8\u5173\u7684\u63a5\u53e3\uff0c\u4f46\u662f\u6211\u4eec\u8fd8\u6ca1\u6709\u5199\u600e\u4e48\u751f\u6210\u6d88\u606f\u3002\u5bf9\u4e8e\u5e7f\u64ad\u6d88\u606f\u7684\u5904\u7406\uff0c\u6211\u4eec\u4e5f\u662f\u5904\u4e8e \u505c\u6ede\u72b6\u6001 \u3002 \u8fd9\u51e0\u5929\u6211\u8003\u8651\u4e86\u4e00\u4e0b\u7528\u6d88\u606f\u7684\u65b9\u5f0f\u53bb\u89e3\u8026 \u64cd\u4f5c\u8bb0\u5f55 \u548c \u6d88\u606f\u63a8\u9001 \uff0c\u5c31\u76ee\u524d\u770b\u6765\u3002\u4e5f\u53ea\u6709 \u90ae\u4ef6\u6216\u5176\u4ed6 \u901a\u77e5\uff0c\u8fd8\u6709 \u6d88\u606f\u63a8\u9001 \u53ca\u64cd\u4f5c\u8bb0\u5f55\u6bd4\u8f83\u9002\u5408\uff0c\u6211\u4eec\u6bd5\u7adf\u94fe\u8def\u4e0d\u957f\uff0c\u6682\u65f6\u4e5f\u53ea\u662f\u4e2a\u5355\u4f53\u7ed3\u6784\u7684\u9879\u76ee\u3002 \u5f15\u5165\u592a\u591a\u7ec4\u4ef6\u4f1a\u8ba9\u6211\u4eec\u66f4\u590d\u6742\uff0c\u66f4\u96be\u7ef4\u62a4\u3002\u5230\u5fc5\u8981\u7684\u65f6\u5019\u53ef\u4ee5\u8003\u8651\u62c6\u5206\u670d\u52a1\u548c\u5f15\u5165\u66f4\u591a\u7ec4\u4ef6\u3002 \u6574\u4f53\u601d\u8def \u5176\u5b9e\u505a\u4e00\u4e2a\u529f\u80fd\u4e4b\u524d\uff0c\u8fd8\u662f\u6700\u597d\u89c4\u5212\u4e0b\u65b9\u6848\u3002\u56e0\u4e3a\u5bf9\u4e8e\u6211\u6765\u8bf4\uff0c\u8fd9\u5757\u80fd\u529b\u8fd8\u662f \u76f8\u5bf9\u8584\u5f31 \u4e86\u4e00\u4e9b\uff0c\u6240\u4ee5\u6709\u4e2a\u5927\u6982\u7684\u8bbe\u8ba1\u65b9\u6848\u4f1a\u6709\u5f88\u5927\u7684\u5e2e\u52a9\u3002 Websocket \u7531\u4e8e\u6211\u4eec \u9700\u8981 \u670d\u52a1\u5668\u4e3b\u52a8\u63a8\u9001\u6570\u636e\u5230\u5ba2\u6237\u7aef\uff08\u6d4f\u89c8\u5668\uff09\uff0c\u6240\u4ee5\u6700\u597d\u662f\u670d\u52a1\u5668\u80fd\u4e3b\u52a8\u901a\u77e5\uff0c\u6bd5\u7adf\u524d\u7aef\u4e00\u76f4\u8f6e\u8bad\u63a5\u53e3\uff0c\u8fd8\u662f\u4f1a\u6709\u4e00\u5b9a\u7684\u6027\u80fd\u635f\u8017\u3002 \u5982\u82e5\u6211\u4eec\u5728\u7528\u6237\u6253\u5f00\u57fa\u7840\u9875\u9762BasicLayout\u7684\u65f6\u5019\uff0c\u6839\u636e\u7528\u6237id\u83b7\u53d6websocket\u8fde\u63a5\uff0c\u5e76\u5728\u670d\u52a1\u7aef\u4fdd\u6301\u4f4f\u3002\u5f53\u6709\u9700\u8981\u7684\u65f6\u5019\u5219\u53d1\u9001\u6d88\u606f\u7ed9\u7528\u6237\u3002 \u8fd9\u91cc\u6211\u4eec\u5b9a\u4e49\u6d88\u606f\u7684\u7c7b\u578b: \u5e7f\u64ad\u6d88\u606f \u548c \u4e2a\u4eba\u6d88\u606f \uff0c\u5e7f\u64ad\u6d88\u606f\u7c7b\u4f3c\u7cfb\u7edf\u901a\u77e5\u90a3\u79cd\uff0c\u6bd4\u5982\u7248\u672c\u66f4\u65b0\u4e86\u4ec0\u4e48\uff0c\u4e2a\u4eba\u6d88\u606f\u6211\u76ee\u524d\u80fd\u60f3\u5230\u7684\u5c31\u662f\u6d4b\u8bd5\u8ba1\u5212\u6267\u884c\u4e86\u4e4b\u540e\u901a\u77e5\u7ed9\u5bf9\u65b9\uff0c\u6216\u8005\u4ee5\u540e\u6709\u5173\u6ce8 case \u7684\u529f\u80fd\uff0c\u5f53case\u6709\u53d8\u52a8\uff0c\u5219\u901a\u77e5\u5230\u5bf9\u5e94\u7684\u4eba\u3002 \u6240\u4ee5\u6211\u4eec\u9700\u8981\u4e00\u4e2a\u5b58\u50a8 \u6240\u6709\u8fde\u63a5 \u7684\u5bf9\u8c61\uff08\u5b57\u5178\uff09\uff0c\u65b9\u4fbf\u63a8\u9001\u6d88\u606f\u3002 \u6d88\u606f\u5b58\u50a8\u95ee\u9898 \u6d88\u606f\u5b58\u50a8\u6211\u4eec\u6682\u65f6\u8fd8\u662f\u5148\u653e\u5230mysql\uff0c\u8003\u8651\u5230\u7528\u6237\u4f53\u91cf\u4e0d\u4f1a\u592a\u591a\uff0c\u6211\u4eec\u53ef\u4ee5\u53ea\u67e5\u8be23\u4e2a\u6708\u7684\u8bb0\u5f55\u51cf\u7f13\u6570\u636e\u7684\u538b\u529b\u3002 \u5e7f\u64ad\u6d88\u606f\u95ee\u9898 \u6253\u7b97\u65b0\u5f00\u4e00\u4e2a\u8868\u5b58\u50a8\u7528\u6237 \u9605\u8bfb\u5e7f\u64ad\u6d88\u606f\u7684\u8bb0\u5f55 \uff0c\u548c\u6d88\u606f\u8868\u8054\u8868\u67e5\u51fa\u7528\u6237\u662f\u5426\u5df2\u8bfb\u5e7f\u64ad\u6d88\u606f\uff0c\u5982\u679c\u7528\u6237\u9009\u62e9\u67e5\u770b\u5168\u90e8\u6d88\u606f\u7684\u8bdd\uff0c\u4f1a\u6bd4\u8f83\u590d\u6742\u4e00\u4e9b\u3002 \u65b0\u589e\u679a\u4e3e\u6587\u4ef6app/enums/MessageEnum.py from enum import IntEnum class WebSocketMessageEnum ( IntEnum ): # \u6d88\u606f\u6570\u91cf COUNT = 0 # \u684c\u9762\u901a\u77e5 DESKTOP = 1 class MessageStateEnum ( IntEnum ): \"\"\" \u6d88\u606f\u72b6\u6001\u679a\u4e3e\u7c7b \"\"\" unread = 1 # \u672a\u8bfb read = 2 # \u5df2\u8bfb class MessageTypeEnum ( IntEnum ): \"\"\" \u6d88\u606f\u7c7b\u578b\u679a\u4e3e\u7c7b \"\"\" all = 0 # \u5168\u90e8\u6d88\u606f broadcast = 1 # \u5e7f\u64ad\u6d88\u606f others = 2 # \u5176\u4ed6\u6d88\u606f \u8fd9\u8fb9\u5b9a\u4e49\u4e863\u4e2a\u679a\u4e3e\u7c7b \u901a\u77e5\u7684\u5185\u5bb9\u7c7b\u578b \u6d88\u606f\u6709 \u6570\u91cf \u548c \u684c\u9762\u901a\u77e5 2\u79cd\uff0c\u7531\u4e8e\u53ef\u53c2\u8003\u7684\u8d44\u6599\u6bd4\u8f83\u5c11\uff0c\u52a0\u4e0a\u6211\u4e5f\u6ca1\u505a\u8fc7\u7c7b\u4f3c\u7684\u9879\u76ee\uff0c\u6240\u4ee5\u5b9a\u4e49\u53ef\u80fd\u6bd4\u8f83\u5947\u602a\uff0c\u5927\u5bb6\u4ec5\u4f9b\u53c2\u8003\u5373\u53ef\u3002 \u6d88\u606f\u72b6\u6001 \u5df2\u8bfb\u548c\u672a\u8bfb\u3002 \u6d88\u606f\u7c7b\u578b \u5168\u90e8\u6d88\u606f/\u5e7f\u64ad\u6d88\u606f/\u5176\u4ed6\u6d88\u606f\uff08\u4e5f\u53ef\u4ee5\u8bf4\u662f\u4e2a\u4eba\u6d88\u606f\uff09 \u7f16\u5199\u6d88\u606f\u8fd4\u56de\u4f53 app/core/msg/wss_msg.py from app.enums.MessageEnum import WebSocketMessageEnum class WebSocketMessage ( object ): @staticmethod def msg_count ( count = 1 , total = False ): return dict ( type = WebSocketMessageEnum . COUNT , count = count , total = total ) @staticmethod def desktop_msg ( title , content = '' ): return dict ( type = WebSocketMessageEnum . DESKTOP , title = title , content = content ) \u91cc\u9762\u5c01\u88c5\u4e862\u4e2a\u65b9\u6cd5: \u6d88\u606f\u6570\u91cf \u56e0\u4e3a\u6211\u4eec\u6709\u65b0\u6d88\u606f\u6765\u4e86\uff0c\u4f1a\u544a\u77e5\u5bf9\u65b9\u6765\u7684\u6d88\u606f\u6570\u91cf\uff0c\u5bf9\u65b9\u70b9\u5165\u6d88\u606f\u901a\u77e5\u9875\u9762\uff0c\u53ef\u4ee5\u770b\u5230\u6240\u6709\u6570\u636e\u3002\u5c31\u597d\u50cf\u77e5\u4e4e\u7684\u9080\u8bf7\u56de\u7b54\u4e00\u6837: \u8fd9\u8fb9\u4f1a\u6709\u4e00\u4e2a\u7ea2\u8272\u7684\u6570\u91cf\u4e0a\u6807\uff0c\u81f3\u4e8e\u5177\u4f53\u6d88\u606f\u5185\u5bb9\u662f\u5565\uff0c\u6211\u4eec\u5e76\u4e0d\u5173\u5fc3\u3002\u7528\u6237\u9700\u8981\u70b9\u8fdb\u53bb\u6216\u8005\u70b9\u5f00\u67e5\u770b\u3002 \u684c\u9762\u901a\u77e5 \u684c\u9762\u901a\u77e5\u7684\u8bdd\u9700\u8981title\u548ccontent\uff0c\u4e00\u4e2a\u662f\u6807\u9898\uff0c\u4e00\u4e2a\u662f\u6b63\u6587\u3002\u5982\u679c\u7f51\u7ad9\u63a5\u6536\u5230\u5bf9\u5e94\u7684\u6d88\u606f\uff0c\u5219\u76f4\u63a5\u5f39\u51fa\u684c\u9762\u7684\u5bf9\u8bdd\u6846\uff0c \u533a\u522b\u5c31\u662f\u8fd9\u5757\u662f\u4e34\u65f6\u6570\u636e\uff0c\u4e0d\u5199\u5165\u6570\u636e\u8868 \u3002 \u603b\u7684\u6765\u8bf4\u8fd92\u5757\u7684\u8fd4\u56de\u90fd\u662fdict\uff0c\u5728websocket\u91cc\u9762\u6211\u4eec\u4f1a\u5c01\u88c5text\uff0cjson\u548cbytes3\u79cd\u6d88\u606f\u683c\u5f0f\u7684\u8fd4\u56de\u6570\u636e\u3002 \u7f16\u5199websocket\u7ba1\u7406\u7c7b(\u7531\u536b\u8863\u54e5QYZHG\u7f16\u5199\uff0c\u7565\u6709\u6539\u52a8) app/core/ws_connection_manager.py # import abc from typing import TypeVar from fastapi import WebSocket from app.core.msg.wss_msg import WebSocketMessage from app.crud.notification.NotificationDao import PityNotificationDao from app.models.notification import PityNotification from app.utils.logger import Log MsgType = TypeVar ( 'MsgType' , str , dict , bytes ) # class MsgSender(metaclass=abc.ABCMeta): # @abc.abstractmethod # def send_text(self): # pass # # @abc.abstractmethod # def send_json(self): # pass # # @abc.abstractmethod # def send_bytes(self): # pass class ConnectionManager : BROADCAST = - 1 logger = Log ( \"wss_manager\" ) def __init__ ( self ): self . active_connections : dict [ int , WebSocket ] = {} self . log = Log ( \"websocket\" ) async def connect ( self , websocket : WebSocket , client_id : int ) -> None : await websocket . accept () exist : WebSocket = self . active_connections . get ( client_id ) if exist : await exist . close () self . active_connections [ client_id ]: WebSocket = websocket else : self . active_connections [ client_id ]: WebSocket = websocket self . log . info ( F \"websocket: { client_id } \uff1a \u5efa\u7acb\u8fde\u63a5\u6210\u529f\uff01\" ) def disconnect ( self , client_id : int ) -> None : del self . active_connections [ client_id ] self . log . info ( F \"websocket: { client_id } \uff1a \u5df2\u5b89\u5168\u65ad\u5f00\uff01\" ) @staticmethod async def pusher ( sender : WebSocket , message : MsgType ) -> None : \"\"\" \u6839\u636e\u4e0d\u540c\u7684\u6d88\u606f\u7c7b\u578b\uff0c\u8c03\u7528\u4e0d\u540c\u65b9\u6cd5\u53d1\u9001\u6d88\u606f \"\"\" msg_mapping : dict = { str : sender . send_text , dict : sender . send_json , bytes : sender . send_bytes } if func_push_msg := msg_mapping . get ( type ( message )): await func_push_msg ( message ) else : raise TypeError ( F \"websocket\u4e0d\u80fd\u53d1\u9001 { type ( message ) } \u7684\u5185\u5bb9\uff01\" ) async def send_personal_message ( self , user_id : int , message : MsgType ) -> None : \"\"\" \u53d1\u9001\u4e2a\u4eba\u4fe1\u606f \"\"\" conn = self . active_connections . get ( user_id ) if conn : await self . pusher ( sender = conn , message = message ) async def broadcast ( self , message : MsgType ) -> None : \"\"\" \u5e7f\u64ad \"\"\" for connection in self . active_connections . values (): await self . pusher ( sender = connection , message = message ) async def notify ( self , user_id , title = None , content = None , notice : PityNotification = None ): \"\"\" \u6839\u636euser_id\u63a8\u9001\u5bf9\u5e94\u7684 :param content: :param title: :param user_id: \u5f53user_id\u4e3a-1\u7684\u65f6\u5019\u4ee3\u8868\u662f\u5e7f\u64ad\u6d88\u606f :param notice: :return: \"\"\" try : # \u5224\u65ad\u662f\u5426\u4e3a\u684c\u9762\u901a\u77e5 if title is not None : msg = WebSocketMessage . desktop_msg ( title , content ) if user_id == ConnectionManager . BROADCAST : await self . broadcast ( msg ) else : await self . send_personal_message ( user_id , msg ) else : # \u8bf4\u660e\u4e0d\u662f\u684c\u9762\u6d88\u606f\uff0c\u76f4\u63a5\u7ed9\u51fa\u6d88\u606f\u6570\u91cf\u5373\u53ef if user_id == ConnectionManager . broadcast : await self . broadcast ( WebSocketMessage . msg_count ()) else : await self . send_personal_message ( user_id , WebSocketMessage . msg_count ()) # \u5224\u65ad\u662f\u5426\u8981\u843d\u5165\u63a8\u9001\u8868 if notice is not None : await PityNotificationDao . insert_record ( notice ) except Exception as e : ConnectionManager . logger . error ( f \"\u53d1\u9001\u6d88\u606f\u5931\u8d25, { e } \" ) ws_manage = ConnectionManager () \u91cc\u9762\u7684\u6838\u5fc3\u65b9\u6cd5: notify \u662f\u7528\u6765\u4e3b\u52a8\u7ed9\u7f51\u9875\u53d1\u9001\u6d88\u606f\u7684\uff0c\u7a0d\u540e\u6211\u4eec\u4f1a\u8bf4\u5230\u3002\u8fd9\u91cc\u6211\u4eec\u505a\u4e86\u4e00\u4e2a\u8bbe\u5b9a\uff0c\u5982\u679ctitle\u4e0d\u4e3aNone\uff0c\u6211\u4eec\u8ba4\u5b9a\u5b83\u662f\u684c\u9762\u901a\u77e5\u7c7b\u578b\uff0c\u6709\u53ef\u80fd\u6709\u4e00\u4e9b\u7279\u6b8a\u7684\u684c\u9762\u901a\u77e5\u4e5f\u9700\u8981\u843d\u5e93\uff0c\u6240\u4ee5\u6211\u4eec\u518d\u6b21\u5224\u65ad\uff0c\u662f\u5426\u6709Notification\uff0c\u4f20\u5165\u4e86\u5219\u8bf4\u660e\u9700\u8981\u5165\u5e93\u3002 \u5f53user_id\u4e3a-1\u7684\u65f6\u5019\uff0c\u8bf4\u660e\u662f\u4e00\u6761\u5e7f\u64ad\u6d88\u606f\u3002 \u8c03\u6574\u6d88\u606f\u8868\u7c7b \u65b0\u589emsg_title\u5b57\u6bb5\uff0cmsg_type\u4e3a1\u65f6\u4e3a\u5e7f\u64ad\u6d88\u606f(\u6ce8\u91ca\u91cc\u9762\u5199\u7684\u7cfb\u7edf\u6d88\u606f\uff0c\u5e7f\u64ad\u6d88\u606f\u66f4\u8d34\u5207\u4e00\u70b9)\u3002 \u65b0\u589e\u5e7f\u64ad\u5df2\u8bfb\u7528\u6237\u8868 app/models/broadcast_read_user.py from datetime import datetime from sqlalchemy import Column , INT , DATETIME , BIGINT from app.models import Base class PityBroadcastReadUser ( Base ): id = Column ( BIGINT , primary_key = True ) notification_id = Column ( INT , comment = \"\u5bf9\u5e94\u6d88\u606fid\" , index = True ) read_user = Column ( INT , comment = \"\u5df2\u8bfb\u7528\u6237id\" ) read_time = Column ( DATETIME , comment = \"\u5df2\u8bfb\u65f6\u95f4\" ) __tablename__ = \"pity_broadcast_read_user\" def __init__ ( self , notification_id : int , read_user : int ): self . notification_id = notification_id self . read_user = read_user self . read_time = datetime . now () self . id = None \u8fd9\u4e2a\u8868\u6bd4\u8f83\u7b80\u5355\uff0c\u53ea\u9700\u8981\u5199\u5165\u6d88\u606fid+\u5df2\u8bfb\u65f6\u95f4\uff08\u5176\u5b9e\u90fd\u53ef\u4ee5\u4e0d\u8981\uff09+\u5df2\u8bfb\u7528\u6237\u5373\u53ef\u3002 \u7f16\u5199\u5bf9\u5e94\u7684dao\u7c7b app/crud/notification/BroadcastReadDao.py from app.crud import Mapper from app.models.broadcast_read_user import PityBroadcastReadUser from app.utils.decorator import dao from app.utils.logger import Log @dao ( PityBroadcastReadUser , Log ( \"BroadcastReadDao\" )) class BroadcastReadDao ( Mapper ): pass \u4eca\u5929\u7684\u5185\u5bb9\u56e0\u4e3a\u7bc7\u5e45\u7684\u539f\u56e0\u5c31\u4ecb\u7ecd\u5230\u8fd9\u91cc\uff0c\u4e0b\u4e00\u8282\u6211\u4eec\u7ee7\u7eed\u7518\u8517\u3002","title":"106.\u7f16\u5199\u6d88\u606f\u901a\u77e5\u529f\u80fd(2)"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28106%29%20%E7%BC%96%E5%86%99%E6%B6%88%E6%81%AF%E9%80%9A%E7%9F%A5%E5%8A%9F%E8%83%BD%282%29/#_1","text":"\u4e0a\u4e00\u8282\u6211\u4eec\u7f16\u5199\"\u597d\u4e86\"\u83b7\u53d6\u6d88\u606f/\u5df2\u8bfb\u6d88\u606f\u76f8\u5173\u7684\u63a5\u53e3\uff0c\u4f46\u662f\u6211\u4eec\u8fd8\u6ca1\u6709\u5199\u600e\u4e48\u751f\u6210\u6d88\u606f\u3002\u5bf9\u4e8e\u5e7f\u64ad\u6d88\u606f\u7684\u5904\u7406\uff0c\u6211\u4eec\u4e5f\u662f\u5904\u4e8e \u505c\u6ede\u72b6\u6001 \u3002 \u8fd9\u51e0\u5929\u6211\u8003\u8651\u4e86\u4e00\u4e0b\u7528\u6d88\u606f\u7684\u65b9\u5f0f\u53bb\u89e3\u8026 \u64cd\u4f5c\u8bb0\u5f55 \u548c \u6d88\u606f\u63a8\u9001 \uff0c\u5c31\u76ee\u524d\u770b\u6765\u3002\u4e5f\u53ea\u6709 \u90ae\u4ef6\u6216\u5176\u4ed6 \u901a\u77e5\uff0c\u8fd8\u6709 \u6d88\u606f\u63a8\u9001 \u53ca\u64cd\u4f5c\u8bb0\u5f55\u6bd4\u8f83\u9002\u5408\uff0c\u6211\u4eec\u6bd5\u7adf\u94fe\u8def\u4e0d\u957f\uff0c\u6682\u65f6\u4e5f\u53ea\u662f\u4e2a\u5355\u4f53\u7ed3\u6784\u7684\u9879\u76ee\u3002 \u5f15\u5165\u592a\u591a\u7ec4\u4ef6\u4f1a\u8ba9\u6211\u4eec\u66f4\u590d\u6742\uff0c\u66f4\u96be\u7ef4\u62a4\u3002\u5230\u5fc5\u8981\u7684\u65f6\u5019\u53ef\u4ee5\u8003\u8651\u62c6\u5206\u670d\u52a1\u548c\u5f15\u5165\u66f4\u591a\u7ec4\u4ef6\u3002","title":"\u56de\u987e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28106%29%20%E7%BC%96%E5%86%99%E6%B6%88%E6%81%AF%E9%80%9A%E7%9F%A5%E5%8A%9F%E8%83%BD%282%29/#_2","text":"\u5176\u5b9e\u505a\u4e00\u4e2a\u529f\u80fd\u4e4b\u524d\uff0c\u8fd8\u662f\u6700\u597d\u89c4\u5212\u4e0b\u65b9\u6848\u3002\u56e0\u4e3a\u5bf9\u4e8e\u6211\u6765\u8bf4\uff0c\u8fd9\u5757\u80fd\u529b\u8fd8\u662f \u76f8\u5bf9\u8584\u5f31 \u4e86\u4e00\u4e9b\uff0c\u6240\u4ee5\u6709\u4e2a\u5927\u6982\u7684\u8bbe\u8ba1\u65b9\u6848\u4f1a\u6709\u5f88\u5927\u7684\u5e2e\u52a9\u3002 Websocket \u7531\u4e8e\u6211\u4eec \u9700\u8981 \u670d\u52a1\u5668\u4e3b\u52a8\u63a8\u9001\u6570\u636e\u5230\u5ba2\u6237\u7aef\uff08\u6d4f\u89c8\u5668\uff09\uff0c\u6240\u4ee5\u6700\u597d\u662f\u670d\u52a1\u5668\u80fd\u4e3b\u52a8\u901a\u77e5\uff0c\u6bd5\u7adf\u524d\u7aef\u4e00\u76f4\u8f6e\u8bad\u63a5\u53e3\uff0c\u8fd8\u662f\u4f1a\u6709\u4e00\u5b9a\u7684\u6027\u80fd\u635f\u8017\u3002 \u5982\u82e5\u6211\u4eec\u5728\u7528\u6237\u6253\u5f00\u57fa\u7840\u9875\u9762BasicLayout\u7684\u65f6\u5019\uff0c\u6839\u636e\u7528\u6237id\u83b7\u53d6websocket\u8fde\u63a5\uff0c\u5e76\u5728\u670d\u52a1\u7aef\u4fdd\u6301\u4f4f\u3002\u5f53\u6709\u9700\u8981\u7684\u65f6\u5019\u5219\u53d1\u9001\u6d88\u606f\u7ed9\u7528\u6237\u3002 \u8fd9\u91cc\u6211\u4eec\u5b9a\u4e49\u6d88\u606f\u7684\u7c7b\u578b: \u5e7f\u64ad\u6d88\u606f \u548c \u4e2a\u4eba\u6d88\u606f \uff0c\u5e7f\u64ad\u6d88\u606f\u7c7b\u4f3c\u7cfb\u7edf\u901a\u77e5\u90a3\u79cd\uff0c\u6bd4\u5982\u7248\u672c\u66f4\u65b0\u4e86\u4ec0\u4e48\uff0c\u4e2a\u4eba\u6d88\u606f\u6211\u76ee\u524d\u80fd\u60f3\u5230\u7684\u5c31\u662f\u6d4b\u8bd5\u8ba1\u5212\u6267\u884c\u4e86\u4e4b\u540e\u901a\u77e5\u7ed9\u5bf9\u65b9\uff0c\u6216\u8005\u4ee5\u540e\u6709\u5173\u6ce8 case \u7684\u529f\u80fd\uff0c\u5f53case\u6709\u53d8\u52a8\uff0c\u5219\u901a\u77e5\u5230\u5bf9\u5e94\u7684\u4eba\u3002 \u6240\u4ee5\u6211\u4eec\u9700\u8981\u4e00\u4e2a\u5b58\u50a8 \u6240\u6709\u8fde\u63a5 \u7684\u5bf9\u8c61\uff08\u5b57\u5178\uff09\uff0c\u65b9\u4fbf\u63a8\u9001\u6d88\u606f\u3002 \u6d88\u606f\u5b58\u50a8\u95ee\u9898 \u6d88\u606f\u5b58\u50a8\u6211\u4eec\u6682\u65f6\u8fd8\u662f\u5148\u653e\u5230mysql\uff0c\u8003\u8651\u5230\u7528\u6237\u4f53\u91cf\u4e0d\u4f1a\u592a\u591a\uff0c\u6211\u4eec\u53ef\u4ee5\u53ea\u67e5\u8be23\u4e2a\u6708\u7684\u8bb0\u5f55\u51cf\u7f13\u6570\u636e\u7684\u538b\u529b\u3002 \u5e7f\u64ad\u6d88\u606f\u95ee\u9898 \u6253\u7b97\u65b0\u5f00\u4e00\u4e2a\u8868\u5b58\u50a8\u7528\u6237 \u9605\u8bfb\u5e7f\u64ad\u6d88\u606f\u7684\u8bb0\u5f55 \uff0c\u548c\u6d88\u606f\u8868\u8054\u8868\u67e5\u51fa\u7528\u6237\u662f\u5426\u5df2\u8bfb\u5e7f\u64ad\u6d88\u606f\uff0c\u5982\u679c\u7528\u6237\u9009\u62e9\u67e5\u770b\u5168\u90e8\u6d88\u606f\u7684\u8bdd\uff0c\u4f1a\u6bd4\u8f83\u590d\u6742\u4e00\u4e9b\u3002","title":"\u6574\u4f53\u601d\u8def"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28106%29%20%E7%BC%96%E5%86%99%E6%B6%88%E6%81%AF%E9%80%9A%E7%9F%A5%E5%8A%9F%E8%83%BD%282%29/#appenumsmessageenumpy","text":"from enum import IntEnum class WebSocketMessageEnum ( IntEnum ): # \u6d88\u606f\u6570\u91cf COUNT = 0 # \u684c\u9762\u901a\u77e5 DESKTOP = 1 class MessageStateEnum ( IntEnum ): \"\"\" \u6d88\u606f\u72b6\u6001\u679a\u4e3e\u7c7b \"\"\" unread = 1 # \u672a\u8bfb read = 2 # \u5df2\u8bfb class MessageTypeEnum ( IntEnum ): \"\"\" \u6d88\u606f\u7c7b\u578b\u679a\u4e3e\u7c7b \"\"\" all = 0 # \u5168\u90e8\u6d88\u606f broadcast = 1 # \u5e7f\u64ad\u6d88\u606f others = 2 # \u5176\u4ed6\u6d88\u606f \u8fd9\u8fb9\u5b9a\u4e49\u4e863\u4e2a\u679a\u4e3e\u7c7b \u901a\u77e5\u7684\u5185\u5bb9\u7c7b\u578b \u6d88\u606f\u6709 \u6570\u91cf \u548c \u684c\u9762\u901a\u77e5 2\u79cd\uff0c\u7531\u4e8e\u53ef\u53c2\u8003\u7684\u8d44\u6599\u6bd4\u8f83\u5c11\uff0c\u52a0\u4e0a\u6211\u4e5f\u6ca1\u505a\u8fc7\u7c7b\u4f3c\u7684\u9879\u76ee\uff0c\u6240\u4ee5\u5b9a\u4e49\u53ef\u80fd\u6bd4\u8f83\u5947\u602a\uff0c\u5927\u5bb6\u4ec5\u4f9b\u53c2\u8003\u5373\u53ef\u3002 \u6d88\u606f\u72b6\u6001 \u5df2\u8bfb\u548c\u672a\u8bfb\u3002 \u6d88\u606f\u7c7b\u578b \u5168\u90e8\u6d88\u606f/\u5e7f\u64ad\u6d88\u606f/\u5176\u4ed6\u6d88\u606f\uff08\u4e5f\u53ef\u4ee5\u8bf4\u662f\u4e2a\u4eba\u6d88\u606f\uff09","title":"\u65b0\u589e\u679a\u4e3e\u6587\u4ef6app/enums/MessageEnum.py"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28106%29%20%E7%BC%96%E5%86%99%E6%B6%88%E6%81%AF%E9%80%9A%E7%9F%A5%E5%8A%9F%E8%83%BD%282%29/#_3","text":"app/core/msg/wss_msg.py from app.enums.MessageEnum import WebSocketMessageEnum class WebSocketMessage ( object ): @staticmethod def msg_count ( count = 1 , total = False ): return dict ( type = WebSocketMessageEnum . COUNT , count = count , total = total ) @staticmethod def desktop_msg ( title , content = '' ): return dict ( type = WebSocketMessageEnum . DESKTOP , title = title , content = content ) \u91cc\u9762\u5c01\u88c5\u4e862\u4e2a\u65b9\u6cd5: \u6d88\u606f\u6570\u91cf \u56e0\u4e3a\u6211\u4eec\u6709\u65b0\u6d88\u606f\u6765\u4e86\uff0c\u4f1a\u544a\u77e5\u5bf9\u65b9\u6765\u7684\u6d88\u606f\u6570\u91cf\uff0c\u5bf9\u65b9\u70b9\u5165\u6d88\u606f\u901a\u77e5\u9875\u9762\uff0c\u53ef\u4ee5\u770b\u5230\u6240\u6709\u6570\u636e\u3002\u5c31\u597d\u50cf\u77e5\u4e4e\u7684\u9080\u8bf7\u56de\u7b54\u4e00\u6837: \u8fd9\u8fb9\u4f1a\u6709\u4e00\u4e2a\u7ea2\u8272\u7684\u6570\u91cf\u4e0a\u6807\uff0c\u81f3\u4e8e\u5177\u4f53\u6d88\u606f\u5185\u5bb9\u662f\u5565\uff0c\u6211\u4eec\u5e76\u4e0d\u5173\u5fc3\u3002\u7528\u6237\u9700\u8981\u70b9\u8fdb\u53bb\u6216\u8005\u70b9\u5f00\u67e5\u770b\u3002 \u684c\u9762\u901a\u77e5 \u684c\u9762\u901a\u77e5\u7684\u8bdd\u9700\u8981title\u548ccontent\uff0c\u4e00\u4e2a\u662f\u6807\u9898\uff0c\u4e00\u4e2a\u662f\u6b63\u6587\u3002\u5982\u679c\u7f51\u7ad9\u63a5\u6536\u5230\u5bf9\u5e94\u7684\u6d88\u606f\uff0c\u5219\u76f4\u63a5\u5f39\u51fa\u684c\u9762\u7684\u5bf9\u8bdd\u6846\uff0c \u533a\u522b\u5c31\u662f\u8fd9\u5757\u662f\u4e34\u65f6\u6570\u636e\uff0c\u4e0d\u5199\u5165\u6570\u636e\u8868 \u3002 \u603b\u7684\u6765\u8bf4\u8fd92\u5757\u7684\u8fd4\u56de\u90fd\u662fdict\uff0c\u5728websocket\u91cc\u9762\u6211\u4eec\u4f1a\u5c01\u88c5text\uff0cjson\u548cbytes3\u79cd\u6d88\u606f\u683c\u5f0f\u7684\u8fd4\u56de\u6570\u636e\u3002","title":"\u7f16\u5199\u6d88\u606f\u8fd4\u56de\u4f53"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28106%29%20%E7%BC%96%E5%86%99%E6%B6%88%E6%81%AF%E9%80%9A%E7%9F%A5%E5%8A%9F%E8%83%BD%282%29/#websocketqyzhg","text":"app/core/ws_connection_manager.py # import abc from typing import TypeVar from fastapi import WebSocket from app.core.msg.wss_msg import WebSocketMessage from app.crud.notification.NotificationDao import PityNotificationDao from app.models.notification import PityNotification from app.utils.logger import Log MsgType = TypeVar ( 'MsgType' , str , dict , bytes ) # class MsgSender(metaclass=abc.ABCMeta): # @abc.abstractmethod # def send_text(self): # pass # # @abc.abstractmethod # def send_json(self): # pass # # @abc.abstractmethod # def send_bytes(self): # pass class ConnectionManager : BROADCAST = - 1 logger = Log ( \"wss_manager\" ) def __init__ ( self ): self . active_connections : dict [ int , WebSocket ] = {} self . log = Log ( \"websocket\" ) async def connect ( self , websocket : WebSocket , client_id : int ) -> None : await websocket . accept () exist : WebSocket = self . active_connections . get ( client_id ) if exist : await exist . close () self . active_connections [ client_id ]: WebSocket = websocket else : self . active_connections [ client_id ]: WebSocket = websocket self . log . info ( F \"websocket: { client_id } \uff1a \u5efa\u7acb\u8fde\u63a5\u6210\u529f\uff01\" ) def disconnect ( self , client_id : int ) -> None : del self . active_connections [ client_id ] self . log . info ( F \"websocket: { client_id } \uff1a \u5df2\u5b89\u5168\u65ad\u5f00\uff01\" ) @staticmethod async def pusher ( sender : WebSocket , message : MsgType ) -> None : \"\"\" \u6839\u636e\u4e0d\u540c\u7684\u6d88\u606f\u7c7b\u578b\uff0c\u8c03\u7528\u4e0d\u540c\u65b9\u6cd5\u53d1\u9001\u6d88\u606f \"\"\" msg_mapping : dict = { str : sender . send_text , dict : sender . send_json , bytes : sender . send_bytes } if func_push_msg := msg_mapping . get ( type ( message )): await func_push_msg ( message ) else : raise TypeError ( F \"websocket\u4e0d\u80fd\u53d1\u9001 { type ( message ) } \u7684\u5185\u5bb9\uff01\" ) async def send_personal_message ( self , user_id : int , message : MsgType ) -> None : \"\"\" \u53d1\u9001\u4e2a\u4eba\u4fe1\u606f \"\"\" conn = self . active_connections . get ( user_id ) if conn : await self . pusher ( sender = conn , message = message ) async def broadcast ( self , message : MsgType ) -> None : \"\"\" \u5e7f\u64ad \"\"\" for connection in self . active_connections . values (): await self . pusher ( sender = connection , message = message ) async def notify ( self , user_id , title = None , content = None , notice : PityNotification = None ): \"\"\" \u6839\u636euser_id\u63a8\u9001\u5bf9\u5e94\u7684 :param content: :param title: :param user_id: \u5f53user_id\u4e3a-1\u7684\u65f6\u5019\u4ee3\u8868\u662f\u5e7f\u64ad\u6d88\u606f :param notice: :return: \"\"\" try : # \u5224\u65ad\u662f\u5426\u4e3a\u684c\u9762\u901a\u77e5 if title is not None : msg = WebSocketMessage . desktop_msg ( title , content ) if user_id == ConnectionManager . BROADCAST : await self . broadcast ( msg ) else : await self . send_personal_message ( user_id , msg ) else : # \u8bf4\u660e\u4e0d\u662f\u684c\u9762\u6d88\u606f\uff0c\u76f4\u63a5\u7ed9\u51fa\u6d88\u606f\u6570\u91cf\u5373\u53ef if user_id == ConnectionManager . broadcast : await self . broadcast ( WebSocketMessage . msg_count ()) else : await self . send_personal_message ( user_id , WebSocketMessage . msg_count ()) # \u5224\u65ad\u662f\u5426\u8981\u843d\u5165\u63a8\u9001\u8868 if notice is not None : await PityNotificationDao . insert_record ( notice ) except Exception as e : ConnectionManager . logger . error ( f \"\u53d1\u9001\u6d88\u606f\u5931\u8d25, { e } \" ) ws_manage = ConnectionManager () \u91cc\u9762\u7684\u6838\u5fc3\u65b9\u6cd5: notify \u662f\u7528\u6765\u4e3b\u52a8\u7ed9\u7f51\u9875\u53d1\u9001\u6d88\u606f\u7684\uff0c\u7a0d\u540e\u6211\u4eec\u4f1a\u8bf4\u5230\u3002\u8fd9\u91cc\u6211\u4eec\u505a\u4e86\u4e00\u4e2a\u8bbe\u5b9a\uff0c\u5982\u679ctitle\u4e0d\u4e3aNone\uff0c\u6211\u4eec\u8ba4\u5b9a\u5b83\u662f\u684c\u9762\u901a\u77e5\u7c7b\u578b\uff0c\u6709\u53ef\u80fd\u6709\u4e00\u4e9b\u7279\u6b8a\u7684\u684c\u9762\u901a\u77e5\u4e5f\u9700\u8981\u843d\u5e93\uff0c\u6240\u4ee5\u6211\u4eec\u518d\u6b21\u5224\u65ad\uff0c\u662f\u5426\u6709Notification\uff0c\u4f20\u5165\u4e86\u5219\u8bf4\u660e\u9700\u8981\u5165\u5e93\u3002 \u5f53user_id\u4e3a-1\u7684\u65f6\u5019\uff0c\u8bf4\u660e\u662f\u4e00\u6761\u5e7f\u64ad\u6d88\u606f\u3002","title":"\u7f16\u5199websocket\u7ba1\u7406\u7c7b(\u7531\u536b\u8863\u54e5QYZHG\u7f16\u5199\uff0c\u7565\u6709\u6539\u52a8)"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28106%29%20%E7%BC%96%E5%86%99%E6%B6%88%E6%81%AF%E9%80%9A%E7%9F%A5%E5%8A%9F%E8%83%BD%282%29/#_4","text":"\u65b0\u589emsg_title\u5b57\u6bb5\uff0cmsg_type\u4e3a1\u65f6\u4e3a\u5e7f\u64ad\u6d88\u606f(\u6ce8\u91ca\u91cc\u9762\u5199\u7684\u7cfb\u7edf\u6d88\u606f\uff0c\u5e7f\u64ad\u6d88\u606f\u66f4\u8d34\u5207\u4e00\u70b9)\u3002","title":"\u8c03\u6574\u6d88\u606f\u8868\u7c7b"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28106%29%20%E7%BC%96%E5%86%99%E6%B6%88%E6%81%AF%E9%80%9A%E7%9F%A5%E5%8A%9F%E8%83%BD%282%29/#_5","text":"app/models/broadcast_read_user.py from datetime import datetime from sqlalchemy import Column , INT , DATETIME , BIGINT from app.models import Base class PityBroadcastReadUser ( Base ): id = Column ( BIGINT , primary_key = True ) notification_id = Column ( INT , comment = \"\u5bf9\u5e94\u6d88\u606fid\" , index = True ) read_user = Column ( INT , comment = \"\u5df2\u8bfb\u7528\u6237id\" ) read_time = Column ( DATETIME , comment = \"\u5df2\u8bfb\u65f6\u95f4\" ) __tablename__ = \"pity_broadcast_read_user\" def __init__ ( self , notification_id : int , read_user : int ): self . notification_id = notification_id self . read_user = read_user self . read_time = datetime . now () self . id = None \u8fd9\u4e2a\u8868\u6bd4\u8f83\u7b80\u5355\uff0c\u53ea\u9700\u8981\u5199\u5165\u6d88\u606fid+\u5df2\u8bfb\u65f6\u95f4\uff08\u5176\u5b9e\u90fd\u53ef\u4ee5\u4e0d\u8981\uff09+\u5df2\u8bfb\u7528\u6237\u5373\u53ef\u3002","title":"\u65b0\u589e\u5e7f\u64ad\u5df2\u8bfb\u7528\u6237\u8868"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28106%29%20%E7%BC%96%E5%86%99%E6%B6%88%E6%81%AF%E9%80%9A%E7%9F%A5%E5%8A%9F%E8%83%BD%282%29/#dao","text":"app/crud/notification/BroadcastReadDao.py from app.crud import Mapper from app.models.broadcast_read_user import PityBroadcastReadUser from app.utils.decorator import dao from app.utils.logger import Log @dao ( PityBroadcastReadUser , Log ( \"BroadcastReadDao\" )) class BroadcastReadDao ( Mapper ): pass \u4eca\u5929\u7684\u5185\u5bb9\u56e0\u4e3a\u7bc7\u5e45\u7684\u539f\u56e0\u5c31\u4ecb\u7ecd\u5230\u8fd9\u91cc\uff0c\u4e0b\u4e00\u8282\u6211\u4eec\u7ee7\u7eed\u7518\u8517\u3002","title":"\u7f16\u5199\u5bf9\u5e94\u7684dao\u7c7b"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28107%29%20%E7%BC%96%E5%86%99%E6%B6%88%E6%81%AF%E9%80%9A%E7%9F%A5%E5%8A%9F%E8%83%BD%283%29/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u5199\u4e86\u4e00\u4e9b\u540e\u7aef\u7684\u5185\u5bb9\uff0c\u4eca\u5929\u6765\u7ed9\u540e\u7aef\u6536\u4e2a\u5c3e\uff0c\u5e76\u4e14\u8bf4\u4e00\u90e8\u5206\u524d\u7aef\u7684\u5185\u5bb9\uff0c\u672c\u6b21\u6d88\u606f\u4e2d\u5fc3\u5185\u5bb9\u5c31\u8be5\u7ed3\u675f\u4e86\u3002 \u672c\u6b21\u5185\u5bb9\u505a\u7684\u8d28\u91cf\u4e0d\u662f\u5f88\u591f\uff0c\u5927\u6982\u57281\u661f1\u8d39\u5361\u7684\u6c34\u51c6\uff0c\u6bd5\u7adf\u6ca1\u6709\u5f88\u597d\u7684\u53c2\u8003\uff0c\u6240\u4ee5\u5e0c\u671b\u5927\u5bb6\u8f7b\u55b7\u3002 \u4fee\u6539NotificationDao.py \u4fee\u6539\u8fd9\u4e2a\u6587\u4ef6\u7684\u539f\u56e0\uff0c\u662f\u6211\u4eec\u56e0\u4e3a\u8981\u67e5\u8be2\u4e0d\u540c\u7c7b\u578b\u7684\u6d88\u606f\uff0c\u4e0d\u80fd\u7528\u7b80\u5355\u7684mapper\uff08list_record\uff09\u65b9\u6cd5\u53bb\u67e5\u8be2\uff0c\u56e0\u4e3a\u6bd4\u8f83\u590d\u6742\u3002 from datetime import timedelta , datetime from sqlalchemy import select , and_ , or_ from app.crud import Mapper from app.enums.MessageEnum import MessageTypeEnum , MessageStateEnum from app.models import async_session from app.models.broadcast_read_user import PityBroadcastReadUser from app.models.notification import PityNotification from app.utils.decorator import dao from app.utils.logger import Log @dao ( PityNotification , Log ( \"PityNotificationDao\" )) class PityNotificationDao ( Mapper ): @classmethod async def list_messages ( cls , msg_type : int , msg_status : int , receiver : int ): \"\"\" \u6839\u636e\u6d88\u606fid\u548c\u6d88\u606f\u7c7b\u578b\u4ee5\u53ca\u63a5\u6536\u4eba\u83b7\u53d6\u6d88\u606f\u6570\u636e :param msg_type: :param msg_status: :param receiver: :return: \"\"\" ninety_days = datetime . now () - timedelta ( days = 90 ) # 1. \u5f53\u6d88\u606f\u7c7b\u578b\u4e0d\u4e3a\u5e7f\u64ad\u7c7b\u578b\u65f6\uff0c\u6b63\u5e38\u67e5\u8be2 if msg_type == MessageTypeEnum . others : ans = await cls . list_record ( msg_status = msg_status , receiver = receiver , msg_type = msg_type , condition = [ PityNotification . created_at > ninety_days ]) else : # \u5426\u5219\u9700\u8981\u6839\u636e\u662f\u5426\u5df2\u8bfb\u8fdb\u884c\u67e5\u8be2 \u53ea\u652f\u630190\u5929\u5185\u6570\u636e async with async_session () as session : # \u627e\u52303\u4e2a\u6708\u5185\u7684\u6d88\u606f default_condition = [ PityNotification . deleted_at == 0 , PityNotification . created_at >= ninety_days ] if msg_type == MessageTypeEnum . broadcast : conditions = [ * default_condition , PityNotification . msg_type == msg_type ] else : # \u8bf4\u660e\u662f\u5168\u90e8\u6d88\u606f conditions = [ * default_condition , or_ ( PityNotification . msg_type != msg_type , PityNotification . receiver == receiver )] sql = select ( PityNotification , PityBroadcastReadUser ) \\ . outerjoin ( PityBroadcastReadUser , and_ ( PityNotification . id == PityBroadcastReadUser . notification_id , PityBroadcastReadUser . read_user == receiver )) . where ( * conditions ) . order_by ( PityNotification . created_at . desc ()) query = await session . execute ( sql ) result = query . all () ans = [] last_month = datetime . now () - timedelta ( days = 30 ) for notify , read in result : # \u5982\u679c\u975e\u5e7f\u64ad\u7c7b\u578b\uff0c\u76f4\u63a5 if notify . msg_type == MessageTypeEnum . others : if notify . msg_status == msg_status : ans . append ( notify ) continue else : if msg_status == MessageStateEnum . read : if read is not None or notify . updated_at < last_month : ans . append ( notify ) else : if not read : ans . append ( notify ) return ans \u8fd9\u8fb9\u5177\u4f53\u8bb2\u89e3\u4e00\u4e0b\u4ee3\u7801\uff0c\u7406\u4e00\u4e0b\u903b\u8f91: \u5f53\u67e5\u8be2\u7684\u975e\u5e7f\u64ad\u6d88\u606f\u65f6\uff0c\u6211\u4eec\u4e0d\u9700\u8981\u4e0ebroadcast\u8868\u5173\u8054\uff0c\u76f4\u63a5\u67e5\u8be2notification\u8868\u91cc\u976290\u5929\u5185\u7684\u6570\u636e\u5373\u53ef \u5426\u5219\u6211\u4eec\u5bf9\u6d88\u606f\u7c7b\u578b\u8fdb\u884c\u5224\u65ad \u5982\u679c\u53ea\u8981\u5e7f\u64ad\u6d88\u606f\uff0c\u90a3\u4e48\u6211\u4eec\u4e5f\u662f\u627e\u5230\u6d88\u606f\u7c7b\u578b\u4e3a \u5e7f\u64ad\u6d88\u606f \u4e14 \u521b\u5efa\u65f6\u95f4\u572890\u5929\u5185 \u7684\u6570\u636e\u3002 \u5982\u679c\u8981\u5168\u90e8\u6d88\u606f\uff0c\u90a3\u6211\u4eec\u8fd8\u5f97\u5e26\u4e0a\u4e00\u4e2aor\u6761\u4ef6\uff0c\u5e7f\u64ad\u6d88\u606f+\u5176\u4ed6\u7c7b\u578b\u7684\u6d88\u606f\u5e76\u4e14\u63a5\u6536\u4eba\u662f\u8be5\u7528\u6237\u7684 \u63a5\u7740\u8054\u8868\u67e5\u51fa\u8bfb\u53d6\u72b6\u6001 \u6700\u540e\u6839\u636e\u8bfb\u53d6\u7684\u72b6\u6001\u5224\u65ad\uff0c\u662f\u8981\u672a\u8bfb\u8fd8\u662f\u8981\u5df2\u8bfb\u7684\u6d88\u606f\uff0c\u8fdb\u884c\u4e00\u904d\u7b5b\u9009 \u8fd9\u91ccsql\u5982\u679c\u5408\u5728\u4e00\u8d77\u5f88\u590d\u6742\uff08\u6211\u6700\u8fd1\u8111\u5b50\u4e0d\u592a\u597d\u4f7f\uff09\uff0c\u6240\u4ee5\u7b80\u5355\u70b9\u4e86\uff0c\u7528sql\u67e5\u8be2\u51fa\u6240\u6709\u6570\u636e\uff0c\u63a5\u7740\u6839\u636e\u5bf9\u5e94\u7684\u9009\u9879\u7b5b\u9009\u51fa\u5408\u9002\u7684\u6570\u636e\u3002 \u7b80\u5355\u7684\u8bf4\u5c31\u662f\uff0c\u8981\u5df2\u8bfb\u6d88\u606f\u7684\u8bdd\uff0c\u90a3\u4e48\u6761\u4ef6\u662f \u5df2\u8bfb\u8868\u91cc\u9762\u6709\u8be5\u6761\u8bb0\u5f55\u6216\u8005\u6d88\u606f\u5df2\u7ecf\u8fc7\u671f1\u4e2a\u6708\u4e86 \uff0c\u8fc7\u671f\u4e00\u4e2a\u6708\u7684\u6d88\u606f\u9ed8\u8ba4\u7b97\u5df2\u8bfb\u4e86\u3002\u5982\u679c\u8981\u672a\u8bfb\u6d88\u606f\u7684\u8bdd\uff0c\u5fc5\u987b\u5728\u5e7f\u64ad\u8868\u91cc\u9762 \u67e5\u4e0d\u5230\u8fd9\u6761\u6570\u636e \u3002 \u8fd9\u5757\u786e\u5b9e\u5f88\u590d\u6742\uff0c\u540e\u7eed\u53ef\u80fd\u4f1a\u6539\u9020\u4e0b\uff0c\u76ee\u524d\u5c31\u5148\u5c06\u5c31\u7528\u7740= = \u8c03\u6574main.py @pity . websocket ( \"/ws/ {user_id} \" ) async def websocket_endpoint ( websocket : WebSocket , user_id : int ): await ws_manage . connect ( websocket , user_id ) try : # \u5b9a\u4e49\u7279\u6b8a\u503c\u7684\u56de\u590d\uff0c\u914d\u5408\u524d\u7aef\u5b9e\u73b0\u786e\u5b9a\u8fde\u63a5\uff0c\u5fc3\u8df3\u68c0\u6d4b\u7b49\u903b\u8f91 questions_and_answers_map : dict = { \"HELLO SERVER\" : F \"hello { user_id } \" , \"HEARTBEAT\" : F \" { user_id } \" , } # \u5b58\u50a8\u8fde\u63a5\u540e\u83b7\u53d6\u6d88\u606f msg_records = await PityNotificationDao . list_messages ( msg_type = MessageTypeEnum . all . value , receiver = user_id , msg_status = MessageStateEnum . unread . value ) # \u5982\u679c\u6709\u672a\u8bfb\u6d88\u606f, \u5219\u63a8\u9001\u7ed9\u524d\u7aef\u5bf9\u5e94\u7684count if len ( msg_records ) > 0 : await websocket . send_json ( WebSocketMessage . msg_count ( len ( msg_records ), True )) while True : data : str = await websocket . receive_text () if ( du := data . upper ()) in questions_and_answers_map : await ws_manage . send_personal_message ( message = questions_and_answers_map . get ( du ), websocket = websocket ) except WebSocketDisconnect : if user_id in ws_manage . active_connections : ws_manage . disconnect ( user_id ) except Exception as e : print ( e ) \u53bbmain.py\u7f16\u5199\u4e00\u4e2awebsocket\u63a5\u53e3\uff0c\u63a5\u53d7\u53c2\u6570\u662fuser_id\uff0c\u8fde\u63a5\u4e0a \u5ba2\u6237\u7aef \u4ee5\u540e\uff0c\u6211\u4eec\u4f1a\u67e5\u8be2\u8fd9\u4e2a\u7528\u6237\u7684\u6d88\u606f\u6570\u91cf\uff0c\u5e76\u53d1\u9001\u7ed9\u524d\u7aef\u3002while True\u540e\u7684\u8bed\u53e5\u7528\u4e8e\u4e3b\u52a8\u63a5\u6536\u5ba2\u6237\u7aef\u7684\u6d88\u606f\uff0c\u4f46 \u6211\u4eec\u8fd9\u4e2a\u573a\u666f\u4f3c\u4e4e\u4e0d\u592a\u9002\u7528 \u3002 \u5bf9\u65b9\u65ad\u5f00\u8fde\u63a5\u540e\u5219\u5173\u95ed\u6b64\u5904\u7684\u5ba2\u6237\u7aef\u8fde\u63a5\u3002 \u7f16\u5199\u524d\u7aef\u90e8\u5206 BasicLayout.jsx \u5728basiclayout.jsx\u7684useEffect\u65b9\u6cd5\u5904\u7f16\u5199\u5982\u4e0b\u4ee3\u7801\uff0c\u5982\u679c\u7528\u6237\u5df2\u767b\u5f55\uff0c\u9ed8\u8ba4\u7ed9\u4e4b\u8fde\u63a5websocket\uff0c\u6536\u5230\u6d88\u606f\u8fdb\u884c\u4e00\u6b21\u5224\u65ad: \u684c\u9762\u901a\u77e5\u8fd8\u662f\u6d88\u606f\u6570\u91cf\uff0c\u5982\u679c\u662f\u6d88\u606f\u6570\u91cf\u5219\u66f4\u65b0\uff0c\u5426\u5219\u5219\u8c03\u7528notification.info\u8fdb\u884c\u63a8\u9001\u3002\u8fd9\u4e2aevent.preventDefault\u4e0d\u8981\u6f0f\u6389\uff0c\u4f1a\u5bfc\u81f4\u670d\u52a1\u7aef\u62a5\u8fde\u63a5\u5173\u95ed\u7684\u9519\u8bef\u3002 Notification.jsx \u8fd9\u91cc\u7ec6\u8282\u4ee3\u7801\u5927\u5bb6\u53ef\u4ee5\u53bb\u770bgithub\u63d0\u4ea4\u8bb0\u5f55\uff0c\u5927\u6982\u7684\u6837\u5f0f\u5982\u4e0b\u56fe: \u7531\u4e8e\u4ee3\u7801\u6bd4\u8f83\u591a\uff0c\u5c31\u4e0d\u4e00\u4e00\u5c55\u793a\u4e86\u3002\u5177\u4f53\u53ef\u4ee5\u770bhttps://github.com/wuranxu/pityWeb\u91cc\u7684\u5185\u5bb9\u3002 \u6d4b\u8bd5\u4e0b \u6211\u4eec\u624b\u52a8\u5728\u6570\u636e\u5e93\u63d2\u5165\u4e00\u6761\u6d88\u606f\u6570\u636e\uff0creceiver\u662f\u4f60\u7684\u7528\u6237id\uff0cdeleted_at\u8981\u4e3a0\u3002\u63a5\u7740\u6211\u4eec\u5237\u65b0\u4e0b\u9875\u9762: \u8fd9\u91cc\u6211\u4eec\u8fd8\u505a\u4e86 \u5220\u9664\u6d88\u606f \u548c \u5df2\u8bfb\u6d88\u606f \u7684\u529f\u80fd\uff0c\u9ed8\u8ba4\u662f\u8fdb\u5165\u8fd9\u4e2a\u9875\u9762\u5c31 \u5df2\u8bfb\u5168\u90e8\u6d88\u606f \u3002 \u6d4b\u8bd5\u4e0b\u684c\u9762\u901a\u77e5 \u5728run_test_plan\u65b9\u6cd5\u91cc\u9762\u52a0\u5165\u5982\u4e0b\u5224\u65ad\uff0c\u5982\u679c \u6267\u884c\u4eba \u4e0d\u4e3a0\uff0c\u4e5f\u5c31\u662f\u8bf4\u662f\u624b\u52a8\u6267\u884c\u7684\uff0c\u90a3\u4e48\u6267\u884c\u5b8c\u6bd5\u540e\u7ed9\u51fa\u6d88\u606f\u901a\u77e5: \u53ef\u4ee5\u770b\u5230\uff0c\u6267\u884c\u65f6\u95f4\u6bd4\u8f83\u4e45\u4e86\u3002\u5176\u5b9e\u8fd9\u8fb9 \u63a5\u53e3 \u5df2\u7ecf\u5f02\u6b65\u8fd4\u56de\u4e86\uff0c\u4f46\u6d88\u606f\u63a8\u9001\u662f\u6d4b\u8bd5\u8ba1\u5212\u771f\u6b63\u6267\u884c\u5b8c\u6210\u4e86\u4e4b\u540e\u624d\u51fa\u73b0\u3002 \u8fd8\u662f\u90a3\u53e5\u8bdd\uff0c\u5b9e\u73b0\u5f97\u5f88\u7c97\u7cd9\uff0c\u5305\u62ec\u5e7f\u64ad\u6d88\u606f\u7684\u5904\u7406\uff0c\u8fd8\u6709\u6d88\u606f\u901a\u77e5\uff0c\u6709\u5f88\u591a\u7455\u75b5\u3002 \u5927\u91cf\u6d88\u606f\u5b58\u50a8 websocket\u81ea\u52a8\u91cd\u8fde\u5565\u7684\uff0c\u57fa\u672c\u90fd\u6ca1\u6709\u5904\u7406 \u7b49\u95ee\u9898\u51fa\u73b0\u4e86\u518d\u6162\u6162\u4fee\u4fee\u8865\u8865\u5427\u3002","title":"107.\u7f16\u5199\u6d88\u606f\u901a\u77e5\u529f\u80fd(3)"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28107%29%20%E7%BC%96%E5%86%99%E6%B6%88%E6%81%AF%E9%80%9A%E7%9F%A5%E5%8A%9F%E8%83%BD%283%29/#_1","text":"\u4e0a\u4e00\u8282\u6211\u4eec\u5199\u4e86\u4e00\u4e9b\u540e\u7aef\u7684\u5185\u5bb9\uff0c\u4eca\u5929\u6765\u7ed9\u540e\u7aef\u6536\u4e2a\u5c3e\uff0c\u5e76\u4e14\u8bf4\u4e00\u90e8\u5206\u524d\u7aef\u7684\u5185\u5bb9\uff0c\u672c\u6b21\u6d88\u606f\u4e2d\u5fc3\u5185\u5bb9\u5c31\u8be5\u7ed3\u675f\u4e86\u3002 \u672c\u6b21\u5185\u5bb9\u505a\u7684\u8d28\u91cf\u4e0d\u662f\u5f88\u591f\uff0c\u5927\u6982\u57281\u661f1\u8d39\u5361\u7684\u6c34\u51c6\uff0c\u6bd5\u7adf\u6ca1\u6709\u5f88\u597d\u7684\u53c2\u8003\uff0c\u6240\u4ee5\u5e0c\u671b\u5927\u5bb6\u8f7b\u55b7\u3002","title":"\u56de\u987e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28107%29%20%E7%BC%96%E5%86%99%E6%B6%88%E6%81%AF%E9%80%9A%E7%9F%A5%E5%8A%9F%E8%83%BD%283%29/#notificationdaopy","text":"\u4fee\u6539\u8fd9\u4e2a\u6587\u4ef6\u7684\u539f\u56e0\uff0c\u662f\u6211\u4eec\u56e0\u4e3a\u8981\u67e5\u8be2\u4e0d\u540c\u7c7b\u578b\u7684\u6d88\u606f\uff0c\u4e0d\u80fd\u7528\u7b80\u5355\u7684mapper\uff08list_record\uff09\u65b9\u6cd5\u53bb\u67e5\u8be2\uff0c\u56e0\u4e3a\u6bd4\u8f83\u590d\u6742\u3002 from datetime import timedelta , datetime from sqlalchemy import select , and_ , or_ from app.crud import Mapper from app.enums.MessageEnum import MessageTypeEnum , MessageStateEnum from app.models import async_session from app.models.broadcast_read_user import PityBroadcastReadUser from app.models.notification import PityNotification from app.utils.decorator import dao from app.utils.logger import Log @dao ( PityNotification , Log ( \"PityNotificationDao\" )) class PityNotificationDao ( Mapper ): @classmethod async def list_messages ( cls , msg_type : int , msg_status : int , receiver : int ): \"\"\" \u6839\u636e\u6d88\u606fid\u548c\u6d88\u606f\u7c7b\u578b\u4ee5\u53ca\u63a5\u6536\u4eba\u83b7\u53d6\u6d88\u606f\u6570\u636e :param msg_type: :param msg_status: :param receiver: :return: \"\"\" ninety_days = datetime . now () - timedelta ( days = 90 ) # 1. \u5f53\u6d88\u606f\u7c7b\u578b\u4e0d\u4e3a\u5e7f\u64ad\u7c7b\u578b\u65f6\uff0c\u6b63\u5e38\u67e5\u8be2 if msg_type == MessageTypeEnum . others : ans = await cls . list_record ( msg_status = msg_status , receiver = receiver , msg_type = msg_type , condition = [ PityNotification . created_at > ninety_days ]) else : # \u5426\u5219\u9700\u8981\u6839\u636e\u662f\u5426\u5df2\u8bfb\u8fdb\u884c\u67e5\u8be2 \u53ea\u652f\u630190\u5929\u5185\u6570\u636e async with async_session () as session : # \u627e\u52303\u4e2a\u6708\u5185\u7684\u6d88\u606f default_condition = [ PityNotification . deleted_at == 0 , PityNotification . created_at >= ninety_days ] if msg_type == MessageTypeEnum . broadcast : conditions = [ * default_condition , PityNotification . msg_type == msg_type ] else : # \u8bf4\u660e\u662f\u5168\u90e8\u6d88\u606f conditions = [ * default_condition , or_ ( PityNotification . msg_type != msg_type , PityNotification . receiver == receiver )] sql = select ( PityNotification , PityBroadcastReadUser ) \\ . outerjoin ( PityBroadcastReadUser , and_ ( PityNotification . id == PityBroadcastReadUser . notification_id , PityBroadcastReadUser . read_user == receiver )) . where ( * conditions ) . order_by ( PityNotification . created_at . desc ()) query = await session . execute ( sql ) result = query . all () ans = [] last_month = datetime . now () - timedelta ( days = 30 ) for notify , read in result : # \u5982\u679c\u975e\u5e7f\u64ad\u7c7b\u578b\uff0c\u76f4\u63a5 if notify . msg_type == MessageTypeEnum . others : if notify . msg_status == msg_status : ans . append ( notify ) continue else : if msg_status == MessageStateEnum . read : if read is not None or notify . updated_at < last_month : ans . append ( notify ) else : if not read : ans . append ( notify ) return ans \u8fd9\u8fb9\u5177\u4f53\u8bb2\u89e3\u4e00\u4e0b\u4ee3\u7801\uff0c\u7406\u4e00\u4e0b\u903b\u8f91: \u5f53\u67e5\u8be2\u7684\u975e\u5e7f\u64ad\u6d88\u606f\u65f6\uff0c\u6211\u4eec\u4e0d\u9700\u8981\u4e0ebroadcast\u8868\u5173\u8054\uff0c\u76f4\u63a5\u67e5\u8be2notification\u8868\u91cc\u976290\u5929\u5185\u7684\u6570\u636e\u5373\u53ef \u5426\u5219\u6211\u4eec\u5bf9\u6d88\u606f\u7c7b\u578b\u8fdb\u884c\u5224\u65ad \u5982\u679c\u53ea\u8981\u5e7f\u64ad\u6d88\u606f\uff0c\u90a3\u4e48\u6211\u4eec\u4e5f\u662f\u627e\u5230\u6d88\u606f\u7c7b\u578b\u4e3a \u5e7f\u64ad\u6d88\u606f \u4e14 \u521b\u5efa\u65f6\u95f4\u572890\u5929\u5185 \u7684\u6570\u636e\u3002 \u5982\u679c\u8981\u5168\u90e8\u6d88\u606f\uff0c\u90a3\u6211\u4eec\u8fd8\u5f97\u5e26\u4e0a\u4e00\u4e2aor\u6761\u4ef6\uff0c\u5e7f\u64ad\u6d88\u606f+\u5176\u4ed6\u7c7b\u578b\u7684\u6d88\u606f\u5e76\u4e14\u63a5\u6536\u4eba\u662f\u8be5\u7528\u6237\u7684 \u63a5\u7740\u8054\u8868\u67e5\u51fa\u8bfb\u53d6\u72b6\u6001 \u6700\u540e\u6839\u636e\u8bfb\u53d6\u7684\u72b6\u6001\u5224\u65ad\uff0c\u662f\u8981\u672a\u8bfb\u8fd8\u662f\u8981\u5df2\u8bfb\u7684\u6d88\u606f\uff0c\u8fdb\u884c\u4e00\u904d\u7b5b\u9009 \u8fd9\u91ccsql\u5982\u679c\u5408\u5728\u4e00\u8d77\u5f88\u590d\u6742\uff08\u6211\u6700\u8fd1\u8111\u5b50\u4e0d\u592a\u597d\u4f7f\uff09\uff0c\u6240\u4ee5\u7b80\u5355\u70b9\u4e86\uff0c\u7528sql\u67e5\u8be2\u51fa\u6240\u6709\u6570\u636e\uff0c\u63a5\u7740\u6839\u636e\u5bf9\u5e94\u7684\u9009\u9879\u7b5b\u9009\u51fa\u5408\u9002\u7684\u6570\u636e\u3002 \u7b80\u5355\u7684\u8bf4\u5c31\u662f\uff0c\u8981\u5df2\u8bfb\u6d88\u606f\u7684\u8bdd\uff0c\u90a3\u4e48\u6761\u4ef6\u662f \u5df2\u8bfb\u8868\u91cc\u9762\u6709\u8be5\u6761\u8bb0\u5f55\u6216\u8005\u6d88\u606f\u5df2\u7ecf\u8fc7\u671f1\u4e2a\u6708\u4e86 \uff0c\u8fc7\u671f\u4e00\u4e2a\u6708\u7684\u6d88\u606f\u9ed8\u8ba4\u7b97\u5df2\u8bfb\u4e86\u3002\u5982\u679c\u8981\u672a\u8bfb\u6d88\u606f\u7684\u8bdd\uff0c\u5fc5\u987b\u5728\u5e7f\u64ad\u8868\u91cc\u9762 \u67e5\u4e0d\u5230\u8fd9\u6761\u6570\u636e \u3002 \u8fd9\u5757\u786e\u5b9e\u5f88\u590d\u6742\uff0c\u540e\u7eed\u53ef\u80fd\u4f1a\u6539\u9020\u4e0b\uff0c\u76ee\u524d\u5c31\u5148\u5c06\u5c31\u7528\u7740= =","title":"\u4fee\u6539NotificationDao.py"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28107%29%20%E7%BC%96%E5%86%99%E6%B6%88%E6%81%AF%E9%80%9A%E7%9F%A5%E5%8A%9F%E8%83%BD%283%29/#mainpy","text":"@pity . websocket ( \"/ws/ {user_id} \" ) async def websocket_endpoint ( websocket : WebSocket , user_id : int ): await ws_manage . connect ( websocket , user_id ) try : # \u5b9a\u4e49\u7279\u6b8a\u503c\u7684\u56de\u590d\uff0c\u914d\u5408\u524d\u7aef\u5b9e\u73b0\u786e\u5b9a\u8fde\u63a5\uff0c\u5fc3\u8df3\u68c0\u6d4b\u7b49\u903b\u8f91 questions_and_answers_map : dict = { \"HELLO SERVER\" : F \"hello { user_id } \" , \"HEARTBEAT\" : F \" { user_id } \" , } # \u5b58\u50a8\u8fde\u63a5\u540e\u83b7\u53d6\u6d88\u606f msg_records = await PityNotificationDao . list_messages ( msg_type = MessageTypeEnum . all . value , receiver = user_id , msg_status = MessageStateEnum . unread . value ) # \u5982\u679c\u6709\u672a\u8bfb\u6d88\u606f, \u5219\u63a8\u9001\u7ed9\u524d\u7aef\u5bf9\u5e94\u7684count if len ( msg_records ) > 0 : await websocket . send_json ( WebSocketMessage . msg_count ( len ( msg_records ), True )) while True : data : str = await websocket . receive_text () if ( du := data . upper ()) in questions_and_answers_map : await ws_manage . send_personal_message ( message = questions_and_answers_map . get ( du ), websocket = websocket ) except WebSocketDisconnect : if user_id in ws_manage . active_connections : ws_manage . disconnect ( user_id ) except Exception as e : print ( e ) \u53bbmain.py\u7f16\u5199\u4e00\u4e2awebsocket\u63a5\u53e3\uff0c\u63a5\u53d7\u53c2\u6570\u662fuser_id\uff0c\u8fde\u63a5\u4e0a \u5ba2\u6237\u7aef \u4ee5\u540e\uff0c\u6211\u4eec\u4f1a\u67e5\u8be2\u8fd9\u4e2a\u7528\u6237\u7684\u6d88\u606f\u6570\u91cf\uff0c\u5e76\u53d1\u9001\u7ed9\u524d\u7aef\u3002while True\u540e\u7684\u8bed\u53e5\u7528\u4e8e\u4e3b\u52a8\u63a5\u6536\u5ba2\u6237\u7aef\u7684\u6d88\u606f\uff0c\u4f46 \u6211\u4eec\u8fd9\u4e2a\u573a\u666f\u4f3c\u4e4e\u4e0d\u592a\u9002\u7528 \u3002 \u5bf9\u65b9\u65ad\u5f00\u8fde\u63a5\u540e\u5219\u5173\u95ed\u6b64\u5904\u7684\u5ba2\u6237\u7aef\u8fde\u63a5\u3002","title":"\u8c03\u6574main.py"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28107%29%20%E7%BC%96%E5%86%99%E6%B6%88%E6%81%AF%E9%80%9A%E7%9F%A5%E5%8A%9F%E8%83%BD%283%29/#_2","text":"","title":"\u7f16\u5199\u524d\u7aef\u90e8\u5206"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28107%29%20%E7%BC%96%E5%86%99%E6%B6%88%E6%81%AF%E9%80%9A%E7%9F%A5%E5%8A%9F%E8%83%BD%283%29/#basiclayoutjsx","text":"\u5728basiclayout.jsx\u7684useEffect\u65b9\u6cd5\u5904\u7f16\u5199\u5982\u4e0b\u4ee3\u7801\uff0c\u5982\u679c\u7528\u6237\u5df2\u767b\u5f55\uff0c\u9ed8\u8ba4\u7ed9\u4e4b\u8fde\u63a5websocket\uff0c\u6536\u5230\u6d88\u606f\u8fdb\u884c\u4e00\u6b21\u5224\u65ad: \u684c\u9762\u901a\u77e5\u8fd8\u662f\u6d88\u606f\u6570\u91cf\uff0c\u5982\u679c\u662f\u6d88\u606f\u6570\u91cf\u5219\u66f4\u65b0\uff0c\u5426\u5219\u5219\u8c03\u7528notification.info\u8fdb\u884c\u63a8\u9001\u3002\u8fd9\u4e2aevent.preventDefault\u4e0d\u8981\u6f0f\u6389\uff0c\u4f1a\u5bfc\u81f4\u670d\u52a1\u7aef\u62a5\u8fde\u63a5\u5173\u95ed\u7684\u9519\u8bef\u3002","title":"BasicLayout.jsx"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28107%29%20%E7%BC%96%E5%86%99%E6%B6%88%E6%81%AF%E9%80%9A%E7%9F%A5%E5%8A%9F%E8%83%BD%283%29/#notificationjsx","text":"\u8fd9\u91cc\u7ec6\u8282\u4ee3\u7801\u5927\u5bb6\u53ef\u4ee5\u53bb\u770bgithub\u63d0\u4ea4\u8bb0\u5f55\uff0c\u5927\u6982\u7684\u6837\u5f0f\u5982\u4e0b\u56fe: \u7531\u4e8e\u4ee3\u7801\u6bd4\u8f83\u591a\uff0c\u5c31\u4e0d\u4e00\u4e00\u5c55\u793a\u4e86\u3002\u5177\u4f53\u53ef\u4ee5\u770bhttps://github.com/wuranxu/pityWeb\u91cc\u7684\u5185\u5bb9\u3002","title":"Notification.jsx"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28107%29%20%E7%BC%96%E5%86%99%E6%B6%88%E6%81%AF%E9%80%9A%E7%9F%A5%E5%8A%9F%E8%83%BD%283%29/#_3","text":"\u6211\u4eec\u624b\u52a8\u5728\u6570\u636e\u5e93\u63d2\u5165\u4e00\u6761\u6d88\u606f\u6570\u636e\uff0creceiver\u662f\u4f60\u7684\u7528\u6237id\uff0cdeleted_at\u8981\u4e3a0\u3002\u63a5\u7740\u6211\u4eec\u5237\u65b0\u4e0b\u9875\u9762: \u8fd9\u91cc\u6211\u4eec\u8fd8\u505a\u4e86 \u5220\u9664\u6d88\u606f \u548c \u5df2\u8bfb\u6d88\u606f \u7684\u529f\u80fd\uff0c\u9ed8\u8ba4\u662f\u8fdb\u5165\u8fd9\u4e2a\u9875\u9762\u5c31 \u5df2\u8bfb\u5168\u90e8\u6d88\u606f \u3002","title":"\u6d4b\u8bd5\u4e0b"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28107%29%20%E7%BC%96%E5%86%99%E6%B6%88%E6%81%AF%E9%80%9A%E7%9F%A5%E5%8A%9F%E8%83%BD%283%29/#_4","text":"\u5728run_test_plan\u65b9\u6cd5\u91cc\u9762\u52a0\u5165\u5982\u4e0b\u5224\u65ad\uff0c\u5982\u679c \u6267\u884c\u4eba \u4e0d\u4e3a0\uff0c\u4e5f\u5c31\u662f\u8bf4\u662f\u624b\u52a8\u6267\u884c\u7684\uff0c\u90a3\u4e48\u6267\u884c\u5b8c\u6bd5\u540e\u7ed9\u51fa\u6d88\u606f\u901a\u77e5: \u53ef\u4ee5\u770b\u5230\uff0c\u6267\u884c\u65f6\u95f4\u6bd4\u8f83\u4e45\u4e86\u3002\u5176\u5b9e\u8fd9\u8fb9 \u63a5\u53e3 \u5df2\u7ecf\u5f02\u6b65\u8fd4\u56de\u4e86\uff0c\u4f46\u6d88\u606f\u63a8\u9001\u662f\u6d4b\u8bd5\u8ba1\u5212\u771f\u6b63\u6267\u884c\u5b8c\u6210\u4e86\u4e4b\u540e\u624d\u51fa\u73b0\u3002 \u8fd8\u662f\u90a3\u53e5\u8bdd\uff0c\u5b9e\u73b0\u5f97\u5f88\u7c97\u7cd9\uff0c\u5305\u62ec\u5e7f\u64ad\u6d88\u606f\u7684\u5904\u7406\uff0c\u8fd8\u6709\u6d88\u606f\u901a\u77e5\uff0c\u6709\u5f88\u591a\u7455\u75b5\u3002 \u5927\u91cf\u6d88\u606f\u5b58\u50a8 websocket\u81ea\u52a8\u91cd\u8fde\u5565\u7684\uff0c\u57fa\u672c\u90fd\u6ca1\u6709\u5904\u7406 \u7b49\u95ee\u9898\u51fa\u73b0\u4e86\u518d\u6162\u6162\u4fee\u4fee\u8865\u8865\u5427\u3002","title":"\u6d4b\u8bd5\u4e0b\u684c\u9762\u901a\u77e5"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28108%29%20%E6%B7%BB%E5%8A%A0%E5%85%A8%E5%B1%80%E9%A1%B6%E9%83%A8%E8%BF%9B%E5%BA%A6%E6%9D%A1/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u5b8c\u6210\u4e86 \u7528\u4f8b\u7edf\u8ba1 \u76f8\u5173\u5185\u5bb9\uff0c\u968f\u7740\u529f\u80fd\u70b9\u7684\u6e10\u6e10\u5b8c\u5584\u3002\u6211\u4eec\u4e5f\u5f97\u66f4\u6ce8\u91cd\u4e00\u4e0b \u7528\u6237\u4f53\u9a8c \uff0c\u4eca\u5929\u6211\u4eec\u5c31\u6765\u8bb2\u4e0b\u5982\u4f55\u5b8c\u6210\u5168\u5c40\u9876\u90e8\u8fdb\u5ea6\u6761\u529f\u80fd\u3002 \u9876\u90e8\u8fdb\u5ea6\u6761 \u7ecf\u5e38\u901bgithub\u7684\u670b\u53cb\uff0c\u5e94\u8be5\u90fd\u770b\u5230\u8fc7\u8fd9\u6837\u7684 \u8fdb\u5ea6\u6761 \uff0c\u6211\u4eec\u6765\u770b\u770bgif\u56de\u5fc6\u4e0b: \u6ce8\u610f\u5230\u9876\u90e8\u7684 \u84dd\u8272\u8fdb\u5ea6\u6761 \u4e86\u5417\uff1f\u8fd9\u4e2a\u5c31\u662f\u6211\u4eec\u4eca\u5929\u8981\u641e\u5b9a\u7684\u90e8\u5206\u3002 \u867d\u7136Ant Design Pro\u5df2\u7ecf\u6709\u4e86\u5168\u5c40\u7684loading\uff0c\u4f46\u662f\u5176\u5b9e\u6211\u4e2a\u4eba\u662f\u89c9\u5f97\u90a3\u4e2a\u6548\u679c\u592a \u7c97\u9c81 \u4e86\uff0c\u9876\u90e8\u8fdb\u5ea6\u6761\u76f8\u5bf9\u6765\u8bf4\u4f1a\u6e29\u548c\u4e00\u70b9\u3002 \u7ec4\u4ef6\u9009\u578b \u5176\u5b9e\u5728antd\u5b98\u7f51\u6709\u4e2a \u7cbe\u9009\u7ec4\u4ef6 \u7684\u9875\u9762\uff0c\u5927\u5bb6\u6709\u7c7b\u4f3c\u9700\u6c42\u90fd\u53ef\u4ee5\u53bb\u90a3\u8fb9\u770b\u770b\u6709\u6ca1\u6709\u5408\u9002\u7684\uff0c\u6bd5\u7adf\u4eba\u5b98\u7f51\u90fd\u63a8\u8350\u7684\uff0c\u90a3\u80af\u5b9a\u4e0d\u4f1a\u5dee\u5230\u54ea\u53bb\u3002 \u6211\u4eec\u5728\u63a8\u8350\u7ec4\u4ef6\u91cc\u9762\u627e\u5230\u8fd9\u6837\u4e00\u4e2a\u7ec4\u4ef6: nprogress \u65e2\u7136\u53ea\u6709\u4e00\u4e2a\uff0c\u90a3\u5c31\u5b83\u4e86\u3002\uff08\u6bd5\u7adf\u4e5f\u597d\u50cf\u6ca1\u5f97\u9009\u4e86\uff09 \u7814\u7a76\u4e0bapi api\u5f88\u7b80\u5355: import\u540estart\uff0c\u7b49\u9875\u9762\u52a0\u8f7d\u5b8c\u6bd5\u4e86\u8c03\u7528done\u65b9\u6cd5\u5373\u53ef\u3002 \u6539\u9020BasicLayout \u56e0\u4e3a\u6211\u4eec\u6574\u4e2a\u9875\u9762\u867d\u7136\u770b\u8d77\u6765\u662f \u52a8\u6001 \u7684\uff0c\u4f46\u5176\u5b9e\u662f\u5728\u4e0d\u65ad\u66f4\u6362BasicLayout\u7684chidren\uff0c\u800c\u767b\u5f55\u9875\u9762\u867d\u7136\u662fUserLayout\uff0c\u4f46\u597d\u50cf\u4e5f\u6ca1\u5565\u597dloading\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u6539\u9020BasicLayout\u8fd9\u4e2a\u57fa\u672c\u7ec4\u4ef6\u5373\u53ef\u3002 \u601d\u8def\u4e5f\u5f88\u7b80\u5355\uff0c\u8bbe\u5b9a\u4e00\u4e2ahref\u53d8\u91cf\uff0c\u5224\u65ad\u5f53\u524d\u7684\u8def\u7531\u4e0ehref\u662f\u5426\u76f8\u7b49\uff0c\u5982\u679c\u4e0d\u76f8\u7b49\u5219 \u8bf4\u660eurl\u5728\u53d8\u5316\uff0c\u4e5f\u5c31\u662f\u9875\u9762\u5728\u5207\u6362 \uff0c\u8fd9\u6837\u7684\u8bdd\u5c31\u8c03\u7528\u6eda\u52a8\u6761\u7684start\u548cdone\u65b9\u6cd5\u3002 \u90a3\u4ec0\u4e48\u65f6\u5019\u8c03\u7528done\u5462\uff1f \u6211\u4eec\u77e5\u9053\u7528dva\u7684connect\u8fde\u63a5\u8d77\u6765\u7684\u7ec4\u4ef6\uff0c\u5929\u7136\u5c31\u5e26\u6709dispatch\u65b9\u6cd5\u3002 \u800c\u6211\u4eecloading\u4e5f\u662f\u81ea\u5e26\u7684\u7ec4\u4ef6\uff0c\u5728loading\u53d8\u91cf\u91cc\u9762\u6709\u4e2aglobal\u53d8\u91cf\uff0c\u5982\u679c\u4e3atrue\u4ee3\u8868\u9875\u9762\u6574\u4f53\u8fd8\u672a \u52a0\u8f7d\u5b8c\u6210 \u3002 \u6240\u4ee5\u7b80\u5355\u70b9\u8bf4\u7684\u8bdd\uff0c\u6211\u4eec\u901a\u8fc7\u8bbe\u7f6e\u4e00\u4e2a\u53d8\u91cfhref\u68c0\u6d4b\u662f\u5426\u6709\u9875\u9762\u66f4\u65b0\u64cd\u4f5c\uff0c\u6709\u7684\u8bdd\u7acb\u9a6c\u8c03\u7528start\u65b9\u6cd5\uff0c\u63a5\u7740\u7b49global\u4e3afalse\uff0c\u5219\u8c03\u7528done\u65b9\u6cd5\u3002 \u5f00\u59cb\u6539\u9020 \u5982\u679c\u6ca1\u6709\u5b89\u88c5\u7684\u8bdd\uff0c\u53ef\u4ee5\u5148\u5b89\u88c5\u4e00\u4e0bnprogress: npm install nprogress --save \u5728src/layout/BasicLayout.jsx\u5f15\u5165Nprogress import NProgress from \"nprogress\"; import 'nprogress/nprogress.css' \u5f15\u5165\u6838\u5fc3\u65b9\u6cd5\u548c \u6837\u5f0f \u3002 \u914d\u7f6eloading\u6807\u5fd7 NProgress.configure({showSpinner: true}); \u8fd9\u4e00\u6b65\u7684\u76ee\u7684\u662f\u4e3a\u4e86\u5728\u8fdb\u5ea6\u6761\u6700\u53f3\u4fa7\u5c55\u793aloading\u6807\u5fd7\uff0c\u66f4\u660e\u663e\u4e00\u70b9\uff0c\u4e0d\u52a0\u8fd9\u6b65\u4e5f\u6ca1\u95ee\u9898\u3002 \u5728connect\u5904\u5e26\u5165loading export default connect(({global, settings, loading}) => ({ collapsed: global.collapsed, settings, ld: loading, }))(BasicLayout); \u6ce8\u610f\uff0c\u6211\u8fd9\u91cc\u7528ld\u53d8\u91cf\u66ff\u4ee3\u4e86loading\uff0c\u56e0\u4e3a\u53d1\u73b0\u53d8\u91cf\u540d\u53ebloading\u7684\u8bdd\u53ef\u80fd\u548cumi\u9ed8\u8ba4\u7684\u503c\u4ea7\u751f\u51b2\u7a81\uff08umi\u4e5f\u6709\u5168\u5c40loading\u5224\u65ad\uff09\uff0c\u6240\u4ee5\u6211\u6362\u6210ld\u4e86\u4e4b\u540e\u6b63\u5e38\u4e86\u3002 \u65b9\u6cd5\u4f53\u91cc\u9762\u52a0\u5165\u5982\u4e0b\u4ee3\u7801 // \u8bbe\u7f6e\u5f53\u524d\u8def\u7531\u7684\u503c\uff0c\u9ed8\u8ba4\u4e3a\u7a7a\u5b57\u7b26\u4e32 // \u4e3a\u7a7a\u5b57\u7b26\u4e32\u7684\u8bdd\uff0c\u80af\u5b9a\u548curl\u4e0d\u4e00\u81f4\uff0c\u6240\u4ee5\u7b2c\u4e00\u6b21\u80af\u5b9a\u4f1a\u751f\u6548\uff0c\u540e\u7eed\u5c31\u662f\u4fee\u6539\u751f\u6548 const [currentHref, setCurrentHref] = useState(''); // \u4eceprops\u83b7\u53d6\u5230loading->ld const {ld} = props; // \u83b7\u53d6\u5f53\u524d\u8def\u7531 const {href} = window.location; if (currentHref !== href) { // \u52a0\u8f7d\u8fdb\u5ea6\u6761 NProgress.start(); // \u5f53global\u4e3afalse\uff0c\u8bf4\u660e\u52a0\u8f7d\u5b8c\u6bd5\uff0c\u76f4\u63a5done if (!ld.global) { NProgress.done(); // \u66f4\u65b0\u5f53\u524d\u8def\u5f84 setCurrentHref(href); } } \u6211\u4eec\u6765\u770b\u4e0b\u6548\u679c\uff0c\u4e3b\u8981\u4e5f\u5c31\u662f\u770b \u5207\u6362\u83dc\u5355 \u548c \u5237\u65b0\u9875\u9762 \u7684\u65f6\u5019\uff0c\u8fdb\u5ea6\u6761\u662f\u5426\u6b63\u5e38: \u5927\u81f4\u4e0a\u6ca1\u5565\u51fa\u5165\uff0c\u4f5c\u4e3a\u4e00\u4e2a\u8981\u6c42\u4e0d\u662f\u5f88\u9ad8\u7684 \"\u524d\u7aef\" \uff0c\u505a\u5230\u8fd9\u4e2a\u6548\u679c\u5df2\u7ecf\u53ef\u4ee5\u4e86\u3002 \u60f3\u8d77\u4e4b\u524d\u662f\u6bcf\u4e2a\u8bf7\u6c42\u524dstart\uff0c\u8bf7\u6c42\u7ed3\u675f\u6267\u884cdone\uff0c\u5bf9\u6bd4\u8d77\u6765\u786e\u5b9e\u4e5f\u65b9\u4fbf\u591a\u4e86\u3002 \u4eca\u5929\u7684\u5185\u5bb9\u5c31\u5206\u4eab\u5230\u8fd9\u91cc\u4e86\uff0c \u611f\u8c22 \u5927\u5bb6\u7684\u6536\u770b\u3002","title":"108.\u6dfb\u52a0\u5168\u5c40\u9876\u90e8\u8fdb\u5ea6\u6761"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28108%29%20%E6%B7%BB%E5%8A%A0%E5%85%A8%E5%B1%80%E9%A1%B6%E9%83%A8%E8%BF%9B%E5%BA%A6%E6%9D%A1/#_1","text":"\u4e0a\u4e00\u8282\u6211\u4eec\u5b8c\u6210\u4e86 \u7528\u4f8b\u7edf\u8ba1 \u76f8\u5173\u5185\u5bb9\uff0c\u968f\u7740\u529f\u80fd\u70b9\u7684\u6e10\u6e10\u5b8c\u5584\u3002\u6211\u4eec\u4e5f\u5f97\u66f4\u6ce8\u91cd\u4e00\u4e0b \u7528\u6237\u4f53\u9a8c \uff0c\u4eca\u5929\u6211\u4eec\u5c31\u6765\u8bb2\u4e0b\u5982\u4f55\u5b8c\u6210\u5168\u5c40\u9876\u90e8\u8fdb\u5ea6\u6761\u529f\u80fd\u3002","title":"\u56de\u987e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28108%29%20%E6%B7%BB%E5%8A%A0%E5%85%A8%E5%B1%80%E9%A1%B6%E9%83%A8%E8%BF%9B%E5%BA%A6%E6%9D%A1/#_2","text":"\u7ecf\u5e38\u901bgithub\u7684\u670b\u53cb\uff0c\u5e94\u8be5\u90fd\u770b\u5230\u8fc7\u8fd9\u6837\u7684 \u8fdb\u5ea6\u6761 \uff0c\u6211\u4eec\u6765\u770b\u770bgif\u56de\u5fc6\u4e0b: \u6ce8\u610f\u5230\u9876\u90e8\u7684 \u84dd\u8272\u8fdb\u5ea6\u6761 \u4e86\u5417\uff1f\u8fd9\u4e2a\u5c31\u662f\u6211\u4eec\u4eca\u5929\u8981\u641e\u5b9a\u7684\u90e8\u5206\u3002 \u867d\u7136Ant Design Pro\u5df2\u7ecf\u6709\u4e86\u5168\u5c40\u7684loading\uff0c\u4f46\u662f\u5176\u5b9e\u6211\u4e2a\u4eba\u662f\u89c9\u5f97\u90a3\u4e2a\u6548\u679c\u592a \u7c97\u9c81 \u4e86\uff0c\u9876\u90e8\u8fdb\u5ea6\u6761\u76f8\u5bf9\u6765\u8bf4\u4f1a\u6e29\u548c\u4e00\u70b9\u3002","title":"\u9876\u90e8\u8fdb\u5ea6\u6761"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28108%29%20%E6%B7%BB%E5%8A%A0%E5%85%A8%E5%B1%80%E9%A1%B6%E9%83%A8%E8%BF%9B%E5%BA%A6%E6%9D%A1/#_3","text":"\u5176\u5b9e\u5728antd\u5b98\u7f51\u6709\u4e2a \u7cbe\u9009\u7ec4\u4ef6 \u7684\u9875\u9762\uff0c\u5927\u5bb6\u6709\u7c7b\u4f3c\u9700\u6c42\u90fd\u53ef\u4ee5\u53bb\u90a3\u8fb9\u770b\u770b\u6709\u6ca1\u6709\u5408\u9002\u7684\uff0c\u6bd5\u7adf\u4eba\u5b98\u7f51\u90fd\u63a8\u8350\u7684\uff0c\u90a3\u80af\u5b9a\u4e0d\u4f1a\u5dee\u5230\u54ea\u53bb\u3002 \u6211\u4eec\u5728\u63a8\u8350\u7ec4\u4ef6\u91cc\u9762\u627e\u5230\u8fd9\u6837\u4e00\u4e2a\u7ec4\u4ef6: nprogress \u65e2\u7136\u53ea\u6709\u4e00\u4e2a\uff0c\u90a3\u5c31\u5b83\u4e86\u3002\uff08\u6bd5\u7adf\u4e5f\u597d\u50cf\u6ca1\u5f97\u9009\u4e86\uff09","title":"\u7ec4\u4ef6\u9009\u578b"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28108%29%20%E6%B7%BB%E5%8A%A0%E5%85%A8%E5%B1%80%E9%A1%B6%E9%83%A8%E8%BF%9B%E5%BA%A6%E6%9D%A1/#api","text":"api\u5f88\u7b80\u5355: import\u540estart\uff0c\u7b49\u9875\u9762\u52a0\u8f7d\u5b8c\u6bd5\u4e86\u8c03\u7528done\u65b9\u6cd5\u5373\u53ef\u3002","title":"\u7814\u7a76\u4e0bapi"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28108%29%20%E6%B7%BB%E5%8A%A0%E5%85%A8%E5%B1%80%E9%A1%B6%E9%83%A8%E8%BF%9B%E5%BA%A6%E6%9D%A1/#basiclayout","text":"\u56e0\u4e3a\u6211\u4eec\u6574\u4e2a\u9875\u9762\u867d\u7136\u770b\u8d77\u6765\u662f \u52a8\u6001 \u7684\uff0c\u4f46\u5176\u5b9e\u662f\u5728\u4e0d\u65ad\u66f4\u6362BasicLayout\u7684chidren\uff0c\u800c\u767b\u5f55\u9875\u9762\u867d\u7136\u662fUserLayout\uff0c\u4f46\u597d\u50cf\u4e5f\u6ca1\u5565\u597dloading\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u6539\u9020BasicLayout\u8fd9\u4e2a\u57fa\u672c\u7ec4\u4ef6\u5373\u53ef\u3002 \u601d\u8def\u4e5f\u5f88\u7b80\u5355\uff0c\u8bbe\u5b9a\u4e00\u4e2ahref\u53d8\u91cf\uff0c\u5224\u65ad\u5f53\u524d\u7684\u8def\u7531\u4e0ehref\u662f\u5426\u76f8\u7b49\uff0c\u5982\u679c\u4e0d\u76f8\u7b49\u5219 \u8bf4\u660eurl\u5728\u53d8\u5316\uff0c\u4e5f\u5c31\u662f\u9875\u9762\u5728\u5207\u6362 \uff0c\u8fd9\u6837\u7684\u8bdd\u5c31\u8c03\u7528\u6eda\u52a8\u6761\u7684start\u548cdone\u65b9\u6cd5\u3002 \u90a3\u4ec0\u4e48\u65f6\u5019\u8c03\u7528done\u5462\uff1f \u6211\u4eec\u77e5\u9053\u7528dva\u7684connect\u8fde\u63a5\u8d77\u6765\u7684\u7ec4\u4ef6\uff0c\u5929\u7136\u5c31\u5e26\u6709dispatch\u65b9\u6cd5\u3002 \u800c\u6211\u4eecloading\u4e5f\u662f\u81ea\u5e26\u7684\u7ec4\u4ef6\uff0c\u5728loading\u53d8\u91cf\u91cc\u9762\u6709\u4e2aglobal\u53d8\u91cf\uff0c\u5982\u679c\u4e3atrue\u4ee3\u8868\u9875\u9762\u6574\u4f53\u8fd8\u672a \u52a0\u8f7d\u5b8c\u6210 \u3002 \u6240\u4ee5\u7b80\u5355\u70b9\u8bf4\u7684\u8bdd\uff0c\u6211\u4eec\u901a\u8fc7\u8bbe\u7f6e\u4e00\u4e2a\u53d8\u91cfhref\u68c0\u6d4b\u662f\u5426\u6709\u9875\u9762\u66f4\u65b0\u64cd\u4f5c\uff0c\u6709\u7684\u8bdd\u7acb\u9a6c\u8c03\u7528start\u65b9\u6cd5\uff0c\u63a5\u7740\u7b49global\u4e3afalse\uff0c\u5219\u8c03\u7528done\u65b9\u6cd5\u3002","title":"\u6539\u9020BasicLayout"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28108%29%20%E6%B7%BB%E5%8A%A0%E5%85%A8%E5%B1%80%E9%A1%B6%E9%83%A8%E8%BF%9B%E5%BA%A6%E6%9D%A1/#_4","text":"\u5982\u679c\u6ca1\u6709\u5b89\u88c5\u7684\u8bdd\uff0c\u53ef\u4ee5\u5148\u5b89\u88c5\u4e00\u4e0bnprogress: npm install nprogress --save \u5728src/layout/BasicLayout.jsx\u5f15\u5165Nprogress import NProgress from \"nprogress\"; import 'nprogress/nprogress.css' \u5f15\u5165\u6838\u5fc3\u65b9\u6cd5\u548c \u6837\u5f0f \u3002 \u914d\u7f6eloading\u6807\u5fd7 NProgress.configure({showSpinner: true}); \u8fd9\u4e00\u6b65\u7684\u76ee\u7684\u662f\u4e3a\u4e86\u5728\u8fdb\u5ea6\u6761\u6700\u53f3\u4fa7\u5c55\u793aloading\u6807\u5fd7\uff0c\u66f4\u660e\u663e\u4e00\u70b9\uff0c\u4e0d\u52a0\u8fd9\u6b65\u4e5f\u6ca1\u95ee\u9898\u3002 \u5728connect\u5904\u5e26\u5165loading export default connect(({global, settings, loading}) => ({ collapsed: global.collapsed, settings, ld: loading, }))(BasicLayout); \u6ce8\u610f\uff0c\u6211\u8fd9\u91cc\u7528ld\u53d8\u91cf\u66ff\u4ee3\u4e86loading\uff0c\u56e0\u4e3a\u53d1\u73b0\u53d8\u91cf\u540d\u53ebloading\u7684\u8bdd\u53ef\u80fd\u548cumi\u9ed8\u8ba4\u7684\u503c\u4ea7\u751f\u51b2\u7a81\uff08umi\u4e5f\u6709\u5168\u5c40loading\u5224\u65ad\uff09\uff0c\u6240\u4ee5\u6211\u6362\u6210ld\u4e86\u4e4b\u540e\u6b63\u5e38\u4e86\u3002 \u65b9\u6cd5\u4f53\u91cc\u9762\u52a0\u5165\u5982\u4e0b\u4ee3\u7801 // \u8bbe\u7f6e\u5f53\u524d\u8def\u7531\u7684\u503c\uff0c\u9ed8\u8ba4\u4e3a\u7a7a\u5b57\u7b26\u4e32 // \u4e3a\u7a7a\u5b57\u7b26\u4e32\u7684\u8bdd\uff0c\u80af\u5b9a\u548curl\u4e0d\u4e00\u81f4\uff0c\u6240\u4ee5\u7b2c\u4e00\u6b21\u80af\u5b9a\u4f1a\u751f\u6548\uff0c\u540e\u7eed\u5c31\u662f\u4fee\u6539\u751f\u6548 const [currentHref, setCurrentHref] = useState(''); // \u4eceprops\u83b7\u53d6\u5230loading->ld const {ld} = props; // \u83b7\u53d6\u5f53\u524d\u8def\u7531 const {href} = window.location; if (currentHref !== href) { // \u52a0\u8f7d\u8fdb\u5ea6\u6761 NProgress.start(); // \u5f53global\u4e3afalse\uff0c\u8bf4\u660e\u52a0\u8f7d\u5b8c\u6bd5\uff0c\u76f4\u63a5done if (!ld.global) { NProgress.done(); // \u66f4\u65b0\u5f53\u524d\u8def\u5f84 setCurrentHref(href); } } \u6211\u4eec\u6765\u770b\u4e0b\u6548\u679c\uff0c\u4e3b\u8981\u4e5f\u5c31\u662f\u770b \u5207\u6362\u83dc\u5355 \u548c \u5237\u65b0\u9875\u9762 \u7684\u65f6\u5019\uff0c\u8fdb\u5ea6\u6761\u662f\u5426\u6b63\u5e38: \u5927\u81f4\u4e0a\u6ca1\u5565\u51fa\u5165\uff0c\u4f5c\u4e3a\u4e00\u4e2a\u8981\u6c42\u4e0d\u662f\u5f88\u9ad8\u7684 \"\u524d\u7aef\" \uff0c\u505a\u5230\u8fd9\u4e2a\u6548\u679c\u5df2\u7ecf\u53ef\u4ee5\u4e86\u3002 \u60f3\u8d77\u4e4b\u524d\u662f\u6bcf\u4e2a\u8bf7\u6c42\u524dstart\uff0c\u8bf7\u6c42\u7ed3\u675f\u6267\u884cdone\uff0c\u5bf9\u6bd4\u8d77\u6765\u786e\u5b9e\u4e5f\u65b9\u4fbf\u591a\u4e86\u3002 \u4eca\u5929\u7684\u5185\u5bb9\u5c31\u5206\u4eab\u5230\u8fd9\u91cc\u4e86\uff0c \u611f\u8c22 \u5927\u5bb6\u7684\u6536\u770b\u3002","title":"\u5f00\u59cb\u6539\u9020"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28109%29%20%E6%8E%A5%E5%85%A5grpc%E7%9B%B8%E5%85%B3%E6%80%9D%E8%B7%AF%281%29/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \u56de\u987e \u4e0a\u8282\u6211\u4eec \u618b \u51fa\u4e86\u6d88\u606f\u4e2d\u5fc3\u76f8\u5173\u7684\u5185\u5bb9\uff0c\u8d28\u91cf\u8f83\u4f4e\uff0c\u5e0c\u671b\u5404\u4f4d\u8f7b\u62cd\u3002\u4eca\u5929\u6211\u4eec\u6765\u804a\u804a\u5bf9\u4e8egrpc\u652f\u6301\u7684\u4e8b\u60c5\u3002 \u4e3a\u4ec0\u4e48\u8981\u652f\u6301grpc \u968f\u7740postman\u5728\u65b0\u7248\u672c\u5df2\u7ecf\u652f\u6301\u4e86 GRPC \u534f\u8bae\u7684\u63a5\u53e3\u8c03\u8bd5\u529f\u80fd\uff0c\u5f88\u591a\u6d4b\u8bd5\u5f00\u53d1\u5de5\u7a0b\u5e08\u8868\u793a\u53ef\u4ee5\"\u6284\"\u8d77\u6765\u4e86\u3002\u7531\u4e8e\u4e4b\u524d\u516c\u53f8\u6709\u7528\u5230grpc\uff0c\u6240\u4ee5\u6211\u5728\u6d4b\u8bd5\u5e73\u53f0\u7684\u8bbe\u8ba1\u4e4b\u521d\u5c31\u8003\u8651\u8fc7\u5982\u4f55\u652f\u6301grpc\u534f\u8bae\u7684\u63a5\u53e3\u6d4b\u8bd5\u3002\u4e3a\u6b64\u6211\u4e5f\u8c03\u7814\uff0c\u5c1d\u8bd5\u4e86\u8bb8\u591a\u76f8\u5173\u7684\u5de5\u5177\u3002 \u75db\u96be\u70b9 grpc\u6700\u5927\u7684\u75db\u70b9\u6211\u89c9\u5f97\u6709\u4ee5\u4e0b\u51e0\u4e2a\uff0c\u5982\u679c\u90fd\u80fd \u5b8c\u7f8e\u652f\u6301 \u7684\u8bdd\uff0c\u90a3\u5c06\u4f1a\u662f\u4e00\u6b3e\u5f88\u597d\u7528\u7684\u8c03\u8bd5\u5de5\u5177\u3002\u4e0b\u9762\u6211\u5c06\u4e00\u4e00\u4ecb\u7ecd\u8fd9\u4e9b\u75db\u96be\u70b9\u3002 \u53c2\u8003\u8d44\u6599\u5c11\u4e4b\u53c8\u5c11 \u5176\u5b9e\u4e1a\u5185\u57fa\u4e8egrpc\u5b9e\u73b0\u7684\u5f00\u6e90\u9879\u76ee\u6709\u4e0d\u5c11\uff0c\u6bd4\u5982 etcd \u5c31\u662f\uff0c\u4f46\u8bb2\u5b9e\u8bdd\uff0c\u53ef\u4ee5\u53c2\u8003\u7684\u4f8b\u5b50\u8fd8\u771f\u4e0d\u591a\u3002\u4ee5\u5b98\u7f51\u4e3a\u4f8b\u7684\u8bdd\uff0cgrpc\u4f5c\u4e3a\u4e00\u6b3e\u5f00\u6e90\u7684rpc\u6846\u67b6\uff0c\u5b98\u65b9\u6587\u6863 \u66f4\u591a\u7684 \u4ecb\u7ecd\u662f\u5728\u4e8e \u5982\u4f55\u7528\u5404\u79cd\u8bed\u8a00 \u5b9e\u73b0\u4e00\u4e2agrpc\u7684demo\u3002 \u6bd4\u5982\u6211\u73b0\u5728\u4f7f\u7528Python\uff0c\u8fdb\u53bb\u770b\u5b98\u7f51\uff0c\u90fd\u662f\u6bd4\u8f83\u7b80\u5355\u7684\u4f8b\u5b50\uff0c\u6709\u7ecf\u5178\u7684hello\u9879\u76ee\uff0c\u4e5f\u6709\u7a0d\u5fae\u8fdb\u9636\u4e00\u70b9\u7684stream\u3002\u4f46\u65e0\u5916\u4e4e\u90fd\u662f\u90a3\u79cddemo\u4ee3\u7801\uff0c\u80fd\u8dd1\uff0c\u4f46\u662f\u7528\u4e8e\u751f\u4ea7\u8fd8 \u5dee\u70b9\u706b\u5019 \u3002 \u603b\u7ed3\u4e0b\u6765\u4fbf\u662f\uff0c\u8d44\u6599\u5c11\u4e4b\u53c8\u5c11\uff0c\u4f01\u4e1a\u5185\u90e8\u7684\u5b9e\u73b0\u4e94\u82b1\u516b\u95e8\uff0c\u6709\u6539protoc\u63d2\u4ef6\uff0c\u6709\u7528\u7c7b\u4f3cgrpc-gateway\u5b9e\u73b0\u7684\uff0c\u4f46\u6211\u4eec\u597d\u50cf\u8fde\u4e2a\u53c2\u8003\u7684\u65b9\u5f0f\u90fd\u6ca1\u6709\u3002 \u8c03\u7528\u65b9\u5f0f\u5c40\u9650 \u4ee5Python\u8bed\u8a00\u4e3a\u4f8b\uff0c\u6211\u4eec\u5982\u679c\u60f3\u8981\u53bb\u8c03\u7528\u4e00\u4e2a grpc \u7684\u65b9\u6cd5\uff0c\u6211\u4eec\u5fc5\u987b\u5f97\u62ff\u5230proto\u6587\u4ef6\uff0c\u5e76\u7f16\u8bd1\u4e3apb\u6587\u4ef6\uff0c\u5f53\u7136\u4e5f\u53ef\u4ee5\u53ea\u8981\u7f16\u8bd1\u597d\u7684pb\u6587\u4ef6\uff0c\u518d\u6839\u636epb\u91cc\u9762\u7684Client\u5efa\u7acbstub\u5b9e\u4f8b\uff0c\u4ee5\u6211\u4e0a\u7bc7< >\u7684demo\u4ee3\u7801\u4e3a\u4f8b: import grpc import hello_pb2 from hello_pb2_grpc import HelloStub def run (): # \u5efa\u7acbchannel with grpc . insecure_channel ( 'localhost:50051' ) as channel : # \u83b7\u53d6\u5230hello\u670d\u52a1 stub = HelloStub ( channel ) # \u65b0\u5efarequest\u8bf7\u6c42\u6570\u636e request = hello_pb2 . Request ( data = \"\u7c73\u6d1b\" ) # \u8c03\u7528hi\u65b9\u6cd5 response = stub . hi ( request ) # \u6253\u5370\u8fd4\u56de\u7684\u4fe1\u606f print ( \"Greeter client received: \" , response . message ) if __name__ == '__main__' : run () \u4e0d\u96be\u770b\u51fa\uff0c\u6211\u4eec\u9700\u8981\u5148\u5f15\u5165 HelloStub \u624d\u80fd\u8c03\u7528\u5bf9\u5e94\u7684\u65b9\u6cd5\u3002\u90a3\u95ee\u9898\u6765\u4e86\uff0c\u5982\u679c\u6211\u63a5\u53e3\u591a\uff0c\u62c6\u5206\u7684\u670d\u52a1\u4e5f\u591a\uff0c\u4e0d\u540c\u8bed\u79cd\u7f16\u5199\u7684\u65b9\u6cd5\u4e5f\u591a\uff0c\u5982\u679c\u7528Python\u8c03\u7528go\u7684\u670d\u52a1\u7aef\uff0c\u90a3\u5c82\u4e0d\u662f\u8981\u8ba9go\u7684\u670d\u52a1\u7528python-grpc\u76f8\u5173\u7684protoc\u7f16\u8bd1\u51fastub\uff0c\u518d\u8fdb\u884c\u8c03\u7528\uff1f \u90a3\u4e07\u4e00\u4f60\u7528\u7684\u662f\u522b\u4eba\u7684\u670d\u52a1\uff0c\u5c31\u4f1a\u4ea7\u751f\u5404\u79cd\u5404\u6837\u7684\u95ee\u9898\uff08\u8fd9\u4e9b\u5b98\u7f51\u4e0d\u77e5\u9053\u627e\u5230\u6ca1\u6709\uff0c\u4f46\u6211\u597d\u50cf\u6ca1\u53d1\u73b0\u76f8\u5173\u7684demo\uff09\u3002 \u603b\u7ed3\u4e0b\u6765\uff0c\u8fd9\u6837\u7684\u65b9\u5f0f\u662f\u884c\u4e0d\u901a\u7684\uff0c\u4f46\u6211\u4f3c\u4e4e\u542c\u8bf4\u6709\u90e8\u5206\u516c\u53f8\u8981\u6d4b\u8bd5grpc\u63a5\u53e3\u7684\u65f6\u5019\uff0c\u4f1a\u4e0a\u4f20\u4e00\u4e2aprotoc\u7684\u6587\u4ef6\uff0c\u8fdb\u800c\u751f\u6210\u5bf9\u5e94\u7684 \u8c03\u7528\u9875\u9762 \u6216\u7ed9\u51fa\u5bf9\u5e94\u7684\u8c03\u8bd5\u65b9\u5f0f\u3002 \u5f53\u7136\u8fd9\u5757\u5185\u5bb9\u4e5f\u662f\u6709\u89e3\u51b3\u65b9\u6cd5\u7684\uff0c\u7a0d\u5fae\u6211\u4eec\u4f1a\u8bf4\u5230\u3002 \u8d1f\u8f7d\u5747\u8861\u76f8\u5173 \u73b0\u5728\u662f\u5fae\u670d\u52a1\u65f6\u4ee3\uff0c\u6211\u4eec\u7684grpc\u670d\u52a1\u80af\u5b9a\u4e5f\u662f \u591a\u8282\u70b9\u90e8\u7f72 \u7684\u3002\u4e0d\u540c\u7684\u516c\u53f8\u91c7\u7528\u7684\u670d\u52a1\u6ce8\u518c\u53d1\u73b0\u7684\u5de5\u5177\u80af\u5b9a\u90fd\u4e0d\u592a\u4e00\u6837\uff0c\u6709zk/etcd/nacos/consul\u7b49\u3002\u4f46grpc\u4f3c\u4e4e\u53ea\u63d0\u4f9b\u4e86\u5f88\u666e\u901a\u7684\u8d1f\u8f7d\u5747\u8861\u7b97\u6cd5\uff08robin\uff09\uff0c\u751a\u81f3\u8fd9\u5757\u7684\u8d44\u6599\u90fd\u7279\u5c11\uff08\u53cd\u6b63\u6211\u662f\u6ca1\u592a\u627e\u5230\uff09\u3002 \u4ee5\u6211\u4e4b\u524d\u516c\u53f8\u4e3a\u4f8b\uff0c\u6211\u4eec\u7528\u7684\u662fzk\u7ba1\u7406\u670d\u52a1\u6ce8\u518c\u4e0e\u53d1\u73b0\uff0c\u6d4b\u8bd5\u5e73\u53f0\u4e3a\u4e86\u652f\u6301grpc\u7684\u8c03\u7528\uff0c\u6211\u4eec\u6839\u636eappid\u627e\u5230zk\u91cc\u9762\u6d3b\u8dc3\u7684\u8282\u70b9\uff0c\u5e76\u8fd4\u56de\u5bf9\u5e94\u7684\u673a\u5668ip\u548c\u7aef\u53e3\uff0c\u800czk\u91cc\u9762\u4e5f\u6709\u670d\u52a1\u7684\u63a5\u53e3\u76f8\u5173\u4fe1\u606f\u7b49\u6570\u636e\uff0c\u4f1a\u4e00\u5e76\u62c9\u53d6\u4e0b\u6765\u3002 \u4f46ip\u662f\u53d8\u5316\u7684\uff0c\u4e0d\u8fc7\u4f01\u4e1a\u5185\u90e8\u4f1a\u5bf9\u670d\u52a1\u6709\u4e2agroup\u7684\u533a\u522b\uff0c\u6211\u4eec\u9009\u62e9\u4e00\u822c\u4e0d\u4f1a\u76f4\u63a5\u9009ip\uff0c\u800c\u662f\u9009group1\u6216\u8005group2\uff0c\u4f46\u8fd9\u6837\u4e00\u65e6group1\u548c2\u6709\u6545\u969c\uff08\u6bd4\u5982\u670d\u52a1\u5728\u53d1\u5e03\uff09\u90a3\u5c31\u4e0d\u592a\u53cb\u597d\uff0c\u6240\u4ee5\u8fd8\u6ca1\u5b8c\u5584\u7684\u662f\u667a\u80fd\u9009\u62e9\u670d\u52a1\u53ef\u7528\u7684\u8282\u70b9\u3002 \u8fd9\u6837\u770b\u6765\u7684\u8bdd\uff0c\u4f5c\u4e3a\u4e00\u4e2a\u6d4b\u8bd5\u5de5\u5177\uff0c\u6211\u4eec \u53ea\u7528\u8003\u8651 \u89e3\u51b3\"grpc\u5fc5\u987b\u901a\u8fc7stub\u53bb\u8c03\u7528\"\u7684\u95ee\u9898\u5c31\u884c\u4e86\u3002\u7531\u4e8e\u7bc7\u5e45\u6709\u9650\u3002\u90a3\u6211\u4eec\u4e0b\u4e00\u8282\u7ee7\u7eed\u8bb2\u8fd9\u5757\u5185\u5bb9\uff0c\u76ee\u6807\u662f\u6d4b\u8bd5\u5e73\u53f0\u80fd\u591f\u50cf\u4f7f\u7528http\u4e00\u6837\u6d4b\u8bd5grpc\u63a5\u53e3\u3002\u505a\u5230\u548c\u7c7b\u4f3cpostman\u4e00\u6837\u7684\u6548\u679c\u5373\u53ef\uff0c\u5f53\u7136\u5982\u679c\u8981\u901a\u7528\u4e00\u70b9\uff0c\u6211\u4eec\u53ef\u4ee5\u914d\u7f6ezk/etcd\u7b49\u6ce8\u518c\u4e2d\u5fc3\u7684\u5730\u5740\uff0c\u5e76\u914d\u7f6e\u8282\u70b9\u8def\u5f84\uff0c\u5b8c\u6210\u81ea\u52a8\u83b7\u53d6ip\uff0c\u667a\u80fd\u8c03\u7528\u7b49\u529f\u80fd\u3002 \u4e0b\u8282\u5173\u952e\u5b57: grpc_reflection","title":"109.\u63a5\u5165grpc\u76f8\u5173\u601d\u8def(1)"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28109%29%20%E6%8E%A5%E5%85%A5grpc%E7%9B%B8%E5%85%B3%E6%80%9D%E8%B7%AF%281%29/#_1","text":"\u4e0a\u8282\u6211\u4eec \u618b \u51fa\u4e86\u6d88\u606f\u4e2d\u5fc3\u76f8\u5173\u7684\u5185\u5bb9\uff0c\u8d28\u91cf\u8f83\u4f4e\uff0c\u5e0c\u671b\u5404\u4f4d\u8f7b\u62cd\u3002\u4eca\u5929\u6211\u4eec\u6765\u804a\u804a\u5bf9\u4e8egrpc\u652f\u6301\u7684\u4e8b\u60c5\u3002","title":"\u56de\u987e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28109%29%20%E6%8E%A5%E5%85%A5grpc%E7%9B%B8%E5%85%B3%E6%80%9D%E8%B7%AF%281%29/#grpc","text":"\u968f\u7740postman\u5728\u65b0\u7248\u672c\u5df2\u7ecf\u652f\u6301\u4e86 GRPC \u534f\u8bae\u7684\u63a5\u53e3\u8c03\u8bd5\u529f\u80fd\uff0c\u5f88\u591a\u6d4b\u8bd5\u5f00\u53d1\u5de5\u7a0b\u5e08\u8868\u793a\u53ef\u4ee5\"\u6284\"\u8d77\u6765\u4e86\u3002\u7531\u4e8e\u4e4b\u524d\u516c\u53f8\u6709\u7528\u5230grpc\uff0c\u6240\u4ee5\u6211\u5728\u6d4b\u8bd5\u5e73\u53f0\u7684\u8bbe\u8ba1\u4e4b\u521d\u5c31\u8003\u8651\u8fc7\u5982\u4f55\u652f\u6301grpc\u534f\u8bae\u7684\u63a5\u53e3\u6d4b\u8bd5\u3002\u4e3a\u6b64\u6211\u4e5f\u8c03\u7814\uff0c\u5c1d\u8bd5\u4e86\u8bb8\u591a\u76f8\u5173\u7684\u5de5\u5177\u3002","title":"\u4e3a\u4ec0\u4e48\u8981\u652f\u6301grpc"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28109%29%20%E6%8E%A5%E5%85%A5grpc%E7%9B%B8%E5%85%B3%E6%80%9D%E8%B7%AF%281%29/#_2","text":"grpc\u6700\u5927\u7684\u75db\u70b9\u6211\u89c9\u5f97\u6709\u4ee5\u4e0b\u51e0\u4e2a\uff0c\u5982\u679c\u90fd\u80fd \u5b8c\u7f8e\u652f\u6301 \u7684\u8bdd\uff0c\u90a3\u5c06\u4f1a\u662f\u4e00\u6b3e\u5f88\u597d\u7528\u7684\u8c03\u8bd5\u5de5\u5177\u3002\u4e0b\u9762\u6211\u5c06\u4e00\u4e00\u4ecb\u7ecd\u8fd9\u4e9b\u75db\u96be\u70b9\u3002 \u53c2\u8003\u8d44\u6599\u5c11\u4e4b\u53c8\u5c11 \u5176\u5b9e\u4e1a\u5185\u57fa\u4e8egrpc\u5b9e\u73b0\u7684\u5f00\u6e90\u9879\u76ee\u6709\u4e0d\u5c11\uff0c\u6bd4\u5982 etcd \u5c31\u662f\uff0c\u4f46\u8bb2\u5b9e\u8bdd\uff0c\u53ef\u4ee5\u53c2\u8003\u7684\u4f8b\u5b50\u8fd8\u771f\u4e0d\u591a\u3002\u4ee5\u5b98\u7f51\u4e3a\u4f8b\u7684\u8bdd\uff0cgrpc\u4f5c\u4e3a\u4e00\u6b3e\u5f00\u6e90\u7684rpc\u6846\u67b6\uff0c\u5b98\u65b9\u6587\u6863 \u66f4\u591a\u7684 \u4ecb\u7ecd\u662f\u5728\u4e8e \u5982\u4f55\u7528\u5404\u79cd\u8bed\u8a00 \u5b9e\u73b0\u4e00\u4e2agrpc\u7684demo\u3002 \u6bd4\u5982\u6211\u73b0\u5728\u4f7f\u7528Python\uff0c\u8fdb\u53bb\u770b\u5b98\u7f51\uff0c\u90fd\u662f\u6bd4\u8f83\u7b80\u5355\u7684\u4f8b\u5b50\uff0c\u6709\u7ecf\u5178\u7684hello\u9879\u76ee\uff0c\u4e5f\u6709\u7a0d\u5fae\u8fdb\u9636\u4e00\u70b9\u7684stream\u3002\u4f46\u65e0\u5916\u4e4e\u90fd\u662f\u90a3\u79cddemo\u4ee3\u7801\uff0c\u80fd\u8dd1\uff0c\u4f46\u662f\u7528\u4e8e\u751f\u4ea7\u8fd8 \u5dee\u70b9\u706b\u5019 \u3002 \u603b\u7ed3\u4e0b\u6765\u4fbf\u662f\uff0c\u8d44\u6599\u5c11\u4e4b\u53c8\u5c11\uff0c\u4f01\u4e1a\u5185\u90e8\u7684\u5b9e\u73b0\u4e94\u82b1\u516b\u95e8\uff0c\u6709\u6539protoc\u63d2\u4ef6\uff0c\u6709\u7528\u7c7b\u4f3cgrpc-gateway\u5b9e\u73b0\u7684\uff0c\u4f46\u6211\u4eec\u597d\u50cf\u8fde\u4e2a\u53c2\u8003\u7684\u65b9\u5f0f\u90fd\u6ca1\u6709\u3002 \u8c03\u7528\u65b9\u5f0f\u5c40\u9650 \u4ee5Python\u8bed\u8a00\u4e3a\u4f8b\uff0c\u6211\u4eec\u5982\u679c\u60f3\u8981\u53bb\u8c03\u7528\u4e00\u4e2a grpc \u7684\u65b9\u6cd5\uff0c\u6211\u4eec\u5fc5\u987b\u5f97\u62ff\u5230proto\u6587\u4ef6\uff0c\u5e76\u7f16\u8bd1\u4e3apb\u6587\u4ef6\uff0c\u5f53\u7136\u4e5f\u53ef\u4ee5\u53ea\u8981\u7f16\u8bd1\u597d\u7684pb\u6587\u4ef6\uff0c\u518d\u6839\u636epb\u91cc\u9762\u7684Client\u5efa\u7acbstub\u5b9e\u4f8b\uff0c\u4ee5\u6211\u4e0a\u7bc7< >\u7684demo\u4ee3\u7801\u4e3a\u4f8b: import grpc import hello_pb2 from hello_pb2_grpc import HelloStub def run (): # \u5efa\u7acbchannel with grpc . insecure_channel ( 'localhost:50051' ) as channel : # \u83b7\u53d6\u5230hello\u670d\u52a1 stub = HelloStub ( channel ) # \u65b0\u5efarequest\u8bf7\u6c42\u6570\u636e request = hello_pb2 . Request ( data = \"\u7c73\u6d1b\" ) # \u8c03\u7528hi\u65b9\u6cd5 response = stub . hi ( request ) # \u6253\u5370\u8fd4\u56de\u7684\u4fe1\u606f print ( \"Greeter client received: \" , response . message ) if __name__ == '__main__' : run () \u4e0d\u96be\u770b\u51fa\uff0c\u6211\u4eec\u9700\u8981\u5148\u5f15\u5165 HelloStub \u624d\u80fd\u8c03\u7528\u5bf9\u5e94\u7684\u65b9\u6cd5\u3002\u90a3\u95ee\u9898\u6765\u4e86\uff0c\u5982\u679c\u6211\u63a5\u53e3\u591a\uff0c\u62c6\u5206\u7684\u670d\u52a1\u4e5f\u591a\uff0c\u4e0d\u540c\u8bed\u79cd\u7f16\u5199\u7684\u65b9\u6cd5\u4e5f\u591a\uff0c\u5982\u679c\u7528Python\u8c03\u7528go\u7684\u670d\u52a1\u7aef\uff0c\u90a3\u5c82\u4e0d\u662f\u8981\u8ba9go\u7684\u670d\u52a1\u7528python-grpc\u76f8\u5173\u7684protoc\u7f16\u8bd1\u51fastub\uff0c\u518d\u8fdb\u884c\u8c03\u7528\uff1f \u90a3\u4e07\u4e00\u4f60\u7528\u7684\u662f\u522b\u4eba\u7684\u670d\u52a1\uff0c\u5c31\u4f1a\u4ea7\u751f\u5404\u79cd\u5404\u6837\u7684\u95ee\u9898\uff08\u8fd9\u4e9b\u5b98\u7f51\u4e0d\u77e5\u9053\u627e\u5230\u6ca1\u6709\uff0c\u4f46\u6211\u597d\u50cf\u6ca1\u53d1\u73b0\u76f8\u5173\u7684demo\uff09\u3002 \u603b\u7ed3\u4e0b\u6765\uff0c\u8fd9\u6837\u7684\u65b9\u5f0f\u662f\u884c\u4e0d\u901a\u7684\uff0c\u4f46\u6211\u4f3c\u4e4e\u542c\u8bf4\u6709\u90e8\u5206\u516c\u53f8\u8981\u6d4b\u8bd5grpc\u63a5\u53e3\u7684\u65f6\u5019\uff0c\u4f1a\u4e0a\u4f20\u4e00\u4e2aprotoc\u7684\u6587\u4ef6\uff0c\u8fdb\u800c\u751f\u6210\u5bf9\u5e94\u7684 \u8c03\u7528\u9875\u9762 \u6216\u7ed9\u51fa\u5bf9\u5e94\u7684\u8c03\u8bd5\u65b9\u5f0f\u3002 \u5f53\u7136\u8fd9\u5757\u5185\u5bb9\u4e5f\u662f\u6709\u89e3\u51b3\u65b9\u6cd5\u7684\uff0c\u7a0d\u5fae\u6211\u4eec\u4f1a\u8bf4\u5230\u3002 \u8d1f\u8f7d\u5747\u8861\u76f8\u5173 \u73b0\u5728\u662f\u5fae\u670d\u52a1\u65f6\u4ee3\uff0c\u6211\u4eec\u7684grpc\u670d\u52a1\u80af\u5b9a\u4e5f\u662f \u591a\u8282\u70b9\u90e8\u7f72 \u7684\u3002\u4e0d\u540c\u7684\u516c\u53f8\u91c7\u7528\u7684\u670d\u52a1\u6ce8\u518c\u53d1\u73b0\u7684\u5de5\u5177\u80af\u5b9a\u90fd\u4e0d\u592a\u4e00\u6837\uff0c\u6709zk/etcd/nacos/consul\u7b49\u3002\u4f46grpc\u4f3c\u4e4e\u53ea\u63d0\u4f9b\u4e86\u5f88\u666e\u901a\u7684\u8d1f\u8f7d\u5747\u8861\u7b97\u6cd5\uff08robin\uff09\uff0c\u751a\u81f3\u8fd9\u5757\u7684\u8d44\u6599\u90fd\u7279\u5c11\uff08\u53cd\u6b63\u6211\u662f\u6ca1\u592a\u627e\u5230\uff09\u3002 \u4ee5\u6211\u4e4b\u524d\u516c\u53f8\u4e3a\u4f8b\uff0c\u6211\u4eec\u7528\u7684\u662fzk\u7ba1\u7406\u670d\u52a1\u6ce8\u518c\u4e0e\u53d1\u73b0\uff0c\u6d4b\u8bd5\u5e73\u53f0\u4e3a\u4e86\u652f\u6301grpc\u7684\u8c03\u7528\uff0c\u6211\u4eec\u6839\u636eappid\u627e\u5230zk\u91cc\u9762\u6d3b\u8dc3\u7684\u8282\u70b9\uff0c\u5e76\u8fd4\u56de\u5bf9\u5e94\u7684\u673a\u5668ip\u548c\u7aef\u53e3\uff0c\u800czk\u91cc\u9762\u4e5f\u6709\u670d\u52a1\u7684\u63a5\u53e3\u76f8\u5173\u4fe1\u606f\u7b49\u6570\u636e\uff0c\u4f1a\u4e00\u5e76\u62c9\u53d6\u4e0b\u6765\u3002 \u4f46ip\u662f\u53d8\u5316\u7684\uff0c\u4e0d\u8fc7\u4f01\u4e1a\u5185\u90e8\u4f1a\u5bf9\u670d\u52a1\u6709\u4e2agroup\u7684\u533a\u522b\uff0c\u6211\u4eec\u9009\u62e9\u4e00\u822c\u4e0d\u4f1a\u76f4\u63a5\u9009ip\uff0c\u800c\u662f\u9009group1\u6216\u8005group2\uff0c\u4f46\u8fd9\u6837\u4e00\u65e6group1\u548c2\u6709\u6545\u969c\uff08\u6bd4\u5982\u670d\u52a1\u5728\u53d1\u5e03\uff09\u90a3\u5c31\u4e0d\u592a\u53cb\u597d\uff0c\u6240\u4ee5\u8fd8\u6ca1\u5b8c\u5584\u7684\u662f\u667a\u80fd\u9009\u62e9\u670d\u52a1\u53ef\u7528\u7684\u8282\u70b9\u3002 \u8fd9\u6837\u770b\u6765\u7684\u8bdd\uff0c\u4f5c\u4e3a\u4e00\u4e2a\u6d4b\u8bd5\u5de5\u5177\uff0c\u6211\u4eec \u53ea\u7528\u8003\u8651 \u89e3\u51b3\"grpc\u5fc5\u987b\u901a\u8fc7stub\u53bb\u8c03\u7528\"\u7684\u95ee\u9898\u5c31\u884c\u4e86\u3002\u7531\u4e8e\u7bc7\u5e45\u6709\u9650\u3002\u90a3\u6211\u4eec\u4e0b\u4e00\u8282\u7ee7\u7eed\u8bb2\u8fd9\u5757\u5185\u5bb9\uff0c\u76ee\u6807\u662f\u6d4b\u8bd5\u5e73\u53f0\u80fd\u591f\u50cf\u4f7f\u7528http\u4e00\u6837\u6d4b\u8bd5grpc\u63a5\u53e3\u3002\u505a\u5230\u548c\u7c7b\u4f3cpostman\u4e00\u6837\u7684\u6548\u679c\u5373\u53ef\uff0c\u5f53\u7136\u5982\u679c\u8981\u901a\u7528\u4e00\u70b9\uff0c\u6211\u4eec\u53ef\u4ee5\u914d\u7f6ezk/etcd\u7b49\u6ce8\u518c\u4e2d\u5fc3\u7684\u5730\u5740\uff0c\u5e76\u914d\u7f6e\u8282\u70b9\u8def\u5f84\uff0c\u5b8c\u6210\u81ea\u52a8\u83b7\u53d6ip\uff0c\u667a\u80fd\u8c03\u7528\u7b49\u529f\u80fd\u3002 \u4e0b\u8282\u5173\u952e\u5b57: grpc_reflection","title":"\u75db\u96be\u70b9"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2811%29%20%E5%B0%81%E8%A3%85Request%E7%B1%BB/","text":"\u5c01\u88c5Request\u7c7b \u56de\u987e \u4e0a\u6b21\u6211\u4eec\u5b8c\u5584\u4e86 \u767b\u5f55\u6ce8\u518c \u76f8\u5173\u9875\u9762\uff0c\u8fd8\u6709 \u540e\u7aef\u63a5\u53e3 \uff0c\u7b97\u662f\u4ece0\u52301\u5b8c\u6210\u4e86\u4e00\u4e2a\u529f\u80fd\u7684\u7f16\u7801\u5de5\u4f5c\u3002\u53ef\u80fd\u524d\u7aef\u90e8\u5206\u4f1a\u8bb2\u7684\u6bd4\u8f83\u7c97\u7cd9\uff0c\u56e0\u4e3a\u7b2c\u4e00\u53ef\u80fd\u662f\u7b14\u8005 \u9020\u8be3 \u4e0d\u591f\uff0c\u7b2c\u4e8c\u4e5f\u8ddf\u6211\u4eec\u76f4\u63a5\u4ece\u73b0\u6709\u7684 \u6846\u67b6 \u8fdb\u884c\u6539\u9020\u6709\u5173\uff0c\u5f88\u591a\u4e1c\u897f\u4e0d\u662f\u4ece 0 \u5199\u5230 1 \uff0c\u800c\u662f\u4ece 1 \u5230 1.1 \uff0c\u4f46\u662f\u540e\u9762\u4e0d\u4e00\u6837\uff1a \u540e\u9762\u7684\u9875\u9762\u90fd\u662f\u54b1\u4eec\u81ea\u5df1\u5199\uff0c\u81ea\u5df1\u7528\uff0c\u4ece0\u5199\u52301 \u5b89\u88c5requests\u5e93 \u7ec8\u7aef\u8f93\u5165 pip3 install requests \u5e76\u6267\u884c\u3002 \u6784\u601d\u540e\u7aefRequest\u76f8\u5173\u63a5\u53e3 \u8981\u77e5\u9053\uff0c\u54b1\u4eec\u8fd9\u662f\u4e00\u4e2a\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0(\u540e\u7eed\u53ef\u80fd\u4f1a\u96c6\u6210UI\u81ea\u52a8\u5316\uff0c\u4f46\u662f\u8fd9\u4e2a\u7b14\u8005\u4e5f\u8fd8\u6ca1\u6709\u60f3\u597d)\u3002\u4e00\u4e2a\u63a5\u53e3\u81ea\u52a8\u5316\u5e73\u53f0\uff0c\u6700\u6838\u5fc3\u7684\u5f53\u7136\u662f\u5bf9api\u7684 \u8bf7\u6c42\u64cd\u4f5c \uff0c\u6240\u4ee5\u54b1\u4eec\u523b\u4e0d\u5bb9\u7f13\uff0c\u52a0\u5feb\u8fdb\u5ea6\uff0c\u8d81\u70ed\u6253\u94c1\uff0c\u6765\u70b9\u5e72\u8d27\u5427\u3002\u7528 requests \u6765\u534f\u52a9\u6211\u4eec\u5b8c\u6210\u63a5\u53e3\u81ea\u52a8\u5316\u8bf7\u6c42\u3002 \u6211\u4eec\u65b0\u5efa\u4e00\u4e2a\u6587\u4ef6: middleware/HttpClient.py import datetime import requests class Request (object) : def __init__ (self, url, session=False, **kwargs) : self.url = url self.session = session self.kwargs = kwargs if self.session: self.client = requests.session() return self.client = requests def get (self) : return self.request( \"GET\" ) @staticmethod def get_elapsed (timer: datetime.timedelta) : if timer.seconds > 0 : return f\" {timer.seconds} . {timer.microseconds // 1000 } s\" return f\" {timer.microseconds // 100 } ms\" def request (self, method: str) : status_code = 0 elapsed = \"-1ms\" try : if method.upper() == \"GET\" : response = self.client.get(self.url, **self.kwargs) elif method.upper() == 'POST' : response = self.client.post(self.url, **self.kwargs) else : response = self.client.request(method, self.url, **self.kwargs) status_code = response.status_code if status_code != 200 : return Request.response( False , status_code) elapsed = Request.get_elapsed(response.elapsed) data = response.json() return Request.response( True , 200 , data, response.headers, response.request.headers, elapsed=elapsed) except Exception as e: return Request.response( False , status_code, msg=str(e), elapsed=elapsed) def post (self) : return self.request( \"POST\" ) @staticmethod def response (status, status_code= 200 , response=None, response_header=None, request_header=None, elapsed=None, msg= \"success\" ) : request_header = {k: v for k, v in request_header.items()} response_header = {k: v for k, v in response_header.items()} return { \"status\" : status, \"response\" : response, \"status_code\" : status_code, \"response_header\" : response_header, \"request_header\" : request_header, \"msg\" : msg, \"elapsed\" : elapsed, } \u5982\u679c\u6211\u662f\u4ea7\u54c1\u7ecf\u7406\u7684\u8bdd\uff0c\u90a3\u4e48postman\u5c31\u662f\u6211\u7684\u539f\u578b\u56fe: \u8bb2\u89e3\u4e00\u4e0b\u5404\u4e2a\u65b9\u6cd5\uff0c\u9996\u5148\u8fd9\u662f\u4e00\u4e2a Request \u8bf7\u6c42\u7c7b\uff0c\u4ed6\u62e5\u6709\u6838\u5fc3\u65b9\u6cd5: request \uff0c\u76ee\u524d\u54b1\u4eec\u6682\u65f6\u5148\u53ea\u505a\u5230\u652f\u6301json\u7c7b\u7684\u8bf7\u6c42\uff0c\u540e\u7eed\u8865\u5168 form , file \u7b49\u7c7b\u578b\u7684\u8bf7\u6c42\u3002 \u5176\u5b9e\u8fd9\u4e2a\u7c7b\u505a\u7684\u4e8b\u60c5\u5f88\u7b80\u5355\uff0c\u5c31\u662f\u628arequests\u76f8\u5173\u7684\u65b9\u6cd5\u5265\u79bb\u4e86\u51fa\u6765\uff0c\u5c01\u88c5\u4e86\u4e00\u5c42\u3002 \u5176\u4e2d \u6784\u9020\u51fd\u6570 \u63d0\u4f9b\u4e86\u4e00\u4e9b\u9009\u9879\uff0c\u5305\u62ec\u8bf7\u6c42\u7684\u4fe1\u606f\uff0curl\uff0c\u662f\u5426\u4ee5session\u7684\u65b9\u5f0f\u8bf7\u6c42\u7b49\u7b49\uff0ckwargs\u6db5\u76d6\u4e86requests\u539f\u751f\u7684\u53c2\u6570\uff0c\u53ea\u8981\u4f60\u60f3\u4f20\uff0c\u4f60\u90fd\u53ef\u4ee5\u4f20\u8fdb\u6765\u3002 get_elapsed \u662f\u6839\u636epostman\u4e3a\u53c2\u7167\uff0c\u5bf9\u8bf7\u6c42\u65f6\u95f4\u505a\u7684\u4e00\u4e2a\u5904\u7406\uff0c\u5982\u679c\u5927\u4e8e1s\u7684\u8bf7\u6c42\u54cd\u5e94\u65f6\u95f4\uff0c\u90a3\u6211\u4eec\u4ee5 \u79d2 \u4e3a\u5355\u4f4d\u663e\u793a\uff0c\u5426\u5219\u4ee5 \u6beb\u79d2 \u4e3a\u5355\u4f4d\u663e\u793a\u3002 response \u662f\u6784\u9020\u8fd4\u56de\u7ed3\u6784\u5bf9\u8c61\uff0c\u5bf9\u672c\u6b21\u8bf7\u6c42\u7684\u6570\u636e\u8fdb\u884c\u6574\u7406\u3002 request \u5c31\u5c01\u88c5\u4e86requests\u5e93\u7684\u6838\u5fc3\u64cd\u4f5c\uff0c\u57fa\u672c\u4e0a\u5c5e\u4e8e\u539f\u751f\u5904\u7406\uff0c\u5e76\u4e14\u5224\u65ad\u4e86http\u72b6\u6001\u7801\u3002 \u7f16\u5199request\u63a5\u53e3 \u65b0\u5efacontrollers/request/http.py from flask import Blueprint from flask import jsonify from flask import request from app.middleware.HttpClient import Request req = Blueprint( \"request\" , __name__, url_prefix= \"/request\" ) @req.route(\"/http\", methods=['POST']) def http_request () : data = request.get_json() method = data.get( \"method\" ) if not method: return jsonify(dict(code= 101 , msg= \"\u8bf7\u6c42\u65b9\u5f0f\u4e0d\u80fd\u4e3a\u7a7a\" )) url = data.get( \"url\" ) if not url: return jsonify(dict(code= 101 , msg= \"\u8bf7\u6c42\u5730\u5740\u4e0d\u80fd\u4e3a\u7a7a\" )) body = data.get( \"body\" ) headers = data.get( \"headers\" ) r = Request(url, data=body, headers=headers) response = r.request(method) return jsonify(dict(code= 0 , data=response, msg= \"\u64cd\u4f5c\u6210\u529f\" )) \u5176\u5b9e\u548c\u767b\u5f55/\u6ce8\u518c\u63a5\u53e3\u90fd\u5f88\u76f8\u4f3c\uff0c\u57fa\u672c\u4e0a\u5c31\u662f\u521b\u7acb\u4e86\u4e00\u4e2ablueprint\uff0c\u524d\u7f00\u662f/request\uff0c\u540e\u7eed\u5c31\u662f\u5f15\u5165\u521a\u624d\u7684request\u7c7b\uff0c\u8fdb\u884chttp\u8bf7\u6c42\uff0c\u6700\u540e\u8fd4\u56deresponse\u3002 \u8c03\u6574run.py \u6211\u4eec\u65b0\u5efa\u4e86\u4e00\u4e2a\u84dd\u56fe\uff0c\u9700\u8981\u53bbrun.py\u8fdb\u884c\u6ce8\u518c: 2\u884c\u4ee3\u7801\u641e\u5b9a from app.controllers.request.http import req pity.register_blueprint(req) \u6700\u7ec8\u7684\u6548\u679c\u5982\u56fe\u6240\u793a \u672c\u8282\u5185\u5bb9\u5c31\u5230\u8fd9\u91cc\u4e86\uff0c\u4e0b\u4e00\u8282\u54b1\u4eec\u7f16\u5199\u5c5e\u4e8e\u81ea\u5df1\u7684\u7b2c\u4e00\u4e2a\u7ec4\u4ef6: postman \u3002\u53c8\u662f\u524d\u7aef\u5185\u5bb9\u4e86\uff0c\u54b1\u4eec\u505a\u4e00\u4e2a\u63a5\u8fd1postman\u7684\u9875\u9762\u5373\u53ef\uff0c\u4e0d\u9700\u8981\u591a\u9ad8\u5927\u4e0a\uff0c\u505a\u4e1c\u897f\u8981\u6293\u4f4f\u7528\u6237\u7684\u4f7f\u7528\u4e60\u60ef\u3002\u6bd5\u7adf\u54b1\u4eec\u4e0d\u662f\ud83c\udf4e\uff0c\u5b83\u7684\u7406\u5ff5\u662f\u8ba9\u7528\u6237\u53bb\u9002\u5e94\u5b83\u3002 \u540e\u7aef\u4ee3\u7801\u5730\u5740: https://github.com/wuranxu/pity \u524d\u7aef\u4ee3\u7801\u5730\u5740: https://github.com/wuranxu/pityWeb","title":"11.\u5c01\u88c5Request\u7c7b"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28110%29%20%E6%8E%A5%E5%85%A5grpc%E7%9B%B8%E5%85%B3%E6%80%9D%E8%B7%AF%282%29/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u6d45\u8c08\u4e86\u652f\u6301grpc\u7684\u76f8\u5173\u601d\u8def\uff0c\u53ea\u629b\u51fa\u4e86\u95ee\u9898\uff0c\u4f46\u6ca1\u6709 \u89e3\u51b3\u95ee\u9898 \uff0c\u90a3\u8fd9\u4e00\u8282\u6211\u4eec\u5c31\u6765\u804a\u804a\u76f8\u5173\u7684\u89e3\u51b3\u65b9\u6848\u3002 \u6838\u5fc3\u95ee\u9898 \u56de\u5230\u4e4b\u524d\u7684\u6838\u5fc3\u95ee\u9898\uff0c\u6211\u4eec\u5728\u8fdb\u884c\u4e00\u6b21grpc\u7684\u8bf7\u6c42\u65f6\uff0c\u9996\u5148\u4e0d\u592a\u660e\u786e \u670d\u52a1\u90e8\u7f72\u7684\u5730\u5740 \uff0c\u5f53\u670d\u52a1\u662f\u591a\u8282\u70b9\u90e8\u7f72\u7684\u65f6\u5019\uff0c\u6211\u4eec\u5e0c\u671b\u80fd\u591f\u81ea\u52a8\u83b7\u53d6\u5230\u670d\u52a1\u7684ip\u548c\u7aef\u53e3\u3002\u8fd9\u4e2a\u95ee\u9898\u633a\u597d\u89e3\u51b3\uff0c\u4e1a\u5185\u5e38\u7528\u7684\u6ce8\u518c\u4e2d\u5fc3\u5c31\u90a3\u51e0\u79cd\uff0c\u8fd8\u8bb0\u5f97\u6211\u4eec\u4e4b\u524d\u8bb2\u8fc7\u7684 \u7cfb\u7edf\u8bbe\u7f6e \u9875\u9762\u5417\uff1f \u7cfb\u7edf\u8bbe\u7f6e\u91cc\u9762\u73b0\u5728\u53ef\u4ee5\u591a\u52a0\u4e00\u9879\uff0c\u6ce8\u518c\u4e2d\u5fc3\u7c7b\u578b/\u6ce8\u518c\u4e2d\u5fc3\u5730\u5740/\u670d\u52a1/\u65b9\u6cd5\u8282\u70b9\u8def\u5f84\uff0c\u6839\u636e\u914d\u7f6e\u597d\u7684\u8bbe\u7f6e\u9488\u5bf9\u4e0d\u540c\u7684\u6ce8\u518c\u4e2d\u5fc3\uff0c\u5b8c\u6210\u6211\u4eec\u60f3\u8981\u7684\u529f\u80fd\u3002 \u4f46\u8fd8\u6709\u4e00\u4e2astub\u7684\u95ee\u9898\uff0c\u8fd9\u4e2a\u867d\u7136\u6bd4\u8f83\u9ebb\u70e6\uff0c\u4f46\u4e5f \u4e0d\u662f\u6ca1\u6709\u529e\u6cd5\u89e3\u51b3 \u3002 grpcurl \u4e0a\u4e00\u8282\u6211\u4eec\u63d0\u5230\u8fc7\u4e00\u4e2a\u5173\u952e\u8bcd: grpc_reflection \u3002\u6ca1\u9519\uff0c\u8fd9\u5c31\u662f\u6211\u4eec\u89e3\u51b3\u95ee\u9898\u7684\u5173\u952e\u3002 \u5728\u4ecb\u7ecd\u53cd\u5c04\u7684\u65f6\u5019\uff0c\u6211\u4eec\u5148\u6765\u770b\u770b\u4e00\u6b3e\u5de5\u5177: grpcurl(github\u4e00\u641c\u5c31\u77e5\u9053) \u4e0d\u96be\u53d1\u73b0\uff0c\u5176\u5b9e\u5b83\u662f\u4e00\u6b3e\u7c7b\u4f3c\u4e8e CURL \u7684\u5de5\u5177\uff0c\u57fa\u4e8ego\u7f16\u5199\u3002api\u4e5f\u548ccurl\u6bd4\u8f83\u63a5\u8fd1\uff0c\u4f46\u6709\u4e2a\u95ee\u9898\uff0c\u5b83\u5e76\u6ca1\u6709\u63d0\u4f9bpython\u7684api\u3002 \u7531\u4e8e\u6211\u5177\u5907 go\u4ee3\u7801 \u7684\u9605\u8bfb\u80fd\u529b\uff0c\u6240\u4ee5\u6211\u5f88\u597d\u5947\u5b83\u662f \u600e\u4e48\u652f\u6301\u65e0proto\u8c03\u7528grpc\u63a5\u53e3 \u7684\uff0c\u4e3a\u6b64\u6211\u524d\u6bb5\u65f6\u95f4\u4e00\u76f4\u5728\u9605\u8bfb\u5b83\u7684\u6e90\u7801\u3002 \u5728\u9605\u8bfb\u4ed6\u4ee3\u7801\u7684\u65f6\u5019\uff0c\u6211\u610f\u5916\u5730\u53d1\u73b0\u4e86grpc\u7684\u4e00\u4e2a\u7279\u8d28: grpc_reflection\uff0c\u8fd9\u4e2a\u7b80\u5355\u7684\u8bf4\u5c31\u662fgrpc\u53cd\u5c04\u3002\uff08\u8d44\u6599\u4e5f\u76f8\u5f53\u5c11\uff09 \u670d\u52a1\u7aef\u5f00\u542f\u53cd\u5c04 \u5b89\u88c5grpcio-reflection pip install grpcio-reflection \u5141\u8bb8\u670d\u52a1\u5f00\u542f\u53cd\u5c04 \u8fd9\u8fb9\u522b\u5fd8\u8bb0 from grpc_reflection.v1alpha import reflection \u8fd9\u6837\u542f\u52a8\u7684\u65f6\u5019\uff0c\u670d\u52a1\u5c31\u5f00\u542f\u4e86\u53cd\u5c04\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u7528grpcurl\u8bf7\u6c42\u63a5\u53e3\u4e86\u3002 \u7b80\u5355\u7684\u8bf4\uff0c\u5728grpc\u670d\u52a1\u542f\u52a8\u7684\u65f6\u5019\uff0c\u5982\u679c\u6253\u5f00\u4e86grpc_reflection\u5f00\u5173\uff0c\u90a3\u4e48\u5b83\u4f1a\u81ea\u5e26\u989d\u5916\u7684\u51e0\u4e2agrpc\u63a5\u53e3\uff0c\u800c\u6211\u4eec\u4f7f\u7528\u7684grpcurl\u4e5f\u662f\u57fa\u4e8e\u8fd9\u4e2a\u539f\u7406\u800c\u5de5\u4f5c\u7684\u3002\u6211\u4eec\u6765\u770b\u770b\u5b83\u4eec\u4e00\u4e00\u505a\u4e86\u4e9b\u4ec0\u4e48 \u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c\u53cd\u5c04\u7684\u670d\u52a1\uff0c\u4e3b\u8981\u63d0\u4f9b\u4e86\u4e00\u4e2a\u53cd\u5c04\u670d\u52a1\uff0c\u91cc\u9762\u4f1a\u6709file_by_filename\uff0clist_services\u7b49\u65b9\u6cd5\u3002\u5176\u4e2dlist_services\u53ef\u4ee5\u5217\u4e3e\u51fa\u4f60\u8fd9\u4e2aip+port\u4e0b\u7684grpc\u670d\u52a1\u6709\u54ea\u4e9b\u670d\u52a1\uff0c\u6838\u5fc3\u7684\u5b9e\u73b0\u65b9\u6cd5\u90fd\u5728\u8fd9: \u4e3a\u6b64\u672c\u4eba\u71ac\u4e862\u5929\u5de6\u53f3\uff0c\u7ec8\u4e8e\u5b8c\u6210\u4e86\u4e00\u4e2a\u53ef\u4ee5 \u6446\u8131proto \u7684\u7c7b\u4f3cgrpcurl\u7684\u5b9e\u73b0\uff0c\u5728\u6b64\u611f\u8c22grpcurl\u63d0\u4f9b\u7684\u601d\u8def\u3002\uff08\u5bf9\u7740\u6e90\u7801debug\uff09 \u6700\u7ec8\u7684\u5b9e\u73b0\u6548\u679c\u5982\u4e0b: \u53ea\u9700\u8981\u81ea\u5df1\u5b9a\u4e49\u4e00\u4e2aStub(\u56e0\u4e3a\u53cd\u5c04\u4e5f\u662f\u4e2agrpc\u670d\u52a1\uff0c\u6240\u4ee5\u6211\u4eec\u8fd8\u662f\u5f97\u901a\u8fc7\u751f\u6210\u53cd\u5c04\u7684stub\u53bb\u83b7\u53d6\u670d\u52a1\u7684\u4fe1\u606f)\u3002 \u4e0a\u9762\u7684res\u662f\u83b7\u53d6\u670d\u52a1\u5217\u8868\u5e76\u6253\u5370\uff0c\u4e0e\u4e0b\u9762\u7684\u8c03\u7528\u6ca1\u5173\u7cfb\uff0c\u5b9e\u9645\u4e0a\u8c03\u7528\u7684\u65b9\u6cd5\u53ea\u9700\u8981: md = Stub . client ( channel , \"Hello\" , \"Edit\" ) params = dict ( data = \"\u674e\u900d\u9065\" ) data = hello_pb2 . Request ( ** params ) response = md ( data ) print ( response . message ) md\u662f\u901a\u8fc7\u53cd\u5c04\u7684\u5ba2\u6237\u7aef+\u670d\u52a1\u540d+\u65b9\u6cd5\u540d\u83b7\u53d6\u5230\u65b9\u6cd5\uff0c\u63a5\u7740\u76f4\u63a5\u4f20\u5165dict\u5373\u53ef\u8c03\u7528\u65b9\u6cd5\u3002 \u4e24\u7ea7\u53cd\u8f6c \u4e3a\u5565\u8981\u505a\u8fd9\u4e2a\u5e93\uff0c\u56e0\u4e3a\u6211\u786e\u5b9e\u6ca1\u641c\u5230\u7c7b\u4f3c\u7684\u5b9e\u73b0\u3002\u5c31\u5f53\u6211\u4f18\u5316\u4e86\u4e00\u4e9b\u7248\u672c\uff0c\u8fd8\u6ca1\u652f\u6301 \u5f02\u6b65 \uff0c\u4e5f\u6ca1\u5b8c\u5584\u5404\u79cdapi\u7684\u65f6\u5019\uff0c\u6211\u5f97\u610f\u5730\u60f3\u628a\u6211\u8fd9\u4e2a\u7248\u672c\u4f20\u5230pypi\u5e2e\u52a9\u5176\u4ed6\u4eba\u3002 \u5173\u4e8e\u547d\u540d\uff0c\u6211\u60f3\u8981\u5b83\u4ee5\u540e\u548crequests\u4e00\u6837\u597d\u7528\uff0c\u6240\u4ee5\u6211\u6beb\u4e0d\u72b9\u8c6b\u53eb\u4e86grpc-requests\uff0c\u53d1\u73b0\u4e00\u76f4\u4e0a\u4f20\u5931\u8d25\u3002 \u6211\u5728pypi\u641c\u7d22\uff0c\u7ed3\u679c\u53d1\u73b0\u4e00\u4e2a\u97e9\u56fd\u54e5\u4eec\u65e9\u5c31\u5b9e\u73b0\u4e86\uff0c\u800c\u4e14\u505a\u7684\u8fd8\u6bd4\u6211\u5c4c\u591a\u4e86\uff0c\u6211\u6bd4\u514b\u5927\u9b54\u738b\u5f53\u65f6\u8138\u90fd\u7eff\u4e86\uff01\uff01\uff01 \u6211\u4e0b\u8f7d\u4e86\u8bd5\u7528\u4e86\u4e00\u756a\uff0c\u522b\u4eba\u5df2\u7ecf\u7889\u5821\u4e86\uff0c\u800c\u4e14\u6d4b\u4e0b\u6765\u4e5f\u6ca1\u53d1\u73b0\u5565\u95ee\u9898\u3002 \u6240\u4ee5\u6211\u809d2\u5929\u809d\u4e86\u4e2a\u5bc2\u5bde\uff0c\u4e0d\u8fc7\u628a\u5177\u4f53\u7684api\u662f \u719f\u6089 \u4e86\u4e00\u904d\u3002\u6240\u4ee5\u5927\u5bb6\u5982\u679c\u6709\u7c7b\u4f3c\u9700\u6c42\uff0c\u76f4\u63a5\u7528\u8fd9\u4e2a\u5e93\u5c31\u53ef\u4ee5\u4e86\uff01\uff01\uff01 \uff08 \u6211\u8fd8\u662f\u54ac\u7740\u7259\u4f20\u4e86\u81ea\u5df1\u7684\u9879\u76ee\u5230pypi \uff09 \u8fd9\u54e5\u4eec\u8bf4\uff0c\u5982\u679c\u4f60\u7684\u670d\u52a1\u5f00\u542f\u4e86\u53cd\u5c04\uff0c\u4f60\u53ef\u4ee5\u81ea\u52a8\u83b7\u53d6\u5230\u65b9\u6cd5\u7b49\u6570\u636e\uff0c\u5426\u5219\u53ef\u4ee5\u7ee7\u7eed\u7528stub\u53bb\u8c03\u7528\u3002\u6211\u770b\u4e86\u8fd9\u54e5\u4eec\u7684\u5b9e\u73b0\uff0c\u4ee3\u7801\u786e\u5b9e\u5199\u7684\u597d\u8fc7\u6211\u5f88\u591a\u3002 \u4eca\u5929\u7684\u5185\u5bb9\u5c31\u4ecb\u7ecd\u5230\u8fd9\u91cc\u4e86\uff0c\u5173\u4e8e\u540e\u7eed\u7684\u60f3\u6cd5\uff0cgrpc\u4e5f\u662f\u53ef\u4ee5\u6839\u636e\u6587\u4ef6\u83b7\u53d6\u5230\u670d\u52a1\u4fe1\u606f\uff0c\u552f\u4e00\u6211\u4eec\u4ee5\u540e\u80fd\u505a\u7684\u5c31\u662f\u6839\u636eproto\u751f\u6210\u63a5\u53e3\u6587\u6863\u3002 \uff08\u6211\u60f3\u8fd9\u4e2a\u5c31\u7b97\u4e2a\u5356\u70b9\u5427\uff0c\u5404\u4f4d\u6709\u5174\u8da3\u4e5f\u53ef\u4ee5\u81ea\u884c\u5b9e\u73b0\u54c8\uff01\uff09","title":"110.\u63a5\u5165grpc\u76f8\u5173\u601d\u8def(2)"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28110%29%20%E6%8E%A5%E5%85%A5grpc%E7%9B%B8%E5%85%B3%E6%80%9D%E8%B7%AF%282%29/#_1","text":"\u4e0a\u4e00\u8282\u6211\u4eec\u6d45\u8c08\u4e86\u652f\u6301grpc\u7684\u76f8\u5173\u601d\u8def\uff0c\u53ea\u629b\u51fa\u4e86\u95ee\u9898\uff0c\u4f46\u6ca1\u6709 \u89e3\u51b3\u95ee\u9898 \uff0c\u90a3\u8fd9\u4e00\u8282\u6211\u4eec\u5c31\u6765\u804a\u804a\u76f8\u5173\u7684\u89e3\u51b3\u65b9\u6848\u3002","title":"\u56de\u987e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28110%29%20%E6%8E%A5%E5%85%A5grpc%E7%9B%B8%E5%85%B3%E6%80%9D%E8%B7%AF%282%29/#_2","text":"\u56de\u5230\u4e4b\u524d\u7684\u6838\u5fc3\u95ee\u9898\uff0c\u6211\u4eec\u5728\u8fdb\u884c\u4e00\u6b21grpc\u7684\u8bf7\u6c42\u65f6\uff0c\u9996\u5148\u4e0d\u592a\u660e\u786e \u670d\u52a1\u90e8\u7f72\u7684\u5730\u5740 \uff0c\u5f53\u670d\u52a1\u662f\u591a\u8282\u70b9\u90e8\u7f72\u7684\u65f6\u5019\uff0c\u6211\u4eec\u5e0c\u671b\u80fd\u591f\u81ea\u52a8\u83b7\u53d6\u5230\u670d\u52a1\u7684ip\u548c\u7aef\u53e3\u3002\u8fd9\u4e2a\u95ee\u9898\u633a\u597d\u89e3\u51b3\uff0c\u4e1a\u5185\u5e38\u7528\u7684\u6ce8\u518c\u4e2d\u5fc3\u5c31\u90a3\u51e0\u79cd\uff0c\u8fd8\u8bb0\u5f97\u6211\u4eec\u4e4b\u524d\u8bb2\u8fc7\u7684 \u7cfb\u7edf\u8bbe\u7f6e \u9875\u9762\u5417\uff1f \u7cfb\u7edf\u8bbe\u7f6e\u91cc\u9762\u73b0\u5728\u53ef\u4ee5\u591a\u52a0\u4e00\u9879\uff0c\u6ce8\u518c\u4e2d\u5fc3\u7c7b\u578b/\u6ce8\u518c\u4e2d\u5fc3\u5730\u5740/\u670d\u52a1/\u65b9\u6cd5\u8282\u70b9\u8def\u5f84\uff0c\u6839\u636e\u914d\u7f6e\u597d\u7684\u8bbe\u7f6e\u9488\u5bf9\u4e0d\u540c\u7684\u6ce8\u518c\u4e2d\u5fc3\uff0c\u5b8c\u6210\u6211\u4eec\u60f3\u8981\u7684\u529f\u80fd\u3002 \u4f46\u8fd8\u6709\u4e00\u4e2astub\u7684\u95ee\u9898\uff0c\u8fd9\u4e2a\u867d\u7136\u6bd4\u8f83\u9ebb\u70e6\uff0c\u4f46\u4e5f \u4e0d\u662f\u6ca1\u6709\u529e\u6cd5\u89e3\u51b3 \u3002","title":"\u6838\u5fc3\u95ee\u9898"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28110%29%20%E6%8E%A5%E5%85%A5grpc%E7%9B%B8%E5%85%B3%E6%80%9D%E8%B7%AF%282%29/#grpcurl","text":"\u4e0a\u4e00\u8282\u6211\u4eec\u63d0\u5230\u8fc7\u4e00\u4e2a\u5173\u952e\u8bcd: grpc_reflection \u3002\u6ca1\u9519\uff0c\u8fd9\u5c31\u662f\u6211\u4eec\u89e3\u51b3\u95ee\u9898\u7684\u5173\u952e\u3002 \u5728\u4ecb\u7ecd\u53cd\u5c04\u7684\u65f6\u5019\uff0c\u6211\u4eec\u5148\u6765\u770b\u770b\u4e00\u6b3e\u5de5\u5177: grpcurl(github\u4e00\u641c\u5c31\u77e5\u9053) \u4e0d\u96be\u53d1\u73b0\uff0c\u5176\u5b9e\u5b83\u662f\u4e00\u6b3e\u7c7b\u4f3c\u4e8e CURL \u7684\u5de5\u5177\uff0c\u57fa\u4e8ego\u7f16\u5199\u3002api\u4e5f\u548ccurl\u6bd4\u8f83\u63a5\u8fd1\uff0c\u4f46\u6709\u4e2a\u95ee\u9898\uff0c\u5b83\u5e76\u6ca1\u6709\u63d0\u4f9bpython\u7684api\u3002 \u7531\u4e8e\u6211\u5177\u5907 go\u4ee3\u7801 \u7684\u9605\u8bfb\u80fd\u529b\uff0c\u6240\u4ee5\u6211\u5f88\u597d\u5947\u5b83\u662f \u600e\u4e48\u652f\u6301\u65e0proto\u8c03\u7528grpc\u63a5\u53e3 \u7684\uff0c\u4e3a\u6b64\u6211\u524d\u6bb5\u65f6\u95f4\u4e00\u76f4\u5728\u9605\u8bfb\u5b83\u7684\u6e90\u7801\u3002 \u5728\u9605\u8bfb\u4ed6\u4ee3\u7801\u7684\u65f6\u5019\uff0c\u6211\u610f\u5916\u5730\u53d1\u73b0\u4e86grpc\u7684\u4e00\u4e2a\u7279\u8d28: grpc_reflection\uff0c\u8fd9\u4e2a\u7b80\u5355\u7684\u8bf4\u5c31\u662fgrpc\u53cd\u5c04\u3002\uff08\u8d44\u6599\u4e5f\u76f8\u5f53\u5c11\uff09","title":"grpcurl"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28110%29%20%E6%8E%A5%E5%85%A5grpc%E7%9B%B8%E5%85%B3%E6%80%9D%E8%B7%AF%282%29/#_3","text":"\u5b89\u88c5grpcio-reflection pip install grpcio-reflection \u5141\u8bb8\u670d\u52a1\u5f00\u542f\u53cd\u5c04 \u8fd9\u8fb9\u522b\u5fd8\u8bb0 from grpc_reflection.v1alpha import reflection \u8fd9\u6837\u542f\u52a8\u7684\u65f6\u5019\uff0c\u670d\u52a1\u5c31\u5f00\u542f\u4e86\u53cd\u5c04\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u7528grpcurl\u8bf7\u6c42\u63a5\u53e3\u4e86\u3002 \u7b80\u5355\u7684\u8bf4\uff0c\u5728grpc\u670d\u52a1\u542f\u52a8\u7684\u65f6\u5019\uff0c\u5982\u679c\u6253\u5f00\u4e86grpc_reflection\u5f00\u5173\uff0c\u90a3\u4e48\u5b83\u4f1a\u81ea\u5e26\u989d\u5916\u7684\u51e0\u4e2agrpc\u63a5\u53e3\uff0c\u800c\u6211\u4eec\u4f7f\u7528\u7684grpcurl\u4e5f\u662f\u57fa\u4e8e\u8fd9\u4e2a\u539f\u7406\u800c\u5de5\u4f5c\u7684\u3002\u6211\u4eec\u6765\u770b\u770b\u5b83\u4eec\u4e00\u4e00\u505a\u4e86\u4e9b\u4ec0\u4e48 \u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c\u53cd\u5c04\u7684\u670d\u52a1\uff0c\u4e3b\u8981\u63d0\u4f9b\u4e86\u4e00\u4e2a\u53cd\u5c04\u670d\u52a1\uff0c\u91cc\u9762\u4f1a\u6709file_by_filename\uff0clist_services\u7b49\u65b9\u6cd5\u3002\u5176\u4e2dlist_services\u53ef\u4ee5\u5217\u4e3e\u51fa\u4f60\u8fd9\u4e2aip+port\u4e0b\u7684grpc\u670d\u52a1\u6709\u54ea\u4e9b\u670d\u52a1\uff0c\u6838\u5fc3\u7684\u5b9e\u73b0\u65b9\u6cd5\u90fd\u5728\u8fd9: \u4e3a\u6b64\u672c\u4eba\u71ac\u4e862\u5929\u5de6\u53f3\uff0c\u7ec8\u4e8e\u5b8c\u6210\u4e86\u4e00\u4e2a\u53ef\u4ee5 \u6446\u8131proto \u7684\u7c7b\u4f3cgrpcurl\u7684\u5b9e\u73b0\uff0c\u5728\u6b64\u611f\u8c22grpcurl\u63d0\u4f9b\u7684\u601d\u8def\u3002\uff08\u5bf9\u7740\u6e90\u7801debug\uff09 \u6700\u7ec8\u7684\u5b9e\u73b0\u6548\u679c\u5982\u4e0b: \u53ea\u9700\u8981\u81ea\u5df1\u5b9a\u4e49\u4e00\u4e2aStub(\u56e0\u4e3a\u53cd\u5c04\u4e5f\u662f\u4e2agrpc\u670d\u52a1\uff0c\u6240\u4ee5\u6211\u4eec\u8fd8\u662f\u5f97\u901a\u8fc7\u751f\u6210\u53cd\u5c04\u7684stub\u53bb\u83b7\u53d6\u670d\u52a1\u7684\u4fe1\u606f)\u3002 \u4e0a\u9762\u7684res\u662f\u83b7\u53d6\u670d\u52a1\u5217\u8868\u5e76\u6253\u5370\uff0c\u4e0e\u4e0b\u9762\u7684\u8c03\u7528\u6ca1\u5173\u7cfb\uff0c\u5b9e\u9645\u4e0a\u8c03\u7528\u7684\u65b9\u6cd5\u53ea\u9700\u8981: md = Stub . client ( channel , \"Hello\" , \"Edit\" ) params = dict ( data = \"\u674e\u900d\u9065\" ) data = hello_pb2 . Request ( ** params ) response = md ( data ) print ( response . message ) md\u662f\u901a\u8fc7\u53cd\u5c04\u7684\u5ba2\u6237\u7aef+\u670d\u52a1\u540d+\u65b9\u6cd5\u540d\u83b7\u53d6\u5230\u65b9\u6cd5\uff0c\u63a5\u7740\u76f4\u63a5\u4f20\u5165dict\u5373\u53ef\u8c03\u7528\u65b9\u6cd5\u3002","title":"\u670d\u52a1\u7aef\u5f00\u542f\u53cd\u5c04"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28110%29%20%E6%8E%A5%E5%85%A5grpc%E7%9B%B8%E5%85%B3%E6%80%9D%E8%B7%AF%282%29/#_4","text":"\u4e3a\u5565\u8981\u505a\u8fd9\u4e2a\u5e93\uff0c\u56e0\u4e3a\u6211\u786e\u5b9e\u6ca1\u641c\u5230\u7c7b\u4f3c\u7684\u5b9e\u73b0\u3002\u5c31\u5f53\u6211\u4f18\u5316\u4e86\u4e00\u4e9b\u7248\u672c\uff0c\u8fd8\u6ca1\u652f\u6301 \u5f02\u6b65 \uff0c\u4e5f\u6ca1\u5b8c\u5584\u5404\u79cdapi\u7684\u65f6\u5019\uff0c\u6211\u5f97\u610f\u5730\u60f3\u628a\u6211\u8fd9\u4e2a\u7248\u672c\u4f20\u5230pypi\u5e2e\u52a9\u5176\u4ed6\u4eba\u3002 \u5173\u4e8e\u547d\u540d\uff0c\u6211\u60f3\u8981\u5b83\u4ee5\u540e\u548crequests\u4e00\u6837\u597d\u7528\uff0c\u6240\u4ee5\u6211\u6beb\u4e0d\u72b9\u8c6b\u53eb\u4e86grpc-requests\uff0c\u53d1\u73b0\u4e00\u76f4\u4e0a\u4f20\u5931\u8d25\u3002 \u6211\u5728pypi\u641c\u7d22\uff0c\u7ed3\u679c\u53d1\u73b0\u4e00\u4e2a\u97e9\u56fd\u54e5\u4eec\u65e9\u5c31\u5b9e\u73b0\u4e86\uff0c\u800c\u4e14\u505a\u7684\u8fd8\u6bd4\u6211\u5c4c\u591a\u4e86\uff0c\u6211\u6bd4\u514b\u5927\u9b54\u738b\u5f53\u65f6\u8138\u90fd\u7eff\u4e86\uff01\uff01\uff01 \u6211\u4e0b\u8f7d\u4e86\u8bd5\u7528\u4e86\u4e00\u756a\uff0c\u522b\u4eba\u5df2\u7ecf\u7889\u5821\u4e86\uff0c\u800c\u4e14\u6d4b\u4e0b\u6765\u4e5f\u6ca1\u53d1\u73b0\u5565\u95ee\u9898\u3002 \u6240\u4ee5\u6211\u809d2\u5929\u809d\u4e86\u4e2a\u5bc2\u5bde\uff0c\u4e0d\u8fc7\u628a\u5177\u4f53\u7684api\u662f \u719f\u6089 \u4e86\u4e00\u904d\u3002\u6240\u4ee5\u5927\u5bb6\u5982\u679c\u6709\u7c7b\u4f3c\u9700\u6c42\uff0c\u76f4\u63a5\u7528\u8fd9\u4e2a\u5e93\u5c31\u53ef\u4ee5\u4e86\uff01\uff01\uff01 \uff08 \u6211\u8fd8\u662f\u54ac\u7740\u7259\u4f20\u4e86\u81ea\u5df1\u7684\u9879\u76ee\u5230pypi \uff09 \u8fd9\u54e5\u4eec\u8bf4\uff0c\u5982\u679c\u4f60\u7684\u670d\u52a1\u5f00\u542f\u4e86\u53cd\u5c04\uff0c\u4f60\u53ef\u4ee5\u81ea\u52a8\u83b7\u53d6\u5230\u65b9\u6cd5\u7b49\u6570\u636e\uff0c\u5426\u5219\u53ef\u4ee5\u7ee7\u7eed\u7528stub\u53bb\u8c03\u7528\u3002\u6211\u770b\u4e86\u8fd9\u54e5\u4eec\u7684\u5b9e\u73b0\uff0c\u4ee3\u7801\u786e\u5b9e\u5199\u7684\u597d\u8fc7\u6211\u5f88\u591a\u3002 \u4eca\u5929\u7684\u5185\u5bb9\u5c31\u4ecb\u7ecd\u5230\u8fd9\u91cc\u4e86\uff0c\u5173\u4e8e\u540e\u7eed\u7684\u60f3\u6cd5\uff0cgrpc\u4e5f\u662f\u53ef\u4ee5\u6839\u636e\u6587\u4ef6\u83b7\u53d6\u5230\u670d\u52a1\u4fe1\u606f\uff0c\u552f\u4e00\u6211\u4eec\u4ee5\u540e\u80fd\u505a\u7684\u5c31\u662f\u6839\u636eproto\u751f\u6210\u63a5\u53e3\u6587\u6863\u3002 \uff08\u6211\u60f3\u8fd9\u4e2a\u5c31\u7b97\u4e2a\u5356\u70b9\u5427\uff0c\u5404\u4f4d\u6709\u5174\u8da3\u4e5f\u53ef\u4ee5\u81ea\u884c\u5b9e\u73b0\u54c8\uff01\uff09","title":"\u4e24\u7ea7\u53cd\u8f6c"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28111%29%20%E5%88%A9%E7%94%A8loguru%E6%94%B9%E9%80%A0%E6%97%A5%E5%BF%97%E6%A8%A1%E5%9D%97/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u804a\u4e86grpc\u76f8\u5173\u7684\u5b9e\u73b0\u601d\u8def\uff0c\u4f46\u4e5f\u53ea\u662f\u63d0\u4f9b\u4e86\u601d\u8def\u548c \u5bf9\u5e94\u7684\u5e93 \uff0c\u4f46\u8bfb\u8005\u4eec\u9700\u8981\u65f6\u95f4\u6d88\u5316\uff0c\u6240\u4ee5\u6211\u4eec\u6765\u8f6c\u6362\u4e00\u4e0b\u601d\u7ef4\uff0c\u6765\u804a\u804a\u65e5\u5fd7\u8fd9\u5757\u5185\u5bb9\u3002 \u73b0\u6709\u65e5\u5fd7 \u867d\u7136\u73b0\u6709\u7684 \u65e5\u5fd7 \u5df2\u7ecf\u8db3\u591f\u54b1\u4eec\u4f7f\u7528\u4e86\uff0c\u4f46\u968f\u7740\u65f6\u95f4\u7684\u63a8\u79fb\uff0c\u65e5\u5fd7\u7684\u5207\u5272\uff0c\u8fd9\u4e9b\u90fd\u5f97\u8003\u8651\u8fdb\u6765\uff0c\u5426\u5219\u4f60\u5c06\u62e5\u6709\u4e00\u4e2a\u597d\u51e0\u767eMB\u7684\u65e5\u5fd7\u6587\u4ef6\u3002\u8003\u8651\u5230\u4f01\u4e1a\u5185\u90e8\u5f88\u591a\u90fd\u662f\u57fa\u4e8ees\u3001cat\u7b49\u65e5\u5fd7\u7cfb\u7edf\uff0clogbook\u7528\u8d77\u6765\u5c31\u6709\u70b9\u5e95\u6c14\u4e0d\u8db3\u4e86\u3002 \u5176\u5b9e\u4e5f\u4e0d\u7b97\u5427\uff0c\u4e3b\u8981\u662f\u89c9\u5f97loguru\u8fd9\u73a9\u610f\u633a\u4e0d\u9519\u7684\uff0c\u5f69\u8272\u7684\u4e1c\u897f\u662f\u6211\u7684\u6700\u7231\uff0c\u6211\u89c9\u5f97\u6bd4\u5355\u8c03\u7684\u63a7\u5236\u53f0\u597d\u4e0d\u5c11\u3002 \u867d\u7136logbook\u5dee\u4e0d\u591a\u80fd\u6ee1\u8db3\u6211\u7684\u9700\u6c42\uff0c\u4f46\u6211\u8fd8\u662f\u60f3\u7814\u7a76\u4e0bloguru\u3002 loguru github\u5730\u5740 : https://github.com/Delgan/loguru loguru\u662f\u4e00\u6b3e\u975e\u5e38\u4fbf\u6377\u7684\u65e5\u5fd7\u7ba1\u7406\u5de5\u5177\uff0c\u91cc\u9762\u81ea\u5e26\u4e86 \u5207\u5272\u65e5\u5fd7 \uff0c \u5f69\u8272\u8f93\u51fa \u7b49\u4e00\u7cfb\u5217\u64cd\u4f5c\uff0c\u4f46\u4eba\u5bb6api\u76f8\u5bf9\u6bd4\u8f83\u53cb\u597d\uff0c\u4e0d\u9700\u8981\u50cf logging \u90a3\u6837\u914d\u7f6e\u5f88\u591a\u5f88\u591a\u5185\u5bb9\uff0c\u800c\u4e14\u672c\u8eab\u662f\u7ebf\u7a0b\u5b89\u5168/\u8fdb\u7a0b\u5b89\u5168\u7684\uff08\u5f53\u7136\u8fd9\u662f\u5b83\u81ea\u5df1\u8bf4\u7684\uff09\u3002\u4e0b\u9762\u6211\u4eec\u5c31\u6765\u770b\u4e00\u770b\u5b83\u7684\u57fa\u672c\u7528\u6cd5\uff0c\u7528\u4e00\u5f20\u5b98\u7f51\u7684gif: \u8fd9\u4e2agif\u6f14\u793a\u7684demo\u975e\u5e38\u4e30\u5bcc\uff0c\u6709\u6253\u5370\u5230\u63a7\u5236\u53f0\u7684\uff0c\u6709\u8f93\u51fa\u5230log\u6587\u4ef6\u7684\uff0c\u8fd8\u6709\u65e5\u5fd7\u5206\u7247\u548c\u683c\u5f0f\u4ee5\u53ca\u5f02\u5e38\u7b49\u5185\u5bb9\uff0c\u4f46\u662f\u786e\u5b9e\u53ea\u5199\u4e86 \u6781\u5c11\u91cf \u7684\u4ee3\u7801\u3002 \u8001\u5b9e\u8bf4\u8fd9\u4e5f\u662f\u6211\u88ab\u4ed6\u5438\u5f15\u5230\u7684\u5730\u65b9\uff0c\u6211\u4e5f\u4eb2\u81ea\u4f53\u9a8c\u4e86\u4e00\u4e0b\uff0c\u611f\u89c9\u8fd8\u4e0d\u9519\u3002\u90a3\u6211\u4eec\u8be5\u5982\u4f55\u8fdb\u884c\u6539\u9020\u5462\uff1f\u4ece\u54ea\u91cc\u5165\u624b\u5462\uff1f \u6211\u4f1a\u628a\u672c\u6587\u5206\u4e3a2\u4e2a\u5185\u5bb9\uff0c\u7b2c\u4e00\u662f\u66ff\u6362fastapi\u81ea\u5e26\u7684\u65e5\u5fd7\u53e5\u67c4\uff0c\u7b2c\u4e8c\u5219\u662f\u7528\u5230\u6211\u4eec\u81ea\u8eab\u7684\u65e5\u5fd7\u677f\u5757\u4e2d\u3002 \u66ff\u6362fastapi\u9ed8\u8ba4\u7684\u8f93\u51fa \u5728windows\u4e0b\uff0c\u5982\u679c\u6211\u4eec\u4e0d\u91c7\u7528loguru\uff0c\u53ef\u4ee5\u770b\u5230\u65e5\u5fd7\u7684\u8f93\u51fa\u5927\u6982\u662f\u8fd9\u6837\u7684: \u975e\u5e38\u6734\u5b9e\u65e0\u534e\uff0c\u548c\u853c\u53ef\u4eb2\u3002 \u518d\u6765\u770b\u770b\u6539\u9020\u540e\u7684\u6548\u679c: \u591a\u7684\u4e0d\u8bf4\uff0c\u5c31\u4e00\u4e2a \u65f6\u95f4 \u5c31\u5df2\u7ecf\u5f88\u6709\u4f5c\u7528\u4e86\uff0c\u6709\u65f6\u5019\u4f60\u4e0d\u77e5\u9053\u670d\u52a1\u5565\u65f6\u5019\u542f\u52a8\u7684\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u901a\u8fc7\u65e5\u5fd7\u7684\u65f6\u95f4\u6765\u5224\u65ad\u3002\u66f4\u4f55\u51b5\u8fd9\u4e2a\u65e5\u5fd7\u8f93\u51fa\u5982\u6b64\u7f8e\u817b\u5462~ \u8bdd\u4e0d\u591a\u8bf4\uff0c\u7518\u8517\uff01 \u5728app/ init .py\u65b0\u589e\u4ee5\u4e0b\u5185\u5bb9 class InterceptHandler ( logging . Handler ): \"\"\" Default handler from examples in loguru documentaion. See https://loguru.readthedocs.io/en/stable/overview.html#entirely-compatible-with-standard-logging \"\"\" def emit ( self , record : logging . LogRecord ): # Get corresponding Loguru level if it exists try : level = logger . level ( record . levelname ) . name except ValueError : level = record . levelno # Find caller from where originated the logged message frame , depth = logging . currentframe (), 2 while frame . f_code . co_filename == logging . __file__ : frame = frame . f_back depth += 1 logger . opt ( depth = depth , exception = record . exc_info ) . log ( level , record . getMessage () ) def format_record ( record : dict ) -> str : \"\"\" \u8fd9\u91cc\u7684\u4ee3\u7801\u662fcopy\u7684\uff0c\u8bb0\u5f55\u65e5\u5fd7\u683c\u5f0f\u7684 Custom format for loguru loggers. Uses pformat for log any data like request/response body during debug. Works with logging if loguru handler it. Example: # >>> payload = [{\"users\":[{\"name\": \"Nick\", \"age\": 87, \"is_active\": True}, {\"name\": \"Alex\", \"age\": 27, \"is_active\": True}], \"count\": 2}] # >>> logger.bind(payload=).debug(\"users payload\") # >>> [ { 'count': 2, # >>> 'users': [ {'age': 87, 'is_active': True, 'name': 'Nick'}, # >>> {'age': 27, 'is_active': True, 'name': 'Alex'}]}] \"\"\" format_string = LOGURU_FORMAT if record [ \"extra\" ] . get ( \"payload\" ) is not None : record [ \"extra\" ][ \"payload\" ] = pformat ( record [ \"extra\" ][ \"payload\" ], indent = 4 , compact = True , width = 88 ) format_string += \" \\n <level> {extra[payload]} </level>\" format_string += \" {exception} \\n \" return format_string def make_filter ( name ): # \u8fc7\u6ee4\u64cd\u4f5c\uff0c\u5f53\u65e5\u5fd7\u8981\u9009\u62e9\u5bf9\u5e94\u7684\u65e5\u5fd7\u6587\u4ef6\u7684\u65f6\u5019\uff0c\u901a\u8fc7filter\u8fdb\u884c\u7b5b\u9009 def filter_ ( record ): return record [ \"extra\" ] . get ( \"name\" ) == name return filter_ def init_logging (): loggers = ( logging . getLogger ( name ) for name in logging . root . manager . loggerDict if name . startswith ( \"uvicorn.\" ) ) for uvicorn_logger in loggers : uvicorn_logger . handlers = [] # \u8fd9\u91cc\u7684\u64cd\u4f5c\u662f\u4e3a\u4e86\u6539\u53d8uvicorn\u9ed8\u8ba4\u7684logger\uff0c\u4f7f\u4e4b\u91c7\u7528loguru\u7684logger # change handler for default uvicorn logger intercept_handler = InterceptHandler () logging . getLogger ( \"uvicorn\" ) . handlers = [ intercept_handler ] # set logs output, level and format # logger.add(sys.stdout, level=logging.DEBUG, format=format_record, filter=make_filter('stdout')) # \u4e3apity\u6dfb\u52a0\u4e00\u4e2ainfo log\u6587\u4ef6\uff0c\u4e3b\u8981\u8bb0\u5f55debug\u548cinfo\u7ea7\u522b\u7684\u65e5\u5fd7 pity_info = os . path . join ( Config . LOG_DIR , \"pity_info.log\" ) # \u4e3apity\u6dfb\u52a0\u4e00\u4e2aerror log\u6587\u4ef6\uff0c\u4e3b\u8981\u8bb0\u5f55warning\u548cerror\u7ea7\u522b\u7684\u65e5\u5fd7 pity_error = os . path . join ( Config . LOG_DIR , \"pity_error.log\" ) logger . add ( pity_info , enqueue = True , rotation = \"20 MB\" , level = \"DEBUG\" , filter = make_filter ( \"pity_info\" )) logger . add ( pity_error , enqueue = True , rotation = \"10 MB\" , level = \"WARNING\" , filter = make_filter ( \"pity_error\" )) # \u914d\u7f6eloguru\u7684\u65e5\u5fd7\u53e5\u67c4\uff0csink\u4ee3\u8868\u8f93\u51fa\u7684\u76ee\u6807 logger . configure ( handlers = [ { \"sink\" : sys . stdout , \"level\" : logging . DEBUG , \"format\" : format_record }, { \"sink\" : pity_info , \"level\" : logging . INFO , \"format\" : format_record , \"filter\" : make_filter ( \"pity_info\" )}, { \"sink\" : pity_error , \"level\" : logging . WARNING , \"format\" : format_record , \"filter\" : make_filter ( \"pity_error\" )} ] ) return logger \u8fd9\u91cc\u7684\u4ee3\u7801\u770b\u4f3c\u5f88\u590d\u6742\uff0c\u5b9e\u9645\u4e0a InterceptHandler \u8fd9\u4e2a\u7c7b\u662f\u7528\u4e8e\u5b9a\u4e49uvicorn\u8f93\u51fa\u7684\u7c7b\uff0c\u53ef\u4ee5\u4e0d\u7528\u7ec6\u770b\uff0c\u56e0\u4e3a\u4ee3\u7801\u6211\u4e5f\u662fcopy\u7684\uff08\u5176\u5b9e\u91cc\u9762\u5927\u90e8\u5206\u90fd\u662f\u6ce8\u91ca\uff09\u3002 format_record\u5219\u662f\u63a7\u5236\u65e5\u5fd7\u8f93\u51fa\u683c\u5f0f\u7684\uff0c\u5305\u62ec\u65f6\u95f4\uff0c\u6587\u4ef6\u540d\uff0c\u4ee5\u53ca\u4f20\u5165\u5b57\u5178\u7684\u65f6\u5019\u5bf9\u5b57\u5178\u505a\u4e86\u4e00\u4e2a\u989d\u5916\u5904\u7406\u3002 \u6211\u4eec\u91cd\u70b9\u770binit_logging\u65b9\u6cd5\uff0c\u8fd9\u4e2a\u91cc\u9762\u524d\u534a\u90e8\u5206\u662f\u8fc7\u6ee4\u51fauvicorn\u7684\u9ed8\u8ba4\u65e5\u5fd7\u53e5\u67c4\uff0c\u63a5\u7740\u66ff\u6362\u3002\u540e\u9762\u662f\u65b0\u589e\u4e86pity\u76842\u79cd\u4e1a\u52a1\u65e5\u5fd7\uff08info\u548cerror\uff09\uff0c\u4e00\u51713\u4e2ahandler\u3002 \u6700\u540e\u914d\u7f6elogger\u7684\u8f93\u51fa\uff0c\u5206\u522b\u8f93\u51fa\u5230sys.stdout\uff08\u63a7\u5236\u53f0\uff09\u548cpity_info.log\u4ee5\u53capity_error.log\u3002 \uff08pity_error\u548cinfo\u91cc\u9762\u90fd\u6709\u4e2afilter\u81ea\u5e26\uff0c\u8fd9\u4e2a\u662f\u4e3a\u4e86\u914d\u5408make_filter\u7528\u7684\uff0c\u56e0\u4e3a\u65e5\u5fd7\u53e5\u67c4\u5f88\u591a\uff0c\u800clogger\u53c8\u662f\u4e00\u4e2a\u5168\u5c40\u5bf9\u8c61\uff0c\u6240\u4ee5\u65e5\u5fd7\u5230\u5e95\u8981 \u8f93\u51fa \u5230 \u54ea\u4e2a\u65e5\u5fd7\u6587\u4ef6 \uff0c\u5c31\u8981\u901a\u8fc7filter\u6765\u8fc7\u6ee4\u4e86\u3002\uff09 \u6539\u5199main.py \u5728main.py\u91cc\u9762\u5f15\u5165init_logging\u5373\u53ef\u3002\u63a5\u7740\u91cd\u542f\u670d\u52a1\uff0c\u63a7\u5236\u53f0\u5c31\u53d8\u6210\u4e86\u4e0a\u9762\u7684\u6837\u5b50\u3002 \u65b0\u589e\u53c2\u6570\u83b7\u53d6 \u6709\u65f6\u5019\u6211\u4eec\u60f3\u83b7\u53d6\u5230\u8bf7\u6c42\u7684json\u53c2\u6570\u6216\u8005form\u53c2\u6570\uff0c\u4ee5\u4fbf\u4e8e\u62a5\u9519\u7684\u65f6\u5019\u65b9\u4fbf\u627e\u5230\u5386\u53f2\u7684\u8bf7\u6c42\u6570\u636e\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5199\u4e00\u4e2a\u4e2d\u95f4\u4ef6: async def request_info ( request : Request ): logger . bind ( name = None ) . info ( f \" { request . method } { request . url } \" ) try : body = await request . json () logger . bind ( payload = body , name = None ) . debug ( \"request_json: \" ) except : body = await request . body () if len ( body ) != 0 : # \u6709\u8bf7\u6c42\u4f53\uff0c\u8bb0\u5f55\u65e5\u5fd7 logger . bind ( payload = body , name = None ) . debug ( body ) pity . include_router ( user . router ) pity . include_router ( project . router , dependencies = [ Depends ( request_info )]) pity . include_router ( http . router , dependencies = [ Depends ( request_info )]) pity . include_router ( testcase_router , dependencies = [ Depends ( request_info )]) pity . include_router ( config_router , dependencies = [ Depends ( request_info )]) pity . include_router ( online_router , dependencies = [ Depends ( request_info )]) pity . include_router ( oss_router , dependencies = [ Depends ( request_info )]) pity . include_router ( operation_router , dependencies = [ Depends ( request_info )]) pity . include_router ( msg_router , dependencies = [ Depends ( request_info )]) \u8fd9\u91cc\u6211\u8fc7\u6ee4\u51fa\u4e86name=None\uff08\u5373stdout\uff09\u7684\u53e5\u67c4\uff0c\u5e76\u6253\u5370\u51fa\u8bf7\u6c42\u65b9\u6cd5\u548curl\u3002\u63a5\u7740\u5224\u65ad\u662f\u4e0d\u662fjson\u6570\u636e\uff0c\u5982\u679c\u4e0d\u662f\u5219\u5224\u65ad\u6709\u6ca1\u6709body\uff0c\u5982\u679c\u6709json\u6216\u8005\u6709body\uff0c\u5219\u6253\u5370\u51fa\u6765\u3002 \u63a5\u7740\u6211\u4eec\u5728\u6bcf\u4e2arouter\u90fd\u52a0\u5165\u8fd9\u4e2a\u4f9d\u8d56\u7684\u4e2d\u95f4\u4ef6\uff08request_info\uff09\uff0c\u7528\u6237\u8def\u7531\u6ca1\u6709\u52a0\u662f\u56e0\u4e3a \u7528\u6237\u767b\u5f55\u7684\u65f6\u5019\u4f1a\u4f20\u5165\u660e\u6587\u7684\u8d26\u53f7\u5bc6\u7801\uff08js\u52a0\u5bc6\u8fd9\u91cc\u8fd8\u6ca1\u505a \u6682\u65f6\u4e5f\u4e0d\u60f3\u505a\uff09 \uff0c\u6240\u4ee5\u5982\u679c\u88ab\u6709\u5fc3\u4e4b\u4eba\u53d1\u73b0\u7684\u8bdd\u5c31\u96be\u53d7\u4e86\uff0c\u6240\u4ee5\u6211\u76f4\u63a5\u53bb\u6389\u4e86\u3002 \u6d4b\u8bd5\u4e00\u4e0b\u8bf7\u6c42\u53c2\u6570 \u56e0\u4e3aawait request.json()\u4f1a\u8fd4\u56de\u4e00\u4e2aPython\u91cc\u9762\u7684\u5bf9\u8c61\uff08\u5927\u6982\u7387\u662fdict\uff09\uff0c\u6240\u4ee5\u6253\u5370\u4f1a\u6309\u7167\u5b57\u5178\u7684\u65b9\u5f0f\u6253\u5370\u51fa\u6765\uff0c\u5927\u5bb6\u8fd9\u91cc\u9700\u8981\u7406\u89e3\u4e00\u4e0b\u3002 \u8fd9\u4e2a\u529f\u80fd\u5c31\u5f88 nice \u4e86\uff01\uff01\uff01\u4f46\u7f3a\u9677\u5c31\u662f\u76ee\u524d\u662f\u6253\u5370\u7684\u5b57\u5178\uff0c\u5982\u679c\u80fd\u6253\u5370json\u5c31\u66f4\u597d\u4e86\uff0c\u8fd9\u4e2a\u8bfb\u8005\u6709\u5174\u8da3\u53ef\u4ee5\u81ea\u5df1\u53bb\u5b9e\u73b0\u3002 \u6539\u9020\u539f\u672c\u7684Log\u7c7b import inspect import os from loguru import logger from config import Config # \u6ce8\u610f\u8fd9\u91cc # @SingletonDecorator class Log ( object ): business = None def __init__ ( self , name = 'pity' ): # Logger\u6807\u8bc6\u9ed8\u8ba4\u4e3aapp \"\"\" :param name: \u4e1a\u52a1\u540d\u79f0 \"\"\" # \u5982\u679c\u76ee\u5f55\u4e0d\u5b58\u5728\u5219\u521b\u5efa if not os . path . exists ( Config . LOG_DIR ): os . mkdir ( Config . LOG_DIR ) self . business = name self . pity_info = logger . bind ( name = \"pity_info\" ) self . pity_error = logger . bind ( name = 'pity_error' ) def info ( self , message : str ): file_name , line , func , _ , _ = inspect . getframeinfo ( inspect . currentframe () . f_back ) self . pity_info . info ( f \"func: { func } line: { line } module: { self . business } message: { message } \" ) def error ( self , message : str ): file_name , line , func , _ , _ = inspect . getframeinfo ( inspect . currentframe () . f_back ) self . pity_error . error ( f \"func: { func } line: { line } module: { self . business } message: { message } \" ) def warning ( self , message : str ): file_name , line , func , _ , _ = inspect . getframeinfo ( inspect . currentframe () . f_back ) self . pity_error . warning ( f \"func: { func } line: { line } module: { self . business } message: { message } \" ) def debug ( self , message : str ): file_name , line , func , _ , _ = inspect . getframeinfo ( inspect . currentframe () . f_back ) self . pity_info . debug ( f \"func: { func } line: { line } module: { self . business } message: { message } \" ) \u4e3a\u4e86\u4e0d\u5f71\u54cd\u4e4b\u524d\u7684\u65e5\u5fd7\u6a21\u5757\uff0c\u6240\u4ee5\u6211\u4eec\u6ca1\u6709\u5927\u6539\uff0c\u7531\u4e8e \u7cfb\u7edf\u65e5\u5fd7 \u90fd\u662fapp/utils/logger.py\u6587\u4ef6\u7684\u65b9\u6cd5\uff0c\u6240\u4ee5\u5bfc\u81f4\u81ea\u5b9a\u4e49\u7684\u65e5\u5fd7\u90fd\u4f1a\u51fa\u73b0: \u663e\u793a\u4e0d\u51fa\u6765\u771f\u6b63\u8c03\u7528log.info\u7684\u6587\u4ef6 \u8fd9\u4e2a\u95ee\u9898\u3002 \u6240\u4ee5\u6211\u8fd9\u7528\u4e86inspect\u81ea\u5e26\u7684\u6a21\u5757\uff0c\u83b7\u53d6\u5230info/error\u7b49\u65b9\u6cd5\u7684\u8c03\u7528\u65b9\uff0c\u4e00\u8d77\u6765\u770b\u770b: \u6bd4\u5982websocket\u8fd9\u91cc\uff0cxxx\u8fde\u63a5\u4e0a\u4e86\uff0c\u6211\u4eec\u770b\u770b\u65e5\u5fd7\u600e\u4e48\u5c55\u793a\u7684: \u56e0\u4e3a\u65e5\u5fd7\u7684\u8c03\u7528\u4e00\u76f4\u662flogger\u6587\u4ef6\u4e0b\u7684info\u65b9\u6cd5\uff0c\u6240\u4ee5\u6bcf\u6b21\u90fd\u4f1a\u6253\u5370app.utils.logger.info\uff0c\u800c\u6211\u4eec\u7528\u4e86inspect\u4e4b\u540e\u5c31\u4e0d\u4e00\u6837\u4e86\uff0c\u80fd\u83b7\u53d6\u5230\u771f\u5b9e\u7684\u65b9\u6cd5: \u56fe\u4e2d\u53ef\u4ee5\u770b\u5230\u662fconnect\u65b9\u6cd5\uff0c44\u884c\uff0c\u7531\u4e8e\u6587\u4ef6\u540d\u5de8\u957f\uff0c\u6240\u4ee5\u6211\u6ca1\u653e\u8fdb\u53bb\uff0c\u5176\u5b9e\u4e5f\u662f\u53ef\u4ee5\u83b7\u53d6\u5230\u7684\u3002\u611f\u5174\u8da3\u7684\u670b\u53cb\u53ef\u4ee5\u81ea\u5df1\u6539\u88c5\u4e0b\u3002 \u8fd9\u5757\u5185\u5bb9\u5c31\u5f53\u4f5c\u4e1a\u7559\u7ed9\u5927\u5bb6\u4e86\uff0c\u54b1\u4eec\u4e0b\u671f\u518d\u89c1\uff01","title":"111.\u5229\u7528loguru\u6539\u9020\u65e5\u5fd7\u6a21\u5757"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28111%29%20%E5%88%A9%E7%94%A8loguru%E6%94%B9%E9%80%A0%E6%97%A5%E5%BF%97%E6%A8%A1%E5%9D%97/#_1","text":"\u4e0a\u4e00\u8282\u6211\u4eec\u804a\u4e86grpc\u76f8\u5173\u7684\u5b9e\u73b0\u601d\u8def\uff0c\u4f46\u4e5f\u53ea\u662f\u63d0\u4f9b\u4e86\u601d\u8def\u548c \u5bf9\u5e94\u7684\u5e93 \uff0c\u4f46\u8bfb\u8005\u4eec\u9700\u8981\u65f6\u95f4\u6d88\u5316\uff0c\u6240\u4ee5\u6211\u4eec\u6765\u8f6c\u6362\u4e00\u4e0b\u601d\u7ef4\uff0c\u6765\u804a\u804a\u65e5\u5fd7\u8fd9\u5757\u5185\u5bb9\u3002","title":"\u56de\u987e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28111%29%20%E5%88%A9%E7%94%A8loguru%E6%94%B9%E9%80%A0%E6%97%A5%E5%BF%97%E6%A8%A1%E5%9D%97/#_2","text":"\u867d\u7136\u73b0\u6709\u7684 \u65e5\u5fd7 \u5df2\u7ecf\u8db3\u591f\u54b1\u4eec\u4f7f\u7528\u4e86\uff0c\u4f46\u968f\u7740\u65f6\u95f4\u7684\u63a8\u79fb\uff0c\u65e5\u5fd7\u7684\u5207\u5272\uff0c\u8fd9\u4e9b\u90fd\u5f97\u8003\u8651\u8fdb\u6765\uff0c\u5426\u5219\u4f60\u5c06\u62e5\u6709\u4e00\u4e2a\u597d\u51e0\u767eMB\u7684\u65e5\u5fd7\u6587\u4ef6\u3002\u8003\u8651\u5230\u4f01\u4e1a\u5185\u90e8\u5f88\u591a\u90fd\u662f\u57fa\u4e8ees\u3001cat\u7b49\u65e5\u5fd7\u7cfb\u7edf\uff0clogbook\u7528\u8d77\u6765\u5c31\u6709\u70b9\u5e95\u6c14\u4e0d\u8db3\u4e86\u3002 \u5176\u5b9e\u4e5f\u4e0d\u7b97\u5427\uff0c\u4e3b\u8981\u662f\u89c9\u5f97loguru\u8fd9\u73a9\u610f\u633a\u4e0d\u9519\u7684\uff0c\u5f69\u8272\u7684\u4e1c\u897f\u662f\u6211\u7684\u6700\u7231\uff0c\u6211\u89c9\u5f97\u6bd4\u5355\u8c03\u7684\u63a7\u5236\u53f0\u597d\u4e0d\u5c11\u3002 \u867d\u7136logbook\u5dee\u4e0d\u591a\u80fd\u6ee1\u8db3\u6211\u7684\u9700\u6c42\uff0c\u4f46\u6211\u8fd8\u662f\u60f3\u7814\u7a76\u4e0bloguru\u3002","title":"\u73b0\u6709\u65e5\u5fd7"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28111%29%20%E5%88%A9%E7%94%A8loguru%E6%94%B9%E9%80%A0%E6%97%A5%E5%BF%97%E6%A8%A1%E5%9D%97/#loguru","text":"github\u5730\u5740 : https://github.com/Delgan/loguru loguru\u662f\u4e00\u6b3e\u975e\u5e38\u4fbf\u6377\u7684\u65e5\u5fd7\u7ba1\u7406\u5de5\u5177\uff0c\u91cc\u9762\u81ea\u5e26\u4e86 \u5207\u5272\u65e5\u5fd7 \uff0c \u5f69\u8272\u8f93\u51fa \u7b49\u4e00\u7cfb\u5217\u64cd\u4f5c\uff0c\u4f46\u4eba\u5bb6api\u76f8\u5bf9\u6bd4\u8f83\u53cb\u597d\uff0c\u4e0d\u9700\u8981\u50cf logging \u90a3\u6837\u914d\u7f6e\u5f88\u591a\u5f88\u591a\u5185\u5bb9\uff0c\u800c\u4e14\u672c\u8eab\u662f\u7ebf\u7a0b\u5b89\u5168/\u8fdb\u7a0b\u5b89\u5168\u7684\uff08\u5f53\u7136\u8fd9\u662f\u5b83\u81ea\u5df1\u8bf4\u7684\uff09\u3002\u4e0b\u9762\u6211\u4eec\u5c31\u6765\u770b\u4e00\u770b\u5b83\u7684\u57fa\u672c\u7528\u6cd5\uff0c\u7528\u4e00\u5f20\u5b98\u7f51\u7684gif: \u8fd9\u4e2agif\u6f14\u793a\u7684demo\u975e\u5e38\u4e30\u5bcc\uff0c\u6709\u6253\u5370\u5230\u63a7\u5236\u53f0\u7684\uff0c\u6709\u8f93\u51fa\u5230log\u6587\u4ef6\u7684\uff0c\u8fd8\u6709\u65e5\u5fd7\u5206\u7247\u548c\u683c\u5f0f\u4ee5\u53ca\u5f02\u5e38\u7b49\u5185\u5bb9\uff0c\u4f46\u662f\u786e\u5b9e\u53ea\u5199\u4e86 \u6781\u5c11\u91cf \u7684\u4ee3\u7801\u3002 \u8001\u5b9e\u8bf4\u8fd9\u4e5f\u662f\u6211\u88ab\u4ed6\u5438\u5f15\u5230\u7684\u5730\u65b9\uff0c\u6211\u4e5f\u4eb2\u81ea\u4f53\u9a8c\u4e86\u4e00\u4e0b\uff0c\u611f\u89c9\u8fd8\u4e0d\u9519\u3002\u90a3\u6211\u4eec\u8be5\u5982\u4f55\u8fdb\u884c\u6539\u9020\u5462\uff1f\u4ece\u54ea\u91cc\u5165\u624b\u5462\uff1f \u6211\u4f1a\u628a\u672c\u6587\u5206\u4e3a2\u4e2a\u5185\u5bb9\uff0c\u7b2c\u4e00\u662f\u66ff\u6362fastapi\u81ea\u5e26\u7684\u65e5\u5fd7\u53e5\u67c4\uff0c\u7b2c\u4e8c\u5219\u662f\u7528\u5230\u6211\u4eec\u81ea\u8eab\u7684\u65e5\u5fd7\u677f\u5757\u4e2d\u3002","title":"loguru"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28111%29%20%E5%88%A9%E7%94%A8loguru%E6%94%B9%E9%80%A0%E6%97%A5%E5%BF%97%E6%A8%A1%E5%9D%97/#fastapi","text":"\u5728windows\u4e0b\uff0c\u5982\u679c\u6211\u4eec\u4e0d\u91c7\u7528loguru\uff0c\u53ef\u4ee5\u770b\u5230\u65e5\u5fd7\u7684\u8f93\u51fa\u5927\u6982\u662f\u8fd9\u6837\u7684: \u975e\u5e38\u6734\u5b9e\u65e0\u534e\uff0c\u548c\u853c\u53ef\u4eb2\u3002 \u518d\u6765\u770b\u770b\u6539\u9020\u540e\u7684\u6548\u679c: \u591a\u7684\u4e0d\u8bf4\uff0c\u5c31\u4e00\u4e2a \u65f6\u95f4 \u5c31\u5df2\u7ecf\u5f88\u6709\u4f5c\u7528\u4e86\uff0c\u6709\u65f6\u5019\u4f60\u4e0d\u77e5\u9053\u670d\u52a1\u5565\u65f6\u5019\u542f\u52a8\u7684\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u901a\u8fc7\u65e5\u5fd7\u7684\u65f6\u95f4\u6765\u5224\u65ad\u3002\u66f4\u4f55\u51b5\u8fd9\u4e2a\u65e5\u5fd7\u8f93\u51fa\u5982\u6b64\u7f8e\u817b\u5462~ \u8bdd\u4e0d\u591a\u8bf4\uff0c\u7518\u8517\uff01","title":"\u66ff\u6362fastapi\u9ed8\u8ba4\u7684\u8f93\u51fa"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28111%29%20%E5%88%A9%E7%94%A8loguru%E6%94%B9%E9%80%A0%E6%97%A5%E5%BF%97%E6%A8%A1%E5%9D%97/#appinitpy","text":"class InterceptHandler ( logging . Handler ): \"\"\" Default handler from examples in loguru documentaion. See https://loguru.readthedocs.io/en/stable/overview.html#entirely-compatible-with-standard-logging \"\"\" def emit ( self , record : logging . LogRecord ): # Get corresponding Loguru level if it exists try : level = logger . level ( record . levelname ) . name except ValueError : level = record . levelno # Find caller from where originated the logged message frame , depth = logging . currentframe (), 2 while frame . f_code . co_filename == logging . __file__ : frame = frame . f_back depth += 1 logger . opt ( depth = depth , exception = record . exc_info ) . log ( level , record . getMessage () ) def format_record ( record : dict ) -> str : \"\"\" \u8fd9\u91cc\u7684\u4ee3\u7801\u662fcopy\u7684\uff0c\u8bb0\u5f55\u65e5\u5fd7\u683c\u5f0f\u7684 Custom format for loguru loggers. Uses pformat for log any data like request/response body during debug. Works with logging if loguru handler it. Example: # >>> payload = [{\"users\":[{\"name\": \"Nick\", \"age\": 87, \"is_active\": True}, {\"name\": \"Alex\", \"age\": 27, \"is_active\": True}], \"count\": 2}] # >>> logger.bind(payload=).debug(\"users payload\") # >>> [ { 'count': 2, # >>> 'users': [ {'age': 87, 'is_active': True, 'name': 'Nick'}, # >>> {'age': 27, 'is_active': True, 'name': 'Alex'}]}] \"\"\" format_string = LOGURU_FORMAT if record [ \"extra\" ] . get ( \"payload\" ) is not None : record [ \"extra\" ][ \"payload\" ] = pformat ( record [ \"extra\" ][ \"payload\" ], indent = 4 , compact = True , width = 88 ) format_string += \" \\n <level> {extra[payload]} </level>\" format_string += \" {exception} \\n \" return format_string def make_filter ( name ): # \u8fc7\u6ee4\u64cd\u4f5c\uff0c\u5f53\u65e5\u5fd7\u8981\u9009\u62e9\u5bf9\u5e94\u7684\u65e5\u5fd7\u6587\u4ef6\u7684\u65f6\u5019\uff0c\u901a\u8fc7filter\u8fdb\u884c\u7b5b\u9009 def filter_ ( record ): return record [ \"extra\" ] . get ( \"name\" ) == name return filter_ def init_logging (): loggers = ( logging . getLogger ( name ) for name in logging . root . manager . loggerDict if name . startswith ( \"uvicorn.\" ) ) for uvicorn_logger in loggers : uvicorn_logger . handlers = [] # \u8fd9\u91cc\u7684\u64cd\u4f5c\u662f\u4e3a\u4e86\u6539\u53d8uvicorn\u9ed8\u8ba4\u7684logger\uff0c\u4f7f\u4e4b\u91c7\u7528loguru\u7684logger # change handler for default uvicorn logger intercept_handler = InterceptHandler () logging . getLogger ( \"uvicorn\" ) . handlers = [ intercept_handler ] # set logs output, level and format # logger.add(sys.stdout, level=logging.DEBUG, format=format_record, filter=make_filter('stdout')) # \u4e3apity\u6dfb\u52a0\u4e00\u4e2ainfo log\u6587\u4ef6\uff0c\u4e3b\u8981\u8bb0\u5f55debug\u548cinfo\u7ea7\u522b\u7684\u65e5\u5fd7 pity_info = os . path . join ( Config . LOG_DIR , \"pity_info.log\" ) # \u4e3apity\u6dfb\u52a0\u4e00\u4e2aerror log\u6587\u4ef6\uff0c\u4e3b\u8981\u8bb0\u5f55warning\u548cerror\u7ea7\u522b\u7684\u65e5\u5fd7 pity_error = os . path . join ( Config . LOG_DIR , \"pity_error.log\" ) logger . add ( pity_info , enqueue = True , rotation = \"20 MB\" , level = \"DEBUG\" , filter = make_filter ( \"pity_info\" )) logger . add ( pity_error , enqueue = True , rotation = \"10 MB\" , level = \"WARNING\" , filter = make_filter ( \"pity_error\" )) # \u914d\u7f6eloguru\u7684\u65e5\u5fd7\u53e5\u67c4\uff0csink\u4ee3\u8868\u8f93\u51fa\u7684\u76ee\u6807 logger . configure ( handlers = [ { \"sink\" : sys . stdout , \"level\" : logging . DEBUG , \"format\" : format_record }, { \"sink\" : pity_info , \"level\" : logging . INFO , \"format\" : format_record , \"filter\" : make_filter ( \"pity_info\" )}, { \"sink\" : pity_error , \"level\" : logging . WARNING , \"format\" : format_record , \"filter\" : make_filter ( \"pity_error\" )} ] ) return logger \u8fd9\u91cc\u7684\u4ee3\u7801\u770b\u4f3c\u5f88\u590d\u6742\uff0c\u5b9e\u9645\u4e0a InterceptHandler \u8fd9\u4e2a\u7c7b\u662f\u7528\u4e8e\u5b9a\u4e49uvicorn\u8f93\u51fa\u7684\u7c7b\uff0c\u53ef\u4ee5\u4e0d\u7528\u7ec6\u770b\uff0c\u56e0\u4e3a\u4ee3\u7801\u6211\u4e5f\u662fcopy\u7684\uff08\u5176\u5b9e\u91cc\u9762\u5927\u90e8\u5206\u90fd\u662f\u6ce8\u91ca\uff09\u3002 format_record\u5219\u662f\u63a7\u5236\u65e5\u5fd7\u8f93\u51fa\u683c\u5f0f\u7684\uff0c\u5305\u62ec\u65f6\u95f4\uff0c\u6587\u4ef6\u540d\uff0c\u4ee5\u53ca\u4f20\u5165\u5b57\u5178\u7684\u65f6\u5019\u5bf9\u5b57\u5178\u505a\u4e86\u4e00\u4e2a\u989d\u5916\u5904\u7406\u3002 \u6211\u4eec\u91cd\u70b9\u770binit_logging\u65b9\u6cd5\uff0c\u8fd9\u4e2a\u91cc\u9762\u524d\u534a\u90e8\u5206\u662f\u8fc7\u6ee4\u51fauvicorn\u7684\u9ed8\u8ba4\u65e5\u5fd7\u53e5\u67c4\uff0c\u63a5\u7740\u66ff\u6362\u3002\u540e\u9762\u662f\u65b0\u589e\u4e86pity\u76842\u79cd\u4e1a\u52a1\u65e5\u5fd7\uff08info\u548cerror\uff09\uff0c\u4e00\u51713\u4e2ahandler\u3002 \u6700\u540e\u914d\u7f6elogger\u7684\u8f93\u51fa\uff0c\u5206\u522b\u8f93\u51fa\u5230sys.stdout\uff08\u63a7\u5236\u53f0\uff09\u548cpity_info.log\u4ee5\u53capity_error.log\u3002 \uff08pity_error\u548cinfo\u91cc\u9762\u90fd\u6709\u4e2afilter\u81ea\u5e26\uff0c\u8fd9\u4e2a\u662f\u4e3a\u4e86\u914d\u5408make_filter\u7528\u7684\uff0c\u56e0\u4e3a\u65e5\u5fd7\u53e5\u67c4\u5f88\u591a\uff0c\u800clogger\u53c8\u662f\u4e00\u4e2a\u5168\u5c40\u5bf9\u8c61\uff0c\u6240\u4ee5\u65e5\u5fd7\u5230\u5e95\u8981 \u8f93\u51fa \u5230 \u54ea\u4e2a\u65e5\u5fd7\u6587\u4ef6 \uff0c\u5c31\u8981\u901a\u8fc7filter\u6765\u8fc7\u6ee4\u4e86\u3002\uff09","title":"\u5728app/init.py\u65b0\u589e\u4ee5\u4e0b\u5185\u5bb9"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28111%29%20%E5%88%A9%E7%94%A8loguru%E6%94%B9%E9%80%A0%E6%97%A5%E5%BF%97%E6%A8%A1%E5%9D%97/#mainpy","text":"\u5728main.py\u91cc\u9762\u5f15\u5165init_logging\u5373\u53ef\u3002\u63a5\u7740\u91cd\u542f\u670d\u52a1\uff0c\u63a7\u5236\u53f0\u5c31\u53d8\u6210\u4e86\u4e0a\u9762\u7684\u6837\u5b50\u3002","title":"\u6539\u5199main.py"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28111%29%20%E5%88%A9%E7%94%A8loguru%E6%94%B9%E9%80%A0%E6%97%A5%E5%BF%97%E6%A8%A1%E5%9D%97/#_3","text":"\u6709\u65f6\u5019\u6211\u4eec\u60f3\u83b7\u53d6\u5230\u8bf7\u6c42\u7684json\u53c2\u6570\u6216\u8005form\u53c2\u6570\uff0c\u4ee5\u4fbf\u4e8e\u62a5\u9519\u7684\u65f6\u5019\u65b9\u4fbf\u627e\u5230\u5386\u53f2\u7684\u8bf7\u6c42\u6570\u636e\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5199\u4e00\u4e2a\u4e2d\u95f4\u4ef6: async def request_info ( request : Request ): logger . bind ( name = None ) . info ( f \" { request . method } { request . url } \" ) try : body = await request . json () logger . bind ( payload = body , name = None ) . debug ( \"request_json: \" ) except : body = await request . body () if len ( body ) != 0 : # \u6709\u8bf7\u6c42\u4f53\uff0c\u8bb0\u5f55\u65e5\u5fd7 logger . bind ( payload = body , name = None ) . debug ( body ) pity . include_router ( user . router ) pity . include_router ( project . router , dependencies = [ Depends ( request_info )]) pity . include_router ( http . router , dependencies = [ Depends ( request_info )]) pity . include_router ( testcase_router , dependencies = [ Depends ( request_info )]) pity . include_router ( config_router , dependencies = [ Depends ( request_info )]) pity . include_router ( online_router , dependencies = [ Depends ( request_info )]) pity . include_router ( oss_router , dependencies = [ Depends ( request_info )]) pity . include_router ( operation_router , dependencies = [ Depends ( request_info )]) pity . include_router ( msg_router , dependencies = [ Depends ( request_info )]) \u8fd9\u91cc\u6211\u8fc7\u6ee4\u51fa\u4e86name=None\uff08\u5373stdout\uff09\u7684\u53e5\u67c4\uff0c\u5e76\u6253\u5370\u51fa\u8bf7\u6c42\u65b9\u6cd5\u548curl\u3002\u63a5\u7740\u5224\u65ad\u662f\u4e0d\u662fjson\u6570\u636e\uff0c\u5982\u679c\u4e0d\u662f\u5219\u5224\u65ad\u6709\u6ca1\u6709body\uff0c\u5982\u679c\u6709json\u6216\u8005\u6709body\uff0c\u5219\u6253\u5370\u51fa\u6765\u3002 \u63a5\u7740\u6211\u4eec\u5728\u6bcf\u4e2arouter\u90fd\u52a0\u5165\u8fd9\u4e2a\u4f9d\u8d56\u7684\u4e2d\u95f4\u4ef6\uff08request_info\uff09\uff0c\u7528\u6237\u8def\u7531\u6ca1\u6709\u52a0\u662f\u56e0\u4e3a \u7528\u6237\u767b\u5f55\u7684\u65f6\u5019\u4f1a\u4f20\u5165\u660e\u6587\u7684\u8d26\u53f7\u5bc6\u7801\uff08js\u52a0\u5bc6\u8fd9\u91cc\u8fd8\u6ca1\u505a \u6682\u65f6\u4e5f\u4e0d\u60f3\u505a\uff09 \uff0c\u6240\u4ee5\u5982\u679c\u88ab\u6709\u5fc3\u4e4b\u4eba\u53d1\u73b0\u7684\u8bdd\u5c31\u96be\u53d7\u4e86\uff0c\u6240\u4ee5\u6211\u76f4\u63a5\u53bb\u6389\u4e86\u3002","title":"\u65b0\u589e\u53c2\u6570\u83b7\u53d6"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28111%29%20%E5%88%A9%E7%94%A8loguru%E6%94%B9%E9%80%A0%E6%97%A5%E5%BF%97%E6%A8%A1%E5%9D%97/#_4","text":"\u56e0\u4e3aawait request.json()\u4f1a\u8fd4\u56de\u4e00\u4e2aPython\u91cc\u9762\u7684\u5bf9\u8c61\uff08\u5927\u6982\u7387\u662fdict\uff09\uff0c\u6240\u4ee5\u6253\u5370\u4f1a\u6309\u7167\u5b57\u5178\u7684\u65b9\u5f0f\u6253\u5370\u51fa\u6765\uff0c\u5927\u5bb6\u8fd9\u91cc\u9700\u8981\u7406\u89e3\u4e00\u4e0b\u3002 \u8fd9\u4e2a\u529f\u80fd\u5c31\u5f88 nice \u4e86\uff01\uff01\uff01\u4f46\u7f3a\u9677\u5c31\u662f\u76ee\u524d\u662f\u6253\u5370\u7684\u5b57\u5178\uff0c\u5982\u679c\u80fd\u6253\u5370json\u5c31\u66f4\u597d\u4e86\uff0c\u8fd9\u4e2a\u8bfb\u8005\u6709\u5174\u8da3\u53ef\u4ee5\u81ea\u5df1\u53bb\u5b9e\u73b0\u3002","title":"\u6d4b\u8bd5\u4e00\u4e0b\u8bf7\u6c42\u53c2\u6570"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28111%29%20%E5%88%A9%E7%94%A8loguru%E6%94%B9%E9%80%A0%E6%97%A5%E5%BF%97%E6%A8%A1%E5%9D%97/#log","text":"import inspect import os from loguru import logger from config import Config # \u6ce8\u610f\u8fd9\u91cc # @SingletonDecorator class Log ( object ): business = None def __init__ ( self , name = 'pity' ): # Logger\u6807\u8bc6\u9ed8\u8ba4\u4e3aapp \"\"\" :param name: \u4e1a\u52a1\u540d\u79f0 \"\"\" # \u5982\u679c\u76ee\u5f55\u4e0d\u5b58\u5728\u5219\u521b\u5efa if not os . path . exists ( Config . LOG_DIR ): os . mkdir ( Config . LOG_DIR ) self . business = name self . pity_info = logger . bind ( name = \"pity_info\" ) self . pity_error = logger . bind ( name = 'pity_error' ) def info ( self , message : str ): file_name , line , func , _ , _ = inspect . getframeinfo ( inspect . currentframe () . f_back ) self . pity_info . info ( f \"func: { func } line: { line } module: { self . business } message: { message } \" ) def error ( self , message : str ): file_name , line , func , _ , _ = inspect . getframeinfo ( inspect . currentframe () . f_back ) self . pity_error . error ( f \"func: { func } line: { line } module: { self . business } message: { message } \" ) def warning ( self , message : str ): file_name , line , func , _ , _ = inspect . getframeinfo ( inspect . currentframe () . f_back ) self . pity_error . warning ( f \"func: { func } line: { line } module: { self . business } message: { message } \" ) def debug ( self , message : str ): file_name , line , func , _ , _ = inspect . getframeinfo ( inspect . currentframe () . f_back ) self . pity_info . debug ( f \"func: { func } line: { line } module: { self . business } message: { message } \" ) \u4e3a\u4e86\u4e0d\u5f71\u54cd\u4e4b\u524d\u7684\u65e5\u5fd7\u6a21\u5757\uff0c\u6240\u4ee5\u6211\u4eec\u6ca1\u6709\u5927\u6539\uff0c\u7531\u4e8e \u7cfb\u7edf\u65e5\u5fd7 \u90fd\u662fapp/utils/logger.py\u6587\u4ef6\u7684\u65b9\u6cd5\uff0c\u6240\u4ee5\u5bfc\u81f4\u81ea\u5b9a\u4e49\u7684\u65e5\u5fd7\u90fd\u4f1a\u51fa\u73b0: \u663e\u793a\u4e0d\u51fa\u6765\u771f\u6b63\u8c03\u7528log.info\u7684\u6587\u4ef6 \u8fd9\u4e2a\u95ee\u9898\u3002 \u6240\u4ee5\u6211\u8fd9\u7528\u4e86inspect\u81ea\u5e26\u7684\u6a21\u5757\uff0c\u83b7\u53d6\u5230info/error\u7b49\u65b9\u6cd5\u7684\u8c03\u7528\u65b9\uff0c\u4e00\u8d77\u6765\u770b\u770b: \u6bd4\u5982websocket\u8fd9\u91cc\uff0cxxx\u8fde\u63a5\u4e0a\u4e86\uff0c\u6211\u4eec\u770b\u770b\u65e5\u5fd7\u600e\u4e48\u5c55\u793a\u7684: \u56e0\u4e3a\u65e5\u5fd7\u7684\u8c03\u7528\u4e00\u76f4\u662flogger\u6587\u4ef6\u4e0b\u7684info\u65b9\u6cd5\uff0c\u6240\u4ee5\u6bcf\u6b21\u90fd\u4f1a\u6253\u5370app.utils.logger.info\uff0c\u800c\u6211\u4eec\u7528\u4e86inspect\u4e4b\u540e\u5c31\u4e0d\u4e00\u6837\u4e86\uff0c\u80fd\u83b7\u53d6\u5230\u771f\u5b9e\u7684\u65b9\u6cd5: \u56fe\u4e2d\u53ef\u4ee5\u770b\u5230\u662fconnect\u65b9\u6cd5\uff0c44\u884c\uff0c\u7531\u4e8e\u6587\u4ef6\u540d\u5de8\u957f\uff0c\u6240\u4ee5\u6211\u6ca1\u653e\u8fdb\u53bb\uff0c\u5176\u5b9e\u4e5f\u662f\u53ef\u4ee5\u83b7\u53d6\u5230\u7684\u3002\u611f\u5174\u8da3\u7684\u670b\u53cb\u53ef\u4ee5\u81ea\u5df1\u6539\u88c5\u4e0b\u3002 \u8fd9\u5757\u5185\u5bb9\u5c31\u5f53\u4f5c\u4e1a\u7559\u7ed9\u5927\u5bb6\u4e86\uff0c\u54b1\u4eec\u4e0b\u671f\u518d\u89c1\uff01","title":"\u6539\u9020\u539f\u672c\u7684Log\u7c7b"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28112%29%20%E5%A4%9A%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E6%94%B9%E9%80%A0/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u7f16\u5199\u4e86 \u65e5\u5fd7\u6a21\u5757 \u76f8\u5173\u7684\u6539\u9020\uff0c\u8fd9\u4e00\u8282\u6211\u4eec\u7ee7\u7eed\u8d81\u70ed\u6253\u94c1\uff0c\u6765\u7ee7\u7eed\u4e30\u5bcc\u6211\u4eec\u7684\u7cfb\u7edf\u3002 \u914d\u7f6e\u7684\u95ee\u9898 \u6211\u4eec\u76ee\u524d\u7cfb\u7edf\u7684\u914d\u7f6e\u7b97\u662f\u4e00\u4e2a\u5f88 \u7b80\u964b \u7684\u7248\u672c\uff0c\u7531\u4e8e\u6211\u4e60\u60ef\u4e86\u5728 \u751f\u4ea7\u73af\u5883 (\u8fd9\u91cc\u6307\u7684\u662fpity\u7684\u751f\u4ea7\u73af\u5883)\u8fdb\u884c\u5f00\u53d1\uff0c\u6240\u4ee5\u5f88\u591a\u65f6\u5019\u6211\u7684\u914d\u7f6e\u76f4\u63a5\u5c31\u5199\u6b7b\u4e3apity\u7684\u751f\u4ea7\u914d\u7f6e\u3002 \u4f46\u8fd9\u663e\u7136\u5f88 \u4e0d\u5408\u7406 \uff0c\u56e0\u4e3a\u4ee5\u89c4\u8303\u7684\u5f00\u53d1\u6a21\u5f0f\u6765\u8bf4\uff0c\u6211\u4eec\u5982\u679c\u662f\u6d4b\u8bd5\u73af\u5883\u6216\u8005\u5f00\u53d1\u73af\u5883\uff0c\u6211\u4eec\u4e00\u822c\u4f1a\u8fde\u63a5dev\u7684\u6570\u636e\u5e93/redis\u7b49\u4e2d\u95f4\u4ef6\u3002 \u8fd9\u6837\u6211\u4eec\u624d\u80fd\u505a\u5230\uff0c\u5728\u8fdb\u884c \u65b0\u529f\u80fd \u5f00\u53d1\u7684\u540c\u65f6\uff0c\u4e0d\u5f71\u54cd\u5230\u7ebf\u4e0a\u7684\u6570\u636e\u3002 \u4e3e\u4e2a\u4f8b\u5b50 \u6211\u73b0\u5728\u7528\u6237\u8868\u8981\u4fee\u6539\u4e00\u4e2a\u5b57\u6bb5\u7684\u7c7b\u578b\uff0c\u4ecevarchar\u6539\u4e3ainteger\u3002\u6b64\u65f6\u6ce8\u610f\u6211\u4eec\u7ebf\u4e0a\u7684\u4ee3\u7801\u4f9d\u65e7\u662f\u4ee5varchar\u7684\u5f62\u5f0f\u8fd0\u884c\u7684\u3002 \u5982\u679c\u6211\u4eec\u672c\u5730\u6d4b\u8bd5\u7684\u65f6\u5019\u6539\u6389\u4e86\u5b57\u6bb5\uff0c\u90a3\u7ebf\u4e0a\u7684\u4ee3\u7801\u8fd0\u884c\u5230\u90a3\u5757\u7684\u65f6\u5019\u5c31\u4f1a\u51fa\u73b0 \u7c7b\u578b\u4e0d\u5339\u914d \u7684\u95ee\u9898\u4e86\u3002\u76ee\u524dpity\u8fd8\u6ca1\u5565\u4eba\u5728\u4f7f\u7528\uff0c\u5982\u679c\u5927\u5bb6\u5df2\u7ecf\u5f00\u59cb\u5728\u81ea\u5df1\u516c\u53f8\u4f7f\u7528\u4e86\uff0c\u90a3\u65b0\u529f\u80fd\u5f00\u53d1\u7684\u540c\u65f6\u5c31\u4f1a\u5f71\u54cd\u5230\u5df2\u6709\u7684\u4ee3\u7801\u3002 \u89e3\u51b3\u65b9\u6848 \u5176\u5b9e\u8fd9\u5757\u89e3\u51b3\u65b9\u6848\uff0c\u6211\u89c1\u8fc7\u7684\u516c\u53f8\u90fd\u662f\u91c7\u7528 \u73af\u5883\u53d8\u91cf \u7684\u65b9\u5f0f\u6765\u89e3\u51b3\u7684\u3002\u6bd4\u5982\u670d\u52a1\u542f\u52a8\u7684\u65f6\u5019\uff0c\u4f1a\u81ea\u52a8\u53bb \u7cfb\u7edf\u53d8\u91cf \u83b7\u53d6\u67d0\u4e00\u4e2a\u7279\u5b9a\u7684\u53d8\u91cf\u503c\uff0c\u4e3e\u4e2a\u4f8b\u5b50\u53eb: pity_env \u3002 \u5982\u679c\u8fd9\u4e2a\u503c\u4e3a DEV \uff0c\u5219\u4f7f\u7528 DEV \u7684\u914d\u7f6e\u6570\u636e\uff0c\u5982\u679c\u662f\u5176\u4ed6\u73af\u5883\uff0c\u5219\u7528 \u5176\u4ed6\u73af\u5883 \u7684\u914d\u7f6e\u3002\u6240\u4ee5\u89e3\u51b3\u8d77\u6765\u76f8\u5bf9\u8fd8\u662f\u6bd4\u8f83\u7b80\u5355\u7684\u3002 \u4e0d\u8fc7\u8981\u6ce8\u610f\u5230\uff0c\u6211\u4eec\u7684configuration.json\u4e5f\u8981\u533a\u5206\u73af\u5883\u54e6\uff0c\u6ca1\u5173\u7cfb\uff0c\u6211\u4eec\u4e00\u8d77\u6539\u9020\u5c31\u53ef\u4ee5\u4e86\uff01 \u884c\u52a8\u8d77\u6765 \u9996\u5148\u7b2c\u4e00\u6b65\u6211\u4eec\u8981\u786e\u8ba4\u4e00\u4e0b\u6211\u4eec\u5230\u5e95\u6709\u591a\u5c11\u73af\u5883\uff0c\u590d\u6742\u70b9\u7684\u8bdd\uff0c\u53ef\u80fd\u9700\u8981DEV/UAT/PRO\u7b49\u591a\u79cd\u73af\u5883\uff0c\u6bd5\u7adf\u6211\u4eec\u7684\u4ee3\u7801\u4e5f\u9700\u8981\u6d4b\u8bd5\uff0c\u8ddf\u7740\u5f00\u53d1\u7684\u8282\u594f\u8d70\u3002\u4e0d\u8fc7\u8fd9\u91cc\u6211\u5c31\u4e0d \u641e\u90a3\u4e48\u591a\u73af\u5883 \u4e86\uff0c\u6211\u4eec\u53ea\u5206DEV\u548cPRO\u73af\u5883\u5373\u53ef\u3002 \u4fee\u6539config.py \u6211\u4eec\u53ea\u9700\u8981\u5199\u4e2a \u57fa\u7840\u914d\u7f6e\u7c7b \uff0c\u63a5\u7740\u4e0d\u540c\u7684Config\u7ee7\u627f\u4e4b\u5373\u53ef\u3002\u6240\u4ee5\u6211\u4eec\u62c6\u51fa\u516c\u5171\u53d8\u91cf: \u63a5\u7740\u5206\u5f00\u7ed9\u51faDevConfig\u548cProConfig\uff0c\u6700\u540e\u505a\u4e00\u4e2a\u5224\u65ad: # \u83b7\u53d6pity\u73af\u5883\u53d8\u91cf PITY_ENV = os . environ . get ( \"pity_env\" ) # \u5982\u679cpity_env\u5b58\u5728\u4e14\u4e3aprod Config = ProConfig () if PITY_ENV and PITY_ENV . lower () == \"pro\" else DevConfig () \u5148\u83b7\u53d6pity_env\u7684\u503c\uff0c\u5982\u679c\u6709\u4e14\u4e3apro\uff0c\u5219\u662f\u751f\u4ea7\u73af\u5883\uff0c\u5426\u5219\u5219\u662fpro\u73af\u5883\u3002 \u8fd9\u6837\u4e5f\u6709\u4e00\u5b9a\u7684\u98ce\u9669\uff0c\u5373\u5f00\u53d1\u5176\u5b9e\u53ef\u4ee5\u672c\u5730\u6539\u6210pro\u73af\u5883\uff0c\u4f46\u5728\u4f01\u4e1a\u91cc\u9762pro\u73af\u5883\u548c\u5176\u4ed6\u73af\u5883\u4e00\u822c\u662f\u9694\u79bb\u4e86\u7684\uff0c\u6240\u4ee5\u5c31\u7b97\u4f60\u914d\u7f6e\u6210Pro\u7684\u73af\u5883\uff0c\u4e5f\u8bbf\u95ee\u4e0d\u5230pro\u7684\u6570\u636e\u5e93\u7b49\uff08\u76f8\u5bf9\u6765\u8bf4\u4f1a\u4e25\u8c28\u5f88\u591a\uff0c\u6240\u4ee5\u8fd9\u4e48\u505a\u4e5f\u6ca1\u5565\u6bdb\u75c5\uff0c\u5927\u80c6\u653e\u5fc3\u53bb\u7528\u5427\uff01\uff09 \u4e3a\u4e86\u4e0d\u5f71\u54cd\u4e4b\u524d\u7684\u4ee3\u7801\uff0c\u6211\u4eec\u7279\u610f \u521b\u5efa\u4e86 \u4e00\u4e2aConfig\u53d8\u91cf\uff0c\u548c\u4e4b\u524d\u4fdd\u6301\u4e00\u81f4\u3002 \u6539\u9020configuration\u76f8\u5173\u5185\u5bb9 \u6211\u4eec\u628a\u73b0\u6709\u7684configuration.json\u6539\u4e3aconfiguration_dev.json\u5e76\u590d\u5236\u4e00\u4efd\uff0c\u547d\u540d\u4e3aconfiguration_pro.json\u3002 \u7f16\u5199\u83b7\u53d6\u6587\u4ef6\u540d\u7684\u65b9\u6cd5 \u8c03\u6574\u83b7\u53d6\u548cupdate\u76f8\u5173\u65b9\u6cd5 \u6d4b\u8bd5\u4e00\u4e0b \u4e3a\u4e86\u66f4\u5e05\u6c14\u4e00\u70b9\uff0c\u6211\u4eec\u53ef\u4ee5\u52a0\u4e0a\u4e4b\u524d\u5b66\u8fc7\u7684banner\u548c\u5f53\u524d\u73af\u5883\u6807\u8bc6\uff0c\u4ee5\u65e5\u5fd7\u7684\u5f62\u5f0f\u6253\u5370\u51fa\u6765\u3002\u5148\u770b\u770b\u6700\u7ec8\u6548\u679c: \u6dfb\u52a0\u73af\u5883\u53d8\u91cf \u5728\u521d\u59cb\u5316\u65e5\u5fd7\u4e4b\u540e\u6253\u5370\u76f8\u5173banner\u63d0\u793a \u5728main.py\u521d\u59cb\u5316logger\u540e\u52a0\u5165\u4ee5\u4e0b\u8bed\u53e5: from config import BANNER logger . bind ( name = None ) . opt ( ansi = True ) . info ( f \"pity is running at <red> { PITY_ENV } </red>\" ) logger . bind ( name = None ) . info ( BANNER ) \u5728config.py\u5e95\u90e8\u5199\u5165banner BANNER = \"\"\" ________ ___ _________ ___ ___ |\\ __ \\ |\\ \\ |\\___ ___\\ |\\ \\ / /| \\ \\ \\|\\ \\ \\ \\ \\ \\|___ \\ \\_| \\ \\ \\/ / / \\ \\ ____\\ \\ \\ \\ \\ \\ \\ \\ \\ / / \\ \\ \\___| \\ \\ \\ \\ \\ \\ \\/ / / \\ \\__\\ \\ \\__\\ \\ \\__\\ __/ / / \\|__| \\|__| \\|__| |\\___/ / \\|___|/ \"\"\" \u4ece\u6548\u679c\u56fe\u53ef\u4ee5\u770b\u51fa\uff0c\u6211\u4eec\u6253\u5370\u51fa\u4e86\u5f53\u524d\u7684\u73af\u5883, \u8d85\u8d5b\u795epro\u3002 \u4eca\u5929\u7684\u5185\u5bb9\u5c31\u5206\u4eab\u5230\u8fd9\u91cc\uff0c\u5927\u5bb6\u4e5f\u53ef\u4ee5\u8bd5\u8bd5\u7ed9\u81ea\u5df1\u7684\u9879\u76ee\u52a0\u70b9\u5e05\u6c14\u7684 banner .","title":"112.\u591a\u73af\u5883\u90e8\u7f72\u6539\u9020"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28112%29%20%E5%A4%9A%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E6%94%B9%E9%80%A0/#_1","text":"\u4e0a\u4e00\u8282\u6211\u4eec\u7f16\u5199\u4e86 \u65e5\u5fd7\u6a21\u5757 \u76f8\u5173\u7684\u6539\u9020\uff0c\u8fd9\u4e00\u8282\u6211\u4eec\u7ee7\u7eed\u8d81\u70ed\u6253\u94c1\uff0c\u6765\u7ee7\u7eed\u4e30\u5bcc\u6211\u4eec\u7684\u7cfb\u7edf\u3002","title":"\u56de\u987e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28112%29%20%E5%A4%9A%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E6%94%B9%E9%80%A0/#_2","text":"\u6211\u4eec\u76ee\u524d\u7cfb\u7edf\u7684\u914d\u7f6e\u7b97\u662f\u4e00\u4e2a\u5f88 \u7b80\u964b \u7684\u7248\u672c\uff0c\u7531\u4e8e\u6211\u4e60\u60ef\u4e86\u5728 \u751f\u4ea7\u73af\u5883 (\u8fd9\u91cc\u6307\u7684\u662fpity\u7684\u751f\u4ea7\u73af\u5883)\u8fdb\u884c\u5f00\u53d1\uff0c\u6240\u4ee5\u5f88\u591a\u65f6\u5019\u6211\u7684\u914d\u7f6e\u76f4\u63a5\u5c31\u5199\u6b7b\u4e3apity\u7684\u751f\u4ea7\u914d\u7f6e\u3002 \u4f46\u8fd9\u663e\u7136\u5f88 \u4e0d\u5408\u7406 \uff0c\u56e0\u4e3a\u4ee5\u89c4\u8303\u7684\u5f00\u53d1\u6a21\u5f0f\u6765\u8bf4\uff0c\u6211\u4eec\u5982\u679c\u662f\u6d4b\u8bd5\u73af\u5883\u6216\u8005\u5f00\u53d1\u73af\u5883\uff0c\u6211\u4eec\u4e00\u822c\u4f1a\u8fde\u63a5dev\u7684\u6570\u636e\u5e93/redis\u7b49\u4e2d\u95f4\u4ef6\u3002 \u8fd9\u6837\u6211\u4eec\u624d\u80fd\u505a\u5230\uff0c\u5728\u8fdb\u884c \u65b0\u529f\u80fd \u5f00\u53d1\u7684\u540c\u65f6\uff0c\u4e0d\u5f71\u54cd\u5230\u7ebf\u4e0a\u7684\u6570\u636e\u3002","title":"\u914d\u7f6e\u7684\u95ee\u9898"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28112%29%20%E5%A4%9A%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E6%94%B9%E9%80%A0/#_3","text":"\u6211\u73b0\u5728\u7528\u6237\u8868\u8981\u4fee\u6539\u4e00\u4e2a\u5b57\u6bb5\u7684\u7c7b\u578b\uff0c\u4ecevarchar\u6539\u4e3ainteger\u3002\u6b64\u65f6\u6ce8\u610f\u6211\u4eec\u7ebf\u4e0a\u7684\u4ee3\u7801\u4f9d\u65e7\u662f\u4ee5varchar\u7684\u5f62\u5f0f\u8fd0\u884c\u7684\u3002 \u5982\u679c\u6211\u4eec\u672c\u5730\u6d4b\u8bd5\u7684\u65f6\u5019\u6539\u6389\u4e86\u5b57\u6bb5\uff0c\u90a3\u7ebf\u4e0a\u7684\u4ee3\u7801\u8fd0\u884c\u5230\u90a3\u5757\u7684\u65f6\u5019\u5c31\u4f1a\u51fa\u73b0 \u7c7b\u578b\u4e0d\u5339\u914d \u7684\u95ee\u9898\u4e86\u3002\u76ee\u524dpity\u8fd8\u6ca1\u5565\u4eba\u5728\u4f7f\u7528\uff0c\u5982\u679c\u5927\u5bb6\u5df2\u7ecf\u5f00\u59cb\u5728\u81ea\u5df1\u516c\u53f8\u4f7f\u7528\u4e86\uff0c\u90a3\u65b0\u529f\u80fd\u5f00\u53d1\u7684\u540c\u65f6\u5c31\u4f1a\u5f71\u54cd\u5230\u5df2\u6709\u7684\u4ee3\u7801\u3002","title":"\u4e3e\u4e2a\u4f8b\u5b50"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28112%29%20%E5%A4%9A%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E6%94%B9%E9%80%A0/#_4","text":"\u5176\u5b9e\u8fd9\u5757\u89e3\u51b3\u65b9\u6848\uff0c\u6211\u89c1\u8fc7\u7684\u516c\u53f8\u90fd\u662f\u91c7\u7528 \u73af\u5883\u53d8\u91cf \u7684\u65b9\u5f0f\u6765\u89e3\u51b3\u7684\u3002\u6bd4\u5982\u670d\u52a1\u542f\u52a8\u7684\u65f6\u5019\uff0c\u4f1a\u81ea\u52a8\u53bb \u7cfb\u7edf\u53d8\u91cf \u83b7\u53d6\u67d0\u4e00\u4e2a\u7279\u5b9a\u7684\u53d8\u91cf\u503c\uff0c\u4e3e\u4e2a\u4f8b\u5b50\u53eb: pity_env \u3002 \u5982\u679c\u8fd9\u4e2a\u503c\u4e3a DEV \uff0c\u5219\u4f7f\u7528 DEV \u7684\u914d\u7f6e\u6570\u636e\uff0c\u5982\u679c\u662f\u5176\u4ed6\u73af\u5883\uff0c\u5219\u7528 \u5176\u4ed6\u73af\u5883 \u7684\u914d\u7f6e\u3002\u6240\u4ee5\u89e3\u51b3\u8d77\u6765\u76f8\u5bf9\u8fd8\u662f\u6bd4\u8f83\u7b80\u5355\u7684\u3002 \u4e0d\u8fc7\u8981\u6ce8\u610f\u5230\uff0c\u6211\u4eec\u7684configuration.json\u4e5f\u8981\u533a\u5206\u73af\u5883\u54e6\uff0c\u6ca1\u5173\u7cfb\uff0c\u6211\u4eec\u4e00\u8d77\u6539\u9020\u5c31\u53ef\u4ee5\u4e86\uff01","title":"\u89e3\u51b3\u65b9\u6848"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28112%29%20%E5%A4%9A%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E6%94%B9%E9%80%A0/#_5","text":"\u9996\u5148\u7b2c\u4e00\u6b65\u6211\u4eec\u8981\u786e\u8ba4\u4e00\u4e0b\u6211\u4eec\u5230\u5e95\u6709\u591a\u5c11\u73af\u5883\uff0c\u590d\u6742\u70b9\u7684\u8bdd\uff0c\u53ef\u80fd\u9700\u8981DEV/UAT/PRO\u7b49\u591a\u79cd\u73af\u5883\uff0c\u6bd5\u7adf\u6211\u4eec\u7684\u4ee3\u7801\u4e5f\u9700\u8981\u6d4b\u8bd5\uff0c\u8ddf\u7740\u5f00\u53d1\u7684\u8282\u594f\u8d70\u3002\u4e0d\u8fc7\u8fd9\u91cc\u6211\u5c31\u4e0d \u641e\u90a3\u4e48\u591a\u73af\u5883 \u4e86\uff0c\u6211\u4eec\u53ea\u5206DEV\u548cPRO\u73af\u5883\u5373\u53ef\u3002 \u4fee\u6539config.py \u6211\u4eec\u53ea\u9700\u8981\u5199\u4e2a \u57fa\u7840\u914d\u7f6e\u7c7b \uff0c\u63a5\u7740\u4e0d\u540c\u7684Config\u7ee7\u627f\u4e4b\u5373\u53ef\u3002\u6240\u4ee5\u6211\u4eec\u62c6\u51fa\u516c\u5171\u53d8\u91cf: \u63a5\u7740\u5206\u5f00\u7ed9\u51faDevConfig\u548cProConfig\uff0c\u6700\u540e\u505a\u4e00\u4e2a\u5224\u65ad: # \u83b7\u53d6pity\u73af\u5883\u53d8\u91cf PITY_ENV = os . environ . get ( \"pity_env\" ) # \u5982\u679cpity_env\u5b58\u5728\u4e14\u4e3aprod Config = ProConfig () if PITY_ENV and PITY_ENV . lower () == \"pro\" else DevConfig () \u5148\u83b7\u53d6pity_env\u7684\u503c\uff0c\u5982\u679c\u6709\u4e14\u4e3apro\uff0c\u5219\u662f\u751f\u4ea7\u73af\u5883\uff0c\u5426\u5219\u5219\u662fpro\u73af\u5883\u3002 \u8fd9\u6837\u4e5f\u6709\u4e00\u5b9a\u7684\u98ce\u9669\uff0c\u5373\u5f00\u53d1\u5176\u5b9e\u53ef\u4ee5\u672c\u5730\u6539\u6210pro\u73af\u5883\uff0c\u4f46\u5728\u4f01\u4e1a\u91cc\u9762pro\u73af\u5883\u548c\u5176\u4ed6\u73af\u5883\u4e00\u822c\u662f\u9694\u79bb\u4e86\u7684\uff0c\u6240\u4ee5\u5c31\u7b97\u4f60\u914d\u7f6e\u6210Pro\u7684\u73af\u5883\uff0c\u4e5f\u8bbf\u95ee\u4e0d\u5230pro\u7684\u6570\u636e\u5e93\u7b49\uff08\u76f8\u5bf9\u6765\u8bf4\u4f1a\u4e25\u8c28\u5f88\u591a\uff0c\u6240\u4ee5\u8fd9\u4e48\u505a\u4e5f\u6ca1\u5565\u6bdb\u75c5\uff0c\u5927\u80c6\u653e\u5fc3\u53bb\u7528\u5427\uff01\uff09 \u4e3a\u4e86\u4e0d\u5f71\u54cd\u4e4b\u524d\u7684\u4ee3\u7801\uff0c\u6211\u4eec\u7279\u610f \u521b\u5efa\u4e86 \u4e00\u4e2aConfig\u53d8\u91cf\uff0c\u548c\u4e4b\u524d\u4fdd\u6301\u4e00\u81f4\u3002","title":"\u884c\u52a8\u8d77\u6765"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28112%29%20%E5%A4%9A%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E6%94%B9%E9%80%A0/#configuration","text":"\u6211\u4eec\u628a\u73b0\u6709\u7684configuration.json\u6539\u4e3aconfiguration_dev.json\u5e76\u590d\u5236\u4e00\u4efd\uff0c\u547d\u540d\u4e3aconfiguration_pro.json\u3002 \u7f16\u5199\u83b7\u53d6\u6587\u4ef6\u540d\u7684\u65b9\u6cd5 \u8c03\u6574\u83b7\u53d6\u548cupdate\u76f8\u5173\u65b9\u6cd5","title":"\u6539\u9020configuration\u76f8\u5173\u5185\u5bb9"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28112%29%20%E5%A4%9A%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E6%94%B9%E9%80%A0/#_6","text":"\u4e3a\u4e86\u66f4\u5e05\u6c14\u4e00\u70b9\uff0c\u6211\u4eec\u53ef\u4ee5\u52a0\u4e0a\u4e4b\u524d\u5b66\u8fc7\u7684banner\u548c\u5f53\u524d\u73af\u5883\u6807\u8bc6\uff0c\u4ee5\u65e5\u5fd7\u7684\u5f62\u5f0f\u6253\u5370\u51fa\u6765\u3002\u5148\u770b\u770b\u6700\u7ec8\u6548\u679c: \u6dfb\u52a0\u73af\u5883\u53d8\u91cf \u5728\u521d\u59cb\u5316\u65e5\u5fd7\u4e4b\u540e\u6253\u5370\u76f8\u5173banner\u63d0\u793a \u5728main.py\u521d\u59cb\u5316logger\u540e\u52a0\u5165\u4ee5\u4e0b\u8bed\u53e5: from config import BANNER logger . bind ( name = None ) . opt ( ansi = True ) . info ( f \"pity is running at <red> { PITY_ENV } </red>\" ) logger . bind ( name = None ) . info ( BANNER ) \u5728config.py\u5e95\u90e8\u5199\u5165banner BANNER = \"\"\" ________ ___ _________ ___ ___ |\\ __ \\ |\\ \\ |\\___ ___\\ |\\ \\ / /| \\ \\ \\|\\ \\ \\ \\ \\ \\|___ \\ \\_| \\ \\ \\/ / / \\ \\ ____\\ \\ \\ \\ \\ \\ \\ \\ \\ / / \\ \\ \\___| \\ \\ \\ \\ \\ \\ \\/ / / \\ \\__\\ \\ \\__\\ \\ \\__\\ __/ / / \\|__| \\|__| \\|__| |\\___/ / \\|___|/ \"\"\" \u4ece\u6548\u679c\u56fe\u53ef\u4ee5\u770b\u51fa\uff0c\u6211\u4eec\u6253\u5370\u51fa\u4e86\u5f53\u524d\u7684\u73af\u5883, \u8d85\u8d5b\u795epro\u3002 \u4eca\u5929\u7684\u5185\u5bb9\u5c31\u5206\u4eab\u5230\u8fd9\u91cc\uff0c\u5927\u5bb6\u4e5f\u53ef\u4ee5\u8bd5\u8bd5\u7ed9\u81ea\u5df1\u7684\u9879\u76ee\u52a0\u70b9\u5e05\u6c14\u7684 banner .","title":"\u6d4b\u8bd5\u4e00\u4e0b"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28113%29%20%E7%AE%80%E5%8D%95%E6%89%93%E9%80%A0%E5%B7%A5%E4%BD%9C%E5%8F%B0/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u7f16\u5199\u4e86 \u591a\u73af\u5883\u914d\u7f6e \u76f8\u5173\u7684\u4ee3\u7801\uff0c\u76f8\u4fe1\u5927\u5bb6\u90fd\u5df2\u7ecf\u4f1a\u90e8\u7f72\u591a\u5957\u73af\u5883\u7684\u4ee3\u7801\u4e86\u3002 \u8fd9\u4e00\u8282\u6211\u4eec\u6765\u8c03\u6574\u4e0b\u8fa3\u4e2a\u4e11\u4e11\u7684 \u5de5\u4f5c\u53f0 \u3002 \u53ef\u4ee5\u770b\u5230\uff0c\u5185\u5bb9\u5f88\u7a7a\u6cdb\uff0c\u4f5c\u4e3a\u4e00\u4e2a\u9996\u9875\uff0c\u7740\u5b9e\u6709\u70b9 \u5bd2\u789c \u3002\u65e2\u7136\u5b83\u662f\u6211\u4eec\u7684\u95e8\u9762\uff0c\u90a3\u5f53\u7136\u4e0d\u80fd\u7ee7\u7eed\u8ba9\u5b83\u4e11\u4e0b\u53bb\u3002\u6240\u4ee5\u8fd9\u8282\u6211\u4eec\u5c31\u6765\u72e0\u72e0\u6574\u987f\u4e00\u4e0b\u3002 \u53c2\u8003 \u5728\u6211\u4eec\u6beb\u65e0\u5934\u7eea\u7684\u65f6\u5019\uff0c\u4e0d\u59a8\u770b\u770b\u4e00\u4e9b\u4e13\u4e1a\u7684\u5e73\u53f0\u3002\u6bd4\u5982antd pro\u7684\u5de5\u4f5c\u53f0\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u770b\u6709\u54ea\u4e9b\u80fd\u501f\u9274\u7684\u5185\u5bb9\u3002 \u4e0a\u9762\u7684\u5185\u5bb9\u6211\u4eec\u53ef\u4ee5 \u501f\u9274 \u7684\u6709\u7ea2\u7ebf\u76843\u4e2a\u90e8\u5206\uff0c\u6211\u4eec\u7b80\u5355\u6982\u62ec\u4e0b\u5c31\u662f: \u5feb\u901f\u5bfc\u822a \u7528\u6237\u699c\u5355 \u7528\u6765\u67e5\u770b\u7528\u6237\u7684\u4e00\u4e9b\u6392\u540d\u554a\u5565\u7684 \u9879\u76ee \u8fd9\u91cc\u7684\u9879\u76ee\u6211\u4eec\u4f1a\u4ee5 \u6d4b\u8bd5\u8ba1\u5212 \u4e3a\u7ef4\u5ea6\uff0c\u4f53\u73b0\u5404\u4e2a\u6d4b\u8bd5\u8ba1\u5212\u7684\u6570\u636e\u3002\u4ec0\u4e48\u610f\u601d\u5462\uff1f\u5f53\u6211\u4eec\u8ba4\u4e3a\u67d0\u4e9b \u6838\u5fc3\u6d4b\u8bd5\u96c6 \u5f88\u503c\u5f97\u5173\u6ce8\u7684\u65f6\u5019\uff0c\u6211\u4eec\u53ef\u4ee5\u5173\u6ce8\u8be5\u5185\u5bb9\uff0c\u8fd9\u6837\u5de5\u4f5c\u53f0\u4f1a\u7ed9\u6211\u4eec\u6700\u76f4\u89c2\u7684\u6570\u636e\u663e\u793a\uff0c\u6bd4\u5982 \u901a\u8fc7\u7387 \u7b49\u3002 \u90a3\uff0c\u8bdd\u4e0d\u591a\u8bf4\uff0c\u7518\u8517!\u6211\u4eec\u6765\u5404\u4e2a\u51fb\u7834\u3002 \u6392\u540d\u90e8\u5206 \u6211\u4eec\u9700\u89813\u4e2a\u6570\u636e\uff0c\u7528\u6237\u53c2\u4e0e\u4e86\u54ea\u4e9b\u9879\u76ee/\u7528\u6237\u521b\u5efa\u4e86\u591a\u5c11case/\u603b\u5171\u6709\u591a\u5c11\u4eba\u3002 app/crud/project/ProjectDao.py\u4e2d\u65b0\u589e\u4ee5\u4e0b\u65b9\u6cd5 @staticmethod async def query_user_project ( user_id : int ) -> int : \"\"\" created by woody at 2022-02-13 12:05 \u67e5\u8be2\u7528\u6237\u6709\u591a\u5c11\u9879\u76ee :param user_id: \u7528\u6237id :return: \u8fd4\u56de\u9879\u76ee\u6570\u91cf \"\"\" ans = set () async with async_session () as session : async with session . begin (): # \u5148\u9009\u51fa\u672a\u88ab\u5220\u9664\u7684\u7528\u6237 project_sql = select ( Project ) . where ( Project . deleted_at == 0 ) projects = await session . execute ( project_sql ) project_list = [] # \u5c06\u6570\u636e\u653e\u5165\u5217\u8868\uff0c\u628aowner\u7b49\u4e8e\u8be5\u7528\u6237\u7684\u653e\u5165\u5217\u8868 for r in projects . scalars () . all (): project_list . append ( r . id ) if r . owner == user_id : ans . add ( r . id ) # \u63a5\u7740\u67e5\u8be2\u9879\u76ee\u89d2\u8272\u8868\u6709\u8be5\u7528\u6237\u7684\u89d2\u8272\uff0c\u628a\u89d2\u8272\u7684\u9879\u76eeid\u653e\u5165\u5217\u8868 # \u7531\u4e8e\u662fset\uff0c\u6240\u4ee5\u4e0d\u4f1a\u91cd\u590d query = await session . execute ( select ( ProjectRole ) . where ( ProjectRole . deleted_at == 0 , ProjectRole . user_id == user_id )) for q in query . scalars () . all (): ans . add ( q . project_id ) return len ( ans ) \u4e00\u4e2a\u7528\u6237\u6709\u591a\u5c11\u9879\u76ee\uff0c\u67092\u79cd\u60c5\u51b5: \u6709\u591a\u5c11\u4e2a\u9879\u76ee\u7684owner\u662f\u4ed6 \u9879\u76ee\u89d2\u8272\u8868\u91cc\u6709\u591a\u5c11\u4e2a\u7528\u6237\u662f\u4ed6\uff0c\u5e76\u4e14\u8fd8\u8981\u505a\u5230\u9879\u76ee\u53bb\u91cd \u7531\u4e8e\u6211\u7684SQL\u662f\u771f\u7684\u4e0d\u592a\u597d\uff0c\u6240\u4ee5\u5c31\u91c7\u7528\u4e86\u4ee3\u7801\u7684\u5f62\u5f0f\u76f4\u63a5\u7f16\u5199\u4e86\u3002 \u8fd9\u6837\u6211\u4eec\u5c31\u80fd\u67e5\u51fa\u7528\u6237\u5728\u54ea\u4e9b\u9879\u76eeid\u91cc\u9762\u4e86\u3002 \u65b0\u589eapp/crud/test_case/TestCaseDao.py\u91cc\u9762\u7684\u67e5\u8be2\u7528\u6237\u6392\u540d\u65b9\u6cd5 @staticmethod @RedisHelper . cache ( \"rank\" ) async def query_user_case_list () -> Dict [ str , List ]: \"\"\" created by woody at 2022-10-13 12:59 \u67e5\u8be2\u7528\u6237case\u6570\u91cf\u548c\u6392\u540d :return: \"\"\" ans = dict () async with async_session () as session : async with session . begin (): sql = select ( TestCase . create_user , func . count ( TestCase . id )) \\ . outerjoin ( User , and_ ( User . deleted_at == 0 , TestCase . create_user == User . id )) . where ( TestCase . deleted_at == 0 ) . group_by ( TestCase . create_user ) . order_by ( desc ( func . count ( TestCase . id ))) query = await session . execute ( sql ) for i , q in enumerate ( query . all ()): user , count = q ans [ str ( user )] = [ count , i + 1 ] return ans \u8fd9\u4e2a\u64cd\u4f5c\u662f\u67e5\u8be2\u51fa\u7528\u6237\u6709\u591a\u5c11\u6761\u7528\u4f8b\uff0c\u5e76\u6839\u636e\u7528\u6237\u7684case\u6570\u91cf\u6392\u5e8f\uff0c\u6700\u540e\u7684ans\u5b58\u50a8\u7684\u662f\u4e00\u4e2a\u6620\u5c04\u5173\u7cfb, userid => \u7528\u4f8b\u6570\u91cf \u548c \u6392\u540d \u3002 \u7531\u4e8e\u8fd9\u5757\u6570\u636e\u7b97 \u9ad8\u9891\u6570\u636e \uff0c\u6240\u4ee5\u6211\u4eec\u653e\u5165redis\uff0c\u5927\u698230\u79d2\u7684\u8fc7\u671f\u65f6\u95f4\u3002\uff08\u540e\u7eed\u65b0\u589ecase\u7684\u65f6\u5019\u4f1a\u5f71\u54cd\u5230\u6570\u91cf\uff0c\u6240\u4ee5\u8fd8\u5f97\u53bb\u5220\u9664\u7f13\u5b58\u3002\uff09 \u7f16\u5199app/routers/workspace/workspace.py from fastapi import APIRouter , Depends from app.crud.project.ProjectDao import ProjectDao from app.crud.test_case.TestCaseDao import TestCaseDao from app.handler.fatcory import PityResponse from app.routers import Permission router = APIRouter ( prefix = \"/workspace\" ) @router . get ( \"/\" , description = \"\u83b7\u53d6\u5de5\u4f5c\u53f0\u7528\u6237\u7edf\u8ba1\u6570\u636e\" ) async def query_user_statistics ( user_info = Depends ( Permission ())): user_id = user_info [ 'id' ] count = await ProjectDao . query_user_project ( user_id ) rank = await TestCaseDao . query_user_case_list () case_count , user_rank = rank [ str ( user_id )] return PityResponse . success ( dict ( project_count = count , case_count = case_count , user_rank = user_rank , total_user = len ( rank ))) \u4fee\u6539\u9875\u9762 \u5199\u4e00\u4e2a\u65b0\u7ec4\u4ef6\uff0c\u91cc\u9762\u8bfb\u53d6\u521a\u624d\u63a5\u53e3\u7684\u8fd9\u4e9b\u6570\u636e\uff0c\u5177\u4f53\u7684\u7ec6\u8282\u6211\u5c31\u4e0d\u5c55\u793a\u4e86\uff0c\u63a5\u7740\u4f20\u9012\u7ed9PageContainer\u7ec4\u4ef6\u7684extraContent\u3002 \u770b\u770b\u6548\u679c: \u5feb\u901f\u5bfc\u822a \u5feb\u901f\u5bfc\u822a\uff0c\u662f\u6bd4\u8f83\u5b9e\u7528\u7684\u529f\u80fd\uff0c\u4e00\u822c\u6765\u8bf4\u80fd\u7ed9\u7528\u6237\u81ea\u5b9a\u4e49\u53bb\u4f7f\u7528\u4f1a\u6bd4\u8f83\u65b9\u4fbf\uff0c\u4f46\u6211\u4eec\u4e3a\u4e86\u8282\u7ea6\u65f6\u95f4\uff0c\u53ea\u5148\u5b8c\u6210\u56fa\u5b9a\u94fe\u63a5\u7684\u90e8\u5206\u3002 \u5b9a\u4e49\u4e00\u4e2atag\u7ec4\u4ef6\uff1a \u5199\u5165\u5e38\u7528\u7684\u7ec4\u4ef6: \u5b9e\u9645\u6548\u679c: \u6d4b\u8bd5\u8ba1\u5212\u7684\u6570\u636e\u5c55\u793a \u7531\u4e8e\u7bc7\u5e45\u5173\u7cfb\uff0c\u6211\u4eec\u5c31\u4e0d\u8be6\u7ec6\u8bf4\u4e86\uff0c\u5927\u6982\u7684\u601d\u8def: \u65b0\u589e\u4e00\u4e2a\u6d4b\u8bd5\u8ba1\u5212\u5173\u7cfb\u8868\uff0c\u91cc\u9762\u5b58\u653e \u7528\u6237xx \u5173\u6ce8\u4e86 \u6d4b\u8bd5\u8ba1\u5212id \u5728\u6d4b\u8bd5\u8ba1\u5212\u9875\u9762\u8fdb\u884c\u4e9b\u8bb8\u6539\u52a8\uff0c\u7528\u6237\u53ef\u4ee5 \u5173\u6ce8 \u548c \u53d6\u5173 \u6d4b\u8bd5\u8ba1\u5212 \u88ab\u5173\u6ce8\u7684\u6d4b\u8bd5\u8ba1\u5212\uff0c\u5b83\u7684\u6700\u8fd1\u7684\u6267\u884c\u7edf\u8ba1\u6570\u636e\u90fd\u4f1a\u6446\u5728\u5de5\u4f5c\u53f0\u9996\u9875 \u8fd9\u4e9b\u5185\u5bb9\u90fd\u505a\u597d\u4e86\u4e4b\u540e\u5c31\u5dee\u4e0d\u591a\u4e86\uff0c\u76f8\u4fe1\u80fd\u8ddf\u5230\u8fd9\u91cc\u7684\u670b\u53cb\u4e5f\u90fd\u80fd\u81ea\u529b\u66f4\u751f\u53bb\u5b8c\u6210\u8fd9\u4e9b\u5185\u5bb9\u4e86\u3002\u4ee3\u7801\u4e5f\u4f1a\u6301\u7eed\u8ddf\u8fdb\u5230github\uff0c\u5927\u5bb6\u53ef\u4ee5\u81ea\u53d6\u3002 \u4f53\u4f1a \u8bf4\u8bf4\u6211\u7684\u611f\u53d7\uff0c\u6587\u5b57\u7684\u4e1c\u897f\u597d\u5904\u662f\u770b\u8d77\u6765\u65b9\u4fbf\uff0c\u4f46\u5176\u5b9e\u8981\u8bb2\u7684\u4e1c\u897f\u5f88\u591a\uff0c\u5199\u591a\u4e86\u5c31\u5f88\u5570\u55e6\u3002\u4f46\u89c6\u9891\u6216\u8005\u5176\u4ed6\u65b9\u5f0f\u53c8\u5f88\u96be\u6293\u4f4f\u91cd\u70b9\uff0c\u6240\u4ee5\u672c\u9879\u76ee\u7684\u6587\u5b57\u6559\u7a0b\u4e5f\u63a5\u8fd1 \u5b8c\u7ed3 \u4e86\u3002 \u540e\u7eed\u4f1a\u4f18\u5316\u4ee3\u7801\uff0c\u4e30\u5bcc\u6587\u6863\uff0c\u66f4\u9762\u5411\u4f7f\u7528\u4e86\u3002\u5982\u679c\u7ee7\u7eed\u51fa\u6587\u5b57\u6559\u7a0b\uff0c\u4e0d\u4f1a\u7279\u522b\u7ec6\u81f4\u4e86\uff0c\u4e00\u822c\u662f\u601d\u8def\u52a0\u6838\u5fc3\u4ee3\u7801\u3002","title":"113.\u7b80\u5355\u6253\u9020\u5de5\u4f5c\u53f0"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28113%29%20%E7%AE%80%E5%8D%95%E6%89%93%E9%80%A0%E5%B7%A5%E4%BD%9C%E5%8F%B0/#_1","text":"\u4e0a\u4e00\u8282\u6211\u4eec\u7f16\u5199\u4e86 \u591a\u73af\u5883\u914d\u7f6e \u76f8\u5173\u7684\u4ee3\u7801\uff0c\u76f8\u4fe1\u5927\u5bb6\u90fd\u5df2\u7ecf\u4f1a\u90e8\u7f72\u591a\u5957\u73af\u5883\u7684\u4ee3\u7801\u4e86\u3002 \u8fd9\u4e00\u8282\u6211\u4eec\u6765\u8c03\u6574\u4e0b\u8fa3\u4e2a\u4e11\u4e11\u7684 \u5de5\u4f5c\u53f0 \u3002 \u53ef\u4ee5\u770b\u5230\uff0c\u5185\u5bb9\u5f88\u7a7a\u6cdb\uff0c\u4f5c\u4e3a\u4e00\u4e2a\u9996\u9875\uff0c\u7740\u5b9e\u6709\u70b9 \u5bd2\u789c \u3002\u65e2\u7136\u5b83\u662f\u6211\u4eec\u7684\u95e8\u9762\uff0c\u90a3\u5f53\u7136\u4e0d\u80fd\u7ee7\u7eed\u8ba9\u5b83\u4e11\u4e0b\u53bb\u3002\u6240\u4ee5\u8fd9\u8282\u6211\u4eec\u5c31\u6765\u72e0\u72e0\u6574\u987f\u4e00\u4e0b\u3002","title":"\u56de\u987e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28113%29%20%E7%AE%80%E5%8D%95%E6%89%93%E9%80%A0%E5%B7%A5%E4%BD%9C%E5%8F%B0/#_2","text":"\u5728\u6211\u4eec\u6beb\u65e0\u5934\u7eea\u7684\u65f6\u5019\uff0c\u4e0d\u59a8\u770b\u770b\u4e00\u4e9b\u4e13\u4e1a\u7684\u5e73\u53f0\u3002\u6bd4\u5982antd pro\u7684\u5de5\u4f5c\u53f0\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u770b\u6709\u54ea\u4e9b\u80fd\u501f\u9274\u7684\u5185\u5bb9\u3002 \u4e0a\u9762\u7684\u5185\u5bb9\u6211\u4eec\u53ef\u4ee5 \u501f\u9274 \u7684\u6709\u7ea2\u7ebf\u76843\u4e2a\u90e8\u5206\uff0c\u6211\u4eec\u7b80\u5355\u6982\u62ec\u4e0b\u5c31\u662f: \u5feb\u901f\u5bfc\u822a \u7528\u6237\u699c\u5355 \u7528\u6765\u67e5\u770b\u7528\u6237\u7684\u4e00\u4e9b\u6392\u540d\u554a\u5565\u7684 \u9879\u76ee \u8fd9\u91cc\u7684\u9879\u76ee\u6211\u4eec\u4f1a\u4ee5 \u6d4b\u8bd5\u8ba1\u5212 \u4e3a\u7ef4\u5ea6\uff0c\u4f53\u73b0\u5404\u4e2a\u6d4b\u8bd5\u8ba1\u5212\u7684\u6570\u636e\u3002\u4ec0\u4e48\u610f\u601d\u5462\uff1f\u5f53\u6211\u4eec\u8ba4\u4e3a\u67d0\u4e9b \u6838\u5fc3\u6d4b\u8bd5\u96c6 \u5f88\u503c\u5f97\u5173\u6ce8\u7684\u65f6\u5019\uff0c\u6211\u4eec\u53ef\u4ee5\u5173\u6ce8\u8be5\u5185\u5bb9\uff0c\u8fd9\u6837\u5de5\u4f5c\u53f0\u4f1a\u7ed9\u6211\u4eec\u6700\u76f4\u89c2\u7684\u6570\u636e\u663e\u793a\uff0c\u6bd4\u5982 \u901a\u8fc7\u7387 \u7b49\u3002 \u90a3\uff0c\u8bdd\u4e0d\u591a\u8bf4\uff0c\u7518\u8517!\u6211\u4eec\u6765\u5404\u4e2a\u51fb\u7834\u3002","title":"\u53c2\u8003"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28113%29%20%E7%AE%80%E5%8D%95%E6%89%93%E9%80%A0%E5%B7%A5%E4%BD%9C%E5%8F%B0/#_3","text":"\u6211\u4eec\u9700\u89813\u4e2a\u6570\u636e\uff0c\u7528\u6237\u53c2\u4e0e\u4e86\u54ea\u4e9b\u9879\u76ee/\u7528\u6237\u521b\u5efa\u4e86\u591a\u5c11case/\u603b\u5171\u6709\u591a\u5c11\u4eba\u3002 app/crud/project/ProjectDao.py\u4e2d\u65b0\u589e\u4ee5\u4e0b\u65b9\u6cd5 @staticmethod async def query_user_project ( user_id : int ) -> int : \"\"\" created by woody at 2022-02-13 12:05 \u67e5\u8be2\u7528\u6237\u6709\u591a\u5c11\u9879\u76ee :param user_id: \u7528\u6237id :return: \u8fd4\u56de\u9879\u76ee\u6570\u91cf \"\"\" ans = set () async with async_session () as session : async with session . begin (): # \u5148\u9009\u51fa\u672a\u88ab\u5220\u9664\u7684\u7528\u6237 project_sql = select ( Project ) . where ( Project . deleted_at == 0 ) projects = await session . execute ( project_sql ) project_list = [] # \u5c06\u6570\u636e\u653e\u5165\u5217\u8868\uff0c\u628aowner\u7b49\u4e8e\u8be5\u7528\u6237\u7684\u653e\u5165\u5217\u8868 for r in projects . scalars () . all (): project_list . append ( r . id ) if r . owner == user_id : ans . add ( r . id ) # \u63a5\u7740\u67e5\u8be2\u9879\u76ee\u89d2\u8272\u8868\u6709\u8be5\u7528\u6237\u7684\u89d2\u8272\uff0c\u628a\u89d2\u8272\u7684\u9879\u76eeid\u653e\u5165\u5217\u8868 # \u7531\u4e8e\u662fset\uff0c\u6240\u4ee5\u4e0d\u4f1a\u91cd\u590d query = await session . execute ( select ( ProjectRole ) . where ( ProjectRole . deleted_at == 0 , ProjectRole . user_id == user_id )) for q in query . scalars () . all (): ans . add ( q . project_id ) return len ( ans ) \u4e00\u4e2a\u7528\u6237\u6709\u591a\u5c11\u9879\u76ee\uff0c\u67092\u79cd\u60c5\u51b5: \u6709\u591a\u5c11\u4e2a\u9879\u76ee\u7684owner\u662f\u4ed6 \u9879\u76ee\u89d2\u8272\u8868\u91cc\u6709\u591a\u5c11\u4e2a\u7528\u6237\u662f\u4ed6\uff0c\u5e76\u4e14\u8fd8\u8981\u505a\u5230\u9879\u76ee\u53bb\u91cd \u7531\u4e8e\u6211\u7684SQL\u662f\u771f\u7684\u4e0d\u592a\u597d\uff0c\u6240\u4ee5\u5c31\u91c7\u7528\u4e86\u4ee3\u7801\u7684\u5f62\u5f0f\u76f4\u63a5\u7f16\u5199\u4e86\u3002 \u8fd9\u6837\u6211\u4eec\u5c31\u80fd\u67e5\u51fa\u7528\u6237\u5728\u54ea\u4e9b\u9879\u76eeid\u91cc\u9762\u4e86\u3002 \u65b0\u589eapp/crud/test_case/TestCaseDao.py\u91cc\u9762\u7684\u67e5\u8be2\u7528\u6237\u6392\u540d\u65b9\u6cd5 @staticmethod @RedisHelper . cache ( \"rank\" ) async def query_user_case_list () -> Dict [ str , List ]: \"\"\" created by woody at 2022-10-13 12:59 \u67e5\u8be2\u7528\u6237case\u6570\u91cf\u548c\u6392\u540d :return: \"\"\" ans = dict () async with async_session () as session : async with session . begin (): sql = select ( TestCase . create_user , func . count ( TestCase . id )) \\ . outerjoin ( User , and_ ( User . deleted_at == 0 , TestCase . create_user == User . id )) . where ( TestCase . deleted_at == 0 ) . group_by ( TestCase . create_user ) . order_by ( desc ( func . count ( TestCase . id ))) query = await session . execute ( sql ) for i , q in enumerate ( query . all ()): user , count = q ans [ str ( user )] = [ count , i + 1 ] return ans \u8fd9\u4e2a\u64cd\u4f5c\u662f\u67e5\u8be2\u51fa\u7528\u6237\u6709\u591a\u5c11\u6761\u7528\u4f8b\uff0c\u5e76\u6839\u636e\u7528\u6237\u7684case\u6570\u91cf\u6392\u5e8f\uff0c\u6700\u540e\u7684ans\u5b58\u50a8\u7684\u662f\u4e00\u4e2a\u6620\u5c04\u5173\u7cfb, userid => \u7528\u4f8b\u6570\u91cf \u548c \u6392\u540d \u3002 \u7531\u4e8e\u8fd9\u5757\u6570\u636e\u7b97 \u9ad8\u9891\u6570\u636e \uff0c\u6240\u4ee5\u6211\u4eec\u653e\u5165redis\uff0c\u5927\u698230\u79d2\u7684\u8fc7\u671f\u65f6\u95f4\u3002\uff08\u540e\u7eed\u65b0\u589ecase\u7684\u65f6\u5019\u4f1a\u5f71\u54cd\u5230\u6570\u91cf\uff0c\u6240\u4ee5\u8fd8\u5f97\u53bb\u5220\u9664\u7f13\u5b58\u3002\uff09","title":"\u6392\u540d\u90e8\u5206"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28113%29%20%E7%AE%80%E5%8D%95%E6%89%93%E9%80%A0%E5%B7%A5%E4%BD%9C%E5%8F%B0/#approutersworkspaceworkspacepy","text":"from fastapi import APIRouter , Depends from app.crud.project.ProjectDao import ProjectDao from app.crud.test_case.TestCaseDao import TestCaseDao from app.handler.fatcory import PityResponse from app.routers import Permission router = APIRouter ( prefix = \"/workspace\" ) @router . get ( \"/\" , description = \"\u83b7\u53d6\u5de5\u4f5c\u53f0\u7528\u6237\u7edf\u8ba1\u6570\u636e\" ) async def query_user_statistics ( user_info = Depends ( Permission ())): user_id = user_info [ 'id' ] count = await ProjectDao . query_user_project ( user_id ) rank = await TestCaseDao . query_user_case_list () case_count , user_rank = rank [ str ( user_id )] return PityResponse . success ( dict ( project_count = count , case_count = case_count , user_rank = user_rank , total_user = len ( rank )))","title":"\u7f16\u5199app/routers/workspace/workspace.py"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28113%29%20%E7%AE%80%E5%8D%95%E6%89%93%E9%80%A0%E5%B7%A5%E4%BD%9C%E5%8F%B0/#_4","text":"\u5199\u4e00\u4e2a\u65b0\u7ec4\u4ef6\uff0c\u91cc\u9762\u8bfb\u53d6\u521a\u624d\u63a5\u53e3\u7684\u8fd9\u4e9b\u6570\u636e\uff0c\u5177\u4f53\u7684\u7ec6\u8282\u6211\u5c31\u4e0d\u5c55\u793a\u4e86\uff0c\u63a5\u7740\u4f20\u9012\u7ed9PageContainer\u7ec4\u4ef6\u7684extraContent\u3002 \u770b\u770b\u6548\u679c:","title":"\u4fee\u6539\u9875\u9762"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28113%29%20%E7%AE%80%E5%8D%95%E6%89%93%E9%80%A0%E5%B7%A5%E4%BD%9C%E5%8F%B0/#_5","text":"\u5feb\u901f\u5bfc\u822a\uff0c\u662f\u6bd4\u8f83\u5b9e\u7528\u7684\u529f\u80fd\uff0c\u4e00\u822c\u6765\u8bf4\u80fd\u7ed9\u7528\u6237\u81ea\u5b9a\u4e49\u53bb\u4f7f\u7528\u4f1a\u6bd4\u8f83\u65b9\u4fbf\uff0c\u4f46\u6211\u4eec\u4e3a\u4e86\u8282\u7ea6\u65f6\u95f4\uff0c\u53ea\u5148\u5b8c\u6210\u56fa\u5b9a\u94fe\u63a5\u7684\u90e8\u5206\u3002 \u5b9a\u4e49\u4e00\u4e2atag\u7ec4\u4ef6\uff1a \u5199\u5165\u5e38\u7528\u7684\u7ec4\u4ef6: \u5b9e\u9645\u6548\u679c:","title":"\u5feb\u901f\u5bfc\u822a"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28113%29%20%E7%AE%80%E5%8D%95%E6%89%93%E9%80%A0%E5%B7%A5%E4%BD%9C%E5%8F%B0/#_6","text":"\u7531\u4e8e\u7bc7\u5e45\u5173\u7cfb\uff0c\u6211\u4eec\u5c31\u4e0d\u8be6\u7ec6\u8bf4\u4e86\uff0c\u5927\u6982\u7684\u601d\u8def: \u65b0\u589e\u4e00\u4e2a\u6d4b\u8bd5\u8ba1\u5212\u5173\u7cfb\u8868\uff0c\u91cc\u9762\u5b58\u653e \u7528\u6237xx \u5173\u6ce8\u4e86 \u6d4b\u8bd5\u8ba1\u5212id \u5728\u6d4b\u8bd5\u8ba1\u5212\u9875\u9762\u8fdb\u884c\u4e9b\u8bb8\u6539\u52a8\uff0c\u7528\u6237\u53ef\u4ee5 \u5173\u6ce8 \u548c \u53d6\u5173 \u6d4b\u8bd5\u8ba1\u5212 \u88ab\u5173\u6ce8\u7684\u6d4b\u8bd5\u8ba1\u5212\uff0c\u5b83\u7684\u6700\u8fd1\u7684\u6267\u884c\u7edf\u8ba1\u6570\u636e\u90fd\u4f1a\u6446\u5728\u5de5\u4f5c\u53f0\u9996\u9875 \u8fd9\u4e9b\u5185\u5bb9\u90fd\u505a\u597d\u4e86\u4e4b\u540e\u5c31\u5dee\u4e0d\u591a\u4e86\uff0c\u76f8\u4fe1\u80fd\u8ddf\u5230\u8fd9\u91cc\u7684\u670b\u53cb\u4e5f\u90fd\u80fd\u81ea\u529b\u66f4\u751f\u53bb\u5b8c\u6210\u8fd9\u4e9b\u5185\u5bb9\u4e86\u3002\u4ee3\u7801\u4e5f\u4f1a\u6301\u7eed\u8ddf\u8fdb\u5230github\uff0c\u5927\u5bb6\u53ef\u4ee5\u81ea\u53d6\u3002","title":"\u6d4b\u8bd5\u8ba1\u5212\u7684\u6570\u636e\u5c55\u793a"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28113%29%20%E7%AE%80%E5%8D%95%E6%89%93%E9%80%A0%E5%B7%A5%E4%BD%9C%E5%8F%B0/#_7","text":"\u8bf4\u8bf4\u6211\u7684\u611f\u53d7\uff0c\u6587\u5b57\u7684\u4e1c\u897f\u597d\u5904\u662f\u770b\u8d77\u6765\u65b9\u4fbf\uff0c\u4f46\u5176\u5b9e\u8981\u8bb2\u7684\u4e1c\u897f\u5f88\u591a\uff0c\u5199\u591a\u4e86\u5c31\u5f88\u5570\u55e6\u3002\u4f46\u89c6\u9891\u6216\u8005\u5176\u4ed6\u65b9\u5f0f\u53c8\u5f88\u96be\u6293\u4f4f\u91cd\u70b9\uff0c\u6240\u4ee5\u672c\u9879\u76ee\u7684\u6587\u5b57\u6559\u7a0b\u4e5f\u63a5\u8fd1 \u5b8c\u7ed3 \u4e86\u3002 \u540e\u7eed\u4f1a\u4f18\u5316\u4ee3\u7801\uff0c\u4e30\u5bcc\u6587\u6863\uff0c\u66f4\u9762\u5411\u4f7f\u7528\u4e86\u3002\u5982\u679c\u7ee7\u7eed\u51fa\u6587\u5b57\u6559\u7a0b\uff0c\u4e0d\u4f1a\u7279\u522b\u7ec6\u81f4\u4e86\uff0c\u4e00\u822c\u662f\u601d\u8def\u52a0\u6838\u5fc3\u4ee3\u7801\u3002","title":"\u4f53\u4f1a"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28114%29%20%E4%B8%83%E7%89%9B%E4%BA%91%E5%9B%BE%E5%BA%8A%E5%88%9D%E4%BD%93%E9%AA%8C/","text":"\u4e00\u8d77\u517b\u6210\u5199\u4f5c\u4e60\u60ef\uff01\u8fd9\u662f\u6211\u53c2\u4e0e\u300c\u6398\u91d1\u65e5\u65b0\u8ba1\u5212 \u00b7 4 \u6708\u66f4\u6587\u6311\u6218\u300d\u7684\u7b2c2\u5929\uff0c \u70b9\u51fb\u67e5\u770b\u6d3b\u52a8\u8be6\u60c5 \u3002 \u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u4e00\u8d77\u4ea4\u6d41\u5b66\u4e60! \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u7f16\u5199\u4e86 \u5de5\u4f5c\u53f0 \u90e8\u5206\u5185\u5bb9\uff0c\u671f\u95f4\u4fee\u590d\u4e86\u4e0d\u5c11bug\uff0c\u4e5f\u5b8c\u5584\u4e86\u5f88\u591a\u7279\u6027\u3002\u9274\u4e8e\u6700\u8fd1gitee\u4e0d\u518d\u63d0\u4f9b\u56fe\u5e8a\u529f\u80fd\u4e86\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u81ea\u5df1\u5207\u6362\u5230 \u514d\u8d39 \u7684\u4e03\u725b\u4e91\u5b58\u50a8\u4e4b\u4e2d\u3002 \u8bdd\u4e0d\u591a\u8bf4\uff0c\u6211\u4eec\u63a5\u7740\u809d\u3002 \u4fee\u6539\u914d\u7f6e \u8fd8\u8bb0\u5f97\u6211\u4eec\u4e4b\u524d\u505a\u8fc7\u7684\u914d\u7f6e\u6587\u4ef6\u5417\uff1f\u6211\u4eec\u628aoss\u7c7b\u578b\u6539\u4e3a qiniu \uff0c\u5e76\u9644\u4e0a\u6211\u4eec\u7533\u8bf7\u597d\u7684token\u3002 \u6dfb\u52a0Config\u4e2d\u5173\u4e8e\u4e03\u725b\u4e91oss\u7684\u914d\u7f6e\u9879 \u5b8c\u5584app/middleware/oss/qiniu.py import os from io import BytesIO import aiohttp from qiniu import Auth , put_stream , BucketManager from app.middleware.oss import OssFile from config import Config class QiniuOss ( OssFile ): _base_path = \"pity\" def __init__ ( self , access_key_id : str , access_key_secret : str , bucket : str ): self . auth = Auth ( access_key_id , access_key_secret ) self . bucket = bucket self . bucket_manager = BucketManager ( self . auth ) def get_full_path ( self , filepath , base_path : str = None ): base_path = base_path if base_path is not None else self . _base_path return f \" { base_path } / { filepath } \" @staticmethod def _convert_to_stream ( content ): stream = BytesIO () stream . write ( content ) return stream async def create_file ( self , filepath : str , content : bytes , base_path : str = None ): key = self . get_full_path ( filepath , base_path ) token = self . auth . upload_token ( self . bucket , key , 3600 ) file_name = os . path . basename ( filepath ) ret , info = put_stream ( token , key , QiniuOss . _convert_to_stream ( content ), file_name , len ( content )) if ret [ 'key' ] != key : raise Exception ( \"\u4e0a\u4f20\u5931\u8d25\" ) return QiniuOss . get_url ( key ), len ( content ), None @staticmethod def get_url ( key ): return f \"https://static.pity.fun/ { key } \" async def update_file ( self , filepath : str , content : bytes , base_path : str = None ): token = self . auth . upload_token ( self . bucket , filepath , 3600 ) file_name = os . path . basename ( filepath ) key = self . get_full_path ( filepath , base_path ) ret , info = put_stream ( token , key , content , file_name , len ( content )) if ret [ 'key' ] != key : raise Exception ( \"\u66f4\u65b0\u5931\u8d25\" ) async def delete_file ( self , filepath : str , base_path : str = None ): key = self . get_full_path ( filepath , base_path ) self . bucket_manager . delete ( self . bucket , key ) async def list_file ( self ): pass async def download_file ( self , filepath , base_path : str = None ): key = self . get_full_path ( filepath , base_path ) exists , _ = self . bucket_manager . stat ( self . bucket , key ) if exists is None : raise Exception ( \"\u6587\u4ef6\u4e0d\u5b58\u5728\" ) base_url = ' %s / %s / %s ' % ( Config . OSS_URL , self . bucket , filepath ) url = self . auth . private_download_url ( base_url , expires = 3600 ) content , real_name = await self . download_object ( key , url ) return content , real_name async def download_object ( self , filepath , url , timeout = 15 ): async with aiohttp . ClientSession () as session : async with session . request ( \"GET\" , url , timeout = timeout , verify_ssl = False ) as resp : if resp . status != 200 : raise Exception ( \"download file failed\" ) real_filename = filepath . split ( \"/\" )[ - 1 ] path = rf './ { self . get_random_filename ( real_filename ) } ' with open ( path , 'wb' ) as f : data = await resp . content . read () f . write ( data ) return path , real_filename async def get_file_object ( self , filepath ): pass # if not self.bucket.object_exists(filepath): # raise Exception(f\"oss\u6587\u4ef6: {filepath}\u4e0d\u5b58\u5728\") # file_object = self.bucket.get_object(filepath) # return file_object.resp.response.content \u8fd9\u91cc\u76f4\u63a5\u5c31\u8d34\u4e86\u4ee3\u7801\uff0c\u6211\u4eec\u7a0d\u5fae\u8bb2\u89e3\u4e00\u4e0b\u3002 auth auth\u662f\u4e03\u725b\u4e91\u7684\u8ba4\u8bc1\u5bf9\u8c61\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5b83\u4e0a\u4f20/\u4e0b\u8f7d\u6587\u4ef6\u3002 bucket_manager \u662fbucket\u7684\u7ba1\u7406\u5bf9\u8c61\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7bucket\u53bb\u67e5\u8be2\u5bf9\u8c61\u7684\u4fe1\u606f\u3002 download_object \u7531\u4e8e\u4e03\u725b\u4e91\u4e0d\u63d0\u4f9b\u76f4\u63a5\u4e0b\u8f7d\u7684\u529f\u80fd \uff0c\u800c\u662f\u91c7\u7528\u63d0\u4f9b\u4e00\u4e2a \u94fe\u63a5 \u7684\u5f62\u5f0f\uff0c\u6240\u4ee5\u6211\u4eec\u5f97\u81ea\u5df1\u5199\u4e00\u4e2ahttp\u8bf7\u6c42\uff08\u5f02\u6b65\uff09\u53bb\u83b7\u53d6url\u7684content\u6570\u636e\uff0c\u5e76\u628a\u5b83\u5199\u5165\u4e34\u65f6\u6587\u4ef6\uff0c\u8fd9\u70b9\u548c\u4e4b\u524d\u6bd4\u8f83\u76f8\u4f3c\u3002 base_path \u4e4b\u6240\u4ee5\u9700\u8981base_path\uff0c\u662f\u56e0\u4e3a\u6211\u4eec\u7684oss\u5206\u4e3a\u5f88\u591a\u7c7b\u522b\uff0c\u6bd4\u5982\u7528\u6237\u5934\u50cf\uff0c\u9879\u76ee\u5934\u50cf\uff0c\u4ee5\u540e\u8fd8\u53ef\u80fd\u4f1a\u6709\u5176\u4ed6\u7684\u5934\u50cf\uff0c\u6211\u4eec\u9700\u8981\u4e0e \u6d4b\u8bd5\u6570\u636e \uff08\u6587\u4ef6\u4e0a\u4f20\u7528\u5230\u7684\u6d4b\u8bd5\u6570\u636e\uff09\u5206\u5f00\uff0c\u6240\u4ee5\u6211\u4eec\u8bbe\u7acb\u4e86\u8fd9\u4e2a\u57fa\u7840\u8def\u5f84\uff0c\u4ee5\u540e\u6d4b\u8bd5\u6570\u636e\u5c31\u90fd\u4ece\u8fd9\u4e2a\u76ee\u5f55\u83b7\u53d6\uff0c\u800c\u5934\u50cf\u5219\u90fd\u8bbe\u7f6ebase_path\u4e3a avatar \u3002 \u8bf4\u767d\u4e86\u5c31\u662f\u4e3a\u4e86\u533a\u5206\u6570\u636e\u3002 get_url \u6211\u4eec\u7684url\u90fd\u662f\u56fa\u5b9a\u7684\uff0c\u81ea\u5df1\u7684\u57df\u540d+\u5b58\u50a8\u7684\u8def\u5f84\uff0c\u6240\u4ee5\u6211\u4eec\u662f\u53ef\u4ee5\u76f4\u63a5\u62fc\u51d1\u51fa\u6765\u7684\u3002 _convert_to_stream \u8fd9\u4e2a\u65b9\u6cd5\u6bd4\u8f83\u7279\u522b\uff0c\u7531\u4e8e\u4e03\u725b\u4e91\u4e0a\u4f20\u53ea\u652f\u6301 \u6587\u4ef6\u8def\u5f84 or \u6587\u4ef6\u6d41\u5bf9\u8c61 \uff0c\u6240\u4ee5\u5f53\u6211\u4eec\u62e5\u6709bytes\u6570\u636e\u7684\u65f6\u5019\uff0c\u9700\u8981\u8f6c\u6362\u4e3aBytesIo\u6570\u636e\uff0c\u7279\u6b64\u7f16\u5199\u4e86\u8fd9\u79cd\u65b9\u6cd5\u3002 \u603b\u7ed3\u4e00\u4e0b\uff0c\u4e03\u725b\u4e91oss\u548c\u5176\u4ed6oss\u8fd8\u662f\u6709\u4e00\u4e9b\u4e0d\u4e00\u6837\u7684\u5730\u65b9\uff0c\u4f46\u6bd5\u7adf\u514d\u8d39\uff0c\u6240\u4ee5\u5c31\u9002\u5e94\u4e00\u4e0b\u5566\u3002 \u4fee\u6539app/middleware/oss/__init__.py \u6211\u4eec\u4fee\u6539get_oss_client\u65b9\u6cd5: \u4ee5\u540e\u652f\u6301\u5176\u4ed6oss\u53ef\u4ee5\u7ee7\u7eed\u518d\u6b64\u6dfb\u52a0\u3002 \u6d4b\u8bd5\u4e0b\u9875\u9762\u662f\u5426\u6b63\u5e38 \u53ef\u4ee5\u770b\u5230\uff0c\u4e0b\u8f7d\u6b63\u5e38\u3002\u90a3\u5176\u4ed6\u7684\u535a\u4e3b\u4e5f\u8dd1\u4e86\u8dd1\uff0c\u56e0\u4e3a\u57fa\u672c\u90fd\u662f\u8c03\u4e03\u725b\u7684api\uff0c\u6240\u4ee5\u4e5f\u6ca1\u5565\u95ee\u9898\u3002 \u4eca\u5929\u7684\u5185\u5bb9\u5c31\u5148\u4ecb\u7ecd\u5230\u8fd9\u91cc\uff0c\u4e0b\u4e00\u8282\u8bb2\u8ff0\u5982\u4f55\u7528github action\u5b8c\u6210\u81ea\u52a8\u90e8\u7f72\u529f\u80fd\uff0c\u8282\u7ea6\u5927\u5bb6\u7684\u65f6\u95f4\uff01","title":"114.\u4e03\u725b\u4e91\u56fe\u5e8a\u521d\u4f53\u9a8c"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28114%29%20%E4%B8%83%E7%89%9B%E4%BA%91%E5%9B%BE%E5%BA%8A%E5%88%9D%E4%BD%93%E9%AA%8C/#_1","text":"\u4e0a\u4e00\u8282\u6211\u4eec\u7f16\u5199\u4e86 \u5de5\u4f5c\u53f0 \u90e8\u5206\u5185\u5bb9\uff0c\u671f\u95f4\u4fee\u590d\u4e86\u4e0d\u5c11bug\uff0c\u4e5f\u5b8c\u5584\u4e86\u5f88\u591a\u7279\u6027\u3002\u9274\u4e8e\u6700\u8fd1gitee\u4e0d\u518d\u63d0\u4f9b\u56fe\u5e8a\u529f\u80fd\u4e86\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u81ea\u5df1\u5207\u6362\u5230 \u514d\u8d39 \u7684\u4e03\u725b\u4e91\u5b58\u50a8\u4e4b\u4e2d\u3002 \u8bdd\u4e0d\u591a\u8bf4\uff0c\u6211\u4eec\u63a5\u7740\u809d\u3002","title":"\u56de\u987e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28114%29%20%E4%B8%83%E7%89%9B%E4%BA%91%E5%9B%BE%E5%BA%8A%E5%88%9D%E4%BD%93%E9%AA%8C/#_2","text":"\u8fd8\u8bb0\u5f97\u6211\u4eec\u4e4b\u524d\u505a\u8fc7\u7684\u914d\u7f6e\u6587\u4ef6\u5417\uff1f\u6211\u4eec\u628aoss\u7c7b\u578b\u6539\u4e3a qiniu \uff0c\u5e76\u9644\u4e0a\u6211\u4eec\u7533\u8bf7\u597d\u7684token\u3002","title":"\u4fee\u6539\u914d\u7f6e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28114%29%20%E4%B8%83%E7%89%9B%E4%BA%91%E5%9B%BE%E5%BA%8A%E5%88%9D%E4%BD%93%E9%AA%8C/#configoss","text":"","title":"\u6dfb\u52a0Config\u4e2d\u5173\u4e8e\u4e03\u725b\u4e91oss\u7684\u914d\u7f6e\u9879"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28114%29%20%E4%B8%83%E7%89%9B%E4%BA%91%E5%9B%BE%E5%BA%8A%E5%88%9D%E4%BD%93%E9%AA%8C/#appmiddlewareossqiniupy","text":"import os from io import BytesIO import aiohttp from qiniu import Auth , put_stream , BucketManager from app.middleware.oss import OssFile from config import Config class QiniuOss ( OssFile ): _base_path = \"pity\" def __init__ ( self , access_key_id : str , access_key_secret : str , bucket : str ): self . auth = Auth ( access_key_id , access_key_secret ) self . bucket = bucket self . bucket_manager = BucketManager ( self . auth ) def get_full_path ( self , filepath , base_path : str = None ): base_path = base_path if base_path is not None else self . _base_path return f \" { base_path } / { filepath } \" @staticmethod def _convert_to_stream ( content ): stream = BytesIO () stream . write ( content ) return stream async def create_file ( self , filepath : str , content : bytes , base_path : str = None ): key = self . get_full_path ( filepath , base_path ) token = self . auth . upload_token ( self . bucket , key , 3600 ) file_name = os . path . basename ( filepath ) ret , info = put_stream ( token , key , QiniuOss . _convert_to_stream ( content ), file_name , len ( content )) if ret [ 'key' ] != key : raise Exception ( \"\u4e0a\u4f20\u5931\u8d25\" ) return QiniuOss . get_url ( key ), len ( content ), None @staticmethod def get_url ( key ): return f \"https://static.pity.fun/ { key } \" async def update_file ( self , filepath : str , content : bytes , base_path : str = None ): token = self . auth . upload_token ( self . bucket , filepath , 3600 ) file_name = os . path . basename ( filepath ) key = self . get_full_path ( filepath , base_path ) ret , info = put_stream ( token , key , content , file_name , len ( content )) if ret [ 'key' ] != key : raise Exception ( \"\u66f4\u65b0\u5931\u8d25\" ) async def delete_file ( self , filepath : str , base_path : str = None ): key = self . get_full_path ( filepath , base_path ) self . bucket_manager . delete ( self . bucket , key ) async def list_file ( self ): pass async def download_file ( self , filepath , base_path : str = None ): key = self . get_full_path ( filepath , base_path ) exists , _ = self . bucket_manager . stat ( self . bucket , key ) if exists is None : raise Exception ( \"\u6587\u4ef6\u4e0d\u5b58\u5728\" ) base_url = ' %s / %s / %s ' % ( Config . OSS_URL , self . bucket , filepath ) url = self . auth . private_download_url ( base_url , expires = 3600 ) content , real_name = await self . download_object ( key , url ) return content , real_name async def download_object ( self , filepath , url , timeout = 15 ): async with aiohttp . ClientSession () as session : async with session . request ( \"GET\" , url , timeout = timeout , verify_ssl = False ) as resp : if resp . status != 200 : raise Exception ( \"download file failed\" ) real_filename = filepath . split ( \"/\" )[ - 1 ] path = rf './ { self . get_random_filename ( real_filename ) } ' with open ( path , 'wb' ) as f : data = await resp . content . read () f . write ( data ) return path , real_filename async def get_file_object ( self , filepath ): pass # if not self.bucket.object_exists(filepath): # raise Exception(f\"oss\u6587\u4ef6: {filepath}\u4e0d\u5b58\u5728\") # file_object = self.bucket.get_object(filepath) # return file_object.resp.response.content \u8fd9\u91cc\u76f4\u63a5\u5c31\u8d34\u4e86\u4ee3\u7801\uff0c\u6211\u4eec\u7a0d\u5fae\u8bb2\u89e3\u4e00\u4e0b\u3002 auth auth\u662f\u4e03\u725b\u4e91\u7684\u8ba4\u8bc1\u5bf9\u8c61\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5b83\u4e0a\u4f20/\u4e0b\u8f7d\u6587\u4ef6\u3002 bucket_manager \u662fbucket\u7684\u7ba1\u7406\u5bf9\u8c61\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7bucket\u53bb\u67e5\u8be2\u5bf9\u8c61\u7684\u4fe1\u606f\u3002 download_object \u7531\u4e8e\u4e03\u725b\u4e91\u4e0d\u63d0\u4f9b\u76f4\u63a5\u4e0b\u8f7d\u7684\u529f\u80fd \uff0c\u800c\u662f\u91c7\u7528\u63d0\u4f9b\u4e00\u4e2a \u94fe\u63a5 \u7684\u5f62\u5f0f\uff0c\u6240\u4ee5\u6211\u4eec\u5f97\u81ea\u5df1\u5199\u4e00\u4e2ahttp\u8bf7\u6c42\uff08\u5f02\u6b65\uff09\u53bb\u83b7\u53d6url\u7684content\u6570\u636e\uff0c\u5e76\u628a\u5b83\u5199\u5165\u4e34\u65f6\u6587\u4ef6\uff0c\u8fd9\u70b9\u548c\u4e4b\u524d\u6bd4\u8f83\u76f8\u4f3c\u3002 base_path \u4e4b\u6240\u4ee5\u9700\u8981base_path\uff0c\u662f\u56e0\u4e3a\u6211\u4eec\u7684oss\u5206\u4e3a\u5f88\u591a\u7c7b\u522b\uff0c\u6bd4\u5982\u7528\u6237\u5934\u50cf\uff0c\u9879\u76ee\u5934\u50cf\uff0c\u4ee5\u540e\u8fd8\u53ef\u80fd\u4f1a\u6709\u5176\u4ed6\u7684\u5934\u50cf\uff0c\u6211\u4eec\u9700\u8981\u4e0e \u6d4b\u8bd5\u6570\u636e \uff08\u6587\u4ef6\u4e0a\u4f20\u7528\u5230\u7684\u6d4b\u8bd5\u6570\u636e\uff09\u5206\u5f00\uff0c\u6240\u4ee5\u6211\u4eec\u8bbe\u7acb\u4e86\u8fd9\u4e2a\u57fa\u7840\u8def\u5f84\uff0c\u4ee5\u540e\u6d4b\u8bd5\u6570\u636e\u5c31\u90fd\u4ece\u8fd9\u4e2a\u76ee\u5f55\u83b7\u53d6\uff0c\u800c\u5934\u50cf\u5219\u90fd\u8bbe\u7f6ebase_path\u4e3a avatar \u3002 \u8bf4\u767d\u4e86\u5c31\u662f\u4e3a\u4e86\u533a\u5206\u6570\u636e\u3002 get_url \u6211\u4eec\u7684url\u90fd\u662f\u56fa\u5b9a\u7684\uff0c\u81ea\u5df1\u7684\u57df\u540d+\u5b58\u50a8\u7684\u8def\u5f84\uff0c\u6240\u4ee5\u6211\u4eec\u662f\u53ef\u4ee5\u76f4\u63a5\u62fc\u51d1\u51fa\u6765\u7684\u3002 _convert_to_stream \u8fd9\u4e2a\u65b9\u6cd5\u6bd4\u8f83\u7279\u522b\uff0c\u7531\u4e8e\u4e03\u725b\u4e91\u4e0a\u4f20\u53ea\u652f\u6301 \u6587\u4ef6\u8def\u5f84 or \u6587\u4ef6\u6d41\u5bf9\u8c61 \uff0c\u6240\u4ee5\u5f53\u6211\u4eec\u62e5\u6709bytes\u6570\u636e\u7684\u65f6\u5019\uff0c\u9700\u8981\u8f6c\u6362\u4e3aBytesIo\u6570\u636e\uff0c\u7279\u6b64\u7f16\u5199\u4e86\u8fd9\u79cd\u65b9\u6cd5\u3002 \u603b\u7ed3\u4e00\u4e0b\uff0c\u4e03\u725b\u4e91oss\u548c\u5176\u4ed6oss\u8fd8\u662f\u6709\u4e00\u4e9b\u4e0d\u4e00\u6837\u7684\u5730\u65b9\uff0c\u4f46\u6bd5\u7adf\u514d\u8d39\uff0c\u6240\u4ee5\u5c31\u9002\u5e94\u4e00\u4e0b\u5566\u3002","title":"\u5b8c\u5584app/middleware/oss/qiniu.py"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28114%29%20%E4%B8%83%E7%89%9B%E4%BA%91%E5%9B%BE%E5%BA%8A%E5%88%9D%E4%BD%93%E9%AA%8C/#appmiddlewareoss__init__py","text":"\u6211\u4eec\u4fee\u6539get_oss_client\u65b9\u6cd5: \u4ee5\u540e\u652f\u6301\u5176\u4ed6oss\u53ef\u4ee5\u7ee7\u7eed\u518d\u6b64\u6dfb\u52a0\u3002","title":"\u4fee\u6539app/middleware/oss/__init__.py"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28114%29%20%E4%B8%83%E7%89%9B%E4%BA%91%E5%9B%BE%E5%BA%8A%E5%88%9D%E4%BD%93%E9%AA%8C/#_3","text":"\u53ef\u4ee5\u770b\u5230\uff0c\u4e0b\u8f7d\u6b63\u5e38\u3002\u90a3\u5176\u4ed6\u7684\u535a\u4e3b\u4e5f\u8dd1\u4e86\u8dd1\uff0c\u56e0\u4e3a\u57fa\u672c\u90fd\u662f\u8c03\u4e03\u725b\u7684api\uff0c\u6240\u4ee5\u4e5f\u6ca1\u5565\u95ee\u9898\u3002 \u4eca\u5929\u7684\u5185\u5bb9\u5c31\u5148\u4ecb\u7ecd\u5230\u8fd9\u91cc\uff0c\u4e0b\u4e00\u8282\u8bb2\u8ff0\u5982\u4f55\u7528github action\u5b8c\u6210\u81ea\u52a8\u90e8\u7f72\u529f\u80fd\uff0c\u8282\u7ea6\u5927\u5bb6\u7684\u65f6\u95f4\uff01","title":"\u6d4b\u8bd5\u4e0b\u9875\u9762\u662f\u5426\u6b63\u5e38"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28115%29%20%E9%85%8D%E7%BD%AE%E6%B5%81%E6%B0%B4%E7%BA%BF%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2%E6%9C%8D%E5%8A%A1/","text":"\u4e00\u8d77\u517b\u6210\u5199\u4f5c\u4e60\u60ef\uff01\u8fd9\u662f\u6211\u53c2\u4e0e\u300c\u6398\u91d1\u65e5\u65b0\u8ba1\u5212 \u00b7 4 \u6708\u66f4\u6587\u6311\u6218\u300d\u7684\u7b2c3\u5929\uff0c \u70b9\u51fb\u67e5\u770b\u6d3b\u52a8\u8be6\u60c5 \u3002 \u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u4e00\u8d77\u4ea4\u6d41\u5b66\u4e60! \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u7f16\u5199\u5e76\u6d4b\u8bd5\u4e86\u65b0\u7684oss\uff0c\u8fd9\u4e00\u8282\u6211\u4eec\u6765\u8bb2\u70b9\u4e0d\u4e00\u6837\u7684\uff0c\u5173\u4e8e\u81ea\u52a8\u90e8\u7f72\u7684\u3002\u5728\u6b64\u4e4b\u524d\u6211\u4eec\u5148\u4ecb\u7ecd\u4e0b\u4f7f\u7528\u80cc\u666f\u3002 \u80cc\u666f \u968f\u7740 pity \u8d8a\u6765\u8d8a\u5b8c\u5584\uff0c\u66f4\u65b0\u7684 \u9891\u7387 \u4e5f\u8d8a\u6765\u8d8a\u9ad8\uff0c\u800c\u4f5c\u4e3a\u4e00\u4e2a \u4e2a\u4eba\u9879\u76ee \uff0c\u5e76\u6ca1\u6709\u516c\u53f8\u7684\u4e00\u5957pipeline\u7684\u673a\u5236\u3002\u4e5f\u5c31\u4f1a\u5bfc\u81f4\u4e00\u4e2a\u95ee\u9898: \u6211\u4eec\u66f4\u65b0\u5728\u7ebf\u4f53\u9a8c\u9879\u76ee\u7684\u65f6\u5019\uff0c\u4f1a\u76f8\u5bf9\u7e41\u7410\uff0c\u5927\u6982\u5206\u4e3a\u4e0b\u9762\u51e0\u4e2a\u6b65\u9aa4: \u670d\u52a1\u5668\u66f4\u65b0\u4ee3\u7801 \u5982\u679c\u4f7f\u7528\u7684\u662fgit\u8fd8\u633a\u65b9\u4fbf\u7684\uff0c\u76f4\u63a5pull\u65b0\u7684\u4ee3\u7801\u5373\u53ef\u3002 \u66f4\u65b0\u4f9d\u8d56 \u6709\u65f6\u5019\u6211\u4eec\u4f1a\u65b0\u589e\u4e00\u4e9b\u7b2c\u4e09\u65b9\u7684 \u5305 \uff0c\u670d\u52a1\u5668\u8fd8\u5f97\u8ddf\u7740\u6267\u884c pip install \u7b49\u64cd\u4f5c\u3002 \u6253\u5305 \u8fd9\u91cc\u4e3b\u8981\u9488\u5bf9\u524d\u7aef\u9879\u76ee\uff0c\u5f80\u5f80\u6211\u4eec\u9700\u8981\u5148build\u4e4b\u540e\uff0c\u518d\u90e8\u7f72\u9759\u6001\u8d44\u6e90\u6587\u4ef6\u3002 \u91cd\u542f \u5927\u6982\u6b65\u9aa4\u6709\u8fd9\u4e48\u591a\uff0c\u6709\u65f6\u5019\u670d\u52a1\u5668\u8bbf\u95eegithub\u6709\u95ee\u9898\uff0c\u8fd8\u4f1a\u51fa\u73b0git pull\u4e0d\u4e0b\u6765\u7b49\u60c5\u51b5\uff0c\u603b\u800c\u8a00\u4e4b\uff0c\u5bf9\u4e8e\u624b\u52a8\u90e8\u7f72\u6765\u8bf4\uff0c\u9891\u7387\u4e0d\u9ad8\u7684\u65f6\u5019\u8fd8\u80fd\u5fcd\u53d7\uff0c \u9891\u7387 \u8fc7\u9ad8\uff0c\u8fd8\u5f97\u5206\u522b\u90e8\u7f72\u524d\u540e\u7aef\u7684\u60c5\u51b5\u4e0b\uff0c\u5c31\u5f88\u6d6a\u8d39\u65f6\u95f4\u4e86\uff01 \u90a3\u4e48\uff0c\u6709\u6ca1\u6709\u4e00\u79cd\u9ad8\u6548\u7684\u81ea\u52a8\u90e8\u7f72\u7684\u65b9\u5f0f\u5462\uff1f\u5f53\u6211\u63d0\u4ea4\u4ee3\u7801\u5230\u6307\u5b9a\u5206\u652f\uff0c\u5c31\u81ea\u52a8\u7ed9\u4ffa\u66f4\u65b0\u65b0\u4ee3\u7801\u5230\u670d\u52a1\u5668\u4e86\uff01 \u7b54\u6848\u662f\u6709\u7684\uff0c\u4eca\u5929\u6211\u4eec\u5c31\u6765\u7b80\u5355\u4ecb\u7ecd\u4e0bgithub action. \u5e38\u89c1\u7684\u90e8\u7f72\u65b9\u5f0f \u5927\u591a\u6570\u516c\u53f8\u90fd\u7528\u4e86gitlab\u4f5c\u4e3a\u4ee3\u7801\u7ba1\u7406\u4ed3\u5e93\uff0c\u6bd4\u5982\u6211\u73b0\u5728\u7684\u516c\u53f8\uff0cgitlab\u91cc\u9762\u914d\u7f6e\u4e86\u5e38\u89c1\u9879\u76ee(nodejs/python/java)\u7684\u81ea\u52a8\u6784\u5efa\u955c\u50cf\u529f\u80fd\uff0c\u4e5f\u5c31\u662f\u8bf4\u6211\u4eec\u63d0\u4ea4\u4ee3\u7801\u4ee5\u540e\uff0c\u65b0\u4ee3\u7801\u5c31\u4f1a\u6253\u5305\u4e3a\u4e00\u4e2adocker image\uff0c\u518d\u4e8e\u53d1\u5e03\u7cfb\u7edf\u6253\u901a\uff0c\u5c31\u53ef\u4ee5\u968f\u4fbf\u53d1\u5e03/\u5207\u6362\u5230\u6307\u5b9a\u7684 \u955c\u50cf \u3002 \u6211\u4eec\u56e0\u4e3a\u662f\u4e2a\u4eba\u9879\u76ee\uff0c\u5c31\u4e0d\u9700\u8981\u505a\u90a3\u4e48 \u590d\u6742 \uff0c\u76f4\u63a5\u7528 Github Action \u5c31\u884c\u4e86\u3002\u4eca\u5929\u6211\u4eec\u5c31\u6765\u8bb2\u4e00\u4e0bpity\u7684\u524d\u7aef\u9879\u76ee\u7528github action\u90e8\u7f72\u7684\u65b9\u6848\u3002 \u5728\u6b64\u4e4b\u524d\u6211\u4eec\u6700\u597d\u68b3\u7406\u4e00\u4e0b\u524d\u7aef\u7684\u53d1\u5e03\u903b\u8f91: npm install \u5b89\u88c5\u4f9d\u8d56 npm run build \u6253\u5305 \u5229\u7528serve\u542f\u52a8\u9759\u6001\u8d44\u6e90\u670d\u52a1 \u4f7f\u7528pm2\u7ba1\u7406serve\u670d\u52a1\u7684\u751f\u547d\u5468\u671f \u65b0\u5efadeploy.yml \u6211\u4eec\u5728\u9879\u76ee \u6839\u76ee\u5f55 \u65b0\u5efa .github \u6587\u4ef6\u5939\uff0c\u63a5\u7740\u8fdb\u5165.github\u6587\u4ef6\u5939\uff0c\u7ee7\u7eed\u65b0\u5efa workflows \u76ee\u5f55\uff0c\u6700\u540e\u5728workflows\u76ee\u5f55\u4e0b\u65b0\u5efadeploy.yml\u914d\u7f6e\u6587\u4ef6\u3002 PS: \u4e2a\u4eba\u8ba4\u4e3a\u8fd9\u662fgithub action\u6307\u5b9a\u7684\u8def\u5f84\uff0c\u5982\u679c\u9879\u76ee\u91cc\u9762\u6709\u8fd9\u6837\u7684\u8def\u5f84\uff0c\u5219\u4f1a\u5728\u4ee3\u7801\u63d0\u4ea4\u65f6\u6309\u7167\u6b64\u914d\u7f6e\u6587\u4ef6\u6267\u884caction\u3002 \u6211\u4eec\u6765\u7f16\u8f91\u4e0b\u8fd9\u4e2ayml\u914d\u7f6e: name: Deploy PityWeb on: push: branches: - master # \u53ea\u5728master\u4e0apush\u89e6\u53d1\u90e8\u7f72 paths-ignore: # \u4e0b\u5217\u6587\u4ef6\u7684\u53d8\u66f4\u4e0d\u89e6\u53d1\u90e8\u7f72\uff0c\u53ef\u4ee5\u81ea\u884c\u6dfb\u52a0 - README.md - LICENSE jobs: build: runs-on: ubuntu-latest steps: - name: Checkout uses: actions/checkout@master - name: use Node.js 16 uses: actions/setup-node@v1 with: node-version: 16 - name: npm install and build run: | npm install -g cnpm cnpm install npm run build env: CI: true - name: copy file via ssh password uses: appleboy/scp-action@master with: host: ${{ secrets.HOST }} username: ${{ secrets.USERNAME }} password: ${{ secrets.PASSWORD }} source: \"dist/\" target: \"/home/tester/pityWeb/\" - name: restart uses: appleboy/ssh-action@master with: host: ${{ secrets.HOST }} username: ${{ secrets.USERNAME }} password: ${{ secrets.PASSWORD }} script: | cd /home/tester/pityWeb pm2 delete web pm2 start web.sh \u6211\u4eec\u6765\u4e00\u4e2a\u4e2a\u89e3\u91ca\u914d\u7f6e: on on\u91cc\u9762\u914d\u7f6e\u4e86push\uff0c\u4e5f\u5c31\u662f\u63a8\u9001\u5230\u4ed3\u5e93\u7684\u64cd\u4f5c\uff0c\u7136\u540e\u9009\u5b9a\u4e86\u5bf9\u5e94\u7684\u5206\u652f\u548c \u5ffd\u7565\u63d0\u4ea4 \u7684\u6587\u4ef6\u3002 jobs \u987e\u540d\u601d\u4e49\uff0c\u5c31\u662f\u4e00\u4e2a\u4e2a\u7684\u4efb\u52a1\u5566\u3002\u4f60\u5728push\u4e4b\u540e\u60f3\u5b8c\u6210\u4ec0\u4e48\u6837\u7684\u64cd\u4f5c\uff0c\u90fd\u9700\u8981\u914d\u7f6e\u5728jobs\u91cc\u9762\u3002 runs-on \u6307\u7684\u662f\u8fd0\u884c\u5728\u4ec0\u4e48\u57fa\u7840\u955c\u50cf\u91cc\u9762\uff0c\u6bd4\u5982\u6211\u9009\u62e9\u7684\u662fubuntu\u3002\u8fd9\u6837github\u4f1a\u7ed9\u4f60\u63d0\u4f9b\"\u4e00\u53f0\"ubuntu\u673a\u5668\uff0c\u7ed9\u4f60\u5728\u4e0a\u9762\u6267\u884c\u547d\u4ee4\u3002 steps \u63a5\u7740\u5c31\u662f\u5177\u4f53\u7684checkout\u52a8\u4f5c\uff0c\u4e5f\u5c31\u662f\u6211\u4eec\u8bf4\u7684\u5bf9\u5e94\u7684\u7b2c\u4e00\u6b65\uff1a\u62c9\u4ee3\u7801\uff01\u7b2c\u4e8c\u6b65\u5219\u662f\u6307\u5b9a\u5bf9\u5e94\u7684node\u7248\u672c\uff0c\u540e\u9762\u5c31\u662fnpm install\u548cbuild\u64cd\u4f5c\u5566\u3002 \u6ce8\u610f\u8fd9\u4e2auses\u5b57\u6bb5\uff0c\u5b83\u53ef\u4ee5\u6cbf\u7528\u5176\u4ed6\u4eba\u5199\u597d\u7684\u57fa\u7840action\uff0c\u6bd4\u5982\u6211\u8fd9\u91cc\u5c31\u7528\u4e86 appleboy/scp-action@master \u548c appleboy/ssh-action@master \u3002 \u8fd92\u4e2a\u52a8\u4f5c\u662f\u4ec0\u4e48\u610f\u601d\u5462\uff0cscp\u5927\u5bb6\u90fd\u4e86\u89e3\u5427\uff0c\u5176\u5b9e\u5c31\u662f\u6839\u636e\u5b83\u63d0\u4f9b\u7684scp\u529f\u80fd\uff0c\u5e2e\u6211\u4eec\u628abuild\u597d\u7684\u4ee3\u7801\u4f20\u5230\u6211\u4eec\u7684\u5bbf\u4e3b\u673a\u3002 \u540e\u9762\u7684ssh-action\u5219\u662f\u5728\u6211\u4eec\u7684\u5bbf\u4e3b\u673a\u6267\u884c\u90e8\u7f72\u811a\u672c\uff0c\u53ef\u4ee5\u770b\u5230\u6211\u8fd9\u91cc\u975e\u5e38\u6e05\u6670\uff0c\u7528pm2\u5148delete\uff0c\u4e5f\u53ef\u4ee5stop\u6211\u7684web.sh\uff08\u8fd9\u662f\u6211\u670d\u52a1\u5668\u81ea\u5df1\u5199\u7684\u542f\u52a8\u524d\u7aef\u7684\u811a\u672c\uff09\uff0c\u63a5\u7740\u5c31\u542f\u52a8\u811a\u672c\u3002 host: ${{ secrets.HOST }} username: ${{ secrets.USERNAME }} password: ${{ secrets.PASSWORD }} \u8fd9\u91cc\u67093\u4e2a\u914d\u7f6e\uff0c\u6211\u4eec\u5f97\u544a\u8bc9ssh-action\u548cscp\u6211\u4eec\u7684\u76ee\u6807\u673a\u5668\uff0c\u6240\u4ee5\u8981\u53bbgithub\u8fdb\u884c\u914d\u7f6e: \u53ef\u4ee5\u770b\u5230\u8fd9\u91cc\u6709\u4e2aaction\u7684\u914d\u7f6e\uff0c\u6211\u4eec\u628a\u53d8\u91cf\u90fd\u586b\u597d\u5373\u53ef\u3002\u8fd9\u91cc\u53ea\u6709github\u77e5\u9053\uff0c\u5176\u4ed6\u4eba\u90fd\u770b\u4e0d\u5230\u4f60\u7684\u53d8\u91cf\uff0c\u5f53\u9879\u76ee\u8dd1\u7684\u65f6\u5019github\u4f1a\u81ea\u52a8\u66ff\u6362\u53d8\u91cf\uff0c\u548c\u54b1\u4eecpity\u4e5f\u5f88\u50cf\uff0c\u4e0d\u8fc7\u5979\u7528\u7684\u662f ${{}} \u5927\u5bb6\u53ef\u4ee5\u53bbpityWeb\u53c2\u8003\u4e0b\u5bf9\u5e94\u7684\u914d\u7f6e\uff0c\u6211\u4e2a\u4eba\u89c9\u5f97appleboy(gin\u7684\u4f5c\u8005)\u8fd92\u4e2a\u5de5\u5177\u504f\u6162\uff0c\u6211\u4f20\u6587\u4ef6\u5f97\u82b1\u5f88\u957f\u65f6\u95f4\u3002 \u600e\u4e48\u68c0\u6d4b\u81ea\u5df1\u7684\u6d41\u6c34\u7ebf\u6709\u6ca1\u6709\u914d\u7f6e\u5b8c\u6210\u5462\uff1f\u5728github\u63d0\u4ea4\u4ee3\u7801\u4ee5\u540e\uff0c\u6211\u4eec\u8fdb\u5165action\u9875\u9762: \u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u4e2a\u6267\u884c\u65f6\u95f4\u5e76\u4e0d\u77ed\u3002 \u8fd9\u4e2acopy\u6587\u4ef6\u7684\u65f6\u95f4\u82b1\u8d39\u4e86\u592a\u4e45\uff0c\u534a\u5c0f\u65f6\u6709\u4f59\u3002\u6211\u4eec\u5728jobs\u91cc\u9762\u7684\u6bcf\u4e2astep\u90fd\u4f1a\u88ab\u62c6\u5206\u51fa\u6765\uff0c\u6709\u8be6\u7ec6\u7684\u65e5\u5fd7\u5c55\u793a\uff0c\u5982\u679c\u51fa\u9519\u7684\u8bdd\u5927\u5bb6\u53ef\u4ee5\u5bf9\u7167\u8d77\u6765\u6392\u67e5\u3002 \u4eca\u5929\u7684\u5185\u5bb9\u5c31\u4ecb\u7ecd\u5230\u8fd9\u91cc\uff0c\u5e0c\u671b\u5bf9\u5927\u5bb6\u6709\u6240\u5e2e\u52a9~~","title":"115.\u914d\u7f6e\u6d41\u6c34\u7ebf\u81ea\u52a8\u90e8\u7f72\u670d\u52a1"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28115%29%20%E9%85%8D%E7%BD%AE%E6%B5%81%E6%B0%B4%E7%BA%BF%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2%E6%9C%8D%E5%8A%A1/#_1","text":"\u4e0a\u4e00\u8282\u6211\u4eec\u7f16\u5199\u5e76\u6d4b\u8bd5\u4e86\u65b0\u7684oss\uff0c\u8fd9\u4e00\u8282\u6211\u4eec\u6765\u8bb2\u70b9\u4e0d\u4e00\u6837\u7684\uff0c\u5173\u4e8e\u81ea\u52a8\u90e8\u7f72\u7684\u3002\u5728\u6b64\u4e4b\u524d\u6211\u4eec\u5148\u4ecb\u7ecd\u4e0b\u4f7f\u7528\u80cc\u666f\u3002","title":"\u56de\u987e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28115%29%20%E9%85%8D%E7%BD%AE%E6%B5%81%E6%B0%B4%E7%BA%BF%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2%E6%9C%8D%E5%8A%A1/#_2","text":"\u968f\u7740 pity \u8d8a\u6765\u8d8a\u5b8c\u5584\uff0c\u66f4\u65b0\u7684 \u9891\u7387 \u4e5f\u8d8a\u6765\u8d8a\u9ad8\uff0c\u800c\u4f5c\u4e3a\u4e00\u4e2a \u4e2a\u4eba\u9879\u76ee \uff0c\u5e76\u6ca1\u6709\u516c\u53f8\u7684\u4e00\u5957pipeline\u7684\u673a\u5236\u3002\u4e5f\u5c31\u4f1a\u5bfc\u81f4\u4e00\u4e2a\u95ee\u9898: \u6211\u4eec\u66f4\u65b0\u5728\u7ebf\u4f53\u9a8c\u9879\u76ee\u7684\u65f6\u5019\uff0c\u4f1a\u76f8\u5bf9\u7e41\u7410\uff0c\u5927\u6982\u5206\u4e3a\u4e0b\u9762\u51e0\u4e2a\u6b65\u9aa4: \u670d\u52a1\u5668\u66f4\u65b0\u4ee3\u7801 \u5982\u679c\u4f7f\u7528\u7684\u662fgit\u8fd8\u633a\u65b9\u4fbf\u7684\uff0c\u76f4\u63a5pull\u65b0\u7684\u4ee3\u7801\u5373\u53ef\u3002 \u66f4\u65b0\u4f9d\u8d56 \u6709\u65f6\u5019\u6211\u4eec\u4f1a\u65b0\u589e\u4e00\u4e9b\u7b2c\u4e09\u65b9\u7684 \u5305 \uff0c\u670d\u52a1\u5668\u8fd8\u5f97\u8ddf\u7740\u6267\u884c pip install \u7b49\u64cd\u4f5c\u3002 \u6253\u5305 \u8fd9\u91cc\u4e3b\u8981\u9488\u5bf9\u524d\u7aef\u9879\u76ee\uff0c\u5f80\u5f80\u6211\u4eec\u9700\u8981\u5148build\u4e4b\u540e\uff0c\u518d\u90e8\u7f72\u9759\u6001\u8d44\u6e90\u6587\u4ef6\u3002 \u91cd\u542f \u5927\u6982\u6b65\u9aa4\u6709\u8fd9\u4e48\u591a\uff0c\u6709\u65f6\u5019\u670d\u52a1\u5668\u8bbf\u95eegithub\u6709\u95ee\u9898\uff0c\u8fd8\u4f1a\u51fa\u73b0git pull\u4e0d\u4e0b\u6765\u7b49\u60c5\u51b5\uff0c\u603b\u800c\u8a00\u4e4b\uff0c\u5bf9\u4e8e\u624b\u52a8\u90e8\u7f72\u6765\u8bf4\uff0c\u9891\u7387\u4e0d\u9ad8\u7684\u65f6\u5019\u8fd8\u80fd\u5fcd\u53d7\uff0c \u9891\u7387 \u8fc7\u9ad8\uff0c\u8fd8\u5f97\u5206\u522b\u90e8\u7f72\u524d\u540e\u7aef\u7684\u60c5\u51b5\u4e0b\uff0c\u5c31\u5f88\u6d6a\u8d39\u65f6\u95f4\u4e86\uff01 \u90a3\u4e48\uff0c\u6709\u6ca1\u6709\u4e00\u79cd\u9ad8\u6548\u7684\u81ea\u52a8\u90e8\u7f72\u7684\u65b9\u5f0f\u5462\uff1f\u5f53\u6211\u63d0\u4ea4\u4ee3\u7801\u5230\u6307\u5b9a\u5206\u652f\uff0c\u5c31\u81ea\u52a8\u7ed9\u4ffa\u66f4\u65b0\u65b0\u4ee3\u7801\u5230\u670d\u52a1\u5668\u4e86\uff01 \u7b54\u6848\u662f\u6709\u7684\uff0c\u4eca\u5929\u6211\u4eec\u5c31\u6765\u7b80\u5355\u4ecb\u7ecd\u4e0bgithub action.","title":"\u80cc\u666f"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28115%29%20%E9%85%8D%E7%BD%AE%E6%B5%81%E6%B0%B4%E7%BA%BF%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2%E6%9C%8D%E5%8A%A1/#_3","text":"\u5927\u591a\u6570\u516c\u53f8\u90fd\u7528\u4e86gitlab\u4f5c\u4e3a\u4ee3\u7801\u7ba1\u7406\u4ed3\u5e93\uff0c\u6bd4\u5982\u6211\u73b0\u5728\u7684\u516c\u53f8\uff0cgitlab\u91cc\u9762\u914d\u7f6e\u4e86\u5e38\u89c1\u9879\u76ee(nodejs/python/java)\u7684\u81ea\u52a8\u6784\u5efa\u955c\u50cf\u529f\u80fd\uff0c\u4e5f\u5c31\u662f\u8bf4\u6211\u4eec\u63d0\u4ea4\u4ee3\u7801\u4ee5\u540e\uff0c\u65b0\u4ee3\u7801\u5c31\u4f1a\u6253\u5305\u4e3a\u4e00\u4e2adocker image\uff0c\u518d\u4e8e\u53d1\u5e03\u7cfb\u7edf\u6253\u901a\uff0c\u5c31\u53ef\u4ee5\u968f\u4fbf\u53d1\u5e03/\u5207\u6362\u5230\u6307\u5b9a\u7684 \u955c\u50cf \u3002 \u6211\u4eec\u56e0\u4e3a\u662f\u4e2a\u4eba\u9879\u76ee\uff0c\u5c31\u4e0d\u9700\u8981\u505a\u90a3\u4e48 \u590d\u6742 \uff0c\u76f4\u63a5\u7528 Github Action \u5c31\u884c\u4e86\u3002\u4eca\u5929\u6211\u4eec\u5c31\u6765\u8bb2\u4e00\u4e0bpity\u7684\u524d\u7aef\u9879\u76ee\u7528github action\u90e8\u7f72\u7684\u65b9\u6848\u3002 \u5728\u6b64\u4e4b\u524d\u6211\u4eec\u6700\u597d\u68b3\u7406\u4e00\u4e0b\u524d\u7aef\u7684\u53d1\u5e03\u903b\u8f91: npm install \u5b89\u88c5\u4f9d\u8d56 npm run build \u6253\u5305 \u5229\u7528serve\u542f\u52a8\u9759\u6001\u8d44\u6e90\u670d\u52a1 \u4f7f\u7528pm2\u7ba1\u7406serve\u670d\u52a1\u7684\u751f\u547d\u5468\u671f","title":"\u5e38\u89c1\u7684\u90e8\u7f72\u65b9\u5f0f"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28115%29%20%E9%85%8D%E7%BD%AE%E6%B5%81%E6%B0%B4%E7%BA%BF%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2%E6%9C%8D%E5%8A%A1/#deployyml","text":"\u6211\u4eec\u5728\u9879\u76ee \u6839\u76ee\u5f55 \u65b0\u5efa .github \u6587\u4ef6\u5939\uff0c\u63a5\u7740\u8fdb\u5165.github\u6587\u4ef6\u5939\uff0c\u7ee7\u7eed\u65b0\u5efa workflows \u76ee\u5f55\uff0c\u6700\u540e\u5728workflows\u76ee\u5f55\u4e0b\u65b0\u5efadeploy.yml\u914d\u7f6e\u6587\u4ef6\u3002 PS: \u4e2a\u4eba\u8ba4\u4e3a\u8fd9\u662fgithub action\u6307\u5b9a\u7684\u8def\u5f84\uff0c\u5982\u679c\u9879\u76ee\u91cc\u9762\u6709\u8fd9\u6837\u7684\u8def\u5f84\uff0c\u5219\u4f1a\u5728\u4ee3\u7801\u63d0\u4ea4\u65f6\u6309\u7167\u6b64\u914d\u7f6e\u6587\u4ef6\u6267\u884caction\u3002 \u6211\u4eec\u6765\u7f16\u8f91\u4e0b\u8fd9\u4e2ayml\u914d\u7f6e: name: Deploy PityWeb on: push: branches: - master # \u53ea\u5728master\u4e0apush\u89e6\u53d1\u90e8\u7f72 paths-ignore: # \u4e0b\u5217\u6587\u4ef6\u7684\u53d8\u66f4\u4e0d\u89e6\u53d1\u90e8\u7f72\uff0c\u53ef\u4ee5\u81ea\u884c\u6dfb\u52a0 - README.md - LICENSE jobs: build: runs-on: ubuntu-latest steps: - name: Checkout uses: actions/checkout@master - name: use Node.js 16 uses: actions/setup-node@v1 with: node-version: 16 - name: npm install and build run: | npm install -g cnpm cnpm install npm run build env: CI: true - name: copy file via ssh password uses: appleboy/scp-action@master with: host: ${{ secrets.HOST }} username: ${{ secrets.USERNAME }} password: ${{ secrets.PASSWORD }} source: \"dist/\" target: \"/home/tester/pityWeb/\" - name: restart uses: appleboy/ssh-action@master with: host: ${{ secrets.HOST }} username: ${{ secrets.USERNAME }} password: ${{ secrets.PASSWORD }} script: | cd /home/tester/pityWeb pm2 delete web pm2 start web.sh \u6211\u4eec\u6765\u4e00\u4e2a\u4e2a\u89e3\u91ca\u914d\u7f6e: on on\u91cc\u9762\u914d\u7f6e\u4e86push\uff0c\u4e5f\u5c31\u662f\u63a8\u9001\u5230\u4ed3\u5e93\u7684\u64cd\u4f5c\uff0c\u7136\u540e\u9009\u5b9a\u4e86\u5bf9\u5e94\u7684\u5206\u652f\u548c \u5ffd\u7565\u63d0\u4ea4 \u7684\u6587\u4ef6\u3002 jobs \u987e\u540d\u601d\u4e49\uff0c\u5c31\u662f\u4e00\u4e2a\u4e2a\u7684\u4efb\u52a1\u5566\u3002\u4f60\u5728push\u4e4b\u540e\u60f3\u5b8c\u6210\u4ec0\u4e48\u6837\u7684\u64cd\u4f5c\uff0c\u90fd\u9700\u8981\u914d\u7f6e\u5728jobs\u91cc\u9762\u3002 runs-on \u6307\u7684\u662f\u8fd0\u884c\u5728\u4ec0\u4e48\u57fa\u7840\u955c\u50cf\u91cc\u9762\uff0c\u6bd4\u5982\u6211\u9009\u62e9\u7684\u662fubuntu\u3002\u8fd9\u6837github\u4f1a\u7ed9\u4f60\u63d0\u4f9b\"\u4e00\u53f0\"ubuntu\u673a\u5668\uff0c\u7ed9\u4f60\u5728\u4e0a\u9762\u6267\u884c\u547d\u4ee4\u3002 steps \u63a5\u7740\u5c31\u662f\u5177\u4f53\u7684checkout\u52a8\u4f5c\uff0c\u4e5f\u5c31\u662f\u6211\u4eec\u8bf4\u7684\u5bf9\u5e94\u7684\u7b2c\u4e00\u6b65\uff1a\u62c9\u4ee3\u7801\uff01\u7b2c\u4e8c\u6b65\u5219\u662f\u6307\u5b9a\u5bf9\u5e94\u7684node\u7248\u672c\uff0c\u540e\u9762\u5c31\u662fnpm install\u548cbuild\u64cd\u4f5c\u5566\u3002 \u6ce8\u610f\u8fd9\u4e2auses\u5b57\u6bb5\uff0c\u5b83\u53ef\u4ee5\u6cbf\u7528\u5176\u4ed6\u4eba\u5199\u597d\u7684\u57fa\u7840action\uff0c\u6bd4\u5982\u6211\u8fd9\u91cc\u5c31\u7528\u4e86 appleboy/scp-action@master \u548c appleboy/ssh-action@master \u3002 \u8fd92\u4e2a\u52a8\u4f5c\u662f\u4ec0\u4e48\u610f\u601d\u5462\uff0cscp\u5927\u5bb6\u90fd\u4e86\u89e3\u5427\uff0c\u5176\u5b9e\u5c31\u662f\u6839\u636e\u5b83\u63d0\u4f9b\u7684scp\u529f\u80fd\uff0c\u5e2e\u6211\u4eec\u628abuild\u597d\u7684\u4ee3\u7801\u4f20\u5230\u6211\u4eec\u7684\u5bbf\u4e3b\u673a\u3002 \u540e\u9762\u7684ssh-action\u5219\u662f\u5728\u6211\u4eec\u7684\u5bbf\u4e3b\u673a\u6267\u884c\u90e8\u7f72\u811a\u672c\uff0c\u53ef\u4ee5\u770b\u5230\u6211\u8fd9\u91cc\u975e\u5e38\u6e05\u6670\uff0c\u7528pm2\u5148delete\uff0c\u4e5f\u53ef\u4ee5stop\u6211\u7684web.sh\uff08\u8fd9\u662f\u6211\u670d\u52a1\u5668\u81ea\u5df1\u5199\u7684\u542f\u52a8\u524d\u7aef\u7684\u811a\u672c\uff09\uff0c\u63a5\u7740\u5c31\u542f\u52a8\u811a\u672c\u3002 host: ${{ secrets.HOST }} username: ${{ secrets.USERNAME }} password: ${{ secrets.PASSWORD }} \u8fd9\u91cc\u67093\u4e2a\u914d\u7f6e\uff0c\u6211\u4eec\u5f97\u544a\u8bc9ssh-action\u548cscp\u6211\u4eec\u7684\u76ee\u6807\u673a\u5668\uff0c\u6240\u4ee5\u8981\u53bbgithub\u8fdb\u884c\u914d\u7f6e: \u53ef\u4ee5\u770b\u5230\u8fd9\u91cc\u6709\u4e2aaction\u7684\u914d\u7f6e\uff0c\u6211\u4eec\u628a\u53d8\u91cf\u90fd\u586b\u597d\u5373\u53ef\u3002\u8fd9\u91cc\u53ea\u6709github\u77e5\u9053\uff0c\u5176\u4ed6\u4eba\u90fd\u770b\u4e0d\u5230\u4f60\u7684\u53d8\u91cf\uff0c\u5f53\u9879\u76ee\u8dd1\u7684\u65f6\u5019github\u4f1a\u81ea\u52a8\u66ff\u6362\u53d8\u91cf\uff0c\u548c\u54b1\u4eecpity\u4e5f\u5f88\u50cf\uff0c\u4e0d\u8fc7\u5979\u7528\u7684\u662f ${{}} \u5927\u5bb6\u53ef\u4ee5\u53bbpityWeb\u53c2\u8003\u4e0b\u5bf9\u5e94\u7684\u914d\u7f6e\uff0c\u6211\u4e2a\u4eba\u89c9\u5f97appleboy(gin\u7684\u4f5c\u8005)\u8fd92\u4e2a\u5de5\u5177\u504f\u6162\uff0c\u6211\u4f20\u6587\u4ef6\u5f97\u82b1\u5f88\u957f\u65f6\u95f4\u3002 \u600e\u4e48\u68c0\u6d4b\u81ea\u5df1\u7684\u6d41\u6c34\u7ebf\u6709\u6ca1\u6709\u914d\u7f6e\u5b8c\u6210\u5462\uff1f\u5728github\u63d0\u4ea4\u4ee3\u7801\u4ee5\u540e\uff0c\u6211\u4eec\u8fdb\u5165action\u9875\u9762: \u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u4e2a\u6267\u884c\u65f6\u95f4\u5e76\u4e0d\u77ed\u3002 \u8fd9\u4e2acopy\u6587\u4ef6\u7684\u65f6\u95f4\u82b1\u8d39\u4e86\u592a\u4e45\uff0c\u534a\u5c0f\u65f6\u6709\u4f59\u3002\u6211\u4eec\u5728jobs\u91cc\u9762\u7684\u6bcf\u4e2astep\u90fd\u4f1a\u88ab\u62c6\u5206\u51fa\u6765\uff0c\u6709\u8be6\u7ec6\u7684\u65e5\u5fd7\u5c55\u793a\uff0c\u5982\u679c\u51fa\u9519\u7684\u8bdd\u5927\u5bb6\u53ef\u4ee5\u5bf9\u7167\u8d77\u6765\u6392\u67e5\u3002 \u4eca\u5929\u7684\u5185\u5bb9\u5c31\u4ecb\u7ecd\u5230\u8fd9\u91cc\uff0c\u5e0c\u671b\u5bf9\u5927\u5bb6\u6709\u6240\u5e2e\u52a9~~","title":"\u65b0\u5efadeploy.yml"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28116%29%20%E8%AE%BE%E8%AE%A1%E5%9C%B0%E5%9D%80%E7%AE%A1%E7%90%86%E5%8A%9F%E8%83%BD/","text":"\u4e00\u8d77\u517b\u6210\u5199\u4f5c\u4e60\u60ef\uff01\u8fd9\u662f\u6211\u53c2\u4e0e\u300c\u6398\u91d1\u65e5\u65b0\u8ba1\u5212 \u00b7 4 \u6708\u66f4\u6587\u6311\u6218\u300d\u7684\u7b2c4\u5929\uff0c \u70b9\u51fb\u67e5\u770b\u6d3b\u52a8\u8be6\u60c5 \u3002 \u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u4e00\u8d77\u4ea4\u6d41\u5b66\u4e60! \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u8bb2\u4e86\u5982\u4f55\u7528 Github Action \u5e2e\u52a9\u6211\u4eec\u90e8\u7f72\u81ea\u5df1\u7684\u9879\u76ee\uff0c\u8fd9\u4e00\u8282\u6211\u4eec\u6765\u6539\u5584\u4e00\u4e0b\u6211\u4eec\u73b0\u6709\u7684\u8bf7\u6c42\u65b9\u5f0f\u3002\u5148\u6765\u770b\u770b\u5f53\u524d\u9879\u76ee\u7684\u4f7f\u7528\u60c5\u51b5: \u5728\u8bf7\u6c42\u5730\u5740\u680f\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u8fb9\u8f93\u5165\u7684 \u4ecd\u7136 \u662f\u4e00\u4e2a\u5b8c\u6574\u7684\u5730\u5740\uff0c\u8fd9\u6837\u4f1a\u663e\u5f97\u6211\u4eec\u5f88\u5446\uff0c\u6211\u4eec\u6765\u601d\u8003\u4e0b\u8fd9\u91cc\u7684\u4f18\u5316\u70b9: \u5f88\u591a\u516c\u53f8\u7684\u4e0d\u540c\u4e1a\u52a1\u6a21\u5757\u7684\u5730\u5740\u524d\u7f00\u90fd\u662f\u56fa\u5b9a\u7684\uff0c\u6bd4\u5982https://api.xxx.com\uff0c\u4ea6\u6216\u8005\u662fhttps://xxx.com/user\u3002\u5982\u679c\u6211\u4eec\u6bcf\u6b21\u90fd\u7528 \u5168\u5c40\u53d8\u91cf \u53bb\u505a\u8fd9\u4e2a\u4e8b\u60c5\uff0c\u4f1a\u8868\u73b0\u5f97\u5f88\u7e41\u7410\u3002\u5982\u679c\u7ed9\u4f60\u4e00\u4e9b\u5730\u5740\u7684\u9009\u9879: \u5927\u540e\u53f0\u7cfb\u7edf \u3001 xxx\u670d\u52a1 \u8fd9\u79cd\u66f4\u76f4\u89c2\u7684\u65b9\u5f0f\uff0c\u5e76\u4e14\u80fd\u591f\u66f4\u663e\u773c\u5730\u770b\u5230\u5bf9\u5e94\u7684url\uff0c\u90a3\u6837\u4f7f\u7528\u8d77\u6765\u4f53\u9a8c\u66f4\u4f73\u3002\u9488\u5bf9\u5168\u5c40\u53d8\u91cf\uff0c\u6211\u4eec\u5bf9\u4e8e\u591a\u4e2a\u73af\u5883\u7684\u5904\u7406\u867d\u7136\u4e5f\u652f\u6301\uff0c\u4f46\u662f\u5e76\u4e0d\u7279\u522b\u53cb\u597d\u3002 \u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5c1d\u8bd5\u628a\u73af\u5883\u5730\u5740\u8fd9\u4e9b\u6570\u636e\u4eceurl\u4e2d\u5265\u79bb\u51fa\u6765\uff0c\u8ba9url = \u7f51\u5173 + \u8def\u7531 \uff0c\u4f7f\u5f97\u4e00\u4e2ahttp\u7684\u8bf7\u6c42\u5730\u5740\u66f4\u6613\u7406\u89e3\u3002 \u7f16\u5199app/models/address.py \"\"\" Python\u8bf7\u6c42\u7f51\u5173\u5730\u5740\u8868 \"\"\" from sqlalchemy import Column , INT , String , UniqueConstraint from app.models.basic import PityBase class PityGateway ( PityBase ): __tablename__ = 'pity_gateway' __table_args__ = ( UniqueConstraint ( 'env' , 'name' , 'deleted_at' ), ) env = Column ( INT , comment = '\u5bf9\u5e94\u73af\u5883' ) name = Column ( String ( 32 ), comment = \"\u7f51\u5173\u540d\u79f0\" ) gateway = Column ( String ( 128 ), comment = \"\u7f51\u5173\u5730\u5740\" ) __fields__ = ( name , env , gateway ) __tag__ = \"\u7f51\u5173\" __alias__ = dict ( name = \"\u7f51\u5173\u540d\u79f0\" , env = \"\u73af\u5883\" , gateway = \"\u7f51\u5173\u5730\u5740\" ) __show__ = 3 def __init__ ( self , env , name , gateway , user , id = None ): super () . __init__ ( user , id ) self . name = name self . env = env self . gateway = gateway \u6211\u4eec\u7684\u8868\u6570\u636e\u5f88\u7b80\u5355\uff0c\u57fa\u672c\u5c31\u662f\u4ee5\u4e0b3\u4e2a\u91cd\u70b9: \u5bf9\u5e94\u73af\u5883 \u540d\u79f0 \u5bf9\u5e94\u7684url\u524d\u7f00\u5730\u5740\uff0c\u4e5f\u53ef\u4ee5\u53ebgateway \u7f16\u5199app/crud/config/AddressDao.py from app.crud import Mapper from app.models.address import PityGateway from app.utils.decorator import dao from app.utils.logger import Log @dao ( PityGateway , Log ( \"PityRedisConfigDao\" )) class PityGatewayDao ( Mapper ): pass \u6709\u4e86\u6211\u4eec\u7f16\u5199\u597d\u7684\u57fa\u7840Mapper\uff0c\u5199\u4e00\u4e2acrud\u63a5\u53e3\u5c31\u5f88\u7b80\u5355\u4e86\u3002 \u7f16\u5199app/routers/config/address.py from fastapi import Depends from app.crud.config.AddressDao import PityGatewayDao from app.handler.fatcory import PityResponse from app.models.address import PityGateway from app.routers import Permission , get_session from app.routers.config.environment import router from app.schema.address import PityAddressForm from config import Config @router . get ( \"/gateway/list\" , summary = \"\u67e5\u8be2\u7f51\u5173\u5730\u5740\" ) async def list_gateway ( name : str = '' , gateway : str = '' , env : int = None , user_info = Depends ( Permission ( Config . MEMBER ))): data = await PityGatewayDao . list_record ( env = env , gateway = f \"% { gateway } %\" , name = f \"% { name } %\" ) return PityResponse . success ( PityResponse . model_to_list ( data )) @router . post ( \"/gateway/insert\" , summary = \"\u6dfb\u52a0\u7f51\u5173\u5730\u5740\" , description = \"\u6dfb\u52a0\u7f51\u5173\u5730\u5740\uff0c\u53ea\u6709\u7ec4\u957f\u53ef\u4ee5\u64cd\u4f5c\" ) async def insert_gateway ( form : PityAddressForm , user_info = Depends ( Permission ( Config . MANAGER ))): model = PityGateway ( ** form . dict (), user = user_info [ 'id' ]) model = await PityGatewayDao . insert_record ( model , True ) return PityResponse . success ( model ) @router . post ( \"/gateway/update\" , summary = \"\u7f16\u8f91\u7f51\u5173\u5730\u5740\" , description = \"\u7f16\u8f91\u7f51\u5173\u5730\u5740\uff0c\u53ea\u6709\u7ec4\u957f\u53ef\u4ee5\u64cd\u4f5c\" ) async def insert_gateway ( form : PityAddressForm , user_info = Depends ( Permission ( Config . MANAGER ))): model = await PityGatewayDao . update_record_by_id ( user_info [ 'id' ], form , True , log = True ) return PityResponse . success ( model ) @router . get ( \"/gateway/delete\" , summary = \"\u5220\u9664\u7f51\u5173\u5730\u5740\" , description = \"\u6839\u636eid\u5220\u9664\u7f51\u5173\u5730\u5740\uff0c\u53ea\u6709\u7ec4\u957f\u53ef\u4ee5\u64cd\u4f5c\" ) async def delete_gateway ( id : int , user_info = Depends ( Permission ( Config . MANAGER )), session = Depends ( get_session )): await PityGatewayDao . delete_record_by_id ( session , user_info [ 'id' ], id ) return PityResponse . success () \u53ef\u4ee5\u770b\u5230router\u91cc\u9762\u7684\u5185\u5bb9\u5341\u5206\u7b80\u5355\uff0c\u57fa\u672c\u4e0a\u8c03\u7528\u4e00\u4e0bcurd\u91cc\u9762\u7684\u65b9\u6cd5\u5373\u53ef\u3002\u8fd9\u91cc\u91cd\u70b9\u8bb2\u4e00\u4e0b\u67e5\u8be2\u90a3\u91cc: \u67e5\u8be2\u63a5\u53e3\u7684\u8bdd\uff0c\u6211\u4eec\u7684name/gateway\u90fd\u9700\u8981\u652f\u6301\u6a21\u7cca\u67e5\u627e\uff0c\u867d\u7136\u6211\u4eec\u77e5\u9053 \u524d\u540e\u5339\u914d \u7684\u6548\u7387\u5f88\u4f4e\uff0c\u4e0d\u4f1a\u7528\u5230\u7d22\u5f15\u53bb\u67e5\u627e\u5bf9\u5e94\u7684\u6570\u636e\uff0c\u4f46\u8003\u8651\u5230\u5730\u5740\u6570\u636e\u4e0d\u4f1a\u7279\u522b\u591a\uff0c\u6240\u4ee5\u6211\u4eec\u91c7\u7528\u66f4\u53cb\u597d\u7684\u67e5\u8be2\u65b9\u5f0f\u3002 \u8fd9\u91cc\u7ed9gateway\u548cname\u52a0\u4e0a%%\uff0c\u5728\u8c03\u7528list_record\u63a5\u53e3\u65f6\uff0c\u4f1a\u81ea\u52a8\u88ab \u67e5\u8be2\u6761\u4ef6 \u8bc6\u522b\u4e3alike\uff0c\u5982\u679c\u4e3a\u7a7a\u5219\u4e0d\u4f1a\u7ed9\u51fa\u4efb\u4f55\u67e5\u8be2\u6761\u4ef6\uff08\u5373\u67e5\u8be2\u6240\u6709\u6570\u636e\uff09\u3002 \u7f16\u5199\u524d\u7aef\u9875\u9762 \u57fa\u672c\u4e0a\u5199\u5230\u8fd9\u4e2a\u6837\u5b50\u5c31\u5dee\u4e0d\u591a\u5566\uff0c\u5177\u4f53\u7684\u4ee3\u7801\u8fd8\u662f\u8001\u6837\u5b50: service model pages \u6211\u4eec\u5148\u653e\u4e0a\u7ec4\u4ef6\u7684\u4ee3\u7801\uff0c\u5177\u4f53\u7684\u4ee3\u7801\u53ef\u4ee5\u53bb github \u67e5\u770b\u3002 import React, {memo, useEffect, useState} from 'react'; import {PageContainer} from \"@ant-design/pro-layout\"; import {connect} from \"umi\"; import {Button, Card, Col, Divider, Form, Input, Row, Select, Table} from \"antd\"; import {CONFIG} from \"@/consts/config\"; import TooltipTextIcon from \"@/components/Icon/TooltipTextIcon\"; import {PlusOutlined} from \"@ant-design/icons\"; import FormForModal from \"@/components/PityForm/FormForModal\"; import PityPopConfirm from \"@/components/Confirm/PityPopConfirm\"; const {Option} = Select; const Address = ({loading, gconfig, dispatch}) => { const [form] = Form.useForm(); const {envList, envMap, addressList} = gconfig; const [modal, setModal] = useState(false); const [item, setItem] = useState({}); const fetchEnvList = () => { dispatch({ type: 'gconfig/fetchEnvList', payload: { page: 1, size: 1000, exactly: true } }) } const fetchAddress = () => { const values = form.getFieldsValue() console.log(values) dispatch({ type: 'gconfig/fetchAddress', payload: values, }) } const isLoading = loading.effects['gconfig/fetchAddress'] || loading.effects['gconfig/fetchEnvList'] || loading.effects['gconfig/updateAddress'] || loading.effects['gconfig/insertAddress'] || loading.effects['gconfig/deleteAddress'] useEffect(() => { fetchEnvList() fetchAddress() }, []); const columns = [ { title: '\u73af\u5883', key: 'env', dataIndex: 'env', render: env => envMap[env], }, { title: '\u540d\u79f0', key: 'name', dataIndex: 'name', }, { title: <TooltipTextIcon title=\"\u5730\u5740\u4e00\u822c\u662f\u670d\u52a1\u7684\u57fa\u7840\u5730\u5740\uff0c\u6bd4\u5982https://api.baidu.com, \u7528\u4f8b\u4e2d\u7684\u5730\u5740\u7b80\u5199\u5373\u53ef\" text=\"\u5730\u5740\"/>, key: 'gateway', dataIndex: 'gateway', render: text => <a href={text}>{text}</a>, ellipsis: true }, { title: '\u64cd\u4f5c', key: 'operation', render: (_, record) => <> <a onClick={() => { setItem(record) setModal(true) }}>\u7f16\u8f91</a> <Divider type=\"vertical\"/> <PityPopConfirm text=\"\u5220\u9664\" title=\"\u4f60\u786e\u5b9a\u8981\u5220\u9664\u8fd9\u4e2a\u5730\u5740\u5417?\" onConfirm={async () => { await onDelete(record) }}/> </> } ] const fields = [ { name: 'env', label: '\u73af\u5883', required: true, message: '\u8bf7\u9009\u62e9\u5bf9\u5e94\u73af\u5883', type: 'select', component: <Select placeholder=\"\u8bf7\u9009\u62e9\u5bf9\u5e94\u73af\u5883\"> {envList.map(v => <Option key={v.id} value={v.id}>{v.name}</Option>)} </Select>, }, { name: 'name', label: '\u5730\u5740\u540d\u79f0', required: true, message: '\u8bf7\u8f93\u5165\u5730\u5740\u540d\u79f0', type: 'input', placeholder: '\u8bf7\u8f93\u5165\u5730\u5740\u540d\u79f0', }, { name: 'gateway', label: '\u670d\u52a1\u540d', required: true, message: '\u8bf7\u8f93\u5165\u670d\u52a1\u5730\u5740', type: 'input', placeholder: '\u8bf7\u8f93\u5165\u670d\u52a1\u5730\u5740', } ]; // \u5220\u9664\u5730\u5740 const onDelete = async record => { const ans = await dispatch({ type: 'gconfig/deleteAddress', payload: { id: record.id, } }) if (ans) { fetchAddress() } } // \u65b0\u589e/\u4fee\u6539\u5730\u5740 const onSubmit = async values => { let ans; if (item.id) { ans = await dispatch({ type: 'gconfig/updateAddress', payload: { ...values, id: item.id, } }) } else { ans = await dispatch({ type: 'gconfig/insertAddress', payload: values }) } if (ans) { setModal(false) fetchAddress() } } return ( <PageContainer breadcrumb={null} title=\"\u8bf7\u6c42\u5730\u5740\u7ba1\u7406\"> <Card> <FormForModal visible={modal} fields={fields} title='\u6dfb\u52a0\u5730\u5740' left={6} right={18} record={item} onFinish={onSubmit} onCancel={() => setModal(false)}/> <Form form={form} {...CONFIG.LAYOUT} onValuesChange={fetchAddress}> <Row gutter={12}> <Col span={3}> <Form.Item> <Button type=\"primary\" onClick={() => setModal(true)}><PlusOutlined/>\u6dfb\u52a0\u5730\u5740</Button> </Form.Item> </Col> <Col span={7}> <Form.Item label=\"\u73af\u5883\" name=\"env\"> <Select allowClear showSearch placeholder=\"\u9009\u62e9\u5bf9\u5e94\u7684\u73af\u5883\"> {envList.map(item => <Option value={item.id} key={item.id}>{item.name}</Option>)} </Select> </Form.Item> </Col> <Col span={7}> <Form.Item label=\"\u540d\u79f0\" name=\"name\"> <Input placeholder=\"\u8f93\u5165\u5bf9\u5e94\u7684\u5730\u5740\u540d\u79f0\"/> </Form.Item> </Col> <Col span={7}> <Form.Item label=\"\u5730\u5740\" name=\"gateway\"> <Input placeholder=\"\u8f93\u5165\u5bf9\u5e94\u7684\u5730\u5740\"/> </Form.Item> </Col> </Row> </Form> <Table columns={columns} loading={isLoading} rowKey={record => record.id} dataSource={addressList}/> </Card> </PageContainer> ) } export default connect(({gconfig, user, loading}) => ({gconfig, user, loading}))(memo(Address)); \u5f53\u67e5\u8be2\u8868\u5355\u7684\u6570\u636e\u53d8\u5316\u65f6\uff0c\u6211\u4eec\u4f1a\u81ea\u52a8\u91cd\u65b0\u83b7\u53d6 \u67e5\u8be2\u63a5\u53e3 \u3002\u90a3\u4e48\u5173\u4e8e\u5177\u4f53\u7684\u4f7f\u7528\u7ec6\u8282\uff0c\u6211\u4eec\u5c06\u5728\u4e0b\u4e00\u7ae0\u6765\u5b8c\u5584\uff0c\u656c\u8bf7\u671f\u5f85~ \u6700\u65b0\u4f53\u9a8c\u5730\u5740: https://pity.fun","title":"116.\u8bbe\u8ba1\u5730\u5740\u7ba1\u7406\u529f\u80fd"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28116%29%20%E8%AE%BE%E8%AE%A1%E5%9C%B0%E5%9D%80%E7%AE%A1%E7%90%86%E5%8A%9F%E8%83%BD/#_1","text":"\u4e0a\u4e00\u8282\u6211\u4eec\u8bb2\u4e86\u5982\u4f55\u7528 Github Action \u5e2e\u52a9\u6211\u4eec\u90e8\u7f72\u81ea\u5df1\u7684\u9879\u76ee\uff0c\u8fd9\u4e00\u8282\u6211\u4eec\u6765\u6539\u5584\u4e00\u4e0b\u6211\u4eec\u73b0\u6709\u7684\u8bf7\u6c42\u65b9\u5f0f\u3002\u5148\u6765\u770b\u770b\u5f53\u524d\u9879\u76ee\u7684\u4f7f\u7528\u60c5\u51b5: \u5728\u8bf7\u6c42\u5730\u5740\u680f\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u8fb9\u8f93\u5165\u7684 \u4ecd\u7136 \u662f\u4e00\u4e2a\u5b8c\u6574\u7684\u5730\u5740\uff0c\u8fd9\u6837\u4f1a\u663e\u5f97\u6211\u4eec\u5f88\u5446\uff0c\u6211\u4eec\u6765\u601d\u8003\u4e0b\u8fd9\u91cc\u7684\u4f18\u5316\u70b9: \u5f88\u591a\u516c\u53f8\u7684\u4e0d\u540c\u4e1a\u52a1\u6a21\u5757\u7684\u5730\u5740\u524d\u7f00\u90fd\u662f\u56fa\u5b9a\u7684\uff0c\u6bd4\u5982https://api.xxx.com\uff0c\u4ea6\u6216\u8005\u662fhttps://xxx.com/user\u3002\u5982\u679c\u6211\u4eec\u6bcf\u6b21\u90fd\u7528 \u5168\u5c40\u53d8\u91cf \u53bb\u505a\u8fd9\u4e2a\u4e8b\u60c5\uff0c\u4f1a\u8868\u73b0\u5f97\u5f88\u7e41\u7410\u3002\u5982\u679c\u7ed9\u4f60\u4e00\u4e9b\u5730\u5740\u7684\u9009\u9879: \u5927\u540e\u53f0\u7cfb\u7edf \u3001 xxx\u670d\u52a1 \u8fd9\u79cd\u66f4\u76f4\u89c2\u7684\u65b9\u5f0f\uff0c\u5e76\u4e14\u80fd\u591f\u66f4\u663e\u773c\u5730\u770b\u5230\u5bf9\u5e94\u7684url\uff0c\u90a3\u6837\u4f7f\u7528\u8d77\u6765\u4f53\u9a8c\u66f4\u4f73\u3002\u9488\u5bf9\u5168\u5c40\u53d8\u91cf\uff0c\u6211\u4eec\u5bf9\u4e8e\u591a\u4e2a\u73af\u5883\u7684\u5904\u7406\u867d\u7136\u4e5f\u652f\u6301\uff0c\u4f46\u662f\u5e76\u4e0d\u7279\u522b\u53cb\u597d\u3002 \u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5c1d\u8bd5\u628a\u73af\u5883\u5730\u5740\u8fd9\u4e9b\u6570\u636e\u4eceurl\u4e2d\u5265\u79bb\u51fa\u6765\uff0c\u8ba9url = \u7f51\u5173 + \u8def\u7531 \uff0c\u4f7f\u5f97\u4e00\u4e2ahttp\u7684\u8bf7\u6c42\u5730\u5740\u66f4\u6613\u7406\u89e3\u3002","title":"\u56de\u987e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28116%29%20%E8%AE%BE%E8%AE%A1%E5%9C%B0%E5%9D%80%E7%AE%A1%E7%90%86%E5%8A%9F%E8%83%BD/#appmodelsaddresspy","text":"\"\"\" Python\u8bf7\u6c42\u7f51\u5173\u5730\u5740\u8868 \"\"\" from sqlalchemy import Column , INT , String , UniqueConstraint from app.models.basic import PityBase class PityGateway ( PityBase ): __tablename__ = 'pity_gateway' __table_args__ = ( UniqueConstraint ( 'env' , 'name' , 'deleted_at' ), ) env = Column ( INT , comment = '\u5bf9\u5e94\u73af\u5883' ) name = Column ( String ( 32 ), comment = \"\u7f51\u5173\u540d\u79f0\" ) gateway = Column ( String ( 128 ), comment = \"\u7f51\u5173\u5730\u5740\" ) __fields__ = ( name , env , gateway ) __tag__ = \"\u7f51\u5173\" __alias__ = dict ( name = \"\u7f51\u5173\u540d\u79f0\" , env = \"\u73af\u5883\" , gateway = \"\u7f51\u5173\u5730\u5740\" ) __show__ = 3 def __init__ ( self , env , name , gateway , user , id = None ): super () . __init__ ( user , id ) self . name = name self . env = env self . gateway = gateway \u6211\u4eec\u7684\u8868\u6570\u636e\u5f88\u7b80\u5355\uff0c\u57fa\u672c\u5c31\u662f\u4ee5\u4e0b3\u4e2a\u91cd\u70b9: \u5bf9\u5e94\u73af\u5883 \u540d\u79f0 \u5bf9\u5e94\u7684url\u524d\u7f00\u5730\u5740\uff0c\u4e5f\u53ef\u4ee5\u53ebgateway","title":"\u7f16\u5199app/models/address.py"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28116%29%20%E8%AE%BE%E8%AE%A1%E5%9C%B0%E5%9D%80%E7%AE%A1%E7%90%86%E5%8A%9F%E8%83%BD/#appcrudconfigaddressdaopy","text":"from app.crud import Mapper from app.models.address import PityGateway from app.utils.decorator import dao from app.utils.logger import Log @dao ( PityGateway , Log ( \"PityRedisConfigDao\" )) class PityGatewayDao ( Mapper ): pass \u6709\u4e86\u6211\u4eec\u7f16\u5199\u597d\u7684\u57fa\u7840Mapper\uff0c\u5199\u4e00\u4e2acrud\u63a5\u53e3\u5c31\u5f88\u7b80\u5355\u4e86\u3002","title":"\u7f16\u5199app/crud/config/AddressDao.py"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28116%29%20%E8%AE%BE%E8%AE%A1%E5%9C%B0%E5%9D%80%E7%AE%A1%E7%90%86%E5%8A%9F%E8%83%BD/#approutersconfigaddresspy","text":"from fastapi import Depends from app.crud.config.AddressDao import PityGatewayDao from app.handler.fatcory import PityResponse from app.models.address import PityGateway from app.routers import Permission , get_session from app.routers.config.environment import router from app.schema.address import PityAddressForm from config import Config @router . get ( \"/gateway/list\" , summary = \"\u67e5\u8be2\u7f51\u5173\u5730\u5740\" ) async def list_gateway ( name : str = '' , gateway : str = '' , env : int = None , user_info = Depends ( Permission ( Config . MEMBER ))): data = await PityGatewayDao . list_record ( env = env , gateway = f \"% { gateway } %\" , name = f \"% { name } %\" ) return PityResponse . success ( PityResponse . model_to_list ( data )) @router . post ( \"/gateway/insert\" , summary = \"\u6dfb\u52a0\u7f51\u5173\u5730\u5740\" , description = \"\u6dfb\u52a0\u7f51\u5173\u5730\u5740\uff0c\u53ea\u6709\u7ec4\u957f\u53ef\u4ee5\u64cd\u4f5c\" ) async def insert_gateway ( form : PityAddressForm , user_info = Depends ( Permission ( Config . MANAGER ))): model = PityGateway ( ** form . dict (), user = user_info [ 'id' ]) model = await PityGatewayDao . insert_record ( model , True ) return PityResponse . success ( model ) @router . post ( \"/gateway/update\" , summary = \"\u7f16\u8f91\u7f51\u5173\u5730\u5740\" , description = \"\u7f16\u8f91\u7f51\u5173\u5730\u5740\uff0c\u53ea\u6709\u7ec4\u957f\u53ef\u4ee5\u64cd\u4f5c\" ) async def insert_gateway ( form : PityAddressForm , user_info = Depends ( Permission ( Config . MANAGER ))): model = await PityGatewayDao . update_record_by_id ( user_info [ 'id' ], form , True , log = True ) return PityResponse . success ( model ) @router . get ( \"/gateway/delete\" , summary = \"\u5220\u9664\u7f51\u5173\u5730\u5740\" , description = \"\u6839\u636eid\u5220\u9664\u7f51\u5173\u5730\u5740\uff0c\u53ea\u6709\u7ec4\u957f\u53ef\u4ee5\u64cd\u4f5c\" ) async def delete_gateway ( id : int , user_info = Depends ( Permission ( Config . MANAGER )), session = Depends ( get_session )): await PityGatewayDao . delete_record_by_id ( session , user_info [ 'id' ], id ) return PityResponse . success () \u53ef\u4ee5\u770b\u5230router\u91cc\u9762\u7684\u5185\u5bb9\u5341\u5206\u7b80\u5355\uff0c\u57fa\u672c\u4e0a\u8c03\u7528\u4e00\u4e0bcurd\u91cc\u9762\u7684\u65b9\u6cd5\u5373\u53ef\u3002\u8fd9\u91cc\u91cd\u70b9\u8bb2\u4e00\u4e0b\u67e5\u8be2\u90a3\u91cc: \u67e5\u8be2\u63a5\u53e3\u7684\u8bdd\uff0c\u6211\u4eec\u7684name/gateway\u90fd\u9700\u8981\u652f\u6301\u6a21\u7cca\u67e5\u627e\uff0c\u867d\u7136\u6211\u4eec\u77e5\u9053 \u524d\u540e\u5339\u914d \u7684\u6548\u7387\u5f88\u4f4e\uff0c\u4e0d\u4f1a\u7528\u5230\u7d22\u5f15\u53bb\u67e5\u627e\u5bf9\u5e94\u7684\u6570\u636e\uff0c\u4f46\u8003\u8651\u5230\u5730\u5740\u6570\u636e\u4e0d\u4f1a\u7279\u522b\u591a\uff0c\u6240\u4ee5\u6211\u4eec\u91c7\u7528\u66f4\u53cb\u597d\u7684\u67e5\u8be2\u65b9\u5f0f\u3002 \u8fd9\u91cc\u7ed9gateway\u548cname\u52a0\u4e0a%%\uff0c\u5728\u8c03\u7528list_record\u63a5\u53e3\u65f6\uff0c\u4f1a\u81ea\u52a8\u88ab \u67e5\u8be2\u6761\u4ef6 \u8bc6\u522b\u4e3alike\uff0c\u5982\u679c\u4e3a\u7a7a\u5219\u4e0d\u4f1a\u7ed9\u51fa\u4efb\u4f55\u67e5\u8be2\u6761\u4ef6\uff08\u5373\u67e5\u8be2\u6240\u6709\u6570\u636e\uff09\u3002","title":"\u7f16\u5199app/routers/config/address.py"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28116%29%20%E8%AE%BE%E8%AE%A1%E5%9C%B0%E5%9D%80%E7%AE%A1%E7%90%86%E5%8A%9F%E8%83%BD/#_2","text":"\u57fa\u672c\u4e0a\u5199\u5230\u8fd9\u4e2a\u6837\u5b50\u5c31\u5dee\u4e0d\u591a\u5566\uff0c\u5177\u4f53\u7684\u4ee3\u7801\u8fd8\u662f\u8001\u6837\u5b50: service model pages \u6211\u4eec\u5148\u653e\u4e0a\u7ec4\u4ef6\u7684\u4ee3\u7801\uff0c\u5177\u4f53\u7684\u4ee3\u7801\u53ef\u4ee5\u53bb github \u67e5\u770b\u3002 import React, {memo, useEffect, useState} from 'react'; import {PageContainer} from \"@ant-design/pro-layout\"; import {connect} from \"umi\"; import {Button, Card, Col, Divider, Form, Input, Row, Select, Table} from \"antd\"; import {CONFIG} from \"@/consts/config\"; import TooltipTextIcon from \"@/components/Icon/TooltipTextIcon\"; import {PlusOutlined} from \"@ant-design/icons\"; import FormForModal from \"@/components/PityForm/FormForModal\"; import PityPopConfirm from \"@/components/Confirm/PityPopConfirm\"; const {Option} = Select; const Address = ({loading, gconfig, dispatch}) => { const [form] = Form.useForm(); const {envList, envMap, addressList} = gconfig; const [modal, setModal] = useState(false); const [item, setItem] = useState({}); const fetchEnvList = () => { dispatch({ type: 'gconfig/fetchEnvList', payload: { page: 1, size: 1000, exactly: true } }) } const fetchAddress = () => { const values = form.getFieldsValue() console.log(values) dispatch({ type: 'gconfig/fetchAddress', payload: values, }) } const isLoading = loading.effects['gconfig/fetchAddress'] || loading.effects['gconfig/fetchEnvList'] || loading.effects['gconfig/updateAddress'] || loading.effects['gconfig/insertAddress'] || loading.effects['gconfig/deleteAddress'] useEffect(() => { fetchEnvList() fetchAddress() }, []); const columns = [ { title: '\u73af\u5883', key: 'env', dataIndex: 'env', render: env => envMap[env], }, { title: '\u540d\u79f0', key: 'name', dataIndex: 'name', }, { title: <TooltipTextIcon title=\"\u5730\u5740\u4e00\u822c\u662f\u670d\u52a1\u7684\u57fa\u7840\u5730\u5740\uff0c\u6bd4\u5982https://api.baidu.com, \u7528\u4f8b\u4e2d\u7684\u5730\u5740\u7b80\u5199\u5373\u53ef\" text=\"\u5730\u5740\"/>, key: 'gateway', dataIndex: 'gateway', render: text => <a href={text}>{text}</a>, ellipsis: true }, { title: '\u64cd\u4f5c', key: 'operation', render: (_, record) => <> <a onClick={() => { setItem(record) setModal(true) }}>\u7f16\u8f91</a> <Divider type=\"vertical\"/> <PityPopConfirm text=\"\u5220\u9664\" title=\"\u4f60\u786e\u5b9a\u8981\u5220\u9664\u8fd9\u4e2a\u5730\u5740\u5417?\" onConfirm={async () => { await onDelete(record) }}/> </> } ] const fields = [ { name: 'env', label: '\u73af\u5883', required: true, message: '\u8bf7\u9009\u62e9\u5bf9\u5e94\u73af\u5883', type: 'select', component: <Select placeholder=\"\u8bf7\u9009\u62e9\u5bf9\u5e94\u73af\u5883\"> {envList.map(v => <Option key={v.id} value={v.id}>{v.name}</Option>)} </Select>, }, { name: 'name', label: '\u5730\u5740\u540d\u79f0', required: true, message: '\u8bf7\u8f93\u5165\u5730\u5740\u540d\u79f0', type: 'input', placeholder: '\u8bf7\u8f93\u5165\u5730\u5740\u540d\u79f0', }, { name: 'gateway', label: '\u670d\u52a1\u540d', required: true, message: '\u8bf7\u8f93\u5165\u670d\u52a1\u5730\u5740', type: 'input', placeholder: '\u8bf7\u8f93\u5165\u670d\u52a1\u5730\u5740', } ]; // \u5220\u9664\u5730\u5740 const onDelete = async record => { const ans = await dispatch({ type: 'gconfig/deleteAddress', payload: { id: record.id, } }) if (ans) { fetchAddress() } } // \u65b0\u589e/\u4fee\u6539\u5730\u5740 const onSubmit = async values => { let ans; if (item.id) { ans = await dispatch({ type: 'gconfig/updateAddress', payload: { ...values, id: item.id, } }) } else { ans = await dispatch({ type: 'gconfig/insertAddress', payload: values }) } if (ans) { setModal(false) fetchAddress() } } return ( <PageContainer breadcrumb={null} title=\"\u8bf7\u6c42\u5730\u5740\u7ba1\u7406\"> <Card> <FormForModal visible={modal} fields={fields} title='\u6dfb\u52a0\u5730\u5740' left={6} right={18} record={item} onFinish={onSubmit} onCancel={() => setModal(false)}/> <Form form={form} {...CONFIG.LAYOUT} onValuesChange={fetchAddress}> <Row gutter={12}> <Col span={3}> <Form.Item> <Button type=\"primary\" onClick={() => setModal(true)}><PlusOutlined/>\u6dfb\u52a0\u5730\u5740</Button> </Form.Item> </Col> <Col span={7}> <Form.Item label=\"\u73af\u5883\" name=\"env\"> <Select allowClear showSearch placeholder=\"\u9009\u62e9\u5bf9\u5e94\u7684\u73af\u5883\"> {envList.map(item => <Option value={item.id} key={item.id}>{item.name}</Option>)} </Select> </Form.Item> </Col> <Col span={7}> <Form.Item label=\"\u540d\u79f0\" name=\"name\"> <Input placeholder=\"\u8f93\u5165\u5bf9\u5e94\u7684\u5730\u5740\u540d\u79f0\"/> </Form.Item> </Col> <Col span={7}> <Form.Item label=\"\u5730\u5740\" name=\"gateway\"> <Input placeholder=\"\u8f93\u5165\u5bf9\u5e94\u7684\u5730\u5740\"/> </Form.Item> </Col> </Row> </Form> <Table columns={columns} loading={isLoading} rowKey={record => record.id} dataSource={addressList}/> </Card> </PageContainer> ) } export default connect(({gconfig, user, loading}) => ({gconfig, user, loading}))(memo(Address)); \u5f53\u67e5\u8be2\u8868\u5355\u7684\u6570\u636e\u53d8\u5316\u65f6\uff0c\u6211\u4eec\u4f1a\u81ea\u52a8\u91cd\u65b0\u83b7\u53d6 \u67e5\u8be2\u63a5\u53e3 \u3002\u90a3\u4e48\u5173\u4e8e\u5177\u4f53\u7684\u4f7f\u7528\u7ec6\u8282\uff0c\u6211\u4eec\u5c06\u5728\u4e0b\u4e00\u7ae0\u6765\u5b8c\u5584\uff0c\u656c\u8bf7\u671f\u5f85~ \u6700\u65b0\u4f53\u9a8c\u5730\u5740: https://pity.fun","title":"\u7f16\u5199\u524d\u7aef\u9875\u9762"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28117%29%20%E8%AF%B7%E6%B1%82%E5%9C%B0%E5%9D%80%E4%BC%98%E5%8C%96%E5%AE%9E%E6%88%98/","text":"\u4e00\u8d77\u517b\u6210\u5199\u4f5c\u4e60\u60ef\uff01\u8fd9\u662f\u6211\u53c2\u4e0e\u300c\u6398\u91d1\u65e5\u65b0\u8ba1\u5212 \u00b7 4 \u6708\u66f4\u6587\u6311\u6218\u300d\u7684\u7b2c5\u5929\uff0c \u70b9\u51fb\u67e5\u770b\u6d3b\u52a8\u8be6\u60c5 \u3002 \u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u4e00\u8d77\u4ea4\u6d41\u5b66\u4e60! \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u7f16\u5199\u4e86 \u8bf7\u6c42\u5730\u5740 \u7684CRUD\u64cd\u4f5c\uff0c\u90a3\u8fd9\u4e00\u8282\u6211\u4eec\u5c31\u628a\u5b83\u8fd0\u7528\u5230\u6211\u4eec\u7684\u5e73\u53f0\u4e4b\u4e2d\u3002 \u6539\u9020\u540e\u7aef \u9996\u5148\u6211\u4eec\u7684 \u7528\u4f8b\u5217\u8868 \u9700\u8981\u5b58\u50a8\u4e00\u4e2abase_path\u7684\u5b57\u6bb5\uff0c\u7528\u6765\u5b58\u653e\u6211\u4eec\u7684\u5730\u5740\u8868\u5bf9\u5e94\u7684 name \u5b57\u6bb5\u3002 \u4e3a\u4ec0\u4e48\u662fname\u800c\u4e0d\u662fid\uff1f \u4e3b\u8981\u8fd8\u662f\u56e0\u4e3a\u6211\u4eec\u4e25\u683c\u533a\u5206\u73af\u5883\uff0c\u5982\u679c\u56fa\u5b9a\u7684id\uff0c\u6211\u4eec\u5219\u6ca1\u6709\u529e\u6cd5\u901a\u8fc7env+name\u7684\u65b9\u5f0f\u52a8\u6001\u83b7\u53d6\u5230\u5bf9\u5e94\u73af\u5883\u4e0b\u8fd9\u4e2aname\u7684\u5730\u5740\u3002\u5f53\u7136\u8fd9\u6837\u7684\u65b9\u6cd5\u4e5f\u6709\u574f\u5904: \u4e00\u65e6\u8bf7\u6c42\u5730\u5740\u91cc\u9762\u7684name\u53d1\u751f\u53d8\u5316\uff0c\u6211\u4eec\u9700\u8981\u53bb \u8c03\u6574\u7528\u4f8b \u3002\u6240\u4ee5\u5efa\u8bae\u5927\u5bb6\u4e0d\u8981\u8f7b\u6613\u6539\u540d\u5b57\uff0c\u6bd5\u7adf\u8fd9\u662f\u4e2a\u6807\u8bc6\uff0c\u4e00\u822c\u4e5f\u4e0d\u4f1a\u968f\u4fbf\u6539\u52a8\uff0c\u6539url\u662f\u6ca1\u95ee\u9898\u7684\u3002 \u6dfb\u52a0\u5b57\u6bb5base_path \u6ce8\u610f\uff0c\u6211\u4eec\u8fd8\u5f97\u53bb\u6570\u636e\u5e93 \u6dfb\u52a0 \u8fd9\u4e2a\u5b57\u6bb5\u3002 \u4fee\u6539TestCaseForm \u4e5f\u662f\u6dfb\u52a0\u8fd9\u4e2a\u5b57\u6bb5\u3002 \u8fd9\u6837\u540e\u7aef\u5bf9\u4e8e\u7528\u4f8b\u8868\u7684\u53d8\u66f4\u5c31\u5b8c\u6210\u4e86\uff0c\u63a5\u7740\u6211\u4eec\u8981\u5230\u6267\u884ccase\u7684\u5730\u65b9\u505a\u4e00\u4e9b\u5bf9\u5e94\u7684\u8c03\u6574\u3002 \u6dfb\u52a0query_gateway\u65b9\u6cd5 \u6dfb\u52a0query_gateway\u7684\u65b9\u6cd5\uff0c\u6839\u636eenv\u548cname\u67e5\u8be2\u5bf9\u5e94\u7684base_path\u3002 \u8c03\u6574\u7528\u4f8b\u6267\u884c\u7684\u65b9\u6cd5 \u5728\u6587\u4ef6executor.py\u91cc\u9762\u65b0\u589eurl\u66ff\u6362\uff0c\u5982\u679c\u5b58\u5728 base_path \u5219\u5c1d\u8bd5\u66ff\u6362\u3002 \u6539\u9020\u524d\u7aef \u4e0b\u9762\u662f\u6700\u7ec8\u6548\u679c\u3002 \u4e4b\u524d\u524d\u7aef\u662f\u4e00\u4e2a \u81ea\u52a8\u5b8c\u6210 \u7684\u7ec4\u4ef6\uff0c\u73b0\u5728\u6211\u4eec\u628a\u5b83\u6539\u6210Input\u5e76\u52a0\u4e0a\u524d\u7f00\uff08\u9009\u62e9\u6846\uff09\u3002 // \u524d\u7f00\u9009\u62e9\u6846\u5982\u4e0b\uff0c const prefixSelector = ( <Form.Item name=\"base_path\" noStyle> <Select style={{width: 130}} placeholder=\"\u9009\u62e9BasePath\" showSearch allowClear optionLabelProp=\"label\" filterOption={(input, option) => { console.log(option.children) if (option.children.length > 1) { return false; } return option.children.props.children.indexOf(input.toLowerCase()) >= 0 } } > <Option value={null} label=\"\u65e0\">\u65e0<a style={{float: 'right', fontSize: 12}} href=\"/#/config/address\" target=\"_blank\">\u53bb\u914d\u7f6e</a></Option> { Object.keys(currentAddress).map(key => <Option value={key} key={key} label={key}><Tooltip title={ <div> { Object.keys(currentAddress[key]).map(v => <p> {envMap[v]}: {currentAddress[key][v]} </p>) } </div> }> {key} </Tooltip> </Option>) } </Select> </Form.Item> ); \u8fd9\u91cc\u6211\u4eec\u591a\u4e86\u4e00\u4e2a\u83b7\u53d6address\u7684\u65b9\u6cd5\uff0c\u5e76\u62ff\u5230\u6240\u6709\u5730\u5740\u91cc\u9762\u7684 \u73af\u5883\u6570\u636e \u3002\u9f20\u6807\u79fb\u5230\u9009\u9879\u53ef\u4ee5\u770b\u5230\u5177\u4f53\u7684\u5404\u4e2a\u73af\u5883\u7684\u5730\u5740: \u5f53\u7136\u4e5f\u63d0\u4f9b\u4e86\u76f4\u63a5\u53bb\u914d\u7f6e\u7684\u529f\u80fd\uff0c\u65b9\u4fbf\u7528\u6237\u76f4\u63a5\u53ef\u4ee5 \u8df3\u8f6c\u8fc7\u53bb\u914d\u7f6e \u3002 \u6d4b\u8bd5 \u6211\u4eec\u6765\u8dd1\u4e0b\u8fd9\u4e2a\u7528\u4f8b\uff0c\u770b\u770b\u80fd\u4e0d\u80fd\u987a\u5229\u901a\u8fc7: \u53ef\u4ee5\u770b\u5230\u8fd9\u8fb9url\u88ab \u6b63\u786e\u5730 \u66ff\u6362\u4e86\uff0c\u90a3\u4e5f\u5c31\u8bf4\u660e\u6211\u4eec\u7684\u76ee\u7684\u8fbe\u5230\u4e86\u3002\u4eca\u5929\u7684\u6587\u7ae0\u56e0\u4e3a\u75ab\u60c5\u539f\u56e0\uff0c\u5c31\u5148\u8bb2\u5230\u8fd9\u91cc\uff0c\u4e0b\u4e00\u8282\u4e5f\u8fd8\u4e0d\u77e5\u9053\u8bb2\u5565\uff0c\u4f46\u662f\u65e5\u66f4\u4efb\u52a1\u8fd8\u662f\u5f97\u7ee7\u7eed\u7684\uff01","title":"117.\u8bf7\u6c42\u5730\u5740\u4f18\u5316\u5b9e\u6218"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28117%29%20%E8%AF%B7%E6%B1%82%E5%9C%B0%E5%9D%80%E4%BC%98%E5%8C%96%E5%AE%9E%E6%88%98/#_1","text":"\u4e0a\u4e00\u8282\u6211\u4eec\u7f16\u5199\u4e86 \u8bf7\u6c42\u5730\u5740 \u7684CRUD\u64cd\u4f5c\uff0c\u90a3\u8fd9\u4e00\u8282\u6211\u4eec\u5c31\u628a\u5b83\u8fd0\u7528\u5230\u6211\u4eec\u7684\u5e73\u53f0\u4e4b\u4e2d\u3002","title":"\u56de\u987e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28117%29%20%E8%AF%B7%E6%B1%82%E5%9C%B0%E5%9D%80%E4%BC%98%E5%8C%96%E5%AE%9E%E6%88%98/#_2","text":"\u9996\u5148\u6211\u4eec\u7684 \u7528\u4f8b\u5217\u8868 \u9700\u8981\u5b58\u50a8\u4e00\u4e2abase_path\u7684\u5b57\u6bb5\uff0c\u7528\u6765\u5b58\u653e\u6211\u4eec\u7684\u5730\u5740\u8868\u5bf9\u5e94\u7684 name \u5b57\u6bb5\u3002 \u4e3a\u4ec0\u4e48\u662fname\u800c\u4e0d\u662fid\uff1f \u4e3b\u8981\u8fd8\u662f\u56e0\u4e3a\u6211\u4eec\u4e25\u683c\u533a\u5206\u73af\u5883\uff0c\u5982\u679c\u56fa\u5b9a\u7684id\uff0c\u6211\u4eec\u5219\u6ca1\u6709\u529e\u6cd5\u901a\u8fc7env+name\u7684\u65b9\u5f0f\u52a8\u6001\u83b7\u53d6\u5230\u5bf9\u5e94\u73af\u5883\u4e0b\u8fd9\u4e2aname\u7684\u5730\u5740\u3002\u5f53\u7136\u8fd9\u6837\u7684\u65b9\u6cd5\u4e5f\u6709\u574f\u5904: \u4e00\u65e6\u8bf7\u6c42\u5730\u5740\u91cc\u9762\u7684name\u53d1\u751f\u53d8\u5316\uff0c\u6211\u4eec\u9700\u8981\u53bb \u8c03\u6574\u7528\u4f8b \u3002\u6240\u4ee5\u5efa\u8bae\u5927\u5bb6\u4e0d\u8981\u8f7b\u6613\u6539\u540d\u5b57\uff0c\u6bd5\u7adf\u8fd9\u662f\u4e2a\u6807\u8bc6\uff0c\u4e00\u822c\u4e5f\u4e0d\u4f1a\u968f\u4fbf\u6539\u52a8\uff0c\u6539url\u662f\u6ca1\u95ee\u9898\u7684\u3002 \u6dfb\u52a0\u5b57\u6bb5base_path \u6ce8\u610f\uff0c\u6211\u4eec\u8fd8\u5f97\u53bb\u6570\u636e\u5e93 \u6dfb\u52a0 \u8fd9\u4e2a\u5b57\u6bb5\u3002 \u4fee\u6539TestCaseForm \u4e5f\u662f\u6dfb\u52a0\u8fd9\u4e2a\u5b57\u6bb5\u3002 \u8fd9\u6837\u540e\u7aef\u5bf9\u4e8e\u7528\u4f8b\u8868\u7684\u53d8\u66f4\u5c31\u5b8c\u6210\u4e86\uff0c\u63a5\u7740\u6211\u4eec\u8981\u5230\u6267\u884ccase\u7684\u5730\u65b9\u505a\u4e00\u4e9b\u5bf9\u5e94\u7684\u8c03\u6574\u3002 \u6dfb\u52a0query_gateway\u65b9\u6cd5 \u6dfb\u52a0query_gateway\u7684\u65b9\u6cd5\uff0c\u6839\u636eenv\u548cname\u67e5\u8be2\u5bf9\u5e94\u7684base_path\u3002 \u8c03\u6574\u7528\u4f8b\u6267\u884c\u7684\u65b9\u6cd5 \u5728\u6587\u4ef6executor.py\u91cc\u9762\u65b0\u589eurl\u66ff\u6362\uff0c\u5982\u679c\u5b58\u5728 base_path \u5219\u5c1d\u8bd5\u66ff\u6362\u3002","title":"\u6539\u9020\u540e\u7aef"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28117%29%20%E8%AF%B7%E6%B1%82%E5%9C%B0%E5%9D%80%E4%BC%98%E5%8C%96%E5%AE%9E%E6%88%98/#_3","text":"\u4e0b\u9762\u662f\u6700\u7ec8\u6548\u679c\u3002 \u4e4b\u524d\u524d\u7aef\u662f\u4e00\u4e2a \u81ea\u52a8\u5b8c\u6210 \u7684\u7ec4\u4ef6\uff0c\u73b0\u5728\u6211\u4eec\u628a\u5b83\u6539\u6210Input\u5e76\u52a0\u4e0a\u524d\u7f00\uff08\u9009\u62e9\u6846\uff09\u3002 // \u524d\u7f00\u9009\u62e9\u6846\u5982\u4e0b\uff0c const prefixSelector = ( <Form.Item name=\"base_path\" noStyle> <Select style={{width: 130}} placeholder=\"\u9009\u62e9BasePath\" showSearch allowClear optionLabelProp=\"label\" filterOption={(input, option) => { console.log(option.children) if (option.children.length > 1) { return false; } return option.children.props.children.indexOf(input.toLowerCase()) >= 0 } } > <Option value={null} label=\"\u65e0\">\u65e0<a style={{float: 'right', fontSize: 12}} href=\"/#/config/address\" target=\"_blank\">\u53bb\u914d\u7f6e</a></Option> { Object.keys(currentAddress).map(key => <Option value={key} key={key} label={key}><Tooltip title={ <div> { Object.keys(currentAddress[key]).map(v => <p> {envMap[v]}: {currentAddress[key][v]} </p>) } </div> }> {key} </Tooltip> </Option>) } </Select> </Form.Item> ); \u8fd9\u91cc\u6211\u4eec\u591a\u4e86\u4e00\u4e2a\u83b7\u53d6address\u7684\u65b9\u6cd5\uff0c\u5e76\u62ff\u5230\u6240\u6709\u5730\u5740\u91cc\u9762\u7684 \u73af\u5883\u6570\u636e \u3002\u9f20\u6807\u79fb\u5230\u9009\u9879\u53ef\u4ee5\u770b\u5230\u5177\u4f53\u7684\u5404\u4e2a\u73af\u5883\u7684\u5730\u5740: \u5f53\u7136\u4e5f\u63d0\u4f9b\u4e86\u76f4\u63a5\u53bb\u914d\u7f6e\u7684\u529f\u80fd\uff0c\u65b9\u4fbf\u7528\u6237\u76f4\u63a5\u53ef\u4ee5 \u8df3\u8f6c\u8fc7\u53bb\u914d\u7f6e \u3002","title":"\u6539\u9020\u524d\u7aef"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28117%29%20%E8%AF%B7%E6%B1%82%E5%9C%B0%E5%9D%80%E4%BC%98%E5%8C%96%E5%AE%9E%E6%88%98/#_4","text":"\u6211\u4eec\u6765\u8dd1\u4e0b\u8fd9\u4e2a\u7528\u4f8b\uff0c\u770b\u770b\u80fd\u4e0d\u80fd\u987a\u5229\u901a\u8fc7: \u53ef\u4ee5\u770b\u5230\u8fd9\u8fb9url\u88ab \u6b63\u786e\u5730 \u66ff\u6362\u4e86\uff0c\u90a3\u4e5f\u5c31\u8bf4\u660e\u6211\u4eec\u7684\u76ee\u7684\u8fbe\u5230\u4e86\u3002\u4eca\u5929\u7684\u6587\u7ae0\u56e0\u4e3a\u75ab\u60c5\u539f\u56e0\uff0c\u5c31\u5148\u8bb2\u5230\u8fd9\u91cc\uff0c\u4e0b\u4e00\u8282\u4e5f\u8fd8\u4e0d\u77e5\u9053\u8bb2\u5565\uff0c\u4f46\u662f\u65e5\u66f4\u4efb\u52a1\u8fd8\u662f\u5f97\u7ee7\u7eed\u7684\uff01","title":"\u6d4b\u8bd5"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28118%29%20%E4%BC%98%E5%8C%96%E8%BF%94%E5%9B%9E%E7%9A%84JSON%E6%95%B0%E6%8D%AE/","text":"\u4e00\u8d77\u517b\u6210\u5199\u4f5c\u4e60\u60ef\uff01\u8fd9\u662f\u6211\u53c2\u4e0e\u300c\u6398\u91d1\u65e5\u65b0\u8ba1\u5212 \u00b7 4 \u6708\u66f4\u6587\u6311\u6218\u300d\u7684\u7b2c7\u5929\uff0c \u70b9\u51fb\u67e5\u770b\u6d3b\u52a8\u8be6\u60c5 \u3002 \u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u4e00\u8d77\u4ea4\u6d41\u5b66\u4e60! \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u628a \u8bf7\u6c42\u5730\u5740 \u7ed9\u4f18\u5316\u4e86\u4e00\u987f\uff0c\u4eca\u5929\u7fa4\u91cc\u7684\u4e00\u4e2a\u6d4b\u53cb\u7ed9\u4e86\u70b9\u5efa\u8bae\uff0c\u8bf4\u6211\u67e5\u8be2\u4e2a\u4eba\u4fe1\u606f\u7684\u63a5\u53e3\u66b4\u9732\u7684 \u5b57\u6bb5 \u592a\u591a\u4e86\u3002\u5565\u5bc6\u7801\u3001\u90ae\u7bb1\u3001\u624b\u673a\u90fd\u7ed9\u5c55\u793a\u4e86\u51fa\u6765\uff0c\u90a3\u4e48\u8fd9\u4e00\u8282\u6211\u4eec\u4e13\u95e8\u9488\u5bf9\u8fd9\u4e2a\uff0c\u6765\u6539\u9020\u4e00\u756a\u3002 \u73b0\u6709\u7684Response \u6211\u4eec\u4e4b\u524d\u5c01\u88c5\u8fc7\u4e00\u4e2a PityResponse \uff0c\u91cc\u9762\u6709\u4e00\u4e9b\u57fa\u7840\u529f\u80fd\uff0c\u54b1\u4eec\u770b\u770b: \u53ef\u4ee5\u770b\u5230\uff0c\u6211\u4eec\u5c31\u662f \u5305\u4e86\u4e00\u5c42 \uff0c\u628a\u539f\u5148\u7684dict\u7ed9\u5305\u88c5\u4e86\u8d77\u6765\uff0c\u65b0\u589e\u4e86\u4e00\u4e9b\u9ed8\u8ba4\u53c2\u6570\u6bd4\u5982msg\u548ccode\uff0c\u5b9a\u4e49\u4e86\u4e0d\u540c\u7684\u65b9\u6cd5\uff0c\u7b49\u4e8e\u662f\u7b80\u5316\u4e86 api \u3002\u4f46\u6211\u4eec\u5176\u5b9e\u4e00\u76f4\u6709\u4e2a\u5f88\u5927\u7684\u5f0a\u7aef\uff0c\u5f80\u4e0b\u770b: \u6211\u4eec\u6709\u4e2amodel_to_list\u7684\u65b9\u6cd5\uff0c\u91cc\u9762\u7684\u64cd\u4f5c\u5462\uff0c\u5c31\u662f\u53bb\u904d\u5386\u6570\u7ec4\uff0c\u518d\u628asqlalchemy\u7684\u5bf9\u8c61\u8f6c\u6362\u4e3a\u5b57\u5178\u3002\u4e5f\u5c31\u662f\u67092\u5c42for\u5faa\u73af\uff0c\u7b2c\u4e00\u5c42\u662f\u6570\u7ec4\u7684\u5faa\u73af\uff0c\u7b2c\u4e8c\u5c42\u662f\u5b57\u5178\u7684key-value\u3002 \u7b2c\u4e8c\u5c42\u7684\u8bdd\uff0c\u7531\u4e8e\u4e00\u4e2a\u5bf9\u8c61\u4e00\u822c\u4e0d\u4f1a\u6709\u5f88\u591a\u5b57\u6bb5\uff0c\u6709\u4e5f\u4e0d\u4f1a\u8d85\u8fc7100\u4e2a\u90a3\u4e48\u591a\uff0c\u6240\u4ee5\u8fd8\u662f\u53ef\u4ee5\u63a5\u53d7\u7684\u3002\u4f46\u5982\u679clist\u67091000\u6761\u6570\u636e\uff0c\u6bd4\u5982\u64cd\u4f5c\u8bb0\u5f55\u554a\u5565\u7684\u5206\u5206\u949f\u8fc71000\uff08\u4e0d\u8003\u8651\u5206\u9875\u7684\u60c5\u51b5\u4e0b\uff09\uff0c\u90a3\u8fd9\u6837\u5e8f\u5217\u5316\u7684\u901f\u5ea6\u5c31\u4f1a \u660e\u663e\u53d8\u6162 \u3002 \u6240\u4ee5\u4eca\u5929\u6211\u4eec\u5c31\u987a\u52bf\u800c\u4e3a\uff0c\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002 json_encoder \u4e4b\u6240\u4ee5\u6211\u81ea\u5df1\u5199\u4e00\u4e2a model_to_dict \u7684\u65b9\u6cd5\uff0c\u662f\u56e0\u4e3a\u6211\u5bf9 \u65f6\u95f4\u683c\u5f0f \u6709\u7740\u6d01\u7656\uff0c\u6211\u5e0c\u671b\u7684\u65f6\u95f4\u683c\u5f0f\u662f: 2022-04-06 12:11:11 \uff0c\u5982\u679c\u6709 2022-04-06T12:11:11 \uff0c\u6211\u90fd\u4f1a\u89c9\u5f97\u8fa3\u773c\u775b\uff08\u7126\u8e81\uff09\u3002 \u90a3\u6709\u6ca1\u6709 \u66f4\u7b80\u5355 \u7684\u529e\u6cd5\u5462\uff1f\u80af\u5b9a\u6709\u7684\u5566\uff0cfastapi\u4f5c\u4e3a\u4e00\u4e2a\u65b0\u751f\u4ee3\u7684\u6846\u67b6\uff0c\u8fd9\u70b9\u4e1c\u897f\u8fd8\u662f\u80fd\u60f3\u5230\u7684\u3002 \u6211\u4eec\u6765\u770b\u5b98\u7f51\u7ed9\u7684\u4f8b\u5b50: \u5b98\u7f51\u5c31\u662f\u5b98\u7f51\uff0c\u8fd8\u662f\u4e00\u5982\u65e2\u5f80\u7684\u7b80\u6d01(\u7c97\u7cd9)\u3002 \u7b80\u5355\u7684\u8bf4\uff0c\u5c31\u662f\u5f15\u5165 json_encoder \u65b9\u6cd5\uff0c\u63a5\u7740\u8c03\u7528\u5b83\uff0c\u4f20\u5165\u4f60\u8981\u5e8f\u5217\u5316\u7684\u6570\u636e\uff08\u5b57\u5178\uff0cpydantic\u7684model\uff0csqlalchemy\u7684model\u90fd\u53ef\u4ee5\uff09\uff0c\u6700\u540e\u5c31\u4f1a\u5982\u610f\u5982\u610f\u6309\u4f60\u5fc3\u610f\u8fdb\u884c\u5e8f\u5217\u5316\u4e86\u3002 \u719f\u6089\u5b83\u7684api \u53c2\u6570\u5f88\u591a\uff0c\u4f46\u6ca1\u5565\u63cf\u8ff0\uff01 \u6839\u636e\u8bed\u4e49\uff0c\u6211\u4eec\u53ef\u4ee5\u63a8\u65ad\u51fa\uff0cobj\u5c31\u662f\u8981\u5e8f\u5217\u5316\u7684\u5bf9\u8c61\uff0cinclude\u5c31\u662f\u8981\u5305\u62ec\u7684\u5b57\u6bb5\uff08\u4e0d\u4f20\u5c31\u662f\u6240\u6709\u54af\uff09\uff0cexclude\u662f\u4e0d\u5305\u542b\u7684\u5b57\u6bb5\uff0c\u8bb0\u5f97\u6211\u4eec\u524d\u9762\u7684\u9700\u6c42\u5417\uff1f\u6211\u4eec\u9700\u8981\u6392\u9664 password \u7b49\u5b57\u6bb5\u3002 custom_encoder\u8fd9\u4e2a\u53c2\u6570\u5c31\u6bd4\u8f83\u8fc7\u5206\u4e86\uff0c\u5b8c\u7f8e\u5b9e\u73b0\u6211\u4eec\u5bf9\u65f6\u95f4\u683c\u5f0f\u7684\u8981\u6c42\uff0c\u5b83\u7684\u4f5c\u7528\u662f(\u8ba4\u771f\u542c): \u63a5\u53d7\u4e00\u4e2a\u5b57\u5178\uff0ckey\u5462\uff0c\u662f\u5bf9\u5e94\u7684\u7c7b\u578b\uff0cvalue\u662f\u4e00\u4e2a\u65b9\u6cd5\uff0c\u65b9\u6cd5\u7684\u53c2\u6570\u662f\u5c5e\u6027\u7684value\uff0c\u8fd4\u56de\u503c\u662f\u4f60\u8981\u53d8\u6210\u7684value \u3002 \u4e3e\u4e2a\u4f8b\u5b50: \u6211\u4eec\u7684object\u91cc\u9762\u6709\u4e2adatetime\u7c7b\u578b\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u8fd9\u4e48\u5199: jsonable_encoder ( data , custom_encoder = { datetime : lambda x : x . strftime ( \"%Y-%m- %d %H:%M:%S\" ) }) \u5f00\u59cb\u6539\u9020 \u6211\u4eec\u5b9a\u4e49\u4e00\u4e2aencode_json\u7684\u65b9\u6cd5\uff0c\u4f20\u5165exclude\u548ccustom_encoder\uff0c\u63a5\u7740\u5957\u5230success\u91cc\u9762\uff0c\u4ee5\u5f80\u6211\u4eec\u8fd9\u6837\u7684api\uff0c\u5c31\u53ef\u4ee5\u8fdb\u884c\u66ff\u6362\u4e86. \u66ff\u6362\u524d(\u771f\u7684**) \u66ff\u6362\u540e \u6e05\u723d\u4e00\u70b9\u70b9\uff0c\u8fd8\u589e\u52a0\u4e86\u6392\u9664\u7684 \u5b57\u6bb5 \u3002 \u770b\u770b\u6548\u679c \u5bc6\u7801\u65e0\u4e86\uff0c\u563f\u563f\uff0c\u641e\u5b9a\u3002 Bonus \u5176\u5b9e\u5427\uff0c\u8fd9\u91cc\u9762\u6709\u5751\uff0c\u5982\u679c\u4f60\u8ddf\u7740\u5199\u4e0b\u6765\u7684\u8bdd\u4f1a\u53d1\u73b0exclude\u4e0d\u4f1a\u771f\u7684\u751f\u6548\uff0c\u56e0\u4e3ajson_encoder\u7684\u6e90\u7801\u53ea\u6709\u7b2c\u4e00\u5c42\u662f\u63a5\u53d7\u4e86exclude\u53c2\u6570\u7684\uff0c\u9012\u5f52\u7684\u90e8\u5206\u662f\u6ca1\u6709\u7684\u3002\u90a3\u4e48\u600e\u4e48\u89e3\u51b3\u5462\uff1f \u8fd8\u662f\u770b\u770bpity\u6e90\u4ee3\u7801\u5427~","title":"118.\u4f18\u5316\u8fd4\u56de\u7684JSON\u6570\u636e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28118%29%20%E4%BC%98%E5%8C%96%E8%BF%94%E5%9B%9E%E7%9A%84JSON%E6%95%B0%E6%8D%AE/#_1","text":"\u4e0a\u4e00\u8282\u6211\u4eec\u628a \u8bf7\u6c42\u5730\u5740 \u7ed9\u4f18\u5316\u4e86\u4e00\u987f\uff0c\u4eca\u5929\u7fa4\u91cc\u7684\u4e00\u4e2a\u6d4b\u53cb\u7ed9\u4e86\u70b9\u5efa\u8bae\uff0c\u8bf4\u6211\u67e5\u8be2\u4e2a\u4eba\u4fe1\u606f\u7684\u63a5\u53e3\u66b4\u9732\u7684 \u5b57\u6bb5 \u592a\u591a\u4e86\u3002\u5565\u5bc6\u7801\u3001\u90ae\u7bb1\u3001\u624b\u673a\u90fd\u7ed9\u5c55\u793a\u4e86\u51fa\u6765\uff0c\u90a3\u4e48\u8fd9\u4e00\u8282\u6211\u4eec\u4e13\u95e8\u9488\u5bf9\u8fd9\u4e2a\uff0c\u6765\u6539\u9020\u4e00\u756a\u3002","title":"\u56de\u987e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28118%29%20%E4%BC%98%E5%8C%96%E8%BF%94%E5%9B%9E%E7%9A%84JSON%E6%95%B0%E6%8D%AE/#response","text":"\u6211\u4eec\u4e4b\u524d\u5c01\u88c5\u8fc7\u4e00\u4e2a PityResponse \uff0c\u91cc\u9762\u6709\u4e00\u4e9b\u57fa\u7840\u529f\u80fd\uff0c\u54b1\u4eec\u770b\u770b: \u53ef\u4ee5\u770b\u5230\uff0c\u6211\u4eec\u5c31\u662f \u5305\u4e86\u4e00\u5c42 \uff0c\u628a\u539f\u5148\u7684dict\u7ed9\u5305\u88c5\u4e86\u8d77\u6765\uff0c\u65b0\u589e\u4e86\u4e00\u4e9b\u9ed8\u8ba4\u53c2\u6570\u6bd4\u5982msg\u548ccode\uff0c\u5b9a\u4e49\u4e86\u4e0d\u540c\u7684\u65b9\u6cd5\uff0c\u7b49\u4e8e\u662f\u7b80\u5316\u4e86 api \u3002\u4f46\u6211\u4eec\u5176\u5b9e\u4e00\u76f4\u6709\u4e2a\u5f88\u5927\u7684\u5f0a\u7aef\uff0c\u5f80\u4e0b\u770b: \u6211\u4eec\u6709\u4e2amodel_to_list\u7684\u65b9\u6cd5\uff0c\u91cc\u9762\u7684\u64cd\u4f5c\u5462\uff0c\u5c31\u662f\u53bb\u904d\u5386\u6570\u7ec4\uff0c\u518d\u628asqlalchemy\u7684\u5bf9\u8c61\u8f6c\u6362\u4e3a\u5b57\u5178\u3002\u4e5f\u5c31\u662f\u67092\u5c42for\u5faa\u73af\uff0c\u7b2c\u4e00\u5c42\u662f\u6570\u7ec4\u7684\u5faa\u73af\uff0c\u7b2c\u4e8c\u5c42\u662f\u5b57\u5178\u7684key-value\u3002 \u7b2c\u4e8c\u5c42\u7684\u8bdd\uff0c\u7531\u4e8e\u4e00\u4e2a\u5bf9\u8c61\u4e00\u822c\u4e0d\u4f1a\u6709\u5f88\u591a\u5b57\u6bb5\uff0c\u6709\u4e5f\u4e0d\u4f1a\u8d85\u8fc7100\u4e2a\u90a3\u4e48\u591a\uff0c\u6240\u4ee5\u8fd8\u662f\u53ef\u4ee5\u63a5\u53d7\u7684\u3002\u4f46\u5982\u679clist\u67091000\u6761\u6570\u636e\uff0c\u6bd4\u5982\u64cd\u4f5c\u8bb0\u5f55\u554a\u5565\u7684\u5206\u5206\u949f\u8fc71000\uff08\u4e0d\u8003\u8651\u5206\u9875\u7684\u60c5\u51b5\u4e0b\uff09\uff0c\u90a3\u8fd9\u6837\u5e8f\u5217\u5316\u7684\u901f\u5ea6\u5c31\u4f1a \u660e\u663e\u53d8\u6162 \u3002 \u6240\u4ee5\u4eca\u5929\u6211\u4eec\u5c31\u987a\u52bf\u800c\u4e3a\uff0c\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002","title":"\u73b0\u6709\u7684Response"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28118%29%20%E4%BC%98%E5%8C%96%E8%BF%94%E5%9B%9E%E7%9A%84JSON%E6%95%B0%E6%8D%AE/#json_encoder","text":"\u4e4b\u6240\u4ee5\u6211\u81ea\u5df1\u5199\u4e00\u4e2a model_to_dict \u7684\u65b9\u6cd5\uff0c\u662f\u56e0\u4e3a\u6211\u5bf9 \u65f6\u95f4\u683c\u5f0f \u6709\u7740\u6d01\u7656\uff0c\u6211\u5e0c\u671b\u7684\u65f6\u95f4\u683c\u5f0f\u662f: 2022-04-06 12:11:11 \uff0c\u5982\u679c\u6709 2022-04-06T12:11:11 \uff0c\u6211\u90fd\u4f1a\u89c9\u5f97\u8fa3\u773c\u775b\uff08\u7126\u8e81\uff09\u3002 \u90a3\u6709\u6ca1\u6709 \u66f4\u7b80\u5355 \u7684\u529e\u6cd5\u5462\uff1f\u80af\u5b9a\u6709\u7684\u5566\uff0cfastapi\u4f5c\u4e3a\u4e00\u4e2a\u65b0\u751f\u4ee3\u7684\u6846\u67b6\uff0c\u8fd9\u70b9\u4e1c\u897f\u8fd8\u662f\u80fd\u60f3\u5230\u7684\u3002 \u6211\u4eec\u6765\u770b\u5b98\u7f51\u7ed9\u7684\u4f8b\u5b50: \u5b98\u7f51\u5c31\u662f\u5b98\u7f51\uff0c\u8fd8\u662f\u4e00\u5982\u65e2\u5f80\u7684\u7b80\u6d01(\u7c97\u7cd9)\u3002 \u7b80\u5355\u7684\u8bf4\uff0c\u5c31\u662f\u5f15\u5165 json_encoder \u65b9\u6cd5\uff0c\u63a5\u7740\u8c03\u7528\u5b83\uff0c\u4f20\u5165\u4f60\u8981\u5e8f\u5217\u5316\u7684\u6570\u636e\uff08\u5b57\u5178\uff0cpydantic\u7684model\uff0csqlalchemy\u7684model\u90fd\u53ef\u4ee5\uff09\uff0c\u6700\u540e\u5c31\u4f1a\u5982\u610f\u5982\u610f\u6309\u4f60\u5fc3\u610f\u8fdb\u884c\u5e8f\u5217\u5316\u4e86\u3002","title":"json_encoder"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28118%29%20%E4%BC%98%E5%8C%96%E8%BF%94%E5%9B%9E%E7%9A%84JSON%E6%95%B0%E6%8D%AE/#api","text":"\u53c2\u6570\u5f88\u591a\uff0c\u4f46\u6ca1\u5565\u63cf\u8ff0\uff01 \u6839\u636e\u8bed\u4e49\uff0c\u6211\u4eec\u53ef\u4ee5\u63a8\u65ad\u51fa\uff0cobj\u5c31\u662f\u8981\u5e8f\u5217\u5316\u7684\u5bf9\u8c61\uff0cinclude\u5c31\u662f\u8981\u5305\u62ec\u7684\u5b57\u6bb5\uff08\u4e0d\u4f20\u5c31\u662f\u6240\u6709\u54af\uff09\uff0cexclude\u662f\u4e0d\u5305\u542b\u7684\u5b57\u6bb5\uff0c\u8bb0\u5f97\u6211\u4eec\u524d\u9762\u7684\u9700\u6c42\u5417\uff1f\u6211\u4eec\u9700\u8981\u6392\u9664 password \u7b49\u5b57\u6bb5\u3002 custom_encoder\u8fd9\u4e2a\u53c2\u6570\u5c31\u6bd4\u8f83\u8fc7\u5206\u4e86\uff0c\u5b8c\u7f8e\u5b9e\u73b0\u6211\u4eec\u5bf9\u65f6\u95f4\u683c\u5f0f\u7684\u8981\u6c42\uff0c\u5b83\u7684\u4f5c\u7528\u662f(\u8ba4\u771f\u542c): \u63a5\u53d7\u4e00\u4e2a\u5b57\u5178\uff0ckey\u5462\uff0c\u662f\u5bf9\u5e94\u7684\u7c7b\u578b\uff0cvalue\u662f\u4e00\u4e2a\u65b9\u6cd5\uff0c\u65b9\u6cd5\u7684\u53c2\u6570\u662f\u5c5e\u6027\u7684value\uff0c\u8fd4\u56de\u503c\u662f\u4f60\u8981\u53d8\u6210\u7684value \u3002 \u4e3e\u4e2a\u4f8b\u5b50: \u6211\u4eec\u7684object\u91cc\u9762\u6709\u4e2adatetime\u7c7b\u578b\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u8fd9\u4e48\u5199: jsonable_encoder ( data , custom_encoder = { datetime : lambda x : x . strftime ( \"%Y-%m- %d %H:%M:%S\" ) })","title":"\u719f\u6089\u5b83\u7684api"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28118%29%20%E4%BC%98%E5%8C%96%E8%BF%94%E5%9B%9E%E7%9A%84JSON%E6%95%B0%E6%8D%AE/#_2","text":"\u6211\u4eec\u5b9a\u4e49\u4e00\u4e2aencode_json\u7684\u65b9\u6cd5\uff0c\u4f20\u5165exclude\u548ccustom_encoder\uff0c\u63a5\u7740\u5957\u5230success\u91cc\u9762\uff0c\u4ee5\u5f80\u6211\u4eec\u8fd9\u6837\u7684api\uff0c\u5c31\u53ef\u4ee5\u8fdb\u884c\u66ff\u6362\u4e86. \u66ff\u6362\u524d(\u771f\u7684**) \u66ff\u6362\u540e \u6e05\u723d\u4e00\u70b9\u70b9\uff0c\u8fd8\u589e\u52a0\u4e86\u6392\u9664\u7684 \u5b57\u6bb5 \u3002","title":"\u5f00\u59cb\u6539\u9020"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28118%29%20%E4%BC%98%E5%8C%96%E8%BF%94%E5%9B%9E%E7%9A%84JSON%E6%95%B0%E6%8D%AE/#_3","text":"\u5bc6\u7801\u65e0\u4e86\uff0c\u563f\u563f\uff0c\u641e\u5b9a\u3002","title":"\u770b\u770b\u6548\u679c"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28118%29%20%E4%BC%98%E5%8C%96%E8%BF%94%E5%9B%9E%E7%9A%84JSON%E6%95%B0%E6%8D%AE/#bonus","text":"\u5176\u5b9e\u5427\uff0c\u8fd9\u91cc\u9762\u6709\u5751\uff0c\u5982\u679c\u4f60\u8ddf\u7740\u5199\u4e0b\u6765\u7684\u8bdd\u4f1a\u53d1\u73b0exclude\u4e0d\u4f1a\u771f\u7684\u751f\u6548\uff0c\u56e0\u4e3ajson_encoder\u7684\u6e90\u7801\u53ea\u6709\u7b2c\u4e00\u5c42\u662f\u63a5\u53d7\u4e86exclude\u53c2\u6570\u7684\uff0c\u9012\u5f52\u7684\u90e8\u5206\u662f\u6ca1\u6709\u7684\u3002\u90a3\u4e48\u600e\u4e48\u89e3\u51b3\u5462\uff1f \u8fd8\u662f\u770b\u770bpity\u6e90\u4ee3\u7801\u5427~","title":"Bonus"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28119%29%20%E4%BC%98%E5%8C%96%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u4e00\u8d77\u4ea4\u6d41\u5b66\u4e60! \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec \u4f18\u5316\u4e86 \u8fd4\u56de\u503c\u76f8\u5173\u7684\u5185\u5bb9\uff0c\u4eca\u5929\u6211\u4eec\u5c31\u987a\u85e4\u6478\u74dc\uff0c\u4ee5\u4e00\u4e2a\u4ea7\u54c1\u7ecf\u7406\u7684\u89d2\u8272\uff0c\u6765\u627e\u627e\u81ea\u5df1\u7684\u95ee\u9898\u3002 \u5176\u5b9e\u5f88\u591a\u65f6\u5019\u90fd\u662f\u5f53\u5c40\u8005\u8ff7\uff0c\u6240\u4ee5\u5982\u679c\u5404\u4f4d\u6709\u5174\u8da3\uff0c\u4e5f\u53ef\u4ee5\u53c2\u4e0e\u5230 \u9700\u6c42\u6536\u96c6 \u7684\u8fc7\u7a0b\u4e2d\u6765\u3002\u8fd9\u91cc\u611f\u8c22\u5927\u5bb6\u63d0\u51fa\u7684\u4e00\u4e9b\u5efa\u8bae\uff0c\u6211\u90fd\u6709\u8bb0\u5f55\u3002 \u53ef\u4ee5\u770b\u5230\uff0c\u9700\u6c42\u8fd8\u662f\u633a\u591a\u7684\u3002\u7531\u4e8e\u90fd\u662f\u79c1\u4e0b\u62bd\u65f6\u95f4\u6765\u5199\uff0c\u6240\u4ee5\u6548\u7387\u6bd4\u8f83\u4f4e\u3002\u4eca\u5929\u6211\u4eec\u5c31\u6765\u5b8c\u6210\u8fd9\u4e2a\u5c0f\u529f\u80fd\u70b9: \u6d4b\u8bd5\u62a5\u544a\u8df3\u8f6c\u5230\u5bf9\u5e94\u7684case\u3002 \u5386\u53f2\u539f\u56e0 \u5728\u505a\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u634b\u4e00\u634b\u5982\u4eca\u7684\u60c5\u51b5\u3002\u6211\u4eec\u7684\u7528\u4f8b\u662f\u6709\u4e00\u4e2a\u552f\u4e00\u7684id\u7684\uff0c\u4f46\u7531\u4e8e \u5386\u53f2\u539f\u56e0 \uff0c\u5f53\u521d\u8bbe\u8ba1\u7684\u65f6\u5019\u5728\u7528\u4f8b\u7684url\u52a0\u4e0a\u4e86\u7528\u4f8b\u76ee\u5f55id\uff08\u8fd9\u4e2a\u662f\u501f\u9274\u7684yapi\uff09\u3002 \u4e4b\u6240\u4ee5\u4eba\u5bb6\u8fd9\u4e48\u505a\uff0c\u662f\u4e3a\u4e86\u80fd\u5728url\u91cc\u9762\u76f4\u63a5\u5feb\u901f\u627e\u5230\u5bf9\u5e94\u7684\u76ee\u5f55\uff0c\u5e76\u4e14\u4ed6\u4eec\u7684\u76ee\u5f55\u9700\u8981\u652f\u6301 url\u8bbf\u95ee \u3002\u4f46\u6211\u4eec\u5982\u4eca\u662f\u4e0d\u80fd\u505a\u5230\u8fd9\u4e2a\u6548\u679c\u7684\uff0c\u4e3e\u4e2a\u4f8b\u5b50: \u4e0d\u7ba1\u6211\u4eec\u5982\u4f55 \u5207\u6362 \u5de6\u4fa7\u7684\u76ee\u5f55\uff0curl\u90fd\u4e0d\u4f1a\u53d8\u5316\uff0c\u4f46yapi\u662f\u652f\u6301\u7684\uff0c\u5b83\u5207\u6362\u76ee\u5f55\u7684\u65f6\u5019\uff0c\u5bf9\u5e94\u7684url\u4e5f\u4f1a\u53d1\u751f\u53d8\u5316\u3002 \u6211\u4eec\u518d\u6765\u770b\u770b\u6211\u4eec\u7684\u7528\u4f8b\u7684url: \u76ee\u524d\u662f\u6839\u636e\u76ee\u5f55id/\u7528\u4f8bid\u6765\u786e\u5b9a\u6570\u636e\u7684\uff0c\u4f46\u7531\u4e8e\u6211\u4eec \u6d4b\u8bd5\u62a5\u544a \u91cc\u5934\u53ea\u5b58\u50a8\u4e86 \u7528\u4f8bid \uff0c\u5e76\u6ca1\u6709\u5b58\u50a8\u76ee\u5f55id\uff0c\u6240\u4ee5\u5bfc\u81f4\u6211\u4eec\u6682\u65f6\u65e0\u6cd5\u8df3\u8f6c\u5230\u5177\u4f53\u7684\u7528\u4f8b\u9875\u9762: \u8fd9\u5c31\u5f88\u5c34\u5c2c\u4e86\uff0c\u601d\u8003\u4e86\u4e00\u6bb5\u65f6\u95f4\u4ee5\u540e\uff0c\u6211\u672c\u6765\u6253\u7b97 \u53bb\u6389 url\u91cc\u9762\u7684\u76ee\u5f55id\uff0c\u4f46\u6211\u53c8\u53d1\u73b0\uff0c\u65b0\u589e\u6d4b\u8bd5\u7528\u4f8b\u65f6\uff0c\u5b83\u5f52\u5c5e\u4e8e \u54ea\u4e2a \u76ee\u5f55\uff0c\u6211\u662f\u8bb0\u5f55\u5728url\u91cc\u9762\u7684\uff0c\u6240\u4ee5\u8fd9\u5c31\u5f88\u5c34\u5c2c\u4e86\u3002\u90a3\u5c31\u6682\u65f6\u4e0d\u53bb\u5427\uff0c\u6211\u4eec\u6362\u4e2a\u601d\u8def\uff0c\u83b7\u53d6\u6d4b\u8bd5\u62a5\u544a\u6570\u636e\u7684\u65f6\u5019\uff0c\u6211\u4eec\u628a\u7528\u4f8b\u76ee\u5f55 \u4e00\u5e76 \u67e5\u51fa\u6765\u3002 \u4fee\u6539\u62a5\u544a\u67e5\u8be2\u65b9\u6cd5 \u4fee\u6539\u62a5\u544a\u67e5\u8be2\u65b9\u6cd5\uff0c\u6ce8\u610f\uff0c\u8fd9\u91cc\u4f7f\u7528\u4e86join\u67e5\u8be2\uff0c\u5c06TestCase\u7684directory_id\u4e5f\u67e5\u4e86\u51fa\u6765\uff0c\u7531\u4e8esqlalchemy\u7684join\u7ed3\u679c\u662f\u5206\u5f00\u7684\uff0c\u4e0d\u662f\u5728\u4e00\u4e2amodel\u5bf9\u8c61\u91cc\u9762\uff0c\u6211\u4eec\u6765\u770b\u770b.all()\u8fd4\u56de\u4e86\u4ec0\u4e48\u3002 \u53ef\u4ee5\u770b\u51fa\u7684\u662f\uff0c\u5b83\u662f\u4e00\u4e2a \u5143\u7956 \uff0c\u4e5f\u5c31\u662f\u8fd9\u6837\u7684\u6570\u636e: [(PityTestResult, directory_id)] \u6240\u4ee5\u6211\u4eec\u624d\u9700\u8981\u628a\u5b83\u904d\u5386\u5e76\u62c6\u5f00\uff0c\u4f46\u662f\u7531\u4e8eTestResult\u91cc\u9762\u53c8\u6ca1\u6709directory_id\u5b57\u6bb5\uff0c\u90a3\u8be5\u548b\u6574\u5462\uff1f\u6240\u4ee5\u6211\u4eec\u8fd8\u9700\u8981\u4fee\u6539\u4e0b\u8fd9\u4e2amodel: \u6211\u4eec\u5728PityTestResult\u5bf9\u8c61\u91cc\u9762\u591a\u52a0\u4e00\u4e2a directory_id \u5b57\u6bb5\uff0c\u53ea\u8981\u4e0d\u662fColumn\u7c7b\u578b\u7684\uff0c\u5bf9\u6570\u636e\u5e93\u5c31\u4e0d\u4f1a\u6709\u5f71\u54cd\uff0c\u4e5f\u5c31\u662f\u8bf4\u6570\u636e\u5e93\u4e0d\u4f1a\u6620\u5c04\u8fd9\u4e2a \u5b57\u6bb5 \u3002 \u6700\u540e\u6211\u4eec\u628a\u67e5\u51fa\u6765\u7684directory_id\u91cd\u65b0\u8d4b\u4e88\u8fd9\u4e2a\u5bf9\u8c61\u5373\u53ef\u3002 \u6765\u770b\u770b\u7ed3\u679c: \u53ef\u4ee5\u770b\u5230\u91cc\u9762\u5df2\u7ecf\u6709directory_id\u4e86\uff0c\u8bf4\u660e\u67e5\u8be2\u6210\u4e86\uff0c\u63a5\u7740\u6211\u4eec\u5c31\u53bb\u4fee\u6539\u524d\u7aef\u4ee3\u7801\u3002 \u4fee\u6539\u524d\u7aef\u4ee3\u7801 \u770b\u770b\u6548\u679c: \u4eca\u5929\u7684\u5185\u5bb9\u6bd4\u8f83\u7b80\u77ed\uff0c\u4e3b\u8981\u662f\u56e0\u4e3a\u535a\u4e3b\u6700\u8fd1\u6838\u9178\u62bd\u4e86\u4e0d\u5c11\uff0c\u4e0b\u6b21\u8865\u591a\u4e00\u70b9\u3002\u4e5f\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u53c2\u4e0epity\u7684\u8ba8\u8bba\u4e4b\u4e2d\u5440~","title":"119.\u4f18\u5316\u6d4b\u8bd5\u62a5\u544a"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28119%29%20%E4%BC%98%E5%8C%96%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A/#_1","text":"\u4e0a\u4e00\u8282\u6211\u4eec \u4f18\u5316\u4e86 \u8fd4\u56de\u503c\u76f8\u5173\u7684\u5185\u5bb9\uff0c\u4eca\u5929\u6211\u4eec\u5c31\u987a\u85e4\u6478\u74dc\uff0c\u4ee5\u4e00\u4e2a\u4ea7\u54c1\u7ecf\u7406\u7684\u89d2\u8272\uff0c\u6765\u627e\u627e\u81ea\u5df1\u7684\u95ee\u9898\u3002 \u5176\u5b9e\u5f88\u591a\u65f6\u5019\u90fd\u662f\u5f53\u5c40\u8005\u8ff7\uff0c\u6240\u4ee5\u5982\u679c\u5404\u4f4d\u6709\u5174\u8da3\uff0c\u4e5f\u53ef\u4ee5\u53c2\u4e0e\u5230 \u9700\u6c42\u6536\u96c6 \u7684\u8fc7\u7a0b\u4e2d\u6765\u3002\u8fd9\u91cc\u611f\u8c22\u5927\u5bb6\u63d0\u51fa\u7684\u4e00\u4e9b\u5efa\u8bae\uff0c\u6211\u90fd\u6709\u8bb0\u5f55\u3002 \u53ef\u4ee5\u770b\u5230\uff0c\u9700\u6c42\u8fd8\u662f\u633a\u591a\u7684\u3002\u7531\u4e8e\u90fd\u662f\u79c1\u4e0b\u62bd\u65f6\u95f4\u6765\u5199\uff0c\u6240\u4ee5\u6548\u7387\u6bd4\u8f83\u4f4e\u3002\u4eca\u5929\u6211\u4eec\u5c31\u6765\u5b8c\u6210\u8fd9\u4e2a\u5c0f\u529f\u80fd\u70b9: \u6d4b\u8bd5\u62a5\u544a\u8df3\u8f6c\u5230\u5bf9\u5e94\u7684case\u3002","title":"\u56de\u987e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28119%29%20%E4%BC%98%E5%8C%96%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A/#_2","text":"\u5728\u505a\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u634b\u4e00\u634b\u5982\u4eca\u7684\u60c5\u51b5\u3002\u6211\u4eec\u7684\u7528\u4f8b\u662f\u6709\u4e00\u4e2a\u552f\u4e00\u7684id\u7684\uff0c\u4f46\u7531\u4e8e \u5386\u53f2\u539f\u56e0 \uff0c\u5f53\u521d\u8bbe\u8ba1\u7684\u65f6\u5019\u5728\u7528\u4f8b\u7684url\u52a0\u4e0a\u4e86\u7528\u4f8b\u76ee\u5f55id\uff08\u8fd9\u4e2a\u662f\u501f\u9274\u7684yapi\uff09\u3002 \u4e4b\u6240\u4ee5\u4eba\u5bb6\u8fd9\u4e48\u505a\uff0c\u662f\u4e3a\u4e86\u80fd\u5728url\u91cc\u9762\u76f4\u63a5\u5feb\u901f\u627e\u5230\u5bf9\u5e94\u7684\u76ee\u5f55\uff0c\u5e76\u4e14\u4ed6\u4eec\u7684\u76ee\u5f55\u9700\u8981\u652f\u6301 url\u8bbf\u95ee \u3002\u4f46\u6211\u4eec\u5982\u4eca\u662f\u4e0d\u80fd\u505a\u5230\u8fd9\u4e2a\u6548\u679c\u7684\uff0c\u4e3e\u4e2a\u4f8b\u5b50: \u4e0d\u7ba1\u6211\u4eec\u5982\u4f55 \u5207\u6362 \u5de6\u4fa7\u7684\u76ee\u5f55\uff0curl\u90fd\u4e0d\u4f1a\u53d8\u5316\uff0c\u4f46yapi\u662f\u652f\u6301\u7684\uff0c\u5b83\u5207\u6362\u76ee\u5f55\u7684\u65f6\u5019\uff0c\u5bf9\u5e94\u7684url\u4e5f\u4f1a\u53d1\u751f\u53d8\u5316\u3002 \u6211\u4eec\u518d\u6765\u770b\u770b\u6211\u4eec\u7684\u7528\u4f8b\u7684url: \u76ee\u524d\u662f\u6839\u636e\u76ee\u5f55id/\u7528\u4f8bid\u6765\u786e\u5b9a\u6570\u636e\u7684\uff0c\u4f46\u7531\u4e8e\u6211\u4eec \u6d4b\u8bd5\u62a5\u544a \u91cc\u5934\u53ea\u5b58\u50a8\u4e86 \u7528\u4f8bid \uff0c\u5e76\u6ca1\u6709\u5b58\u50a8\u76ee\u5f55id\uff0c\u6240\u4ee5\u5bfc\u81f4\u6211\u4eec\u6682\u65f6\u65e0\u6cd5\u8df3\u8f6c\u5230\u5177\u4f53\u7684\u7528\u4f8b\u9875\u9762: \u8fd9\u5c31\u5f88\u5c34\u5c2c\u4e86\uff0c\u601d\u8003\u4e86\u4e00\u6bb5\u65f6\u95f4\u4ee5\u540e\uff0c\u6211\u672c\u6765\u6253\u7b97 \u53bb\u6389 url\u91cc\u9762\u7684\u76ee\u5f55id\uff0c\u4f46\u6211\u53c8\u53d1\u73b0\uff0c\u65b0\u589e\u6d4b\u8bd5\u7528\u4f8b\u65f6\uff0c\u5b83\u5f52\u5c5e\u4e8e \u54ea\u4e2a \u76ee\u5f55\uff0c\u6211\u662f\u8bb0\u5f55\u5728url\u91cc\u9762\u7684\uff0c\u6240\u4ee5\u8fd9\u5c31\u5f88\u5c34\u5c2c\u4e86\u3002\u90a3\u5c31\u6682\u65f6\u4e0d\u53bb\u5427\uff0c\u6211\u4eec\u6362\u4e2a\u601d\u8def\uff0c\u83b7\u53d6\u6d4b\u8bd5\u62a5\u544a\u6570\u636e\u7684\u65f6\u5019\uff0c\u6211\u4eec\u628a\u7528\u4f8b\u76ee\u5f55 \u4e00\u5e76 \u67e5\u51fa\u6765\u3002","title":"\u5386\u53f2\u539f\u56e0"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28119%29%20%E4%BC%98%E5%8C%96%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A/#_3","text":"\u4fee\u6539\u62a5\u544a\u67e5\u8be2\u65b9\u6cd5\uff0c\u6ce8\u610f\uff0c\u8fd9\u91cc\u4f7f\u7528\u4e86join\u67e5\u8be2\uff0c\u5c06TestCase\u7684directory_id\u4e5f\u67e5\u4e86\u51fa\u6765\uff0c\u7531\u4e8esqlalchemy\u7684join\u7ed3\u679c\u662f\u5206\u5f00\u7684\uff0c\u4e0d\u662f\u5728\u4e00\u4e2amodel\u5bf9\u8c61\u91cc\u9762\uff0c\u6211\u4eec\u6765\u770b\u770b.all()\u8fd4\u56de\u4e86\u4ec0\u4e48\u3002 \u53ef\u4ee5\u770b\u51fa\u7684\u662f\uff0c\u5b83\u662f\u4e00\u4e2a \u5143\u7956 \uff0c\u4e5f\u5c31\u662f\u8fd9\u6837\u7684\u6570\u636e: [(PityTestResult, directory_id)] \u6240\u4ee5\u6211\u4eec\u624d\u9700\u8981\u628a\u5b83\u904d\u5386\u5e76\u62c6\u5f00\uff0c\u4f46\u662f\u7531\u4e8eTestResult\u91cc\u9762\u53c8\u6ca1\u6709directory_id\u5b57\u6bb5\uff0c\u90a3\u8be5\u548b\u6574\u5462\uff1f\u6240\u4ee5\u6211\u4eec\u8fd8\u9700\u8981\u4fee\u6539\u4e0b\u8fd9\u4e2amodel: \u6211\u4eec\u5728PityTestResult\u5bf9\u8c61\u91cc\u9762\u591a\u52a0\u4e00\u4e2a directory_id \u5b57\u6bb5\uff0c\u53ea\u8981\u4e0d\u662fColumn\u7c7b\u578b\u7684\uff0c\u5bf9\u6570\u636e\u5e93\u5c31\u4e0d\u4f1a\u6709\u5f71\u54cd\uff0c\u4e5f\u5c31\u662f\u8bf4\u6570\u636e\u5e93\u4e0d\u4f1a\u6620\u5c04\u8fd9\u4e2a \u5b57\u6bb5 \u3002 \u6700\u540e\u6211\u4eec\u628a\u67e5\u51fa\u6765\u7684directory_id\u91cd\u65b0\u8d4b\u4e88\u8fd9\u4e2a\u5bf9\u8c61\u5373\u53ef\u3002 \u6765\u770b\u770b\u7ed3\u679c: \u53ef\u4ee5\u770b\u5230\u91cc\u9762\u5df2\u7ecf\u6709directory_id\u4e86\uff0c\u8bf4\u660e\u67e5\u8be2\u6210\u4e86\uff0c\u63a5\u7740\u6211\u4eec\u5c31\u53bb\u4fee\u6539\u524d\u7aef\u4ee3\u7801\u3002","title":"\u4fee\u6539\u62a5\u544a\u67e5\u8be2\u65b9\u6cd5"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28119%29%20%E4%BC%98%E5%8C%96%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A/#_4","text":"\u770b\u770b\u6548\u679c: \u4eca\u5929\u7684\u5185\u5bb9\u6bd4\u8f83\u7b80\u77ed\uff0c\u4e3b\u8981\u662f\u56e0\u4e3a\u535a\u4e3b\u6700\u8fd1\u6838\u9178\u62bd\u4e86\u4e0d\u5c11\uff0c\u4e0b\u6b21\u8865\u591a\u4e00\u70b9\u3002\u4e5f\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u53c2\u4e0epity\u7684\u8ba8\u8bba\u4e4b\u4e2d\u5440~","title":"\u4fee\u6539\u524d\u7aef\u4ee3\u7801"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2812%29%20%E7%BC%96%E5%86%99%E7%B1%BBpostman%E9%A1%B5%E9%9D%A2%281%29/","text":"\u7f16\u5199\u7c7bpostman\u9875\u9762(1) \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u5df2\u7ecf\u7f16\u5199\u597d\u4e86requests\u8bf7\u6c42\u76f8\u5173\u7684\u65b9\u6cd5\uff0c\u90a3\u4e48\u73b0\u5728\u6211\u4eec\u5c31\u628a\u5b83\u8d4b\u80fd\u5230\u524d\u7aef\u3002 \u8fd8\u8bb0\u5f97\u4e4b\u524d\u8bf4\u8fc7\u5bf9 \u8bf7\u6c42\u53c2\u6570 \u505a\u6821\u9a8c\u7684\u4e8b\u60c5\u5417\uff0c\u6070\u597d\u4eca\u5929\u9762\u8bd5\u67d0\u6f6e\u978bapp\u7684\u65f6\u5019\u9762\u8bd5\u5b98\u95ee\u5230\u4e86\u6211\uff0c\u54c8\u54c8\u6211\u4e5f\u7ed9\u4e0d\u51fa\u7b54\u6848\uff0c\u9762\u8bd5\u5b98\u63a8\u8350\u4e86\u4e00\u6b3e\u53eb pydantic \u7684\u5de5\u5177\uff0c\u540e\u9762\u6709\u7a7a\u6211\u53bb\u8bd5\u8bd5\u770b\u3002 \u5f00\u59cb\u7f16\u5199\u6211\u4eec\u7684\u7b2c\u4e00\u4e2a\u9875\u9762 ps: \u6709\u6761\u4ef6\u7684\u5efa\u8bae\u5f042\u4e2a\u5c4f\u5e55\uff0c\u8fd9\u6837\u5f00\u53d1\u6548\u7387\u66f4\u9ad8\uff0c\u56e0\u4e3a\u4f60\u5728\u5199\u6837\u5f0f\uff0c\u90a3\u8fb9\u4e5f\u8ddf\u7740\u5728\u66f4\u65b0\u3002 \u8fd9\u91cc\u6211\u8fd8\u6ca1\u6709\u89c4\u5212\u597d\u5177\u4f53\u7684\u9875\u9762\u5185\u5bb9\uff0c\u6240\u4ee5\u5f04\u4e00\u4e2a\u8c03\u8bd5\u9875\u9762\uff0c\u4e13\u95e8\u7528\u6765\u53d1\u9001http\u8bf7\u6c42\uff0c\u540e\u7eed\u53ef\u80fd\u4f1a\u9690\u85cf\u6389\u3002 \u65b0\u5efa src/pages/Request.jsx import React from 'react' ; export default () => { return ( < div > \u4e34\u65f6\u7528 </ div > ); } \u4fee\u6539 config/routes.js \u76ee\u7684\u662f\u4e3a\u4e86\u628a\u6211\u4eec\u521a\u624d\u7684\u9875\u9762\u663e\u793a\u51fa\u6765 \u8fd9\u6bb5\u4ee3\u7801\u7684\u610f\u601d\u662f\uff0c\u52a0\u4e00\u4e2a\u8def\u5f84\u4e3a/request\u7684\u9875\u9762\uff0c\u5e76\u4e14\u8fd9\u4e2a\u9875\u9762\u6620\u5c04\u7684 \u7ec4\u4ef6 \u662f\u6211\u4eec\u521a\u624d\u7f16\u5199\u7684 Request.jsx \u3002 \u5f00\u59cb\u7f16\u5199\u6211\u4eec\u7684\u7b2c\u4e00\u4e2a\u7ec4\u4ef6 \u65b0\u5efa src/components/Postman/Postman.jsx \u6587\u4ef6\uff0c\u6ce8\u610f\u8fd9\u91cc\u662f jsx \u540e\u7f00\u3002 \u54b1\u4eec\u5148\u5f15\u5165 antd \u91cc\u9762\u7684 Card \u7ec4\u4ef6\u3002 import {Card} from 'antd' ; \u5148\u628a\u7ec4\u4ef6\u67b6\u5b50\u642d\u597d: import React from 'react' ; import { Card } from 'antd' ; export default () => { return ( < Card > </ Card > ); } \u8fd9\u91cc\u6211\u4eec\u6539\u53d8\u7684\u662fpostman\u7ec4\u4ef6\uff0c\u8fd8\u8bb0\u5f97\u521a\u624d\u6709\u4e2aRequest.jsx\u5417\uff1f\u6211\u4eec\u9700\u8981\u505a\u4e00\u6b21 \u5d4c\u5957\u64cd\u4f5c \uff0c\u56e0\u4e3a react \u662f\u652f\u6301\u7ec4\u4ef6\u4e4b\u95f4\u5d4c\u5957\u7684\u3002 \u8c03\u6574\u521a\u624d\u7684 pages/Request.jsx import React from 'react' ; import Postman from '@/components/Postman/Postman' ; export default () => { return ( < Postman /> ); } \u505a\u7684\u4e8b\u60c5\u5f88\u7b80\u5355\uff0c\u5c31\u662f\u50cf\u6211\u4eec\u5f15\u5165 Card \u4e00\u6837\uff0c\u5f15\u5165postman\uff0c\u6d4f\u89c8\u5668\u8fd9\u65f6\u5019\u5df2\u7ecf\u81ea\u52a8\u6e32\u67d3\u597d\u4e86\uff0c\u6211\u4eec\u6765\u770b\u770b: \u53ef\u4ee5\u770b\u5230\u591a\u4e86\u4e00\u4e9b\u7a7a\u767d\u7684\u767d\u6761 \u6ca1\u9519\uff0c\u4e0a\u9762\u7684\u56fe\u7247\u5c31\u662f\u4e00\u4e2a \u7a7a\u7684\u5361\u7247 \uff0c\u6211\u4eec\u9700\u8981\u5728\u5361\u7247\u91cc\u9762\u63cf\u7ed8\u51fa\u6211\u4eec\u7684postman\u3002 \u7814\u7a76\u4e00\u4e0bpostman\u7684\u6784\u9020 \u5355\u7eaf\u770b\u8fd9\u4e2a\u8bf7\u6c42\u9875\u9762\uff0c\u4ed6\u662f\u91c7\u7528\u7684\u4e0a\u4e0b\u7ed3\u6784\uff0c\u5171\u6709\u56db\u5c42\uff0c\u5206\u522b\u662f: url\u5c42\uff0c\u6807\u7b7e\u680f\uff0c\u6807\u7b7e\u5bf9\u5e94\u5185\u5bb9\u548cresponse\u5c42\u3002 \u5982\u679c\u8ba9\u6211\u53bb\u624b\u52a8\u5199\u7684\u8bdd\u5462\uff0c\u6211\u786e\u5b9e\u5199\u4e0d\u51fa\u6765\uff0c\u4e0d\u8fc7\u6211\u6709 Ant Design \u8fd9\u4e2a\u6cd5\u5b9d\u3002 \u5c1d\u8bd5\u7f16\u5199\u7b2c\u4e00\u5c42 \u6211\u60f3\u8bf4\uff0c\u521a\u624dpostman\u5f39\u51fa\u66f4\u65b0\uff0c\u6211\u7684\u9875\u9762\u53c8\u53d8\u4e86\uff0c\u6ca1\u5173\u7cfb\uff0c\u6309\u65b0\u7684\u6765\u5427: \u65b0\u7248postman \u6211\u4eec\u9996\u5148\u5f15\u5165Row, Col2\u4e2a\u7ec4\u4ef6\uff0c\u8fd92\u4e2a\u7ec4\u4ef6\u7c7b\u4f3c\u4e8ebootstrap\u7684\u6805\u683c\u7cfb\u7edf\uff0cCol\u7684\u8bdd\u4f1a\u628a\u5bbd\u5ea6\u5206\u4e3a24\u4efd\uff0c\u6211\u8fd9\u91cc\u7684\u610f\u601d\u662f\u5de6\u4fa7\u5206\u51fa20\u4efd\u7528\u6765\u5b58\u653e url \uff0c\u53f3\u4fa74\u4efd\u7528\u6765\u5b58\u653e Send \u5176\u4e2d\u4ed6\u4eec\u4e4b\u95f4\u7684\u95f4\u8ddd\u7528 gutter \u53c2\u6570\u5b8c\u6210: \u4e0a\u4e0b\u5de6\u53f3\u95f4\u8ddd8px \u7f16\u5199\u8f93\u5165\u6846 \u6253\u5f00 ant design \u7f51\u7ad9\uff0c\u627e\u5230\u6700\u5408\u9002\u7684\u8f93\u5165\u6846: \u5c31\u662f\u4f60\u4e86\uff0c\u76ae\u5361\u4e18!\u8fdb\u53bb\u67e5\u770b\u4ed6\u7684\u6e90\u4ee3\u7801: \u8fd9\u4e2a\u6309\u94ae: \u590d\u5236\u51fa\u8fd9\u6bb5\u4ee3\u7801: <Input addonBefore={selectBefore} addonAfter={selectAfter} defaultValue= \"mysite\" /> \u53ef\u4ee5\u770b\u5230\uff0c3\u5904\u7ea2\u65d7\u98d8\u98d8\uff01\u90a3\u4e48\u6211\u4eec\u6765\u4e00\u4e2a\u4e2a\u770b\u95ee\u9898\u3002 Input\u7ec4\u4ef6\u6211\u4eec\u6ca1\u6709import selectBefore\u53d8\u91cf\u6211\u4eec\u6ca1\u6709\u5b9a\u4e49 selectAfter\u6211\u4eec\u4e5f\u6ca1\u6709\u5b9a\u4e49\uff0c\u4f46\u662f\u7531\u4e8e\u6211\u4eec\u4e0d\u9700\u8981\u540e\u7f00\uff0c\u6240\u4ee5\u76f4\u63a5\u5220\u9664\u5373\u53ef 1\u548c3\u90fd\u5df2\u7ecf\u89e3\u51b3\uff0c\u63a5\u7740\u6211\u4eec\u7ee7\u7eed\u53bb\u590d\u5236selectBefore const selectBefore = ( < Select defaultValue = \"http://\" className = \"select-before\" > < Option value = \"http://\" > http:// </ Option > < Option value = \"https://\" > https:// </ Option > </ Select > ); \u53ef\u4ee5\u770b\u5230\u8fd92\u5904\u53c8\u98d8\u7ea2\uff0c\u5176\u5b9e\u662f\u6211\u4eec\u6ca1\u6709\u590d\u5236\u5b8c\u5168: \u8865\u5168\u540e \u6211\u4eec\u6765\u770b\u770b\u9875\u9762\u7684\u663e\u793a\u6548\u679c: \u662f\u4e0d\u662f\u611f\u89c9\u9ad8\u5ea6\u5c11\u4e86\uff0c\u5bbd\u5ea6\u53c8\u592a\u5bbd\u4e86\uff1f\u90a3\u6211\u4eec\u7a0d\u4f5c\u8c03\u6574: \u6211\u4eec\u628a\u5360\u7684\u5bbd\u5ea6\u6539\u4e3a18\uff0csize\u6539\u6210large\uff0c\u662f\u4e0d\u662f\u770b\u7740\u4f1a\u597d\u4e00\u4e9b\u4e86\u3002 \u63a5\u7740\u6211\u4eec\u53bb\u7f16\u5199Send\u6309\u94ae \u4e5f\u662f\u7c7b\u4f3c\uff0c\u53bbAnt design\u5b98\u7f51\u627e\u4e00\u4e2a\u6700\u5408\u9002\u7684\u7ec4\u4ef6\uff0c\u8fd9\u91cc\u6211\u5c31\u4e0d\u91cd\u590d\u8fd9\u4e2a\u6b65\u9aa4\u4e86\uff0c\u56e0\u4e3a\u6211\u719f\u8bb0\u4e86\u8fd9\u4e9b\u7ec4\u4ef6\u7684api\uff0c\u6240\u4ee5\u6211\u53ef\u4ee5\u76f4\u63a5\u5199\u51fa\u6765: \u770b\u770b\u5b9e\u9645\u6548\u679c: \u7b2c\u4e00\u5c42\u7684UI\u57fa\u672c\u4e0a\u5c31\u7f16\u5199\u5b8c\u6210\u4e86 \u4f46\u662f\u4e2a\u4eba\u4e0d\u662f\u592a\u559c\u6b22\u8fd9\u79cd\u65b9\u6b63\u7684\u8fb9\u6846\uff0c\u8fd8\u662f\u4e60\u60ef\u4ee5\u524d\u7684antd\uff0c\u6240\u4ee5\u6211\u53bb\u8bbe\u7f6e\u91cc\u9762\u6539\u4e00\u4e0b\u5706\u89d2: \u6700\u540e\u6211\u4eec\u7ed9Send\u52a0\u4e00\u4e2a\u5e05\u6c14\u7684 \u56fe\u6807 : \u8bb0\u5f97\u56fe\u6807\u4e5f\u662f\u9700\u8981\u5bfc\u5165\u7684\u54c8\uff01\u770b\u770b\u6548\u679c: \u597d\u4e86\uff0c\u4eca\u5929\u7684\u5185\u5bb9\u5c31\u5230\u8fd9\u91cc\u4e86\u3002\u4e3b\u8981\u662f\u8fb9\u622a\u56fe\u8fb9\u5199\u8fd8\u662f\u86ee\u8d39\u65f6\u95f4\u7684\uff0c\u540e\u7eed\u4f1a\u52a0\u5feb\u8fdb\u5ea6\u3002\u5982\u679c\u60f3\u5b66\u7684\u670b\u53cb\uff0c\u53ef\u4ee5\u6309\u7167\u6211\u4e4b\u524d\u7ed9\u7684react\u5b66\u4e60\u6559\u7a0b\u53bb\u770b\u770b\u5bf9\u5e94\u7684\u77e5\u8bc6\uff0c\u8fd8\u9700\u8bfe\u4e0b\u591a\u52aa\u529b\u5440\u3002 \u5e7f\u544a\u65f6\u95f4 \u540e\u7aef\u4ee3\u7801\u5730\u5740: https://github.com/wuranxu/pity \u524d\u7aef\u4ee3\u7801\u5730\u5740: https://github.com/wuranxu/pityWeb \u6b22\u8fce\u5173\u6ce8\u516c\u4f17\u53f7 \u6d4b\u8bd5\u5f00\u53d1\u5165\u5751 \uff0c\u8fd8\u6709\u52a0\u7fa4\u4e00\u8d77\u8ba8\u8bba\u76f8\u5173\u95ee\u9898\u5440\uff01\u5982\u679c\u7fa4\u4e8c\u7ef4\u7801\u8fc7\u671f\u4e86\uff0c\u53ef\u4ee5\u52a0\u6211\u4e2a\u4eba\u5fae\u4fe1: wuranxu \u6211\u62c9\u4f60\u8fdb\u7fa4~","title":"12.\u7f16\u5199\u7c7bpostman\u9875\u9762(1)"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28120%29%20%E4%BF%AE%E5%A4%8D%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3%E6%89%93%E4%B8%8D%E5%BC%80%E7%9A%84bug/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u4e00\u8d77\u4ea4\u6d41\u5b66\u4e60! \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u4f18\u5316\u4e86\u4e0b \u6d4b\u8bd5\u62a5\u544a \u7684\u5185\u5bb9\u3002\u8fd9\u4e00\u8282\u6211\u4eec\u6765\u89e3\u51b3\u4e00\u4e2a\u7531\u6765\u5df2\u4e45\u7684\u5386\u53f2bug\uff0c\u987a\u4fbf\u5f04\u6e05\u695a\u4e00\u4e0bFastApi\u7684\u542f\u52a8\u673a\u5236\u3002 \u672c\u7bc7\u5185\u5bb9\u5e72\u8d27\u6ee1\u6ee1\uff0c\u5e0c\u671b\u5927\u5bb6\u53ef\u4ee5\u8010\u5fc3\u770b\u5b8c\uff0c\u7136\u540e\u7ed9\u4f5c\u8005\u4e00\u4e2a\u5927\u5927\u7684\u62e5\u62b1\u3002 \u73b0\u8c61 \u6709\u540c\u5b66\u53cd\u9988\u8bf4 \u672c\u5730\u542f\u52a8\u670d\u52a1 \u7684\u65f6\u5019\uff0c\u63a5\u53e3\u6587\u6863\u9875\u9762\u6253\u4e0d\u5f00, \u5176\u5b9e\u8fd9\u4e2a\u95ee\u9898\u6211\u4e5f\u8001\u65e9\u5c31\u77e5\u9053\u4e86: \u770b\u8d77\u6765\u662f\u89e3\u6790\u63a5\u53e3\u6587\u6863\u7684\u65f6\u5019\u9047\u5230\u4e86\u95ee\u9898\uff0c\u4e0b\u9762\u6765\u8bf4\u8bf4\u6211\u7684 \u6392\u67e5\u601d\u8def \u3002 1. \u627e\u5230\u5168\u5c40\u6dfb\u52a0\u7684\u5f02\u5e38 \u6211\u4eec\u627e\u5230\u5168\u5c40\u6dfb\u52a0\u7684http \u5f02\u5e38\u4e2d\u95f4\u4ef6 \uff0c\u5728\u91cc\u9762\u6253\u5370\u8be6\u7ec6\u7684\u5806\u6808\u4fe1\u606f: app\\__init__.py\u6587\u4ef6 @pity . middleware ( \"http\" ) async def errors_handling ( request : Request , call_next ): body = await request . body () try : await set_body ( request , await request . body ()) return await call_next ( request ) except Exception as exc : import traceback # \u52a0\u4e0atraceback,\u6253\u5370\u51fa\u8be6\u7ec6\u7684\u5806\u6808\u4fe1\u606f traceback . print_exc () return JSONResponse ( status_code = status . HTTP_200_OK , content = jsonable_encoder ({ \"code\" : 110 , \"msg\" : str ( exc ), \"request_data\" : body , }) ) \u7136\u540e\u518d\u6b21\u8bf7\u6c42\u67e5\u770b\uff0c\u53d1\u73b0\u6709\u5177\u4f53\u7684\u62a5\u9519\u4fe1\u606f\u4e86: \u63d0\u793a\u4e86\u6211\u4eeckey error\uff0c\u8fd9\u770b\u8d77\u6765\u4e0d\u662f\u6211\u4eec\u7684\u4ee3\u7801\uff0c\u5176\u5b9e\u8fd9\u4e2a\u662f\u89e3\u6790\u4f60\u7684\u6240\u6709\u8def\u7531\u91cc\u9762\u8bf7\u6c42model\u7684\u65b9\u6cd5\uff0c\u6211\u4eec\u6df1\u5165\u53bb\u67e5\u770b\u4e00\u4e0b: \u4e5f\u5c31\u662f\u8fd9\u4e00\u6b65\uff0ckey error\u4e86\uff0c\u56e0\u4e3a\u4ed6\u7528\u7684\u662f[]\u800c\u4e0d\u662f.get\uff0c\u4e5f\u6ca1\u6709\u4efb\u4f55 \u515c\u5e95 \u7684\u64cd\u4f5c\u3002\u90a3\u6211\u4eec\u770b\u770b\u4e3a\u5565\u4f1aKeyError\uff0c\u6211\u4eecdebug\u4e00\u4e0b: \u5f53model\u91cc\u9762\u6709avatar\u7684\u65f6\u5019\u6211\u4eec\u8fdb\u5165\u65ad\u70b9, \u8ba9\u6211\u4eec\u5c4f\u6c14\u51dd\u795e\uff0c\u518d\u8bd5\u4e00\u6b21: \u53ef\u4ee5\u770b\u5230\uff0c\u65ad\u70b9\u8fdb\u6765\u4e86\u3002\u90a3\u6211\u4eec\u6765\u770b\u770bmodel_name_map\u91cc\u9762\u7684keys: \u53ef\u4ee5\u770b\u5230\uff0c\u91cc\u9762\u5b9e\u9645\u4e0a\u662f\u6709\u8fd9\u4e2a\u6570\u636e\u7684\uff1f\uff08\u60ca\u4e0d\u60ca\u559c\u610f\u4e0d\u610f\u5916\uff09 \u7136\u540e\u6211\u4eec\u8bd5\u4e00\u4e0b\u53d6\u8fd9\u4e2akey: \u679c\u4e0d\u5176\u7136\uff0c\u8fd8\u662f\u62a5\u9519\u3002\u90a3\u6211\u4eec\u5bf9\u6bd4\u4e00\u4e0b2\u4e2akey\uff0c\u6211\u4eec\u770b\u5230\u521a\u624dkey\u7684\u7d22\u5f15\u662f16\uff0c\u6211\u4eec\u62c9\u51fa\u6765\u5bf9\u6bd4\u4e0b: \u8fd92\u4e2aclass\uff0c\u770b\u8d77\u6765\u662f\u4e00\u4e1d\u4e0d\u5dee\uff0c\u7ed9\u6211\u4e5f\u6574\u61f5\u903c\u4e86\u3002 \u7b49\u7b49\uff0c\u4ed6\u8fd9\u4e2akey\u662fclass\u5bf9\u8c61\uff0c\u4e0d\u540c\u7684\u5bf9\u8c61\u505akey\u7684\u8bdd\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u53d6\u4e0d\u5230\u54e6\u3002\u7b80\u5355\u7684\u8bf4\u5c31\u662fmap\u91cc\u9762\u7684key \uff01= model\u3002 \u6240\u4ee5\u6211\u4eec\u8981\u8003\u8651\u4e0b\u4e3a\u4ec0\u4e48key\u4e0d\u7b49\u4e8emodel\uff0c\u4e8e\u662f\u6211\u4eec\u5f00\u59cb\u7b2c\u4e8c\u6b65\u6392\u67e5\u3002 2. \u627e\u627emap\u751f\u6210\u7684\u5730\u65b9 \u6211\u4eec\u8bd5\u7740\u627e\u4e0bmap\u751f\u6210\u7684\u5730\u65b9\uff0c\u770b\u770b\u5b83\u7684key-value\u662f\u600e\u4e48\u5199\u8fdb\u53bb\u7684\uff01 \u6839\u636e\u5806\u6808\u4e00\u8def\u627e\uff0c\u53ef\u4ee5\u770b\u5230\u4ed6\u662f\u6839\u636eflat_models\u89e3\u6790\u51fa\u7684map\uff0c\u6211\u4eec\u770b\u770bflat_models\uff1a \u773c\u75be\u624b\u5feb\u7684\u6211\u4eec\uff0c\u53d1\u73b0\u8fd9\u4e2a flat_models \u91cc\u9762\u5c45\u7136\u67092\u4e2a\u4e00\u6bdb\u4e00\u6837\u7684model\uff0c\u90a3\u5c31\u53ef\u4ee5\u89e3\u91ca\u4e86\uff0ckey-value\u80af\u5b9a\u662f\u7528\u7684\u540e\u9762\u7684\u90a3\u6761\u6570\u636e\u4f5c\u4e3akey\uff0c\u800c\u6211\u4eec\u8bd5\u7740\u53d6\u524d\u9762\u90a3\u6761\u6570\u636e\u3002 \u6240\u4ee5\u771f\u76f8\u53ea\u6709\u4e00\u4e2a\uff1a\u6211\u4eec\u8fd9\u4e2a\u6570\u636e\u91cd\u590d\u4e86\u3002 3. \u662f\u4e0d\u662f\u63a5\u53e3\u4e0d\u5c0f\u5fc3\u6ce8\u518c\u4e862\u6b21\u5bfc\u81f4\uff1f \u4ed4\u7ec6\u67e5\u770b\u4ee3\u7801\uff0c\u53d1\u73b0\u5e76\u6ca1\u67092\u4efd\u4e00\u6837\u7684\u63a5\u53e3\u3002\u90a3\u4f1a\u4e0d\u4f1a\u662f\u8def\u7531\u91cd\u590d\u6ce8\u518c\u4e86\uff1f\u90a3\u4e3a\u4ec0\u4e48\u5176\u4ed6\u7684schema\u6ca1\u6709\u91cd\u590d\u6ce8\u518c\u5462\uff1f \u6211\u4eec\u6765debug\u4e00\u4e0b\uff0c\u8fd9\u6b21\uff0c\u6211\u4eec\u597d\u597d\u6765\uff0c\u770broutes\u90e8\u5206: \u770b\u5230route\u6709208\u4e2a\uff0c\u6211\u4eec\u5e94\u8be5\u6ca1\u6709\u8fd9\u4e48\u591a\u63a5\u53e3\u624d\u5bf9\u5440\uff1f\u8fd9\u4e2a\u6a21\u5f0f\u4e0d\u592a\u597d\u770b\uff0c\u6211\u4eec\u5199\u4e2a\u5217\u8868\u63a8\u5bfc\u5f0fsee see: auth\u63a5\u53e3\u5728\u524d\u5217\uff0c\u6211\u4eec\u7ee7\u7eed\u5f80\u4e0b\u627e\u627e: \u53d1\u73b0\u8fd9\u4e9b\u63a5\u53e3\u53c8\u6ce8\u518c\u4e86\u4e00\u904d\uff0c\u597d\u5bb6\u4f19\uff0c\u95ee\u9898\u6839\u6e90\u627e\u5230\u4e86\uff0c\u63a5\u53e3\u6ce8\u518c\u4e862\u6b21\uff0c\u6240\u6709\u7684\u90fd\u662f\u3002 4. \u4e3a\u4ec0\u4e48\u63a5\u53e3\u6ce8\u518c\u4e862\u6b21\u5462\uff1f \u56de\u60f3\u4e00\u4e0b\u6211\u4eec\u542f\u52a8app\u7684\u65f6\u5019\uff0c\u770b\u770b\u63a7\u5236\u53f0: \u6211\u4eec\u6ca1\u6709\u5f00\u591a\u4e2aworkers\uff0c\u4f46pity is running at pro \u88ab\u6267\u884c\u4e862\u6b21\uff0c\u6211\u4eec\u627e\u627e\u9879\u76ee\u91cc\u9762\u7684\u8fd9\u5757\u4ee3\u7801: \u600e\u4e48\u641c\u4e5f\u624d\u51fa\u73b01\u6b21\uff0c\u8fd9\u53ef\u5c34\u5c2c\u4e86\u3002\u4e8e\u662f\u6211\u4eec\u4eb2\u624b\u5728include_router\u90a3\u91cc\u6253\u4e2a\u65ad\u70b9\uff0c\u770b\u5230\u5e95\u4f1a\u4e0d\u4f1a\u6267\u884c2\u6b21\u3002 \u6211\u4eec\u6309F9\uff0c\u7ee7\u7eed\u8c03\u8bd5\u4ee3\u7801 \u53d1\u73b0\u65ad\u70b9\u53c8\u751f\u6548\u4e86\uff0c\u4e0b\u9762\u7684\u65e5\u5fd7\u4e5f\u6253\u5370\u4e862\u6b21\u3002\u8bc1\u660e\u6211\u4eec\u7684\u731c\u60f3\u6ca1\u9519\u3002 5. \u6c42\u52a9 \u8fd9\u65f6\u5019\u62ff\u51fa\u5404\u79cd\u641c\u7d22\u5de5\u5177\u4e00\u901a\u641c\u7d22\uff0c\u7ec8\u4e8e\u53d1\u73b0\u4e86\u8fd9\u4e48\u4e2a \u5730\u5740 : \u4ed6\u8bf4\u4ed6\u6bcf\u6b21\u90fd\u6267\u884c3\u6b21\uff08\u597d\u5bb6\u4f19\uff0c\u6bd4\u6211\u8fd8\u5938\u5f20\uff09\uff0c\u6211\u4eec\u6765\u770b\u770b\u522b\u4eba\u7684\u7b54\u590d: \u7b80\u5355\u7684\u8bf4\u5c31\u662f\uff0c\u6211\u4eec\u6267\u884cmain.py\uff0c\u5728\u5230\u8fbe__main__\u4ee3\u7801\u5757\u4e4b\u524d\uff0cinclude\u5df2\u7ecf\u6267\u884c\u4e00\u6b21\u4e86\uff0c\u63a5\u7740\u6211\u4eec\u8c03\u7528\u7684\u662f: \u5b83\u53c8\u4f1a\u4ecemain.py\u8d70\u4e00\u906d\uff0c\u4e5f\u5c31\u662f\u7b2c\u4e8c\u6b21\u6267\u884c\u3002\u89e3\u51b3\u65b9\u6848\u5f88\u7b80\u5355\uff0c\u6211\u4eec\u7684\u542f\u52a8\u6587\u4ef6\u4e0d\u80fd\u653e\u8fd9\u4e9binclude\u7684\u64cd\u4f5c\uff0c\u53ea\u9700\u8981\u7eaf\u7cb9\u5730\u6267\u884c\u4ee3\u7801\u5373\u53ef\u3002 import uvicorn if __name__ == \"__main__\" : uvicorn . run ( \"main:pity\" , host = \"0.0.0.0\" , port = 7777 , reload = False ) \u6240\u4ee5\u6211\u8fd9\u8fb9\u65b0\u5efa\u4e86\u4e00\u4e2arunserver.py\uff0c\u5e76\u4e14\u5199\u5165\u4e86\u4ee5\u4e0a\u4ee3\u7801\uff0c\u6211\u4eec\u6765\u8bd5\u8bd5\u6548\u679c: \u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u5757\u5185\u5bb9\u53ea\u6253\u5370\u4e00\u6b21\u4e86\uff0c\u6211\u4eec\u6700\u540e\u8bd5\u4e0b\u6253\u5f00/docs: \u641e\u5b9a\uff0c\u603b\u4f53\u6765\u8bf4\u82b1\u4e86\u8fd12\u4e2a\u5c0f\u65f6\u6392\u67e5+\u641c\u7d22\u95ee\u9898\uff0c\u4f46\u603b\u5f52\u662f\u503c\u5f97\u7684\uff01","title":"120.\u4fee\u590d\u63a5\u53e3\u6587\u6863\u6253\u4e0d\u5f00\u7684bug"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28120%29%20%E4%BF%AE%E5%A4%8D%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3%E6%89%93%E4%B8%8D%E5%BC%80%E7%9A%84bug/#_1","text":"\u4e0a\u4e00\u8282\u6211\u4eec\u4f18\u5316\u4e86\u4e0b \u6d4b\u8bd5\u62a5\u544a \u7684\u5185\u5bb9\u3002\u8fd9\u4e00\u8282\u6211\u4eec\u6765\u89e3\u51b3\u4e00\u4e2a\u7531\u6765\u5df2\u4e45\u7684\u5386\u53f2bug\uff0c\u987a\u4fbf\u5f04\u6e05\u695a\u4e00\u4e0bFastApi\u7684\u542f\u52a8\u673a\u5236\u3002 \u672c\u7bc7\u5185\u5bb9\u5e72\u8d27\u6ee1\u6ee1\uff0c\u5e0c\u671b\u5927\u5bb6\u53ef\u4ee5\u8010\u5fc3\u770b\u5b8c\uff0c\u7136\u540e\u7ed9\u4f5c\u8005\u4e00\u4e2a\u5927\u5927\u7684\u62e5\u62b1\u3002","title":"\u56de\u987e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28120%29%20%E4%BF%AE%E5%A4%8D%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3%E6%89%93%E4%B8%8D%E5%BC%80%E7%9A%84bug/#_2","text":"\u6709\u540c\u5b66\u53cd\u9988\u8bf4 \u672c\u5730\u542f\u52a8\u670d\u52a1 \u7684\u65f6\u5019\uff0c\u63a5\u53e3\u6587\u6863\u9875\u9762\u6253\u4e0d\u5f00, \u5176\u5b9e\u8fd9\u4e2a\u95ee\u9898\u6211\u4e5f\u8001\u65e9\u5c31\u77e5\u9053\u4e86: \u770b\u8d77\u6765\u662f\u89e3\u6790\u63a5\u53e3\u6587\u6863\u7684\u65f6\u5019\u9047\u5230\u4e86\u95ee\u9898\uff0c\u4e0b\u9762\u6765\u8bf4\u8bf4\u6211\u7684 \u6392\u67e5\u601d\u8def \u3002","title":"\u73b0\u8c61"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28120%29%20%E4%BF%AE%E5%A4%8D%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3%E6%89%93%E4%B8%8D%E5%BC%80%E7%9A%84bug/#1","text":"\u6211\u4eec\u627e\u5230\u5168\u5c40\u6dfb\u52a0\u7684http \u5f02\u5e38\u4e2d\u95f4\u4ef6 \uff0c\u5728\u91cc\u9762\u6253\u5370\u8be6\u7ec6\u7684\u5806\u6808\u4fe1\u606f: app\\__init__.py\u6587\u4ef6 @pity . middleware ( \"http\" ) async def errors_handling ( request : Request , call_next ): body = await request . body () try : await set_body ( request , await request . body ()) return await call_next ( request ) except Exception as exc : import traceback # \u52a0\u4e0atraceback,\u6253\u5370\u51fa\u8be6\u7ec6\u7684\u5806\u6808\u4fe1\u606f traceback . print_exc () return JSONResponse ( status_code = status . HTTP_200_OK , content = jsonable_encoder ({ \"code\" : 110 , \"msg\" : str ( exc ), \"request_data\" : body , }) ) \u7136\u540e\u518d\u6b21\u8bf7\u6c42\u67e5\u770b\uff0c\u53d1\u73b0\u6709\u5177\u4f53\u7684\u62a5\u9519\u4fe1\u606f\u4e86: \u63d0\u793a\u4e86\u6211\u4eeckey error\uff0c\u8fd9\u770b\u8d77\u6765\u4e0d\u662f\u6211\u4eec\u7684\u4ee3\u7801\uff0c\u5176\u5b9e\u8fd9\u4e2a\u662f\u89e3\u6790\u4f60\u7684\u6240\u6709\u8def\u7531\u91cc\u9762\u8bf7\u6c42model\u7684\u65b9\u6cd5\uff0c\u6211\u4eec\u6df1\u5165\u53bb\u67e5\u770b\u4e00\u4e0b: \u4e5f\u5c31\u662f\u8fd9\u4e00\u6b65\uff0ckey error\u4e86\uff0c\u56e0\u4e3a\u4ed6\u7528\u7684\u662f[]\u800c\u4e0d\u662f.get\uff0c\u4e5f\u6ca1\u6709\u4efb\u4f55 \u515c\u5e95 \u7684\u64cd\u4f5c\u3002\u90a3\u6211\u4eec\u770b\u770b\u4e3a\u5565\u4f1aKeyError\uff0c\u6211\u4eecdebug\u4e00\u4e0b: \u5f53model\u91cc\u9762\u6709avatar\u7684\u65f6\u5019\u6211\u4eec\u8fdb\u5165\u65ad\u70b9, \u8ba9\u6211\u4eec\u5c4f\u6c14\u51dd\u795e\uff0c\u518d\u8bd5\u4e00\u6b21: \u53ef\u4ee5\u770b\u5230\uff0c\u65ad\u70b9\u8fdb\u6765\u4e86\u3002\u90a3\u6211\u4eec\u6765\u770b\u770bmodel_name_map\u91cc\u9762\u7684keys: \u53ef\u4ee5\u770b\u5230\uff0c\u91cc\u9762\u5b9e\u9645\u4e0a\u662f\u6709\u8fd9\u4e2a\u6570\u636e\u7684\uff1f\uff08\u60ca\u4e0d\u60ca\u559c\u610f\u4e0d\u610f\u5916\uff09 \u7136\u540e\u6211\u4eec\u8bd5\u4e00\u4e0b\u53d6\u8fd9\u4e2akey: \u679c\u4e0d\u5176\u7136\uff0c\u8fd8\u662f\u62a5\u9519\u3002\u90a3\u6211\u4eec\u5bf9\u6bd4\u4e00\u4e0b2\u4e2akey\uff0c\u6211\u4eec\u770b\u5230\u521a\u624dkey\u7684\u7d22\u5f15\u662f16\uff0c\u6211\u4eec\u62c9\u51fa\u6765\u5bf9\u6bd4\u4e0b: \u8fd92\u4e2aclass\uff0c\u770b\u8d77\u6765\u662f\u4e00\u4e1d\u4e0d\u5dee\uff0c\u7ed9\u6211\u4e5f\u6574\u61f5\u903c\u4e86\u3002 \u7b49\u7b49\uff0c\u4ed6\u8fd9\u4e2akey\u662fclass\u5bf9\u8c61\uff0c\u4e0d\u540c\u7684\u5bf9\u8c61\u505akey\u7684\u8bdd\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u53d6\u4e0d\u5230\u54e6\u3002\u7b80\u5355\u7684\u8bf4\u5c31\u662fmap\u91cc\u9762\u7684key \uff01= model\u3002 \u6240\u4ee5\u6211\u4eec\u8981\u8003\u8651\u4e0b\u4e3a\u4ec0\u4e48key\u4e0d\u7b49\u4e8emodel\uff0c\u4e8e\u662f\u6211\u4eec\u5f00\u59cb\u7b2c\u4e8c\u6b65\u6392\u67e5\u3002","title":"1. \u627e\u5230\u5168\u5c40\u6dfb\u52a0\u7684\u5f02\u5e38"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28120%29%20%E4%BF%AE%E5%A4%8D%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3%E6%89%93%E4%B8%8D%E5%BC%80%E7%9A%84bug/#2-map","text":"\u6211\u4eec\u8bd5\u7740\u627e\u4e0bmap\u751f\u6210\u7684\u5730\u65b9\uff0c\u770b\u770b\u5b83\u7684key-value\u662f\u600e\u4e48\u5199\u8fdb\u53bb\u7684\uff01 \u6839\u636e\u5806\u6808\u4e00\u8def\u627e\uff0c\u53ef\u4ee5\u770b\u5230\u4ed6\u662f\u6839\u636eflat_models\u89e3\u6790\u51fa\u7684map\uff0c\u6211\u4eec\u770b\u770bflat_models\uff1a \u773c\u75be\u624b\u5feb\u7684\u6211\u4eec\uff0c\u53d1\u73b0\u8fd9\u4e2a flat_models \u91cc\u9762\u5c45\u7136\u67092\u4e2a\u4e00\u6bdb\u4e00\u6837\u7684model\uff0c\u90a3\u5c31\u53ef\u4ee5\u89e3\u91ca\u4e86\uff0ckey-value\u80af\u5b9a\u662f\u7528\u7684\u540e\u9762\u7684\u90a3\u6761\u6570\u636e\u4f5c\u4e3akey\uff0c\u800c\u6211\u4eec\u8bd5\u7740\u53d6\u524d\u9762\u90a3\u6761\u6570\u636e\u3002 \u6240\u4ee5\u771f\u76f8\u53ea\u6709\u4e00\u4e2a\uff1a\u6211\u4eec\u8fd9\u4e2a\u6570\u636e\u91cd\u590d\u4e86\u3002","title":"2. \u627e\u627emap\u751f\u6210\u7684\u5730\u65b9"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28120%29%20%E4%BF%AE%E5%A4%8D%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3%E6%89%93%E4%B8%8D%E5%BC%80%E7%9A%84bug/#3-2","text":"\u4ed4\u7ec6\u67e5\u770b\u4ee3\u7801\uff0c\u53d1\u73b0\u5e76\u6ca1\u67092\u4efd\u4e00\u6837\u7684\u63a5\u53e3\u3002\u90a3\u4f1a\u4e0d\u4f1a\u662f\u8def\u7531\u91cd\u590d\u6ce8\u518c\u4e86\uff1f\u90a3\u4e3a\u4ec0\u4e48\u5176\u4ed6\u7684schema\u6ca1\u6709\u91cd\u590d\u6ce8\u518c\u5462\uff1f \u6211\u4eec\u6765debug\u4e00\u4e0b\uff0c\u8fd9\u6b21\uff0c\u6211\u4eec\u597d\u597d\u6765\uff0c\u770broutes\u90e8\u5206: \u770b\u5230route\u6709208\u4e2a\uff0c\u6211\u4eec\u5e94\u8be5\u6ca1\u6709\u8fd9\u4e48\u591a\u63a5\u53e3\u624d\u5bf9\u5440\uff1f\u8fd9\u4e2a\u6a21\u5f0f\u4e0d\u592a\u597d\u770b\uff0c\u6211\u4eec\u5199\u4e2a\u5217\u8868\u63a8\u5bfc\u5f0fsee see: auth\u63a5\u53e3\u5728\u524d\u5217\uff0c\u6211\u4eec\u7ee7\u7eed\u5f80\u4e0b\u627e\u627e: \u53d1\u73b0\u8fd9\u4e9b\u63a5\u53e3\u53c8\u6ce8\u518c\u4e86\u4e00\u904d\uff0c\u597d\u5bb6\u4f19\uff0c\u95ee\u9898\u6839\u6e90\u627e\u5230\u4e86\uff0c\u63a5\u53e3\u6ce8\u518c\u4e862\u6b21\uff0c\u6240\u6709\u7684\u90fd\u662f\u3002","title":"3. \u662f\u4e0d\u662f\u63a5\u53e3\u4e0d\u5c0f\u5fc3\u6ce8\u518c\u4e862\u6b21\u5bfc\u81f4\uff1f"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28120%29%20%E4%BF%AE%E5%A4%8D%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3%E6%89%93%E4%B8%8D%E5%BC%80%E7%9A%84bug/#4-2","text":"\u56de\u60f3\u4e00\u4e0b\u6211\u4eec\u542f\u52a8app\u7684\u65f6\u5019\uff0c\u770b\u770b\u63a7\u5236\u53f0: \u6211\u4eec\u6ca1\u6709\u5f00\u591a\u4e2aworkers\uff0c\u4f46pity is running at pro \u88ab\u6267\u884c\u4e862\u6b21\uff0c\u6211\u4eec\u627e\u627e\u9879\u76ee\u91cc\u9762\u7684\u8fd9\u5757\u4ee3\u7801: \u600e\u4e48\u641c\u4e5f\u624d\u51fa\u73b01\u6b21\uff0c\u8fd9\u53ef\u5c34\u5c2c\u4e86\u3002\u4e8e\u662f\u6211\u4eec\u4eb2\u624b\u5728include_router\u90a3\u91cc\u6253\u4e2a\u65ad\u70b9\uff0c\u770b\u5230\u5e95\u4f1a\u4e0d\u4f1a\u6267\u884c2\u6b21\u3002 \u6211\u4eec\u6309F9\uff0c\u7ee7\u7eed\u8c03\u8bd5\u4ee3\u7801 \u53d1\u73b0\u65ad\u70b9\u53c8\u751f\u6548\u4e86\uff0c\u4e0b\u9762\u7684\u65e5\u5fd7\u4e5f\u6253\u5370\u4e862\u6b21\u3002\u8bc1\u660e\u6211\u4eec\u7684\u731c\u60f3\u6ca1\u9519\u3002","title":"4. \u4e3a\u4ec0\u4e48\u63a5\u53e3\u6ce8\u518c\u4e862\u6b21\u5462\uff1f"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28120%29%20%E4%BF%AE%E5%A4%8D%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3%E6%89%93%E4%B8%8D%E5%BC%80%E7%9A%84bug/#5","text":"\u8fd9\u65f6\u5019\u62ff\u51fa\u5404\u79cd\u641c\u7d22\u5de5\u5177\u4e00\u901a\u641c\u7d22\uff0c\u7ec8\u4e8e\u53d1\u73b0\u4e86\u8fd9\u4e48\u4e2a \u5730\u5740 : \u4ed6\u8bf4\u4ed6\u6bcf\u6b21\u90fd\u6267\u884c3\u6b21\uff08\u597d\u5bb6\u4f19\uff0c\u6bd4\u6211\u8fd8\u5938\u5f20\uff09\uff0c\u6211\u4eec\u6765\u770b\u770b\u522b\u4eba\u7684\u7b54\u590d: \u7b80\u5355\u7684\u8bf4\u5c31\u662f\uff0c\u6211\u4eec\u6267\u884cmain.py\uff0c\u5728\u5230\u8fbe__main__\u4ee3\u7801\u5757\u4e4b\u524d\uff0cinclude\u5df2\u7ecf\u6267\u884c\u4e00\u6b21\u4e86\uff0c\u63a5\u7740\u6211\u4eec\u8c03\u7528\u7684\u662f: \u5b83\u53c8\u4f1a\u4ecemain.py\u8d70\u4e00\u906d\uff0c\u4e5f\u5c31\u662f\u7b2c\u4e8c\u6b21\u6267\u884c\u3002\u89e3\u51b3\u65b9\u6848\u5f88\u7b80\u5355\uff0c\u6211\u4eec\u7684\u542f\u52a8\u6587\u4ef6\u4e0d\u80fd\u653e\u8fd9\u4e9binclude\u7684\u64cd\u4f5c\uff0c\u53ea\u9700\u8981\u7eaf\u7cb9\u5730\u6267\u884c\u4ee3\u7801\u5373\u53ef\u3002 import uvicorn if __name__ == \"__main__\" : uvicorn . run ( \"main:pity\" , host = \"0.0.0.0\" , port = 7777 , reload = False ) \u6240\u4ee5\u6211\u8fd9\u8fb9\u65b0\u5efa\u4e86\u4e00\u4e2arunserver.py\uff0c\u5e76\u4e14\u5199\u5165\u4e86\u4ee5\u4e0a\u4ee3\u7801\uff0c\u6211\u4eec\u6765\u8bd5\u8bd5\u6548\u679c: \u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u5757\u5185\u5bb9\u53ea\u6253\u5370\u4e00\u6b21\u4e86\uff0c\u6211\u4eec\u6700\u540e\u8bd5\u4e0b\u6253\u5f00/docs: \u641e\u5b9a\uff0c\u603b\u4f53\u6765\u8bf4\u82b1\u4e86\u8fd12\u4e2a\u5c0f\u65f6\u6392\u67e5+\u641c\u7d22\u95ee\u9898\uff0c\u4f46\u603b\u5f52\u662f\u503c\u5f97\u7684\uff01","title":"5. \u6c42\u52a9"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28121%29%20%E6%9B%B4%E6%8D%A2%E7%99%BB%E5%BD%95%E9%A1%B5/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u4e00\u8d77\u4ea4\u6d41\u5b66\u4e60! \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u4fee\u590d\u4e86\u63a5\u53e3\u6587\u6863\u7684\u95ee\u9898\uff0c\u8fd9\u4e00\u8282\u6211\u4eec\u6765\u6539\u9020\u4e0b\u767b\u5f55\u9875\u3002 \u73b0\u5728\u7684\u767b\u5f55\u9875 \u600e\u4e48\u8bf4\u5462\uff0c\u6bd4\u8f83\u96be\u770b\uff0c\u518d\u52a0\u4e0a\u4e0a\u4e0b\u8fd8\u6709\u7a7a\u9699\uff0c\u6240\u4ee5\u5728\u5fcd\u53d7\u4e86\u8bb8\u4e45\u4ee5\u540e\u6211\u6253\u7b97\u5bf9\u5b83\u4e0b\u624b\u4e86\u3002 \u8bf4\u53e5\u5b9e\u8bdd\uff0c\u8fd9\u5757\u5185\u5bb9\u6d89\u53ca\u5230\u6bd4\u8f83\u591acss\u7684\u4e1c\u897f\uff0c\u4e3a\u4e86\u8282\u7ea6\u65f6\u95f4\uff0c\u6211 \u767d\u5ad6 \u4e86github\u4e0a\u7684\u4e00\u4e9b\u767b\u5f55\u6a21\u677f\u3002 \u5148\u6765\u770b\u4e0b\u6700\u7ec8\u7684\u6a21\u677f: \u4e0d\u80fd\u8bf4\u5f88\u597d\u770b\uff0c\u4f46\u8d77\u7801\u6bd4\u4e4b\u524d\u66f4 \u6241\u5e73\u5316 \u4e86\u4e00\u4e9b\uff0c\u4e4b\u524d\u82b1\u91cc\u80e1\u54e8\u7684\uff0c\u6211\u8fd8\u662f\u66f4\u559c\u6b22\u7b80\u7ea6\u70b9\u7684\u3002 \u4e0b\u9762\u662f\u539f\u4f5c\u8005\u7684git\u5730\u5740: https://github.com/zeroojs/landing-ux \u5f00\u59cb\u6539\u9020 \u4fee\u6539BasicLayout.jsx import {DefaultFooter, getMenuData, getPageTitle} from '@ant-design/pro-layout'; import {connect, FormattedMessage, Link, useIntl} from 'umi'; import React from 'react'; import login from '../assets/login.svg'; import logo from '../assets/logo.svg'; import './index.css'; import styles from './UserLayout.less'; const UserLayout = (props) => { const { route = { routes: [], }, } = props; const {routes = []} = route; const { children, location = { pathname: '', }, } = props; const {formatMessage} = useIntl(); const {breadcrumb} = getMenuData(routes); const title = getPageTitle({ pathname: location.pathname, formatMessage, breadcrumb, ...props, }); return ( <div className=\"container\"> <div className=\"form-warp\"> <div> <div className={styles.top}> <div className={styles.header}> <Link to=\"/\"> <img alt=\"logo\" className={styles.logo} src={logo}/> <span className={styles.title}>pity</span> </Link> </div> <div className={styles.desc}> <FormattedMessage id=\"pages.layouts.userLayout.title\" defaultMessage=\"pity\u662f\u4e00\u6b3e\u5f00\u6e90\u4e14\u81ea\u7531\u7684\u63a5\u53e3\u81ea\u52a8\u5316\u5e73\u53f0\" /> </div> </div> </div> {children} <DefaultFooter copyright={ <span>{new Date().getFullYear()} woody\u4e2a\u4eba\u51fa\u54c1 <a href=\"https://beian.miit.gov.cn\">\u9102ICP\u590720001602\u53f7</a></span>} links={false} style={{ background: '#ffffff' }}/> </div> <div className=\"desc-warp\"> <div className=\"desc-warp-item sign-up-desc\"> <div className=\"content\"> </div> <img className=\"image\" src={login} alt=\"\"/> </div> </div> </div> ); }; export default connect(({settings}) => ({...settings}))(UserLayout); \u6211\u4eec\u628a\u539f\u5148\u7684\u7ed3\u6784\u8c03\u6574\u4e00\u4e0b\uff0c\u4e0egithub\u7684\u6a21\u5f0f\u4e00\u81f4\uff0c\u4fdd\u7559\u7684\u5730\u65b9\u662fchildren\uff08\u4e5f\u5c31\u662f\u6211\u4eec\u7684\u767b\u5f55\u8868\u5355\uff09\u3002 \u65b0\u589eindex.css \u5199\u597dhtml\u9875\u9762\u4ee5\u540e\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u5f15\u5165css\uff0c\u8fd9\u513f\u6211\u505a\u4e86\u4e00\u4e9b\u6539\u52a8\uff0c\u6211\u53bb\u6389\u4e86\u6ce8\u518c/\u767b\u5f55\u9875\u9762\u7684\u5207\u6362: . container { position : relative ; min-height : 100 vh ; width : 100 % ; overflow : hidden ; } * { font-size : 13 px ; } . container :: before { content : \" \" ; position : absolute ; width : 2000 px ; height : 2000 px ; border-radius : 50 % ; background-image : linear-gradient ( -45deg , #6266f5 0 % , #04befe 100 % ); transition : 1.8 s ease-in-out ; z-index : 6 ; top : -10 % ; right : 48 % ; transform : translateY ( -50 % ); } . container . sign-up-mode :: before { transform : translate ( 100 % , -50 % ); } . form-warp { width : 50 % ; position : absolute ; z-index : 5 ; left : 75 % ; top : 43 % ; transform : translate ( -50 % , -50 % ); display : grid ; grid-template-columns : 1 fr ; transition : 1 s 0.7 s ease-in-out ; } . container . sign-up-mode . form-warp { left : 25 % ; } . desc-warp { width : 100 % ; height : 100 % ; position : absolute ; top : 0 ; left : 0 ; display : grid ; grid-template-columns : repeat ( 2 , 1 fr ); } . desc-warp-item { display : flex ; flex-direction : column ; align-items : flex-end ; justify-content : space-around ; text-align : center ; padding : 3 rem 17 % 2 rem 12 % ; z-index : 6 ; } /* \u4e8b\u4ef6\u7a7f\u900f BEGIN */ . sign-in-desc { pointer-events : none ; } . sign-up-mode . sign-in-desc { pointer-events : all ; } . sign-up-mode . sign-up-desc { pointer-events : none ; } /* \u4e8b\u4ef6\u7a7f\u900f END */ . content { width : 100 % ; transition : transform 0.9 s ease-in-out ; transition-delay : .6 s ; } . sign-in-desc . image , . sign-in-desc . content { transform : translateX ( 800 px ); } . sign-up-mode . sign-in-desc . image , . sign-up-mode . sign-in-desc . content { transform : translateX ( 0 ); } . sign-up-mode . sign-up-desc . image , . sign-up-mode . sign-up-desc . content { transform : translateX ( -800px ); } . image { width : 100 % ; display : block ; transition : transform 0.9 s ease-in-out ; transition-delay : .5 s ; } /* \u54cd\u5e94\u5f0f */ @ media screen and ( max-width : 870px ) { . container :: before { width : 1500 px ; height : 1500 px ; transform : translateX ( -50 % ); left : 30 % ; bottom : 68 % ; right : initial ; top : initial ; transition : 2 s ease-in-out ; } . container . sign-up-mode :: before { transform : translate ( -50 % , 100 % ); bottom : 32 % ; right : initial ; } . form-warp { width : 100 % ; top : 75 % ; left : 50 % ; transform : translate ( -50 % , -100 % ); transition : 1 s 0.8 s ease-in-out ; } . container . sign-up-mode . form-warp { top : 25 % ; left : 50 % ; transform : translate ( -50 % , 0 ); } /*.image {*/ /* width: 200px;*/ /* transition: transform 0.9s ease-in-out;*/ /* transition-delay: 0.7s;*/ /*}*/ . desc-warp { grid-template-columns : 1 fr ; grid-template-rows : 1 fr 2 fr 1 fr ; } . desc-warp-item { flex-direction : row ; justify-content : space-around ; align-items : center ; padding : 2.5 rem 8 % ; grid-column : 1 / 2 ; } . sign-in-desc { grid-row : 3 / 4 ; } . sign-in-desc . image , . sign-in-desc . content { transform : translateY ( 800 px ); } . sign-up-mode . sign-in-desc . image , . sign-up-mode . sign-in-desc . content { transform : translateY ( 0 ); } . sign-up-mode . sign-up-desc . image , . sign-up-mode . sign-up-desc . content { transform : translateY ( -800px ); } } @ media screen and ( max-width : 570px ) { . container :: before { bottom : 42 % ; left : 50 % ; } img { display : none ; } } css\u5f88\u957f\uff0c\u662f\u54cd\u5e94\u5f0f\u7684\uff0c\u56e0\u4e3a\u6211\u8fd9\u5757\u5c5e\u5b9e \u8fa3\u9e21 \uff0c\u6240\u4ee5\u4e5f\u53ea\u597d\u767d\u5ad6\u4e0b\u522b\u4eba\u7684\u4e86\uff08\u5df2\u7ed9\u535a\u4e3b\u6295\u5e01\u652f\u6301\uff09\u3002\u5f53\u7136\u8fd8\u6709\u4e00\u4e9b\u5730\u65b9\u6ca1\u6709\u4f18\u5316\u597d\uff0c\u6bd4\u5982\u54cd\u5e94\u5f0f\u4e0d\u662f\u5f88\u751f\u6548\uff0c\u4e0d\u8fc7\u603b\u4f53\u6765\u770b\u7684\u8bdd\uff0c\u5df2\u7ecf\u6bd4\u4e4b\u524d\u6548\u679c\u597d\u5f88\u591a\u4e86\u3002 \u63d0\u4ea4\u6309\u94ae\u52a0border-radius \u6765\u770b\u770b\u533a\u522b: \u4e4b\u524d\u534a\u5c4f \u73b0\u5728\u534a\u5c4f \u8bf4\u5230\u5e95\u8fd8\u662f\u81ea\u5df1\u524d\u7aef\u592a\u5f31\u4e86\uff0ccss\u8fd9\u73a9\u610f\u771f\u7684\u662f\u4e00\u95e8\u5927\u5927\u7684\u5b66\u95ee\uff0c\u4ee5\u540e\u6709\u673a\u4f1a\u4e00\u5b9a\u8981\u5b66\u4e60\u66f4\u591a\u8fd9\u65b9\u9762\u7684\u77e5\u8bc6\uff01","title":"121.\u66f4\u6362\u767b\u5f55\u9875"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28121%29%20%E6%9B%B4%E6%8D%A2%E7%99%BB%E5%BD%95%E9%A1%B5/#_1","text":"\u4e0a\u4e00\u8282\u6211\u4eec\u4fee\u590d\u4e86\u63a5\u53e3\u6587\u6863\u7684\u95ee\u9898\uff0c\u8fd9\u4e00\u8282\u6211\u4eec\u6765\u6539\u9020\u4e0b\u767b\u5f55\u9875\u3002","title":"\u56de\u987e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28121%29%20%E6%9B%B4%E6%8D%A2%E7%99%BB%E5%BD%95%E9%A1%B5/#_2","text":"\u600e\u4e48\u8bf4\u5462\uff0c\u6bd4\u8f83\u96be\u770b\uff0c\u518d\u52a0\u4e0a\u4e0a\u4e0b\u8fd8\u6709\u7a7a\u9699\uff0c\u6240\u4ee5\u5728\u5fcd\u53d7\u4e86\u8bb8\u4e45\u4ee5\u540e\u6211\u6253\u7b97\u5bf9\u5b83\u4e0b\u624b\u4e86\u3002 \u8bf4\u53e5\u5b9e\u8bdd\uff0c\u8fd9\u5757\u5185\u5bb9\u6d89\u53ca\u5230\u6bd4\u8f83\u591acss\u7684\u4e1c\u897f\uff0c\u4e3a\u4e86\u8282\u7ea6\u65f6\u95f4\uff0c\u6211 \u767d\u5ad6 \u4e86github\u4e0a\u7684\u4e00\u4e9b\u767b\u5f55\u6a21\u677f\u3002 \u5148\u6765\u770b\u4e0b\u6700\u7ec8\u7684\u6a21\u677f: \u4e0d\u80fd\u8bf4\u5f88\u597d\u770b\uff0c\u4f46\u8d77\u7801\u6bd4\u4e4b\u524d\u66f4 \u6241\u5e73\u5316 \u4e86\u4e00\u4e9b\uff0c\u4e4b\u524d\u82b1\u91cc\u80e1\u54e8\u7684\uff0c\u6211\u8fd8\u662f\u66f4\u559c\u6b22\u7b80\u7ea6\u70b9\u7684\u3002 \u4e0b\u9762\u662f\u539f\u4f5c\u8005\u7684git\u5730\u5740: https://github.com/zeroojs/landing-ux","title":"\u73b0\u5728\u7684\u767b\u5f55\u9875"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28121%29%20%E6%9B%B4%E6%8D%A2%E7%99%BB%E5%BD%95%E9%A1%B5/#_3","text":"\u4fee\u6539BasicLayout.jsx import {DefaultFooter, getMenuData, getPageTitle} from '@ant-design/pro-layout'; import {connect, FormattedMessage, Link, useIntl} from 'umi'; import React from 'react'; import login from '../assets/login.svg'; import logo from '../assets/logo.svg'; import './index.css'; import styles from './UserLayout.less'; const UserLayout = (props) => { const { route = { routes: [], }, } = props; const {routes = []} = route; const { children, location = { pathname: '', }, } = props; const {formatMessage} = useIntl(); const {breadcrumb} = getMenuData(routes); const title = getPageTitle({ pathname: location.pathname, formatMessage, breadcrumb, ...props, }); return ( <div className=\"container\"> <div className=\"form-warp\"> <div> <div className={styles.top}> <div className={styles.header}> <Link to=\"/\"> <img alt=\"logo\" className={styles.logo} src={logo}/> <span className={styles.title}>pity</span> </Link> </div> <div className={styles.desc}> <FormattedMessage id=\"pages.layouts.userLayout.title\" defaultMessage=\"pity\u662f\u4e00\u6b3e\u5f00\u6e90\u4e14\u81ea\u7531\u7684\u63a5\u53e3\u81ea\u52a8\u5316\u5e73\u53f0\" /> </div> </div> </div> {children} <DefaultFooter copyright={ <span>{new Date().getFullYear()} woody\u4e2a\u4eba\u51fa\u54c1 <a href=\"https://beian.miit.gov.cn\">\u9102ICP\u590720001602\u53f7</a></span>} links={false} style={{ background: '#ffffff' }}/> </div> <div className=\"desc-warp\"> <div className=\"desc-warp-item sign-up-desc\"> <div className=\"content\"> </div> <img className=\"image\" src={login} alt=\"\"/> </div> </div> </div> ); }; export default connect(({settings}) => ({...settings}))(UserLayout); \u6211\u4eec\u628a\u539f\u5148\u7684\u7ed3\u6784\u8c03\u6574\u4e00\u4e0b\uff0c\u4e0egithub\u7684\u6a21\u5f0f\u4e00\u81f4\uff0c\u4fdd\u7559\u7684\u5730\u65b9\u662fchildren\uff08\u4e5f\u5c31\u662f\u6211\u4eec\u7684\u767b\u5f55\u8868\u5355\uff09\u3002 \u65b0\u589eindex.css \u5199\u597dhtml\u9875\u9762\u4ee5\u540e\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u5f15\u5165css\uff0c\u8fd9\u513f\u6211\u505a\u4e86\u4e00\u4e9b\u6539\u52a8\uff0c\u6211\u53bb\u6389\u4e86\u6ce8\u518c/\u767b\u5f55\u9875\u9762\u7684\u5207\u6362: . container { position : relative ; min-height : 100 vh ; width : 100 % ; overflow : hidden ; } * { font-size : 13 px ; } . container :: before { content : \" \" ; position : absolute ; width : 2000 px ; height : 2000 px ; border-radius : 50 % ; background-image : linear-gradient ( -45deg , #6266f5 0 % , #04befe 100 % ); transition : 1.8 s ease-in-out ; z-index : 6 ; top : -10 % ; right : 48 % ; transform : translateY ( -50 % ); } . container . sign-up-mode :: before { transform : translate ( 100 % , -50 % ); } . form-warp { width : 50 % ; position : absolute ; z-index : 5 ; left : 75 % ; top : 43 % ; transform : translate ( -50 % , -50 % ); display : grid ; grid-template-columns : 1 fr ; transition : 1 s 0.7 s ease-in-out ; } . container . sign-up-mode . form-warp { left : 25 % ; } . desc-warp { width : 100 % ; height : 100 % ; position : absolute ; top : 0 ; left : 0 ; display : grid ; grid-template-columns : repeat ( 2 , 1 fr ); } . desc-warp-item { display : flex ; flex-direction : column ; align-items : flex-end ; justify-content : space-around ; text-align : center ; padding : 3 rem 17 % 2 rem 12 % ; z-index : 6 ; } /* \u4e8b\u4ef6\u7a7f\u900f BEGIN */ . sign-in-desc { pointer-events : none ; } . sign-up-mode . sign-in-desc { pointer-events : all ; } . sign-up-mode . sign-up-desc { pointer-events : none ; } /* \u4e8b\u4ef6\u7a7f\u900f END */ . content { width : 100 % ; transition : transform 0.9 s ease-in-out ; transition-delay : .6 s ; } . sign-in-desc . image , . sign-in-desc . content { transform : translateX ( 800 px ); } . sign-up-mode . sign-in-desc . image , . sign-up-mode . sign-in-desc . content { transform : translateX ( 0 ); } . sign-up-mode . sign-up-desc . image , . sign-up-mode . sign-up-desc . content { transform : translateX ( -800px ); } . image { width : 100 % ; display : block ; transition : transform 0.9 s ease-in-out ; transition-delay : .5 s ; } /* \u54cd\u5e94\u5f0f */ @ media screen and ( max-width : 870px ) { . container :: before { width : 1500 px ; height : 1500 px ; transform : translateX ( -50 % ); left : 30 % ; bottom : 68 % ; right : initial ; top : initial ; transition : 2 s ease-in-out ; } . container . sign-up-mode :: before { transform : translate ( -50 % , 100 % ); bottom : 32 % ; right : initial ; } . form-warp { width : 100 % ; top : 75 % ; left : 50 % ; transform : translate ( -50 % , -100 % ); transition : 1 s 0.8 s ease-in-out ; } . container . sign-up-mode . form-warp { top : 25 % ; left : 50 % ; transform : translate ( -50 % , 0 ); } /*.image {*/ /* width: 200px;*/ /* transition: transform 0.9s ease-in-out;*/ /* transition-delay: 0.7s;*/ /*}*/ . desc-warp { grid-template-columns : 1 fr ; grid-template-rows : 1 fr 2 fr 1 fr ; } . desc-warp-item { flex-direction : row ; justify-content : space-around ; align-items : center ; padding : 2.5 rem 8 % ; grid-column : 1 / 2 ; } . sign-in-desc { grid-row : 3 / 4 ; } . sign-in-desc . image , . sign-in-desc . content { transform : translateY ( 800 px ); } . sign-up-mode . sign-in-desc . image , . sign-up-mode . sign-in-desc . content { transform : translateY ( 0 ); } . sign-up-mode . sign-up-desc . image , . sign-up-mode . sign-up-desc . content { transform : translateY ( -800px ); } } @ media screen and ( max-width : 570px ) { . container :: before { bottom : 42 % ; left : 50 % ; } img { display : none ; } } css\u5f88\u957f\uff0c\u662f\u54cd\u5e94\u5f0f\u7684\uff0c\u56e0\u4e3a\u6211\u8fd9\u5757\u5c5e\u5b9e \u8fa3\u9e21 \uff0c\u6240\u4ee5\u4e5f\u53ea\u597d\u767d\u5ad6\u4e0b\u522b\u4eba\u7684\u4e86\uff08\u5df2\u7ed9\u535a\u4e3b\u6295\u5e01\u652f\u6301\uff09\u3002\u5f53\u7136\u8fd8\u6709\u4e00\u4e9b\u5730\u65b9\u6ca1\u6709\u4f18\u5316\u597d\uff0c\u6bd4\u5982\u54cd\u5e94\u5f0f\u4e0d\u662f\u5f88\u751f\u6548\uff0c\u4e0d\u8fc7\u603b\u4f53\u6765\u770b\u7684\u8bdd\uff0c\u5df2\u7ecf\u6bd4\u4e4b\u524d\u6548\u679c\u597d\u5f88\u591a\u4e86\u3002","title":"\u5f00\u59cb\u6539\u9020"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28121%29%20%E6%9B%B4%E6%8D%A2%E7%99%BB%E5%BD%95%E9%A1%B5/#border-radius","text":"\u6765\u770b\u770b\u533a\u522b: \u4e4b\u524d\u534a\u5c4f \u73b0\u5728\u534a\u5c4f \u8bf4\u5230\u5e95\u8fd8\u662f\u81ea\u5df1\u524d\u7aef\u592a\u5f31\u4e86\uff0ccss\u8fd9\u73a9\u610f\u771f\u7684\u662f\u4e00\u95e8\u5927\u5927\u7684\u5b66\u95ee\uff0c\u4ee5\u540e\u6709\u673a\u4f1a\u4e00\u5b9a\u8981\u5b66\u4e60\u66f4\u591a\u8fd9\u65b9\u9762\u7684\u77e5\u8bc6\uff01","title":"\u63d0\u4ea4\u6309\u94ae\u52a0border-radius"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28122%29%20%E6%94%B9%E9%80%A0%E6%B7%BB%E5%8A%A0%E7%94%A8%E4%BE%8B%E9%A1%B5%E9%9D%A2/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u4e00\u8d77\u4ea4\u6d41\u5b66\u4e60! \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u7a0d\u5fae\u4f18\u5316\u4e86\u4e00\u4e0b\u767b\u5f55\u9875\uff0c\u540e\u9762\u6211\u4eec\u53ef\u4ee5\u5f00\u59cb\u8fdb\u4e00\u6b65\u5f00\u53d1\u4e86\uff0c\u4ee5\u529f\u80fd\u70b9\u4e3a\u4e3b\u3002\u6240\u4ee5\u8fd9\u4e00\u8282\u6211\u4eec\u8981\u89e3\u51b3\u8fd9\u6837\u4e00\u4e2a\u9700\u6c42: \u5176\u5b9e\u8fd9\u4e2a\u95ee\u9898\u662f\u56e0\u4e3a http \u8bf7\u6c42\u53d1\u51fa\u53bb\u7684\u65f6\u5019\uff0c\u5e76\u6ca1\u6709\u8fdb\u884c \u5168\u5c40\u53d8\u91cf \u66ff\u6362\uff0c\u4f46\u73b0\u5728\u6709\u4e2a\u5f88\u4e25\u91cd\u7684\u95ee\u9898: \u6211\u4eec\u7684case\u90fd\u662f\u8de8\u73af\u5883\u7684\uff0c\u8fd9\u5c31\u5bfc\u81f4\u5982\u679c\u8fd9\u91cc\u586b\u4e86\u73af\u5883\u53d8\u91cf\uff0c\u4f46\u6211\u5e76\u4e0d\u77e5\u9053\u8be5\u7528\u54ea\u5957\u73af\u5883\u7684\u6570\u636e\uff0c\u800c\u4e14\u8fd9\u91cc\u4e5f\u6f0f\u4e86\u6211\u4eec\u4e4b\u524d\u7f16\u5199\u7684base_path\u529f\u80fd\u3002 \u6539\u9020\u65b9\u6848 \u8fd9\u6b21\u7684\u65b9\u6848\u6539\u52a8\u4f1a\u5f88\u5927\uff0c\u6211\u4e2a\u4eba\u89c9\u5f97\uff0c\u65b0\u589e\u548c\u7f16\u8f91\u9875\u9762\u5b8c\u5168\u533a\u5206\u5f00\uff0c\u6bd4\u8f83\u4e0d\u5408\u9002\u3002\u800c\u4e14\u4e0d\u592a\u53cb\u597d\uff0c\u6240\u4ee5\u5728\u6dfb\u52a0case\u7684\u65f6\u5019\uff0c\u6211\u4f1a\u4ee5\u5f39\u7a97\u7684\u5f62\u5f0f\u5c55\u793a\u3002 \u8fd9\u6837\u80fd\u591f\u5c11\u8df3\u8f6c\u4e00\u6b21url\uff0c \u76f8\u5bf9\u6765\u8bf4 \u66f4\u53cb\u597d\u4e00\u4e9b\u3002\u81f3\u4e8e\u90a3\u4e48\u591a\u64cd\u4f5c\u6761\u4ef6\uff0c\u54b1\u4eec\u5c31\u4e00\u5e76\u63d0\u4ea4\u3002 \u7528\u4f8b\u4fe1\u606f \u524d\u7f6e\u6761\u4ef6 \u540e\u7f6e\u6761\u4ef6 \u65ad\u8a00 \u7ec4\u4ef6\u6211\u4eec\u662f\u4e0d\u80fd\u590d\u7528\u4e86\uff0c\u56e0\u4e3a\u4e4b\u524d\u6dfb\u52a0\u524d\u7f6e/\u540e\u7f6e/\u65ad\u8a00\uff0c\u90fd\u662f\u5728\u5df2\u6709\u7684\u7528\u4f8b\u4e0a\u6dfb\u52a0\uff0c\u73b0\u5728\u90fd\u662f \u6682\u5b58 \u5230\u524d\u7aef\uff0c\u6700\u540e\u7edf\u4e00\u63d0\u4ea4\uff0c\u6ca1\u4e8b\u6211\u4eec\u6162\u6162\u6765\uff0c\u8fdf\u65e9\u8981\u8d70\u5230\u8fd9\u4e00\u6b65\u7684\u3002 \u7f16\u5199\u540e\u7aef\u4ee3\u7801 \u540e\u7aef\u4ee3\u7801\uff0c\u6211\u4eec\u9700\u8981\u505a\u7684\u67092\u90e8\u5206: \u6279\u91cf\u63d0\u4ea4\u7528\u4f8b\u6570\u636e \u6839\u636e\u4f20\u5165\u7684\u6570\u636e\u5728\u7ebf\u6267\u884ccase\uff08\u4f9b\u8c03\u8bd5\u7528\uff0c\u8fd9\u70b9\u6bd4\u8f83\u9ebb\u70e6\uff09 \u90a3\u6211\u4eec\u5c31\u5148\u4ece\u8f6f\u67ff\u5b50\u5f00\u634f\u5427\uff0c\u56e0\u4e3a\u7b2c\u4e8c\u4e2a\u90e8\u5206\u53ef\u80fd\u8fd8\u6709\u4e9b\u95ee\u9898\uff0c\u6211\u4eec\u53ef\u4ee5\u653e\u5230\u540e\u9762\u53bb\u505a\u3002 \u9996\u5148\u6211\u4eec\u8981\u7efc\u5408\u6765\u770b\uff0c\u65b0\u589e\u662f\u5168\u90e8\u6570\u636e\u4e00\u5e76\u63d0\u4ea4\uff0c\u800c\u4fee\u6539\u5f80\u5f80\u662f\u53ea\u4fee\u6539\u4e00\u90e8\u5206\uff0c\u5176\u5b9e\u4fee\u6539\u6211\u4eec\u4e5f\u53ef\u4ee5\u6539\u4e3a \u6279\u91cf\u63d0\u4ea4 \uff0c\u4f46\u662f\u4ee3\u4ef7\u5f88\u5927\uff0c\u56e0\u4e3a\u8981\u6539\u7684\u5185\u5bb9\u591a\uff0c\u8fd8\u662f\u62bd\u51fa\u6bd4\u8f83\u5408\u9002\u3002\u8fd9\u6837\u5c31\u4f1a\u6709\u4e00\u4e2a\u95ee\u9898\u4e86\uff0c\u6211\u4eec\u7684\u524d\u7f6e\u6761\u4ef6\u7b49\u8868\u5355\uff0c\u90fd\u662f\u9700\u8981 case_id \u5b57\u6bb5\u7684\uff0c\u6240\u4ee5\u8fd9\u91cc\u6211\u4eec\u4e3a\u4e86\u65b0\u7684\u6a21\u5f0f\uff0c\u53ea\u80fd\u628a\u5b83\u6539\u6210\u975e\u5fc5\u586b\u4e86\u3002\uff08\u8fd9\u70b9\u6211\u8fd8\u6ca1\u6709\u8003\u8651\u597d\uff0c\u53ea\u662f\u521d\u6b65\u7684\u8bbe\u5b9a\uff09 \u4fee\u6539\u5404\u4e2a\u8868\u7684form \u8fd9\u91cc\u524d\u540e\u7f6e\u6761\u4ef6\u672c\u8eab\u5c31 \u5fd8\u8bb0 \u52a0\u4e0a\u8fd9\u4e2a\u7ea6\u675f\u4e86\uff0c\u6240\u4ee5\u4e5f\u4e0d\u592a\u9700\u8981\u6539\uff0c\u91cd\u70b9\u90fd\u662fvalidator\u8fd9\u4e2a\u65b9\u6cd5\u91cc\u9762\u3002 \u7f16\u5199\u5927\u6742\u70e9form \u6682\u4e14\u53ebTestCaseInfo \u5b83\u7ed3\u5408\u4e864\u79cdschema\uff0c\u6211\u6d4b\u8bd5\u4e86\u53d1\u73b0\uff0c\u4f1a\u6839\u636e\u91cc\u9762\u7684schema\u8fdb\u884c\u6821\u9a8c\uff0c\u6240\u4ee5\u6211\u4eec\u7684validator\u53ea\u9700\u8981\u6821\u9a8ccase\u5b57\u6bb5\u5373\u53ef\u3002 \u6539\u5199insert_record\u65b9\u6cd5 \u5728\u6b64\u4e4b\u524d\uff0c\u6211\u4eec\u9700\u8981\u5148\u6539\u9020\u4e0bMapper\u91cc\u9762\u7684insert_record\u65b9\u6cd5\uff0c\u7531\u4e8e\u6211\u4eec\u662f\u6279\u91cf\u63d2\u5165\uff0c\u6240\u4ee5\u9700\u8981\u7528\u4e00\u4e2a\u4e8b\u52a1\u53bb \u4fdd\u8bc1 \u6240\u6709\u6570\u636e\u8981\u4e48\u90fd\u63d2\u5165\u8981\u4e48\u90fd\u5931\u8d25\uff0c\u4e4b\u524d\u6211\u7684\u8bbe\u60f3\u662f\u5728router\u5c42\u521b\u5efasession\uff0c\u5e76\u5f00\u542f\u4e8b\u52a1\uff0c\u63a5\u7740\u628asession\u6295\u9012\u5230\u5bf9\u5e94\u7684\u63d2\u5165\u64cd\u4f5c\u4e2d\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u6539\u6539insert\u65b9\u6cd5: \u5982\u679css\uff08\u4ee3\u8868session\uff09\u4f20\u5165\u4e86\uff0c\u8bf4\u660e\u662f\u4e00\u4e2a\u4e8b\u52a1\u64cd\u4f5c\uff0c\u5176\u5b9e\u4e5f\u53ef\u4ee5\u6539\u4e2a\u540d\u5b57\u53ebtransaction\uff0c\u4f46\u662f\u56e0\u4e3a\u6211\u4eec\u8fd8\u662f\u9700\u8981\u62ff\u5230session\u4fe1\u606f\u7684\uff0c\u6240\u4ee5\u6682\u65f6\u5148\u8fd9\u4e48\u5199\u4e86\u3002\u9664\u4e86\u53c2\u6570\u591a\u4e86\u4e2ass\u4ee5\u5916\uff0c\u6ca1\u6709\u5176\u4ed6\u533a\u522b\u4e86\u3002 \u7f16\u5199insert_test_case\u65b9\u6cd5 \u5728TestCaseDao\u7c7b\u7f16\u5199insert_test_case\u65b9\u6cd5\uff0c\u4e3b\u8981\u67093\u6b65: \u5224\u65ad\u8be5\u76ee\u5f55\u662f\u5426\u5b58\u5728\u8be5case\u540d \u6dfb\u52a0case \u6dfb\u52a0\u65ad\u8a00/\u524d\u540e\u7f6e\u6761\u4ef6/\u6d4b\u8bd5\u6570\u636e @staticmethod async def insert_test_case ( session , data : TestCaseInfo , user : int ): \"\"\" \u6d4b\u8bd5\u6570\u636e\u548c\u7528\u6237id :param data: \u6d4b\u8bd5\u7528\u4f8b\u6570\u636e :param session: \u5f02\u6b65session :param user: \u521b\u5efa\u4eba :return: \"\"\" query = await session . execute ( select ( TestCase ) . where ( TestCase . directory_id == data . case . directory_id , TestCase . name == data . case . name , TestCase . deleted_at == 0 )) if query . scalars () . first () is not None : raise Exception ( \"\u7528\u4f8b\u540d\u79f0\u5df2\u5b58\u5728\" ) cs = TestCase ( ** data . case . dict (), create_user = user ) # \u6dfb\u52a0case\uff0c\u4e4b\u540e\u6dfb\u52a0\u5176\u4ed6\u6570\u636e session . add ( cs ) await session . flush () session . expunge ( cs ) # # \u6dfb\u52a0\u65ad\u8a00 for a in data . asserts : a . case_id = cs . id a = TestCaseAsserts ( ** a . dict (), user = user ) await TestCaseAssertsDao . insert_record ( a , ss = session ) # \u6dfb\u52a0\u6784\u9020\u6761\u4ef6 for c in data . constructor : c . case_id = cs . id c = Constructor ( ** c . dict (), user = user ) await ConstructorDao . insert_record ( c , ss = session ) # \u6dfb\u52a0\u6d4b\u8bd5\u6570\u636e for t in data . data : t . case_id = cs . id t = PityTestcaseData ( ** t . dict (), user = user ) await PityTestcaseDataDao . insert_record ( t , ss = session ) \u601d\u8def\u6bd4\u8f83\u7b80\u5355\uff0c\u4f46\u662f\u6709\u6ca1\u6709\u89c9\u5f97\u4ee3\u7801\u5f88 \u5197\u4f59 \uff0c\u5dee\u4e0d\u591a\u7684\u6b65\u9aa4\u5199\u4e863\u904d\u3002\u6240\u4ee5\u8fd9\u65f6\u5019\u6211\u4eec\u5c31\u53ef\u4ee5\u628a\u91cd\u590d\u7684\u4ee3\u7801\u5265\u79bb\u51fa\u6765\uff0c\u7ec4\u6210\u4e00\u4e2a\u65b0\u7684\u65b9\u6cd5\uff0c\u6765\u770b\u770b\uff1a @staticmethod async def _insert ( session , case_id : int , user : int , form : TestCaseInfo , ** fields : tuple ): for field , model_info in fields . items (): md , model = model_info field_data = getattr ( form , field ) for f in field_data : setattr ( f , \"case_id\" , case_id ) data = model ( ** f . dict (), user = user ) await md . insert_record ( data , ss = session ) @staticmethod async def insert_test_case ( session , data : TestCaseInfo , user : int ): \"\"\" \u6d4b\u8bd5\u6570\u636e\u548c\u7528\u6237id :param data: \u6d4b\u8bd5\u7528\u4f8b\u6570\u636e :param session: \u5f02\u6b65session :param user: \u521b\u5efa\u4eba :return: \"\"\" query = await session . execute ( select ( TestCase ) . where ( TestCase . directory_id == data . case . directory_id , TestCase . name == data . case . name , TestCase . deleted_at == 0 )) if query . scalars () . first () is not None : raise Exception ( \"\u7528\u4f8b\u540d\u79f0\u5df2\u5b58\u5728\" ) cs = TestCase ( ** data . case . dict (), create_user = user ) # \u6dfb\u52a0case\uff0c\u4e4b\u540e\u6dfb\u52a0\u5176\u4ed6\u6570\u636e session . add ( cs ) await session . flush () session . expunge ( cs ) await TestCaseDao . _insert ( session , cs . id , user , data , constructor = ( ConstructorDao , Constructor ), asserts = ( TestCaseAssertsDao , TestCaseAsserts ), data = ( PityTestcaseDataDao , PityTestcaseData )) \u6211\u4eec\u91cd\u65b0\u5b9a\u4e49\u4e00\u4e2a_insert\u65b9\u6cd5\uff08\u5185\u90e8\u7528\u7684\uff09\uff0c\u63a5\u7740\u628a\u8981\u8c03\u6574\u7684\u5b57\u6bb5\u90fd\u7528\u53c2\u6570\u4f20\u5165\u8fdb\u53bb\uff0c\u8fd9\u91cc\u6bd4\u8f83\u597d\u7684\u4e00\u70b9\u662f\uff0c\u6211\u4eec\u7684\u8868\u5b9a\u4e49\u90fd\u4e00\u81f4\uff0c\u6bd4\u5982case_id\u90fd\u53ebcase_id\uff0c\u521b\u5efa/\u4fee\u6539\u7528\u6237\u90fd\u53ebuser\uff0c\u5426\u5219\u6211\u4eec\u7684\u53c2\u6570\u8fd8\u5f97\u989d\u5916\u8bbe\u8ba1\u4e00\u4e0b\u3002 \u7f16\u5199\u6dfb\u52a0\u63a5\u53e3 # v2\u7248\u672c\u521b\u5efa\u7528\u4f8b\u63a5\u53e3 @router . post ( \"/create\" , summary = \"\u521b\u5efa\u63a5\u53e3\u6d4b\u8bd5\u7528\u4f8b\" ) async def create_testcase ( data : TestCaseInfo , user_info = Depends ( Permission ()), session = Depends ( get_session )): async with session . begin (): await TestCaseDao . insert_test_case ( session , data , user_info [ 'id' ]) return PityResponse . success () \u8fd9\u91cc\u6211\u6ca1\u6709\u7528/v2/testcase/create\u8fd9\u6837\u7684\u8def\u7531\uff0c\u56e0\u4e3av2\u7684\u8bdd\uff0c\u80af\u5b9a\u662f\u5927\u6539\u7248\u4e86\uff0c\u6682\u65f6\u5c31\u5148\u8fd9\u6837\u53eb\u3002\u6ce8\u610f\u6211\u8fd9\u91cc\u6ca1\u6709\u518d\u7528 try \u5305\u88f9\u4ee3\u7801\u4e86\uff0c\u56e0\u4e3a\u6211\u4eec\u7684http\u4e2d\u95f4\u4ef6\u5df2\u7ecf\u81ea\u52a8\u505a\u4e86\u5f02\u5e38\u6355\u83b7\uff0c\u6240\u4ee5\u4ee5\u540e\u4e5f\u90fd\u4e0d\u9700\u8981\u8fd9\u4e48\u9ebb\u70e6\u4e86\u3002 \u7531\u4e8e\u65f6\u95f4\u7684\u5173\u7cfb\uff0c\u6211\u4eec\u5c31\u6682\u65f6\u6269\u5c55\u5230\u8fd9\u91cc\uff0c\u968f\u4fbf\u6d4b\u8bd5\u4e00\u4e0b: \u53d1\u73b0\u6ca1\u5565\u95ee\u9898\uff08\u5176\u5b9e\u4e2d\u95f4\u7684\u95ee\u9898\u6211\u90fd\u641e\u5b9a\u4e86\uff09\uff0c\u6536\u5de5~","title":"122.\u6539\u9020\u6dfb\u52a0\u7528\u4f8b\u9875\u9762"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28122%29%20%E6%94%B9%E9%80%A0%E6%B7%BB%E5%8A%A0%E7%94%A8%E4%BE%8B%E9%A1%B5%E9%9D%A2/#_1","text":"\u4e0a\u4e00\u8282\u6211\u4eec\u7a0d\u5fae\u4f18\u5316\u4e86\u4e00\u4e0b\u767b\u5f55\u9875\uff0c\u540e\u9762\u6211\u4eec\u53ef\u4ee5\u5f00\u59cb\u8fdb\u4e00\u6b65\u5f00\u53d1\u4e86\uff0c\u4ee5\u529f\u80fd\u70b9\u4e3a\u4e3b\u3002\u6240\u4ee5\u8fd9\u4e00\u8282\u6211\u4eec\u8981\u89e3\u51b3\u8fd9\u6837\u4e00\u4e2a\u9700\u6c42: \u5176\u5b9e\u8fd9\u4e2a\u95ee\u9898\u662f\u56e0\u4e3a http \u8bf7\u6c42\u53d1\u51fa\u53bb\u7684\u65f6\u5019\uff0c\u5e76\u6ca1\u6709\u8fdb\u884c \u5168\u5c40\u53d8\u91cf \u66ff\u6362\uff0c\u4f46\u73b0\u5728\u6709\u4e2a\u5f88\u4e25\u91cd\u7684\u95ee\u9898: \u6211\u4eec\u7684case\u90fd\u662f\u8de8\u73af\u5883\u7684\uff0c\u8fd9\u5c31\u5bfc\u81f4\u5982\u679c\u8fd9\u91cc\u586b\u4e86\u73af\u5883\u53d8\u91cf\uff0c\u4f46\u6211\u5e76\u4e0d\u77e5\u9053\u8be5\u7528\u54ea\u5957\u73af\u5883\u7684\u6570\u636e\uff0c\u800c\u4e14\u8fd9\u91cc\u4e5f\u6f0f\u4e86\u6211\u4eec\u4e4b\u524d\u7f16\u5199\u7684base_path\u529f\u80fd\u3002","title":"\u56de\u987e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28122%29%20%E6%94%B9%E9%80%A0%E6%B7%BB%E5%8A%A0%E7%94%A8%E4%BE%8B%E9%A1%B5%E9%9D%A2/#_2","text":"\u8fd9\u6b21\u7684\u65b9\u6848\u6539\u52a8\u4f1a\u5f88\u5927\uff0c\u6211\u4e2a\u4eba\u89c9\u5f97\uff0c\u65b0\u589e\u548c\u7f16\u8f91\u9875\u9762\u5b8c\u5168\u533a\u5206\u5f00\uff0c\u6bd4\u8f83\u4e0d\u5408\u9002\u3002\u800c\u4e14\u4e0d\u592a\u53cb\u597d\uff0c\u6240\u4ee5\u5728\u6dfb\u52a0case\u7684\u65f6\u5019\uff0c\u6211\u4f1a\u4ee5\u5f39\u7a97\u7684\u5f62\u5f0f\u5c55\u793a\u3002 \u8fd9\u6837\u80fd\u591f\u5c11\u8df3\u8f6c\u4e00\u6b21url\uff0c \u76f8\u5bf9\u6765\u8bf4 \u66f4\u53cb\u597d\u4e00\u4e9b\u3002\u81f3\u4e8e\u90a3\u4e48\u591a\u64cd\u4f5c\u6761\u4ef6\uff0c\u54b1\u4eec\u5c31\u4e00\u5e76\u63d0\u4ea4\u3002 \u7528\u4f8b\u4fe1\u606f \u524d\u7f6e\u6761\u4ef6 \u540e\u7f6e\u6761\u4ef6 \u65ad\u8a00 \u7ec4\u4ef6\u6211\u4eec\u662f\u4e0d\u80fd\u590d\u7528\u4e86\uff0c\u56e0\u4e3a\u4e4b\u524d\u6dfb\u52a0\u524d\u7f6e/\u540e\u7f6e/\u65ad\u8a00\uff0c\u90fd\u662f\u5728\u5df2\u6709\u7684\u7528\u4f8b\u4e0a\u6dfb\u52a0\uff0c\u73b0\u5728\u90fd\u662f \u6682\u5b58 \u5230\u524d\u7aef\uff0c\u6700\u540e\u7edf\u4e00\u63d0\u4ea4\uff0c\u6ca1\u4e8b\u6211\u4eec\u6162\u6162\u6765\uff0c\u8fdf\u65e9\u8981\u8d70\u5230\u8fd9\u4e00\u6b65\u7684\u3002","title":"\u6539\u9020\u65b9\u6848"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28122%29%20%E6%94%B9%E9%80%A0%E6%B7%BB%E5%8A%A0%E7%94%A8%E4%BE%8B%E9%A1%B5%E9%9D%A2/#_3","text":"\u540e\u7aef\u4ee3\u7801\uff0c\u6211\u4eec\u9700\u8981\u505a\u7684\u67092\u90e8\u5206: \u6279\u91cf\u63d0\u4ea4\u7528\u4f8b\u6570\u636e \u6839\u636e\u4f20\u5165\u7684\u6570\u636e\u5728\u7ebf\u6267\u884ccase\uff08\u4f9b\u8c03\u8bd5\u7528\uff0c\u8fd9\u70b9\u6bd4\u8f83\u9ebb\u70e6\uff09 \u90a3\u6211\u4eec\u5c31\u5148\u4ece\u8f6f\u67ff\u5b50\u5f00\u634f\u5427\uff0c\u56e0\u4e3a\u7b2c\u4e8c\u4e2a\u90e8\u5206\u53ef\u80fd\u8fd8\u6709\u4e9b\u95ee\u9898\uff0c\u6211\u4eec\u53ef\u4ee5\u653e\u5230\u540e\u9762\u53bb\u505a\u3002 \u9996\u5148\u6211\u4eec\u8981\u7efc\u5408\u6765\u770b\uff0c\u65b0\u589e\u662f\u5168\u90e8\u6570\u636e\u4e00\u5e76\u63d0\u4ea4\uff0c\u800c\u4fee\u6539\u5f80\u5f80\u662f\u53ea\u4fee\u6539\u4e00\u90e8\u5206\uff0c\u5176\u5b9e\u4fee\u6539\u6211\u4eec\u4e5f\u53ef\u4ee5\u6539\u4e3a \u6279\u91cf\u63d0\u4ea4 \uff0c\u4f46\u662f\u4ee3\u4ef7\u5f88\u5927\uff0c\u56e0\u4e3a\u8981\u6539\u7684\u5185\u5bb9\u591a\uff0c\u8fd8\u662f\u62bd\u51fa\u6bd4\u8f83\u5408\u9002\u3002\u8fd9\u6837\u5c31\u4f1a\u6709\u4e00\u4e2a\u95ee\u9898\u4e86\uff0c\u6211\u4eec\u7684\u524d\u7f6e\u6761\u4ef6\u7b49\u8868\u5355\uff0c\u90fd\u662f\u9700\u8981 case_id \u5b57\u6bb5\u7684\uff0c\u6240\u4ee5\u8fd9\u91cc\u6211\u4eec\u4e3a\u4e86\u65b0\u7684\u6a21\u5f0f\uff0c\u53ea\u80fd\u628a\u5b83\u6539\u6210\u975e\u5fc5\u586b\u4e86\u3002\uff08\u8fd9\u70b9\u6211\u8fd8\u6ca1\u6709\u8003\u8651\u597d\uff0c\u53ea\u662f\u521d\u6b65\u7684\u8bbe\u5b9a\uff09 \u4fee\u6539\u5404\u4e2a\u8868\u7684form \u8fd9\u91cc\u524d\u540e\u7f6e\u6761\u4ef6\u672c\u8eab\u5c31 \u5fd8\u8bb0 \u52a0\u4e0a\u8fd9\u4e2a\u7ea6\u675f\u4e86\uff0c\u6240\u4ee5\u4e5f\u4e0d\u592a\u9700\u8981\u6539\uff0c\u91cd\u70b9\u90fd\u662fvalidator\u8fd9\u4e2a\u65b9\u6cd5\u91cc\u9762\u3002 \u7f16\u5199\u5927\u6742\u70e9form \u6682\u4e14\u53ebTestCaseInfo \u5b83\u7ed3\u5408\u4e864\u79cdschema\uff0c\u6211\u6d4b\u8bd5\u4e86\u53d1\u73b0\uff0c\u4f1a\u6839\u636e\u91cc\u9762\u7684schema\u8fdb\u884c\u6821\u9a8c\uff0c\u6240\u4ee5\u6211\u4eec\u7684validator\u53ea\u9700\u8981\u6821\u9a8ccase\u5b57\u6bb5\u5373\u53ef\u3002 \u6539\u5199insert_record\u65b9\u6cd5 \u5728\u6b64\u4e4b\u524d\uff0c\u6211\u4eec\u9700\u8981\u5148\u6539\u9020\u4e0bMapper\u91cc\u9762\u7684insert_record\u65b9\u6cd5\uff0c\u7531\u4e8e\u6211\u4eec\u662f\u6279\u91cf\u63d2\u5165\uff0c\u6240\u4ee5\u9700\u8981\u7528\u4e00\u4e2a\u4e8b\u52a1\u53bb \u4fdd\u8bc1 \u6240\u6709\u6570\u636e\u8981\u4e48\u90fd\u63d2\u5165\u8981\u4e48\u90fd\u5931\u8d25\uff0c\u4e4b\u524d\u6211\u7684\u8bbe\u60f3\u662f\u5728router\u5c42\u521b\u5efasession\uff0c\u5e76\u5f00\u542f\u4e8b\u52a1\uff0c\u63a5\u7740\u628asession\u6295\u9012\u5230\u5bf9\u5e94\u7684\u63d2\u5165\u64cd\u4f5c\u4e2d\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u6539\u6539insert\u65b9\u6cd5: \u5982\u679css\uff08\u4ee3\u8868session\uff09\u4f20\u5165\u4e86\uff0c\u8bf4\u660e\u662f\u4e00\u4e2a\u4e8b\u52a1\u64cd\u4f5c\uff0c\u5176\u5b9e\u4e5f\u53ef\u4ee5\u6539\u4e2a\u540d\u5b57\u53ebtransaction\uff0c\u4f46\u662f\u56e0\u4e3a\u6211\u4eec\u8fd8\u662f\u9700\u8981\u62ff\u5230session\u4fe1\u606f\u7684\uff0c\u6240\u4ee5\u6682\u65f6\u5148\u8fd9\u4e48\u5199\u4e86\u3002\u9664\u4e86\u53c2\u6570\u591a\u4e86\u4e2ass\u4ee5\u5916\uff0c\u6ca1\u6709\u5176\u4ed6\u533a\u522b\u4e86\u3002 \u7f16\u5199insert_test_case\u65b9\u6cd5 \u5728TestCaseDao\u7c7b\u7f16\u5199insert_test_case\u65b9\u6cd5\uff0c\u4e3b\u8981\u67093\u6b65: \u5224\u65ad\u8be5\u76ee\u5f55\u662f\u5426\u5b58\u5728\u8be5case\u540d \u6dfb\u52a0case \u6dfb\u52a0\u65ad\u8a00/\u524d\u540e\u7f6e\u6761\u4ef6/\u6d4b\u8bd5\u6570\u636e @staticmethod async def insert_test_case ( session , data : TestCaseInfo , user : int ): \"\"\" \u6d4b\u8bd5\u6570\u636e\u548c\u7528\u6237id :param data: \u6d4b\u8bd5\u7528\u4f8b\u6570\u636e :param session: \u5f02\u6b65session :param user: \u521b\u5efa\u4eba :return: \"\"\" query = await session . execute ( select ( TestCase ) . where ( TestCase . directory_id == data . case . directory_id , TestCase . name == data . case . name , TestCase . deleted_at == 0 )) if query . scalars () . first () is not None : raise Exception ( \"\u7528\u4f8b\u540d\u79f0\u5df2\u5b58\u5728\" ) cs = TestCase ( ** data . case . dict (), create_user = user ) # \u6dfb\u52a0case\uff0c\u4e4b\u540e\u6dfb\u52a0\u5176\u4ed6\u6570\u636e session . add ( cs ) await session . flush () session . expunge ( cs ) # # \u6dfb\u52a0\u65ad\u8a00 for a in data . asserts : a . case_id = cs . id a = TestCaseAsserts ( ** a . dict (), user = user ) await TestCaseAssertsDao . insert_record ( a , ss = session ) # \u6dfb\u52a0\u6784\u9020\u6761\u4ef6 for c in data . constructor : c . case_id = cs . id c = Constructor ( ** c . dict (), user = user ) await ConstructorDao . insert_record ( c , ss = session ) # \u6dfb\u52a0\u6d4b\u8bd5\u6570\u636e for t in data . data : t . case_id = cs . id t = PityTestcaseData ( ** t . dict (), user = user ) await PityTestcaseDataDao . insert_record ( t , ss = session ) \u601d\u8def\u6bd4\u8f83\u7b80\u5355\uff0c\u4f46\u662f\u6709\u6ca1\u6709\u89c9\u5f97\u4ee3\u7801\u5f88 \u5197\u4f59 \uff0c\u5dee\u4e0d\u591a\u7684\u6b65\u9aa4\u5199\u4e863\u904d\u3002\u6240\u4ee5\u8fd9\u65f6\u5019\u6211\u4eec\u5c31\u53ef\u4ee5\u628a\u91cd\u590d\u7684\u4ee3\u7801\u5265\u79bb\u51fa\u6765\uff0c\u7ec4\u6210\u4e00\u4e2a\u65b0\u7684\u65b9\u6cd5\uff0c\u6765\u770b\u770b\uff1a @staticmethod async def _insert ( session , case_id : int , user : int , form : TestCaseInfo , ** fields : tuple ): for field , model_info in fields . items (): md , model = model_info field_data = getattr ( form , field ) for f in field_data : setattr ( f , \"case_id\" , case_id ) data = model ( ** f . dict (), user = user ) await md . insert_record ( data , ss = session ) @staticmethod async def insert_test_case ( session , data : TestCaseInfo , user : int ): \"\"\" \u6d4b\u8bd5\u6570\u636e\u548c\u7528\u6237id :param data: \u6d4b\u8bd5\u7528\u4f8b\u6570\u636e :param session: \u5f02\u6b65session :param user: \u521b\u5efa\u4eba :return: \"\"\" query = await session . execute ( select ( TestCase ) . where ( TestCase . directory_id == data . case . directory_id , TestCase . name == data . case . name , TestCase . deleted_at == 0 )) if query . scalars () . first () is not None : raise Exception ( \"\u7528\u4f8b\u540d\u79f0\u5df2\u5b58\u5728\" ) cs = TestCase ( ** data . case . dict (), create_user = user ) # \u6dfb\u52a0case\uff0c\u4e4b\u540e\u6dfb\u52a0\u5176\u4ed6\u6570\u636e session . add ( cs ) await session . flush () session . expunge ( cs ) await TestCaseDao . _insert ( session , cs . id , user , data , constructor = ( ConstructorDao , Constructor ), asserts = ( TestCaseAssertsDao , TestCaseAsserts ), data = ( PityTestcaseDataDao , PityTestcaseData )) \u6211\u4eec\u91cd\u65b0\u5b9a\u4e49\u4e00\u4e2a_insert\u65b9\u6cd5\uff08\u5185\u90e8\u7528\u7684\uff09\uff0c\u63a5\u7740\u628a\u8981\u8c03\u6574\u7684\u5b57\u6bb5\u90fd\u7528\u53c2\u6570\u4f20\u5165\u8fdb\u53bb\uff0c\u8fd9\u91cc\u6bd4\u8f83\u597d\u7684\u4e00\u70b9\u662f\uff0c\u6211\u4eec\u7684\u8868\u5b9a\u4e49\u90fd\u4e00\u81f4\uff0c\u6bd4\u5982case_id\u90fd\u53ebcase_id\uff0c\u521b\u5efa/\u4fee\u6539\u7528\u6237\u90fd\u53ebuser\uff0c\u5426\u5219\u6211\u4eec\u7684\u53c2\u6570\u8fd8\u5f97\u989d\u5916\u8bbe\u8ba1\u4e00\u4e0b\u3002 \u7f16\u5199\u6dfb\u52a0\u63a5\u53e3 # v2\u7248\u672c\u521b\u5efa\u7528\u4f8b\u63a5\u53e3 @router . post ( \"/create\" , summary = \"\u521b\u5efa\u63a5\u53e3\u6d4b\u8bd5\u7528\u4f8b\" ) async def create_testcase ( data : TestCaseInfo , user_info = Depends ( Permission ()), session = Depends ( get_session )): async with session . begin (): await TestCaseDao . insert_test_case ( session , data , user_info [ 'id' ]) return PityResponse . success () \u8fd9\u91cc\u6211\u6ca1\u6709\u7528/v2/testcase/create\u8fd9\u6837\u7684\u8def\u7531\uff0c\u56e0\u4e3av2\u7684\u8bdd\uff0c\u80af\u5b9a\u662f\u5927\u6539\u7248\u4e86\uff0c\u6682\u65f6\u5c31\u5148\u8fd9\u6837\u53eb\u3002\u6ce8\u610f\u6211\u8fd9\u91cc\u6ca1\u6709\u518d\u7528 try \u5305\u88f9\u4ee3\u7801\u4e86\uff0c\u56e0\u4e3a\u6211\u4eec\u7684http\u4e2d\u95f4\u4ef6\u5df2\u7ecf\u81ea\u52a8\u505a\u4e86\u5f02\u5e38\u6355\u83b7\uff0c\u6240\u4ee5\u4ee5\u540e\u4e5f\u90fd\u4e0d\u9700\u8981\u8fd9\u4e48\u9ebb\u70e6\u4e86\u3002 \u7531\u4e8e\u65f6\u95f4\u7684\u5173\u7cfb\uff0c\u6211\u4eec\u5c31\u6682\u65f6\u6269\u5c55\u5230\u8fd9\u91cc\uff0c\u968f\u4fbf\u6d4b\u8bd5\u4e00\u4e0b: \u53d1\u73b0\u6ca1\u5565\u95ee\u9898\uff08\u5176\u5b9e\u4e2d\u95f4\u7684\u95ee\u9898\u6211\u90fd\u641e\u5b9a\u4e86\uff09\uff0c\u6536\u5de5~","title":"\u7f16\u5199\u540e\u7aef\u4ee3\u7801"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28123%29%20%E7%BB%A7%E7%BB%AD%E6%94%B9%E9%80%A0%E6%B7%BB%E5%8A%A0%E7%94%A8%E4%BE%8B%E9%A1%B5%E9%9D%A2/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u4e00\u8d77\u4ea4\u6d41\u5b66\u4e60! \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u7f16\u5199\u4e86 \u63a5\u53e3 \uff0c\u4e5f\u5c31\u662f\u4e00\u6b21\u6027 \u63d2\u5165 \u5168\u90e8\u7528\u4f8b\u6570\u636e\u7684\u63a5\u53e3\u3002\u4f46\u53ea\u662f\u540e\u7aef\u6709\u4e86\u5bf9\u5e94\u7684\u6539\u9020\uff0c\u90a3\u524d\u7aef\u6211\u4eec\u8fd8\u662f\u5f97\u52a8\u624b\u7684\u3002 \u7531\u4e8e\u524d\u7aef\u6bd4\u8f83\u590d\u6742\uff0c\u6211\u8fd9\u5c31\u53ea\u8bf4\u4e00\u4e9b\u601d\u8def\u5427\uff0c\u5f53\u7136\u4e0d\u53ef\u5426\u8ba4\u7684\u662f\uff0c\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\u524d\u7aef\u4ee3\u7801\u5df2\u7ecf \u70c2\u900f\u4e86 \u3002\u6709\u4e00\u79cd\u5c4e\u5c71\u5806\u5c4e\u7684\u611f\u89c9\uff0c\u4f46\uff0c\u51d1\u5408\u6539\u6539\u5427\uff0c\u4e00\u5b9a\u8981\u628a\u673a\u4f1a\u7559\u7ed9\u4e0b\u6b21\u3002 \u4e0b\u6b21\u4e00\u5b9a~~~ \u6539\u9020\u524d\u7aef\u601d\u8def \u6539\u9020\u524d\u7aef\uff0c\u9996\u5148\u6211\u4eec\u7684\u524d\u7aef\u662f\u7531 TestCaseComponent \u7ec4\u4ef6+TestCaseBottom\u7b49\u7ec4\u4ef6\u7ec4\u6210\uff0c\u4ee5\u524d\u7684\u903b\u8f91\u662f\uff0c\u5728TestCaseComponent\u91cc\u9762\u901a\u8fc7\u4e00\u4e2a\u53c2\u6570\uff0c\u5224\u65ad\u662f \u6dfb\u52a0 \u8fd8\u662f \u7f16\u8f91 \u6a21\u5f0f\uff0c\u4f46\u73b0\u5728\u4e0d\u4e00\u6837\u4e86\uff0c\u6211\u4eec\u53ef\u4ee5\u5355\u72ec\u62bd\u51fa\u4e00\u4e2a\u7ec4\u4ef6\uff0c\u6bd4\u5982\u53eb AddTestCaseComponent.jsx \u3002\u91cc\u9762\u53ea\u9700\u8981\u5904\u7406\u6dfb\u52a0\u7684\u903b\u8f91\u5373\u53ef\uff0c\u4f46\u7531\u4e8e\u5927\u90e8\u5206\u7ec4\u4ef6\u8fd8\u662f\u6284\u7684 TestCaseComponent \uff0c\u6240\u4ee5\u5176\u5b9e \u4ee3\u7801\u91cd\u590d\u7387 \u8f83\u9ad8\uff0c\u4e0d\u8fc7\u7531\u4e8e\u65f6\u95f4\u5173\u7cfb\uff0c\u79c9\u7740 \u80fd\u7528\u5c31\u884c \u7684\u6734\u5b9e\u89c2\u70b9\uff0c\u6211\u4eec\u5148\u6682\u65f6copy\u4e00\u4efd\uff0c\u5e76\u7cbe\u7b80\u4e4b\u3002 \u63a5\u7740\u76844\u4e2atab\uff0c\u53ef\u5c31\u6bd4\u8f83\u7e41\u7410\u4e86\u3002\u6211\u4eec\u9700\u8981\u4e3a\u8fd9\u4e9b\u7ec4\u4ef6\u51c6\u5907\u4e00\u4e2acreateMode\u7684\u5b57\u6bb5\uff0c\u9ed8\u8ba4\u4e3a false \u3002\u5982\u679c\u4e3atrue\uff0c\u6211\u4eec\u5219\u9700\u8981\u8d70\u4e0d\u540c\u7684\u903b\u8f91\u3002\u6765\u770b\u770b\u4e4b\u524d\u7684\u903b\u8f91: \u6d4b\u8bd5\u6570\u636e \u6dfb\u52a0: \u6dfb\u52a0\u65f6\u7ed1\u5b9acase_id\uff0c\u5e76\u4e14\u628a\u6d4b\u8bd5\u6570\u636e\u52a0\u5230case_id\u4e0a\u3002\u90a3\u7f16\u8f91\u6a21\u5f0f\u7684\u65f6\u5019\u5462\uff1f\u6211\u4eec\u53ea\u80fd\u4e34\u65f6\u7f13\u5b58\u4e00\u4efd\u6d4b\u8bd5\u6570\u636e\uff08\u662f\u4e0d\u5e26case_id\u7684\uff0c\u56e0\u4e3acase\u8fd8\u6ca1\u521b\u5efa) \u7f16\u8f91: \u7f16\u8f91\u7684\u8bdd\uff0c\u539f\u5148\u662f\u6839\u636eid\u8fdb\u884c\u4fee\u6539\uff0c\u73b0\u5728\u7531\u4e8e\u6d4b\u8bd5\u6570\u636e\u6ca1\u6709\u5165\u5e93\uff0c\u6240\u4ee5\u53ea\u80fd\u6839\u636e\u6570\u7ec4\u7684\u7d22\u5f15\u6765\u4fee\u6539\uff0c\u975e\u5e38\u96be\u53d7\uff0c\u4f46\u4e5f\u6ca1\u529e\u6cd5\u3002 \u5220\u9664: \u539f\u5148\u9700\u8981\u76f4\u63a5\u6839\u636eid\u5220\u9664\uff0c\u73b0\u5728\u9700\u8981\u5220\u9664\u4e34\u65f6\u6570\u636e\u91cc\u5bf9\u5e94\u7684\u6570\u636e\u3002 \u6709\u4e86\u6d4b\u8bd5\u6570\u636e\u7684\u7ecf\u9a8c\uff0c\u6211\u60f3\u5176\u4ed6\u7684\u65ad\u8a00/\u524d\u540e\u7f6e\u6761\u4ef6\u9047\u5230\u7684\u95ee\u9898\u4e5f\u5c31 \u8fce\u5203\u800c\u89e3 \u4e86\u3002\u90a3\u6700\u540e\u6211\u4eec\u4f1a\u628a\u6240\u6709\u7684\u6570\u636e\u7edf\u4e00\u6c47\u603b\uff0c\u5236\u9020\u51fa\u6211\u4eec\u9700\u8981\u7684\u6a21\u677f: \u7136\u540e\u62fc\u51d1\u53c2\u6570\uff0c\u53d1\u9001\u7ed9\u540e\u7aef\u5373\u53ef\u3002 \u5173\u4e8e\u8c03\u8bd5 \u8c03\u8bd5\u529f\u80fd\u6bd4\u8f83\u590d\u6742\uff0c\u662f\u6839\u636e\u6240\u6709\u672a\u843d\u5e93\u7684\u6570\u636e\u6267\u884ccase\uff0c\u8fd9\u4e2a\u9700\u8981 \u540e\u7aef \u652f\u6301\u3002\u6682\u65f6\u6211\u4eec\u80fd\u591f\u65b0\u589e\u5373\u53ef\uff0c\u672a\u6765\u7684\u8c03\u8bd5\u8fd8\u4f1a\u652f\u6301\u53d8\u91cf\u7684\u66ff\u6362\uff0c\u80af\u5b9a\u662f\u8981\u505a\u7684\u3002 \u5173\u4e8e\u6539\u52a8 \u6539\u52a8\u7684\u5730\u65b9\u5f88\u591a\u5f88\u590d\u6742\uff0c\u8bf4\u5b9e\u8bdd\u6211\u7684 \u5fc3\u5f88\u4e71 \u3002\u4e3a\u4e86\u65b9\u4fbf\uff0c\u5927\u5bb6\u5c31\u53bbgithub\u5bf9\u7167\u6539\u52a8\u770b\u4e2a\u7a76\u7adf\u5427\u3002 \u6539\u52a8\u8be6\u60c5 \u5f53\u7136\uff0c\u6539\u7684\u8d8a\u591a\uff08bug\u8d8a\u591a\uff09\uff0cdddd\uff0c\u9047\u5230\u53ef\u4ee5\u53ca\u65f6\u7559\u8a00\u6216\u8005\u63d0issue\uff0c\u611f\u6fc0\u4e0d\u5c3d~ \u4e32\u8054\u8d77\u6765 \u5728\u505a\u4e86\u4e00\u4e9b\u8c03\u6574\u4ee5\u540e\uff0c\u6211\u4eec\u628a\u6574\u4f53\u4e32\u8054\u8d77\u6765\uff0c\u5c31\u5199\u4e2a\u7b80\u5355\u7684case\u5427: \u53ef\u4ee5\u770b\u5230\uff0c\u901f\u5ea6\u8fd8\u9614\u4ee5\uff0c\u6211\u4eec\u8fdb\u53bbcase\u7f16\u8f91\u770b\u770b: \u57fa\u672c\u6ca1\u5dee\uff0c\u90a3\u5c31\u8bf4\u660e\u6211\u4eec\u7684 \u5408\u5e76 \u63d0\u4ea4\u594f\u6548\u4e86\u3002\u611f\u5174\u8da3\u7684\u670b\u53cb\u53ef\u4ee5\u53bbgithub\u770b\u770b\u6539\u9020\uff0c\u8bf4\u5b9e\u8bdd\u4e0d\u592a\u5efa\u8bae\u770b\uff0c\u5b9e\u5728\u662fshit\u4e00\u5768\u3002= = \u4fee\u590dbug \u5728\u7f16\u7801\u8fc7\u7a0b\u4e2d\uff0c\u4ecd\u7136\u53d1\u73b0\u4e0d\u5c11bug\uff0c\u6211\u4eec\u6765\u4e00\u4e2a\u4e2a\u5904\u7406: \u65e0\u6cd5\u6279\u91cf\u5220\u9664case\u7684bug \u539f\u56e0: case\u5982\u679c\u6709\u6d4b\u8bd5\u6570\u636e\u7684\u8bdd\uff0c\u6d4b\u8bd5\u6570\u636e\u8868\u662f\u6ca1\u6709\u586b\u5199__fields__\u7b49\u5b57\u6bb5\u7684\uff0c\u5bfc\u81f4\u6ca1\u83b7\u53d6\u5230\u5bf9\u5e94\u5b57\u6bb5\u7684\u6539\u52a8\uff0c\u6240\u4ee5\u6211\u4eec\u52a0\u4e0a\u5373\u53ef\u3002 \u6279\u91cf\u5220\u9664\u4e0d\u540c\u6b65\uff0c\u6ca1\u6709\u505a\u4e8b\u52a1\u5904\u7406 \u770b\u770b\u4e4b\u524d\u7684\u6279\u91cf\u5220\u9664case: \u56e0\u4e3a\u5220\u9664\u6d4b\u8bd5\u6570\u636e\u7684\u65f6\u5019\u5931\u8d25\u4e86\uff0c\u5c31\u5bfc\u81f4case\u867d\u7136\u5220\u9664\u4e86\uff0c\u4f46\u662f \u6d4b\u8bd5\u6570\u636e \u6ca1\u5220\u9664\uff08\u602a\u5c34\u5c2c\u7684\uff09\uff0c\u6240\u4ee5\u6211\u4eec\u8fd8\u662f\u91c7\u7528\u4e8b\u52a1\u7684\u65b9\u5f0f: \u5148\u8c03\u6574\u6279\u91cf\u5220\u9664\u7684\u65b9\u6cd5\uff0c\u518d\u6539\u5199\u5220\u9664\u90e8\u5206: \u5982\u679cpython\u65b9\u6cd5\u6267\u884c\u7684\u65f6\u5019\u6ca1\u6709\u8fd4\u56de\u503c\uff0c\u62a5\u9519\u7684bug \u8fd9\u91cc\u7528.get\u66ff\u4ee3\u4e86[]\u53d6key-value\uff0c\u597d\u5904\u662f\u6ca1\u6709\u8bbe\u7f6e \u8fd4\u56de\u503c \u7684\u65f6\u5019\u4e0d\u4f1a\u56e0\u4e3akey error\u5bfc\u81f4case\u6267\u884c\u5931\u8d25\u3002 \u4eca\u5929\u7684\u5185\u5bb9\u5c31\u5230\u8fd9\u91cc\u5566\uff0c\u4e0b\u4e00\u8282\u662f\u4ec0\u4e48\uff0c\u6682\u65f6\u8fd8\u4e0d\u77e5\u9053\u3002","title":"123.\u7ee7\u7eed\u6539\u9020\u6dfb\u52a0\u7528\u4f8b\u9875\u9762"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28123%29%20%E7%BB%A7%E7%BB%AD%E6%94%B9%E9%80%A0%E6%B7%BB%E5%8A%A0%E7%94%A8%E4%BE%8B%E9%A1%B5%E9%9D%A2/#_1","text":"\u4e0a\u4e00\u8282\u6211\u4eec\u7f16\u5199\u4e86 \u63a5\u53e3 \uff0c\u4e5f\u5c31\u662f\u4e00\u6b21\u6027 \u63d2\u5165 \u5168\u90e8\u7528\u4f8b\u6570\u636e\u7684\u63a5\u53e3\u3002\u4f46\u53ea\u662f\u540e\u7aef\u6709\u4e86\u5bf9\u5e94\u7684\u6539\u9020\uff0c\u90a3\u524d\u7aef\u6211\u4eec\u8fd8\u662f\u5f97\u52a8\u624b\u7684\u3002 \u7531\u4e8e\u524d\u7aef\u6bd4\u8f83\u590d\u6742\uff0c\u6211\u8fd9\u5c31\u53ea\u8bf4\u4e00\u4e9b\u601d\u8def\u5427\uff0c\u5f53\u7136\u4e0d\u53ef\u5426\u8ba4\u7684\u662f\uff0c\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\u524d\u7aef\u4ee3\u7801\u5df2\u7ecf \u70c2\u900f\u4e86 \u3002\u6709\u4e00\u79cd\u5c4e\u5c71\u5806\u5c4e\u7684\u611f\u89c9\uff0c\u4f46\uff0c\u51d1\u5408\u6539\u6539\u5427\uff0c\u4e00\u5b9a\u8981\u628a\u673a\u4f1a\u7559\u7ed9\u4e0b\u6b21\u3002 \u4e0b\u6b21\u4e00\u5b9a~~~","title":"\u56de\u987e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28123%29%20%E7%BB%A7%E7%BB%AD%E6%94%B9%E9%80%A0%E6%B7%BB%E5%8A%A0%E7%94%A8%E4%BE%8B%E9%A1%B5%E9%9D%A2/#_2","text":"\u6539\u9020\u524d\u7aef\uff0c\u9996\u5148\u6211\u4eec\u7684\u524d\u7aef\u662f\u7531 TestCaseComponent \u7ec4\u4ef6+TestCaseBottom\u7b49\u7ec4\u4ef6\u7ec4\u6210\uff0c\u4ee5\u524d\u7684\u903b\u8f91\u662f\uff0c\u5728TestCaseComponent\u91cc\u9762\u901a\u8fc7\u4e00\u4e2a\u53c2\u6570\uff0c\u5224\u65ad\u662f \u6dfb\u52a0 \u8fd8\u662f \u7f16\u8f91 \u6a21\u5f0f\uff0c\u4f46\u73b0\u5728\u4e0d\u4e00\u6837\u4e86\uff0c\u6211\u4eec\u53ef\u4ee5\u5355\u72ec\u62bd\u51fa\u4e00\u4e2a\u7ec4\u4ef6\uff0c\u6bd4\u5982\u53eb AddTestCaseComponent.jsx \u3002\u91cc\u9762\u53ea\u9700\u8981\u5904\u7406\u6dfb\u52a0\u7684\u903b\u8f91\u5373\u53ef\uff0c\u4f46\u7531\u4e8e\u5927\u90e8\u5206\u7ec4\u4ef6\u8fd8\u662f\u6284\u7684 TestCaseComponent \uff0c\u6240\u4ee5\u5176\u5b9e \u4ee3\u7801\u91cd\u590d\u7387 \u8f83\u9ad8\uff0c\u4e0d\u8fc7\u7531\u4e8e\u65f6\u95f4\u5173\u7cfb\uff0c\u79c9\u7740 \u80fd\u7528\u5c31\u884c \u7684\u6734\u5b9e\u89c2\u70b9\uff0c\u6211\u4eec\u5148\u6682\u65f6copy\u4e00\u4efd\uff0c\u5e76\u7cbe\u7b80\u4e4b\u3002 \u63a5\u7740\u76844\u4e2atab\uff0c\u53ef\u5c31\u6bd4\u8f83\u7e41\u7410\u4e86\u3002\u6211\u4eec\u9700\u8981\u4e3a\u8fd9\u4e9b\u7ec4\u4ef6\u51c6\u5907\u4e00\u4e2acreateMode\u7684\u5b57\u6bb5\uff0c\u9ed8\u8ba4\u4e3a false \u3002\u5982\u679c\u4e3atrue\uff0c\u6211\u4eec\u5219\u9700\u8981\u8d70\u4e0d\u540c\u7684\u903b\u8f91\u3002\u6765\u770b\u770b\u4e4b\u524d\u7684\u903b\u8f91: \u6d4b\u8bd5\u6570\u636e \u6dfb\u52a0: \u6dfb\u52a0\u65f6\u7ed1\u5b9acase_id\uff0c\u5e76\u4e14\u628a\u6d4b\u8bd5\u6570\u636e\u52a0\u5230case_id\u4e0a\u3002\u90a3\u7f16\u8f91\u6a21\u5f0f\u7684\u65f6\u5019\u5462\uff1f\u6211\u4eec\u53ea\u80fd\u4e34\u65f6\u7f13\u5b58\u4e00\u4efd\u6d4b\u8bd5\u6570\u636e\uff08\u662f\u4e0d\u5e26case_id\u7684\uff0c\u56e0\u4e3acase\u8fd8\u6ca1\u521b\u5efa) \u7f16\u8f91: \u7f16\u8f91\u7684\u8bdd\uff0c\u539f\u5148\u662f\u6839\u636eid\u8fdb\u884c\u4fee\u6539\uff0c\u73b0\u5728\u7531\u4e8e\u6d4b\u8bd5\u6570\u636e\u6ca1\u6709\u5165\u5e93\uff0c\u6240\u4ee5\u53ea\u80fd\u6839\u636e\u6570\u7ec4\u7684\u7d22\u5f15\u6765\u4fee\u6539\uff0c\u975e\u5e38\u96be\u53d7\uff0c\u4f46\u4e5f\u6ca1\u529e\u6cd5\u3002 \u5220\u9664: \u539f\u5148\u9700\u8981\u76f4\u63a5\u6839\u636eid\u5220\u9664\uff0c\u73b0\u5728\u9700\u8981\u5220\u9664\u4e34\u65f6\u6570\u636e\u91cc\u5bf9\u5e94\u7684\u6570\u636e\u3002 \u6709\u4e86\u6d4b\u8bd5\u6570\u636e\u7684\u7ecf\u9a8c\uff0c\u6211\u60f3\u5176\u4ed6\u7684\u65ad\u8a00/\u524d\u540e\u7f6e\u6761\u4ef6\u9047\u5230\u7684\u95ee\u9898\u4e5f\u5c31 \u8fce\u5203\u800c\u89e3 \u4e86\u3002\u90a3\u6700\u540e\u6211\u4eec\u4f1a\u628a\u6240\u6709\u7684\u6570\u636e\u7edf\u4e00\u6c47\u603b\uff0c\u5236\u9020\u51fa\u6211\u4eec\u9700\u8981\u7684\u6a21\u677f: \u7136\u540e\u62fc\u51d1\u53c2\u6570\uff0c\u53d1\u9001\u7ed9\u540e\u7aef\u5373\u53ef\u3002","title":"\u6539\u9020\u524d\u7aef\u601d\u8def"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28123%29%20%E7%BB%A7%E7%BB%AD%E6%94%B9%E9%80%A0%E6%B7%BB%E5%8A%A0%E7%94%A8%E4%BE%8B%E9%A1%B5%E9%9D%A2/#_3","text":"\u8c03\u8bd5\u529f\u80fd\u6bd4\u8f83\u590d\u6742\uff0c\u662f\u6839\u636e\u6240\u6709\u672a\u843d\u5e93\u7684\u6570\u636e\u6267\u884ccase\uff0c\u8fd9\u4e2a\u9700\u8981 \u540e\u7aef \u652f\u6301\u3002\u6682\u65f6\u6211\u4eec\u80fd\u591f\u65b0\u589e\u5373\u53ef\uff0c\u672a\u6765\u7684\u8c03\u8bd5\u8fd8\u4f1a\u652f\u6301\u53d8\u91cf\u7684\u66ff\u6362\uff0c\u80af\u5b9a\u662f\u8981\u505a\u7684\u3002","title":"\u5173\u4e8e\u8c03\u8bd5"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28123%29%20%E7%BB%A7%E7%BB%AD%E6%94%B9%E9%80%A0%E6%B7%BB%E5%8A%A0%E7%94%A8%E4%BE%8B%E9%A1%B5%E9%9D%A2/#_4","text":"\u6539\u52a8\u7684\u5730\u65b9\u5f88\u591a\u5f88\u590d\u6742\uff0c\u8bf4\u5b9e\u8bdd\u6211\u7684 \u5fc3\u5f88\u4e71 \u3002\u4e3a\u4e86\u65b9\u4fbf\uff0c\u5927\u5bb6\u5c31\u53bbgithub\u5bf9\u7167\u6539\u52a8\u770b\u4e2a\u7a76\u7adf\u5427\u3002 \u6539\u52a8\u8be6\u60c5 \u5f53\u7136\uff0c\u6539\u7684\u8d8a\u591a\uff08bug\u8d8a\u591a\uff09\uff0cdddd\uff0c\u9047\u5230\u53ef\u4ee5\u53ca\u65f6\u7559\u8a00\u6216\u8005\u63d0issue\uff0c\u611f\u6fc0\u4e0d\u5c3d~","title":"\u5173\u4e8e\u6539\u52a8"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28123%29%20%E7%BB%A7%E7%BB%AD%E6%94%B9%E9%80%A0%E6%B7%BB%E5%8A%A0%E7%94%A8%E4%BE%8B%E9%A1%B5%E9%9D%A2/#_5","text":"\u5728\u505a\u4e86\u4e00\u4e9b\u8c03\u6574\u4ee5\u540e\uff0c\u6211\u4eec\u628a\u6574\u4f53\u4e32\u8054\u8d77\u6765\uff0c\u5c31\u5199\u4e2a\u7b80\u5355\u7684case\u5427: \u53ef\u4ee5\u770b\u5230\uff0c\u901f\u5ea6\u8fd8\u9614\u4ee5\uff0c\u6211\u4eec\u8fdb\u53bbcase\u7f16\u8f91\u770b\u770b: \u57fa\u672c\u6ca1\u5dee\uff0c\u90a3\u5c31\u8bf4\u660e\u6211\u4eec\u7684 \u5408\u5e76 \u63d0\u4ea4\u594f\u6548\u4e86\u3002\u611f\u5174\u8da3\u7684\u670b\u53cb\u53ef\u4ee5\u53bbgithub\u770b\u770b\u6539\u9020\uff0c\u8bf4\u5b9e\u8bdd\u4e0d\u592a\u5efa\u8bae\u770b\uff0c\u5b9e\u5728\u662fshit\u4e00\u5768\u3002= =","title":"\u4e32\u8054\u8d77\u6765"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28123%29%20%E7%BB%A7%E7%BB%AD%E6%94%B9%E9%80%A0%E6%B7%BB%E5%8A%A0%E7%94%A8%E4%BE%8B%E9%A1%B5%E9%9D%A2/#bug","text":"\u5728\u7f16\u7801\u8fc7\u7a0b\u4e2d\uff0c\u4ecd\u7136\u53d1\u73b0\u4e0d\u5c11bug\uff0c\u6211\u4eec\u6765\u4e00\u4e2a\u4e2a\u5904\u7406: \u65e0\u6cd5\u6279\u91cf\u5220\u9664case\u7684bug \u539f\u56e0: case\u5982\u679c\u6709\u6d4b\u8bd5\u6570\u636e\u7684\u8bdd\uff0c\u6d4b\u8bd5\u6570\u636e\u8868\u662f\u6ca1\u6709\u586b\u5199__fields__\u7b49\u5b57\u6bb5\u7684\uff0c\u5bfc\u81f4\u6ca1\u83b7\u53d6\u5230\u5bf9\u5e94\u5b57\u6bb5\u7684\u6539\u52a8\uff0c\u6240\u4ee5\u6211\u4eec\u52a0\u4e0a\u5373\u53ef\u3002 \u6279\u91cf\u5220\u9664\u4e0d\u540c\u6b65\uff0c\u6ca1\u6709\u505a\u4e8b\u52a1\u5904\u7406 \u770b\u770b\u4e4b\u524d\u7684\u6279\u91cf\u5220\u9664case: \u56e0\u4e3a\u5220\u9664\u6d4b\u8bd5\u6570\u636e\u7684\u65f6\u5019\u5931\u8d25\u4e86\uff0c\u5c31\u5bfc\u81f4case\u867d\u7136\u5220\u9664\u4e86\uff0c\u4f46\u662f \u6d4b\u8bd5\u6570\u636e \u6ca1\u5220\u9664\uff08\u602a\u5c34\u5c2c\u7684\uff09\uff0c\u6240\u4ee5\u6211\u4eec\u8fd8\u662f\u91c7\u7528\u4e8b\u52a1\u7684\u65b9\u5f0f: \u5148\u8c03\u6574\u6279\u91cf\u5220\u9664\u7684\u65b9\u6cd5\uff0c\u518d\u6539\u5199\u5220\u9664\u90e8\u5206: \u5982\u679cpython\u65b9\u6cd5\u6267\u884c\u7684\u65f6\u5019\u6ca1\u6709\u8fd4\u56de\u503c\uff0c\u62a5\u9519\u7684bug \u8fd9\u91cc\u7528.get\u66ff\u4ee3\u4e86[]\u53d6key-value\uff0c\u597d\u5904\u662f\u6ca1\u6709\u8bbe\u7f6e \u8fd4\u56de\u503c \u7684\u65f6\u5019\u4e0d\u4f1a\u56e0\u4e3akey error\u5bfc\u81f4case\u6267\u884c\u5931\u8d25\u3002 \u4eca\u5929\u7684\u5185\u5bb9\u5c31\u5230\u8fd9\u91cc\u5566\uff0c\u4e0b\u4e00\u8282\u662f\u4ec0\u4e48\uff0c\u6682\u65f6\u8fd8\u4e0d\u77e5\u9053\u3002","title":"\u4fee\u590dbug"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28124%29%20%E5%AD%A6%E4%BC%9A%E7%BB%99%E8%87%AA%E5%B7%B1review%E4%BB%A3%E7%A0%81/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u4e00\u8d77\u4ea4\u6d41\u5b66\u4e60! \u56de\u987e \u597d\u4e45\u4e0d\u89c1\uff0c\u4e0a\u4e00\u8282\u6211\u4eec\u5b8c\u6210\u4e86 \u524d\u7aef \u6dfb\u52a0\u7528\u4f8b\u76f8\u5173\u529f\u80fd\u7684\u6539\u9020\uff0c\u867d\u7136\u8fd8\u662f\u4e0d\u592a\u6ee1\u610f\uff0c\u4f46\u4e5f\u8fd8\u8fc7\u5f97\u53bb\u4e86\uff0c\u8d77\u7801\u7a0d\u5fae\u987a\u624b\u4e86 \u4e00\u70b9\u70b9 \u3002 \u6709\u65f6\u5019\u6211\u5e38\u5e38\u611f\u53f9 \u65f6\u95f4 \u662f\u5982\u6b64\u4e0d\u591f\u7528\u3002\u81ea\u5df1\u7684\u6559\u7a0b\u867d\u7136\u575a\u6301\u4e86\u5f88\u4e45\uff0c\u4f46\u4eff\u4f5b\u6709\u70b9\u66f4\u4e0d\u4e0b\u53bb\u7684\u8ff9\u8c61\u3002 \u60f3\u6cd5\u7279\u522b\u591a\uff0c\u60f3\u505amock\u5e73\u53f0\uff0c\u6570\u636e\u5de5\u5382\uff0c\u53c8\u89c9\u5f97\u505a\u4e86\u9700\u8981\u8865\u4e2a\u6559\u7a0b\u3002\u60f3\u505a\u4e00\u4e2a\u7c7btesterhome\u7684\u7f51\u7ad9\uff0c\u53c8\u89c9\u5f97\u5149\u505a\u4e0d\u8bb2\u6ca1\u610f\u601d\u3002\u4f46\u5bf9\u6211\u6765\u8bf4\uff0c\u5185\u5bb9\u8fd9\u4e48\u591a\uff0c\u786e\u5b9e\u6709\u70b9\u5206\u8eab\u4e4f\u672f\u3002 \u6709\u65f6\u5019\u60f3\u7740\uff0c\u5e72\u8106\u81ea\u5df1\u6084\u54aa\u54aa\u505a\u5427\uff0c\u4e5f\u4e0d\u505a\u5565\u5206\u4eab\uff0c\u4e0d\u505a\u5565\u89c6\u9891\u4e86\u3002\u4f46\u4e00\u60f3\u5230\u5199\u6587\u7ae0/\u505a\u89c6\u9891\uff0c\u5e2e\u52a9\u4ed6\u4eba\uff0c\u6211\u8fd8\u662f \u633a\u5f00\u5fc3\u7684 \u3002\u5176\u5b9e\u8fd9\u6761\u8def\u8fd8\u771f\u7684\u662f\u633a\u96be\u575a\u6301\u7684\uff0c\u5982\u679c\u80fd\u4e00\u4e0b\u5b50\u67093\u4e2a\u6211\u5c31\u597d\u4e86=\u3002= \u8fdb\u5165\u6b63\u9898 \u968f\u7740pity\u7684\u57fa\u7840\u529f\u80fd\u8d8a\u6765\u8d8a \u5b8c\u5584 \uff0c\u6211\u4e5f\u6e10\u6e10\u6253\u8d77\u4e86\u4f18\u5316\u7684\u4e3b\u610f\u3002\u6709\u65f6\u5019\u81ea\u5df1\u4e3a\u4e86\u5e94\u4ed8\u4e00\u4e2a\u529f\u80fd\uff0c\u4f1a\u5f88\u968f\u610f\u5199\u4e00\u4e9b\u4ee3\u7801\uff0c\u6709\u70b9 \u5806\u5c4e\u5c71 \u7684\u610f\u601d\u3002 \u6240\u4ee5\u4eca\u5929\u6211\u82b1\u4e86\u4e00\u70b9\u65f6\u95f4\uff0c\u7ed9\u81ea\u5df1review\u4e86\u4e00\u4e0b\u4ee3\u7801\uff0c\u4e5f\u53ef\u4ee5\u7ed9\u5927\u5bb6\u4e00\u70b9\u53c2\u8003\u3002\u6211\u4eec\u53ea\u6709\u9605\u8bfb\u8fc7\u66f4\u591a\u7684\u4ee3\u7801\uff0c\u624d\u80fd\u5199\u51fa\u66f4\u597d\u7684\u4ee3\u7801\u3002\u4e5f\u8bb8\u5199\u7684\u65f6\u5019\u662f\u968f\u610f\u7684\uff0c\u4f46\u4e8b\u540e\u80af\u5b9a\u662f\u80fd \u627e\u51fa\u95ee\u9898 \u7684\u3002 \u4f18\u5316/\u5efa\u8bae \u4ee5\u4e0b\u5185\u5bb9\u5927\u591a\u662f\u81ea\u5df1\u7684\u7ecf\u9a8c\uff0c\u4e5f\u53ef\u80fd\u6709\u4e0d\u5bf9\u7684\u5730\u65b9\uff0c\u4ec5\u4f9b\u53c2\u8003\uff0c \u4e0d\u559c\u8f7b\u55b7 \u3002 magic number\u592a\u591a \u8fd9\u91cc\u6307\u7684\u662f\uff0c\u6211\u4eec \u968f\u624b\u6dfb\u52a0 \u7684\u53ef\u91cd\u590d\u4f7f\u7528\u7684\u4e00\u4e9b\u6570\u5b57\uff0c\u5f80\u597d\u4e86\u8bf4\u5e94\u8be5\u662f\u9700\u8981\u62bd\u51fa\u6765\u4f5c\u4e3a\u4e00\u4e2a \u5e38\u91cf \u6216 \u53d8\u91cf \u7684\u3002 \u6765\u770b\u70b9\u4f8b\u5b50: \u968f\u4fbf\u4e00\u641c\u7d22\uff0c\u5c31\u80fd\u770b\u5230\u5f88\u591a\u8fd9\u79cd1,2\u8fd9\u6837\u7684\u6570\uff0c\u8bed\u4e49\u4e0d\u660e\u786e\uff0c\u5b8c\u5168\u53ef\u4ee5 \u5b9a\u4e49\u4e00\u4e2a\u679a\u4e3e\u7c7b \u4f7f\u5f97\u4ee3\u7801\u66f4\u6709 \u53ef\u8bfb\u6027 \u3002 \u53ef\u6015\u7684\u662f\uff0c\u641c\u7d22\u76f8\u5173\u4f8b\u5b50\uff0c\u8fd8\u80fd\u51fa\u6765\u597d\u51e0\u4e2a\u8fd9\u6837\u7684\u4f8b\u5b50\uff0c\u8bf4\u660e\u4e4b\u524d\u771f\u7684\u5c31\u662f \u968f\u5fc3\u6240\u6b32 \u5730\u5199\u3002 \u672a\u6307\u5b9a\u8fd4\u56de\u503c\uff0c\u53c2\u6570\u672a\u6dfb\u52a0\u7c7b\u578b\uff0c\u90e8\u5206\u65b9\u6cd5\u6ca1\u6709\u6587\u6863 \u770b\u770b\u6211\u622a\u56fe\u76842\u4e2a\u65b9\u6cd5\uff0c\u4e0b\u9762\u90a3\u4e2a\u65b9\u6cd5\u5c31\u6ca1\u6709\u76f8\u5173\u6ce8\u91ca\uff08\u65b9\u6cd5\u63cf\u8ff0\uff09\uff0c\u5728\u65b9\u6cd5\u53c2\u6570\u4e5f\u6ca1\u6709 \u6307\u5b9a\u7c7b\u578b \uff0c\u4e5f\u6ca1\u6709\u6307\u5b9a\u8fd4\u56de\u503c\u3002 \u5148\u6765\u8bf4\u8bf4\u6307\u5b9a\u7c7b\u578b\u7684\u597d\u5904: \u7f16\u8bd1\u5668\u667a\u80fd\u63d0\u793a\uff0c\u5f53\u7c7b\u578b\u4e0d\u5339\u914d\uff08\u6bd4\u5982\u4f60\u6362\u4e86\u53c2\u6570\u987a\u5e8f\uff0c\u4f46\u8c03\u7528\u7684\u65f6\u5019\u6ca1\u6362\u987a\u5e8f\uff0c\u8fd9\u65f6\u5019\u7f16\u8f91\u5668\u4f1a\u7ed9\u51fa\u63d0\u793a\uff09 \u6307\u5b9a\u8fd4\u56de\u503c\uff0c\u9053\u7406\u540c\u4e0a\uff0c\u66f4\u597d\u7684\u4e00\u70b9\u662f\u53ef\u4ee5\u667a\u80fd\u8865\u5168 \u6ce8\u91ca\u7684\u610f\u4e49\u5c31\u4e0d\u7528\u6211\u591a\u8bf4\u4e86\u5427\uff0c\u5efa\u8bae\u6bcf\u4e2a\u65b9\u6cd5\u90fd\u6216\u591a\u6216\u5c11\u52a0\u70b9\u6ce8\u91ca\uff0c\u4f5c\u4e3a\u4e00\u4e2a\u5f00\u6e90\u7684\u9879\u76ee\uff0c\u8fd9\u70b9\u8bf4\u660e\u8fd8\u662f\u8981\u6709\u7684\uff0c\u4e0d\u7136\u5230\u65f6\u5019\u53ef\u80fd\u81ea\u5df1\u90fd \u8bfb\u4e0d\u61c2 \u4e86\u3002 \u6539\u6389go\u7684if err != nil\u7684\u5199\u6cd5 \u7531\u4e8e\u9879\u76ee\u521d\u671f\u7684\u6211\uff0c\u5199go\u6bd4\u8f83\u591a\uff0c\u5bfc\u81f4\u6211\u4e60\u60ef\u6027\u5b9a\u4e49\u65b9\u6cd5\u7684\u8fd4\u56de\u503c\u4e3a\u5177\u4f53\u7684\u8fd4\u56de+ err \uff0c\u8fd9\u6837\u7684\u4e60\u60ef\u5f88\u4e0d\u597d\uff0c\u5199\u5230Python\u91cc\u9762\u5c31\u662f \u56db\u4e0d\u50cf \u3002 \u591a\u5c01\u88c5\u81ea\u5b9a\u4e49Exception \u5f02\u5e38\u4e0d\u80fd\u7edf\u4e00\u90fd\u7528Exception\uff0c\u867d\u7136\u7528\u8d77\u6765\u6ca1\u5565\u6bdb\u75c5\uff0c\u4f46\u5982\u679c\u80fd\u51c6\u786e\u5b9a\u4e49\u67d0\u4e00\u79cd\u5f02\u5e38\uff0c\u6bd4\u5982 \u8ba4\u8bc1\u5f02\u5e38 \uff0c \u6570\u636e\u627e\u4e0d\u5230\u5f02\u5e38 , \u6743\u9650\u4e0d\u591f\u5f02\u5e38 \u7b49\u7b49\uff0c\u8fd9\u6837\u9047\u5230\u5f02\u5e38\u5c31\u77e5\u9053\u662f\u5565\u9519\uff0c\u591a\u5b66\u5b66\u522b\u4eba\u5c01\u88c5\u7684 \u5f02\u5e38\u7c7b \u3002 \u8fd9\u91cc\u5efa\u8baeraise DbConnectionException(\"xxx\") \u4e0d\u7528\u7684\u53d8\u91cf\u5efa\u8bae\u7528\u4e0b\u5212\u7ebf\u4ee3\u66ff \u4e0d\u540c\u4e8ego\u8bed\u8a00\u7684\u5f3a\u5236\u4f7f\u7528\u5b9a\u4e49\u7684\u53d8\u91cf\uff0cPython\u53ef\u4ee5\u53ea\u5b9a\u4e49\u4f46\u4e0d\u4f7f\u7528 \u53d8\u91cf \u3002\u8fd8\u662f\u4e0a\u9762\u90a3\u4e2a\u65b9\u6cd5\uff0c\u770b\u5230user_info\u4e86\u5417\uff1f \u8fd9\u4e2a\u65b9\u6cd5\u662f\u4e2a\u9274\u6743\u7684\u65b9\u6cd5\uff0c\u867d\u7136\u6211\u4eec\u4e0d\u83b7\u53d6 \u7528\u6237\u4fe1\u606f \uff0c\u4f46\u662f\u6211\u4eec\u8fd8\u662f\u9700\u8981\u7528\u6237\u767b\u5f55\u540e\u624d\u80fd\u5b8c\u6210\u6b64\u64cd\u4f5c\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u628a\u53d8\u91cfuser_info\u6539\u4e3a_ \u8fd9\u6837pycharm\u4e5f\u4e0d\u518d\u62a5 \u672a\u4f7f\u7528 \u7684\u63d0\u793a\u4e86\u3002 \u591a\u7528\u683c\u5f0f\u5316/\u5f15\u7528\u4f18\u5316 \u7531\u4e8e\u6211\u81ea\u5df1\u5199\u4ee3\u7801\u6bd4\u8f83\u6ce8\u610f\u8fd9\u4e00\u5757\uff0c\u6240\u4ee5\u6211\u4f1a\u4e60\u60ef\u6027\u505a\u8fd92\u4ef6\u4e8b\uff0c\u4e5f\u5c31\u662fCTRL+ALT+L\u548cCTRL+ALT+O(\u5b57\u6bcdo) \u591a\u719f\u6089pydantic \u5bf9\u4e8e\u6211\u800c\u8a00\uff0cpydantic\u4ec5\u4ec5\u7528\u6765\u5f53\u505a \u53c2\u6570\u6821\u9a8c\u5de5\u5177 \uff0c\u4f46\u5176\u5b9e\u5e76\u4e0d\u662f\u8fd9\u6837\uff0cpydantic\u5176\u5b9e\u4e5f\u53ef\u4ee5\u6307\u5b9a\u5177\u4f53\u8981\u8fd4\u56de\u7684\u5b57\u6bb5\uff0c\u901a\u8fc7response_model\u5f62\u6210 \u95ed\u73af \uff0c\u5b8c\u6210\u6574\u4e2arequest\u7684 \u751f\u547d\u5468\u671f \u3002 \u4ee5\u4e0a\uff0c\u5c31\u662f\u6211\u4eca\u5929\u9605\u8bfb\u81ea\u5df1\u4ee3\u7801\u627e\u51fa\u7684 \u4e00\u4e9b \u4f18\u5316\u70b9\uff0c\u5e0c\u671b\u80fd\u5bf9\u5927\u5bb6\u6709\u6240\u5e2e\u52a9\u3002\u7ecf\u5e38 \u5eb7\u5eb7 \u81ea\u5df1\u7684\u4ee3\u7801\uff0c\u4e5f\u662f\u6709\u597d\u5904\u7684~ \u6211\u662f\u7c73\u6d1b\uff0c\u4e00\u76f4\u966a\u4f34\u5404\u4f4d\u5b66\u4e60\uff01\u514d\u8d39\u7684 \u5c0f\u9ec4\u5fc3 \uff0c\u5e2e\u6211\u70b9\u4e00\u4e2a\u5427\uff01 \u9879\u76ee\u5730\u5740: https://github.com/wuranxu/pity","title":"124.\u5b66\u4f1a\u7ed9\u81ea\u5df1review\u4ee3\u7801"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28124%29%20%E5%AD%A6%E4%BC%9A%E7%BB%99%E8%87%AA%E5%B7%B1review%E4%BB%A3%E7%A0%81/#_1","text":"\u597d\u4e45\u4e0d\u89c1\uff0c\u4e0a\u4e00\u8282\u6211\u4eec\u5b8c\u6210\u4e86 \u524d\u7aef \u6dfb\u52a0\u7528\u4f8b\u76f8\u5173\u529f\u80fd\u7684\u6539\u9020\uff0c\u867d\u7136\u8fd8\u662f\u4e0d\u592a\u6ee1\u610f\uff0c\u4f46\u4e5f\u8fd8\u8fc7\u5f97\u53bb\u4e86\uff0c\u8d77\u7801\u7a0d\u5fae\u987a\u624b\u4e86 \u4e00\u70b9\u70b9 \u3002 \u6709\u65f6\u5019\u6211\u5e38\u5e38\u611f\u53f9 \u65f6\u95f4 \u662f\u5982\u6b64\u4e0d\u591f\u7528\u3002\u81ea\u5df1\u7684\u6559\u7a0b\u867d\u7136\u575a\u6301\u4e86\u5f88\u4e45\uff0c\u4f46\u4eff\u4f5b\u6709\u70b9\u66f4\u4e0d\u4e0b\u53bb\u7684\u8ff9\u8c61\u3002 \u60f3\u6cd5\u7279\u522b\u591a\uff0c\u60f3\u505amock\u5e73\u53f0\uff0c\u6570\u636e\u5de5\u5382\uff0c\u53c8\u89c9\u5f97\u505a\u4e86\u9700\u8981\u8865\u4e2a\u6559\u7a0b\u3002\u60f3\u505a\u4e00\u4e2a\u7c7btesterhome\u7684\u7f51\u7ad9\uff0c\u53c8\u89c9\u5f97\u5149\u505a\u4e0d\u8bb2\u6ca1\u610f\u601d\u3002\u4f46\u5bf9\u6211\u6765\u8bf4\uff0c\u5185\u5bb9\u8fd9\u4e48\u591a\uff0c\u786e\u5b9e\u6709\u70b9\u5206\u8eab\u4e4f\u672f\u3002 \u6709\u65f6\u5019\u60f3\u7740\uff0c\u5e72\u8106\u81ea\u5df1\u6084\u54aa\u54aa\u505a\u5427\uff0c\u4e5f\u4e0d\u505a\u5565\u5206\u4eab\uff0c\u4e0d\u505a\u5565\u89c6\u9891\u4e86\u3002\u4f46\u4e00\u60f3\u5230\u5199\u6587\u7ae0/\u505a\u89c6\u9891\uff0c\u5e2e\u52a9\u4ed6\u4eba\uff0c\u6211\u8fd8\u662f \u633a\u5f00\u5fc3\u7684 \u3002\u5176\u5b9e\u8fd9\u6761\u8def\u8fd8\u771f\u7684\u662f\u633a\u96be\u575a\u6301\u7684\uff0c\u5982\u679c\u80fd\u4e00\u4e0b\u5b50\u67093\u4e2a\u6211\u5c31\u597d\u4e86=\u3002=","title":"\u56de\u987e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28124%29%20%E5%AD%A6%E4%BC%9A%E7%BB%99%E8%87%AA%E5%B7%B1review%E4%BB%A3%E7%A0%81/#_2","text":"\u968f\u7740pity\u7684\u57fa\u7840\u529f\u80fd\u8d8a\u6765\u8d8a \u5b8c\u5584 \uff0c\u6211\u4e5f\u6e10\u6e10\u6253\u8d77\u4e86\u4f18\u5316\u7684\u4e3b\u610f\u3002\u6709\u65f6\u5019\u81ea\u5df1\u4e3a\u4e86\u5e94\u4ed8\u4e00\u4e2a\u529f\u80fd\uff0c\u4f1a\u5f88\u968f\u610f\u5199\u4e00\u4e9b\u4ee3\u7801\uff0c\u6709\u70b9 \u5806\u5c4e\u5c71 \u7684\u610f\u601d\u3002 \u6240\u4ee5\u4eca\u5929\u6211\u82b1\u4e86\u4e00\u70b9\u65f6\u95f4\uff0c\u7ed9\u81ea\u5df1review\u4e86\u4e00\u4e0b\u4ee3\u7801\uff0c\u4e5f\u53ef\u4ee5\u7ed9\u5927\u5bb6\u4e00\u70b9\u53c2\u8003\u3002\u6211\u4eec\u53ea\u6709\u9605\u8bfb\u8fc7\u66f4\u591a\u7684\u4ee3\u7801\uff0c\u624d\u80fd\u5199\u51fa\u66f4\u597d\u7684\u4ee3\u7801\u3002\u4e5f\u8bb8\u5199\u7684\u65f6\u5019\u662f\u968f\u610f\u7684\uff0c\u4f46\u4e8b\u540e\u80af\u5b9a\u662f\u80fd \u627e\u51fa\u95ee\u9898 \u7684\u3002","title":"\u8fdb\u5165\u6b63\u9898"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28124%29%20%E5%AD%A6%E4%BC%9A%E7%BB%99%E8%87%AA%E5%B7%B1review%E4%BB%A3%E7%A0%81/#_3","text":"\u4ee5\u4e0b\u5185\u5bb9\u5927\u591a\u662f\u81ea\u5df1\u7684\u7ecf\u9a8c\uff0c\u4e5f\u53ef\u80fd\u6709\u4e0d\u5bf9\u7684\u5730\u65b9\uff0c\u4ec5\u4f9b\u53c2\u8003\uff0c \u4e0d\u559c\u8f7b\u55b7 \u3002 magic number\u592a\u591a \u8fd9\u91cc\u6307\u7684\u662f\uff0c\u6211\u4eec \u968f\u624b\u6dfb\u52a0 \u7684\u53ef\u91cd\u590d\u4f7f\u7528\u7684\u4e00\u4e9b\u6570\u5b57\uff0c\u5f80\u597d\u4e86\u8bf4\u5e94\u8be5\u662f\u9700\u8981\u62bd\u51fa\u6765\u4f5c\u4e3a\u4e00\u4e2a \u5e38\u91cf \u6216 \u53d8\u91cf \u7684\u3002 \u6765\u770b\u70b9\u4f8b\u5b50: \u968f\u4fbf\u4e00\u641c\u7d22\uff0c\u5c31\u80fd\u770b\u5230\u5f88\u591a\u8fd9\u79cd1,2\u8fd9\u6837\u7684\u6570\uff0c\u8bed\u4e49\u4e0d\u660e\u786e\uff0c\u5b8c\u5168\u53ef\u4ee5 \u5b9a\u4e49\u4e00\u4e2a\u679a\u4e3e\u7c7b \u4f7f\u5f97\u4ee3\u7801\u66f4\u6709 \u53ef\u8bfb\u6027 \u3002 \u53ef\u6015\u7684\u662f\uff0c\u641c\u7d22\u76f8\u5173\u4f8b\u5b50\uff0c\u8fd8\u80fd\u51fa\u6765\u597d\u51e0\u4e2a\u8fd9\u6837\u7684\u4f8b\u5b50\uff0c\u8bf4\u660e\u4e4b\u524d\u771f\u7684\u5c31\u662f \u968f\u5fc3\u6240\u6b32 \u5730\u5199\u3002 \u672a\u6307\u5b9a\u8fd4\u56de\u503c\uff0c\u53c2\u6570\u672a\u6dfb\u52a0\u7c7b\u578b\uff0c\u90e8\u5206\u65b9\u6cd5\u6ca1\u6709\u6587\u6863 \u770b\u770b\u6211\u622a\u56fe\u76842\u4e2a\u65b9\u6cd5\uff0c\u4e0b\u9762\u90a3\u4e2a\u65b9\u6cd5\u5c31\u6ca1\u6709\u76f8\u5173\u6ce8\u91ca\uff08\u65b9\u6cd5\u63cf\u8ff0\uff09\uff0c\u5728\u65b9\u6cd5\u53c2\u6570\u4e5f\u6ca1\u6709 \u6307\u5b9a\u7c7b\u578b \uff0c\u4e5f\u6ca1\u6709\u6307\u5b9a\u8fd4\u56de\u503c\u3002 \u5148\u6765\u8bf4\u8bf4\u6307\u5b9a\u7c7b\u578b\u7684\u597d\u5904: \u7f16\u8bd1\u5668\u667a\u80fd\u63d0\u793a\uff0c\u5f53\u7c7b\u578b\u4e0d\u5339\u914d\uff08\u6bd4\u5982\u4f60\u6362\u4e86\u53c2\u6570\u987a\u5e8f\uff0c\u4f46\u8c03\u7528\u7684\u65f6\u5019\u6ca1\u6362\u987a\u5e8f\uff0c\u8fd9\u65f6\u5019\u7f16\u8f91\u5668\u4f1a\u7ed9\u51fa\u63d0\u793a\uff09 \u6307\u5b9a\u8fd4\u56de\u503c\uff0c\u9053\u7406\u540c\u4e0a\uff0c\u66f4\u597d\u7684\u4e00\u70b9\u662f\u53ef\u4ee5\u667a\u80fd\u8865\u5168 \u6ce8\u91ca\u7684\u610f\u4e49\u5c31\u4e0d\u7528\u6211\u591a\u8bf4\u4e86\u5427\uff0c\u5efa\u8bae\u6bcf\u4e2a\u65b9\u6cd5\u90fd\u6216\u591a\u6216\u5c11\u52a0\u70b9\u6ce8\u91ca\uff0c\u4f5c\u4e3a\u4e00\u4e2a\u5f00\u6e90\u7684\u9879\u76ee\uff0c\u8fd9\u70b9\u8bf4\u660e\u8fd8\u662f\u8981\u6709\u7684\uff0c\u4e0d\u7136\u5230\u65f6\u5019\u53ef\u80fd\u81ea\u5df1\u90fd \u8bfb\u4e0d\u61c2 \u4e86\u3002 \u6539\u6389go\u7684if err != nil\u7684\u5199\u6cd5 \u7531\u4e8e\u9879\u76ee\u521d\u671f\u7684\u6211\uff0c\u5199go\u6bd4\u8f83\u591a\uff0c\u5bfc\u81f4\u6211\u4e60\u60ef\u6027\u5b9a\u4e49\u65b9\u6cd5\u7684\u8fd4\u56de\u503c\u4e3a\u5177\u4f53\u7684\u8fd4\u56de+ err \uff0c\u8fd9\u6837\u7684\u4e60\u60ef\u5f88\u4e0d\u597d\uff0c\u5199\u5230Python\u91cc\u9762\u5c31\u662f \u56db\u4e0d\u50cf \u3002 \u591a\u5c01\u88c5\u81ea\u5b9a\u4e49Exception \u5f02\u5e38\u4e0d\u80fd\u7edf\u4e00\u90fd\u7528Exception\uff0c\u867d\u7136\u7528\u8d77\u6765\u6ca1\u5565\u6bdb\u75c5\uff0c\u4f46\u5982\u679c\u80fd\u51c6\u786e\u5b9a\u4e49\u67d0\u4e00\u79cd\u5f02\u5e38\uff0c\u6bd4\u5982 \u8ba4\u8bc1\u5f02\u5e38 \uff0c \u6570\u636e\u627e\u4e0d\u5230\u5f02\u5e38 , \u6743\u9650\u4e0d\u591f\u5f02\u5e38 \u7b49\u7b49\uff0c\u8fd9\u6837\u9047\u5230\u5f02\u5e38\u5c31\u77e5\u9053\u662f\u5565\u9519\uff0c\u591a\u5b66\u5b66\u522b\u4eba\u5c01\u88c5\u7684 \u5f02\u5e38\u7c7b \u3002 \u8fd9\u91cc\u5efa\u8baeraise DbConnectionException(\"xxx\") \u4e0d\u7528\u7684\u53d8\u91cf\u5efa\u8bae\u7528\u4e0b\u5212\u7ebf\u4ee3\u66ff \u4e0d\u540c\u4e8ego\u8bed\u8a00\u7684\u5f3a\u5236\u4f7f\u7528\u5b9a\u4e49\u7684\u53d8\u91cf\uff0cPython\u53ef\u4ee5\u53ea\u5b9a\u4e49\u4f46\u4e0d\u4f7f\u7528 \u53d8\u91cf \u3002\u8fd8\u662f\u4e0a\u9762\u90a3\u4e2a\u65b9\u6cd5\uff0c\u770b\u5230user_info\u4e86\u5417\uff1f \u8fd9\u4e2a\u65b9\u6cd5\u662f\u4e2a\u9274\u6743\u7684\u65b9\u6cd5\uff0c\u867d\u7136\u6211\u4eec\u4e0d\u83b7\u53d6 \u7528\u6237\u4fe1\u606f \uff0c\u4f46\u662f\u6211\u4eec\u8fd8\u662f\u9700\u8981\u7528\u6237\u767b\u5f55\u540e\u624d\u80fd\u5b8c\u6210\u6b64\u64cd\u4f5c\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u628a\u53d8\u91cfuser_info\u6539\u4e3a_ \u8fd9\u6837pycharm\u4e5f\u4e0d\u518d\u62a5 \u672a\u4f7f\u7528 \u7684\u63d0\u793a\u4e86\u3002 \u591a\u7528\u683c\u5f0f\u5316/\u5f15\u7528\u4f18\u5316 \u7531\u4e8e\u6211\u81ea\u5df1\u5199\u4ee3\u7801\u6bd4\u8f83\u6ce8\u610f\u8fd9\u4e00\u5757\uff0c\u6240\u4ee5\u6211\u4f1a\u4e60\u60ef\u6027\u505a\u8fd92\u4ef6\u4e8b\uff0c\u4e5f\u5c31\u662fCTRL+ALT+L\u548cCTRL+ALT+O(\u5b57\u6bcdo) \u591a\u719f\u6089pydantic \u5bf9\u4e8e\u6211\u800c\u8a00\uff0cpydantic\u4ec5\u4ec5\u7528\u6765\u5f53\u505a \u53c2\u6570\u6821\u9a8c\u5de5\u5177 \uff0c\u4f46\u5176\u5b9e\u5e76\u4e0d\u662f\u8fd9\u6837\uff0cpydantic\u5176\u5b9e\u4e5f\u53ef\u4ee5\u6307\u5b9a\u5177\u4f53\u8981\u8fd4\u56de\u7684\u5b57\u6bb5\uff0c\u901a\u8fc7response_model\u5f62\u6210 \u95ed\u73af \uff0c\u5b8c\u6210\u6574\u4e2arequest\u7684 \u751f\u547d\u5468\u671f \u3002 \u4ee5\u4e0a\uff0c\u5c31\u662f\u6211\u4eca\u5929\u9605\u8bfb\u81ea\u5df1\u4ee3\u7801\u627e\u51fa\u7684 \u4e00\u4e9b \u4f18\u5316\u70b9\uff0c\u5e0c\u671b\u80fd\u5bf9\u5927\u5bb6\u6709\u6240\u5e2e\u52a9\u3002\u7ecf\u5e38 \u5eb7\u5eb7 \u81ea\u5df1\u7684\u4ee3\u7801\uff0c\u4e5f\u662f\u6709\u597d\u5904\u7684~ \u6211\u662f\u7c73\u6d1b\uff0c\u4e00\u76f4\u966a\u4f34\u5404\u4f4d\u5b66\u4e60\uff01\u514d\u8d39\u7684 \u5c0f\u9ec4\u5fc3 \uff0c\u5e2e\u6211\u70b9\u4e00\u4e2a\u5427\uff01 \u9879\u76ee\u5730\u5740: https://github.com/wuranxu/pity","title":"\u4f18\u5316/\u5efa\u8bae"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28125%29%20%E5%85%BC%E5%AE%B9postgresql/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u4e00\u8d77\u4ea4\u6d41\u5b66\u4e60! \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u7ed9\u81ea\u5df1\u4ee3\u7801\u505a\u4e86\u4e00\u6b21review\uff0c\u5728review\u7684\u8fc7\u7a0b\u4e2d\u6211\u6ce8\u610f\u5230\u6211\u4eec\u7684 \u6570\u636e\u5e93 \u8fd8\u6ca1\u6709\u5b8c\u5168\u652f\u6301postgresql\uff0c\u6240\u4ee5\u4eca\u5929\u6211\u4eec\u5c31\u6765\u8bd5\u8bd5\u770b\uff0c\u5207\u6362\u5e95\u5c42 \u6570\u636e\u5e93 \uff0cpity\u80fd\u4e0d\u80fd\u9876\u5f97\u4f4f\u3002 \u5b9a\u4e49\u679a\u4e3e \u5982\u6211\u6240\u8bf4\uff0c\u5bf9\u4e8e\u5177\u4f53\u7684sql_type\uff0c\u6211\u4eec\u5e94\u8be5\u7528\u679a\u4e3e\u7c7b\u7ed9\u5b9a\u4e49\u8d77\u6765\uff0c\u6240\u4ee5\u6211\u4eec\u6765\u5b9a\u4e49\u4e00\u4e0b\u679a\u4e3e: \u63a5\u7740\u6211\u4eec\u53bb\u66ff\u6362\u5bf9\u5e94\u7684\u5730\u65b9\uff0c\u4e5f\u5c31\u662f\u4e0a\u4e00\u8282\u6240\u8bf4\u7684magic number: \u8fd9\u91cc\u5982\u679c\u4e0d\u6ee1\u8db3\u6211\u4eec\u7684\u6761\u4ef6\uff0c\u5219\u76f4\u63a5 \u629b\u5f02\u5e38 \uff0c\u63d0\u793a\u7528\u6237\u6ca1\u6709\u8fd9\u4e2a\u6570\u636e\u5e93\u7c7b\u578b\u3002 \u5b89\u88c5pg pg\u5b98\u7f51 \u8fdb\u5165\u4e0b\u8f7d\u9875\uff0c\u4e0b\u8f7d\u5bf9\u5e94\u64cd\u4f5c\u7cfb\u7edf\u7684pg\u5373\u53ef\u3002\u50bb\u74dc\u5f0f\u5b89\u88c5\u540e\uff0c\u5982\u679c\u6ca1\u6709\u542f\u52a8\uff0c\u5219\u9700\u8981\u5728\u5b89\u88c5\u76ee\u5f55\u8fdb\u884c\u5982\u4e0b\u64cd\u4f5c: // \u5728bin\u76ee\u5f55 // \u6570\u636e\u8def\u5f84\u662fpg\u5728\u78c1\u76d8\u7684\u5b58\u50a8\u6570\u636e\u8def\u5f84 pg_ctl -D \u6570\u636e\u5b58\u50a8\u8def\u5f84 start \u542f\u52a8\u4e4b\u540e\u6211\u4eec\u53ef\u4ee5\u7528DataGrip\u8fde\u63a5\u6570\u636e\u5e93\uff0c\u7136\u540e\u521b\u5efa pity \u6570\u636e\u5e93\u3002\u8fd9\u4e00\u6b65\u7c7b\u4f3c\u4e8emysql\u7684 create database pity ; \u4e00\u5207\u90fd\u662f\u50bb\u74dc\u5f0f\u7684\uff0c\u563f\u563f\u3002 \u4e0b\u8f7d\u5f02\u6b65pg\u5f15\u64ce \u7ecf\u8fc7sqlalchemy\u5b98\u7f51\u7684\u6307\u793a\uff0c\u6211\u4eec\u4e0b\u8f7dasyncpg\u5f15\u64ce: pip install asyncpg \u4fee\u6539jdbc \u56e0\u4e3a\u6211\u4eec\u662f\u4e34\u65f6\u914d\u7f6e\u6d4b\u8bd5\u4e00\u4e0b\uff0c\u6240\u4ee5\u76f4\u63a5\u5199\u6b7b\u4e86\uff0c\u8fd9\u4e9b\u90fd\u662f\u6211\u672c\u5730\u7684\u6570\u636e\u5e93\u8d26\u53f7\u5bc6\u7801\u548c\u7aef\u53e3\u7b49\u6570\u636e\u3002 \u672c\u6b21\u6d4b\u8bd5\u5e76\u4e0d\u662f\u8981\u5207\u6362\u5230pg\uff0c\u800c\u662f\u7ed9\u53ea\u80fd\u9009\u62e9pg\uff08\u6bd4\u5982\u6211\u4e0a\u5bb6\u516c\u53f8\u5c31\u6ca1\u6709mysql\uff09\u7684\u4eba\u4e00\u4e2a\u9009\u62e9\uff0c\u987a\u4fbf\u4e5f\u770b\u770bpity\u80fd\u4e0d\u80fd\u65e0\u7f1d\u5207\u6362\u5230pg\u3002 \u91cd\u65b0\u5efa\u8868 \u521b\u5efa\u597d\u6570\u636e\u5e93\u4ee5\u540e\uff0c\u6211\u4eec\u7b2c\u4e00\u6b65\u5c31\u662f\u8981\u6d4b\u8bd5\u6570\u636e\u8868\u662f\u5426\u80fd\u591f\u5efa\u7acb\u3002\u6211\u4eec\u542f\u52a8\u4e00\u4e0bpity\u8bd5\u8bd5\u3002 \u4e00\u4e0a\u6765\u5c31\u7ed9\u54b1\u4e00\u4e2a\u731b\u7684\u62a5\u9519\uff0c\u53ef\u4ee5\u770b\u5230\uff0c\u6211\u4eec\u7684ddl\u91cc\u9762\u5305\u542b\u7684\u662fdatetime\uff0c\u4f46pg\u91cc\u9762\u5e76\u6ca1\u6709 datetime \uff0c\u786e\u5b9e\uff0c\u6211\u4e4b\u524d\u4f7f\u7528\u7684\u65f6\u5019\u4e5f\u90fd\u7528\u7684 timestamp \u3002 \u6240\u4ee5\u8fd9\u610f\u5473\u7740\uff0c\u5982\u679c\u6211\u4eec\u8981\u517c\u5bb9pg\uff0c\u5219\u9700\u8981\u628adatetime\u7c7b\u578b\u5168\u90e8\u6362\u6210TIMESTAMP\uff0c\u6362\u662f\u53ef\u4ee5\u6362\uff0c\u4f46\u6211\u5c31\u6015\u6211\u4eec\u73b0\u5728\u7684\u4ee3\u7801\u4f1a\u53d7\u5f71\u54cd\u3002 \u8fd9\u91cc\u6211\u5df2\u7ecf\u6279\u91cf\u66ff\u6362\u8fc7\u4e86\uff0c\u53d1\u73b0sql\u91cc\u9762\u53cd\u5c04\u51fa\u6765\u7684\u4f9d\u65e7\u662fdatetime\u7c7b\u578b\uff08Python\u7684datetime\uff09\uff0c\u90a3\u5c31\u8bf4\u660e\u4ee3\u7801\u6ca1\u5565\u95ee\u9898\u3002 pg\u4e5f\u6ca1\u6709tinytext\u548clongtext\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u7edf\u4e00\u6539\u6210text\u517c\u5bb9pg\u3002 \u603b\u4f53\u6765\u8bf4\u6539\u52a8\u5e76\u4e0d\u5927\uff0c\u8fd9\u5c31\u662f\u6211\u4eec\u7528sqlalchemy\uff08orm\uff09\u7684\u597d\u5904\u3002 \u6765\u770b\u770b\u6539\u9020\u540e\uff0c\u662f\u5426\u597d\u7528\uff1a \u53ef\u4ee5\u770b\u5230\uff0c\u6570\u636e\u8868\u57fa\u672c\u90fd\u5efa\u597d\u4e86\uff0c\u4f46\u662f\u5c11\u4e86\u4e00\u53ea\uff1a apscheduler \u3002\u5fd8\u4e86\u8fd9\u4e2a\u786c\u832c\u4e86\uff01\uff01\uff01 \u9002\u914dapscheduler \u603b\u4f53\u6765\u8bf4\uff0c\u7531\u4e8eapscheduler\u7684\u5b58\u5728\uff0c\u6211\u4eec\u8fd8\u662f\u5f97\u5f04\u4e00\u5957 \u540c\u6b65session \uff0c\u81f3\u4e8epg\u7684\u540c\u6b65session\uff0c\u6211\u4eec\u9700\u8981\u5b89\u88c5psycopg2: pip install psycopg2 \u518d\u6b21\u542f\u52a8\u670d\u52a1\uff0c\u53d1\u73b0\u8868\u683c\u5efa\u597d\u4e86\uff01 \u8bd5\u8bd5pity\u5427 \u95ee\u9898\u4e00: deleted_at \u51fa\u5e08\u4e0d\u592a\u5229\uff0c\u4e00\u4e0a\u6765\u5c31\u62a5\u4e86\u4e2adeleted_at\u7684\u9519\uff0c\u539f\u6765\u6211\u6709\u7684deleted_at\u7684\u5b57\u6bb5\u5b9a\u4e49\u7684\u662ftimestamp\uff0c\u4f46\u5b9e\u9645\u4e0a\u6211\u67e5\u8be2\u7684\u65f6\u5019\u7528\u7684\u662f\u5426\u7b49\u4e8e0\u3002 \u6240\u4ee5\u6211\u7edf\u4e00\u628adeleted_at\u6539\u6210bigint\u4e86\u3002 \u95ee\u9898\u4e8c: date_format \u63a5\u7740\u53c8\u9047\u5230\u4e86\u4e00\u4e2adate_format\u7684\u9519\uff0c\u6211\u4eec\u8bd5\u7740\u89e3\u51b3\u4e0b\u5427\uff1a \u5bf9\u4e8emysql\u8fd9\u53e5\u8bdd\u662f\u6ca1\u6bdb\u75c5\u7684\uff0c\u683c\u5f0f\u5316\u65e5\u671f\uff0c\u4f46\u662fpg\u4e0d\u592a\u652f\u6301\u5440\uff0c\u6240\u4ee5\u6211\u4eec\u5f97\u6362\u901a\u7528\u70b9\u7684\u65b9\u5f0f\u3002 \u8fd9\u91cc\u6211\u4eec\u5c31\u4e0d\u91c7\u7528sql\u7684func\u4e86\uff0c\u76f4\u63a5\u7528Python\u7684\u65b9\u6cd5\uff0c\u8fd9\u6837\u90fd\u517c\u5bb9\uff0c\u6309\u7167\u56fe\u91cc\u8fd9\u4e48\u6539\u3002\u6539\u597d\u4e86\u4e4b\u540emysql\u7ee7\u7eed\u6d4b\u8bd5\u4e00\u4e0b\uff0c\u53d1\u73b0\u6ca1\u6bdb\u75c5\u3002 \u95ee\u9898\u4e09: timestamp\u4e0d\u652f\u6301\u76f4\u63a5\u6bd4\u8f83\u5b57\u7b26\u4e32 \u6211\u4eec\u4e4b\u524d\u6bd4\u8f83\u65e5\u671f\uff0c\u7528between\u6216\u8005\u5927\u4e8e\u5c0f\u4e8e\u7684\u65f6\u5019\uff0c\u4f20\u5165\u5b57\u7b26\u4e32\u7684\u65f6\u95f4\u683c\u5f0f\u90fd\u83ab\u5f97\u95ee\u9898\uff0c\u4f46\u662f\u6362pg\u4e4b\u540e\u5979\u5c31 \u50b2\u5a07 \u4e86\u3002\u539f\u56e0\u662f\uff0c\u5b83\u4e0d\u80fd\u628atext\u76f4\u63a5\u8f6c\u6210timestamp\uff0c\u6240\u4ee5\u6211\u4eec\u5f97\u624b\u52a8\u8f6c\u4e00\u4e0b\uff0cMySQL\u5012\u662f2\u79cd\u90fd\u652f\u6301\u3002 \u95ee\u9898\u56db: pg\u7684\u6570\u636e\u4f20\u5165id\u5b57\u6bb5\uff0c\u54ea\u6015\u4e3aNone insert\u7684\u65f6\u5019\u4f1a\u628aid\u7f6e\u4e3a0 \u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u5c31\u4e0d\u8d4b\u4e88id\u5c5e\u6027\u4e86\uff1a \u4e5f\u8bb8\u8ddf\u7528\u7684\u5f02\u6b65pg\u5f15\u64ce\u6709\u5173\uff0c\u6211\u8bd5\u4e86\u4e0b\u8fd9\u4e2a\u4e5f\u4e0d\u5f71\u54cdMySQL\uff0c\u6240\u4ee5\u5c31\u8fc1\u5c31\u4e0b\u5427\u3002 \u4ee5\u4e0a\u5c31\u662f\u6211\u603b\u7ed3\u7684\uff0c\u6570\u636e\u5e93\u5207\u6362\u5f15\u53d1\u7684\u4e00\u7cfb\u5217\u7684\u95ee\u9898\uff0c\u5e0c\u671b\u5bf9\u5927\u5bb6 \u6709\u6240\u5e2e\u52a9 \u3002 \u6211\u662f\u7c73\u6d1b\uff0c\u4e00\u76f4\u966a\u4f34\u5404\u4f4d\u5b66\u4e60\uff01\u514d\u8d39\u7684 \u5c0f\u9ec4\u5fc3 \uff0c\u5e2e\u6211\u70b9\u4e00\u4e2a\u5427\uff01 \u9879\u76ee\u5730\u5740: https://github.com/wuranxu/pity","title":"125.\u517c\u5bb9postgresql"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28125%29%20%E5%85%BC%E5%AE%B9postgresql/#_1","text":"\u4e0a\u4e00\u8282\u6211\u4eec\u7ed9\u81ea\u5df1\u4ee3\u7801\u505a\u4e86\u4e00\u6b21review\uff0c\u5728review\u7684\u8fc7\u7a0b\u4e2d\u6211\u6ce8\u610f\u5230\u6211\u4eec\u7684 \u6570\u636e\u5e93 \u8fd8\u6ca1\u6709\u5b8c\u5168\u652f\u6301postgresql\uff0c\u6240\u4ee5\u4eca\u5929\u6211\u4eec\u5c31\u6765\u8bd5\u8bd5\u770b\uff0c\u5207\u6362\u5e95\u5c42 \u6570\u636e\u5e93 \uff0cpity\u80fd\u4e0d\u80fd\u9876\u5f97\u4f4f\u3002","title":"\u56de\u987e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28125%29%20%E5%85%BC%E5%AE%B9postgresql/#_2","text":"\u5982\u6211\u6240\u8bf4\uff0c\u5bf9\u4e8e\u5177\u4f53\u7684sql_type\uff0c\u6211\u4eec\u5e94\u8be5\u7528\u679a\u4e3e\u7c7b\u7ed9\u5b9a\u4e49\u8d77\u6765\uff0c\u6240\u4ee5\u6211\u4eec\u6765\u5b9a\u4e49\u4e00\u4e0b\u679a\u4e3e: \u63a5\u7740\u6211\u4eec\u53bb\u66ff\u6362\u5bf9\u5e94\u7684\u5730\u65b9\uff0c\u4e5f\u5c31\u662f\u4e0a\u4e00\u8282\u6240\u8bf4\u7684magic number: \u8fd9\u91cc\u5982\u679c\u4e0d\u6ee1\u8db3\u6211\u4eec\u7684\u6761\u4ef6\uff0c\u5219\u76f4\u63a5 \u629b\u5f02\u5e38 \uff0c\u63d0\u793a\u7528\u6237\u6ca1\u6709\u8fd9\u4e2a\u6570\u636e\u5e93\u7c7b\u578b\u3002","title":"\u5b9a\u4e49\u679a\u4e3e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28125%29%20%E5%85%BC%E5%AE%B9postgresql/#pg","text":"pg\u5b98\u7f51 \u8fdb\u5165\u4e0b\u8f7d\u9875\uff0c\u4e0b\u8f7d\u5bf9\u5e94\u64cd\u4f5c\u7cfb\u7edf\u7684pg\u5373\u53ef\u3002\u50bb\u74dc\u5f0f\u5b89\u88c5\u540e\uff0c\u5982\u679c\u6ca1\u6709\u542f\u52a8\uff0c\u5219\u9700\u8981\u5728\u5b89\u88c5\u76ee\u5f55\u8fdb\u884c\u5982\u4e0b\u64cd\u4f5c: // \u5728bin\u76ee\u5f55 // \u6570\u636e\u8def\u5f84\u662fpg\u5728\u78c1\u76d8\u7684\u5b58\u50a8\u6570\u636e\u8def\u5f84 pg_ctl -D \u6570\u636e\u5b58\u50a8\u8def\u5f84 start \u542f\u52a8\u4e4b\u540e\u6211\u4eec\u53ef\u4ee5\u7528DataGrip\u8fde\u63a5\u6570\u636e\u5e93\uff0c\u7136\u540e\u521b\u5efa pity \u6570\u636e\u5e93\u3002\u8fd9\u4e00\u6b65\u7c7b\u4f3c\u4e8emysql\u7684 create database pity ; \u4e00\u5207\u90fd\u662f\u50bb\u74dc\u5f0f\u7684\uff0c\u563f\u563f\u3002","title":"\u5b89\u88c5pg"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28125%29%20%E5%85%BC%E5%AE%B9postgresql/#pg_1","text":"\u7ecf\u8fc7sqlalchemy\u5b98\u7f51\u7684\u6307\u793a\uff0c\u6211\u4eec\u4e0b\u8f7dasyncpg\u5f15\u64ce: pip install asyncpg","title":"\u4e0b\u8f7d\u5f02\u6b65pg\u5f15\u64ce"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28125%29%20%E5%85%BC%E5%AE%B9postgresql/#jdbc","text":"\u56e0\u4e3a\u6211\u4eec\u662f\u4e34\u65f6\u914d\u7f6e\u6d4b\u8bd5\u4e00\u4e0b\uff0c\u6240\u4ee5\u76f4\u63a5\u5199\u6b7b\u4e86\uff0c\u8fd9\u4e9b\u90fd\u662f\u6211\u672c\u5730\u7684\u6570\u636e\u5e93\u8d26\u53f7\u5bc6\u7801\u548c\u7aef\u53e3\u7b49\u6570\u636e\u3002 \u672c\u6b21\u6d4b\u8bd5\u5e76\u4e0d\u662f\u8981\u5207\u6362\u5230pg\uff0c\u800c\u662f\u7ed9\u53ea\u80fd\u9009\u62e9pg\uff08\u6bd4\u5982\u6211\u4e0a\u5bb6\u516c\u53f8\u5c31\u6ca1\u6709mysql\uff09\u7684\u4eba\u4e00\u4e2a\u9009\u62e9\uff0c\u987a\u4fbf\u4e5f\u770b\u770bpity\u80fd\u4e0d\u80fd\u65e0\u7f1d\u5207\u6362\u5230pg\u3002","title":"\u4fee\u6539jdbc"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28125%29%20%E5%85%BC%E5%AE%B9postgresql/#_3","text":"\u521b\u5efa\u597d\u6570\u636e\u5e93\u4ee5\u540e\uff0c\u6211\u4eec\u7b2c\u4e00\u6b65\u5c31\u662f\u8981\u6d4b\u8bd5\u6570\u636e\u8868\u662f\u5426\u80fd\u591f\u5efa\u7acb\u3002\u6211\u4eec\u542f\u52a8\u4e00\u4e0bpity\u8bd5\u8bd5\u3002 \u4e00\u4e0a\u6765\u5c31\u7ed9\u54b1\u4e00\u4e2a\u731b\u7684\u62a5\u9519\uff0c\u53ef\u4ee5\u770b\u5230\uff0c\u6211\u4eec\u7684ddl\u91cc\u9762\u5305\u542b\u7684\u662fdatetime\uff0c\u4f46pg\u91cc\u9762\u5e76\u6ca1\u6709 datetime \uff0c\u786e\u5b9e\uff0c\u6211\u4e4b\u524d\u4f7f\u7528\u7684\u65f6\u5019\u4e5f\u90fd\u7528\u7684 timestamp \u3002 \u6240\u4ee5\u8fd9\u610f\u5473\u7740\uff0c\u5982\u679c\u6211\u4eec\u8981\u517c\u5bb9pg\uff0c\u5219\u9700\u8981\u628adatetime\u7c7b\u578b\u5168\u90e8\u6362\u6210TIMESTAMP\uff0c\u6362\u662f\u53ef\u4ee5\u6362\uff0c\u4f46\u6211\u5c31\u6015\u6211\u4eec\u73b0\u5728\u7684\u4ee3\u7801\u4f1a\u53d7\u5f71\u54cd\u3002 \u8fd9\u91cc\u6211\u5df2\u7ecf\u6279\u91cf\u66ff\u6362\u8fc7\u4e86\uff0c\u53d1\u73b0sql\u91cc\u9762\u53cd\u5c04\u51fa\u6765\u7684\u4f9d\u65e7\u662fdatetime\u7c7b\u578b\uff08Python\u7684datetime\uff09\uff0c\u90a3\u5c31\u8bf4\u660e\u4ee3\u7801\u6ca1\u5565\u95ee\u9898\u3002 pg\u4e5f\u6ca1\u6709tinytext\u548clongtext\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u7edf\u4e00\u6539\u6210text\u517c\u5bb9pg\u3002 \u603b\u4f53\u6765\u8bf4\u6539\u52a8\u5e76\u4e0d\u5927\uff0c\u8fd9\u5c31\u662f\u6211\u4eec\u7528sqlalchemy\uff08orm\uff09\u7684\u597d\u5904\u3002 \u6765\u770b\u770b\u6539\u9020\u540e\uff0c\u662f\u5426\u597d\u7528\uff1a \u53ef\u4ee5\u770b\u5230\uff0c\u6570\u636e\u8868\u57fa\u672c\u90fd\u5efa\u597d\u4e86\uff0c\u4f46\u662f\u5c11\u4e86\u4e00\u53ea\uff1a apscheduler \u3002\u5fd8\u4e86\u8fd9\u4e2a\u786c\u832c\u4e86\uff01\uff01\uff01","title":"\u91cd\u65b0\u5efa\u8868"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28125%29%20%E5%85%BC%E5%AE%B9postgresql/#apscheduler","text":"\u603b\u4f53\u6765\u8bf4\uff0c\u7531\u4e8eapscheduler\u7684\u5b58\u5728\uff0c\u6211\u4eec\u8fd8\u662f\u5f97\u5f04\u4e00\u5957 \u540c\u6b65session \uff0c\u81f3\u4e8epg\u7684\u540c\u6b65session\uff0c\u6211\u4eec\u9700\u8981\u5b89\u88c5psycopg2: pip install psycopg2 \u518d\u6b21\u542f\u52a8\u670d\u52a1\uff0c\u53d1\u73b0\u8868\u683c\u5efa\u597d\u4e86\uff01","title":"\u9002\u914dapscheduler"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28125%29%20%E5%85%BC%E5%AE%B9postgresql/#pity","text":"","title":"\u8bd5\u8bd5pity\u5427"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28125%29%20%E5%85%BC%E5%AE%B9postgresql/#deleted_at","text":"\u51fa\u5e08\u4e0d\u592a\u5229\uff0c\u4e00\u4e0a\u6765\u5c31\u62a5\u4e86\u4e2adeleted_at\u7684\u9519\uff0c\u539f\u6765\u6211\u6709\u7684deleted_at\u7684\u5b57\u6bb5\u5b9a\u4e49\u7684\u662ftimestamp\uff0c\u4f46\u5b9e\u9645\u4e0a\u6211\u67e5\u8be2\u7684\u65f6\u5019\u7528\u7684\u662f\u5426\u7b49\u4e8e0\u3002 \u6240\u4ee5\u6211\u7edf\u4e00\u628adeleted_at\u6539\u6210bigint\u4e86\u3002","title":"\u95ee\u9898\u4e00: deleted_at"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28125%29%20%E5%85%BC%E5%AE%B9postgresql/#date_format","text":"\u63a5\u7740\u53c8\u9047\u5230\u4e86\u4e00\u4e2adate_format\u7684\u9519\uff0c\u6211\u4eec\u8bd5\u7740\u89e3\u51b3\u4e0b\u5427\uff1a \u5bf9\u4e8emysql\u8fd9\u53e5\u8bdd\u662f\u6ca1\u6bdb\u75c5\u7684\uff0c\u683c\u5f0f\u5316\u65e5\u671f\uff0c\u4f46\u662fpg\u4e0d\u592a\u652f\u6301\u5440\uff0c\u6240\u4ee5\u6211\u4eec\u5f97\u6362\u901a\u7528\u70b9\u7684\u65b9\u5f0f\u3002 \u8fd9\u91cc\u6211\u4eec\u5c31\u4e0d\u91c7\u7528sql\u7684func\u4e86\uff0c\u76f4\u63a5\u7528Python\u7684\u65b9\u6cd5\uff0c\u8fd9\u6837\u90fd\u517c\u5bb9\uff0c\u6309\u7167\u56fe\u91cc\u8fd9\u4e48\u6539\u3002\u6539\u597d\u4e86\u4e4b\u540emysql\u7ee7\u7eed\u6d4b\u8bd5\u4e00\u4e0b\uff0c\u53d1\u73b0\u6ca1\u6bdb\u75c5\u3002","title":"\u95ee\u9898\u4e8c: date_format"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28125%29%20%E5%85%BC%E5%AE%B9postgresql/#timestamp","text":"\u6211\u4eec\u4e4b\u524d\u6bd4\u8f83\u65e5\u671f\uff0c\u7528between\u6216\u8005\u5927\u4e8e\u5c0f\u4e8e\u7684\u65f6\u5019\uff0c\u4f20\u5165\u5b57\u7b26\u4e32\u7684\u65f6\u95f4\u683c\u5f0f\u90fd\u83ab\u5f97\u95ee\u9898\uff0c\u4f46\u662f\u6362pg\u4e4b\u540e\u5979\u5c31 \u50b2\u5a07 \u4e86\u3002\u539f\u56e0\u662f\uff0c\u5b83\u4e0d\u80fd\u628atext\u76f4\u63a5\u8f6c\u6210timestamp\uff0c\u6240\u4ee5\u6211\u4eec\u5f97\u624b\u52a8\u8f6c\u4e00\u4e0b\uff0cMySQL\u5012\u662f2\u79cd\u90fd\u652f\u6301\u3002","title":"\u95ee\u9898\u4e09: timestamp\u4e0d\u652f\u6301\u76f4\u63a5\u6bd4\u8f83\u5b57\u7b26\u4e32"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28125%29%20%E5%85%BC%E5%AE%B9postgresql/#pgidnone-insertid0","text":"\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u5c31\u4e0d\u8d4b\u4e88id\u5c5e\u6027\u4e86\uff1a \u4e5f\u8bb8\u8ddf\u7528\u7684\u5f02\u6b65pg\u5f15\u64ce\u6709\u5173\uff0c\u6211\u8bd5\u4e86\u4e0b\u8fd9\u4e2a\u4e5f\u4e0d\u5f71\u54cdMySQL\uff0c\u6240\u4ee5\u5c31\u8fc1\u5c31\u4e0b\u5427\u3002 \u4ee5\u4e0a\u5c31\u662f\u6211\u603b\u7ed3\u7684\uff0c\u6570\u636e\u5e93\u5207\u6362\u5f15\u53d1\u7684\u4e00\u7cfb\u5217\u7684\u95ee\u9898\uff0c\u5e0c\u671b\u5bf9\u5927\u5bb6 \u6709\u6240\u5e2e\u52a9 \u3002 \u6211\u662f\u7c73\u6d1b\uff0c\u4e00\u76f4\u966a\u4f34\u5404\u4f4d\u5b66\u4e60\uff01\u514d\u8d39\u7684 \u5c0f\u9ec4\u5fc3 \uff0c\u5e2e\u6211\u70b9\u4e00\u4e2a\u5427\uff01 \u9879\u76ee\u5730\u5740: https://github.com/wuranxu/pity","title":"\u95ee\u9898\u56db: pg\u7684\u6570\u636e\u4f20\u5165id\u5b57\u6bb5\uff0c\u54ea\u6015\u4e3aNone insert\u7684\u65f6\u5019\u4f1a\u628aid\u7f6e\u4e3a0"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28125%29%20%E5%BD%BB%E5%BA%95%E6%91%86%E8%84%B1%E5%90%8C%E6%AD%A5sqlalchemy/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u4e00\u8d77\u4ea4\u6d41\u5b66\u4e60! \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec review \u4e86\u4e00\u4e0b\u4ee3\u7801\uff0c\u8fd9\u4e00\u8282\u6211\u4eec\u6765\u8fdb\u5165\u6b63\u8f68\uff0c\u804a\u804asqlalchemy\u5f7b\u5e95 \u5f02\u6b65\u5316 \u3002 \u5386\u53f2\u95ee\u9898 \u7531\u4e8e pity \u652f\u6301\u4e86\u5728\u7ebf\u7f16\u5199/\u6267\u884csql\u8bed\u53e5\u7684\u529f\u80fd\uff0c\u6240\u4ee5\u4e3a\u4e86\u66f4\u52a0\u53cb\u597d\uff0c\u6211\u4eec\u7279\u610f\u63d0\u4f9b\u4e86\u8bfb\u53d6\u6570\u636e\u5e93\u8868/\u5b57\u6bb5\u7684\u529f\u80fd\uff0c\u770b\u770b\u4e0b\u56fe: \u8fd9\u6837\u505a\u7684\u76ee\u7684\uff0c\u5e76\u4e0d\u662f \u70ab\u6280 \uff0c\u800c\u662f\u7ed9\u5927\u5bb6\u4e00\u4e2a\u66f4\u8212\u9002\u7684\u7f16\u5199sql\u7684\u73af\u5883\uff0c\u5982\u679c\u5199sql\u7684\u65f6\u5019\uff0c\u6570\u636e\u5e93\u8868\u548c\u5b57\u6bb5\u90fd\u7ed9\u4f60 \u8054\u60f3 \u4e86\uff0c\u90a3\u5199\u8d77\u6765\u5c31\u66f4\u8f7b\u677e\u4e86\u3002 \u4f46\u8fd9\u4e48\u4e2a\u529f\u80fd\u5462~\u5374\u4e0d\u662f\u90a3\u4e48\u597d\u505a\uff0c\u56e0\u4e3a\u636e\u6211\u6240\u77e5\uff0c\u8fd9\u4e2a\u529f\u80fd\u9700\u8981\u7528\u5230Metadata\uff0c\u63a5\u7740\u5229\u7528\u5176\u7684\u53cd\u5c04\u65b9\u6cd5\uff0c\u83b7\u53d6\u5230\u5bf9\u5e94\u7684 \u8868 \u548c \u5b57\u6bb5 \u4fe1\u606f\u3002\u800c\u5f02\u6b65engine\u53c8\u65e0\u6cd5\u83b7\u53d6metadata\u76f8\u5173\u6570\u636e\uff0c\u5305\u62ec \u81ea\u52a8\u5efa\u8868 \u3002 \u4e3a\u6b64\u6211\u4e00\u76f4\u4fdd\u6301\u7740 \u540c\u6b65session \u548c \u5f02\u6b65session \u6df7\u7528\u7684\u72b6\u6001\uff0c\u5f53\u7136\u8fd9\u80af\u5b9a\u4e0d\u662f\u5f88\u597d\u7684\u65b9\u6848\u3002 \u4e8e\u662f\u6211\u4eca\u5929\u7a81\u53d1\u5947\u60f3\uff0c\u8fd8\u771f\u88ab\u6211\u627e\u5230\u4e86\u7b54\u6848\u3002 \u89e3\u51b3\u95ee\u9898 \u5177\u4f53issue: https://github.com/sqlalchemy/sqlalchemy/issues/6121 \u770b\u770b\u4ed6\u7684\u601d\u8def\uff0c\u5176\u5b9e\u5f88\u7b80\u5355\uff0c \u5f02\u6b65engine \u63d0\u4f9b\u4e86run_sync\u65b9\u6cd5\uff0c\u8fd9\u4e2a\u5f88\u5389\u5bb3\uff0c\u4e5f\u5c31\u662f\u8bf4\u53ef\u4ee5\u76f4\u63a5\u7528\u5f02\u6b65engine\u53bb\u6267\u884c\u540c\u6b65engine\u7684\u65b9\u6cd5\uff0c\u9488\u5bf9create_all\uff08\u5efa\u8868\uff09+\u83b7\u53d6\u8868\u4fe1\u606f\uff0c\u5c31\u5f88\u6709\u7528\u4e86\uff0c\u6211\u4eec\u76f4\u63a5 \u5b66 \u8fc7\u6765\uff0c\u5e76\u7ed9\u4ed6\u4e00\u4e2a\u5c0f \u7ea2\u5fc3 \u3002 \u4fee\u6539create_all \u5728\u5e95\u90e8\u5b9a\u4e49create_table\u65b9\u6cd5\uff0c\u7531\u4e8e\u662f\u5f02\u6b65\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u4e0d\u80fd\u76f4\u63a5\u8fd0\u884c\uff0c\u4f46\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u653e\u5165startup\u91cc\u9762\uff0c\u968f\u7740\u7cfb\u7edf\u542f\u52a8\u800c\u6267\u884c\u3002 \u4fee\u6539main.py \u4fee\u6539\u83b7\u53d6\u8868\u7684\u65b9\u6cd5 \u5148\u7f16\u5199load_table\u65b9\u6cd5\uff0c\u8fd9\u91cc\u9762\u7531\u4e8e\u9700\u8981 \u5c55\u793a\u6811 \uff0c\u6240\u4ee5\u591a\u4e86\u5f88\u591a\u989d\u5916\u7684\u53d8\u91cf\uff0c\u6838\u5fc3\u7684\u90e8\u5206\u5c31\u662frun_sync \u4fee\u6539\u8c03\u7528\u7684\u90e8\u5206 \u5176\u5b9e\u662f\u628a\u539f\u5148\u7684\u903b\u8f91\uff0c\u653e\u5165\u4e86\u4e00\u90e8\u5206\u5230table\u91cc\u9762\uff0c\u597d\u5904\u662f\u53ef\u4ee5\u53ea\u904d\u53861\u6b21\u54e6\uff01 \u653e\u5fc3\u53bb\u6389mysqlconnector \u8fd9\u91cc\u5f15\u64ce\u8bb0\u5f97\u6539\u4e3apymysql\uff0c\u5b9e\u5728\u6ca1\u529e\u6cd5\uff0c\u6211\u7a81\u7136\u60f3\u5230apscheduler\u4e0d\u652f\u6301\u5f02\u6b65session\uff0c\u6240\u4ee5\u8fd9\u4e2a\u540c\u6b65session\u8fd8\u5f97\u7ee7\u7eed\u7528\uff0c\u4f46\u6211\u4eec\u53ef\u4ee5\u53ea\u7528pymysql\u4f5c\u4e3a\u9a71\u52a8\u4e86\uff08\u652f\u6301\u5f02\u6b65\u548c\u540c\u6b65\uff09\uff0c\u6240\u4ee5\u6211\u4eec\u628ajdbc\u7684\u9a71\u52a8\u6539\u4e3apymysql\u3002 \u8fd9\u6837\u6765\u770b\u7684\u8bdd\uff0c\u57fa\u672c\u4e5f\u662f\u505a\u4e86\u4e00\u4e2a\u5b8c\u6574\u7684\u6e05\u7406\u5de5\u4f5c\uff0c\u8bf4\u5b9e\u8bdd\uff0c\u901f\u5ea6\u8fd8\u53ef\u4ee5\uff0c\u6709\u70b9\u5c0f\u8d77\u98de\u3002 \u5fcd\u4e0d\u4f4f\u538b\u6d4b\u4e86\u4e00\u4e0b \u627e\u4e86\u4e2a\u67e5\u8be2\u7f51\u5173\u5730\u5740\u7684\u63a5\u53e3\uff0c\u5176\u4e2d\u5305\u62ec\u4e86 \u9274\u6743 \uff0c db \u64cd\u4f5c\uff0c20\u4e2a\u7ebf\u7a0b\u53ef\u4ee5\u5230300rps\uff0c\u8fd8\u7b97\u6ee1\u610f\uff0c\u670d\u52a1\u4e5f\u4e0d\u5361\uff0c\u5bf9\u4e8e\u4e00\u4e2a \u6d4b\u8bd5\u5e73\u53f0 \u6765\u8bf4\uff0c\u8fd9\u6837\u4e5f\u5c31 \u591f\u4e86 \u3002 \u65e0\u6cd5\u907f\u514d\u7684\u662f\uff0c\u6211\u82b1\u4e861\u4e2a\u591a\u5c0f\u65f6\uff0c\u628a\u6240\u6709\u540c\u6b65session\u7684\u64cd\u4f5c\u90fd\u6362\u6210\u4e86\u5f02\u6b65\u3002 \u6211\u662f\u7c73\u6d1b\uff0c\u4e00\u76f4\u966a\u4f34\u5404\u4f4d\u5b66\u4e60\uff01\u514d\u8d39\u7684 \u5c0f\u9ec4\u5fc3 \uff0c\u5e2e\u6211\u70b9\u4e00\u4e2a\u5427\uff01 \u9879\u76ee\u5730\u5740: https://github.com/wuranxu/pity","title":"125.\u5f7b\u5e95\u6446\u8131\u540c\u6b65sqlalchemy"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28125%29%20%E5%BD%BB%E5%BA%95%E6%91%86%E8%84%B1%E5%90%8C%E6%AD%A5sqlalchemy/#_1","text":"\u4e0a\u4e00\u8282\u6211\u4eec review \u4e86\u4e00\u4e0b\u4ee3\u7801\uff0c\u8fd9\u4e00\u8282\u6211\u4eec\u6765\u8fdb\u5165\u6b63\u8f68\uff0c\u804a\u804asqlalchemy\u5f7b\u5e95 \u5f02\u6b65\u5316 \u3002","title":"\u56de\u987e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28125%29%20%E5%BD%BB%E5%BA%95%E6%91%86%E8%84%B1%E5%90%8C%E6%AD%A5sqlalchemy/#_2","text":"\u7531\u4e8e pity \u652f\u6301\u4e86\u5728\u7ebf\u7f16\u5199/\u6267\u884csql\u8bed\u53e5\u7684\u529f\u80fd\uff0c\u6240\u4ee5\u4e3a\u4e86\u66f4\u52a0\u53cb\u597d\uff0c\u6211\u4eec\u7279\u610f\u63d0\u4f9b\u4e86\u8bfb\u53d6\u6570\u636e\u5e93\u8868/\u5b57\u6bb5\u7684\u529f\u80fd\uff0c\u770b\u770b\u4e0b\u56fe: \u8fd9\u6837\u505a\u7684\u76ee\u7684\uff0c\u5e76\u4e0d\u662f \u70ab\u6280 \uff0c\u800c\u662f\u7ed9\u5927\u5bb6\u4e00\u4e2a\u66f4\u8212\u9002\u7684\u7f16\u5199sql\u7684\u73af\u5883\uff0c\u5982\u679c\u5199sql\u7684\u65f6\u5019\uff0c\u6570\u636e\u5e93\u8868\u548c\u5b57\u6bb5\u90fd\u7ed9\u4f60 \u8054\u60f3 \u4e86\uff0c\u90a3\u5199\u8d77\u6765\u5c31\u66f4\u8f7b\u677e\u4e86\u3002 \u4f46\u8fd9\u4e48\u4e2a\u529f\u80fd\u5462~\u5374\u4e0d\u662f\u90a3\u4e48\u597d\u505a\uff0c\u56e0\u4e3a\u636e\u6211\u6240\u77e5\uff0c\u8fd9\u4e2a\u529f\u80fd\u9700\u8981\u7528\u5230Metadata\uff0c\u63a5\u7740\u5229\u7528\u5176\u7684\u53cd\u5c04\u65b9\u6cd5\uff0c\u83b7\u53d6\u5230\u5bf9\u5e94\u7684 \u8868 \u548c \u5b57\u6bb5 \u4fe1\u606f\u3002\u800c\u5f02\u6b65engine\u53c8\u65e0\u6cd5\u83b7\u53d6metadata\u76f8\u5173\u6570\u636e\uff0c\u5305\u62ec \u81ea\u52a8\u5efa\u8868 \u3002 \u4e3a\u6b64\u6211\u4e00\u76f4\u4fdd\u6301\u7740 \u540c\u6b65session \u548c \u5f02\u6b65session \u6df7\u7528\u7684\u72b6\u6001\uff0c\u5f53\u7136\u8fd9\u80af\u5b9a\u4e0d\u662f\u5f88\u597d\u7684\u65b9\u6848\u3002 \u4e8e\u662f\u6211\u4eca\u5929\u7a81\u53d1\u5947\u60f3\uff0c\u8fd8\u771f\u88ab\u6211\u627e\u5230\u4e86\u7b54\u6848\u3002","title":"\u5386\u53f2\u95ee\u9898"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28125%29%20%E5%BD%BB%E5%BA%95%E6%91%86%E8%84%B1%E5%90%8C%E6%AD%A5sqlalchemy/#_3","text":"\u5177\u4f53issue: https://github.com/sqlalchemy/sqlalchemy/issues/6121 \u770b\u770b\u4ed6\u7684\u601d\u8def\uff0c\u5176\u5b9e\u5f88\u7b80\u5355\uff0c \u5f02\u6b65engine \u63d0\u4f9b\u4e86run_sync\u65b9\u6cd5\uff0c\u8fd9\u4e2a\u5f88\u5389\u5bb3\uff0c\u4e5f\u5c31\u662f\u8bf4\u53ef\u4ee5\u76f4\u63a5\u7528\u5f02\u6b65engine\u53bb\u6267\u884c\u540c\u6b65engine\u7684\u65b9\u6cd5\uff0c\u9488\u5bf9create_all\uff08\u5efa\u8868\uff09+\u83b7\u53d6\u8868\u4fe1\u606f\uff0c\u5c31\u5f88\u6709\u7528\u4e86\uff0c\u6211\u4eec\u76f4\u63a5 \u5b66 \u8fc7\u6765\uff0c\u5e76\u7ed9\u4ed6\u4e00\u4e2a\u5c0f \u7ea2\u5fc3 \u3002 \u4fee\u6539create_all \u5728\u5e95\u90e8\u5b9a\u4e49create_table\u65b9\u6cd5\uff0c\u7531\u4e8e\u662f\u5f02\u6b65\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u4e0d\u80fd\u76f4\u63a5\u8fd0\u884c\uff0c\u4f46\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u653e\u5165startup\u91cc\u9762\uff0c\u968f\u7740\u7cfb\u7edf\u542f\u52a8\u800c\u6267\u884c\u3002 \u4fee\u6539main.py \u4fee\u6539\u83b7\u53d6\u8868\u7684\u65b9\u6cd5 \u5148\u7f16\u5199load_table\u65b9\u6cd5\uff0c\u8fd9\u91cc\u9762\u7531\u4e8e\u9700\u8981 \u5c55\u793a\u6811 \uff0c\u6240\u4ee5\u591a\u4e86\u5f88\u591a\u989d\u5916\u7684\u53d8\u91cf\uff0c\u6838\u5fc3\u7684\u90e8\u5206\u5c31\u662frun_sync \u4fee\u6539\u8c03\u7528\u7684\u90e8\u5206 \u5176\u5b9e\u662f\u628a\u539f\u5148\u7684\u903b\u8f91\uff0c\u653e\u5165\u4e86\u4e00\u90e8\u5206\u5230table\u91cc\u9762\uff0c\u597d\u5904\u662f\u53ef\u4ee5\u53ea\u904d\u53861\u6b21\u54e6\uff01","title":"\u89e3\u51b3\u95ee\u9898"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28125%29%20%E5%BD%BB%E5%BA%95%E6%91%86%E8%84%B1%E5%90%8C%E6%AD%A5sqlalchemy/#mysqlconnector","text":"\u8fd9\u91cc\u5f15\u64ce\u8bb0\u5f97\u6539\u4e3apymysql\uff0c\u5b9e\u5728\u6ca1\u529e\u6cd5\uff0c\u6211\u7a81\u7136\u60f3\u5230apscheduler\u4e0d\u652f\u6301\u5f02\u6b65session\uff0c\u6240\u4ee5\u8fd9\u4e2a\u540c\u6b65session\u8fd8\u5f97\u7ee7\u7eed\u7528\uff0c\u4f46\u6211\u4eec\u53ef\u4ee5\u53ea\u7528pymysql\u4f5c\u4e3a\u9a71\u52a8\u4e86\uff08\u652f\u6301\u5f02\u6b65\u548c\u540c\u6b65\uff09\uff0c\u6240\u4ee5\u6211\u4eec\u628ajdbc\u7684\u9a71\u52a8\u6539\u4e3apymysql\u3002 \u8fd9\u6837\u6765\u770b\u7684\u8bdd\uff0c\u57fa\u672c\u4e5f\u662f\u505a\u4e86\u4e00\u4e2a\u5b8c\u6574\u7684\u6e05\u7406\u5de5\u4f5c\uff0c\u8bf4\u5b9e\u8bdd\uff0c\u901f\u5ea6\u8fd8\u53ef\u4ee5\uff0c\u6709\u70b9\u5c0f\u8d77\u98de\u3002","title":"\u653e\u5fc3\u53bb\u6389mysqlconnector"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28125%29%20%E5%BD%BB%E5%BA%95%E6%91%86%E8%84%B1%E5%90%8C%E6%AD%A5sqlalchemy/#_4","text":"\u627e\u4e86\u4e2a\u67e5\u8be2\u7f51\u5173\u5730\u5740\u7684\u63a5\u53e3\uff0c\u5176\u4e2d\u5305\u62ec\u4e86 \u9274\u6743 \uff0c db \u64cd\u4f5c\uff0c20\u4e2a\u7ebf\u7a0b\u53ef\u4ee5\u5230300rps\uff0c\u8fd8\u7b97\u6ee1\u610f\uff0c\u670d\u52a1\u4e5f\u4e0d\u5361\uff0c\u5bf9\u4e8e\u4e00\u4e2a \u6d4b\u8bd5\u5e73\u53f0 \u6765\u8bf4\uff0c\u8fd9\u6837\u4e5f\u5c31 \u591f\u4e86 \u3002 \u65e0\u6cd5\u907f\u514d\u7684\u662f\uff0c\u6211\u82b1\u4e861\u4e2a\u591a\u5c0f\u65f6\uff0c\u628a\u6240\u6709\u540c\u6b65session\u7684\u64cd\u4f5c\u90fd\u6362\u6210\u4e86\u5f02\u6b65\u3002 \u6211\u662f\u7c73\u6d1b\uff0c\u4e00\u76f4\u966a\u4f34\u5404\u4f4d\u5b66\u4e60\uff01\u514d\u8d39\u7684 \u5c0f\u9ec4\u5fc3 \uff0c\u5e2e\u6211\u70b9\u4e00\u4e2a\u5427\uff01 \u9879\u76ee\u5730\u5740: https://github.com/wuranxu/pity","title":"\u5fcd\u4e0d\u4f4f\u538b\u6d4b\u4e86\u4e00\u4e0b"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28126%29%20%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A%E9%A1%B5%E9%9D%A2%E9%87%8D%E8%AF%95%E5%8A%9F%E8%83%BD/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u4e00\u8d77\u4ea4\u6d41\u5b66\u4e60! \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u8bb2\u4e86\u517c\u5bb9postgresql\u7684\u76f8\u5173\u5185\u5bb9\uff0c\u8fd9\u4e00\u8282\u6211\u4eec\u6765\u6539\u9020\u4e0b \u6d4b\u8bd5\u62a5\u544a \u76f8\u5173\u7684\u5185\u5bb9\u3002\u529f\u80fd\u70b9\u5f88\u5c11\uff0c\u770b\u5b8c\u5206\u5206\u949f\u3002 \u719f\u6089\u9700\u6c42 \u5148\u770b\u770b\u56fe\uff0c\u62a5\u544a\u7684\u9875\u9762\u6837\u5f0f\u5148\u4e0d\u8bf4\uff0c\u53ea\u770b \u529f\u80fd \uff0c\u6709\u6ca1\u6709\u53d1\u73b0\u8fd9\u4e2a \u66f4\u591a \u5f88\u591a\u4f59\uff0c\u660e\u660e\u5c31\u662f\u67e5\u770b\u5177\u4f53\u7684\u6267\u884c\u65e5\u5fd7\uff0c\u6240\u4ee5\u5e94\u8be5\u6539\u4e3a \u65e5\u5fd7 \u66f4\u5408\u9002\u3002 \u5982\u679c\u6211\u4eec\u60f3\u518d\u6b21\u8fd0\u884ccase\uff0c\u53ef\u4ee5\u53d1\u73b0\u8fd9\u91cc\u5e76\u4e0d\u652f\u6301\u3002\u867d\u7136\u53ef\u4ee5\u8df3\u8f6c\u56de\u53bb\uff0c\u4f46\u662f\u6211\u5c31\u60f3\u5728\u8fd9\u4e2a\u9875\u9762\u770b\u770b\u662f\u4e0d\u662f\u771f\u7684\u8fd8\u62a5\u9519\uff08\u6392\u9664\u7f51\u7edc\u7b49\u539f\u56e0\uff09\uff0c\u6240\u4ee5\u6211\u4eec\u5c31\u9700\u8981\u5728\u6b64 \u6dfb\u52a0 \u91cd\u8bd5\u529f\u80fd\u3002 \u8fd9\u91cc\u7684\u91cd\u8bd5\u6307\u7684\u662f\u91cd\u65b0\u8fd0\u884c\u8fd9\u4e00\u6761\u6570\u636e\uff0c\u5e76\u5c55\u793a\u6700\u65b0\u7684\u7ed3\u679c\u3002\u5728\u6211\u4e4b\u524d\u516c\u53f8\uff0c\u6709\u540c\u4e8b\u63d0\u8fc7\u8fd9\u6837\u7684\u9700\u6c42\uff1a\u4e3a\u4e86\u6392\u9664\u6389\u7f51\u7edc\u5f71\u54cd\uff0c\u8fd9\u91cc\u5982\u679c\u91cd\u8bd5\u6210\u4e86\uff0c\u4e5f\u7b97case\u901a\u8fc7\u4e86\uff08\u8fd9\u6837\u901a\u8fc7\u7387\u6570\u636e\u597d\u770b\uff09\uff0c\u4f46\u8fd9\u91cc\u6211\u4e0d\u592a\u60f3\u8fd9\u4e48\u505a\u3002 \u601d\u8def \u5176\u5b9e\u8fd9\u8fb9\u6211\u4eec\u53ea\u9700\u8981\u83b7\u53d6\u5230\u5bf9\u5e94\u7684 case_id \uff0c \u6d4b\u8bd5\u6570\u636eid , \u5bf9\u5e94\u7684\u6267\u884c\u73af\u5883 \u5c31\u53ef\u4ee5\u76f4\u63a5\u91cd\u65b0\u8fd0\u884c\u8fd9\u4e00\u6761case\uff0c\u4f46\u6211\u4eec\u7684 \u6d4b\u8bd5\u7ed3\u679c\u8868 \uff0c\u76ee\u524d\u6ca1\u6709data_id\u8fd9\u4e2a\u5b57\u6bb5\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u505a\u4e00\u4e9b\u8c03\u6574\u3002 \u800c\u4e14\u6211\u4eec\u4e5f\u6ca1\u6709\u6839\u636e\u6d4b\u8bd5\u6570\u636e\u76f4\u63a5\u6267\u884ccase\u7684\u63a5\u53e3\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u7f16\u5199\u4e00\u4e2a\u8fd9\u6837\u7684\u63a5\u53e3\u3002 \u5b57\u6bb5\u6539\u9020 \u4fee\u6539model\u548c__init__\u65b9\u6cd5\uff0c\u63a5\u7740\u6211\u4eec\u8981\u53bb\u6539\u52a8\u7528\u5230init\u7684\u5730\u65b9\u3002 \u6539\u52a8\u4f7f\u7528\u5904 \u4fee\u6539TestResult.py\u7684insert\u65b9\u6cd5\u3002 \u4fee\u6539run_with_test_data\u65b9\u6cd5\u3002 \u4fee\u6539run_single\u65b9\u6cd5\u3002 \u7f16\u5199\u540e\u7aef\u63a5\u53e3 \u5728http.py\u65b0\u589eretry\u65b9\u6cd5\uff0c\u9996\u5148\u6839\u636eid\u67e5\u5230\u6d4b\u8bd5\u6570\u636e\uff0c\u63a5\u7740\u8c03\u7528\u6267\u884ccase\u7684\u65b9\u6cd5\uff0c\u6700\u540e\u8fd4\u56de\u6570\u636e\u5373\u53ef\u3002 \u8c03\u6574\u524d\u7aef \u4fee\u6539model/service \u5f88\u663e\u7136\u6211\u4eec\u8981\u5199\u4e00\u4e2amodel\u65b9\u6cd5\u548c\u4e00\u4e2aservice\u65b9\u6cd5\uff0c\u5982\u4e0b\uff1a \u4fee\u6539\u7f16\u8f91\u680f \u64cd\u4f5c\u8fd9\u91cc\u7ed9\u51fa2\u4e2aa\u6807\u7b7e\uff08\u6309\u94ae\uff09\uff0c\u7b2c\u4e00\u4e2a\u662f\u65e5\u5fd7\uff0c\u7b2c\u4e8c\u4e2a\u662f\u91cd\u8bd5\u3002 \u5177\u4f53\u7684\u91cd\u8bd5\u65b9\u6cd5\uff1a \u5148\u8c03\u7528\u91cd\u8bd5\u65b9\u6cd5\uff0c\u62ff\u5230\u8fd4\u56de\u503c\u4ee5\u540e\uff0c\u628acase\u8fd0\u884c\u7ed3\u679c\u5199\u5165response\uff0c\u8fd9\u4e2aresponse\u4e0e\u666e\u901a\u67e5\u770b\u65e5\u5fd7\u7684\u7a97\u53e3\u5171\u7528\u3002 \u770b\u770b\u6548\u679c \u91cd\u8bd5\u53ea\u662f \u518d\u6267\u884ccase \u4e00\u6b21\uff0c\u5e76\u4e0d\u4f1a\u505a\u66f4\u591a \u989d\u5916 \u7684\u64cd\u4f5c\u3002 \u6211\u662f\u7c73\u6d1b\uff0c\u4e00\u76f4\u966a\u4f34\u5404\u4f4d\u5b66\u4e60\uff01\u514d\u8d39\u7684 \u5c0f\u9ec4\u5fc3 \uff0c\u5e2e\u6211\u70b9\u4e00\u4e2a\u5427\uff01 \u9879\u76ee\u5730\u5740: https://github.com/wuranxu/pity","title":"126.\u6d4b\u8bd5\u62a5\u544a\u9875\u9762\u91cd\u8bd5\u529f\u80fd"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28126%29%20%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A%E9%A1%B5%E9%9D%A2%E9%87%8D%E8%AF%95%E5%8A%9F%E8%83%BD/#_1","text":"\u4e0a\u4e00\u8282\u6211\u4eec\u8bb2\u4e86\u517c\u5bb9postgresql\u7684\u76f8\u5173\u5185\u5bb9\uff0c\u8fd9\u4e00\u8282\u6211\u4eec\u6765\u6539\u9020\u4e0b \u6d4b\u8bd5\u62a5\u544a \u76f8\u5173\u7684\u5185\u5bb9\u3002\u529f\u80fd\u70b9\u5f88\u5c11\uff0c\u770b\u5b8c\u5206\u5206\u949f\u3002","title":"\u56de\u987e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28126%29%20%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A%E9%A1%B5%E9%9D%A2%E9%87%8D%E8%AF%95%E5%8A%9F%E8%83%BD/#_2","text":"\u5148\u770b\u770b\u56fe\uff0c\u62a5\u544a\u7684\u9875\u9762\u6837\u5f0f\u5148\u4e0d\u8bf4\uff0c\u53ea\u770b \u529f\u80fd \uff0c\u6709\u6ca1\u6709\u53d1\u73b0\u8fd9\u4e2a \u66f4\u591a \u5f88\u591a\u4f59\uff0c\u660e\u660e\u5c31\u662f\u67e5\u770b\u5177\u4f53\u7684\u6267\u884c\u65e5\u5fd7\uff0c\u6240\u4ee5\u5e94\u8be5\u6539\u4e3a \u65e5\u5fd7 \u66f4\u5408\u9002\u3002 \u5982\u679c\u6211\u4eec\u60f3\u518d\u6b21\u8fd0\u884ccase\uff0c\u53ef\u4ee5\u53d1\u73b0\u8fd9\u91cc\u5e76\u4e0d\u652f\u6301\u3002\u867d\u7136\u53ef\u4ee5\u8df3\u8f6c\u56de\u53bb\uff0c\u4f46\u662f\u6211\u5c31\u60f3\u5728\u8fd9\u4e2a\u9875\u9762\u770b\u770b\u662f\u4e0d\u662f\u771f\u7684\u8fd8\u62a5\u9519\uff08\u6392\u9664\u7f51\u7edc\u7b49\u539f\u56e0\uff09\uff0c\u6240\u4ee5\u6211\u4eec\u5c31\u9700\u8981\u5728\u6b64 \u6dfb\u52a0 \u91cd\u8bd5\u529f\u80fd\u3002 \u8fd9\u91cc\u7684\u91cd\u8bd5\u6307\u7684\u662f\u91cd\u65b0\u8fd0\u884c\u8fd9\u4e00\u6761\u6570\u636e\uff0c\u5e76\u5c55\u793a\u6700\u65b0\u7684\u7ed3\u679c\u3002\u5728\u6211\u4e4b\u524d\u516c\u53f8\uff0c\u6709\u540c\u4e8b\u63d0\u8fc7\u8fd9\u6837\u7684\u9700\u6c42\uff1a\u4e3a\u4e86\u6392\u9664\u6389\u7f51\u7edc\u5f71\u54cd\uff0c\u8fd9\u91cc\u5982\u679c\u91cd\u8bd5\u6210\u4e86\uff0c\u4e5f\u7b97case\u901a\u8fc7\u4e86\uff08\u8fd9\u6837\u901a\u8fc7\u7387\u6570\u636e\u597d\u770b\uff09\uff0c\u4f46\u8fd9\u91cc\u6211\u4e0d\u592a\u60f3\u8fd9\u4e48\u505a\u3002","title":"\u719f\u6089\u9700\u6c42"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28126%29%20%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A%E9%A1%B5%E9%9D%A2%E9%87%8D%E8%AF%95%E5%8A%9F%E8%83%BD/#_3","text":"\u5176\u5b9e\u8fd9\u8fb9\u6211\u4eec\u53ea\u9700\u8981\u83b7\u53d6\u5230\u5bf9\u5e94\u7684 case_id \uff0c \u6d4b\u8bd5\u6570\u636eid , \u5bf9\u5e94\u7684\u6267\u884c\u73af\u5883 \u5c31\u53ef\u4ee5\u76f4\u63a5\u91cd\u65b0\u8fd0\u884c\u8fd9\u4e00\u6761case\uff0c\u4f46\u6211\u4eec\u7684 \u6d4b\u8bd5\u7ed3\u679c\u8868 \uff0c\u76ee\u524d\u6ca1\u6709data_id\u8fd9\u4e2a\u5b57\u6bb5\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u505a\u4e00\u4e9b\u8c03\u6574\u3002 \u800c\u4e14\u6211\u4eec\u4e5f\u6ca1\u6709\u6839\u636e\u6d4b\u8bd5\u6570\u636e\u76f4\u63a5\u6267\u884ccase\u7684\u63a5\u53e3\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u7f16\u5199\u4e00\u4e2a\u8fd9\u6837\u7684\u63a5\u53e3\u3002","title":"\u601d\u8def"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28126%29%20%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A%E9%A1%B5%E9%9D%A2%E9%87%8D%E8%AF%95%E5%8A%9F%E8%83%BD/#_4","text":"\u4fee\u6539model\u548c__init__\u65b9\u6cd5\uff0c\u63a5\u7740\u6211\u4eec\u8981\u53bb\u6539\u52a8\u7528\u5230init\u7684\u5730\u65b9\u3002","title":"\u5b57\u6bb5\u6539\u9020"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28126%29%20%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A%E9%A1%B5%E9%9D%A2%E9%87%8D%E8%AF%95%E5%8A%9F%E8%83%BD/#_5","text":"\u4fee\u6539TestResult.py\u7684insert\u65b9\u6cd5\u3002 \u4fee\u6539run_with_test_data\u65b9\u6cd5\u3002 \u4fee\u6539run_single\u65b9\u6cd5\u3002","title":"\u6539\u52a8\u4f7f\u7528\u5904"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28126%29%20%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A%E9%A1%B5%E9%9D%A2%E9%87%8D%E8%AF%95%E5%8A%9F%E8%83%BD/#_6","text":"\u5728http.py\u65b0\u589eretry\u65b9\u6cd5\uff0c\u9996\u5148\u6839\u636eid\u67e5\u5230\u6d4b\u8bd5\u6570\u636e\uff0c\u63a5\u7740\u8c03\u7528\u6267\u884ccase\u7684\u65b9\u6cd5\uff0c\u6700\u540e\u8fd4\u56de\u6570\u636e\u5373\u53ef\u3002","title":"\u7f16\u5199\u540e\u7aef\u63a5\u53e3"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28126%29%20%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A%E9%A1%B5%E9%9D%A2%E9%87%8D%E8%AF%95%E5%8A%9F%E8%83%BD/#_7","text":"\u4fee\u6539model/service \u5f88\u663e\u7136\u6211\u4eec\u8981\u5199\u4e00\u4e2amodel\u65b9\u6cd5\u548c\u4e00\u4e2aservice\u65b9\u6cd5\uff0c\u5982\u4e0b\uff1a \u4fee\u6539\u7f16\u8f91\u680f \u64cd\u4f5c\u8fd9\u91cc\u7ed9\u51fa2\u4e2aa\u6807\u7b7e\uff08\u6309\u94ae\uff09\uff0c\u7b2c\u4e00\u4e2a\u662f\u65e5\u5fd7\uff0c\u7b2c\u4e8c\u4e2a\u662f\u91cd\u8bd5\u3002 \u5177\u4f53\u7684\u91cd\u8bd5\u65b9\u6cd5\uff1a \u5148\u8c03\u7528\u91cd\u8bd5\u65b9\u6cd5\uff0c\u62ff\u5230\u8fd4\u56de\u503c\u4ee5\u540e\uff0c\u628acase\u8fd0\u884c\u7ed3\u679c\u5199\u5165response\uff0c\u8fd9\u4e2aresponse\u4e0e\u666e\u901a\u67e5\u770b\u65e5\u5fd7\u7684\u7a97\u53e3\u5171\u7528\u3002","title":"\u8c03\u6574\u524d\u7aef"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28126%29%20%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A%E9%A1%B5%E9%9D%A2%E9%87%8D%E8%AF%95%E5%8A%9F%E8%83%BD/#_8","text":"\u91cd\u8bd5\u53ea\u662f \u518d\u6267\u884ccase \u4e00\u6b21\uff0c\u5e76\u4e0d\u4f1a\u505a\u66f4\u591a \u989d\u5916 \u7684\u64cd\u4f5c\u3002 \u6211\u662f\u7c73\u6d1b\uff0c\u4e00\u76f4\u966a\u4f34\u5404\u4f4d\u5b66\u4e60\uff01\u514d\u8d39\u7684 \u5c0f\u9ec4\u5fc3 \uff0c\u5e2e\u6211\u70b9\u4e00\u4e2a\u5427\uff01 \u9879\u76ee\u5730\u5740: https://github.com/wuranxu/pity","title":"\u770b\u770b\u6548\u679c"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28127%29%20%E6%94%B9%E9%80%A0%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E6%8F%90%E5%8F%96%E6%96%B9%E5%BC%8F%281%29/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u4e00\u8d77\u4ea4\u6d41\u5b66\u4e60! \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u5728 \u6d4b\u8bd5\u62a5\u544a \u9875\u9762\u589e\u52a0\u4e86\u91cd\u8bd5\u529f\u80fd\uff0c\u4f7f\u5f97\u7528\u4f8b\u8c03\u8bd5\u53d8\u5f97\u66f4\u4e3a\u65b9\u4fbf\u3002 \u6700\u8fd1\u56e0\u4e3a\u81ea\u5df1\u95f2\u7684\u86cb\u75bc\u5728\u770b\u4e00\u4e9b\u6027\u80fd\u6d4b\u8bd5\u5e73\u53f0\uff0c\u4e5f\u611f\u53d7\u5230\u4e86\u4e00\u4e9b\u4e0d\u540c\uff0c\u867d\u7136\u4eba\u5bb6\u53ea\u662f\u538b\u6d4b\u5de5\u5177\uff0c\u4f46\u5bf9\u4e8e\u63a5\u53e3\u6d4b\u8bd5\u4e2d\u7684\u4e00\u4e9b\u53c2\u6570\u5904\u7406\uff0c\u505a\u7684\u8fd8\u662f\u633a\u51fa\u8272\u7684\uff0c\u6240\u4ee5\u6211\u6253\u7b97\u5c0f\u5c0f\u5730 \"\u501f\u9274\" \u4e00\u4e0b\u3002 (\u7531\u4e8e\u6574\u4f53\u8bbe\u8ba1\u4e0d\u592a\u4e00\u81f4\uff0c\u6240\u4ee5\u6682\u65f6\u53ea\u5265\u79bb\u4ed6\u7528\u5230\u7684\u90a3\u5757\u5185\u5bb9\u3002) \u4e0a\u56fe\u5c31\u662f\u91cd\u70b9\u90e8\u5206\u5566\uff0c\u56fe\u4e2d\u8fd9\u4e2a\u7cfb\u7edf\uff08pts\u5373\u963f\u91cc\u4e91\u7684\u6027\u80fd\u6d4b\u8bd5\u5de5\u5177\uff09\u76f8\u6bd4\u8f83pity\u800c\u8a00\uff0c\u4ed6\u5bf9\u4e8e \u4e0a\u4e00\u63a5\u53e3\u7684\u8fd4\u56de\u503c \u6709\u7740\u5f88\u660e\u786e\u7684\u89c4\u5212\u3002 \u5b83\u5e76\u4e0d\u63d0\u4f9b\u5b8c\u6574\u7684\u6570\u636e\uff08pity\u76ee\u524d\u4f1a\u63d0\u4f9bresponse\uff0cheader\uff0ccookie\uff0cstatus_code\u7b49\u4e00\u5927\u5806\u6570\u636e\uff0c\u653e\u5230\u4e00\u4e2a\u5b57\u5178\u4f9b\u7528\u6237\u53bb\u53d6\u503c\uff09\uff0c\u8fd9\u70b9\u7684\u8bdd\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u8981\u7528\u5230\u7684\u6570\u636e\uff0c\u4ed6\u53ef\u4ee5\u5265\u79bb\u51fa\u6765\uff0c\u7528\u4f8b\u7ed3\u6784\u66f4\u900f\u660e\uff0c\u7528\u5230\u4ec0\u4e48\u6570\u636e\u4e00\u76ee\u4e86\u7136\uff0c\u6709\u4e86\u7c7b\u578b\u7684\u533a\u522b\uff0c\u4e5f\u5f88\u5bb9\u6613\u5206\u522b\u51fa\u8fd9\u4e2a\u53d8\u91cf\u6765\u81ea \u54ea\u91cc \uff0c\u662fresponse\uff0c\u8fd8\u662fresponse_header\u3002 \u5f53\u7136\u5b83\u5b9a\u4e49\u7684\u53d8\u91cf\u4e5f\u662f\u53ef\u4ee5\u7ed9\u540e\u9762\u7684\u4efb\u610f\u63a5\u53e3\u7528\u7684\u54e6\uff0c\u8fd9\u6837\u5c31\u7ec4\u6210\u4e86\u4e00\u4e2a\u51fa\u53c2\u5217\u8868\uff0c\u5728\u5fc5\u8981\u7684\u8f93\u5165\u6846\u8fd8\u53ef\u4ee5\u9009\u62e9\uff0c\u63d0\u9ad8\u7528\u6237\u7684\u8f93\u5165\u6548\u7387\uff0c\u907f\u514d\u7528\u6237\u8f93\u5165\u4ee5\u4e0b\u8fd9\u79cd\u4e0d\u53ef\u63a7\u7684\u53d6\u503c\"\u51fd\u6570\"(\u8fd9\u91cc\u5148\u59d1\u4e14\u8fd9\u4e48\u79f0\u547c): ${response.data.0.field} \u6240\u4ee5\uff0c\u6709\u65f6\u5019\u4e0d\u65ad\u501f\u9274\uff0c\u5b8c\u5584\u81ea\u5df1\uff0c\u4e5f\u4e0d\u5931\u4e3a\u4e00\u4ef6\u574f\u4e8b\u561b\u3002 \u7406\u6e05\u695a\u601d\u8def \u6211\u4eec\u634b\u4e00\u634bpts\u7684\u601d\u8def\uff0c\u5f53\u6765\u6e90\u4e3aJSON\u6216\u8005header\u8fd9\u79cdK/V(\u952e\u503c\u5bf9\u7684\u7f29\u5199\uff0c\u5373key/value)\u6570\u636e\u7684\u65f6\u5019\uff0c\u5b83\u91c7\u7528 JSONPath \u53d6\u503c\u3002 \u800c\u5f53\u6765\u6e90\u4e3aTEXT(\u6587\u672c)\u7684\u65f6\u5019\uff0c\u5b83\u53c8\u652f\u6301\u6b63\u5219\u53d6\u503c\uff0c\u8fd9\u6837\u5c31\u57fa\u672c\u80fd\u6ee1\u8db3\u6211\u4eec\u5927\u90e8\u5206\u9700\u6c42\u4e86\uff0c\u56e0\u4e3a\u5b83\u8fd8\u652f\u6301\u7d22\u5f15\uff0c\u6bd4\u5982\u6211\u6b63\u5219\u4e00\u4e0b\u5b50\u53d6\u51fa\u5f88\u591a\u503c\uff0c\u53ef\u4ee5\u9009\u51fa\u5176\u4e2d\u4e00\u4e2a\uff0c\u66f4\u662f\u652f\u6301random\uff08\u968f\u673a\u53d6\u503c\uff09\u3002 \u603b\u7ed3\u6765\u8bf4\uff0c\u5176\u5b9e\u4e5f\u5c31\u5206\u4e3aJSONpath\u548c\u6b63\u52192\u79cd\uff0c\u6b63\u5219\u8fd8\u9700\u8981\u591a\u4e00\u4e2a\u7d22\u5f15\u53d6\u503c\u3002\u5e76\u4e0d\u96be\uff0c\u719f\u6089\u5b8c\u4e86\u4ee5\u540e\u6211\u4eec\u5c31\u53ef\u4ee5\u5b9a\u4e49\u53c2\u6570\u8868\u4e86\u3002 \u5b9a\u4e49\u53c2\u6570\u8868 \u65b0\u5efaapp/models/out_parameters.py from sqlalchemy import Column , String , INT , UniqueConstraint from app.models.basic import PityBase class PityTestCaseOutParameters ( PityBase ): \"\"\" pity\u7528\u4f8b\u51fa\u53c2\u6570\u636e\uff0c\u4e0e\u7528\u4f8b\u7ed1\u5b9a \"\"\" __tablename__ = 'pity_out_parameters' __table_args__ = ( UniqueConstraint ( 'case_id' , 'name' , 'deleted_at' ), ) # \u7528\u4f8bid case_id = Column ( INT , nullable = False ) # \u53c2\u6570\u540d name = Column ( String ( 24 ), nullable = False ) # \u6765\u6e90\u7c7b\u578b source = Column ( INT , nullable = False , default = 0 , comment = \"0: Body(TEXT) 1: Body(JSON) 2: Header 3: Cookie 4: HTTP\u72b6\u6001\u7801\" ) # \u8868\u8fbe\u5f0f expression = Column ( String ( 128 )) # \u83b7\u53d6\u7ed3\u679c\u7d22\u5f15, \u53ef\u4ee5\u662frandom\uff0c\u4e5f\u53ef\u4ee5\u662fall\uff0c\u8fd8\u53ef\u4ee5\u662f\u6570\u5b57 match_index = Column ( String ( 16 )) def __init__ ( self , name , source , expression , match_index , case_id , user_id ): super () . __init__ ( user_id ) self . name = name self . case_id = case_id self . expression = expression self . match_index = match_index self . source = source \u7531\u4e8e\u9700\u8981\u4e0ecase_id\u7ed1\u5b9a\uff0c\u5176\u4ed6\u7684\u5c31\u4e0d\u9700\u8981\u591a\u8bf4\u4e86\uff0c\u90fd\u662f\u4e0a\u56fe\u4e2d\u5e94\u8be5\u5177\u5907\u7684\u5b57\u6bb5\uff1a\u540d\u79f0\uff0c\u7528\u4f8bid\uff0c\u6765\u6e90\uff0c\u8868\u8fbe\u5f0f\uff0c\u7d22\u5f15\u3002 \u7f16\u5199dao\u5c42 \u8fd9\u91cc\u7531\u4e8e\u6211\u4eec\u5c01\u88c5\u4e86\u4e00\u4e0b\uff0c\u6240\u4ee5\u4e0d\u9700\u8981\u5f88\u590d\u6742\u5373\u53ef\u5b8c\u6210\u3002\u6dfb\u52a0app/crud/test_case/TestCaseOutParametersDao.py\uff0c\u5176\u5b9e\u6211\u4e00\u76f4\u89c9\u5f97\u8fd9\u4e2a\u5904\u7406\u4e0d\u662f\u5f88\u4f18\u96c5\uff0c\u4f46\u73b0\u72b6\u662f\u53ef\u4ee5\u653e\u4e00\u653e\uff0c\u6bd5\u7adf\u80fd\u7528\uff0c\u4ee3\u7801\u91cf\u4e5f\u4e0d\u591a\u3002 from app.crud import Mapper from app.models.out_parameters import PityTestCaseOutParameters from app.utils.decorator import dao from app.utils.logger import Log @dao ( PityTestCaseOutParameters , Log ( \"PityTestCaseOutParametersDao\" )) class PityTestCaseOutParametersDao ( Mapper ): pass \u5982\u679c\u6ca1\u6709\u7279\u6b8a\u7684\u65b9\u6cd5\uff0c\u76f4\u63a5\u7ee7\u627f\u5373\u53ef\u3002 \u5b9a\u4e49form\u8868\u5355 \u6dfb\u52a0\u6587\u4ef6app/schema/testcase_out_parameters.py from pydantic import BaseModel , validator from app.schema.base import PityModel class PityTestCaseOutParametersForm ( BaseModel ): id : int = None case_id : int = None name : str expression : str match_index : str = None source : int @validator ( \"expression\" , \"name\" , \"source\" ) def name_not_empty ( cls , v ): return PityModel . not_empty ( v ) \u7f16\u5199router\u5c42 \u4fee\u6539app/routers/testcase/testcase.py \u7531\u4e8e\u505a\u4e86\u5168\u5c40\u5f02\u5e38\u6355\u83b7\uff0c\u6240\u4ee5\u8fd9\u628a\u7684try/except\u5c31\u7701\u7565\u4e86\uff0c\u4e0d\u629b\u5f02\u5e38\u5373\u53ef\u89c6\u4e3a\u6b63\u5e38\u4e86\u3002 \u6ce8\u610f\u8fd9\u513f \u6ca1\u6709\u67e5\u8be2\u63a5\u53e3 \uff0c\u90a3\u662f\u56e0\u4e3a\u53c2\u6570\u90fd\u662f\u548c\u7528\u4f8b\u7ed1\u5b9a\u7684\uff0c\u6211\u4eec\u5230\u67e5\u8be2\u7528\u4f8b\u4fe1\u606f\u7684\u65f6\u5019\u67e5\u8be2\u6570\u636e\u5373\u53ef\u3002 \u4fee\u6539\u67e5\u8be2\u7528\u4f8b\u7684\u63a5\u53e3 \u8fd9\u91cc\u987a\u4fbf\u628aout_parameters\u67e5\u8be2\u51fa\u6765\u5373\u53ef\u3002 \u8fd9\u8282\u5185\u5bb9\u4e3b\u8981\u7ed9\u5927\u5bb6\u5c55\u793a\u4e00\u4e2a\u5176\u4ed6\u4f18\u79c0\u5e73\u53f0\u7684\u8bbe\u8ba1\uff0c\u4e0b\u4e00\u8282\u6211\u4eec\u8bb2\u8bb2\u600e\u4e48\u7f16\u5199\u524d\u7aef\u90e8\u5206\uff0c\u4f7f\u5f97\u6211\u4eec\u53ef\u4ee5\u6b63\u5e38\u5f55\u5165\u6570\u636e\uff0c\u5148\u6765\u770b\u4e2a\u9884\u544a\uff1a (\u5199\u524d\u7aef\u5b9e\u5728\u5f88\u82b1\u65f6\u95f4=\u3002=) \u6211\u662f\u7c73\u6d1b\uff0c\u4e00\u76f4\u966a\u4f34\u5404\u4f4d\u5b66\u4e60\uff01\u514d\u8d39\u7684 \u5c0f\u9ec4\u5fc3 \uff0c\u5e2e\u6211\u70b9\u4e00\u4e2a\u5427\uff01 \u9879\u76ee\u5730\u5740: https://github.com/wuranxu/pity","title":"127.\u6539\u9020\u8bf7\u6c42\u53c2\u6570\u63d0\u53d6\u65b9\u5f0f(1)"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28127%29%20%E6%94%B9%E9%80%A0%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E6%8F%90%E5%8F%96%E6%96%B9%E5%BC%8F%281%29/#_1","text":"\u4e0a\u4e00\u8282\u6211\u4eec\u5728 \u6d4b\u8bd5\u62a5\u544a \u9875\u9762\u589e\u52a0\u4e86\u91cd\u8bd5\u529f\u80fd\uff0c\u4f7f\u5f97\u7528\u4f8b\u8c03\u8bd5\u53d8\u5f97\u66f4\u4e3a\u65b9\u4fbf\u3002 \u6700\u8fd1\u56e0\u4e3a\u81ea\u5df1\u95f2\u7684\u86cb\u75bc\u5728\u770b\u4e00\u4e9b\u6027\u80fd\u6d4b\u8bd5\u5e73\u53f0\uff0c\u4e5f\u611f\u53d7\u5230\u4e86\u4e00\u4e9b\u4e0d\u540c\uff0c\u867d\u7136\u4eba\u5bb6\u53ea\u662f\u538b\u6d4b\u5de5\u5177\uff0c\u4f46\u5bf9\u4e8e\u63a5\u53e3\u6d4b\u8bd5\u4e2d\u7684\u4e00\u4e9b\u53c2\u6570\u5904\u7406\uff0c\u505a\u7684\u8fd8\u662f\u633a\u51fa\u8272\u7684\uff0c\u6240\u4ee5\u6211\u6253\u7b97\u5c0f\u5c0f\u5730 \"\u501f\u9274\" \u4e00\u4e0b\u3002 (\u7531\u4e8e\u6574\u4f53\u8bbe\u8ba1\u4e0d\u592a\u4e00\u81f4\uff0c\u6240\u4ee5\u6682\u65f6\u53ea\u5265\u79bb\u4ed6\u7528\u5230\u7684\u90a3\u5757\u5185\u5bb9\u3002) \u4e0a\u56fe\u5c31\u662f\u91cd\u70b9\u90e8\u5206\u5566\uff0c\u56fe\u4e2d\u8fd9\u4e2a\u7cfb\u7edf\uff08pts\u5373\u963f\u91cc\u4e91\u7684\u6027\u80fd\u6d4b\u8bd5\u5de5\u5177\uff09\u76f8\u6bd4\u8f83pity\u800c\u8a00\uff0c\u4ed6\u5bf9\u4e8e \u4e0a\u4e00\u63a5\u53e3\u7684\u8fd4\u56de\u503c \u6709\u7740\u5f88\u660e\u786e\u7684\u89c4\u5212\u3002 \u5b83\u5e76\u4e0d\u63d0\u4f9b\u5b8c\u6574\u7684\u6570\u636e\uff08pity\u76ee\u524d\u4f1a\u63d0\u4f9bresponse\uff0cheader\uff0ccookie\uff0cstatus_code\u7b49\u4e00\u5927\u5806\u6570\u636e\uff0c\u653e\u5230\u4e00\u4e2a\u5b57\u5178\u4f9b\u7528\u6237\u53bb\u53d6\u503c\uff09\uff0c\u8fd9\u70b9\u7684\u8bdd\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u8981\u7528\u5230\u7684\u6570\u636e\uff0c\u4ed6\u53ef\u4ee5\u5265\u79bb\u51fa\u6765\uff0c\u7528\u4f8b\u7ed3\u6784\u66f4\u900f\u660e\uff0c\u7528\u5230\u4ec0\u4e48\u6570\u636e\u4e00\u76ee\u4e86\u7136\uff0c\u6709\u4e86\u7c7b\u578b\u7684\u533a\u522b\uff0c\u4e5f\u5f88\u5bb9\u6613\u5206\u522b\u51fa\u8fd9\u4e2a\u53d8\u91cf\u6765\u81ea \u54ea\u91cc \uff0c\u662fresponse\uff0c\u8fd8\u662fresponse_header\u3002 \u5f53\u7136\u5b83\u5b9a\u4e49\u7684\u53d8\u91cf\u4e5f\u662f\u53ef\u4ee5\u7ed9\u540e\u9762\u7684\u4efb\u610f\u63a5\u53e3\u7528\u7684\u54e6\uff0c\u8fd9\u6837\u5c31\u7ec4\u6210\u4e86\u4e00\u4e2a\u51fa\u53c2\u5217\u8868\uff0c\u5728\u5fc5\u8981\u7684\u8f93\u5165\u6846\u8fd8\u53ef\u4ee5\u9009\u62e9\uff0c\u63d0\u9ad8\u7528\u6237\u7684\u8f93\u5165\u6548\u7387\uff0c\u907f\u514d\u7528\u6237\u8f93\u5165\u4ee5\u4e0b\u8fd9\u79cd\u4e0d\u53ef\u63a7\u7684\u53d6\u503c\"\u51fd\u6570\"(\u8fd9\u91cc\u5148\u59d1\u4e14\u8fd9\u4e48\u79f0\u547c): ${response.data.0.field} \u6240\u4ee5\uff0c\u6709\u65f6\u5019\u4e0d\u65ad\u501f\u9274\uff0c\u5b8c\u5584\u81ea\u5df1\uff0c\u4e5f\u4e0d\u5931\u4e3a\u4e00\u4ef6\u574f\u4e8b\u561b\u3002","title":"\u56de\u987e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28127%29%20%E6%94%B9%E9%80%A0%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E6%8F%90%E5%8F%96%E6%96%B9%E5%BC%8F%281%29/#_2","text":"\u6211\u4eec\u634b\u4e00\u634bpts\u7684\u601d\u8def\uff0c\u5f53\u6765\u6e90\u4e3aJSON\u6216\u8005header\u8fd9\u79cdK/V(\u952e\u503c\u5bf9\u7684\u7f29\u5199\uff0c\u5373key/value)\u6570\u636e\u7684\u65f6\u5019\uff0c\u5b83\u91c7\u7528 JSONPath \u53d6\u503c\u3002 \u800c\u5f53\u6765\u6e90\u4e3aTEXT(\u6587\u672c)\u7684\u65f6\u5019\uff0c\u5b83\u53c8\u652f\u6301\u6b63\u5219\u53d6\u503c\uff0c\u8fd9\u6837\u5c31\u57fa\u672c\u80fd\u6ee1\u8db3\u6211\u4eec\u5927\u90e8\u5206\u9700\u6c42\u4e86\uff0c\u56e0\u4e3a\u5b83\u8fd8\u652f\u6301\u7d22\u5f15\uff0c\u6bd4\u5982\u6211\u6b63\u5219\u4e00\u4e0b\u5b50\u53d6\u51fa\u5f88\u591a\u503c\uff0c\u53ef\u4ee5\u9009\u51fa\u5176\u4e2d\u4e00\u4e2a\uff0c\u66f4\u662f\u652f\u6301random\uff08\u968f\u673a\u53d6\u503c\uff09\u3002 \u603b\u7ed3\u6765\u8bf4\uff0c\u5176\u5b9e\u4e5f\u5c31\u5206\u4e3aJSONpath\u548c\u6b63\u52192\u79cd\uff0c\u6b63\u5219\u8fd8\u9700\u8981\u591a\u4e00\u4e2a\u7d22\u5f15\u53d6\u503c\u3002\u5e76\u4e0d\u96be\uff0c\u719f\u6089\u5b8c\u4e86\u4ee5\u540e\u6211\u4eec\u5c31\u53ef\u4ee5\u5b9a\u4e49\u53c2\u6570\u8868\u4e86\u3002","title":"\u7406\u6e05\u695a\u601d\u8def"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28127%29%20%E6%94%B9%E9%80%A0%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E6%8F%90%E5%8F%96%E6%96%B9%E5%BC%8F%281%29/#_3","text":"\u65b0\u5efaapp/models/out_parameters.py from sqlalchemy import Column , String , INT , UniqueConstraint from app.models.basic import PityBase class PityTestCaseOutParameters ( PityBase ): \"\"\" pity\u7528\u4f8b\u51fa\u53c2\u6570\u636e\uff0c\u4e0e\u7528\u4f8b\u7ed1\u5b9a \"\"\" __tablename__ = 'pity_out_parameters' __table_args__ = ( UniqueConstraint ( 'case_id' , 'name' , 'deleted_at' ), ) # \u7528\u4f8bid case_id = Column ( INT , nullable = False ) # \u53c2\u6570\u540d name = Column ( String ( 24 ), nullable = False ) # \u6765\u6e90\u7c7b\u578b source = Column ( INT , nullable = False , default = 0 , comment = \"0: Body(TEXT) 1: Body(JSON) 2: Header 3: Cookie 4: HTTP\u72b6\u6001\u7801\" ) # \u8868\u8fbe\u5f0f expression = Column ( String ( 128 )) # \u83b7\u53d6\u7ed3\u679c\u7d22\u5f15, \u53ef\u4ee5\u662frandom\uff0c\u4e5f\u53ef\u4ee5\u662fall\uff0c\u8fd8\u53ef\u4ee5\u662f\u6570\u5b57 match_index = Column ( String ( 16 )) def __init__ ( self , name , source , expression , match_index , case_id , user_id ): super () . __init__ ( user_id ) self . name = name self . case_id = case_id self . expression = expression self . match_index = match_index self . source = source \u7531\u4e8e\u9700\u8981\u4e0ecase_id\u7ed1\u5b9a\uff0c\u5176\u4ed6\u7684\u5c31\u4e0d\u9700\u8981\u591a\u8bf4\u4e86\uff0c\u90fd\u662f\u4e0a\u56fe\u4e2d\u5e94\u8be5\u5177\u5907\u7684\u5b57\u6bb5\uff1a\u540d\u79f0\uff0c\u7528\u4f8bid\uff0c\u6765\u6e90\uff0c\u8868\u8fbe\u5f0f\uff0c\u7d22\u5f15\u3002","title":"\u5b9a\u4e49\u53c2\u6570\u8868"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28127%29%20%E6%94%B9%E9%80%A0%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E6%8F%90%E5%8F%96%E6%96%B9%E5%BC%8F%281%29/#dao","text":"\u8fd9\u91cc\u7531\u4e8e\u6211\u4eec\u5c01\u88c5\u4e86\u4e00\u4e0b\uff0c\u6240\u4ee5\u4e0d\u9700\u8981\u5f88\u590d\u6742\u5373\u53ef\u5b8c\u6210\u3002\u6dfb\u52a0app/crud/test_case/TestCaseOutParametersDao.py\uff0c\u5176\u5b9e\u6211\u4e00\u76f4\u89c9\u5f97\u8fd9\u4e2a\u5904\u7406\u4e0d\u662f\u5f88\u4f18\u96c5\uff0c\u4f46\u73b0\u72b6\u662f\u53ef\u4ee5\u653e\u4e00\u653e\uff0c\u6bd5\u7adf\u80fd\u7528\uff0c\u4ee3\u7801\u91cf\u4e5f\u4e0d\u591a\u3002 from app.crud import Mapper from app.models.out_parameters import PityTestCaseOutParameters from app.utils.decorator import dao from app.utils.logger import Log @dao ( PityTestCaseOutParameters , Log ( \"PityTestCaseOutParametersDao\" )) class PityTestCaseOutParametersDao ( Mapper ): pass \u5982\u679c\u6ca1\u6709\u7279\u6b8a\u7684\u65b9\u6cd5\uff0c\u76f4\u63a5\u7ee7\u627f\u5373\u53ef\u3002","title":"\u7f16\u5199dao\u5c42"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28127%29%20%E6%94%B9%E9%80%A0%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E6%8F%90%E5%8F%96%E6%96%B9%E5%BC%8F%281%29/#form","text":"\u6dfb\u52a0\u6587\u4ef6app/schema/testcase_out_parameters.py from pydantic import BaseModel , validator from app.schema.base import PityModel class PityTestCaseOutParametersForm ( BaseModel ): id : int = None case_id : int = None name : str expression : str match_index : str = None source : int @validator ( \"expression\" , \"name\" , \"source\" ) def name_not_empty ( cls , v ): return PityModel . not_empty ( v )","title":"\u5b9a\u4e49form\u8868\u5355"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28127%29%20%E6%94%B9%E9%80%A0%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E6%8F%90%E5%8F%96%E6%96%B9%E5%BC%8F%281%29/#router","text":"\u4fee\u6539app/routers/testcase/testcase.py \u7531\u4e8e\u505a\u4e86\u5168\u5c40\u5f02\u5e38\u6355\u83b7\uff0c\u6240\u4ee5\u8fd9\u628a\u7684try/except\u5c31\u7701\u7565\u4e86\uff0c\u4e0d\u629b\u5f02\u5e38\u5373\u53ef\u89c6\u4e3a\u6b63\u5e38\u4e86\u3002 \u6ce8\u610f\u8fd9\u513f \u6ca1\u6709\u67e5\u8be2\u63a5\u53e3 \uff0c\u90a3\u662f\u56e0\u4e3a\u53c2\u6570\u90fd\u662f\u548c\u7528\u4f8b\u7ed1\u5b9a\u7684\uff0c\u6211\u4eec\u5230\u67e5\u8be2\u7528\u4f8b\u4fe1\u606f\u7684\u65f6\u5019\u67e5\u8be2\u6570\u636e\u5373\u53ef\u3002","title":"\u7f16\u5199router\u5c42"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28127%29%20%E6%94%B9%E9%80%A0%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E6%8F%90%E5%8F%96%E6%96%B9%E5%BC%8F%281%29/#_4","text":"\u8fd9\u91cc\u987a\u4fbf\u628aout_parameters\u67e5\u8be2\u51fa\u6765\u5373\u53ef\u3002 \u8fd9\u8282\u5185\u5bb9\u4e3b\u8981\u7ed9\u5927\u5bb6\u5c55\u793a\u4e00\u4e2a\u5176\u4ed6\u4f18\u79c0\u5e73\u53f0\u7684\u8bbe\u8ba1\uff0c\u4e0b\u4e00\u8282\u6211\u4eec\u8bb2\u8bb2\u600e\u4e48\u7f16\u5199\u524d\u7aef\u90e8\u5206\uff0c\u4f7f\u5f97\u6211\u4eec\u53ef\u4ee5\u6b63\u5e38\u5f55\u5165\u6570\u636e\uff0c\u5148\u6765\u770b\u4e2a\u9884\u544a\uff1a (\u5199\u524d\u7aef\u5b9e\u5728\u5f88\u82b1\u65f6\u95f4=\u3002=) \u6211\u662f\u7c73\u6d1b\uff0c\u4e00\u76f4\u966a\u4f34\u5404\u4f4d\u5b66\u4e60\uff01\u514d\u8d39\u7684 \u5c0f\u9ec4\u5fc3 \uff0c\u5e2e\u6211\u70b9\u4e00\u4e2a\u5427\uff01 \u9879\u76ee\u5730\u5740: https://github.com/wuranxu/pity","title":"\u4fee\u6539\u67e5\u8be2\u7528\u4f8b\u7684\u63a5\u53e3"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28128%29%20%E6%94%B9%E9%80%A0%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E6%8F%90%E5%8F%96%E6%96%B9%E5%BC%8F%282%29/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u4e00\u8d77\u4ea4\u6d41\u5b66\u4e60! \u5199\u5728\u524d\u9762 \u672c\u6587\u4ee3\u7801\u5176\u5b9e\u5f88\u591a\uff0c\u4f46\u6587\u5b57\u66f4\u591a\uff0c\u4e3b\u8981\u662f\u60f3\u8bb2\u660e\u767d\u73b0\u5728\u7684\u60c5\u51b5\u3002\u6572\u8005\u83ab\u76f2\u76ee\uff0c\u8981\u4e00\u8d77\u601d\u8003\u3002\u5982\u679c\u53ea\u662f\u89c2\u671b\uff0c\u90a3\u5c31\u76f4\u63a5\u770b\u70b9\u56fe\u7247\u4e86\u89e3\u4e0b\u529f\u80fd\u5373\u53ef\u3002 \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u7f16\u5199\u4e86\u540e\u7aef\u90e8\u5206\u4ee3\u7801\uff0c\u4f60\u53ef\u80fd\u53d1\u73b0\u4e86\u4e00\u4e9bbug\uff0c\u4e0d\u8fc7\u6ca1\u5173\u7cfb\uff0c\u867d\u7136\u6ca1\u6709\u81ea\u6d4b\uff0c\u4f46\u662f\u8981\u5bf9\u81ea\u5df1\u7684curd\u6709\u4fe1\u5fc3\uff0c\u5b9e\u5728\u4e0d\u884c\uff0c\u524d\u7aef\u8c03\u8bd5\u7684\u65f6\u5019\uff0c\u8fd8\u53ef\u4ee5\u6539\u561b~ \u4e0d\u8fc7\u7531\u4e8e\u524d\u7aef\u6bd4\u8f83\u590d\u6742\uff08\u4e3b\u8981\u662f\u6211\u5199\u7684\u81ed\uff0c\u6211\u5c31\u4e0d\u591a\u5c55\u793a\u4e86\uff09\u3002\u5927\u81f4\u8bf4\u4e00\u4e0b\u6ce8\u610f\u4e8b\u9879\u5427: \u6211\u4eec\u9700\u8981\u4e00\u4e2a\u53ef\u52a8\u6001\u4f38\u7f29\u7684\u8868\u683c\u7ec4\u4ef6\uff0c\u8fd9\u79cd\u4e8b\u4ef6\u53ea\u80fd\u81ea\u5df1\u5199\uff0c\u6216\u8005\u53ef\u4ee5\u91c7\u7528\u4e0b\u9762\u8fd9\u79cd\u7ec4\u4ef6: \u56e0\u4e3a\u8fd9\u6837\u6700\u5bb9\u6613\u5b9e\u73b0\uff0c\u4f46\u662f\u4f53\u9a8c\u6ca1\u90a3\u4e48\u597d\uff08\u9700\u8981\u5728modal\u91cc\u9762\u7f16\u5199\u5185\u5bb9\uff0c\u64cd\u4f5c\u66f4\u7e41\u7410\uff09 \u7531\u4e8e\u5386\u53f2\u539f\u56e0\uff0c\u6211\u4eec\u7684 \u7528\u4f8b \u662f\u5b58\u5728 \u6dfb\u52a0 \u6001\u548c \u7f16\u8f91 \u6001\u7684\uff0c\u6dfb\u52a0\u6001\u6307\u7684\u662f\u5565\u90fd\u6ca1\u6709\uff0c\u6211\u4eec\u628a\u7528\u4f8b\u7684\u5168\u90e8\u6570\u636e\u4e00\u6b21\u6027\u6dfb\u52a0\u5230\u6570\u636e\u5e93\uff0c\u5176\u4e2d\u5c31\u5305\u62ec: \u7528\u4f8b\u6570\u636e \uff08\u7528\u4f8b\u8868\uff09 \u65ad\u8a00\u6570\u636e\uff08\u65ad\u8a00\u8868\uff09 \u6d4b\u8bd5\u6570\u636e\uff08\u6d4b\u8bd5\u6570\u636e\u8868\uff09 \u7b49\u7b49\u5176\u4ed6\u7684\u8868\u3002\u4f46\u662f\u7f16\u8f91\u6001\uff0c\u662f\u6211\u4eec\u5df2\u7ecf\u5b58\u5728\u7528\u4f8b\u6570\u636e\u7684\u57fa\u7840\u4e0a\uff0c\u5bf9\u5176\u4ed6\u8868\u8fdb\u884c\u7684 \u4fee\u6539 \u3002\u6bd4\u5982\u6211\u5df2\u7ecf\u6709\u4e00\u6761\u7528\u4f8b\uff0c\u73b0\u5728\u8981\u4fee\u6539\u5b83\uff0c\u6bd4\u5982\u7ed9\u5b83\u6dfb\u52a0\u4e00\u6761\u65b0\u7684 \u65ad\u8a00 \uff0c\u5982\u679c\u6cbf\u7528 \u6dfb\u52a0\u6001 \u7684\u8bdd\uff0c\u6211\u4eec\u4f1a\u9700\u8981\u66f4\u65b0\u4ee5\u4e0aN\u4e2a\u8868\uff0c\u5341\u5206\u590d\u6742\u3002\u4f46\u5176\u5b9e\u6211\u4eec\u53ea\u9700\u8981\u6dfb\u52a0\u4e00\u6761\u65ad\u8a00\u6570\u636e\u5373\u53ef\u3002 \u6240\u4ee5\u4ee5\u4e0a\u5c31\u662f\u6211\u4eec\u7684\u5386\u53f2\u73b0\u72b6\uff0c\u6709\u4e86\u7f16\u8f91\u6001\u548c\u6dfb\u52a0\u6001\u3002\u5728\u6211\u4e4b\u524d\u8bbe\u8ba1\u7684\u5e73\u53f0\u91cc\uff0c\u662f\u628a\u65ad\u8a00/\u524d\u540e\u7f6e\u6761\u4ef6\u653e\u5230\u7528\u4f8b\u8868\u7684\u4e00\u4e2a\u5b57\u6bb5\uff0c\u6240\u4ee5 \u4e0d\u5b58\u5728 \u8fd9\u6837\u7684\u95ee\u9898\u3002\u5728\u719f\u6089\u4e86\u8fd92\u4e2a\u6a21\u5f0f\u4e4b\u540e\uff0c\u6211\u4eec\u7684 \u51fa\u53c2\u63d0\u53d6 \u63a5\u53e3\u4e5f\u5c06\u53d8\u5f97\u56f0\u96be\u3002 \u5176\u5b9e\u4e3b\u8981\u5c31\u662f\u4ee5\u4e0a2\u4e2a\u539f\u56e0\u5427\uff0c\u4e3a\u4e86\u65b9\u4fbf\uff0c\u6211\u4eec\u6253\u4e0d\u7b97\u91c7\u7528\u548c\u4e4b\u524d\u7684\u524d\u540e\u7f6e/\u65ad\u8a00\u4e00\u6837\u7684\u6a21\u5f0f\uff08\u652f\u6301\u6dfb\u52a0\u6001\u548c\u7f16\u8f91\u6001\uff09\u3002 \u4e3a\u4ec0\u4e48\u5462\uff1f\u56e0\u4e3a\u6dfb\u52a0\u6001\uff0c\u6dfb\u52a0\u6216\u7f16\u8f91\u4e00\u4e2a\u65ad\u8a00\uff08\u6b64\u65f6case\u8fd8\u6ca1\u6709\uff09\uff0c\u6211\u7684\u903b\u8f91\u662f\u6682\u5b58\u65ad\u8a00\u6570\u636e\uff0c\u800c\u7f16\u8f91\u6001\uff0c\u6211\u4eec\u6dfb\u52a0\u6216\u7f16\u8f91\u4e00\u4e2a\u65ad\u8a00\uff0c\u9700\u8981\u7acb\u523b\u751f\u6548\uff08\u5165\u5e93\uff09\u3002\u4e3a\u6b64\u6211\u4eec\u589e\u5220\u6539\uff0c\u5927\u7ea6\u6709 6\u5957\u903b\u8f91 \u3002 \u6709\u6ca1\u6709\u4e00\u79cd\u53ef\u80fd\uff0c\u53bb\u89c4\u907f\u8fd9\u4e9b\u590d\u6742\u903b\u8f91\uff0c\u540c\u65f6\u652f\u6301\u6dfb\u52a0/\u7f16\u8f91\u6001\u5462\uff1f\u90a3\u5c31\u53ea\u6709 \u6279\u91cf\u66f4\u65b0 \u8fd9\u4e00\u6761\u8def\u4e86\u3002 \u6240\u8c13\u6279\u91cf\u66f4\u65b0\uff0c\u5373\u628a\u6240\u6709\u51fa\u53c2\u6570\u636e\u6682\u5b58\u4e3a\u4e00\u4e2a\u6570\u7ec4\uff0c\u65e0\u8bba\u662f\u6dfb\u52a0/\u7f16\u8f91\u6001\uff0c\u6211\u4eec\u53ea\u6709\u6700\u540e\u4fdd\u5b58case\u7684\u65f6\u5019\uff0c\u624d\u53d1\u751f\u53d8\u5316\u3002 \u8bf4\u7b80\u5355\u4e00\u70b9\u5c31\u662f\u70b9\u51fb \u4fdd\u5b58\u7528\u4f8b \u6309\u94ae\u7684\u65f6\u5019\uff0c\u624d\u53bb\u6539\u53d8\u6570\u636e\u5e93\uff0c\u5176\u4ed6\u65f6\u5019\u6570\u636e\u90fd\u90fd\u653e\u5230\u6d4f\u89c8\u5668\u672c\u5730\u5185\u5b58\u3002 \u4f46\u8fd9\u91cc\u8fd8\u6709\u51e0\u4e2a\u8981\u6ce8\u610f\u7684\u70b9: \u5386\u53f2\u6570\u636e\u7684\u5220\u9664\uff08\u6bd4\u5982\u6211\u5220\u9664\u4e86\u4e00\u6761\u65e7\u7684\uff0c\u6dfb\u52a0\u4e86\u4e00\u6761\u65b0\u7684\uff0c\u6211\u4eec\u6279\u91cf\u66f4\u65b0\u7684\u65f6\u5019\u8981\u5bf9\u6bd4\uff09 \u5bf9\u4e8e\u8fd9\u4e00\u70b9\uff0c\u7b80\u5355\u7684\u529e\u6cd5\u662f\uff1a\u5148\u5220\u9664case_id\u4e0b\u7684\u6240\u6709\u51fa\u53c2\u6570\u636e\uff0c\u63a5\u7740\u5168\u90e8\u91cd\u65b0\u6dfb\u52a0\uff0c\u4f46\u8fd9\u6837\u4f1a\u5bfc\u81f4\u6570\u636e\u91cf\u8d8a\u6765\u8d8a\u591a\uff08\u8f6f\u5220\u9664\uff09\uff0c\u7269\u7406\u5220\u9664\u7684\u8bdd\uff0c\u4f1a\u5bfc\u81f4\u8fd9\u4e2a\u8868id\u81ea\u589e\u5f97\u98de\u5feb\uff0c\u4e0d\u8fc7\u5f71\u54cd\u4e0d\u662f\u5f88\u5927\u3002 \u9700\u8981\u7528\u4e8b\u52a1\u4fdd\u8bc1\uff0c\u6211\u4eec\u5fc5\u987b\u4fdd\u8bc1\u6240\u6709\u6570\u636e\u90fd\u7f16\u8f91\u5b8c\u6bd5\u3002 \u8fd9\u6837\u770b\u8d77\u6765\uff0c\u6211\u4eec\u540e\u7aef\u4e0a\u6b21\u5199\u7684\u6240\u8c13CRUD\uff0c\u5c31\u6ca1\u6709\u592a\u591a\u4f5c\u7528\u4e86\u3002\u56e0\u4e3a\u6211\u4eec\u53ef\u80fd\u53ea\u9700\u8981\u4e00\u4e2a\u63a5\u53e3: /parameters/update/bacth \u6539\u9020\u540e\u7aef \u6539\u9020\u540e\u7684dao\u6587\u4ef6: import time from datetime import datetime from typing import List from sqlalchemy import select , update from app.crud import Mapper from app.middleware.RedisManager import RedisHelper from app.models import async_session from app.models.out_parameters import PityTestCaseOutParameters from app.schema.testcase_out_parameters import PityTestCaseOutParametersForm from app.utils.decorator import dao from app.utils.logger import Log @dao ( PityTestCaseOutParameters , Log ( \"PityTestCaseOutParametersDao\" )) class PityTestCaseOutParametersDao ( Mapper ): @classmethod async def should_remove ( cls , before , after ): \"\"\" \u627e\u51fa\u8981\u5220\u9664\u7684\u6570\u636e :param before: :param after: :return: \"\"\" data = [] for b in before : for a in after : if a . id == b . id : break else : data . append ( b . id ) return data @classmethod @RedisHelper . up_cache ( \"dao\" ) async def update_many ( cls , case_id : int , data : List [ PityTestCaseOutParametersForm ], user_id : int ): result = [] try : async with async_session () as session : async with session . begin (): source = await session . execute ( select ( PityTestCaseOutParameters ) . where ( PityTestCaseOutParameters . case_id == case_id , PityTestCaseOutParameters . deleted_at == 0 , )) before = source . scalars () . all () should_remove = await cls . should_remove ( before , data ) for item in data : if item . id is None : # add temp = PityTestCaseOutParameters ( ** item . dict (), case_id = case_id , user_id = user_id ) session . add ( temp ) else : query = await session . execute ( select ( PityTestCaseOutParameters ) . where ( PityTestCaseOutParameters . id == item . id , )) temp = query . scalars () . first () if temp is None : # \u8d70\u65b0\u589e\u903b\u8f91 temp = PityTestCaseOutParameters ( ** item . dict (), case_id = case_id , user_id = user_id ) session . add ( temp ) else : temp . name = item . name temp . case_id = case_id temp . expression = item . expression temp . source = item . source temp . match_index = item . match_index temp . update_user = user_id temp . updated_at = datetime . now () await session . flush () session . expunge ( temp ) result . append ( temp ) if should_remove : await session . execute ( update ( PityTestCaseOutParameters ) . where ( PityTestCaseOutParameters . id . in_ ( should_remove )) . values ( deleted_at = int ( time . time () * 1000 ))) return result except Exception as e : cls . log . error ( f \"\u6279\u91cf\u66f4\u65b0\u51fa\u53c2\u6570\u636e\u5931\u8d25: { e } \" ) raise Exception ( f \"\u6279\u91cf\u66f4\u65b0\u51fa\u53c2\u6570\u636e\u5931\u8d25: { e } \" ) should_remove\u65b9\u6cd5\uff0c\u627e\u51fa\u4e86\u5e94\u8be5\u5220\u9664\u7684\u65e7\u7684\u6570\u636e\uff0c\u63a5\u7740\u91cc\u9762\u7684\u5185\u5bb9\u5c31\u662f \u6279\u91cf\u66f4\u65b0 \u7684\u90e8\u5206\uff1a \u5148\u67e5\u51fa\u8fd9\u4e2acase\u4e0b\u7684\u6240\u6709\u51fa\u53c2\u6570\u636e \u627e\u51fa\u8be5\u5220\u9664\u7684 \u904d\u5386\u6700\u65b0\u7684\u6570\u636e\uff0c\u5982\u679cid\u5b58\u5728\uff0c\u8bf4\u660e\u5df2\u7ecf\u6709\u6570\u636e\u4e86\uff0c\u6709\u5219\u66f4\u65b0\uff0c\u6ca1\u6709\u5219\u65b0\u589e \u5220\u9664\u8be5\u5220\u9664\u7684\u6570\u636e \u4ee5\u4e0a\u5c31\u662f\u65b9\u6cd5\u7684\u5168\u8fc7\u7a0b\uff0c\u4f46\u91c7\u7528\u4e86\u4e8b\u52a1\u4fdd\u8bc1\uff0c\u6240\u4ee5\u4e00\u65e6\u6709\u6570\u636e\u5931\u8d25\uff0c\u6211\u4eec\u4e5f\u4e0d\u4f1a\u6539\u53d8 \u4e0a\u4e00\u6b21 \u7684\u6570\u636e\u3002\u5728\u6700\u540e\u6211\u4eec\u8fd4\u56de\u4e86\u6240\u6709\u7f16\u8f91\u597d\u7684\u6570\u636e\uff08\u6ce8\u610f\u8fd9\u91cc\u4f1a\u5e26\u4e0a\u65b0\u589e\u597d\u7684id\u91cd\u65b0\u7ed9\u4e88\u524d\u7aef\uff0c\u524d\u7aef\u4e0b\u6b21\u8bf7\u6c42\u56de\u6765\u4e5f\u80fd\u5e26\u4e0a\u5177\u4f53\u7684id\uff09 \u6dfb\u52a0\u63a5\u53e3 \u5176\u5b9e\u662f\u4e0d\u9700\u8981\u8fd9\u4e2a\u63a5\u53e3\u7684\uff0c\u56e0\u4e3a\u6211\u4eec\u4f1a\u5728\u66f4\u65b0 \u7528\u4f8b \u7684\u65f6\u5019\uff0c\u987a\u4fbf\u66f4\u65b0\u8fd9\u4e2a\u6570\u636e\uff0c\u4e5f\u5c31\u4e0d\u62c6\u4e00\u4e2a\u65b0\u7684\u63a5\u53e3\u51fa\u6765\u4e86\u3002\u76f4\u63a5\u9700\u8981\u5728\u7528\u4f8bform\u91cc\u9762\u52a0\u4e0aList[PityTestCaseOutParameters]\u5b57\u6bb5\u3002 \u540c\u65f6\u7528\u4f8b\u8868\u5355\u4e5f\u52a0\u5165\u4e86\u8fd9\u4e2a\u5b57\u6bb5\uff0c\u90a3\u8fd9\u6837\u7f16\u8f91\u6001\u5c31\u641e\u5b9a\u4e86\u3002\u63a5\u7740\u6211\u4eec\u8fd8\u8981\u5904\u7406\u6dfb\u52a0\u6001\uff0c\u6ce8\u610f\u6dfb\u52a0case\u7684\u65f6\u5019\uff0c\u51fa\u53c2\u6570\u636e\u53ea\u9700\u8981 \u65b0\u589e \u5c31\u597d\u4e86\uff0c\u56e0\u4e3a\u5386\u53f2\u6570\u636e\u80af\u5b9a\u4e0d\u5b58\u5728\u554a\u3002 \u8fd8\u8bb0\u5f97\u6211\u4eec\u7f16\u5199\u8fc7\u7684\u4e00\u6b21\u6027\u5199\u5165\u6240\u6709case\u6570\u636e\u7684\u63a5\u53e3\u5417\uff1f \u6211\u4eec\u5728\u8fd9\u91cc\u4e5f\u63d2\u5165out_parameters\uff0c\u7c7b\u4f3c\u6d4b\u8bd5\u6570\u636e\uff0c\u524d\u540e\u7f6e\u6761\u4ef6\u548c\u65ad\u8a00\u3002 \u8fd9\u6b21\u6539\u52a8\u5185\u5bb9\u5f88\u591a\uff0c\u8be6\u60c5\u53ef\u770bgithub: \u524d\u7aef\u8c03\u6574 \u7531\u4e8e\u7f16\u8f91\u6001\u7684\u65f6\u5019\uff0c\u6211\u4eec\u9700\u8981\u70b9\u4e00\u4e0b \u7f16\u8f91 \u6309\u94ae\u624d\u80fd\u7f16\u8f91case\uff0c\u4f46\u5b9e\u9645\u4e0a\u6211\u4eec\u6539\u52a8\u7684\u662f\u4e0b\u9762\u7684 \u51fa\u53c2\u63d0\u53d6 \u6570\u636e\uff0c\u4f46\u8ba9\u4eba\u518d\u53bb\u70b9\u4e0b\u7f16\u8f91+\u4fdd\u5b58\uff0c\u662f\u6709\u70b9\u592a\u590d\u6742\u4e86\u3002 \u6240\u4ee5\u6211\u4eec\u628a\u63a5\u53e3\u8bf7\u6c42\u91cc\u9762\u7684\u4fdd\u5b58\u6309\u94ae\uff0c\u79fb\u5230tab\u6700\u540e\u4fa7: \u8fd9\u6837\u5c31\u89e3\u51b3\u4e86\u95ee\u9898\uff0c\u6211\u4eec\u770b\u4e0bcrud\u6b63\u5e38\u4e0d\uff1f \u67e5\u8be2 \u67e5\u8be2\u7684\u5730\u65b9\uff0c\u6211\u4eec\u4e5f\u5f97\u628a\u7528\u4f8b\u7684\u53c2\u6570\u6570\u636e\u62c9\u53d6\u51fa\u6765\u3002 \u770b\u770bgif \u8fd9\u79cd\u8868\u5355\u7f16\u5199\u7684\u4f53\u9a8c\u8fd8\u662f\u8fdc\u8fdc\u4e0d\u5982pts/postman/apipost\u8fd9\u79cd\u5de5\u5177\uff0c\u524d\u8def\u6162\u6162\uff0c\u76ee\u524d\u8fd8\u80fd\u53d1\u73b0\u4e00\u4e9b\u5c0fbug\uff0c\u4efb\u91cd\u9053\u8fdc\uff0c\u7ee7\u7eed\u52aa\u529b\u5427\u3002\u8d8a\u5199\u524d\u7aef\u8d8a\u6ca1\u4fe1\u5fc3\uff0c\u54ce~ \u4e0b\u4e00\u671f\u8bb2\u8bb2\u5982\u4f55\u63d0\u53d6\u53c2\u6570\uff0c\u4ee5\u53ca\u5982\u4f55\u4f7f\u7528\u53c2\u6570\u3002 \u6211\u662f\u7c73\u6d1b\uff0c\u4e00\u76f4\u966a\u4f34\u5404\u4f4d\u5b66\u4e60\uff01\u514d\u8d39\u7684 \u5c0f\u9ec4\u5fc3 \uff0c\u5e2e\u6211\u70b9\u4e00\u4e2a\u5427\uff01 \u9879\u76ee\u5730\u5740: https://github.com/wuranxu/pity","title":"128.\u6539\u9020\u8bf7\u6c42\u53c2\u6570\u63d0\u53d6\u65b9\u5f0f(2)"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28128%29%20%E6%94%B9%E9%80%A0%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E6%8F%90%E5%8F%96%E6%96%B9%E5%BC%8F%282%29/#_1","text":"\u672c\u6587\u4ee3\u7801\u5176\u5b9e\u5f88\u591a\uff0c\u4f46\u6587\u5b57\u66f4\u591a\uff0c\u4e3b\u8981\u662f\u60f3\u8bb2\u660e\u767d\u73b0\u5728\u7684\u60c5\u51b5\u3002\u6572\u8005\u83ab\u76f2\u76ee\uff0c\u8981\u4e00\u8d77\u601d\u8003\u3002\u5982\u679c\u53ea\u662f\u89c2\u671b\uff0c\u90a3\u5c31\u76f4\u63a5\u770b\u70b9\u56fe\u7247\u4e86\u89e3\u4e0b\u529f\u80fd\u5373\u53ef\u3002","title":"\u5199\u5728\u524d\u9762"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28128%29%20%E6%94%B9%E9%80%A0%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E6%8F%90%E5%8F%96%E6%96%B9%E5%BC%8F%282%29/#_2","text":"\u4e0a\u4e00\u8282\u6211\u4eec\u7f16\u5199\u4e86\u540e\u7aef\u90e8\u5206\u4ee3\u7801\uff0c\u4f60\u53ef\u80fd\u53d1\u73b0\u4e86\u4e00\u4e9bbug\uff0c\u4e0d\u8fc7\u6ca1\u5173\u7cfb\uff0c\u867d\u7136\u6ca1\u6709\u81ea\u6d4b\uff0c\u4f46\u662f\u8981\u5bf9\u81ea\u5df1\u7684curd\u6709\u4fe1\u5fc3\uff0c\u5b9e\u5728\u4e0d\u884c\uff0c\u524d\u7aef\u8c03\u8bd5\u7684\u65f6\u5019\uff0c\u8fd8\u53ef\u4ee5\u6539\u561b~ \u4e0d\u8fc7\u7531\u4e8e\u524d\u7aef\u6bd4\u8f83\u590d\u6742\uff08\u4e3b\u8981\u662f\u6211\u5199\u7684\u81ed\uff0c\u6211\u5c31\u4e0d\u591a\u5c55\u793a\u4e86\uff09\u3002\u5927\u81f4\u8bf4\u4e00\u4e0b\u6ce8\u610f\u4e8b\u9879\u5427: \u6211\u4eec\u9700\u8981\u4e00\u4e2a\u53ef\u52a8\u6001\u4f38\u7f29\u7684\u8868\u683c\u7ec4\u4ef6\uff0c\u8fd9\u79cd\u4e8b\u4ef6\u53ea\u80fd\u81ea\u5df1\u5199\uff0c\u6216\u8005\u53ef\u4ee5\u91c7\u7528\u4e0b\u9762\u8fd9\u79cd\u7ec4\u4ef6: \u56e0\u4e3a\u8fd9\u6837\u6700\u5bb9\u6613\u5b9e\u73b0\uff0c\u4f46\u662f\u4f53\u9a8c\u6ca1\u90a3\u4e48\u597d\uff08\u9700\u8981\u5728modal\u91cc\u9762\u7f16\u5199\u5185\u5bb9\uff0c\u64cd\u4f5c\u66f4\u7e41\u7410\uff09 \u7531\u4e8e\u5386\u53f2\u539f\u56e0\uff0c\u6211\u4eec\u7684 \u7528\u4f8b \u662f\u5b58\u5728 \u6dfb\u52a0 \u6001\u548c \u7f16\u8f91 \u6001\u7684\uff0c\u6dfb\u52a0\u6001\u6307\u7684\u662f\u5565\u90fd\u6ca1\u6709\uff0c\u6211\u4eec\u628a\u7528\u4f8b\u7684\u5168\u90e8\u6570\u636e\u4e00\u6b21\u6027\u6dfb\u52a0\u5230\u6570\u636e\u5e93\uff0c\u5176\u4e2d\u5c31\u5305\u62ec: \u7528\u4f8b\u6570\u636e \uff08\u7528\u4f8b\u8868\uff09 \u65ad\u8a00\u6570\u636e\uff08\u65ad\u8a00\u8868\uff09 \u6d4b\u8bd5\u6570\u636e\uff08\u6d4b\u8bd5\u6570\u636e\u8868\uff09 \u7b49\u7b49\u5176\u4ed6\u7684\u8868\u3002\u4f46\u662f\u7f16\u8f91\u6001\uff0c\u662f\u6211\u4eec\u5df2\u7ecf\u5b58\u5728\u7528\u4f8b\u6570\u636e\u7684\u57fa\u7840\u4e0a\uff0c\u5bf9\u5176\u4ed6\u8868\u8fdb\u884c\u7684 \u4fee\u6539 \u3002\u6bd4\u5982\u6211\u5df2\u7ecf\u6709\u4e00\u6761\u7528\u4f8b\uff0c\u73b0\u5728\u8981\u4fee\u6539\u5b83\uff0c\u6bd4\u5982\u7ed9\u5b83\u6dfb\u52a0\u4e00\u6761\u65b0\u7684 \u65ad\u8a00 \uff0c\u5982\u679c\u6cbf\u7528 \u6dfb\u52a0\u6001 \u7684\u8bdd\uff0c\u6211\u4eec\u4f1a\u9700\u8981\u66f4\u65b0\u4ee5\u4e0aN\u4e2a\u8868\uff0c\u5341\u5206\u590d\u6742\u3002\u4f46\u5176\u5b9e\u6211\u4eec\u53ea\u9700\u8981\u6dfb\u52a0\u4e00\u6761\u65ad\u8a00\u6570\u636e\u5373\u53ef\u3002 \u6240\u4ee5\u4ee5\u4e0a\u5c31\u662f\u6211\u4eec\u7684\u5386\u53f2\u73b0\u72b6\uff0c\u6709\u4e86\u7f16\u8f91\u6001\u548c\u6dfb\u52a0\u6001\u3002\u5728\u6211\u4e4b\u524d\u8bbe\u8ba1\u7684\u5e73\u53f0\u91cc\uff0c\u662f\u628a\u65ad\u8a00/\u524d\u540e\u7f6e\u6761\u4ef6\u653e\u5230\u7528\u4f8b\u8868\u7684\u4e00\u4e2a\u5b57\u6bb5\uff0c\u6240\u4ee5 \u4e0d\u5b58\u5728 \u8fd9\u6837\u7684\u95ee\u9898\u3002\u5728\u719f\u6089\u4e86\u8fd92\u4e2a\u6a21\u5f0f\u4e4b\u540e\uff0c\u6211\u4eec\u7684 \u51fa\u53c2\u63d0\u53d6 \u63a5\u53e3\u4e5f\u5c06\u53d8\u5f97\u56f0\u96be\u3002 \u5176\u5b9e\u4e3b\u8981\u5c31\u662f\u4ee5\u4e0a2\u4e2a\u539f\u56e0\u5427\uff0c\u4e3a\u4e86\u65b9\u4fbf\uff0c\u6211\u4eec\u6253\u4e0d\u7b97\u91c7\u7528\u548c\u4e4b\u524d\u7684\u524d\u540e\u7f6e/\u65ad\u8a00\u4e00\u6837\u7684\u6a21\u5f0f\uff08\u652f\u6301\u6dfb\u52a0\u6001\u548c\u7f16\u8f91\u6001\uff09\u3002 \u4e3a\u4ec0\u4e48\u5462\uff1f\u56e0\u4e3a\u6dfb\u52a0\u6001\uff0c\u6dfb\u52a0\u6216\u7f16\u8f91\u4e00\u4e2a\u65ad\u8a00\uff08\u6b64\u65f6case\u8fd8\u6ca1\u6709\uff09\uff0c\u6211\u7684\u903b\u8f91\u662f\u6682\u5b58\u65ad\u8a00\u6570\u636e\uff0c\u800c\u7f16\u8f91\u6001\uff0c\u6211\u4eec\u6dfb\u52a0\u6216\u7f16\u8f91\u4e00\u4e2a\u65ad\u8a00\uff0c\u9700\u8981\u7acb\u523b\u751f\u6548\uff08\u5165\u5e93\uff09\u3002\u4e3a\u6b64\u6211\u4eec\u589e\u5220\u6539\uff0c\u5927\u7ea6\u6709 6\u5957\u903b\u8f91 \u3002 \u6709\u6ca1\u6709\u4e00\u79cd\u53ef\u80fd\uff0c\u53bb\u89c4\u907f\u8fd9\u4e9b\u590d\u6742\u903b\u8f91\uff0c\u540c\u65f6\u652f\u6301\u6dfb\u52a0/\u7f16\u8f91\u6001\u5462\uff1f\u90a3\u5c31\u53ea\u6709 \u6279\u91cf\u66f4\u65b0 \u8fd9\u4e00\u6761\u8def\u4e86\u3002 \u6240\u8c13\u6279\u91cf\u66f4\u65b0\uff0c\u5373\u628a\u6240\u6709\u51fa\u53c2\u6570\u636e\u6682\u5b58\u4e3a\u4e00\u4e2a\u6570\u7ec4\uff0c\u65e0\u8bba\u662f\u6dfb\u52a0/\u7f16\u8f91\u6001\uff0c\u6211\u4eec\u53ea\u6709\u6700\u540e\u4fdd\u5b58case\u7684\u65f6\u5019\uff0c\u624d\u53d1\u751f\u53d8\u5316\u3002 \u8bf4\u7b80\u5355\u4e00\u70b9\u5c31\u662f\u70b9\u51fb \u4fdd\u5b58\u7528\u4f8b \u6309\u94ae\u7684\u65f6\u5019\uff0c\u624d\u53bb\u6539\u53d8\u6570\u636e\u5e93\uff0c\u5176\u4ed6\u65f6\u5019\u6570\u636e\u90fd\u90fd\u653e\u5230\u6d4f\u89c8\u5668\u672c\u5730\u5185\u5b58\u3002 \u4f46\u8fd9\u91cc\u8fd8\u6709\u51e0\u4e2a\u8981\u6ce8\u610f\u7684\u70b9: \u5386\u53f2\u6570\u636e\u7684\u5220\u9664\uff08\u6bd4\u5982\u6211\u5220\u9664\u4e86\u4e00\u6761\u65e7\u7684\uff0c\u6dfb\u52a0\u4e86\u4e00\u6761\u65b0\u7684\uff0c\u6211\u4eec\u6279\u91cf\u66f4\u65b0\u7684\u65f6\u5019\u8981\u5bf9\u6bd4\uff09 \u5bf9\u4e8e\u8fd9\u4e00\u70b9\uff0c\u7b80\u5355\u7684\u529e\u6cd5\u662f\uff1a\u5148\u5220\u9664case_id\u4e0b\u7684\u6240\u6709\u51fa\u53c2\u6570\u636e\uff0c\u63a5\u7740\u5168\u90e8\u91cd\u65b0\u6dfb\u52a0\uff0c\u4f46\u8fd9\u6837\u4f1a\u5bfc\u81f4\u6570\u636e\u91cf\u8d8a\u6765\u8d8a\u591a\uff08\u8f6f\u5220\u9664\uff09\uff0c\u7269\u7406\u5220\u9664\u7684\u8bdd\uff0c\u4f1a\u5bfc\u81f4\u8fd9\u4e2a\u8868id\u81ea\u589e\u5f97\u98de\u5feb\uff0c\u4e0d\u8fc7\u5f71\u54cd\u4e0d\u662f\u5f88\u5927\u3002 \u9700\u8981\u7528\u4e8b\u52a1\u4fdd\u8bc1\uff0c\u6211\u4eec\u5fc5\u987b\u4fdd\u8bc1\u6240\u6709\u6570\u636e\u90fd\u7f16\u8f91\u5b8c\u6bd5\u3002 \u8fd9\u6837\u770b\u8d77\u6765\uff0c\u6211\u4eec\u540e\u7aef\u4e0a\u6b21\u5199\u7684\u6240\u8c13CRUD\uff0c\u5c31\u6ca1\u6709\u592a\u591a\u4f5c\u7528\u4e86\u3002\u56e0\u4e3a\u6211\u4eec\u53ef\u80fd\u53ea\u9700\u8981\u4e00\u4e2a\u63a5\u53e3: /parameters/update/bacth","title":"\u56de\u987e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28128%29%20%E6%94%B9%E9%80%A0%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E6%8F%90%E5%8F%96%E6%96%B9%E5%BC%8F%282%29/#_3","text":"\u6539\u9020\u540e\u7684dao\u6587\u4ef6: import time from datetime import datetime from typing import List from sqlalchemy import select , update from app.crud import Mapper from app.middleware.RedisManager import RedisHelper from app.models import async_session from app.models.out_parameters import PityTestCaseOutParameters from app.schema.testcase_out_parameters import PityTestCaseOutParametersForm from app.utils.decorator import dao from app.utils.logger import Log @dao ( PityTestCaseOutParameters , Log ( \"PityTestCaseOutParametersDao\" )) class PityTestCaseOutParametersDao ( Mapper ): @classmethod async def should_remove ( cls , before , after ): \"\"\" \u627e\u51fa\u8981\u5220\u9664\u7684\u6570\u636e :param before: :param after: :return: \"\"\" data = [] for b in before : for a in after : if a . id == b . id : break else : data . append ( b . id ) return data @classmethod @RedisHelper . up_cache ( \"dao\" ) async def update_many ( cls , case_id : int , data : List [ PityTestCaseOutParametersForm ], user_id : int ): result = [] try : async with async_session () as session : async with session . begin (): source = await session . execute ( select ( PityTestCaseOutParameters ) . where ( PityTestCaseOutParameters . case_id == case_id , PityTestCaseOutParameters . deleted_at == 0 , )) before = source . scalars () . all () should_remove = await cls . should_remove ( before , data ) for item in data : if item . id is None : # add temp = PityTestCaseOutParameters ( ** item . dict (), case_id = case_id , user_id = user_id ) session . add ( temp ) else : query = await session . execute ( select ( PityTestCaseOutParameters ) . where ( PityTestCaseOutParameters . id == item . id , )) temp = query . scalars () . first () if temp is None : # \u8d70\u65b0\u589e\u903b\u8f91 temp = PityTestCaseOutParameters ( ** item . dict (), case_id = case_id , user_id = user_id ) session . add ( temp ) else : temp . name = item . name temp . case_id = case_id temp . expression = item . expression temp . source = item . source temp . match_index = item . match_index temp . update_user = user_id temp . updated_at = datetime . now () await session . flush () session . expunge ( temp ) result . append ( temp ) if should_remove : await session . execute ( update ( PityTestCaseOutParameters ) . where ( PityTestCaseOutParameters . id . in_ ( should_remove )) . values ( deleted_at = int ( time . time () * 1000 ))) return result except Exception as e : cls . log . error ( f \"\u6279\u91cf\u66f4\u65b0\u51fa\u53c2\u6570\u636e\u5931\u8d25: { e } \" ) raise Exception ( f \"\u6279\u91cf\u66f4\u65b0\u51fa\u53c2\u6570\u636e\u5931\u8d25: { e } \" ) should_remove\u65b9\u6cd5\uff0c\u627e\u51fa\u4e86\u5e94\u8be5\u5220\u9664\u7684\u65e7\u7684\u6570\u636e\uff0c\u63a5\u7740\u91cc\u9762\u7684\u5185\u5bb9\u5c31\u662f \u6279\u91cf\u66f4\u65b0 \u7684\u90e8\u5206\uff1a \u5148\u67e5\u51fa\u8fd9\u4e2acase\u4e0b\u7684\u6240\u6709\u51fa\u53c2\u6570\u636e \u627e\u51fa\u8be5\u5220\u9664\u7684 \u904d\u5386\u6700\u65b0\u7684\u6570\u636e\uff0c\u5982\u679cid\u5b58\u5728\uff0c\u8bf4\u660e\u5df2\u7ecf\u6709\u6570\u636e\u4e86\uff0c\u6709\u5219\u66f4\u65b0\uff0c\u6ca1\u6709\u5219\u65b0\u589e \u5220\u9664\u8be5\u5220\u9664\u7684\u6570\u636e \u4ee5\u4e0a\u5c31\u662f\u65b9\u6cd5\u7684\u5168\u8fc7\u7a0b\uff0c\u4f46\u91c7\u7528\u4e86\u4e8b\u52a1\u4fdd\u8bc1\uff0c\u6240\u4ee5\u4e00\u65e6\u6709\u6570\u636e\u5931\u8d25\uff0c\u6211\u4eec\u4e5f\u4e0d\u4f1a\u6539\u53d8 \u4e0a\u4e00\u6b21 \u7684\u6570\u636e\u3002\u5728\u6700\u540e\u6211\u4eec\u8fd4\u56de\u4e86\u6240\u6709\u7f16\u8f91\u597d\u7684\u6570\u636e\uff08\u6ce8\u610f\u8fd9\u91cc\u4f1a\u5e26\u4e0a\u65b0\u589e\u597d\u7684id\u91cd\u65b0\u7ed9\u4e88\u524d\u7aef\uff0c\u524d\u7aef\u4e0b\u6b21\u8bf7\u6c42\u56de\u6765\u4e5f\u80fd\u5e26\u4e0a\u5177\u4f53\u7684id\uff09","title":"\u6539\u9020\u540e\u7aef"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28128%29%20%E6%94%B9%E9%80%A0%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E6%8F%90%E5%8F%96%E6%96%B9%E5%BC%8F%282%29/#_4","text":"\u5176\u5b9e\u662f\u4e0d\u9700\u8981\u8fd9\u4e2a\u63a5\u53e3\u7684\uff0c\u56e0\u4e3a\u6211\u4eec\u4f1a\u5728\u66f4\u65b0 \u7528\u4f8b \u7684\u65f6\u5019\uff0c\u987a\u4fbf\u66f4\u65b0\u8fd9\u4e2a\u6570\u636e\uff0c\u4e5f\u5c31\u4e0d\u62c6\u4e00\u4e2a\u65b0\u7684\u63a5\u53e3\u51fa\u6765\u4e86\u3002\u76f4\u63a5\u9700\u8981\u5728\u7528\u4f8bform\u91cc\u9762\u52a0\u4e0aList[PityTestCaseOutParameters]\u5b57\u6bb5\u3002 \u540c\u65f6\u7528\u4f8b\u8868\u5355\u4e5f\u52a0\u5165\u4e86\u8fd9\u4e2a\u5b57\u6bb5\uff0c\u90a3\u8fd9\u6837\u7f16\u8f91\u6001\u5c31\u641e\u5b9a\u4e86\u3002\u63a5\u7740\u6211\u4eec\u8fd8\u8981\u5904\u7406\u6dfb\u52a0\u6001\uff0c\u6ce8\u610f\u6dfb\u52a0case\u7684\u65f6\u5019\uff0c\u51fa\u53c2\u6570\u636e\u53ea\u9700\u8981 \u65b0\u589e \u5c31\u597d\u4e86\uff0c\u56e0\u4e3a\u5386\u53f2\u6570\u636e\u80af\u5b9a\u4e0d\u5b58\u5728\u554a\u3002 \u8fd8\u8bb0\u5f97\u6211\u4eec\u7f16\u5199\u8fc7\u7684\u4e00\u6b21\u6027\u5199\u5165\u6240\u6709case\u6570\u636e\u7684\u63a5\u53e3\u5417\uff1f \u6211\u4eec\u5728\u8fd9\u91cc\u4e5f\u63d2\u5165out_parameters\uff0c\u7c7b\u4f3c\u6d4b\u8bd5\u6570\u636e\uff0c\u524d\u540e\u7f6e\u6761\u4ef6\u548c\u65ad\u8a00\u3002 \u8fd9\u6b21\u6539\u52a8\u5185\u5bb9\u5f88\u591a\uff0c\u8be6\u60c5\u53ef\u770bgithub:","title":"\u6dfb\u52a0\u63a5\u53e3"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28128%29%20%E6%94%B9%E9%80%A0%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E6%8F%90%E5%8F%96%E6%96%B9%E5%BC%8F%282%29/#_5","text":"\u7531\u4e8e\u7f16\u8f91\u6001\u7684\u65f6\u5019\uff0c\u6211\u4eec\u9700\u8981\u70b9\u4e00\u4e0b \u7f16\u8f91 \u6309\u94ae\u624d\u80fd\u7f16\u8f91case\uff0c\u4f46\u5b9e\u9645\u4e0a\u6211\u4eec\u6539\u52a8\u7684\u662f\u4e0b\u9762\u7684 \u51fa\u53c2\u63d0\u53d6 \u6570\u636e\uff0c\u4f46\u8ba9\u4eba\u518d\u53bb\u70b9\u4e0b\u7f16\u8f91+\u4fdd\u5b58\uff0c\u662f\u6709\u70b9\u592a\u590d\u6742\u4e86\u3002 \u6240\u4ee5\u6211\u4eec\u628a\u63a5\u53e3\u8bf7\u6c42\u91cc\u9762\u7684\u4fdd\u5b58\u6309\u94ae\uff0c\u79fb\u5230tab\u6700\u540e\u4fa7: \u8fd9\u6837\u5c31\u89e3\u51b3\u4e86\u95ee\u9898\uff0c\u6211\u4eec\u770b\u4e0bcrud\u6b63\u5e38\u4e0d\uff1f","title":"\u524d\u7aef\u8c03\u6574"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28128%29%20%E6%94%B9%E9%80%A0%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E6%8F%90%E5%8F%96%E6%96%B9%E5%BC%8F%282%29/#_6","text":"\u67e5\u8be2\u7684\u5730\u65b9\uff0c\u6211\u4eec\u4e5f\u5f97\u628a\u7528\u4f8b\u7684\u53c2\u6570\u6570\u636e\u62c9\u53d6\u51fa\u6765\u3002","title":"\u67e5\u8be2"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28128%29%20%E6%94%B9%E9%80%A0%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E6%8F%90%E5%8F%96%E6%96%B9%E5%BC%8F%282%29/#gif","text":"\u8fd9\u79cd\u8868\u5355\u7f16\u5199\u7684\u4f53\u9a8c\u8fd8\u662f\u8fdc\u8fdc\u4e0d\u5982pts/postman/apipost\u8fd9\u79cd\u5de5\u5177\uff0c\u524d\u8def\u6162\u6162\uff0c\u76ee\u524d\u8fd8\u80fd\u53d1\u73b0\u4e00\u4e9b\u5c0fbug\uff0c\u4efb\u91cd\u9053\u8fdc\uff0c\u7ee7\u7eed\u52aa\u529b\u5427\u3002\u8d8a\u5199\u524d\u7aef\u8d8a\u6ca1\u4fe1\u5fc3\uff0c\u54ce~ \u4e0b\u4e00\u671f\u8bb2\u8bb2\u5982\u4f55\u63d0\u53d6\u53c2\u6570\uff0c\u4ee5\u53ca\u5982\u4f55\u4f7f\u7528\u53c2\u6570\u3002 \u6211\u662f\u7c73\u6d1b\uff0c\u4e00\u76f4\u966a\u4f34\u5404\u4f4d\u5b66\u4e60\uff01\u514d\u8d39\u7684 \u5c0f\u9ec4\u5fc3 \uff0c\u5e2e\u6211\u70b9\u4e00\u4e2a\u5427\uff01 \u9879\u76ee\u5730\u5740: https://github.com/wuranxu/pity","title":"\u770b\u770bgif"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28129%29%20%E6%94%B9%E9%80%A0%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E6%8F%90%E5%8F%96%E6%96%B9%E5%BC%8F%283%29/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u4e00\u8d77\u4ea4\u6d41\u5b66\u4e60! \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u7f16\u5199\u597d\u4e86curd\u90e8\u5206\uff0c\u4e5f\u8054\u8c03\u4e86\u524d\u7aef\u3002\u8fd9\u4e00\u8282\u6211\u4eec\u6765\u5199\u540e\u7aef\u63d0\u53d6\u90e8\u5206: \u7f16\u5199\u63d0\u53d6\u5668\u7236\u7c7b app/core/paramters/parser.py, \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u6211\u5728exceptions\u76ee\u5f55\u5b9a\u4e49\u4e86case\u76f8\u5173\u7684\u5f02\u5e38\uff0c\u8fd9\u91ccimport\u5931\u8d25\u7684\u8bdd\uff0c\u4e0d\u8981\u60ca\u614c\uff0c\u81ea\u5df1\u53bb\u5b9a\u4e49\u4e00\u4e0b\u5427\u3002 import json import random from typing import Any from app.excpetions.CaseParametersException import CaseParametersException class Parser ( object ): @staticmethod def parse ( source : dict , expression : str = \"\" , idx : str = None ) -> Any : raise NotImplementedError @staticmethod def parse_result ( data : list , match_index : str = None ): if len ( data ) == 0 : return \"null\" # \u5982\u679c\u662f\u6570\u5b57 length = len ( data ) if match_index is not None : if match_index . isdigit (): idx = int ( match_index ) if idx >= length or idx < - length : raise CaseParametersException ( f \"results length is { length } , index is not in [ { - length } , { length } )\" ) return json . dumps ( data [ idx ], ensure_ascii = False ) if match_index . lower () == 'random' : # \u968f\u673a\u9009\u53d6 return json . dumps ( random . choice ( data ), ensure_ascii = False ) if match_index . lower () == 'all' : return json . dumps ( data , ensure_ascii = False ) raise CaseParametersException ( f \"invalid match index: { match_index } , not number or random\" ) return json . dumps ( data , ensure_ascii = False ) \u89e3\u6790\u5668\u63d0\u4f9b\u4e86\u4e00\u4e2aparse\u65b9\u6cd5\uff08\u672a\u5b9e\u73b0\uff0c\u9632\u6b62\u6709\u4eba\u8c03\u7528parse\uff0c\u76f4\u63a5\u629b\u51fa\u5f02\u5e38\uff09\u3002\u63a5\u7740\u5b9a\u4e49\u4e86\u4e00\u4e2a\u9ed8\u8ba4\u7684\u89e3\u6790\u7ed3\u679c\u7684\u65b9\u6cd5\uff1a \u7531\u4e8e\u6211\u4eec\u91c7\u7528JSONpath\u89e3\u6790\u6570\u636e\uff0c\u800c\u5b83\u6bcf\u6b21\u8fd4\u56de\u7684\u90fd\u662f\u6570\u7ec4\u5f62\u5f0f\u7684\u6570\u636e\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u518d\u6b21\u63d0\u53d6\u6570\u636e\uff0c\u6839\u636e\u7528\u6237\u4f20\u5165\u7684\u7d22\u5f15\uff0c\u8fd9\u91cc\u652f\u6301random\uff08\u968f\u673a\uff09\u548call(\u6240\u6709)\u3002 \u81f3\u4e8e\u4e3a\u4ec0\u4e48\u7528json.dumps()\uff0c\u56e0\u4e3a\u6211\u4eec\u7684\u53d8\u91cf\u66ff\u6362\u90fd\u91c7\u7528\u7684replace\u7684\u65b9\u6cd5\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u53ea\u53ef\u4ee5\u5bf9\u5b57\u7b26\u4e32\u8fdb\u884c\u66ff\u6362\uff0c\u5f53\u7136\u8fd9\u91cc\u9891\u7e41\u5730\u5e8f\u5217\u5316/\u53cd\u5e8f\u5217\u5316\uff0c\u5bf9\u6027\u80fd\u4f1a\u6709\u4e00\u5b9a\u7684\u5f71\u54cd\uff0c\u60f3\u8981\u6539\u5584\u8fd9\u4e2a\uff0c\u6211\u4eec\u5fc5\u987b\u5f97\u66f4\u6362replace\u7684\u65b9\u5f0f\u3002\uff08\u76ee\u524d\u8fd8\u4e0d\u5728\u8ba1\u5212\u5185\uff09 \u53ef\u4ee5\u770b\u5230\uff0c\u6211\u4eec\u6839\u636e\u7528\u6237\u7ed9\u7684\u7d22\u5f15\uff0c\u4e5f\u652f\u6301\u5012\u6570-1\u8fd9\u79cd\u53d6\u6cd5\uff0c\u57fa\u672c\u6ee1\u8db3\u4e86\u8981\u6c42\u3002\u63a5\u7740\u6211\u4eec\u53bb\u7f16\u5199JSON\uff0ckv\u548c\u6b63\u5219\u89e3\u6790\u5668\uff08\u53c2\u8003\u4e0a\u4e0a\u8282\uff09\u3002 4\u79cd\u89e3\u6790\u5668 status_code \u8fd9\u79cd\u6570\u636e\u6700\u4e3a\u7b80\u5355\uff0c\u6211\u4eec\u56fa\u5b9a\u53d6response\u7684status_code\u5373\u53ef\u3002 \u5176\u5b9e\u8fd9\u91cc\u4e5f\u53ef\u4ee5\u76f4\u63a5str\u3002 cookie/headers import json from typing import Any import jsonpath from app.core.paramters.parser import Parser from app.excpetions.CaseParametersException import CaseParametersException class HeaderParser ( Parser ): @staticmethod def get_source ( data : dict ): return json . loads ( data . get ( \"response_headers\" )) @classmethod def parse ( cls , source : dict , expression : str = \"\" , idx : str = None ) -> Any : if not source or not expression : raise CaseParametersException ( f \"parse out parameters failed, source or expression is empty\" ) try : source = cls . get_source ( source ) results = jsonpath . jsonpath ( source , expression ) if results is False : if not source and expression == \"$..*\" : # \u8bf4\u660e\u60f3\u8981\u5168\u5339\u914d\u5e76\u4e14\u6ca1\u6570\u636e\uff0c\u76f4\u63a5\u8fd4\u56dedata return source raise CaseParametersException ( \"jsonpath match failed, please check your response or jsonpath.\" ) return Parser . parse_result ( results , idx ) except CaseParametersException as e : raise e except Exception as err : raise CaseParametersException ( f \"parse json data error, please check jsonpath or json: { err } \" ) class CookieParser ( HeaderParser ): @staticmethod def get_source ( data : dict ): return json . loads ( data . get ( \"cookies\" )) \u8fd9\u91cc\u8981\u6ce8\u610f\u70b9: jsonpath\u53d6\u4e0d\u5230\u6570\u636e\u4f1a\u8fd4\u56deFalse\uff0c\u4f46\u5bf9\u4e8e\u7a7a\u6570\u7ec4\uff0c\u5b83\u4e5f\u53d6\u4e0d\u5230 \u6240\u4ee5\u6211\u4eec\u8981\u533a\u5206\uff08\u7a7a\u6570\u7ec4+\u5168\u5339\u914d\uff09\u548c\u5339\u914d\u4e0d\u5230\u7684\u60c5\u51b5\u3002 regex\uff08\u6b63\u5219\uff09 \"\"\" regex for text \"\"\" import re from typing import Any from app.core.paramters.parser import Parser from app.excpetions.CaseParametersException import CaseParametersException class RegexParser ( Parser ): @staticmethod def parse ( source : dict , expression : str = \"\" , idx : str = None ) -> Any : try : source = source . get ( \"response\" ) if not source or not expression : raise CaseParametersException ( f \"parse out parameters failed, source or expression is empty\" ) if idx is None : raise CaseParametersException ( \"index is empty, you must provide index for regex match results.\" ) pattern = re . compile ( expression ) result = re . findall ( pattern , source ) if len ( result ) == 0 : raise CaseParametersException ( f \"regex match failed, please check your regex: { expression } \" ) return Parser . parse_result ( result , idx ) except CaseParametersException as e : raise e except Exception as err : raise CaseParametersException ( f \"parse regex text error, please check regex or text: { err } \" ) \u4e0d\u591a\u8bf4\uff0c\u5c31\u662fre.match+findall\u3002 \u7f16\u5199\u89e3\u6790\u5668\u679a\u4e3e\u7c7b from enum import IntEnum class CaseParametersEnum ( IntEnum ): TEXT = 0 JSON = 1 HEADER = 2 COOKIE = 3 STATUS_CODE = 4 \u7f16\u5199getParser\u65b9\u6cd5 \u6539\u9020case\u6267\u884c\u90e8\u5206 \u5728app/core/executor.py\u6dfb\u52a0\u4ee5\u4e0b\u65b9\u6cd5: @case_log def extract_out_parameters ( self , response_info , data : List [ PityTestCaseOutParameters ]): \"\"\"\u63d0\u53d6\u51fa\u53c2\u6570\u636e\"\"\" result = dict () for d in data : p = ParametersParser ( d . source ) result [ d . name ] = p ( response_info , d . expression , d . match_index ) return result \u4fee\u6539run\u65b9\u6cd5: \u83b7\u53d6out_parameters \u83b7\u53d6\u540e\u5e76\u653e\u5165params\u5b57\u5178\uff0c\u66ff\u6362\u65ad\u8a00/\u540e\u7f6e\u6761\u4ef6\u5185\u5bb9 \u8fd9\u6837\u7684\u8bdd\uff0c\u65b0\u63d0\u53d6\u7684\u53c2\u6570\uff0c\u5c31\u53ef\u4ee5\u5728\u65ad\u8a00/\u540e\u7f6e\u6761\u4ef6\u4f7f\u7528\u4e86\uff0c\u6211\u4eec\u6765\u6d4b\u8bd5\u4e00\u4e0b\u3002 \u6d4b\u8bd5\u4e00\u4e0b \u51fa\u53c2\u662f \u6b63\u5219 \u548c \u72b6\u6001\u7801 \u770b\u770b\u65ad\u8a00\u90e8\u5206 \u5982\u679c\u6309\u7167\u9884\u671f: \u6b63\u5219+\u968f\u673a\u5339\u914d\uff0c\u4f1a\u67e5\u8be2\u5230 \u767e\u5ea6 code\u4f1a\u8fd4\u56de200 \u6267\u884c\u4e0b\u770b\u770b\u7ed3\u679c: \u53ef\u4ee5\u770b\u5230\u65ad\u8a00\u901a\u8fc7\uff0c\u6211\u4eec\u6765\u6253\u5370\u4e0b\u8fd4\u56de\u7684\u53c2\u6570: \u53ef\u4ee5\u770b\u5230\uff0c\u6b63\u5219\u5339\u914d\u4e5f\u6210\u4e86\uff0ccode\u4e5fok\u4e86\u3002\u5269\u4e0b\u7684jsonpath\u6211\u4e5f\u6d4b\u8bd5\u8fc7\u4e86\uff0c\u5927\u5bb6\u6709\u5174\u8da3\u4e5f\u53ef\u4ee5\u81ea\u5df1\u8bd5\u8bd5\u3002 \u4eca\u5929\u7684\u5185\u5bb9\u5c31\u5230\u8fd9\u91cc\u4e86\uff0c\u6211\u4eec\u4e0b\u4e00\u8282\u641e\u70b9 \u725b\u903c \u7684\uff01\u5f00\u542f \u7528\u4f8b\u5f55\u5236\u751f\u6210 \u4e4b\u8def\u3002 \u6211\u662f\u7c73\u6d1b\uff0c\u4e00\u76f4\u966a\u4f34\u5404\u4f4d\u5b66\u4e60\uff01\u514d\u8d39\u7684 \u5c0f\u9ec4\u5fc3 \uff0c\u5e2e\u6211\u70b9\u4e00\u4e2a\u5427\uff01 \u9879\u76ee\u5730\u5740: https://github.com/wuranxu/pity","title":"129.\u6539\u9020\u8bf7\u6c42\u53c2\u6570\u63d0\u53d6\u65b9\u5f0f(3)"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28129%29%20%E6%94%B9%E9%80%A0%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E6%8F%90%E5%8F%96%E6%96%B9%E5%BC%8F%283%29/#_1","text":"\u4e0a\u4e00\u8282\u6211\u4eec\u7f16\u5199\u597d\u4e86curd\u90e8\u5206\uff0c\u4e5f\u8054\u8c03\u4e86\u524d\u7aef\u3002\u8fd9\u4e00\u8282\u6211\u4eec\u6765\u5199\u540e\u7aef\u63d0\u53d6\u90e8\u5206:","title":"\u56de\u987e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28129%29%20%E6%94%B9%E9%80%A0%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E6%8F%90%E5%8F%96%E6%96%B9%E5%BC%8F%283%29/#_2","text":"app/core/paramters/parser.py, \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u6211\u5728exceptions\u76ee\u5f55\u5b9a\u4e49\u4e86case\u76f8\u5173\u7684\u5f02\u5e38\uff0c\u8fd9\u91ccimport\u5931\u8d25\u7684\u8bdd\uff0c\u4e0d\u8981\u60ca\u614c\uff0c\u81ea\u5df1\u53bb\u5b9a\u4e49\u4e00\u4e0b\u5427\u3002 import json import random from typing import Any from app.excpetions.CaseParametersException import CaseParametersException class Parser ( object ): @staticmethod def parse ( source : dict , expression : str = \"\" , idx : str = None ) -> Any : raise NotImplementedError @staticmethod def parse_result ( data : list , match_index : str = None ): if len ( data ) == 0 : return \"null\" # \u5982\u679c\u662f\u6570\u5b57 length = len ( data ) if match_index is not None : if match_index . isdigit (): idx = int ( match_index ) if idx >= length or idx < - length : raise CaseParametersException ( f \"results length is { length } , index is not in [ { - length } , { length } )\" ) return json . dumps ( data [ idx ], ensure_ascii = False ) if match_index . lower () == 'random' : # \u968f\u673a\u9009\u53d6 return json . dumps ( random . choice ( data ), ensure_ascii = False ) if match_index . lower () == 'all' : return json . dumps ( data , ensure_ascii = False ) raise CaseParametersException ( f \"invalid match index: { match_index } , not number or random\" ) return json . dumps ( data , ensure_ascii = False ) \u89e3\u6790\u5668\u63d0\u4f9b\u4e86\u4e00\u4e2aparse\u65b9\u6cd5\uff08\u672a\u5b9e\u73b0\uff0c\u9632\u6b62\u6709\u4eba\u8c03\u7528parse\uff0c\u76f4\u63a5\u629b\u51fa\u5f02\u5e38\uff09\u3002\u63a5\u7740\u5b9a\u4e49\u4e86\u4e00\u4e2a\u9ed8\u8ba4\u7684\u89e3\u6790\u7ed3\u679c\u7684\u65b9\u6cd5\uff1a \u7531\u4e8e\u6211\u4eec\u91c7\u7528JSONpath\u89e3\u6790\u6570\u636e\uff0c\u800c\u5b83\u6bcf\u6b21\u8fd4\u56de\u7684\u90fd\u662f\u6570\u7ec4\u5f62\u5f0f\u7684\u6570\u636e\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u518d\u6b21\u63d0\u53d6\u6570\u636e\uff0c\u6839\u636e\u7528\u6237\u4f20\u5165\u7684\u7d22\u5f15\uff0c\u8fd9\u91cc\u652f\u6301random\uff08\u968f\u673a\uff09\u548call(\u6240\u6709)\u3002 \u81f3\u4e8e\u4e3a\u4ec0\u4e48\u7528json.dumps()\uff0c\u56e0\u4e3a\u6211\u4eec\u7684\u53d8\u91cf\u66ff\u6362\u90fd\u91c7\u7528\u7684replace\u7684\u65b9\u6cd5\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u53ea\u53ef\u4ee5\u5bf9\u5b57\u7b26\u4e32\u8fdb\u884c\u66ff\u6362\uff0c\u5f53\u7136\u8fd9\u91cc\u9891\u7e41\u5730\u5e8f\u5217\u5316/\u53cd\u5e8f\u5217\u5316\uff0c\u5bf9\u6027\u80fd\u4f1a\u6709\u4e00\u5b9a\u7684\u5f71\u54cd\uff0c\u60f3\u8981\u6539\u5584\u8fd9\u4e2a\uff0c\u6211\u4eec\u5fc5\u987b\u5f97\u66f4\u6362replace\u7684\u65b9\u5f0f\u3002\uff08\u76ee\u524d\u8fd8\u4e0d\u5728\u8ba1\u5212\u5185\uff09 \u53ef\u4ee5\u770b\u5230\uff0c\u6211\u4eec\u6839\u636e\u7528\u6237\u7ed9\u7684\u7d22\u5f15\uff0c\u4e5f\u652f\u6301\u5012\u6570-1\u8fd9\u79cd\u53d6\u6cd5\uff0c\u57fa\u672c\u6ee1\u8db3\u4e86\u8981\u6c42\u3002\u63a5\u7740\u6211\u4eec\u53bb\u7f16\u5199JSON\uff0ckv\u548c\u6b63\u5219\u89e3\u6790\u5668\uff08\u53c2\u8003\u4e0a\u4e0a\u8282\uff09\u3002","title":"\u7f16\u5199\u63d0\u53d6\u5668\u7236\u7c7b"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28129%29%20%E6%94%B9%E9%80%A0%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E6%8F%90%E5%8F%96%E6%96%B9%E5%BC%8F%283%29/#4","text":"","title":"4\u79cd\u89e3\u6790\u5668"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28129%29%20%E6%94%B9%E9%80%A0%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E6%8F%90%E5%8F%96%E6%96%B9%E5%BC%8F%283%29/#status_code","text":"\u8fd9\u79cd\u6570\u636e\u6700\u4e3a\u7b80\u5355\uff0c\u6211\u4eec\u56fa\u5b9a\u53d6response\u7684status_code\u5373\u53ef\u3002 \u5176\u5b9e\u8fd9\u91cc\u4e5f\u53ef\u4ee5\u76f4\u63a5str\u3002","title":"status_code"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28129%29%20%E6%94%B9%E9%80%A0%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E6%8F%90%E5%8F%96%E6%96%B9%E5%BC%8F%283%29/#cookieheaders","text":"import json from typing import Any import jsonpath from app.core.paramters.parser import Parser from app.excpetions.CaseParametersException import CaseParametersException class HeaderParser ( Parser ): @staticmethod def get_source ( data : dict ): return json . loads ( data . get ( \"response_headers\" )) @classmethod def parse ( cls , source : dict , expression : str = \"\" , idx : str = None ) -> Any : if not source or not expression : raise CaseParametersException ( f \"parse out parameters failed, source or expression is empty\" ) try : source = cls . get_source ( source ) results = jsonpath . jsonpath ( source , expression ) if results is False : if not source and expression == \"$..*\" : # \u8bf4\u660e\u60f3\u8981\u5168\u5339\u914d\u5e76\u4e14\u6ca1\u6570\u636e\uff0c\u76f4\u63a5\u8fd4\u56dedata return source raise CaseParametersException ( \"jsonpath match failed, please check your response or jsonpath.\" ) return Parser . parse_result ( results , idx ) except CaseParametersException as e : raise e except Exception as err : raise CaseParametersException ( f \"parse json data error, please check jsonpath or json: { err } \" ) class CookieParser ( HeaderParser ): @staticmethod def get_source ( data : dict ): return json . loads ( data . get ( \"cookies\" )) \u8fd9\u91cc\u8981\u6ce8\u610f\u70b9: jsonpath\u53d6\u4e0d\u5230\u6570\u636e\u4f1a\u8fd4\u56deFalse\uff0c\u4f46\u5bf9\u4e8e\u7a7a\u6570\u7ec4\uff0c\u5b83\u4e5f\u53d6\u4e0d\u5230 \u6240\u4ee5\u6211\u4eec\u8981\u533a\u5206\uff08\u7a7a\u6570\u7ec4+\u5168\u5339\u914d\uff09\u548c\u5339\u914d\u4e0d\u5230\u7684\u60c5\u51b5\u3002","title":"cookie/headers"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28129%29%20%E6%94%B9%E9%80%A0%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E6%8F%90%E5%8F%96%E6%96%B9%E5%BC%8F%283%29/#regex","text":"\"\"\" regex for text \"\"\" import re from typing import Any from app.core.paramters.parser import Parser from app.excpetions.CaseParametersException import CaseParametersException class RegexParser ( Parser ): @staticmethod def parse ( source : dict , expression : str = \"\" , idx : str = None ) -> Any : try : source = source . get ( \"response\" ) if not source or not expression : raise CaseParametersException ( f \"parse out parameters failed, source or expression is empty\" ) if idx is None : raise CaseParametersException ( \"index is empty, you must provide index for regex match results.\" ) pattern = re . compile ( expression ) result = re . findall ( pattern , source ) if len ( result ) == 0 : raise CaseParametersException ( f \"regex match failed, please check your regex: { expression } \" ) return Parser . parse_result ( result , idx ) except CaseParametersException as e : raise e except Exception as err : raise CaseParametersException ( f \"parse regex text error, please check regex or text: { err } \" ) \u4e0d\u591a\u8bf4\uff0c\u5c31\u662fre.match+findall\u3002","title":"regex\uff08\u6b63\u5219\uff09"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28129%29%20%E6%94%B9%E9%80%A0%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E6%8F%90%E5%8F%96%E6%96%B9%E5%BC%8F%283%29/#_3","text":"from enum import IntEnum class CaseParametersEnum ( IntEnum ): TEXT = 0 JSON = 1 HEADER = 2 COOKIE = 3 STATUS_CODE = 4","title":"\u7f16\u5199\u89e3\u6790\u5668\u679a\u4e3e\u7c7b"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28129%29%20%E6%94%B9%E9%80%A0%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E6%8F%90%E5%8F%96%E6%96%B9%E5%BC%8F%283%29/#getparser","text":"","title":"\u7f16\u5199getParser\u65b9\u6cd5"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28129%29%20%E6%94%B9%E9%80%A0%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E6%8F%90%E5%8F%96%E6%96%B9%E5%BC%8F%283%29/#case","text":"\u5728app/core/executor.py\u6dfb\u52a0\u4ee5\u4e0b\u65b9\u6cd5: @case_log def extract_out_parameters ( self , response_info , data : List [ PityTestCaseOutParameters ]): \"\"\"\u63d0\u53d6\u51fa\u53c2\u6570\u636e\"\"\" result = dict () for d in data : p = ParametersParser ( d . source ) result [ d . name ] = p ( response_info , d . expression , d . match_index ) return result \u4fee\u6539run\u65b9\u6cd5: \u83b7\u53d6out_parameters \u83b7\u53d6\u540e\u5e76\u653e\u5165params\u5b57\u5178\uff0c\u66ff\u6362\u65ad\u8a00/\u540e\u7f6e\u6761\u4ef6\u5185\u5bb9 \u8fd9\u6837\u7684\u8bdd\uff0c\u65b0\u63d0\u53d6\u7684\u53c2\u6570\uff0c\u5c31\u53ef\u4ee5\u5728\u65ad\u8a00/\u540e\u7f6e\u6761\u4ef6\u4f7f\u7528\u4e86\uff0c\u6211\u4eec\u6765\u6d4b\u8bd5\u4e00\u4e0b\u3002","title":"\u6539\u9020case\u6267\u884c\u90e8\u5206"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28129%29%20%E6%94%B9%E9%80%A0%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E6%8F%90%E5%8F%96%E6%96%B9%E5%BC%8F%283%29/#_4","text":"\u51fa\u53c2\u662f \u6b63\u5219 \u548c \u72b6\u6001\u7801 \u770b\u770b\u65ad\u8a00\u90e8\u5206 \u5982\u679c\u6309\u7167\u9884\u671f: \u6b63\u5219+\u968f\u673a\u5339\u914d\uff0c\u4f1a\u67e5\u8be2\u5230 \u767e\u5ea6 code\u4f1a\u8fd4\u56de200 \u6267\u884c\u4e0b\u770b\u770b\u7ed3\u679c: \u53ef\u4ee5\u770b\u5230\u65ad\u8a00\u901a\u8fc7\uff0c\u6211\u4eec\u6765\u6253\u5370\u4e0b\u8fd4\u56de\u7684\u53c2\u6570: \u53ef\u4ee5\u770b\u5230\uff0c\u6b63\u5219\u5339\u914d\u4e5f\u6210\u4e86\uff0ccode\u4e5fok\u4e86\u3002\u5269\u4e0b\u7684jsonpath\u6211\u4e5f\u6d4b\u8bd5\u8fc7\u4e86\uff0c\u5927\u5bb6\u6709\u5174\u8da3\u4e5f\u53ef\u4ee5\u81ea\u5df1\u8bd5\u8bd5\u3002 \u4eca\u5929\u7684\u5185\u5bb9\u5c31\u5230\u8fd9\u91cc\u4e86\uff0c\u6211\u4eec\u4e0b\u4e00\u8282\u641e\u70b9 \u725b\u903c \u7684\uff01\u5f00\u542f \u7528\u4f8b\u5f55\u5236\u751f\u6210 \u4e4b\u8def\u3002 \u6211\u662f\u7c73\u6d1b\uff0c\u4e00\u76f4\u966a\u4f34\u5404\u4f4d\u5b66\u4e60\uff01\u514d\u8d39\u7684 \u5c0f\u9ec4\u5fc3 \uff0c\u5e2e\u6211\u70b9\u4e00\u4e2a\u5427\uff01 \u9879\u76ee\u5730\u5740: https://github.com/wuranxu/pity","title":"\u6d4b\u8bd5\u4e00\u4e0b"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2813%29%20%E7%BC%96%E5%86%99%E7%B1%BBpostman%E9%A1%B5%E9%9D%A2%282%29/","text":"\u7f16\u5199\u7c7bpostman\u9875\u9762(2) \u56de\u987e \u4e0a\u7bc7\u6587\u7ae0\u8bf4\u5230\uff0c\u6211\u4eec\u7f16\u5199\u4e86postman\u7684 url \u680f\uff0c\u7ec6\u5fc3\u7684\u89c2\u4f17\u53ef\u80fd\u53d1\u73b0\u4e86: \u6211\u4eec\u7684url\u680f\u5e76\u6ca1\u6709\u8bf7\u6c42\u65b9\u5f0f\u7684\u9009\u62e9\uff0c\u90a3\u6211\u4eec\u73b0\u5728\u5c31\u6765\u8c03\u6574\u4e00\u4e0b\u5427\u3002 \u66f4\u6539\u8bf7\u6c42\u65b9\u5f0f \u5176\u5b9e\u5f88\u7b80\u5355\uff0c\u5c06selectBefore\u6539\u6210\u5982\u4e0b\u4ee3\u7801\u5373\u53ef\uff0c\u628a\u53ef\u9009\u9879\u53d8\u6210\u6211\u4eec \u5e38\u7528 \u76844\u79cd HTTP \u8bf7\u6c42\u65b9\u5f0f\u3002 \u5728\u5c55\u5f00\u4ee5\u540e\u53d1\u73b0 DELETE \u592a\u957f\u4e86\u4ee5\u81f3\u4e8e\u663e\u793a\u4e0d\u5168\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u7ed9 Select \u6807\u7b7e\u589e\u52a0\u5bbd\u5ea6: const selectBefore = ( < Select defaultValue = 'GET' style = {{width: 120 , fontSize: 16 , textAlign: ' left '}}> < Option value = 'GET' > GET </ Option > < Option value = 'POST' > POST </ Option > < Option value = 'PUT' > PUT </ Option > < Option value = 'DELETE' > DELETE </ Option > </ Select > ); \u8fd9\u91cc\u6211\u4eec\u8fd8\u7a0d\u5fae\u53d8\u66f4\u4e86\u4e00\u4e0b\u6837\u5f0f\uff0c\u52a0\u5927\u4e86\u5b57\u4f53\u4e3a16\u53f7\uff0c\u5e76\u4e14\u6587\u5b57\u5de6\u5bf9\u9f50\u3002 \u7f16\u5199\u4e2d\u90e8\u6807\u7b7e\u90e8\u5206 \u9996\u5148\u53ef\u4ee5\u786e\u5b9a\u7684\u662f\u4e2d\u95f4\u662f\u6807\u7b7e\u9875\uff0c\u8fd9\u5757\u6bd4\u8f83\u590d\u6742\u3002\u56e0\u4e3a\u5404\u4e2a\u6807\u7b7e\u9875\u91cc\u9762\u7684\u5185\u5bb9\u4e0d\u4e00\u6837\uff0c\u6240\u4ee5\u6211\u4eec\u5176\u5b9e\u662f\u9700\u8981\u7f16\u5199\u8bf8\u5982 Params \uff0c Headers \uff0c Body \u7b49\u5177\u4f53\u9875\u9762\u7684\u3002 \u81f3\u4e8e\u4e3a\u4ec0\u4e48\u4e0d\u5b8c\u5168\u4eff\u7167postman\u5462\uff1f\u56e0\u4e3a\u54b1\u4eec\u662f\u501f\u9274\u5b83\uff0c\u4e0d\u662f\u5b9e\u73b0\u5b83\uff01\u6240\u4ee5\u6211\u4eec\u5bf9\u4e8e\u6709\u4e9b\u529f\u80fd\u662f\u9700\u8981\u8fdb\u884c \u53d6\u820d \u7684\u3002 \u6211\u4eec\u8fd8\u662f\u53bbant design\u627etab(\u6807\u7b7e\u9875)\uff0c\u8fd9\u91cc\u5c31\u4e0d\u91cd\u590d\u8fc7\u7a0b\u4e86\u3002 \u6548\u679c\u56fe \u7f16\u5199Body\u90e8\u5206 \u54b1\u4eec\u5148\u6765\u5c1d\u8bd5\u7f16\u5199Body\u90e8\u5206\uff0c\u5148\u770b\u770bpostman\u7684\u9875\u9762: \u8001\u89c4\u77e9\uff0c\u6211\u4eec\u8fd8\u662f\u5148\u8fdb\u884c \u62c6\u89e3 : \u5206\u4e0a\u4e0b2\u5c42\uff0c\u4e0a\u5c42\u75313\u4e2a\u7ec4\u4ef6\u7ec4\u6210\uff0c\u5206\u522b\u662fRadio\u5373\u5355\u9009\u6846\uff0c\u4e0b\u62c9\u9009\u62e9\u548c\u6587\u672c\u6309\u94ae\u3002\u8fd9\u4e2a\u7ed3\u8bba\u5462\uff0c\u662f\u6211\u6bd4\u8f83\u719f\u6089ant design\u7ec4\u4ef6\u7684\u60c5\u51b5\u4e0b\u603b\u7ed3\u51fa\u6765\u7684\uff0c\u4f60\u4eec\u4e0d\u719f\u6089\u7684\u8bdd\uff0c\u9700\u8981\u591a\u52a0\u7ec3\u4e60\uff0c\u8fd9\u662f\u4e00\u4e2a\u5faa\u5e8f\u6e10\u8fdb\u7684\u8fc7\u7a0b\u3002 \u4e0b\u5c42\u5462\uff0c\u5c31\u662f\u4e00\u4e2aJSON\u7f16\u8f91\u6587\u672c\u6846\u4e86\uff0c\u7a0d\u5fae\u7b80\u5355\u4e00\u4e9b\u3002 \u6211\u4eec\u8fd8\u662f\u5148\u6765\u7f16\u5199\u4e0a\u5c42\uff0c\u9996\u5148\u6211\u4eec\u7f16\u5199Radio\u90e8\u5206: \u5728Body tab\u4e0b\u9762\u53e6\u8d77\u4e00\u884c\uff0c\u8fd9\u91ccRow\u53ef\u4ee5\u89c6\u4e3adiv \u7136\u540eRadio.Group\u662fantd\u91cc\u9762\u7684\u56fa\u5b9a\u7528\u6cd5\uff0c\u7528\u4e8e\u6309\u94ae\u5206\u7ec4\uff0cRadio\u5c31\u662f\u5355\u9009\u6309\u94ae\u4e86\uff0c\u6211\u4eff\u7167postman\uff0c\u628a\u91cc\u9762\u7684\u6240\u6709\u9009\u9879\u90fd\u4ee3\u5165\u8fdb\u6765\uff0c\u770b\u770b\u6548\u679c: \u63a5\u7740\u6211\u4eec\u53bb\u7f16\u5199raw\u91cc\u9762\u7684JSON\u4e0b\u62c9\u83dc\u5355\u3002 \u6709\u5c0f\u4f19\u4f34\u53ef\u80fd\u6ce8\u610f\u5230\u4e86\uff0c\u53ea\u6709\u5f53\u8fd9\u4e2a\u7c7b\u578b\u4e3a raw \u7684\u65f6\u5019\u624d\u4f1a\u51fa\u73b0JSON\u7684\u9009\u62e9\u6846\uff0c\u4e5f\u5c31\u662f\u8bf4\u8fd9\u4e2a\u6309\u94ae\u51fa\u4e0d\u51fa\u73b0\u662f\u8ddf\u6211\u4eec\u7684\u9009\u9879\u6709\u5173\u7cfb\u7684\u3002 \u6240\u4ee5\u6211\u4eec\u9700\u8981\u7528\u5230React\u7684\u72b6\u6001\u7ba1\u7406: \u5148\u5f15\u5165 useState \u3002 import React, {useState} from 'react' ; \u7136\u540e\u8bbe\u7f6e\u4e00\u4e2a\u53d8\u91cf\uff0c\u7528\u4e8e\u5b58\u653ebody\u7684\u7c7b\u578b: \u5176\u4e2dbodyType\u662f\u53d8\u91cf\u540d\uff0csetBodyType\u662f\u6539\u53d8bodyType\u7684\u65b9\u6cd5\uff0cnone\u662fbodyType\u7684\u9ed8\u8ba4\u503c\u3002 \u4fee\u6539Radio\u76f8\u5173\u7ec4\u4ef6 \u7531\u4e8e\u4e4b\u524d\u6211\u4eec\u7684\u7ec4\u4ef6\u662f \u975e\u53d7\u63a7\u7ec4\u4ef6 \uff0c\u73b0\u5728\u6211\u4eec\u8ba9\u5b83 \u53d7\u63a7 \u8d77\u6765\u3002\u4ec0\u4e48\u53eb\u975e\u53d7\u63a7\u7ec4\u4ef6\u5462\uff0c\u975e\u53d7\u63a7\u7ec4\u4ef6\u6307\u7684\u662f\uff0c\u5982\u679c\u4f60\u6ca1\u6709\u7ed9\u7ec4\u4ef6\u6307\u5b9a\u76f8\u5173\u7684\u503c\u548c\u6539\u53d8\u65b9\u6cd5\uff0c\u5219\u4ed6\u81ea\u5df1\u5728\u5185\u90e8\u7ef4\u62a4\u4e86\u4e00\u5957\uff0c\u6240\u4ee5\u6211\u4eec\u521a\u624d \u5207\u6362 radio\u7684\u65f6\u5019\u6ca1\u6709\u4ec0\u4e48\u969c\u788d\u3002 \u53d7\u63a7\u7ec4\u4ef6 \u7684\u610f\u601d\u662f\u8fd9\u4e2a\u7ec4\u4ef6\u4f60 \u5b8c\u5168\u53ef\u63a7 \uff0c\u5b83\u600e\u4e48\u52a8\uff0c\u80fd\u4e0d\u80fd\u52a8\uff0c\u90fd\u8be5\u4f60\u638c\u63a7\u3002 \u66f4\u591a\u76f8\u5173\u4fe1\u606f\u53ef\u4ee5\u81ea\u5df1\u53bb\u767e\u5ea6\u67e5\u9605\u3002 <Radio.Group defaultValue= 'none' value={bodyType} onChange={e => setBodyType(e.target.value)}> < Radio value = 'none' > none </ Radio > < Radio value = 'form-data' > form-data </ Radio > < Radio value = 'x-www-form-urlencoded' > x-www-form-urlencoded </ Radio > < Radio value = 'raw' > raw </ Radio > < Radio value = 'binary' > binary </ Radio > < Radio value = 'GraphQL' > GraphQL </ Radio > < /Radio.Group> \u8fd9\u65f6\u5019\u53bb\u9875\u9762\u4e0a\u770b\uff0c\u4e0d\u4f1a\u6709\u4ec0\u4e48\u53d8\u5316\uff0c\u4f46\u662f\u6b64\u65f6\u7ec4\u4ef6\u5df2\u7ecf \u53d8\u5f97\u53ef\u63a7 \uff0c\u4f60\u80fd\u6e05\u695a\u5730\u77e5\u9053\u5b83\u5f53\u524d \u9009\u4e2d\u4e86\u4ec0\u4e48\u503c \u3002 \u7f16\u5199JSON\u4e0b\u62c9\u6846 \u5148\u6765\u8bb2\u89e3\u4e00\u4e0b\uff0c\u8fd9\u53e5\u8bdd\u7684\u610f\u601d\u3002 \u5176\u4e2d\u6700\u5916\u9762\u7684 {} \u4ee3\u8868\u4e00\u4e2a\u4ee3\u7801\u5757\uff0c\u91cc\u9762\u53ef\u4ee5\u7f16\u5199\u4ee3\u7801\u3002bodyType === 'raw' \uff1f xx: null \u8fd9\u4e2a\u5f88\u7b80\u5355\uff0c\u5927\u5bb6\u90fd\u77e5\u9053\u8fd9\u662f\u4e2a\u4e09\u5143\u8868\u8fbe\u5f0f\u3002 \u90a3\u4e48\u8fd9\u53e5\u8bdd\u7684\u610f\u601d\u662f\u4ec0\u4e48\u5462\uff1f\u610f\u601d\u5c31\u662f \u5982\u679cbodyType\u7b49\u4e8eraw \uff0c\u90a3\u4e48\u5c31\u6e32\u67d3\u4e0b\u62c9\u6846\uff0c\u5426\u5219\u663e\u793a\u4e3a null \uff0c\u610f\u601d\u662f\u4ec0\u4e48\u90fd\u4e0d\u5c55\u793a\u3002 \u6211\u4eec\u6765\u8865\u5145\u4e00\u4e0b\u4e0b\u62c9\u83dc\u5355: \u53ef\u4ee5\u770b\u5230\u6709\u8bb8\u591a\u79cd \u770b\u770b\u663e\u793a\u6548\u679c: \u4f46\u662f\u8fd9\u91cc\u6709\u4e2a\u95ee\u9898\u5c31\u662f\uff0c\u8fd9\u8fb9\u7684\u9009\u9879\u6539\u53d8\u4ee5\u540e\u4e0a\u9762\u8fd8\u662f\u663e\u793a JSON \uff0c\u6240\u4ee5\u610f\u601d\u662f\u8fd9\u91cc\u4e5f\u9700\u8981\u53d7\u63a7\uff0c\u6211\u4eec\u8981\u6839\u636e\u4ed6\u9009\u62e9\u7684\u6570\u636e\u6765\u663e\u793a\u5177\u4f53\u7684\u5185\u5bb9\u3002 \u540c\u7406\u6211\u4eec\u9700\u8981\u8bbe\u7f6e\u4e00\u4e2arawType\u53d8\u91cf\uff0c\u9ed8\u8ba4\u503c\u4e3aJSON: \u63a5\u7740\u6211\u4eec\u8981\u7ed9\u83dc\u5355\u6dfb\u52a0\u70b9\u51fb\u4e8b\u4ef6\uff0c\u5f53click\u5bf9\u5e94\u7684\u7c7b\u578b\u65f6\uff0c\u628arawType\u6539\u6210\u5bf9\u5e94\u7684\u503c\u3002 \u6838\u5fc3\u65b9\u6cd5\u5982\u56fe\uff0c\u9996\u5148\u6211\u4eec\u521b\u5efa\u4e86\u4e00\u4e2a\u65b9\u6cd5\u53eb onClickMenu \uff0c\u8fd9\u4e2a\u65b9\u6cd5\u7528\u6765\u4fee\u6539rawType\uff0c\u5f53\u70b9\u51fbText\u7684\u65f6\u5019\u4f20\u5165Text\u53c2\u6570\uff0c\u5176\u4ed6\u7684\u540c\u7406\u3002 \u770b\u770b\u6548\u679c: \u672c\u6765\u60f3\u4e00\u6b21\u6027\u5199\u5b8c\u4ee3\u7801\u7b97\u4e86\uff0c\u4f46\u662f\u53c8\u60f3\u5c55\u793a\u6574\u4e2a\u7f16\u5199\u8fc7\u7a0b\uff0c\u611f\u89c9\u8fd9\u6837\u6548\u7387\u6bd4\u8f83\u4f4e\uff0c\u8fd9\u4e00\u8282\u8bf4\u5b8c\u624d\u5199\u4e86\u8fd9\u4e48\u70b9\u4e1c\u897f\uff0c\u5c34\u5c2c\u3002\u4e0d\u7ba1\u600e\u4e48\u8bf4\uff0c\u4eca\u5929\u5148\u5230\u8fd9\u91cc\u5427\u3002 \u5e7f\u544a\u65f6\u95f4 \u540e\u7aef\u4ee3\u7801\u5730\u5740: https://github.com/wuranxu/pity \u524d\u7aef\u4ee3\u7801\u5730\u5740: https://github.com/wuranxu/pityWeb \u6b22\u8fce\u5173\u6ce8\u516c\u4f17\u53f7 \u6d4b\u8bd5\u5f00\u53d1\u5165\u5751 \uff0c\u8fd8\u6709\u52a0\u7fa4\u4e00\u8d77\u8ba8\u8bba\u76f8\u5173\u95ee\u9898\u5440\uff01\u5982\u679c\u7fa4\u4e8c\u7ef4\u7801\u8fc7\u671f\u4e86\uff0c\u53ef\u4ee5\u52a0\u6211\u4e2a\u4eba\u5fae\u4fe1: wuranxu \u6211\u62c9\u4f60\u8fdb\u7fa4~","title":"13.\u7f16\u5199\u7c7bpostman\u9875\u9762(2)"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28130%29%20%E7%94%A8%E4%BE%8B%E7%94%9F%E6%88%90%E4%B9%8B%E7%86%9F%E6%82%89mitmproxy/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \u8fd9\u6bb5\u65f6\u95f4\u4e00\u76f4\u5fd9\u4e8e\u6253\u9020\u81ea\u5df1\u719f\u6089\u7684\u7f16\u8f91\u5668\uff0c\u6240\u4ee5\u5305\u62ec pity \u8fd8\u6709\u5bf9\u5e94\u6559\u7a0b\u90fd\u6709\u70b9\u6ede\u540e\u3002\u4e0d\u8fc7\u8fd9\u90fd\u6ca1\u5173\u7cfb\uff0c\u9a6c\u4e0a\u5c31\u7aef\u5348\u4e86\uff0c\u53ef\u4ee5\u7ee7\u7eed \u5377 \u4e86\uff01 \u56de\u987e \u8bb0\u5f97\u4e0a\u4e00\u8282\u6211\u4eec\u5b8c\u6210\u4e86 \u51fa\u53c2 \u76f8\u5173\u7684\u6539\u9020\u5185\u5bb9\uff0c\u4e4b\u524d\u6709\u4e2a\u5927\u4f6c @\u6674\u5929 \u95ee\u6211\uff0c\u662f\u5426\u8003\u8651\u5728 pity \u91cc\u9762\u52a0\u5165\u5982\u4e0b\u7684\u529f\u80fd: \u6253\u5f00\u6d4f\u89c8\u5668\uff0c\u8fdb\u884c\u4e00\u7cfb\u5217\u64cd\u4f5c\uff0c\u800c\u540e\u5c31\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a\u6d4b\u8bd5\u7528\u4f8b\u3002 \u8fd9\u4e2a\u4e1c\u897f\u8001\u5b9e\u8bf4\uff0c\u6211\u6ca1\u505a\u8fc7\uff0c\u4f46\u662f\u6211\u89c9\u5f97\u8fd8\u662f\u5f88\u6709\u4ef7\u503c\u7684\u3002\u901a\u8fc7 \u5f55\u5236 \u7528\u6237\u7684\u64cd\u4f5c\uff0c\u5f62\u6210\u7c7b\u4f3char\u7684\u6587\u4ef6\uff0c\u63a5\u7740\u5bfc\u5165\u5230 pity \u3002\u800c\u4e14\u53ea\u8981\u4e2d\u95f4\u6587\u4ef6\u4e00\u81f4\uff0c\u90a3\u5c31\u53ef\u4ee5\u5b9e\u73b0\u5f88\u591a\u5e73\u53f0\u7684\u65e0\u7f1d\u5bf9\u63a5\uff0c\u6bd4\u5982: httprunner postman har jmx \u8fd9\u4e9b\u90fd\u662f\u5f88\u5e38\u7528\u7684\u5176\u5b83\u5e73\u53f0/\u6846\u67b6\u7684\u6570\u636e\uff0c\u5982\u679c\u80fd\u652f\u6301\u5230\u5f55\u5236\u751f\u6210\u7528\u4f8b\uff0c\u90a3\u4e48\u5bfc\u5165\u5bfc\u51fa\u5176\u5b83\u5e73\u53f0\u7684\u7528\u4f8b\u6570\u636e\u4e5f\u4e0d\u5728 \u8bdd\u4e0b \u3002\u53ef\u8c13\u662f\u4e00\u4e3e\u591a\u5f97\uff0c\u6240\u4ee5\u8fd9\u5c31\u662f\u6211\u6253\u7b97\u8fd1\u671f\u505a\u8fd9\u4e2a\u7684\u539f\u56e0\u3002 \u601d\u8def \u5176\u5b9e\u6211\u662f\u6ca1\u4ec0\u4e48\u5177\u4f53\u7684\u601d\u8def\uff0c\u53ea\u6709\u4e00\u4e2a\u5927\u6982\u7684\u65b9\u5411\uff0c\u6211\u5148\u68b3\u7406\u4e00\u4e0b: \u901a\u8fc7\u5f55\u5236\u6d4f\u89c8\u5668/app\u8bf7\u6c42\uff0c\u83b7\u5f97\u6bcf\u4e2a\u63a5\u53e3\u7684\u8bf7\u6c42\u5165\u53c2/\u51fa\u53c2/header\u7b49\u4fe1\u606f \u89e3\u6790\u8fd9\u4e9b\u6570\u636e\uff0c\u751f\u6210\u4e00\u4e2a\u4e34\u65f6\u7684\u4e2d\u95f4\u6570\u636e\uff0c\u53ef\u4ee5\u662fhar\u4e5f\u53ef\u4ee5\u662fjson\uff0c\u8fd9\u4e2a\u65e0\u6240\u8c13 \u89e3\u6790\u4e2d\u95f4\u6570\u636e\uff0c\u5c06\u4e4b\u8f6c\u53d8\u4e3apity\u7684\u7528\u4f8b \u542c\u8d77\u6765\u5f88\u7b80\u5355\u5427\uff1f\u611f\u89c9\u597d\u50cf\u662f\u7684\uff0c\u4e0d\u8fc7\u89e3\u6790\u4e2d\u95f4\u6570\u636e\u90a3\u91cc\u4f30\u8ba1\u4f1a\u6709\u4e00\u4e9b\u5751\uff0c\u6bd4\u5982 \u7528\u4f8b\u4e4b\u95f4\u4f9d\u8d56\u7684\u6570\u636e \uff0c\u8fd9\u5757\u53ef\u80fd\u662f\u4e2a\u96be\u70b9\uff0c\u9664\u6b64\u4e4b\u5916\uff0c\u5176\u4ed6\u7684\u5e94\u8be5\u90fd\u4e0d\u5728\u8bdd\u4e0b\u3002 \u600e\u4e48\u5f55\u5236\u8bf7\u6c42\u5462\uff1f Python\u6709\u4e00\u6b3e\u6bd4\u8f83\u63a8\u8350\u7684 \u5de5\u5177 \uff1amitmproxy\uff0c\u8fd9\u6b21\u6211\u5c31\u4e0d\u5f15\u7528\u5b98\u7f51\u8bf4\u6cd5\u4e86\uff0c\u6211\u76f4\u63a5\u7b80\u77ed\u4ecb\u7ecd\u4e0b: mitmproxy\u662f\u4e00\u4e2a\u7c7b\u4f3c\u4e2d\u95f4\u4eba\u7684\u5de5\u5177\uff0c\u5f53\u4f60\u6302\u4e0a\u4ed6\u7684\u4ee3\u7406\uff0c\u4f60\u7684\u6240\u6709\u8bf7\u6c42\u90fd\u80fd\u88ab\u76d1\u542c\u5230\uff0c\u5e76\u4e14\u4ed6\u8fd8\u53ef\u4ee5\u7be1\u6539\u4f60\u7684\u8bf7\u6c42\uff0c\u6bd4\u5982\u4f60\u8bf7\u6c42www.baidu.com\u7684\u65f6\u5019\uff0c\u4ed6\u7ed9\u4f60\u8fd4\u56de\uff1a hello baidu \uff0c\u8fd9\u4e5f\u610f\u5473\u7740\u5b83\u6709\u7740\u5728\u672a\u6765\u6210\u4e3apity mock\u670d\u52a1 \u9876\u6881\u67f1 \u7684\u6f5c\u529b\u3002 \u90a3\u6211\u4eec\u5148\u6253\u5165\u654c\u4eba\u5185\u90e8\u770b\u4e2a\u7a76\u7adf~ Mitmproxy \u53ef\u4ee5\u770b\u5230\uff0cmitmproxy\uff0c\u4ed6\u672c\u8d28\u8fd8\u662f\u4e00\u4e2a \u4ee3\u7406 \u3002\u6240\u4ee5\u6211\u4eec\u7684\u5de5\u4f5c\u6a21\u5f0f\u662f\uff0c\u914d\u7f6e\u597d\u4ee3\u7406\uff08\u7ed9pity\u914d\u7f6e\u597d\u4ee3\u7406\uff0c\u6211\u4eec\u7684http\u8bf7\u6c42\u7531pity\u53d1\u51fa\uff09\u3002 \u5b83\u672c\u8eab\u5462\uff0c\u662f\u6709\u51e0\u79cd\u6a21\u5f0f\u7684: web\u7aef \u8fd9\u4e2a\u5c31\u6709\u70b9\u7c7b\u4f3c\u4e8eChrome\u5f00\u53d1\u8005\u5de5\u5177\u7684F12\uff0c\u53ef\u4ee5\u770b\u5230\u63a5\u53e3\u7684\u8bf7\u6c42\u4fe1\u606f mitmporxy \u63d0\u4f9b\u4ea4\u4e92\u5f0f\u7ec8\u7aef mitmdump \u63d0\u4f9b\u975e\u4ea4\u4e92\u5f0f\u7ec8\u7aef \u6211\u4e2a\u4eba\u611f\u89c91\u548c2\u7528\u7684\u591a\u4e00\u70b9\uff0c\u770b\u5b98\u7f51\u7684\u4f8b\u5b50\uff0c3\u4e3b\u8981\u662f\u8981\u5bfc\u51fa\u5f55\u5236\u7684\u6570\u636e\uff0c\u4e0d\u5728\u6211\u7684 \u8ba1\u5212 \u4e4b\u5185\u3002 \u5728\u6b64\u4e4b\u524d\u6211\u4eec\u5148\u672c\u5730\u5c1d\u8bd5\u4e00\u4e0b\uff0c\u4ee5\u6211\u7684\u8001Windows\u4e3a\u4f8b: \u4e0b\u8f7dmitmproxy \u9996\u9875\u622a\u56fe\u7b2c\u4e00\u4e2a\u5c31\u662fWindows\u7684\u914d\u7f6e\uff0c\u6211\u4eec\u76f4\u63a5\u4e0b\u8f7d\u5373\u53ef\u3002\uff08\u5982\u679c\u662fmac\u5219\u9700\u8981brew install mitmproxy\uff09 \u4e0b\u8f7d\u540e\u5b89\u88c5\u5373\u53ef\u3002 \u5f00\u542fmitmproxy \u7b80\u5355\u5730\u6253\u5f00mitmproxy.exe\u5373\u53ef\uff0c\u5f53\u7136\u4e5f\u53ef\u4ee5\u7528web\u7248\u672c\u7684\uff0c\u53ea\u6709\u5f00\u542f\u540e\u6211\u4eec\u624d\u80fd\u4e0b\u8f7d\u5bf9\u5e94\u7684\u8bc1\u4e66\u3002 \u4f7f\u7528\u4ee3\u7406 \u5728windows\u4e0b\uff0c\u6211\u4eec\u53ef\u4ee5\u6309Windows\u952e\uff0c\u8f93\u5165 \u4ee3\u7406 \uff0c\u5982\u4e0b\u56fe: \u70b9\u51fb\u4ee5\u540e\uff0c\u8fdb\u53bb\u914d\u7f6e\u5bf9\u5e94\u7684\u4ee3\u7406\u5730\u5740: \u9ed8\u8ba4\u4e3alocalhost:8080, \u4e5f\u53ef\u4ee5\u81ea\u5df1\u6307\u5b9amitmproxy.exe\u542f\u52a8\u7684\u7aef\u53e3\u3002 \u4e0b\u8f7d\u8bc1\u4e66 \u6211\u4eec\u8981\u5148\u5f00\u542fmitmproxy.exe\u6216\u8005web.exe, \u53ea\u6709\u5f00\u542f\u540e\uff0c\u6211\u4eec\u624d\u80fd\u4e0b\u8f7d\u8bc1\u4e66\u3002 \u6d4f\u89c8\u5668\u6253\u5f00: http://mitm.it/ \u6839\u636e\u5177\u4f53\u7684\u6307\u5f15\u8fdb\u884c\u5b89\u88c5\u5373\u53ef\uff0c\u4e00\u822c\u662f\u4e0b\u8f7d\u4e00\u4e2acert\u8bc1\u4e66\uff0c\u5b89\u88c5\u5230\u672c\u5730\u5e76\u53d6\u5f97\u8ba1\u7b97\u673a\u7684 \u4fe1\u4efb \u5373\u53ef\u3002 \u63a5\u7740\u6211\u4eec\u5c31\u53ef\u4ee5\u5728\u5bf9\u5e94\u7684mitmproxy.exe\u7684\u7a97\u53e3\u770b\u5230\u6211\u4eec\u7684\u5f55\u5236\u8bf7\u6c42\u4e86\u3002 \u4eca\u5929\u7684\u5185\u5bb9\u5230\u8fd9\u91cc\u5c31\u7ed3\u675f\u4e86\uff0c\u4e0b\u4e00\u8282\u6211\u4eec\u7ee7\u7eed\u5b66\u4e60 mitmproxy \u83b7\u53d6\u5f55\u5236http\u8bf7\u6c42\u76f8\u5173\u5185\u5bb9\uff0c\u53bb\u7f16\u5199\u5177\u4f53\u7684\u5f55\u5236\u56de\u653e\u8bf7\u6c42\u3002","title":"130.\u7528\u4f8b\u751f\u6210\u4e4b\u719f\u6089mitmproxy"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28130%29%20%E7%94%A8%E4%BE%8B%E7%94%9F%E6%88%90%E4%B9%8B%E7%86%9F%E6%82%89mitmproxy/#_1","text":"\u8bb0\u5f97\u4e0a\u4e00\u8282\u6211\u4eec\u5b8c\u6210\u4e86 \u51fa\u53c2 \u76f8\u5173\u7684\u6539\u9020\u5185\u5bb9\uff0c\u4e4b\u524d\u6709\u4e2a\u5927\u4f6c @\u6674\u5929 \u95ee\u6211\uff0c\u662f\u5426\u8003\u8651\u5728 pity \u91cc\u9762\u52a0\u5165\u5982\u4e0b\u7684\u529f\u80fd: \u6253\u5f00\u6d4f\u89c8\u5668\uff0c\u8fdb\u884c\u4e00\u7cfb\u5217\u64cd\u4f5c\uff0c\u800c\u540e\u5c31\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a\u6d4b\u8bd5\u7528\u4f8b\u3002 \u8fd9\u4e2a\u4e1c\u897f\u8001\u5b9e\u8bf4\uff0c\u6211\u6ca1\u505a\u8fc7\uff0c\u4f46\u662f\u6211\u89c9\u5f97\u8fd8\u662f\u5f88\u6709\u4ef7\u503c\u7684\u3002\u901a\u8fc7 \u5f55\u5236 \u7528\u6237\u7684\u64cd\u4f5c\uff0c\u5f62\u6210\u7c7b\u4f3char\u7684\u6587\u4ef6\uff0c\u63a5\u7740\u5bfc\u5165\u5230 pity \u3002\u800c\u4e14\u53ea\u8981\u4e2d\u95f4\u6587\u4ef6\u4e00\u81f4\uff0c\u90a3\u5c31\u53ef\u4ee5\u5b9e\u73b0\u5f88\u591a\u5e73\u53f0\u7684\u65e0\u7f1d\u5bf9\u63a5\uff0c\u6bd4\u5982: httprunner postman har jmx \u8fd9\u4e9b\u90fd\u662f\u5f88\u5e38\u7528\u7684\u5176\u5b83\u5e73\u53f0/\u6846\u67b6\u7684\u6570\u636e\uff0c\u5982\u679c\u80fd\u652f\u6301\u5230\u5f55\u5236\u751f\u6210\u7528\u4f8b\uff0c\u90a3\u4e48\u5bfc\u5165\u5bfc\u51fa\u5176\u5b83\u5e73\u53f0\u7684\u7528\u4f8b\u6570\u636e\u4e5f\u4e0d\u5728 \u8bdd\u4e0b \u3002\u53ef\u8c13\u662f\u4e00\u4e3e\u591a\u5f97\uff0c\u6240\u4ee5\u8fd9\u5c31\u662f\u6211\u6253\u7b97\u8fd1\u671f\u505a\u8fd9\u4e2a\u7684\u539f\u56e0\u3002","title":"\u56de\u987e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28130%29%20%E7%94%A8%E4%BE%8B%E7%94%9F%E6%88%90%E4%B9%8B%E7%86%9F%E6%82%89mitmproxy/#_2","text":"\u5176\u5b9e\u6211\u662f\u6ca1\u4ec0\u4e48\u5177\u4f53\u7684\u601d\u8def\uff0c\u53ea\u6709\u4e00\u4e2a\u5927\u6982\u7684\u65b9\u5411\uff0c\u6211\u5148\u68b3\u7406\u4e00\u4e0b: \u901a\u8fc7\u5f55\u5236\u6d4f\u89c8\u5668/app\u8bf7\u6c42\uff0c\u83b7\u5f97\u6bcf\u4e2a\u63a5\u53e3\u7684\u8bf7\u6c42\u5165\u53c2/\u51fa\u53c2/header\u7b49\u4fe1\u606f \u89e3\u6790\u8fd9\u4e9b\u6570\u636e\uff0c\u751f\u6210\u4e00\u4e2a\u4e34\u65f6\u7684\u4e2d\u95f4\u6570\u636e\uff0c\u53ef\u4ee5\u662fhar\u4e5f\u53ef\u4ee5\u662fjson\uff0c\u8fd9\u4e2a\u65e0\u6240\u8c13 \u89e3\u6790\u4e2d\u95f4\u6570\u636e\uff0c\u5c06\u4e4b\u8f6c\u53d8\u4e3apity\u7684\u7528\u4f8b \u542c\u8d77\u6765\u5f88\u7b80\u5355\u5427\uff1f\u611f\u89c9\u597d\u50cf\u662f\u7684\uff0c\u4e0d\u8fc7\u89e3\u6790\u4e2d\u95f4\u6570\u636e\u90a3\u91cc\u4f30\u8ba1\u4f1a\u6709\u4e00\u4e9b\u5751\uff0c\u6bd4\u5982 \u7528\u4f8b\u4e4b\u95f4\u4f9d\u8d56\u7684\u6570\u636e \uff0c\u8fd9\u5757\u53ef\u80fd\u662f\u4e2a\u96be\u70b9\uff0c\u9664\u6b64\u4e4b\u5916\uff0c\u5176\u4ed6\u7684\u5e94\u8be5\u90fd\u4e0d\u5728\u8bdd\u4e0b\u3002","title":"\u601d\u8def"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28130%29%20%E7%94%A8%E4%BE%8B%E7%94%9F%E6%88%90%E4%B9%8B%E7%86%9F%E6%82%89mitmproxy/#_3","text":"Python\u6709\u4e00\u6b3e\u6bd4\u8f83\u63a8\u8350\u7684 \u5de5\u5177 \uff1amitmproxy\uff0c\u8fd9\u6b21\u6211\u5c31\u4e0d\u5f15\u7528\u5b98\u7f51\u8bf4\u6cd5\u4e86\uff0c\u6211\u76f4\u63a5\u7b80\u77ed\u4ecb\u7ecd\u4e0b: mitmproxy\u662f\u4e00\u4e2a\u7c7b\u4f3c\u4e2d\u95f4\u4eba\u7684\u5de5\u5177\uff0c\u5f53\u4f60\u6302\u4e0a\u4ed6\u7684\u4ee3\u7406\uff0c\u4f60\u7684\u6240\u6709\u8bf7\u6c42\u90fd\u80fd\u88ab\u76d1\u542c\u5230\uff0c\u5e76\u4e14\u4ed6\u8fd8\u53ef\u4ee5\u7be1\u6539\u4f60\u7684\u8bf7\u6c42\uff0c\u6bd4\u5982\u4f60\u8bf7\u6c42www.baidu.com\u7684\u65f6\u5019\uff0c\u4ed6\u7ed9\u4f60\u8fd4\u56de\uff1a hello baidu \uff0c\u8fd9\u4e5f\u610f\u5473\u7740\u5b83\u6709\u7740\u5728\u672a\u6765\u6210\u4e3apity mock\u670d\u52a1 \u9876\u6881\u67f1 \u7684\u6f5c\u529b\u3002 \u90a3\u6211\u4eec\u5148\u6253\u5165\u654c\u4eba\u5185\u90e8\u770b\u4e2a\u7a76\u7adf~","title":"\u600e\u4e48\u5f55\u5236\u8bf7\u6c42\u5462\uff1f"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28130%29%20%E7%94%A8%E4%BE%8B%E7%94%9F%E6%88%90%E4%B9%8B%E7%86%9F%E6%82%89mitmproxy/#mitmproxy","text":"\u53ef\u4ee5\u770b\u5230\uff0cmitmproxy\uff0c\u4ed6\u672c\u8d28\u8fd8\u662f\u4e00\u4e2a \u4ee3\u7406 \u3002\u6240\u4ee5\u6211\u4eec\u7684\u5de5\u4f5c\u6a21\u5f0f\u662f\uff0c\u914d\u7f6e\u597d\u4ee3\u7406\uff08\u7ed9pity\u914d\u7f6e\u597d\u4ee3\u7406\uff0c\u6211\u4eec\u7684http\u8bf7\u6c42\u7531pity\u53d1\u51fa\uff09\u3002 \u5b83\u672c\u8eab\u5462\uff0c\u662f\u6709\u51e0\u79cd\u6a21\u5f0f\u7684: web\u7aef \u8fd9\u4e2a\u5c31\u6709\u70b9\u7c7b\u4f3c\u4e8eChrome\u5f00\u53d1\u8005\u5de5\u5177\u7684F12\uff0c\u53ef\u4ee5\u770b\u5230\u63a5\u53e3\u7684\u8bf7\u6c42\u4fe1\u606f mitmporxy \u63d0\u4f9b\u4ea4\u4e92\u5f0f\u7ec8\u7aef mitmdump \u63d0\u4f9b\u975e\u4ea4\u4e92\u5f0f\u7ec8\u7aef \u6211\u4e2a\u4eba\u611f\u89c91\u548c2\u7528\u7684\u591a\u4e00\u70b9\uff0c\u770b\u5b98\u7f51\u7684\u4f8b\u5b50\uff0c3\u4e3b\u8981\u662f\u8981\u5bfc\u51fa\u5f55\u5236\u7684\u6570\u636e\uff0c\u4e0d\u5728\u6211\u7684 \u8ba1\u5212 \u4e4b\u5185\u3002 \u5728\u6b64\u4e4b\u524d\u6211\u4eec\u5148\u672c\u5730\u5c1d\u8bd5\u4e00\u4e0b\uff0c\u4ee5\u6211\u7684\u8001Windows\u4e3a\u4f8b: \u4e0b\u8f7dmitmproxy \u9996\u9875\u622a\u56fe\u7b2c\u4e00\u4e2a\u5c31\u662fWindows\u7684\u914d\u7f6e\uff0c\u6211\u4eec\u76f4\u63a5\u4e0b\u8f7d\u5373\u53ef\u3002\uff08\u5982\u679c\u662fmac\u5219\u9700\u8981brew install mitmproxy\uff09 \u4e0b\u8f7d\u540e\u5b89\u88c5\u5373\u53ef\u3002 \u5f00\u542fmitmproxy \u7b80\u5355\u5730\u6253\u5f00mitmproxy.exe\u5373\u53ef\uff0c\u5f53\u7136\u4e5f\u53ef\u4ee5\u7528web\u7248\u672c\u7684\uff0c\u53ea\u6709\u5f00\u542f\u540e\u6211\u4eec\u624d\u80fd\u4e0b\u8f7d\u5bf9\u5e94\u7684\u8bc1\u4e66\u3002 \u4f7f\u7528\u4ee3\u7406 \u5728windows\u4e0b\uff0c\u6211\u4eec\u53ef\u4ee5\u6309Windows\u952e\uff0c\u8f93\u5165 \u4ee3\u7406 \uff0c\u5982\u4e0b\u56fe: \u70b9\u51fb\u4ee5\u540e\uff0c\u8fdb\u53bb\u914d\u7f6e\u5bf9\u5e94\u7684\u4ee3\u7406\u5730\u5740: \u9ed8\u8ba4\u4e3alocalhost:8080, \u4e5f\u53ef\u4ee5\u81ea\u5df1\u6307\u5b9amitmproxy.exe\u542f\u52a8\u7684\u7aef\u53e3\u3002 \u4e0b\u8f7d\u8bc1\u4e66 \u6211\u4eec\u8981\u5148\u5f00\u542fmitmproxy.exe\u6216\u8005web.exe, \u53ea\u6709\u5f00\u542f\u540e\uff0c\u6211\u4eec\u624d\u80fd\u4e0b\u8f7d\u8bc1\u4e66\u3002 \u6d4f\u89c8\u5668\u6253\u5f00: http://mitm.it/ \u6839\u636e\u5177\u4f53\u7684\u6307\u5f15\u8fdb\u884c\u5b89\u88c5\u5373\u53ef\uff0c\u4e00\u822c\u662f\u4e0b\u8f7d\u4e00\u4e2acert\u8bc1\u4e66\uff0c\u5b89\u88c5\u5230\u672c\u5730\u5e76\u53d6\u5f97\u8ba1\u7b97\u673a\u7684 \u4fe1\u4efb \u5373\u53ef\u3002 \u63a5\u7740\u6211\u4eec\u5c31\u53ef\u4ee5\u5728\u5bf9\u5e94\u7684mitmproxy.exe\u7684\u7a97\u53e3\u770b\u5230\u6211\u4eec\u7684\u5f55\u5236\u8bf7\u6c42\u4e86\u3002 \u4eca\u5929\u7684\u5185\u5bb9\u5230\u8fd9\u91cc\u5c31\u7ed3\u675f\u4e86\uff0c\u4e0b\u4e00\u8282\u6211\u4eec\u7ee7\u7eed\u5b66\u4e60 mitmproxy \u83b7\u53d6\u5f55\u5236http\u8bf7\u6c42\u76f8\u5173\u5185\u5bb9\uff0c\u53bb\u7f16\u5199\u5177\u4f53\u7684\u5f55\u5236\u56de\u653e\u8bf7\u6c42\u3002","title":"Mitmproxy"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28131%29%20%E7%94%A8%E4%BE%8B%E7%94%9F%E6%88%90%E4%B9%8B%E9%85%8D%E7%BD%AEmitmproxy/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u4ecb\u7ecd\u4e86 mitmproxy \uff0c\u8fd9\u8282\u6211\u4eec\u5c31\u6765\u8f7b\u677e\u6109\u5feb\u5730\u5b9e\u73b0\u4e00\u4e2a\u7be1\u6539 HTTP\u8fd4\u56de \u7684\u529f\u80fd\u3002 \u5b89\u88c5\u8bc1\u4e66 \u6b63\u597d\u6211\u7684\u7535\u8111 \u91cd\u88c5\u4e86\u7cfb\u7edf \uff0c\u6240\u4ee5\u8bc1\u4e66\u561b\u7684\uff0c\u6211\u4e5f\u5f97\u91cd\u65b0\u5b89\u88c5\u4e00\u904d\uff0c\u987a\u4fbf\u8bb0\u5f55\u4e0b\u6574\u4e2a\u8fc7\u7a0b\u3002 \u9996\u5148\u6211\u4eec\u5f00\u542fmitmproxy.exe\uff0c\u63a5\u7740\u6253\u5f00\u6d4f\u89c8\u5668: \u8f93\u5165mitm.it \u4ed6\u63d0\u793a\u6211\u4eec \u6ca1\u6709\u901a\u8fc7\u4ee3\u7406 \u8bbf\u95ee\u8fd9\u4e2a\u7f51\u7ad9\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u914d\u7f6e\u4e0b\u81ea\u5df1\u7684\u4ee3\u7406\u670d\u52a1\u5668\uff08Mac\u7684\u7528\u6237\u8fd8\u8bf7\u81ea\u5df1\u767e\u5ea6\u4e00\u4e0b\uff0c\u76ee\u524d\u6211\u7684\u673a\u5668\u662fWindows\uff09 \u6309\u4f4fWindows\u952e\uff0c\u641c\u7d22 \u4ee3\u7406 \u3002 \u8fdb\u5165\u4ee3\u7406\u8bbe\u7f6e\u9875\u9762\uff0c\u8f93\u5165127.0.0.1+8080\u7aef\u53e3\uff0c\u63a5\u7740\u4fdd\u5b58\u5373\u53ef\u3002 \u518d\u6b21\u8bbf\u95eemitm.it\u9875\u9762: \u9875\u9762\u53d1\u751f\u4e86\u53d8\u5316\uff0c\u6211\u4eec\u76f4\u63a5\u4e0b\u8f7dWindows\u4e0b\u7684\u8bc1\u4e66\uff0c\u4e0b\u8f7d\u5b8c\u6210\u540e\u6253\u5f00\uff0c\u4e00\u76f4\u70b9\u4e0b\u4e00\u6b65\u5373\u53ef\u3002 \u6700\u540e\u70b9\u51fb\u786e\u5b9a\u5373\u53ef\u3002 \u5176\u5b9e\u5b89\u88c5\u8bc1\u4e66\u4e3b\u8981\u662f\u4e3a\u4e86\u8ba9 https \u63a5\u53e3\u80fd\u591f\u6b63\u5e38\u8fd0\u8f6c\uff0c\u4e0d\u7136\u6211\u4eec\u5f55\u5236\u5230https\u63a5\u53e3\u7684\u65f6\u5019\u4f1a\u63d0\u793a\u6211\u4eec\u7ecf\u8fc7\u4e86\u4ee3\u7406\uff0c\u4ece\u800c \u88ab\u62e6\u622a \u3002 \u6253\u5f00\u7f51\u7ad9\u6d4b\u8bd5\u4e00\u4e0b \u6211\u4eec\u6253\u5f00 \u6398\u91d1 \uff0c\u53ef\u4ee5\u770b\u5230\u6709\u5f88\u591a\u4e2a\u5f55\u5236\u5230\u7684\u63a5\u53e3\uff0c\u800c\u4e14\u9875\u9762\u57fa\u672c\u4e0a\u4e5f\u662f\u65e0\u611f\u77e5\u7684\uff0c\u4e0d\u4f1a\u62a5\u5565 \u5b89\u5168\u95ee\u9898 \u3002 \uff08\u5927\u5bb6\u53ef\u4ee5\u591a\u5f00\u51e0\u4e2a\u7f51\u7ad9\u8bd5\u8bd5\u770b\uff0c\u770b\u4f1a\u4e0d\u4f1a\u6709\u4ec0\u4e48\u95ee\u9898\uff09 \u7be1\u6539\u767e\u5ea6\u9996\u9875 \u6211\u4eec\u4eca\u5929\u7684\u4efb\u52a1\u662f\u5199\u4e00\u4e2a\u7b80\u5355\u7684 mock\u811a\u672c \uff0c\u8ba9\u5927\u5bb6\u611f\u53d7\u4e00\u4e0bmitmproxy\u7684\u5f3a\u5927\u3002 \u5f53\u7528\u6237\u8bbf\u95ee https://www.baidu.com \u7684\u65f6\u5019\uff0c\u7ed9\u4ed6\u8fd4\u56de \u767e\u5ea6\u4e00\u4e0b\uff0c\u4f60\u5c31\u77e5\u9053 \u3002 \u8bdd\u4e0d\u591a\u8bf4\uff0c\u5f00\u9020\u3002 \u7f16\u5199\u4e00\u4e2a\u6700\u57fa\u7840\u7684\u811a\u672c \u6211\u4eec\u9700\u8981\u5148\u7f16\u5199\u4e00\u4e2abaidu.py\uff0c\u63a5\u7740\u5199\u5165\u4ee5\u4e0b\u5185\u5bb9: from mitmproxy import http class Baidu ( object ): def request ( self , flow ): if flow . request . pretty_url . startswith ( \"https://www.baidu.com\" ): flow . response = http . Response . make ( 200 , # (optional) status code \"\u767e\u5ea6\u4e00\u4e0b\uff0c\u4f60\u5c31\u77e5\u9053\" , # (optional) content { \"Content-Type\" : \"application/json\" } # (optional) headers ) addons = [ Baidu () ] \u8fd9\u91cc\u6211\u4eec\u5b9a\u4e49\u4e86\u4e00\u4e2a\u767e\u5ea6\u7c7b\uff0c\u63a5\u7740\u5728\u6bcf\u6b21request\u8bf7\u6c42\u8fdb\u6765\u7684\u65f6\u5019\uff0c\u6211\u4eec\u5224\u65ad\u4ed6\u7684url\u662f\u4e0d\u662fbaidu.com\uff0c\u662f\u7684\u8bdd\uff0c\u6211\u4eec\u5c31\u7ed9\u4ed6\u8bbe\u7f6e\u4e00\u4e0bresponse\uff0c\u5176\u4e2d HTTP\u72b6\u6001\u7801 \u4e3a200\uff0c\u8fd4\u56de\u5185\u5bb9\u4e3a \u767e\u5ea6\u4e00\u4e0b\uff0c\u4f60\u5c31\u77e5\u9053 \u3002 \u63a5\u7740\u6211\u4eec\u628a\u8fd9\u4e2a\u7c7b\u52a0\u5165addons\u6570\u7ec4\uff0c\u5e76\u5728mitmproxy.exe\u542f\u52a8\u7684\u65f6\u5019\u6302\u8f7d\u4e4b\u3002 \u6302\u8f7daddons \u6267\u884c\u4e00\u4e0b\u547d\u4ee4\uff08\u9700\u8981\u628amitmpdump.exe\u653e\u5165\u73af\u5883\u53d8\u91cf, \u4e5f\u53ef\u4ee5pip\u5168\u5c40\u5b89\u88c5mitmproxy\uff09 mitmdump -s baidu.py \u63a5\u7740\u6211\u4eec\u6302\u4e0a8080\u7684\u4ee3\u7406\uff0c\u5f00\u59cb\u8bbf\u95ee\u767e\u5ea6\uff0c\u8fd9\u65f6\u5019\u5c31\u5e94\u8be5\u5c55\u73b0gif\u56fe\u4e86\uff01 \u8fd9\u6837\u6211\u4eec\u5c31\u5b8c\u6210\u4e86\u4e00\u4e2a\u7b80\u5355\u7684 \u7be1\u6539\u8bf7\u6c42 \uff0c\u867d\u7136\u8fd9\u4e0d\u662f\u7528\u4f8b\u5f55\u5236\u76f8\u5173\u7684\u5185\u5bb9\uff0c\u4f46\u6211\u8fd8\u662f\u60f3\u5c55\u793a\u4e00\u4e0bmitmproxy\u7684\u5f3a\u5927\u3002 \u4eca\u5929\u7684\u5185\u5bb9\u5c31\u8bb2\u5230\u8fd9\u91cc\uff0c\u4e0b\u4e00\u8282\u6211\u4eec\u7ee7\u7eed\u4ecb\u7ecd\u7528\u4f8b\u751f\u6210\u76f8\u5173\u5185\u5bb9\u3002","title":"131.\u7528\u4f8b\u751f\u6210\u4e4b\u914d\u7f6emitmproxy"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28131%29%20%E7%94%A8%E4%BE%8B%E7%94%9F%E6%88%90%E4%B9%8B%E9%85%8D%E7%BD%AEmitmproxy/#_1","text":"\u4e0a\u4e00\u8282\u6211\u4eec\u4ecb\u7ecd\u4e86 mitmproxy \uff0c\u8fd9\u8282\u6211\u4eec\u5c31\u6765\u8f7b\u677e\u6109\u5feb\u5730\u5b9e\u73b0\u4e00\u4e2a\u7be1\u6539 HTTP\u8fd4\u56de \u7684\u529f\u80fd\u3002","title":"\u56de\u987e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28131%29%20%E7%94%A8%E4%BE%8B%E7%94%9F%E6%88%90%E4%B9%8B%E9%85%8D%E7%BD%AEmitmproxy/#_2","text":"\u6b63\u597d\u6211\u7684\u7535\u8111 \u91cd\u88c5\u4e86\u7cfb\u7edf \uff0c\u6240\u4ee5\u8bc1\u4e66\u561b\u7684\uff0c\u6211\u4e5f\u5f97\u91cd\u65b0\u5b89\u88c5\u4e00\u904d\uff0c\u987a\u4fbf\u8bb0\u5f55\u4e0b\u6574\u4e2a\u8fc7\u7a0b\u3002 \u9996\u5148\u6211\u4eec\u5f00\u542fmitmproxy.exe\uff0c\u63a5\u7740\u6253\u5f00\u6d4f\u89c8\u5668: \u8f93\u5165mitm.it \u4ed6\u63d0\u793a\u6211\u4eec \u6ca1\u6709\u901a\u8fc7\u4ee3\u7406 \u8bbf\u95ee\u8fd9\u4e2a\u7f51\u7ad9\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u914d\u7f6e\u4e0b\u81ea\u5df1\u7684\u4ee3\u7406\u670d\u52a1\u5668\uff08Mac\u7684\u7528\u6237\u8fd8\u8bf7\u81ea\u5df1\u767e\u5ea6\u4e00\u4e0b\uff0c\u76ee\u524d\u6211\u7684\u673a\u5668\u662fWindows\uff09 \u6309\u4f4fWindows\u952e\uff0c\u641c\u7d22 \u4ee3\u7406 \u3002 \u8fdb\u5165\u4ee3\u7406\u8bbe\u7f6e\u9875\u9762\uff0c\u8f93\u5165127.0.0.1+8080\u7aef\u53e3\uff0c\u63a5\u7740\u4fdd\u5b58\u5373\u53ef\u3002 \u518d\u6b21\u8bbf\u95eemitm.it\u9875\u9762: \u9875\u9762\u53d1\u751f\u4e86\u53d8\u5316\uff0c\u6211\u4eec\u76f4\u63a5\u4e0b\u8f7dWindows\u4e0b\u7684\u8bc1\u4e66\uff0c\u4e0b\u8f7d\u5b8c\u6210\u540e\u6253\u5f00\uff0c\u4e00\u76f4\u70b9\u4e0b\u4e00\u6b65\u5373\u53ef\u3002 \u6700\u540e\u70b9\u51fb\u786e\u5b9a\u5373\u53ef\u3002 \u5176\u5b9e\u5b89\u88c5\u8bc1\u4e66\u4e3b\u8981\u662f\u4e3a\u4e86\u8ba9 https \u63a5\u53e3\u80fd\u591f\u6b63\u5e38\u8fd0\u8f6c\uff0c\u4e0d\u7136\u6211\u4eec\u5f55\u5236\u5230https\u63a5\u53e3\u7684\u65f6\u5019\u4f1a\u63d0\u793a\u6211\u4eec\u7ecf\u8fc7\u4e86\u4ee3\u7406\uff0c\u4ece\u800c \u88ab\u62e6\u622a \u3002","title":"\u5b89\u88c5\u8bc1\u4e66"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28131%29%20%E7%94%A8%E4%BE%8B%E7%94%9F%E6%88%90%E4%B9%8B%E9%85%8D%E7%BD%AEmitmproxy/#_3","text":"\u6211\u4eec\u6253\u5f00 \u6398\u91d1 \uff0c\u53ef\u4ee5\u770b\u5230\u6709\u5f88\u591a\u4e2a\u5f55\u5236\u5230\u7684\u63a5\u53e3\uff0c\u800c\u4e14\u9875\u9762\u57fa\u672c\u4e0a\u4e5f\u662f\u65e0\u611f\u77e5\u7684\uff0c\u4e0d\u4f1a\u62a5\u5565 \u5b89\u5168\u95ee\u9898 \u3002 \uff08\u5927\u5bb6\u53ef\u4ee5\u591a\u5f00\u51e0\u4e2a\u7f51\u7ad9\u8bd5\u8bd5\u770b\uff0c\u770b\u4f1a\u4e0d\u4f1a\u6709\u4ec0\u4e48\u95ee\u9898\uff09","title":"\u6253\u5f00\u7f51\u7ad9\u6d4b\u8bd5\u4e00\u4e0b"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28131%29%20%E7%94%A8%E4%BE%8B%E7%94%9F%E6%88%90%E4%B9%8B%E9%85%8D%E7%BD%AEmitmproxy/#_4","text":"\u6211\u4eec\u4eca\u5929\u7684\u4efb\u52a1\u662f\u5199\u4e00\u4e2a\u7b80\u5355\u7684 mock\u811a\u672c \uff0c\u8ba9\u5927\u5bb6\u611f\u53d7\u4e00\u4e0bmitmproxy\u7684\u5f3a\u5927\u3002 \u5f53\u7528\u6237\u8bbf\u95ee https://www.baidu.com \u7684\u65f6\u5019\uff0c\u7ed9\u4ed6\u8fd4\u56de \u767e\u5ea6\u4e00\u4e0b\uff0c\u4f60\u5c31\u77e5\u9053 \u3002 \u8bdd\u4e0d\u591a\u8bf4\uff0c\u5f00\u9020\u3002 \u7f16\u5199\u4e00\u4e2a\u6700\u57fa\u7840\u7684\u811a\u672c \u6211\u4eec\u9700\u8981\u5148\u7f16\u5199\u4e00\u4e2abaidu.py\uff0c\u63a5\u7740\u5199\u5165\u4ee5\u4e0b\u5185\u5bb9: from mitmproxy import http class Baidu ( object ): def request ( self , flow ): if flow . request . pretty_url . startswith ( \"https://www.baidu.com\" ): flow . response = http . Response . make ( 200 , # (optional) status code \"\u767e\u5ea6\u4e00\u4e0b\uff0c\u4f60\u5c31\u77e5\u9053\" , # (optional) content { \"Content-Type\" : \"application/json\" } # (optional) headers ) addons = [ Baidu () ] \u8fd9\u91cc\u6211\u4eec\u5b9a\u4e49\u4e86\u4e00\u4e2a\u767e\u5ea6\u7c7b\uff0c\u63a5\u7740\u5728\u6bcf\u6b21request\u8bf7\u6c42\u8fdb\u6765\u7684\u65f6\u5019\uff0c\u6211\u4eec\u5224\u65ad\u4ed6\u7684url\u662f\u4e0d\u662fbaidu.com\uff0c\u662f\u7684\u8bdd\uff0c\u6211\u4eec\u5c31\u7ed9\u4ed6\u8bbe\u7f6e\u4e00\u4e0bresponse\uff0c\u5176\u4e2d HTTP\u72b6\u6001\u7801 \u4e3a200\uff0c\u8fd4\u56de\u5185\u5bb9\u4e3a \u767e\u5ea6\u4e00\u4e0b\uff0c\u4f60\u5c31\u77e5\u9053 \u3002 \u63a5\u7740\u6211\u4eec\u628a\u8fd9\u4e2a\u7c7b\u52a0\u5165addons\u6570\u7ec4\uff0c\u5e76\u5728mitmproxy.exe\u542f\u52a8\u7684\u65f6\u5019\u6302\u8f7d\u4e4b\u3002 \u6302\u8f7daddons \u6267\u884c\u4e00\u4e0b\u547d\u4ee4\uff08\u9700\u8981\u628amitmpdump.exe\u653e\u5165\u73af\u5883\u53d8\u91cf, \u4e5f\u53ef\u4ee5pip\u5168\u5c40\u5b89\u88c5mitmproxy\uff09 mitmdump -s baidu.py \u63a5\u7740\u6211\u4eec\u6302\u4e0a8080\u7684\u4ee3\u7406\uff0c\u5f00\u59cb\u8bbf\u95ee\u767e\u5ea6\uff0c\u8fd9\u65f6\u5019\u5c31\u5e94\u8be5\u5c55\u73b0gif\u56fe\u4e86\uff01 \u8fd9\u6837\u6211\u4eec\u5c31\u5b8c\u6210\u4e86\u4e00\u4e2a\u7b80\u5355\u7684 \u7be1\u6539\u8bf7\u6c42 \uff0c\u867d\u7136\u8fd9\u4e0d\u662f\u7528\u4f8b\u5f55\u5236\u76f8\u5173\u7684\u5185\u5bb9\uff0c\u4f46\u6211\u8fd8\u662f\u60f3\u5c55\u793a\u4e00\u4e0bmitmproxy\u7684\u5f3a\u5927\u3002 \u4eca\u5929\u7684\u5185\u5bb9\u5c31\u8bb2\u5230\u8fd9\u91cc\uff0c\u4e0b\u4e00\u8282\u6211\u4eec\u7ee7\u7eed\u4ecb\u7ecd\u7528\u4f8b\u751f\u6210\u76f8\u5173\u5185\u5bb9\u3002","title":"\u7be1\u6539\u767e\u5ea6\u9996\u9875"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28132%29%20%E7%94%A8%E4%BE%8B%E7%94%9F%E6%88%90%E4%B9%8B%E5%BD%95%E5%88%B6%E6%8E%A5%E5%8F%A3%E8%AF%B7%E6%B1%82%28%E4%B8%8A%29/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u5b8c\u6210\u4e86mitmproxy\u7684demo\u7248\u672c\uff0c\u8fd9\u4e00\u8282\u6211\u4eec\u6765\u5927\u5200\u9614\u65a7\uff0c\u5229\u7528mitmproxy\u5f55\u5236\u6211\u4eec\u9700\u8981\u7684 \u63a5\u53e3\u8bf7\u6c42 \u3002 \u5f55\u5236\u4e86\u4ee5\u540e\uff0c\u4e0b\u4e00\u8282\u6211\u4eec\u4f30\u8ba1\u662f\u8981\u5b58\u53d6/\u89e3\u6790\u8fd9\u4e9b\u8bf7\u6c42\uff0c\u6700\u540e\u4e00\u6b65\u5c31\u662f\u8f6c\u6362\u4e3a pity \u7684\u6d4b\u8bd5\u7528\u4f8b\u4e86\u3002\u5f53\u7136\uff0c\u4e3a\u4e86\u901a\u7528\uff0c\u6700\u597d\u6211\u4eec\u4e5f\u80fd\u652f\u6301har/jmx\u7b49\u5176\u4ed6\u6587\u4ef6\u7684\u5bfc\u5165\u3002 \u5f55\u5236\u6d41\u7a0b \u7528\u6237\u5728\u9875\u9762\u8f93\u5165\u8981\u5f55\u5236\u7684url \u7528\u6237\u70b9\u51fb\u5f00\u59cb\u5f55\u5236\uff0c\u670d\u52a1\u7aef\u5c06\u7528\u6237\u7684ip\u5b58\u653e\u5230redis\u4e2d\uff0c\u8fd9\u6837\u7528\u6237\u5c31\u7b97\u4e2d\u9014\u79bb\u5f00\uff0c\u5237\u65b0\u9875\u9762\u4f9d\u7136\u80fd\u770b\u5230\u5bf9\u5e94\u7684\u5f55\u5236\u6570\u636e\u548c\u5f55\u5236\u4ecd\u5728\u8fdb\u884c\u4e2d\u7684\u72b6\u6001 \u7528\u6237\u70b9\u51fb\u505c\u6b62\u5f55\u5236\u6309\u94ae\uff0c\u7ed3\u675f\u5f55\u5236\uff0c\u540e\u7eed\u5c31\u662f\u7528\u4f8b\u7684\u751f\u6210\u5de5\u4f5c\u4e86 \u672c\u8282\u52062\u90e8\u5206\uff0c\u5efa\u8bae\u914d\u5408\u8d77\u6765\u9605\u8bfb\u3002\u5148\u7ed9\u5927\u5bb6\u770b\u4e2a\u6982\u89c8: \u914d\u7f6e\u4ee3\u7406 \u6839\u636emitmproxy\u5b98\u7f51\u53ef\u77e5\uff0c\u4ed6\u4eec\u9700\u8981\u81f3\u5c11python3.8\u4ee5\u4e0a\uff0c\u6240\u4ee5\u5927\u5bb6\u4e5f\u8d81\u8fd9\u4e2a\u673a\u4f1a\u5347\u7ea7\u4e00\u4e0bpython\u5427~\u6bd5\u7adf3.8\u4e5f\u53d1\u5e03\u5f88\u4e45\u4e86\u3002 \u63a5\u7740\u6211\u4eec\u9700\u8981\u5148\u5b89\u88c5mitmproxy\uff0c\u56e0\u4e3a\u4ed6\u9700\u8981\u968f\u7740\u6211\u4eec\u7684\u670d\u52a1\u542f\u52a8: pip install mitmproxy \u5b89\u88c5\u597d\u4ee5\u540e\uff0c\u6211\u4eec\u6765\u914d\u7f6e\u6211\u4eec\u7684MITMPROXY\u542f\u52a8\u7aef\u53e3\uff0c\u6682\u5b9a\u4e3a7778\u5427~ \u7531\u4e8e\u914d\u7f6e\u6587\u4ef6\u6211\u6709\u4e9b\u8bb8\u6539\u52a8\uff0c\u53ef\u4ee5\u53c2\u8003\u4e0b\u6587\u6863: https://fastapi.tiangolo.com/advanced/settings/#reading-a-env-file \u8fd9\u91cc\u5c31\u4e0d\u7ec6\u8bf4\u4e86\u3002\u57fa\u672c\u7528\u6cd5\u548c\u4e4b\u524d\u7c7b\u4f3c\uff0c\u53ea\u4e0d\u8fc7\u662f\u4ececonf/dev.env\u91cc\u9762\u8bfb\u53d6\u914d\u7f6e\u3002 \u6211\u4eec\u5f00\u542fmock\u5e76\u4e14\u8bbe\u7f6e\u597d\u5bf9\u5e94\u7684\u7aef\u53e3\u53f7\u3002 \u7f16\u5199Redis\u7f13\u5b58\u63a5\u53e3\u8bf7\u6c42\u7684\u65b9\u6cd5 \u6211\u7684\u8ba1\u5212\u662f\u628a\u4e34\u65f6\u5f55\u5236\u7684\u8bf7\u6c42\uff08\u4fdd\u5b581\u5c0f\u65f6\uff09\u653e\u5165redis\uff0c\u4e0e\u8be5\u7528\u6237\u7684ip\u7ed1\u5b9a\uff0c\u5982\u679c1\u5c0f\u65f6\u5185\u7528\u6237\u6682\u65f6\u79bb\u5f00\uff0c\u6bd4\u5982\u53bb\u4e0a\u4e86\u4e2a \u5395\u6240 \uff0c\u56de\u6765\u4e5f\u80fd\u7ee7\u7eed\u64cd\u4f5c\u3002 \u6240\u4ee5\u6211\u4eec\u9700\u8981\u5199\u4e00\u4e2aredis\u7f13\u5b58\u63a5\u53e3\u8bf7\u6c42\u7684\u65b9\u6cd5\uff0c\u4e0b\u9762\u662f\u4ee3\u7801: \u6211\u4eec\u7528\u5217\u8868\u5b58\u653e\u8fd9\u4e2a\u7528\u6237\u5f55\u5236\u7684\u8bf7\u6c42\uff08\u5229\u7528ip\u5730\u5740\u7684\u552f\u4e00\u6027\u4fdd\u8bc1key\u7684\u552f\u4e00\uff09\uff0c\u63a5\u7740\u5224\u65ad\u8fd9\u4e2akey\u662f\u5426\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\uff0c\u5982\u679c\u6ca1\u6709\u5219\u7ed9\u5b83\u8bbe\u7f6e1\u5c0f\u65f6\u7684\u8fc7\u671f\u65f6\u95f4\u3002 \u7f16\u5199proxy\u63d2\u4ef6 \u6211\u4eec\u73b0\u5728\u5f00\u59cb\u52a8\u624b\u7f16\u5199\u4e00\u4e2a\u5f55\u5236\u63d2\u4ef6\uff0c\u770b\u8fc7\u4e0a\u7bc7\u6587\u7ae0\u7684\u89c2\u4f17\u5e94\u8be5\u90fd\u5f88\u719f\u6089\u3002 \"\"\" \u6d41\u91cf\u5f55\u5236->\u751f\u6210case\u529f\u80fd record steps and generate testcase \"\"\" import asyncio import json import re from app.core.ws_connection_manager import ws_manage from app.enums.MessageEnum import WebSocketMessageEnum from app.middleware.RedisManager import RedisHelper from app.proxy.utils import RequestInfo class PityRecorder ( object ): async def response ( self , flow ): # \u83b7\u53d6\u5f53\u524d\u5f55\u5236\u5230\u7684\u5ba2\u6237\u7aefip\u5730\u5740 addr = flow . client_conn . address [ 0 ] # \u5224\u65ad\u8fd9\u4e2aip\u662f\u5426\u5f00\u542f\u4e86\u5f55\u5236\uff0c\u6ca1\u5f00\u542f\u7684\u8bdd\uff0c\u76f4\u63a5return record = await RedisHelper . get_address_record ( addr ) if not record : return # \u83b7\u53d6\u5f55\u5236\u7684url\u4fe1\u606f data = json . loads ( record ) # \u5224\u65ad\u5f53\u524d\u7684url\u662f\u5426\u548c\u914d\u7f6e\u7684url\u5339\u914d pattern = re . compile ( data . get ( \"regex\" )) # \u5982\u679c\u5339\u914d\u5219\u7ee7\u7eed if re . findall ( pattern , flow . request . url ): # \u5ffd\u7565js\u3001css\u7b49\u6587\u4ef6 \u5ffd\u7565options\u8bf7\u6c42 if flow . request . method . lower () == \"options\" : return if flow . request . url . endswith (( \"js\" , \"css\" , \"ttf\" , \"jpg\" , \"svg\" , \"gif\" )): return # \u8bf4\u660e\u5df2\u5f00\u542f\u5f55\u5236\u5f00\u5173\uff0c\u8bb0\u5f55\u72b6\u6001 \u8fd9\u91cc\u5c06flow\u91cc\u9762\u7684request\u8fdb\u884c\u4e86\u8f6c\u6362 request_data = RequestInfo ( flow ) # \u5e8f\u5217\u5316\u4e3astr\uff0c\u65b9\u4fbf\u5b58\u5165redis dump_data = request_data . dumps () # \u8bb0\u5f55\u5f55\u5236\u7684\u63a5\u53e3\u6570\u636e await RedisHelper . cache_record ( addr , dump_data ) # \u901a\u8fc7websocket\u53d1\u9001\u5230\u5f55\u5236\u9875\u9762\uff0c\u4f7f\u9875\u9762\u751f\u6210\u6700\u65b0\u7684\u6570\u636e asyncio . create_task ( ws_manage . send_data ( data . get ( \"user_id\" ), WebSocketMessageEnum . RECORD , dump_data )) \u6ce8\u91ca\u91cc\u9762\u5199\u7684\u5f88\u8be6\u5c3d\uff0c\u8fd9\u91cc\u9762\u6709\u4e00\u90e8\u5206\u4ee3\u7801\u8fd8\u6ca1\u6709\u5b9e\u73b0\uff0c\u6d89\u53ca\u5230\u7684\u662fredis\u548cwebsocket\u90a3\u5757\uff0c\u5927\u4f53\u610f\u601d\u5927\u5bb6\u80fd\u7406\u89e3\u5373\u53ef\u3002 \u63a5\u7740\u6211\u4eec\u8981\u5c06\u63d2\u4ef6\u6302\u8f7d\u5230mitmproxy: app/proxy/__init__.py\u91cc\u9762\u5305\u88f9\u4e86\u4e00\u4e2astart_proxy\u7684\u65b9\u6cd5\uff0c\u5148\u5224\u65ad\u7528\u6237\u662f\u5426\u5b89\u88c5\u4e86mitmproxy\uff0c\u63a5\u7740\u628arecorder\u63d2\u4ef6\u6302\u8f7d\u8fdb\u6765\uff0c\u5229\u7528DumpMaster\u542f\u52a8mitmproxy\u5373\u53ef\u3002 \u4e0a\u9762\u5c31\u662f\u672c\u8282\u5185\u5bb9\uff0c\u4e0b\u4e00\u8282\u6211\u4eec\u5177\u4f53\u7ec6\u5316websocket\u3001redis\u8fd8\u6709\u524d\u7aef\u90e8\u5206\u5185\u5bb9\uff0c\u656c\u8bf7\u671f\u5f85\u3002","title":"132.\u7528\u4f8b\u751f\u6210\u4e4b\u5f55\u5236\u63a5\u53e3\u8bf7\u6c42(\u4e0a)"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28132%29%20%E7%94%A8%E4%BE%8B%E7%94%9F%E6%88%90%E4%B9%8B%E5%BD%95%E5%88%B6%E6%8E%A5%E5%8F%A3%E8%AF%B7%E6%B1%82%28%E4%B8%8A%29/#_1","text":"\u4e0a\u4e00\u8282\u6211\u4eec\u5b8c\u6210\u4e86mitmproxy\u7684demo\u7248\u672c\uff0c\u8fd9\u4e00\u8282\u6211\u4eec\u6765\u5927\u5200\u9614\u65a7\uff0c\u5229\u7528mitmproxy\u5f55\u5236\u6211\u4eec\u9700\u8981\u7684 \u63a5\u53e3\u8bf7\u6c42 \u3002 \u5f55\u5236\u4e86\u4ee5\u540e\uff0c\u4e0b\u4e00\u8282\u6211\u4eec\u4f30\u8ba1\u662f\u8981\u5b58\u53d6/\u89e3\u6790\u8fd9\u4e9b\u8bf7\u6c42\uff0c\u6700\u540e\u4e00\u6b65\u5c31\u662f\u8f6c\u6362\u4e3a pity \u7684\u6d4b\u8bd5\u7528\u4f8b\u4e86\u3002\u5f53\u7136\uff0c\u4e3a\u4e86\u901a\u7528\uff0c\u6700\u597d\u6211\u4eec\u4e5f\u80fd\u652f\u6301har/jmx\u7b49\u5176\u4ed6\u6587\u4ef6\u7684\u5bfc\u5165\u3002","title":"\u56de\u987e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28132%29%20%E7%94%A8%E4%BE%8B%E7%94%9F%E6%88%90%E4%B9%8B%E5%BD%95%E5%88%B6%E6%8E%A5%E5%8F%A3%E8%AF%B7%E6%B1%82%28%E4%B8%8A%29/#_2","text":"\u7528\u6237\u5728\u9875\u9762\u8f93\u5165\u8981\u5f55\u5236\u7684url \u7528\u6237\u70b9\u51fb\u5f00\u59cb\u5f55\u5236\uff0c\u670d\u52a1\u7aef\u5c06\u7528\u6237\u7684ip\u5b58\u653e\u5230redis\u4e2d\uff0c\u8fd9\u6837\u7528\u6237\u5c31\u7b97\u4e2d\u9014\u79bb\u5f00\uff0c\u5237\u65b0\u9875\u9762\u4f9d\u7136\u80fd\u770b\u5230\u5bf9\u5e94\u7684\u5f55\u5236\u6570\u636e\u548c\u5f55\u5236\u4ecd\u5728\u8fdb\u884c\u4e2d\u7684\u72b6\u6001 \u7528\u6237\u70b9\u51fb\u505c\u6b62\u5f55\u5236\u6309\u94ae\uff0c\u7ed3\u675f\u5f55\u5236\uff0c\u540e\u7eed\u5c31\u662f\u7528\u4f8b\u7684\u751f\u6210\u5de5\u4f5c\u4e86 \u672c\u8282\u52062\u90e8\u5206\uff0c\u5efa\u8bae\u914d\u5408\u8d77\u6765\u9605\u8bfb\u3002\u5148\u7ed9\u5927\u5bb6\u770b\u4e2a\u6982\u89c8:","title":"\u5f55\u5236\u6d41\u7a0b"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28132%29%20%E7%94%A8%E4%BE%8B%E7%94%9F%E6%88%90%E4%B9%8B%E5%BD%95%E5%88%B6%E6%8E%A5%E5%8F%A3%E8%AF%B7%E6%B1%82%28%E4%B8%8A%29/#_3","text":"\u6839\u636emitmproxy\u5b98\u7f51\u53ef\u77e5\uff0c\u4ed6\u4eec\u9700\u8981\u81f3\u5c11python3.8\u4ee5\u4e0a\uff0c\u6240\u4ee5\u5927\u5bb6\u4e5f\u8d81\u8fd9\u4e2a\u673a\u4f1a\u5347\u7ea7\u4e00\u4e0bpython\u5427~\u6bd5\u7adf3.8\u4e5f\u53d1\u5e03\u5f88\u4e45\u4e86\u3002 \u63a5\u7740\u6211\u4eec\u9700\u8981\u5148\u5b89\u88c5mitmproxy\uff0c\u56e0\u4e3a\u4ed6\u9700\u8981\u968f\u7740\u6211\u4eec\u7684\u670d\u52a1\u542f\u52a8: pip install mitmproxy \u5b89\u88c5\u597d\u4ee5\u540e\uff0c\u6211\u4eec\u6765\u914d\u7f6e\u6211\u4eec\u7684MITMPROXY\u542f\u52a8\u7aef\u53e3\uff0c\u6682\u5b9a\u4e3a7778\u5427~ \u7531\u4e8e\u914d\u7f6e\u6587\u4ef6\u6211\u6709\u4e9b\u8bb8\u6539\u52a8\uff0c\u53ef\u4ee5\u53c2\u8003\u4e0b\u6587\u6863: https://fastapi.tiangolo.com/advanced/settings/#reading-a-env-file \u8fd9\u91cc\u5c31\u4e0d\u7ec6\u8bf4\u4e86\u3002\u57fa\u672c\u7528\u6cd5\u548c\u4e4b\u524d\u7c7b\u4f3c\uff0c\u53ea\u4e0d\u8fc7\u662f\u4ececonf/dev.env\u91cc\u9762\u8bfb\u53d6\u914d\u7f6e\u3002 \u6211\u4eec\u5f00\u542fmock\u5e76\u4e14\u8bbe\u7f6e\u597d\u5bf9\u5e94\u7684\u7aef\u53e3\u53f7\u3002","title":"\u914d\u7f6e\u4ee3\u7406"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28132%29%20%E7%94%A8%E4%BE%8B%E7%94%9F%E6%88%90%E4%B9%8B%E5%BD%95%E5%88%B6%E6%8E%A5%E5%8F%A3%E8%AF%B7%E6%B1%82%28%E4%B8%8A%29/#redis","text":"\u6211\u7684\u8ba1\u5212\u662f\u628a\u4e34\u65f6\u5f55\u5236\u7684\u8bf7\u6c42\uff08\u4fdd\u5b581\u5c0f\u65f6\uff09\u653e\u5165redis\uff0c\u4e0e\u8be5\u7528\u6237\u7684ip\u7ed1\u5b9a\uff0c\u5982\u679c1\u5c0f\u65f6\u5185\u7528\u6237\u6682\u65f6\u79bb\u5f00\uff0c\u6bd4\u5982\u53bb\u4e0a\u4e86\u4e2a \u5395\u6240 \uff0c\u56de\u6765\u4e5f\u80fd\u7ee7\u7eed\u64cd\u4f5c\u3002 \u6240\u4ee5\u6211\u4eec\u9700\u8981\u5199\u4e00\u4e2aredis\u7f13\u5b58\u63a5\u53e3\u8bf7\u6c42\u7684\u65b9\u6cd5\uff0c\u4e0b\u9762\u662f\u4ee3\u7801: \u6211\u4eec\u7528\u5217\u8868\u5b58\u653e\u8fd9\u4e2a\u7528\u6237\u5f55\u5236\u7684\u8bf7\u6c42\uff08\u5229\u7528ip\u5730\u5740\u7684\u552f\u4e00\u6027\u4fdd\u8bc1key\u7684\u552f\u4e00\uff09\uff0c\u63a5\u7740\u5224\u65ad\u8fd9\u4e2akey\u662f\u5426\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\uff0c\u5982\u679c\u6ca1\u6709\u5219\u7ed9\u5b83\u8bbe\u7f6e1\u5c0f\u65f6\u7684\u8fc7\u671f\u65f6\u95f4\u3002","title":"\u7f16\u5199Redis\u7f13\u5b58\u63a5\u53e3\u8bf7\u6c42\u7684\u65b9\u6cd5"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28132%29%20%E7%94%A8%E4%BE%8B%E7%94%9F%E6%88%90%E4%B9%8B%E5%BD%95%E5%88%B6%E6%8E%A5%E5%8F%A3%E8%AF%B7%E6%B1%82%28%E4%B8%8A%29/#proxy","text":"\u6211\u4eec\u73b0\u5728\u5f00\u59cb\u52a8\u624b\u7f16\u5199\u4e00\u4e2a\u5f55\u5236\u63d2\u4ef6\uff0c\u770b\u8fc7\u4e0a\u7bc7\u6587\u7ae0\u7684\u89c2\u4f17\u5e94\u8be5\u90fd\u5f88\u719f\u6089\u3002 \"\"\" \u6d41\u91cf\u5f55\u5236->\u751f\u6210case\u529f\u80fd record steps and generate testcase \"\"\" import asyncio import json import re from app.core.ws_connection_manager import ws_manage from app.enums.MessageEnum import WebSocketMessageEnum from app.middleware.RedisManager import RedisHelper from app.proxy.utils import RequestInfo class PityRecorder ( object ): async def response ( self , flow ): # \u83b7\u53d6\u5f53\u524d\u5f55\u5236\u5230\u7684\u5ba2\u6237\u7aefip\u5730\u5740 addr = flow . client_conn . address [ 0 ] # \u5224\u65ad\u8fd9\u4e2aip\u662f\u5426\u5f00\u542f\u4e86\u5f55\u5236\uff0c\u6ca1\u5f00\u542f\u7684\u8bdd\uff0c\u76f4\u63a5return record = await RedisHelper . get_address_record ( addr ) if not record : return # \u83b7\u53d6\u5f55\u5236\u7684url\u4fe1\u606f data = json . loads ( record ) # \u5224\u65ad\u5f53\u524d\u7684url\u662f\u5426\u548c\u914d\u7f6e\u7684url\u5339\u914d pattern = re . compile ( data . get ( \"regex\" )) # \u5982\u679c\u5339\u914d\u5219\u7ee7\u7eed if re . findall ( pattern , flow . request . url ): # \u5ffd\u7565js\u3001css\u7b49\u6587\u4ef6 \u5ffd\u7565options\u8bf7\u6c42 if flow . request . method . lower () == \"options\" : return if flow . request . url . endswith (( \"js\" , \"css\" , \"ttf\" , \"jpg\" , \"svg\" , \"gif\" )): return # \u8bf4\u660e\u5df2\u5f00\u542f\u5f55\u5236\u5f00\u5173\uff0c\u8bb0\u5f55\u72b6\u6001 \u8fd9\u91cc\u5c06flow\u91cc\u9762\u7684request\u8fdb\u884c\u4e86\u8f6c\u6362 request_data = RequestInfo ( flow ) # \u5e8f\u5217\u5316\u4e3astr\uff0c\u65b9\u4fbf\u5b58\u5165redis dump_data = request_data . dumps () # \u8bb0\u5f55\u5f55\u5236\u7684\u63a5\u53e3\u6570\u636e await RedisHelper . cache_record ( addr , dump_data ) # \u901a\u8fc7websocket\u53d1\u9001\u5230\u5f55\u5236\u9875\u9762\uff0c\u4f7f\u9875\u9762\u751f\u6210\u6700\u65b0\u7684\u6570\u636e asyncio . create_task ( ws_manage . send_data ( data . get ( \"user_id\" ), WebSocketMessageEnum . RECORD , dump_data )) \u6ce8\u91ca\u91cc\u9762\u5199\u7684\u5f88\u8be6\u5c3d\uff0c\u8fd9\u91cc\u9762\u6709\u4e00\u90e8\u5206\u4ee3\u7801\u8fd8\u6ca1\u6709\u5b9e\u73b0\uff0c\u6d89\u53ca\u5230\u7684\u662fredis\u548cwebsocket\u90a3\u5757\uff0c\u5927\u4f53\u610f\u601d\u5927\u5bb6\u80fd\u7406\u89e3\u5373\u53ef\u3002 \u63a5\u7740\u6211\u4eec\u8981\u5c06\u63d2\u4ef6\u6302\u8f7d\u5230mitmproxy: app/proxy/__init__.py\u91cc\u9762\u5305\u88f9\u4e86\u4e00\u4e2astart_proxy\u7684\u65b9\u6cd5\uff0c\u5148\u5224\u65ad\u7528\u6237\u662f\u5426\u5b89\u88c5\u4e86mitmproxy\uff0c\u63a5\u7740\u628arecorder\u63d2\u4ef6\u6302\u8f7d\u8fdb\u6765\uff0c\u5229\u7528DumpMaster\u542f\u52a8mitmproxy\u5373\u53ef\u3002 \u4e0a\u9762\u5c31\u662f\u672c\u8282\u5185\u5bb9\uff0c\u4e0b\u4e00\u8282\u6211\u4eec\u5177\u4f53\u7ec6\u5316websocket\u3001redis\u8fd8\u6709\u524d\u7aef\u90e8\u5206\u5185\u5bb9\uff0c\u656c\u8bf7\u671f\u5f85\u3002","title":"\u7f16\u5199proxy\u63d2\u4ef6"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28133%29%20%E7%94%A8%E4%BE%8B%E7%94%9F%E6%88%90%E4%B9%8B%E5%BD%95%E5%88%B6%E6%8E%A5%E5%8F%A3%E8%AF%B7%E6%B1%82%28%E4%B8%8B%29/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u8bb2\u8ff0\u4e86 \u7528\u4f8b\u5f55\u5236 \u76f8\u5173\u5185\u5bb9\uff0c\u4f46\u662f\u6709\u4e00\u4e9bwebsocket\u7684\u6539\u9020\u548chttp\u8bf7\u6c42\u7ed3\u679c\u7684\u8f6c\u6362\u6ca1\u6709\u8bb2\uff0c\u8fd9\u4e00\u8282\u6211\u4eec\u5c31\u6765\u5b8c\u6210\u4ed6\u4eec\u3002 Websocket\u6539\u9020 websocket\u6539\u9020\u5206\u4e3a2\u90e8\u5206: \u540e\u7aef\u90e8\u5206\u8981\u652f\u6301\u53d1\u9001\u5f55\u5236\u597d\u7684http\u8bf7\u6c42\u6570\u636e\uff0c\u5176\u5b9e\u4e5f\u5c31\u662fjson\u6570\u636e\uff0c\u4e4b\u524d\u5df2\u7ecf\u652f\u6301\uff0c\u6211\u4eec\u7a0d\u5fae\u6539\u52a8\u4e0b\u5373\u53ef \u524d\u7aef\u90e8\u5206\u9700\u8981\u76d1\u542c\u65b0\u7684\u7c7b\u578b\uff0c\u6536\u5230\u540e\u7aef\u53d1\u6765\u7684\u6d88\u606f\uff0c\u6839\u636e\u6d88\u606ftype\u505a\u51fa\u4e0d\u540c\u7684\u64cd\u4f5c \u5148\u6765\u770b\u540e\u7aef\u90e8\u5206: \u5176\u5b9e\u6211\u4eec\u53ea\u9700\u8981\u5728websocketManager\u52a0\u5165send_data\u65b9\u6cd5\u5373\u53ef\uff0c\u4e5f\u5c31\u662f\u80fd\u81ea\u7531\u5730\u6839\u636e\u7528\u6237id\u53d1\u9001\u6d88\u606f\u3002 \u518d\u6765\u770b\u770b\u524d\u7aef\u90e8\u5206: \u7a0d\u5fae\u6709\u70b9\u53d8\u5316\uff0c\u6839\u636etype\u4e3a2\uff0c\u5224\u65ad\u662f \u5f55\u5236\u6210\u529f \u7684\u6d88\u606f\uff0c\u6211\u4eec\u8d70\u5b58\u50a8\u5f55\u5236\u6d88\u606f\u7684\u903b\u8f91\u3002 \u5176\u5b9ereadRecord\u5c31\u662f\u5f80\u5f55\u5236\u5217\u8868\u91cc\u9762 \u63d2\u5165\u6570\u636e \u3002 Redis\u90e8\u5206 @staticmethod @awaitable def get_address_record ( address : str ): \"\"\" \u83b7\u53d6ip\u662f\u5426\u5df2\u7ecf\u5f00\u542f\u5f55\u5236 :param address: :return: \"\"\" key = RedisHelper . get_key ( f \"record:ip: { address } \" ) return RedisHelper . pity_redis_client . get ( key ) @staticmethod @awaitable def cache_record ( address : str , request ): \"\"\" :param address: :param request: :return: \"\"\" key = RedisHelper . get_key ( f \"record: { address } :requests\" ) RedisHelper . pity_redis_client . rpush ( key , request ) ttl = RedisHelper . pity_redis_client . ttl ( key ) if ttl < 0 : RedisHelper . pity_redis_client . expire ( key , 3600 ) @staticmethod @awaitable def set_address_record ( user_id : int , address : str , regex : str ): \"\"\" \u8bbe\u7f6e\u5f55\u5236\u72b6\u6001 :param user_id: :param address: :param regex: \u5f55\u5236\u7684url\u6b63\u5219 :return: \"\"\" # \u9ed8\u8ba4\u5f55\u52361\u5c0f\u65f6 value = json . dumps ({ \"user_id\" : user_id , \"regex\" : regex }, ensure_ascii = False ) RedisHelper . pity_redis_client . set ( RedisHelper . get_key ( f \"record:ip: { address } \" ), value , ex = 3600 ) # \u6e05\u695a\u4e0a\u6b21\u5f55\u5236\u6570\u636e RedisHelper . pity_redis_client . delete ( RedisHelper . get_key ( f \"record: { address } :requests\" )) @staticmethod @awaitable def remove_address_record ( address : str ): \"\"\" \u505c\u6b62\u5f55\u5236\u4efb\u52a1 :param address: :return: \"\"\" return RedisHelper . pity_redis_client . delete ( RedisHelper . get_key ( f \"record:ip: { address } \" )) \u4e3b\u8981\u7531\u8fd94\u4e2a\u65b9\u6cd5\u7ec4\u6210: \u83b7\u53d6\u8be5ip\u5f55\u5236\u7684\u72b6\u6001\uff0c\u662f\u5f00\u542f\u8fd8\u662f\u5173\u95ed \u7f13\u5b58\u5f55\u5236\u7ed3\u679c\uff08\u4e0a\u4e00\u8282\u5df2\u7ecf\u4ecb\u7ecd\u8fc7\uff09 \u8bbe\u7f6e\u5f55\u5236\u72b6\u6001\uff0c1\u5c0f\u65f6\u540e\u8fc7\u671f\uff0c\u4e5f\u5c31\u8d34\u5408\u4e4b\u524d\u8bf4\u7684\uff0c1\u5c0f\u65f6\u540e\u4efb\u52a1\u81ea\u52a8\u505c\u6b62 \u5173\u95ed\u5f55\u5236\uff0c\u76f4\u63a5\u5220\u9664key\uff0c\u63d0\u524d\u505c\u6b62\u5f55\u5236 \u6240\u4ee5\u5bf9\u5e94\u9875\u9762\u4e0a\u6211\u4eec\u4f1a\u6709 \u5f00\u59cb\u5f55\u5236 \uff0c \u505c\u6b62\u5f55\u5236 \u7b49\u64cd\u4f5c\u6309\u94ae\u3002 HTTP\u8bf7\u6c42\u89e3\u6790 \u8fd9\u5757\u5185\u5bb9\u5176\u5b9e\u4e0d\u96be\uff0c\u5c31\u662f\u6574\u5408mitmproxy\u7684flow\u5bf9\u8c61\u91cc\u9762\u6709\u7684\u8ddfhttp\u8bf7\u6c42\u76f8\u5173\u7684\u5185\u5bb9\uff0c\u6211\u8fd9\u91cc\u53ea\u9009\u53d6\u4e86\u4e00\u4e9b\u7528\u5f97\u5230\u7684\u90e8\u5206\uff0c\u6bd4\u5982headers/body/cookies\u7b49\u7b49\u3002 __author__ = \"woody\" import json from typing import TypeVar import pydantic from loguru import logger \"\"\" translate mitmproxy request and response data \"\"\" body = TypeVar ( \"body\" , bytes , str ) class RequestInfo ( pydantic . BaseModel ): url : str = None body : body = None request_method : str = None request_data : str = None request_headers : str = None response_headers : str = None cookies : str = None request_cookies : dict = None response_content : str = None status_code : int = None def __init__ ( self , flow ): super () . __init__ () self . status_code = flow . response . status_code self . url = flow . request . url self . request_method = flow . request . method self . request_headers = json . dumps ( dict ( flow . request . headers ), indent = 4 , ensure_ascii = False ) self . response_headers = json . dumps ( dict ( flow . response . headers ), indent = 4 , ensure_ascii = False ) self . response_content = self . get_response ( flow . response ) self . body = self . get_body ( flow . request ) self . cookies = json . dumps ( dict ( flow . response . cookies ), indent = 4 , ensure_ascii = False ) self . request_cookies = dict ( flow . request . cookies ) @classmethod def translate_json ( cls , text ): try : return json . dumps ( json . loads ( text ), indent = 4 , ensure_ascii = False ) except Exception as e : logger . bind ( name = None ) . warning ( f \"\u89e3\u6790json\u683c\u5f0f\u8bf7\u6c42\u5931\u8d25: { e } \" ) return text @classmethod def get_response ( cls , response ): content_type = response . headers . get ( \"Content-Type\" ) if \"json\" in content_type . lower (): return cls . translate_json ( response . text ) if \"text\" in content_type . lower () or \"xml\" in content_type . lower (): return response . text return response . data . decode ( 'utf-8' ) @classmethod def get_body ( cls , request ): if len ( request . content ) == 0 : return None content_type = request . headers . get ( \"Content-Type\" ) if \"json\" in content_type . lower (): return cls . translate_json ( request . text ) if \"text\" in content_type . lower () or \"xml\" in content_type . lower (): return request . text return request . data . decode ( 'utf-8' ) def dumps ( self ): return json . dumps ( self . dict (), ensure_ascii = False ) \u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0cdumps\u65b9\u6cd5\uff0c\u662f\u56e0\u4e3a\u6211\u4eec\u628arequestInfo\u5bf9\u8c61\u5b58\u5165redis\u7684\u65f6\u5019\u9700\u8981\u5e8f\u5217\u5316\uff0c\u56e0\u4e3aredis\u4e0d\u5141\u8bb8\u5b58\u5165Python\u6570\u636e\uff0c\u9700\u8981\u8f6c\u6362\u4e3abytes\u6216\u8005str\u3002 main.py\u5f00\u542fproxy \u6700\u540e\u6839\u636eproxy\u7684\u5f00\u5173\u5224\u65ad\uff0c\u662f\u5426\u5f00\u542f\u914d\u7f6e\uff0c\u7531\u4e8eproxy\u4e5f\u662f\u4e00\u4e2a\u670d\u52a1\uff0c\u6211\u4eec\u5355\u72ec\u7528\u4e00\u4e2a\u7ebf\u7a0b\u542f\u52a8\u5b83\uff08create_task,\u5e76\u4e14\u4e0d\u7b49\u5f85) \u524d\u7aef\u90e8\u5206 \u5176\u5b9e\u6bd4\u8f83\u5e72\u71e5\uff0c\u5c31\u662f\u4e00\u4e2a\u5f88\u7b80\u5355\u7684 \u8868\u683c \uff0c\u52a0\u4e0a\u5bf9\u5e94\u7684url\u8f93\u5165\u6846\u548c\u5177\u4f53\u7684\u6309\u94ae: \u540e\u7eed\u6211\u4eec\u9700\u8981\u80fd\u591f \u52fe\u9009 \u5f55\u5236\u5230\u7684\u8bf7\u6c42\uff0c\u5e76\u4e14\u505a\u4e00\u4e9b\u667a\u80fd\u64cd\u4f5c\uff0c\u81ea\u52a8\u63d0\u53d6\u91cc\u9762\u7684\u53c2\u6570\u6570\u636e\uff0c\u6700\u540e\u5b8c\u6210\u7528\u4f8b\u7684\u751f\u6210\u64cd\u4f5c\u3002 \u5176\u4e2d\u667a\u80fd\u63d0\u53d6\u53c2\u6570\u662f\u6bd4\u8f83\u901a\u7528\u7684\uff0c\u9700\u8981\u517c\u5bb9\u5176\u4ed6\u6bd4\u5982har\u6587\u4ef6\u683c\u5f0f\u7684\u6570\u636e\uff0c\u6700\u540e\u600e\u4e48\u5bfc\u5165\u5230pity\u6210\u4e3apity\u7684\u4e00\u5458\uff0c\u8fd9\u4e2a\u7b14\u8005\u8fd8\u5728\u7b79\u5212\u3002 \u4eca\u5929\u7684\u5185\u5bb9\u5c31\u5230\u8fd9\u91cc\u4e86\uff0c\u611f\u8c22\u5927\u5bb6\u7684\u6536\u770b\uff0c\u518d\u4f1a~","title":"133.\u7528\u4f8b\u751f\u6210\u4e4b\u5f55\u5236\u63a5\u53e3\u8bf7\u6c42(\u4e0b)"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28133%29%20%E7%94%A8%E4%BE%8B%E7%94%9F%E6%88%90%E4%B9%8B%E5%BD%95%E5%88%B6%E6%8E%A5%E5%8F%A3%E8%AF%B7%E6%B1%82%28%E4%B8%8B%29/#_1","text":"\u4e0a\u4e00\u8282\u6211\u4eec\u8bb2\u8ff0\u4e86 \u7528\u4f8b\u5f55\u5236 \u76f8\u5173\u5185\u5bb9\uff0c\u4f46\u662f\u6709\u4e00\u4e9bwebsocket\u7684\u6539\u9020\u548chttp\u8bf7\u6c42\u7ed3\u679c\u7684\u8f6c\u6362\u6ca1\u6709\u8bb2\uff0c\u8fd9\u4e00\u8282\u6211\u4eec\u5c31\u6765\u5b8c\u6210\u4ed6\u4eec\u3002","title":"\u56de\u987e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28133%29%20%E7%94%A8%E4%BE%8B%E7%94%9F%E6%88%90%E4%B9%8B%E5%BD%95%E5%88%B6%E6%8E%A5%E5%8F%A3%E8%AF%B7%E6%B1%82%28%E4%B8%8B%29/#websocket","text":"websocket\u6539\u9020\u5206\u4e3a2\u90e8\u5206: \u540e\u7aef\u90e8\u5206\u8981\u652f\u6301\u53d1\u9001\u5f55\u5236\u597d\u7684http\u8bf7\u6c42\u6570\u636e\uff0c\u5176\u5b9e\u4e5f\u5c31\u662fjson\u6570\u636e\uff0c\u4e4b\u524d\u5df2\u7ecf\u652f\u6301\uff0c\u6211\u4eec\u7a0d\u5fae\u6539\u52a8\u4e0b\u5373\u53ef \u524d\u7aef\u90e8\u5206\u9700\u8981\u76d1\u542c\u65b0\u7684\u7c7b\u578b\uff0c\u6536\u5230\u540e\u7aef\u53d1\u6765\u7684\u6d88\u606f\uff0c\u6839\u636e\u6d88\u606ftype\u505a\u51fa\u4e0d\u540c\u7684\u64cd\u4f5c \u5148\u6765\u770b\u540e\u7aef\u90e8\u5206: \u5176\u5b9e\u6211\u4eec\u53ea\u9700\u8981\u5728websocketManager\u52a0\u5165send_data\u65b9\u6cd5\u5373\u53ef\uff0c\u4e5f\u5c31\u662f\u80fd\u81ea\u7531\u5730\u6839\u636e\u7528\u6237id\u53d1\u9001\u6d88\u606f\u3002 \u518d\u6765\u770b\u770b\u524d\u7aef\u90e8\u5206: \u7a0d\u5fae\u6709\u70b9\u53d8\u5316\uff0c\u6839\u636etype\u4e3a2\uff0c\u5224\u65ad\u662f \u5f55\u5236\u6210\u529f \u7684\u6d88\u606f\uff0c\u6211\u4eec\u8d70\u5b58\u50a8\u5f55\u5236\u6d88\u606f\u7684\u903b\u8f91\u3002 \u5176\u5b9ereadRecord\u5c31\u662f\u5f80\u5f55\u5236\u5217\u8868\u91cc\u9762 \u63d2\u5165\u6570\u636e \u3002","title":"Websocket\u6539\u9020"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28133%29%20%E7%94%A8%E4%BE%8B%E7%94%9F%E6%88%90%E4%B9%8B%E5%BD%95%E5%88%B6%E6%8E%A5%E5%8F%A3%E8%AF%B7%E6%B1%82%28%E4%B8%8B%29/#redis","text":"@staticmethod @awaitable def get_address_record ( address : str ): \"\"\" \u83b7\u53d6ip\u662f\u5426\u5df2\u7ecf\u5f00\u542f\u5f55\u5236 :param address: :return: \"\"\" key = RedisHelper . get_key ( f \"record:ip: { address } \" ) return RedisHelper . pity_redis_client . get ( key ) @staticmethod @awaitable def cache_record ( address : str , request ): \"\"\" :param address: :param request: :return: \"\"\" key = RedisHelper . get_key ( f \"record: { address } :requests\" ) RedisHelper . pity_redis_client . rpush ( key , request ) ttl = RedisHelper . pity_redis_client . ttl ( key ) if ttl < 0 : RedisHelper . pity_redis_client . expire ( key , 3600 ) @staticmethod @awaitable def set_address_record ( user_id : int , address : str , regex : str ): \"\"\" \u8bbe\u7f6e\u5f55\u5236\u72b6\u6001 :param user_id: :param address: :param regex: \u5f55\u5236\u7684url\u6b63\u5219 :return: \"\"\" # \u9ed8\u8ba4\u5f55\u52361\u5c0f\u65f6 value = json . dumps ({ \"user_id\" : user_id , \"regex\" : regex }, ensure_ascii = False ) RedisHelper . pity_redis_client . set ( RedisHelper . get_key ( f \"record:ip: { address } \" ), value , ex = 3600 ) # \u6e05\u695a\u4e0a\u6b21\u5f55\u5236\u6570\u636e RedisHelper . pity_redis_client . delete ( RedisHelper . get_key ( f \"record: { address } :requests\" )) @staticmethod @awaitable def remove_address_record ( address : str ): \"\"\" \u505c\u6b62\u5f55\u5236\u4efb\u52a1 :param address: :return: \"\"\" return RedisHelper . pity_redis_client . delete ( RedisHelper . get_key ( f \"record:ip: { address } \" )) \u4e3b\u8981\u7531\u8fd94\u4e2a\u65b9\u6cd5\u7ec4\u6210: \u83b7\u53d6\u8be5ip\u5f55\u5236\u7684\u72b6\u6001\uff0c\u662f\u5f00\u542f\u8fd8\u662f\u5173\u95ed \u7f13\u5b58\u5f55\u5236\u7ed3\u679c\uff08\u4e0a\u4e00\u8282\u5df2\u7ecf\u4ecb\u7ecd\u8fc7\uff09 \u8bbe\u7f6e\u5f55\u5236\u72b6\u6001\uff0c1\u5c0f\u65f6\u540e\u8fc7\u671f\uff0c\u4e5f\u5c31\u8d34\u5408\u4e4b\u524d\u8bf4\u7684\uff0c1\u5c0f\u65f6\u540e\u4efb\u52a1\u81ea\u52a8\u505c\u6b62 \u5173\u95ed\u5f55\u5236\uff0c\u76f4\u63a5\u5220\u9664key\uff0c\u63d0\u524d\u505c\u6b62\u5f55\u5236 \u6240\u4ee5\u5bf9\u5e94\u9875\u9762\u4e0a\u6211\u4eec\u4f1a\u6709 \u5f00\u59cb\u5f55\u5236 \uff0c \u505c\u6b62\u5f55\u5236 \u7b49\u64cd\u4f5c\u6309\u94ae\u3002","title":"Redis\u90e8\u5206"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28133%29%20%E7%94%A8%E4%BE%8B%E7%94%9F%E6%88%90%E4%B9%8B%E5%BD%95%E5%88%B6%E6%8E%A5%E5%8F%A3%E8%AF%B7%E6%B1%82%28%E4%B8%8B%29/#http","text":"\u8fd9\u5757\u5185\u5bb9\u5176\u5b9e\u4e0d\u96be\uff0c\u5c31\u662f\u6574\u5408mitmproxy\u7684flow\u5bf9\u8c61\u91cc\u9762\u6709\u7684\u8ddfhttp\u8bf7\u6c42\u76f8\u5173\u7684\u5185\u5bb9\uff0c\u6211\u8fd9\u91cc\u53ea\u9009\u53d6\u4e86\u4e00\u4e9b\u7528\u5f97\u5230\u7684\u90e8\u5206\uff0c\u6bd4\u5982headers/body/cookies\u7b49\u7b49\u3002 __author__ = \"woody\" import json from typing import TypeVar import pydantic from loguru import logger \"\"\" translate mitmproxy request and response data \"\"\" body = TypeVar ( \"body\" , bytes , str ) class RequestInfo ( pydantic . BaseModel ): url : str = None body : body = None request_method : str = None request_data : str = None request_headers : str = None response_headers : str = None cookies : str = None request_cookies : dict = None response_content : str = None status_code : int = None def __init__ ( self , flow ): super () . __init__ () self . status_code = flow . response . status_code self . url = flow . request . url self . request_method = flow . request . method self . request_headers = json . dumps ( dict ( flow . request . headers ), indent = 4 , ensure_ascii = False ) self . response_headers = json . dumps ( dict ( flow . response . headers ), indent = 4 , ensure_ascii = False ) self . response_content = self . get_response ( flow . response ) self . body = self . get_body ( flow . request ) self . cookies = json . dumps ( dict ( flow . response . cookies ), indent = 4 , ensure_ascii = False ) self . request_cookies = dict ( flow . request . cookies ) @classmethod def translate_json ( cls , text ): try : return json . dumps ( json . loads ( text ), indent = 4 , ensure_ascii = False ) except Exception as e : logger . bind ( name = None ) . warning ( f \"\u89e3\u6790json\u683c\u5f0f\u8bf7\u6c42\u5931\u8d25: { e } \" ) return text @classmethod def get_response ( cls , response ): content_type = response . headers . get ( \"Content-Type\" ) if \"json\" in content_type . lower (): return cls . translate_json ( response . text ) if \"text\" in content_type . lower () or \"xml\" in content_type . lower (): return response . text return response . data . decode ( 'utf-8' ) @classmethod def get_body ( cls , request ): if len ( request . content ) == 0 : return None content_type = request . headers . get ( \"Content-Type\" ) if \"json\" in content_type . lower (): return cls . translate_json ( request . text ) if \"text\" in content_type . lower () or \"xml\" in content_type . lower (): return request . text return request . data . decode ( 'utf-8' ) def dumps ( self ): return json . dumps ( self . dict (), ensure_ascii = False ) \u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0cdumps\u65b9\u6cd5\uff0c\u662f\u56e0\u4e3a\u6211\u4eec\u628arequestInfo\u5bf9\u8c61\u5b58\u5165redis\u7684\u65f6\u5019\u9700\u8981\u5e8f\u5217\u5316\uff0c\u56e0\u4e3aredis\u4e0d\u5141\u8bb8\u5b58\u5165Python\u6570\u636e\uff0c\u9700\u8981\u8f6c\u6362\u4e3abytes\u6216\u8005str\u3002","title":"HTTP\u8bf7\u6c42\u89e3\u6790"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28133%29%20%E7%94%A8%E4%BE%8B%E7%94%9F%E6%88%90%E4%B9%8B%E5%BD%95%E5%88%B6%E6%8E%A5%E5%8F%A3%E8%AF%B7%E6%B1%82%28%E4%B8%8B%29/#mainpyproxy","text":"\u6700\u540e\u6839\u636eproxy\u7684\u5f00\u5173\u5224\u65ad\uff0c\u662f\u5426\u5f00\u542f\u914d\u7f6e\uff0c\u7531\u4e8eproxy\u4e5f\u662f\u4e00\u4e2a\u670d\u52a1\uff0c\u6211\u4eec\u5355\u72ec\u7528\u4e00\u4e2a\u7ebf\u7a0b\u542f\u52a8\u5b83\uff08create_task,\u5e76\u4e14\u4e0d\u7b49\u5f85)","title":"main.py\u5f00\u542fproxy"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28133%29%20%E7%94%A8%E4%BE%8B%E7%94%9F%E6%88%90%E4%B9%8B%E5%BD%95%E5%88%B6%E6%8E%A5%E5%8F%A3%E8%AF%B7%E6%B1%82%28%E4%B8%8B%29/#_2","text":"\u5176\u5b9e\u6bd4\u8f83\u5e72\u71e5\uff0c\u5c31\u662f\u4e00\u4e2a\u5f88\u7b80\u5355\u7684 \u8868\u683c \uff0c\u52a0\u4e0a\u5bf9\u5e94\u7684url\u8f93\u5165\u6846\u548c\u5177\u4f53\u7684\u6309\u94ae: \u540e\u7eed\u6211\u4eec\u9700\u8981\u80fd\u591f \u52fe\u9009 \u5f55\u5236\u5230\u7684\u8bf7\u6c42\uff0c\u5e76\u4e14\u505a\u4e00\u4e9b\u667a\u80fd\u64cd\u4f5c\uff0c\u81ea\u52a8\u63d0\u53d6\u91cc\u9762\u7684\u53c2\u6570\u6570\u636e\uff0c\u6700\u540e\u5b8c\u6210\u7528\u4f8b\u7684\u751f\u6210\u64cd\u4f5c\u3002 \u5176\u4e2d\u667a\u80fd\u63d0\u53d6\u53c2\u6570\u662f\u6bd4\u8f83\u901a\u7528\u7684\uff0c\u9700\u8981\u517c\u5bb9\u5176\u4ed6\u6bd4\u5982har\u6587\u4ef6\u683c\u5f0f\u7684\u6570\u636e\uff0c\u6700\u540e\u600e\u4e48\u5bfc\u5165\u5230pity\u6210\u4e3apity\u7684\u4e00\u5458\uff0c\u8fd9\u4e2a\u7b14\u8005\u8fd8\u5728\u7b79\u5212\u3002 \u4eca\u5929\u7684\u5185\u5bb9\u5c31\u5230\u8fd9\u91cc\u4e86\uff0c\u611f\u8c22\u5927\u5bb6\u7684\u6536\u770b\uff0c\u518d\u4f1a~","title":"\u524d\u7aef\u90e8\u5206"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28134%29%20%E6%96%AD%E8%A8%80%E6%8A%A5%E9%94%99%E6%94%AF%E6%8C%81JSONPath%E6%98%BE%E7%A4%BA/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u6210\u529f \u5f55\u5236 \u4e86\u63a5\u53e3\u8bf7\u6c42\uff0c\u4fd7\u8bdd\u8bf4: \u6e29\u6545\u800c\u77e5\u65b0 \u3002\u8fd8\u8bb0\u5f97\u6211\u4eec\u4e4b\u524d\u7528JSONPath\u91cd\u6784\u8fc7\u6211\u4eec\u7684 \u51fa\u53c2\u6570\u636e \u5417\uff1f \u6ca1\u9519\uff0c\u6211\u4eec\u4eca\u5929\u8981\u7ee7\u7eed\u628aJSONPath\u53d1\u6325\u5230\u9879\u76ee\u4e2d. \u65ad\u8a00\u4e2d\u7684\u8def\u5f84 \u5728\u63a5\u53e3\u6d4b\u8bd5\u4e2d\uff0c\u65ad\u8a00\u7ecf\u5e38\u9700\u8981\u5c55\u793aJSON\u7684\u5177\u4f53\u8282\u70b9(\u65ad\u8a00\u4e3a\u4ec0\u4e48\u4e0d\u4e00\u81f4\uff0c\u6240\u4ee5\u9700\u8981\u5c55\u793a\u5b8c\u6574\u8def\u5f84)\uff0c\u6765\u770b\u770b\u6211\u4eec\u76ee\u524d\u662f\u600e\u4e48\u505a\u7684: \u53ef\u4ee5\u770b\u5230\uff0c\u65ad\u8a00\u6548\u679c \u4e00\u584c\u7cca\u6d82 \uff0c /0 \u8fd9\u79cd\u663e\u793a\u65b9\u5f0f\uff0c\u548c\u6211\u4eec\u4e4b\u524d\u7684 \u53d6\u53c2 / JSONPath \u683c\u683c\u4e0d\u5165\uff0c\u90a3\u5982\u679c\u662f\u8fd9\u6837\u7684\u5f62\u5f0f\u5462? $ [ 0 ] \u5728\u9884\u671f\u7ed3\u679c\u4e2d\u4e0d\u5b58\u5728 \u274c \u867d\u7136\u770b\u8d77\u6765\u6ca1\u6709\u597d\u5f88\u591a\uff0c\u4f46\u662f\u5b9e\u9645\u4e0a\uff0c\u6211\u4eec\u7edf\u4e00\u4e86 \u8def\u5f84 \u663e\u793a\u6cd5\u5219\u3002\u8fd9\u4e2a\u4e3e\u52a8\u7684\u610f\u4e49\u5728pity\u4e2d\u4e0d\u4e9a\u4e8e\u79e6\u56fd\u7edf\u4e00\u5ea6\u91cf\u8861\u3002 \u6539\u9020 \u6211\u4eec\u8fdb\u5165app/utils/json_compare.py\u6587\u4ef6\uff0c\u9996\u9875\u6211\u4eec\u8981\u8c03\u6574\u5f00\u59cb\u8def\u5f84\uff0c\u4ece / \u6539\u4e3a $ \uff1a \u8fd9\u6837\u7684\u8bdd\uff0c\u8d77\u59cb\u8def\u5f84\u5c31\u6ee1\u8db3\u4e86JSONPath\u3002 \u63a5\u7740\u6211\u4eec\u5728\u6bcf\u6b21 \u65ad\u8a00\u5931\u8d25 \u540e\u90fd\u52a0\u5165\u4e00\u4e2a\u6807\u5fd7: \u3010\u274c\u3011\uff0c\u7ea2\u8272\u6bd4\u8f83\u663e\u773c\uff0c\u80fd\u4e00\u773c\u770b\u5230\u662f\u9519\u8bef\u3002 \u7c7b\u4f3c\u4e8e\u4e0a\u56fe\u8fd9\u6837\u3002 \u63a5\u7740\u6211\u4eec\u628a\u7528/\u8fde\u63a52\u4e2a\u8def\u5f84\u7684\u4ee3\u7801\uff0c\u6539\u6210 . \uff0c\u4e5f\u522b\u5fd8\u4e86\u65ad\u8a00\u5931\u8d25\u540e\u52a0\u3010\u274c\u3011\u54e6\u3002 \u800c\u6570\u7ec4\u6211\u4eec\u4e00\u822c\u5728JSONPath\u91cc\u9762\u7528[\u6570\u7ec4\u7d22\u5f15]\u8868\u793a\uff0c\u6240\u4ee5\u6211\u4eec\u628a/0\u9700\u8981\u6539\u6210[0] \u987a\u624b\uff0c\u6211\u4eec\u4e5f\u628a\u5176\u4ed6\u65ad\u8a00\u6bd4\u5982 \u7b49\u4e8e , \u4e0d\u7b49\u4e8e \u7ed9\u6539\u6539\uff08\u5728\u672b\u5c3e\u52a0\u6807\u8bc6\uff09 \u6765\u770b\u770b\u6700\u540e\u7684\u6548\u679c\u56fe \u5148\u4e0d\u8c08\u8bba\u6548\u679c\u662f\u5426\u6bd4\u4e4b\u524d\u597d\uff0c\u8fd8\u662f\u90a3\u53e5\u8bdd\uff0c\u8fd9\u662f\u5f88\u6709\u610f\u4e49\u7684\u4e00\u4ef6\u4e8b\u3002 \u4e3aMock\u914d\u7f6eHTTP\u4ee3\u7406 \u6211\u4eec\u77e5\u9053\uff0c\u540e\u7eed\u5982\u679c\u8981\u505aMock\u529f\u80fd\u7684\u8bdd\uff0c\u5c31\u9700\u8981\u7ecf\u8fc7\u4e00\u5c42mitmproxy \u4ee3\u7406 \u3002\u6240\u4ee5\u6211\u4eec\u9700\u8981\u6539\u9020\u6211\u4eec\u7684http\u5ba2\u6237\u7aef: \u6211\u4eec\u9996\u5148\u6839\u636e\u662f\u5426\u5f00\u542f\u4e86Mock\u8bbe\u7f6e\u4ee3\u7406\u7684\u5730\u5740\uff0c\u63a5\u7740\u5728request\u7684\u65f6\u5019\u5e26\u5165\u8fd9\u4e2aproxy\u53c2\u6570\u5373\u53ef\u3002 \u8fd9\u4e2a\u6548\u679c\u5c31\u548c\u6211\u4eecwindows\u673a\u5668\u5f00\u542f\u4ee3\u7406\uff0caiohttp\u7684http\u8bf7\u6c42\u90fd\u4f1a\u7ecf\u5e38\u8fd9\u5c42\u4ee3\u7406\uff0c\u4e5f\u5c31\u80fd\u4e3amock\u505a\u94fa\u57ab\u4e86~ \u4eca\u5929\u7684\u5185\u5bb9\u5c31\u4ecb\u7ecd\u5230\u8fd9\u91cc\uff0c\u4e0b\u4e00\u8282\u6211\u4eec\u6765\u7f16\u5199har\u8f6cpity\u7528\u4f8b\u76f8\u5173\u90e8\u5206\uff0c\u6211\u4eec\u4f1a\u52062\u6b65\uff0c\u5148\u5c06har\u8f6c\u6362\u4e3aRequestInfo\u6570\u7ec4\uff0c\u540e\u9762\u5c31\u662f\u901a\u7528\u7684\u90e8\u5206\uff1a \u5c06\u4e00\u7ec4RequestInfo\u8f6c\u4e3apity\u7528\u4f8b\uff08\u8fd9\u5757\u4f1a\u590d\u6742\u4e00\u4e9b\uff09\uff0c\u52a0\u6cb9~","title":"134.\u65ad\u8a00\u62a5\u9519\u652f\u6301JSONPath\u663e\u793a"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28134%29%20%E6%96%AD%E8%A8%80%E6%8A%A5%E9%94%99%E6%94%AF%E6%8C%81JSONPath%E6%98%BE%E7%A4%BA/#_1","text":"\u4e0a\u4e00\u8282\u6211\u4eec\u6210\u529f \u5f55\u5236 \u4e86\u63a5\u53e3\u8bf7\u6c42\uff0c\u4fd7\u8bdd\u8bf4: \u6e29\u6545\u800c\u77e5\u65b0 \u3002\u8fd8\u8bb0\u5f97\u6211\u4eec\u4e4b\u524d\u7528JSONPath\u91cd\u6784\u8fc7\u6211\u4eec\u7684 \u51fa\u53c2\u6570\u636e \u5417\uff1f \u6ca1\u9519\uff0c\u6211\u4eec\u4eca\u5929\u8981\u7ee7\u7eed\u628aJSONPath\u53d1\u6325\u5230\u9879\u76ee\u4e2d.","title":"\u56de\u987e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28134%29%20%E6%96%AD%E8%A8%80%E6%8A%A5%E9%94%99%E6%94%AF%E6%8C%81JSONPath%E6%98%BE%E7%A4%BA/#_2","text":"\u5728\u63a5\u53e3\u6d4b\u8bd5\u4e2d\uff0c\u65ad\u8a00\u7ecf\u5e38\u9700\u8981\u5c55\u793aJSON\u7684\u5177\u4f53\u8282\u70b9(\u65ad\u8a00\u4e3a\u4ec0\u4e48\u4e0d\u4e00\u81f4\uff0c\u6240\u4ee5\u9700\u8981\u5c55\u793a\u5b8c\u6574\u8def\u5f84)\uff0c\u6765\u770b\u770b\u6211\u4eec\u76ee\u524d\u662f\u600e\u4e48\u505a\u7684: \u53ef\u4ee5\u770b\u5230\uff0c\u65ad\u8a00\u6548\u679c \u4e00\u584c\u7cca\u6d82 \uff0c /0 \u8fd9\u79cd\u663e\u793a\u65b9\u5f0f\uff0c\u548c\u6211\u4eec\u4e4b\u524d\u7684 \u53d6\u53c2 / JSONPath \u683c\u683c\u4e0d\u5165\uff0c\u90a3\u5982\u679c\u662f\u8fd9\u6837\u7684\u5f62\u5f0f\u5462? $ [ 0 ] \u5728\u9884\u671f\u7ed3\u679c\u4e2d\u4e0d\u5b58\u5728 \u274c \u867d\u7136\u770b\u8d77\u6765\u6ca1\u6709\u597d\u5f88\u591a\uff0c\u4f46\u662f\u5b9e\u9645\u4e0a\uff0c\u6211\u4eec\u7edf\u4e00\u4e86 \u8def\u5f84 \u663e\u793a\u6cd5\u5219\u3002\u8fd9\u4e2a\u4e3e\u52a8\u7684\u610f\u4e49\u5728pity\u4e2d\u4e0d\u4e9a\u4e8e\u79e6\u56fd\u7edf\u4e00\u5ea6\u91cf\u8861\u3002","title":"\u65ad\u8a00\u4e2d\u7684\u8def\u5f84"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28134%29%20%E6%96%AD%E8%A8%80%E6%8A%A5%E9%94%99%E6%94%AF%E6%8C%81JSONPath%E6%98%BE%E7%A4%BA/#_3","text":"\u6211\u4eec\u8fdb\u5165app/utils/json_compare.py\u6587\u4ef6\uff0c\u9996\u9875\u6211\u4eec\u8981\u8c03\u6574\u5f00\u59cb\u8def\u5f84\uff0c\u4ece / \u6539\u4e3a $ \uff1a \u8fd9\u6837\u7684\u8bdd\uff0c\u8d77\u59cb\u8def\u5f84\u5c31\u6ee1\u8db3\u4e86JSONPath\u3002 \u63a5\u7740\u6211\u4eec\u5728\u6bcf\u6b21 \u65ad\u8a00\u5931\u8d25 \u540e\u90fd\u52a0\u5165\u4e00\u4e2a\u6807\u5fd7: \u3010\u274c\u3011\uff0c\u7ea2\u8272\u6bd4\u8f83\u663e\u773c\uff0c\u80fd\u4e00\u773c\u770b\u5230\u662f\u9519\u8bef\u3002 \u7c7b\u4f3c\u4e8e\u4e0a\u56fe\u8fd9\u6837\u3002 \u63a5\u7740\u6211\u4eec\u628a\u7528/\u8fde\u63a52\u4e2a\u8def\u5f84\u7684\u4ee3\u7801\uff0c\u6539\u6210 . \uff0c\u4e5f\u522b\u5fd8\u4e86\u65ad\u8a00\u5931\u8d25\u540e\u52a0\u3010\u274c\u3011\u54e6\u3002 \u800c\u6570\u7ec4\u6211\u4eec\u4e00\u822c\u5728JSONPath\u91cc\u9762\u7528[\u6570\u7ec4\u7d22\u5f15]\u8868\u793a\uff0c\u6240\u4ee5\u6211\u4eec\u628a/0\u9700\u8981\u6539\u6210[0] \u987a\u624b\uff0c\u6211\u4eec\u4e5f\u628a\u5176\u4ed6\u65ad\u8a00\u6bd4\u5982 \u7b49\u4e8e , \u4e0d\u7b49\u4e8e \u7ed9\u6539\u6539\uff08\u5728\u672b\u5c3e\u52a0\u6807\u8bc6\uff09","title":"\u6539\u9020"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28134%29%20%E6%96%AD%E8%A8%80%E6%8A%A5%E9%94%99%E6%94%AF%E6%8C%81JSONPath%E6%98%BE%E7%A4%BA/#_4","text":"\u5148\u4e0d\u8c08\u8bba\u6548\u679c\u662f\u5426\u6bd4\u4e4b\u524d\u597d\uff0c\u8fd8\u662f\u90a3\u53e5\u8bdd\uff0c\u8fd9\u662f\u5f88\u6709\u610f\u4e49\u7684\u4e00\u4ef6\u4e8b\u3002","title":"\u6765\u770b\u770b\u6700\u540e\u7684\u6548\u679c\u56fe"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28134%29%20%E6%96%AD%E8%A8%80%E6%8A%A5%E9%94%99%E6%94%AF%E6%8C%81JSONPath%E6%98%BE%E7%A4%BA/#mockhttp","text":"\u6211\u4eec\u77e5\u9053\uff0c\u540e\u7eed\u5982\u679c\u8981\u505aMock\u529f\u80fd\u7684\u8bdd\uff0c\u5c31\u9700\u8981\u7ecf\u8fc7\u4e00\u5c42mitmproxy \u4ee3\u7406 \u3002\u6240\u4ee5\u6211\u4eec\u9700\u8981\u6539\u9020\u6211\u4eec\u7684http\u5ba2\u6237\u7aef: \u6211\u4eec\u9996\u5148\u6839\u636e\u662f\u5426\u5f00\u542f\u4e86Mock\u8bbe\u7f6e\u4ee3\u7406\u7684\u5730\u5740\uff0c\u63a5\u7740\u5728request\u7684\u65f6\u5019\u5e26\u5165\u8fd9\u4e2aproxy\u53c2\u6570\u5373\u53ef\u3002 \u8fd9\u4e2a\u6548\u679c\u5c31\u548c\u6211\u4eecwindows\u673a\u5668\u5f00\u542f\u4ee3\u7406\uff0caiohttp\u7684http\u8bf7\u6c42\u90fd\u4f1a\u7ecf\u5e38\u8fd9\u5c42\u4ee3\u7406\uff0c\u4e5f\u5c31\u80fd\u4e3amock\u505a\u94fa\u57ab\u4e86~ \u4eca\u5929\u7684\u5185\u5bb9\u5c31\u4ecb\u7ecd\u5230\u8fd9\u91cc\uff0c\u4e0b\u4e00\u8282\u6211\u4eec\u6765\u7f16\u5199har\u8f6cpity\u7528\u4f8b\u76f8\u5173\u90e8\u5206\uff0c\u6211\u4eec\u4f1a\u52062\u6b65\uff0c\u5148\u5c06har\u8f6c\u6362\u4e3aRequestInfo\u6570\u7ec4\uff0c\u540e\u9762\u5c31\u662f\u901a\u7528\u7684\u90e8\u5206\uff1a \u5c06\u4e00\u7ec4RequestInfo\u8f6c\u4e3apity\u7528\u4f8b\uff08\u8fd9\u5757\u4f1a\u590d\u6742\u4e00\u4e9b\uff09\uff0c\u52a0\u6cb9~","title":"\u4e3aMock\u914d\u7f6eHTTP\u4ee3\u7406"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28135%29%20har%E6%96%87%E4%BB%B6%E8%BD%AC%E4%B8%BARequestInfo/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u5c0f\u5c0f\u5730\u6539\u9020\u4e86\u4e00\u4e0b \u65ad\u8a00\u6a21\u5757 \uff0c\u4f7f\u5f97JSONPath\u80fd\u591f\u66f4\u6df1\u5165pity\u5fc3\u3002\u8fd9\u4e00\u8282\u6211\u4eec\u5c31\u6765\u804a\u804ahar\u6587\u4ef6\u8f6cpity\u7528\u4f8b\u7684\u4e0a\u534a\u90e8\u5206\uff1ahar\u8f6cRequestInfo Har\u6587\u4ef6\u5206\u6790 har\u6587\u4ef6\uff0c\u76f8\u4fe1\u7ecf\u5e38\u7528Chrome\u6d4f\u89c8\u5668\u7684\u90fd\u77e5\u9053\uff0c\u6d4f\u89c8\u5668\u5f55\u5236\u7684\u6570\u636e\u53ef\u4ee5\u8f6c\u6362\u4e3ahar\u6587\u4ef6\uff0c\u6765\u770b\u4e0b\u9762\u4e00\u5f20\u56fe: \u4e0a\u9762\u662f\u6211\u5f55\u5236\u4e86 \u6398\u91d1 \u5e73\u53f0\u7684\u76f8\u5173\u63a5\u53e3\uff0c\u6211\u4eec\u5728\u4efb\u610f\u5904\u9f20\u6807\u53f3\u952e\uff0c\u6216\u8005\u70b9\u51fb\u8fd9\u4e2a\u4e0b\u8f7d\u6309\u94ae\uff0c\u90fd\u80fd\u591f\u628a\u8fd9\u4e9b\u8bf7\u6c42\u4fdd\u5b58\u4e3ahar\u6587\u4ef6\u3002 \u6211\u4eec\u77e5\u9053\u5199\u7528\u4f8b\u662f\u4e00\u4ef6\u5f88\u9ebb\u70e6\u7684\u4e8b\u60c5\uff0c\u5047\u8bbe\u4e00\u4e2a \u94fe\u8def \u67095\u4e2a\u63a5\u53e3\uff0c\u5047\u8bbe\u4f60\u5728\u6d4b\u8bd5\u4e00\u4e2a\u7528\u6237\u9886\u5238\u4e70\u4e1c\u897f\u7684\u6d41\u7a0b\uff0c\u4f60\u53ef\u80fd\u4f1a\u7ecf\u5386\u4ee5\u4e0b\u6b65\u9aa4: \u7528\u6237\u767b\u5f55 \u7528\u6237\u53bb\u9886\u5238\u4e2d\u5fc3\u9886\u53d6100-2\u7684\u4f18\u60e0\u5238 \u7528\u6237\u641c\u7d22\u7b26\u5408\u4f18\u60e0\u5238\u7684\u5546\u54c1\uff0c\u5e76\u5c06\u5b83\u52a0\u5165\u8d2d\u7269\u8f66 \u7528\u6237\u53bb\u8d2d\u7269\u8f66\u7ed3\u7b97\uff0c\u751f\u6210\u8ba2\u5355\uff08\u5e76\u4f7f\u7528\u6b64\u4f18\u60e0\u5238\uff09 \u7528\u6237\u652f\u4ed8 \u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u4e2a\u94fe\u8def\u5176\u5b9e\u5c31\u4e0d\u592a\u77ed\uff0c\u5982\u679c\u6211\u4eec\u5728\u4e0d\u719f\u6089\u8fd9\u51e0\u4e2a\u63a5\u53e3\u53c2\u6570\u7684\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u8981\u5bf9\u7167\u63a5\u53e3\u6587\u6863\uff0c\u53bb\u9020\u5bf9\u5e94\u7684\u53c2\u6570\uff0c\u751a\u81f3\u53ef\u80fd\u9020\u4e86\u4e00\u4f1a\u53d1\u73b0case\u8fd8\u662f\u6ca1\u8dd1\u901a\u3002 \u90a3\u5982\u679c\u4ee5\u4e0a\u573a\u666f\uff0c\u4f60\u5728 \u6d4f\u89c8\u5668\u64cd\u4f5c \u7684\u65f6\u5019\uff0c\u5c31\u80fd\u5e2e\u4f60\u6c47\u603b\u8fd9\u4e9b\u63a5\u53e3\uff0c\u5e76\u6293\u53d6\u4e0b\u6765\uff0c\u4f60\u5199\u7528\u4f8b\u7684\u65f6\u5019\u53ea\u9700\u8981\u628a \u56fa\u5b9a\u7684\u53c2\u6570 \u6bd4\u5982\u8d26\u53f7\uff0c\u5546\u54c1id\u7b49\u53c2\u6570\u5316\uff0c\u90a3\u4f1a\u4e0d\u4f1a\u975e\u5e38\u53cb\u597d\uff0c\u9ad8\u6548\uff0c\u800c\u4e14 \u94fe\u8def \u80af\u5b9a\u662f\u901a\u7684\uff0c\u56e0\u4e3a\u4f60\u5728\u6d4f\u89c8\u5668\u5df2\u7ecf\u5b8c\u6210\u8fc7\u8fd9\u6837\u7684\u6d41\u7a0b\u4e86\u3002 \u6240\u4ee5\u8fd9\u5c31\u662f\u4e3a\u4ec0\u4e48\uff0c\u6211\u4eec\u8981\u652f\u6301\u7528\u4f8b\u5f55\u5236\u7684\u539f\u56e0\uff0c\u56e0\u4e3a\u96c0\u6c0f\u65b9\u4fbf\uff0c\u96c0\u6c0f\u87c0\u554a\uff01 \u597d\u50cf\u6709\u70b9\u626f\u8fdc\u4e86\uff0c\u6211\u4eec\u7ee7\u7eed\u804a\u8fd9\u4e2ahar\u7684\u4e8b\u60c5\u3002\u603b\u4e4bhar\u5c31\u662fchrome tools\u5e2e\u6211\u4eec\u5f55\u5236\u597d\u6211\u4eec\u53d1\u51fa\u7684\u8bf7\u6c42\uff0c\u5269\u4e0b\u7684\u7b5b\u9009\uff0c\u751f\u6210\u7528\u4f8b\u5c31\u5f97\u9760\u6211\u4eec\u81ea\u5df1\u4e86\u3002 \u6765\u770b\u770bhar\u6587\u4ef6\u91cc\u9762\u7684\u5185\u5bb9\u5427: \u53ef\u4ee5\u770b\u5230\uff0c\u4ed6\u5176\u5b9e\u662f\u4e00\u4e2aJSON\u6570\u636e\uff0c\u6240\u4ee5\u6211\u4eec\u7528JSON\u5e93\u89e3\u6790\u5b83\u5c31\u597d\u4e86\u3002 XHR\u548cFetch \u867d\u7136js/css/img\u7b49\u7b49\u8bf7\u6c42\u4e5f\u7b97http\u8bf7\u6c42\uff0c\u4f46\u4e00\u822c\u6765\u8bf4\u4e0e\u670d\u52a1\u7aef\u4ea4\u4e92\u7684\u8fd8\u5f97\u662fxhr\u548cfetch\u3002fetch\u53ef\u4ee5\u7406\u89e3\u4e3a\u4e8c\u4ee3xhr\uff08ajax\uff09\u3002 \u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u83b7\u53d6\u8fd92\u79cd\u7c7b\u578b\u7684\u6570\u636e\u5373\u53ef\u3002 \u800c\u4e14\u5b83\u628arequest\u548cresponse\u7684\u6570\u636e\u90fd\u5206\u5f00\u4e86\uff0c\u6211\u4eec\u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730 \u8bfb\u53d6 \u3002 \u7f16\u5199Convetor app/core/request/convertor.py __author__ = \"woody\" from typing import List from app.core.request.request import RequestInfo \"\"\" request\u8f6c\u6362\u5668\uff0c\u652f\u6301har\u5230 \"\"\" class Convertor ( object ): @staticmethod def convert ( file , regex : str = None ) -> List [ RequestInfo ]: raise NotImplementedError \u5185\u5bb9\u5f88\u7b80\u5355\uff0c\u5e76\u4e14\u652f\u6301\u6b63\u5219\uff0c\u76ee\u7684\u662f\u4e3a\u4e86\u8fc7\u6ee4\u4e0d\u8981\u7684url\uff0c\u6216\u8005\u8bf4\u662f\u4e3a\u4e86\u7b5b\u9009\u51fa\u60f3\u8981\u7684\u63a5\u53e3\u3002 \u5f53\u7136\u8fd9\u90fd\u662f \u62bd\u8c61\u63a5\u53e3 \uff0c\u63a5\u7740\u6211\u4eec\u6765\u5199\u5177\u4f53\u7684\u5b9e\u73b0\u3002 \u7f16\u5199HarConvetor app/core/request/har_convertor.py import json import re from typing import List from app.core.request.convertor import Convertor from app.core.request.request import RequestInfo from app.excpetions.convert.ConvertException import HarConvertException class HarConvertor ( Convertor ): @staticmethod def convert ( file , regex : str = None ) -> List [ RequestInfo ]: try : with open ( file , \"r\" , encoding = \"utf-8\" ) as f : ans = [] flag = None if regex is not None : flag = re . compile ( regex ) # \u52a0\u8f7dhar\u8bf7\u6c42\u6570\u636e data = json . load ( f ) entries = data . get ( \"log\" , {}) . get ( \"entries\" ) if not entries : raise HarConvertException ( \"entries\u6570\u636e\u4e3a\u7a7a\" ) for entry in entries : # \u5982\u679c\u662ffetch\u6216xhr\u63a5\u53e3\uff0c\u8bf4\u660e\u662fhttp\u8bf7\u6c42\uff08\u6682\u4e0d\u652f\u6301js) if entry . get ( \"_resourceType\" ) . lower () in ( \"fetch\" , \"xhr\" ): info = RequestInfo () request_data = entry . get ( \"request\" ) info . url = request_data . get ( \"url\" ) if flag is not None and not re . findall ( flag , info . url ): # \u7531\u4e8e\u4e0d\u7b26\u5408\u9884\u671f\u7684url\uff0c\u6240\u4ee5\u8fc7\u6ee4\u6389 continue response_data = entry . get ( \"response\" ) info . body = HarConvertor . get_body ( request_data ) info . status_code = response_data . get ( \"status\" ) info . request_method = request_data . get ( \"method\" ) info . request_headers = HarConvertor . get_kv ( request_data ) info . response_headers = HarConvertor . get_kv ( response_data ) info . cookies = HarConvertor . get_kv ( response_data , \"cookies\" ) info . request_cookies = HarConvertor . get_kv ( request_data , \"cookies\" ) info . response_content = response_data . get ( \"content\" , {}) . get ( \"text\" ) ans . append ( info ) return ans except HarConvertException as e : raise HarConvertException ( f \"har\u6587\u4ef6\u8f6c\u6362\u5f02\u5e38: { e } \" ) except Exception as e : raise HarConvertException ( f \"har\u6587\u4ef6\u8f6c\u6362\u5931\u8d25: { e } \" ) @staticmethod def get_kv ( request_data : dict , key : str = \"headers\" ) -> dict : \"\"\" \u901a\u8fc7response/request\u83b7\u53d6header\u4fe1\u606f :param key: :param request_data: :return: \"\"\" headers = request_data . get ( key ) result = dict () for h in headers : result [ h . get ( \"name\" )] = h . get ( \"value\" ) return result @staticmethod def get_body ( request_data : dict ): data = request_data . get ( \"postData\" , {}) return data . get ( \"text\" ) if __name__ == \"__main__\" : requests = HarConvertor . convert ( \"./pity.fun.har\" , \"juejin.cn\" ) print ( requests ) \u8fd9\u91cc\u4e3b\u8981\u505a\u4e862\u4e2a\u4e8b\u60c5\uff0c\u8bfb\u53d6+\u8f6c\u6362\uff0c\u9996\u5148\u6211\u4eec\u5c06\u8bfb\u53d6\u7684har\u5229\u7528json.load\u8f6c\u4e3aPython\u6570\u636e\u3002 \u63a5\u7740\u53bb\u627e\u5230\u5bf9\u5e94\u7684\u8bf7\u6c42\u6570\u7ec4: entries, \u904d\u5386\u4e4b\u3002 \u63a5\u7740\u5c31\u662f\u62fc\u63a5\u4e3a\u6211\u4eec\u81ea\u5df1\u7684 RequestInfo \u4e86\uff0c\u5230\u8fd9\u91cc\u6211\u4eec\u7684\u8f6c\u6362\u5de5\u4f5c\u5c31\u5b8c\u6210\u4e86\uff0c\u6211\u4eec\u8fd8\u81ea\u5b9a\u4e49\u4e86HarConvertException, \u662f\u4e3a\u4e86\u66f4\u597d\u5730\u533a\u522b \u5f02\u5e38\u7c7b\u578b \u3002 \u8fd9\u6837\u8bbe\u8ba1\u7684\u597d\u5904\u662f\uff0c\u4ee5\u540e\u5982\u679c\u8981\u652f\u6301hab, hba, hxr\u5404\u79cd\u683c\u5f0f\u7684\u65f6\u5019\uff0c\u6211\u4eec\u53ea\u9700\u8981\u5b9e\u73b0convert\u65b9\u6cd5\u5373\u53ef\u3002 \u63a5\u7740\u5c31\u662f\u6211\u4eec\u6700\u91cd\u8981\u7684 \u8f6c\u6362\u73af\u8282 \u4e86\uff0c\u53ef\u80fd\u9700\u8981\u535a\u4e3b\u8d39\u70b9\u8111\u5b50\u4e86\u3002\u5927\u5bb6\u505a\u597d\u5fc3\u7406\u51c6\u5907~","title":"135.har\u6587\u4ef6\u8f6c\u4e3aRequestInfo"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28135%29%20har%E6%96%87%E4%BB%B6%E8%BD%AC%E4%B8%BARequestInfo/#_1","text":"\u4e0a\u4e00\u8282\u6211\u4eec\u5c0f\u5c0f\u5730\u6539\u9020\u4e86\u4e00\u4e0b \u65ad\u8a00\u6a21\u5757 \uff0c\u4f7f\u5f97JSONPath\u80fd\u591f\u66f4\u6df1\u5165pity\u5fc3\u3002\u8fd9\u4e00\u8282\u6211\u4eec\u5c31\u6765\u804a\u804ahar\u6587\u4ef6\u8f6cpity\u7528\u4f8b\u7684\u4e0a\u534a\u90e8\u5206\uff1ahar\u8f6cRequestInfo","title":"\u56de\u987e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28135%29%20har%E6%96%87%E4%BB%B6%E8%BD%AC%E4%B8%BARequestInfo/#har","text":"har\u6587\u4ef6\uff0c\u76f8\u4fe1\u7ecf\u5e38\u7528Chrome\u6d4f\u89c8\u5668\u7684\u90fd\u77e5\u9053\uff0c\u6d4f\u89c8\u5668\u5f55\u5236\u7684\u6570\u636e\u53ef\u4ee5\u8f6c\u6362\u4e3ahar\u6587\u4ef6\uff0c\u6765\u770b\u4e0b\u9762\u4e00\u5f20\u56fe: \u4e0a\u9762\u662f\u6211\u5f55\u5236\u4e86 \u6398\u91d1 \u5e73\u53f0\u7684\u76f8\u5173\u63a5\u53e3\uff0c\u6211\u4eec\u5728\u4efb\u610f\u5904\u9f20\u6807\u53f3\u952e\uff0c\u6216\u8005\u70b9\u51fb\u8fd9\u4e2a\u4e0b\u8f7d\u6309\u94ae\uff0c\u90fd\u80fd\u591f\u628a\u8fd9\u4e9b\u8bf7\u6c42\u4fdd\u5b58\u4e3ahar\u6587\u4ef6\u3002 \u6211\u4eec\u77e5\u9053\u5199\u7528\u4f8b\u662f\u4e00\u4ef6\u5f88\u9ebb\u70e6\u7684\u4e8b\u60c5\uff0c\u5047\u8bbe\u4e00\u4e2a \u94fe\u8def \u67095\u4e2a\u63a5\u53e3\uff0c\u5047\u8bbe\u4f60\u5728\u6d4b\u8bd5\u4e00\u4e2a\u7528\u6237\u9886\u5238\u4e70\u4e1c\u897f\u7684\u6d41\u7a0b\uff0c\u4f60\u53ef\u80fd\u4f1a\u7ecf\u5386\u4ee5\u4e0b\u6b65\u9aa4: \u7528\u6237\u767b\u5f55 \u7528\u6237\u53bb\u9886\u5238\u4e2d\u5fc3\u9886\u53d6100-2\u7684\u4f18\u60e0\u5238 \u7528\u6237\u641c\u7d22\u7b26\u5408\u4f18\u60e0\u5238\u7684\u5546\u54c1\uff0c\u5e76\u5c06\u5b83\u52a0\u5165\u8d2d\u7269\u8f66 \u7528\u6237\u53bb\u8d2d\u7269\u8f66\u7ed3\u7b97\uff0c\u751f\u6210\u8ba2\u5355\uff08\u5e76\u4f7f\u7528\u6b64\u4f18\u60e0\u5238\uff09 \u7528\u6237\u652f\u4ed8 \u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u4e2a\u94fe\u8def\u5176\u5b9e\u5c31\u4e0d\u592a\u77ed\uff0c\u5982\u679c\u6211\u4eec\u5728\u4e0d\u719f\u6089\u8fd9\u51e0\u4e2a\u63a5\u53e3\u53c2\u6570\u7684\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u8981\u5bf9\u7167\u63a5\u53e3\u6587\u6863\uff0c\u53bb\u9020\u5bf9\u5e94\u7684\u53c2\u6570\uff0c\u751a\u81f3\u53ef\u80fd\u9020\u4e86\u4e00\u4f1a\u53d1\u73b0case\u8fd8\u662f\u6ca1\u8dd1\u901a\u3002 \u90a3\u5982\u679c\u4ee5\u4e0a\u573a\u666f\uff0c\u4f60\u5728 \u6d4f\u89c8\u5668\u64cd\u4f5c \u7684\u65f6\u5019\uff0c\u5c31\u80fd\u5e2e\u4f60\u6c47\u603b\u8fd9\u4e9b\u63a5\u53e3\uff0c\u5e76\u6293\u53d6\u4e0b\u6765\uff0c\u4f60\u5199\u7528\u4f8b\u7684\u65f6\u5019\u53ea\u9700\u8981\u628a \u56fa\u5b9a\u7684\u53c2\u6570 \u6bd4\u5982\u8d26\u53f7\uff0c\u5546\u54c1id\u7b49\u53c2\u6570\u5316\uff0c\u90a3\u4f1a\u4e0d\u4f1a\u975e\u5e38\u53cb\u597d\uff0c\u9ad8\u6548\uff0c\u800c\u4e14 \u94fe\u8def \u80af\u5b9a\u662f\u901a\u7684\uff0c\u56e0\u4e3a\u4f60\u5728\u6d4f\u89c8\u5668\u5df2\u7ecf\u5b8c\u6210\u8fc7\u8fd9\u6837\u7684\u6d41\u7a0b\u4e86\u3002 \u6240\u4ee5\u8fd9\u5c31\u662f\u4e3a\u4ec0\u4e48\uff0c\u6211\u4eec\u8981\u652f\u6301\u7528\u4f8b\u5f55\u5236\u7684\u539f\u56e0\uff0c\u56e0\u4e3a\u96c0\u6c0f\u65b9\u4fbf\uff0c\u96c0\u6c0f\u87c0\u554a\uff01 \u597d\u50cf\u6709\u70b9\u626f\u8fdc\u4e86\uff0c\u6211\u4eec\u7ee7\u7eed\u804a\u8fd9\u4e2ahar\u7684\u4e8b\u60c5\u3002\u603b\u4e4bhar\u5c31\u662fchrome tools\u5e2e\u6211\u4eec\u5f55\u5236\u597d\u6211\u4eec\u53d1\u51fa\u7684\u8bf7\u6c42\uff0c\u5269\u4e0b\u7684\u7b5b\u9009\uff0c\u751f\u6210\u7528\u4f8b\u5c31\u5f97\u9760\u6211\u4eec\u81ea\u5df1\u4e86\u3002 \u6765\u770b\u770bhar\u6587\u4ef6\u91cc\u9762\u7684\u5185\u5bb9\u5427: \u53ef\u4ee5\u770b\u5230\uff0c\u4ed6\u5176\u5b9e\u662f\u4e00\u4e2aJSON\u6570\u636e\uff0c\u6240\u4ee5\u6211\u4eec\u7528JSON\u5e93\u89e3\u6790\u5b83\u5c31\u597d\u4e86\u3002","title":"Har\u6587\u4ef6\u5206\u6790"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28135%29%20har%E6%96%87%E4%BB%B6%E8%BD%AC%E4%B8%BARequestInfo/#xhrfetch","text":"\u867d\u7136js/css/img\u7b49\u7b49\u8bf7\u6c42\u4e5f\u7b97http\u8bf7\u6c42\uff0c\u4f46\u4e00\u822c\u6765\u8bf4\u4e0e\u670d\u52a1\u7aef\u4ea4\u4e92\u7684\u8fd8\u5f97\u662fxhr\u548cfetch\u3002fetch\u53ef\u4ee5\u7406\u89e3\u4e3a\u4e8c\u4ee3xhr\uff08ajax\uff09\u3002 \u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u83b7\u53d6\u8fd92\u79cd\u7c7b\u578b\u7684\u6570\u636e\u5373\u53ef\u3002 \u800c\u4e14\u5b83\u628arequest\u548cresponse\u7684\u6570\u636e\u90fd\u5206\u5f00\u4e86\uff0c\u6211\u4eec\u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730 \u8bfb\u53d6 \u3002","title":"XHR\u548cFetch"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28135%29%20har%E6%96%87%E4%BB%B6%E8%BD%AC%E4%B8%BARequestInfo/#convetor","text":"app/core/request/convertor.py __author__ = \"woody\" from typing import List from app.core.request.request import RequestInfo \"\"\" request\u8f6c\u6362\u5668\uff0c\u652f\u6301har\u5230 \"\"\" class Convertor ( object ): @staticmethod def convert ( file , regex : str = None ) -> List [ RequestInfo ]: raise NotImplementedError \u5185\u5bb9\u5f88\u7b80\u5355\uff0c\u5e76\u4e14\u652f\u6301\u6b63\u5219\uff0c\u76ee\u7684\u662f\u4e3a\u4e86\u8fc7\u6ee4\u4e0d\u8981\u7684url\uff0c\u6216\u8005\u8bf4\u662f\u4e3a\u4e86\u7b5b\u9009\u51fa\u60f3\u8981\u7684\u63a5\u53e3\u3002 \u5f53\u7136\u8fd9\u90fd\u662f \u62bd\u8c61\u63a5\u53e3 \uff0c\u63a5\u7740\u6211\u4eec\u6765\u5199\u5177\u4f53\u7684\u5b9e\u73b0\u3002","title":"\u7f16\u5199Convetor"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28135%29%20har%E6%96%87%E4%BB%B6%E8%BD%AC%E4%B8%BARequestInfo/#harconvetor","text":"app/core/request/har_convertor.py import json import re from typing import List from app.core.request.convertor import Convertor from app.core.request.request import RequestInfo from app.excpetions.convert.ConvertException import HarConvertException class HarConvertor ( Convertor ): @staticmethod def convert ( file , regex : str = None ) -> List [ RequestInfo ]: try : with open ( file , \"r\" , encoding = \"utf-8\" ) as f : ans = [] flag = None if regex is not None : flag = re . compile ( regex ) # \u52a0\u8f7dhar\u8bf7\u6c42\u6570\u636e data = json . load ( f ) entries = data . get ( \"log\" , {}) . get ( \"entries\" ) if not entries : raise HarConvertException ( \"entries\u6570\u636e\u4e3a\u7a7a\" ) for entry in entries : # \u5982\u679c\u662ffetch\u6216xhr\u63a5\u53e3\uff0c\u8bf4\u660e\u662fhttp\u8bf7\u6c42\uff08\u6682\u4e0d\u652f\u6301js) if entry . get ( \"_resourceType\" ) . lower () in ( \"fetch\" , \"xhr\" ): info = RequestInfo () request_data = entry . get ( \"request\" ) info . url = request_data . get ( \"url\" ) if flag is not None and not re . findall ( flag , info . url ): # \u7531\u4e8e\u4e0d\u7b26\u5408\u9884\u671f\u7684url\uff0c\u6240\u4ee5\u8fc7\u6ee4\u6389 continue response_data = entry . get ( \"response\" ) info . body = HarConvertor . get_body ( request_data ) info . status_code = response_data . get ( \"status\" ) info . request_method = request_data . get ( \"method\" ) info . request_headers = HarConvertor . get_kv ( request_data ) info . response_headers = HarConvertor . get_kv ( response_data ) info . cookies = HarConvertor . get_kv ( response_data , \"cookies\" ) info . request_cookies = HarConvertor . get_kv ( request_data , \"cookies\" ) info . response_content = response_data . get ( \"content\" , {}) . get ( \"text\" ) ans . append ( info ) return ans except HarConvertException as e : raise HarConvertException ( f \"har\u6587\u4ef6\u8f6c\u6362\u5f02\u5e38: { e } \" ) except Exception as e : raise HarConvertException ( f \"har\u6587\u4ef6\u8f6c\u6362\u5931\u8d25: { e } \" ) @staticmethod def get_kv ( request_data : dict , key : str = \"headers\" ) -> dict : \"\"\" \u901a\u8fc7response/request\u83b7\u53d6header\u4fe1\u606f :param key: :param request_data: :return: \"\"\" headers = request_data . get ( key ) result = dict () for h in headers : result [ h . get ( \"name\" )] = h . get ( \"value\" ) return result @staticmethod def get_body ( request_data : dict ): data = request_data . get ( \"postData\" , {}) return data . get ( \"text\" ) if __name__ == \"__main__\" : requests = HarConvertor . convert ( \"./pity.fun.har\" , \"juejin.cn\" ) print ( requests ) \u8fd9\u91cc\u4e3b\u8981\u505a\u4e862\u4e2a\u4e8b\u60c5\uff0c\u8bfb\u53d6+\u8f6c\u6362\uff0c\u9996\u5148\u6211\u4eec\u5c06\u8bfb\u53d6\u7684har\u5229\u7528json.load\u8f6c\u4e3aPython\u6570\u636e\u3002 \u63a5\u7740\u53bb\u627e\u5230\u5bf9\u5e94\u7684\u8bf7\u6c42\u6570\u7ec4: entries, \u904d\u5386\u4e4b\u3002 \u63a5\u7740\u5c31\u662f\u62fc\u63a5\u4e3a\u6211\u4eec\u81ea\u5df1\u7684 RequestInfo \u4e86\uff0c\u5230\u8fd9\u91cc\u6211\u4eec\u7684\u8f6c\u6362\u5de5\u4f5c\u5c31\u5b8c\u6210\u4e86\uff0c\u6211\u4eec\u8fd8\u81ea\u5b9a\u4e49\u4e86HarConvertException, \u662f\u4e3a\u4e86\u66f4\u597d\u5730\u533a\u522b \u5f02\u5e38\u7c7b\u578b \u3002 \u8fd9\u6837\u8bbe\u8ba1\u7684\u597d\u5904\u662f\uff0c\u4ee5\u540e\u5982\u679c\u8981\u652f\u6301hab, hba, hxr\u5404\u79cd\u683c\u5f0f\u7684\u65f6\u5019\uff0c\u6211\u4eec\u53ea\u9700\u8981\u5b9e\u73b0convert\u65b9\u6cd5\u5373\u53ef\u3002 \u63a5\u7740\u5c31\u662f\u6211\u4eec\u6700\u91cd\u8981\u7684 \u8f6c\u6362\u73af\u8282 \u4e86\uff0c\u53ef\u80fd\u9700\u8981\u535a\u4e3b\u8d39\u70b9\u8111\u5b50\u4e86\u3002\u5927\u5bb6\u505a\u597d\u5fc3\u7406\u51c6\u5907~","title":"\u7f16\u5199HarConvetor"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28136%29%20%E5%89%8D%E7%BD%AE%E6%9D%A1%E4%BB%B6%E6%94%AF%E6%8C%81HTTP%E8%AF%B7%E6%B1%82/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u7f16\u5199\u4e86 har \u6587\u4ef6\u8f6cRequestInfo\u76f8\u5173\u7684\u5185\u5bb9\uff0c\u4f46\u5c31\u5728\u8fdb\u884c \u4e0b\u4e00\u6b65 \u7684\u65f6\u5019\uff0c\u6211\u53d1\u73b0\u6211\u4eec\u7684\u524d\u7f6e\u6761\u4ef6\u8fd8 \u5e76\u4e0d\u652f\u6301 http\u8bf7\u6c42\uff0c\u8fd9\u5c31\u5bfc\u81f4\u6211\u4eec\u53ea\u80fd\u628a\u62c6\u51fa\u6765\u7684 \u591a\u4e2a\u63a5\u53e3 \u8f6c\u4e3a \u591a\u4e2a\u7528\u4f8b \uff0c\u8fd9\u663e\u7136\u662f\u4e0d\u597d\u7684\u505a\u6cd5\u3002 \u6240\u4ee5\u8fd9\u4e00\u8282\u6211\u4eec\u9700\u8981\u8ba9\u524d\u7f6e\u6761\u4ef6\u652f\u6301 http\u8bf7\u6c42 \uff0c\u5e76\u7a0d\u5fae\u505a\u51fa\u4e00\u4e9b\u6837\u5f0f\u4e0a\u7684\u8c03\u6574\u3002 \u524d\u7aef\u90e8\u5206 \u6211\u4eec\u8fd9\u6b21\u4e0d\u540c\u4e8e\u4ee5\u5f80\uff0c\u7531\u4e8ehttp\u8bf7\u6c42\u5176\u5b9e\u4e5f\u662f\u524d\u7f6e\u6761\u4ef6\u7684 \u4e00\u79cd \uff0c\u6240\u4ee5\u7406\u8bba\u4e0a\u6765\u8bf4\uff0c\u540e\u7aef\u7684\u589e\u5220\u6539\u67e5\u63a5\u53e3\u90fd\u662f\u6709\u7684\u3002 \u6211\u4eec\u5148\u6539\u9020\u4e0b\u5bf9\u5e94\u7684\u9875\u9762\uff0c\u518d\u5230\u540e\u7aef\u652f\u6301 Http\u6267\u884c\u5668 \u5373\u53ef\u3002 \u6211\u4eec\u5148\u6765\u770b\u770b\u73b0\u6709\u7684\u524d\u540e\u7f6e\u6761\u4ef6: \u53ef\u4ee5\u770b\u5230\u8fd9\u4e2a\u9875\u9762\u786e\u5b9e\u4e0d\u592a\u597d\u770b\uff0c\u4e3a\u5565\u5462\uff0c\u6211\u611f\u89c9\u4e3b\u8981\u662f\u8fd9\u6837: \u6709\u4e9b\u8868\u5355\u4e0d\u9700\u8981\u90a3\u4e48\u957f\u7684\u8f93\u5165\u6846\uff0c\u4f46\u662f\u5374\u72ec\u5360\u4e86\u4e00\u884c\uff0c\u5bfc\u81f4\u6574\u4e2a\u9875\u9762\u5f88\u677e\u6563 \u6240\u4ee5\u6211\u4eec\u9700\u8981\u8fdb\u884c\u4e00\u5b9a\u7684\u6574\u5408\uff0c\u6211\u4eec\u6765\u770b\u770b\u6574\u5408\u540e\u7684: \u4e0d\u80fd\u8bf4\u597d\u770b\u4e86\uff0c\u4f46\u662f\u8d77\u7801\u4e00\u4e2a\u9875\u9762\u5185\u80fd\u591f\u653e\u4e0b\u8fd9\u4e9b\u5185\u5bb9\u4e86\uff0c\u5c11\u4e86\u4e00\u4e2a\u6eda\u52a8\u6761\u3002 \u5176\u5b9e\u6211\u505a\u7684\u5c31\u662f\uff0c\u628a\u6709\u4e9b\u5b57\u6bb5\u4e0d\u9700\u8981\u90a3\u4e48\u591a\u8f93\u5165\u6846\u7684\uff0c\u7ed9\u5408\u5e76\u5230\u4e00\u884c\u663e\u793a\u4e86\uff0c\u8fd9\u6837\u8d77\u7801\u4e0d\u4f1a\u90a3\u4e48 \u5360\u9ad8\u5ea6 \u4e86\u3002 \u63a5\u7740\u6765\u770b\u770bSQL\u524d\u7f6e\u7684\u5bf9\u6bd4: \u6539\u9020\u524d \u6539\u9020\u540e \u9996\u5148\u662f\u5de6\u4fa7\u7684\u83dc\u5355 \u62c9\u9ad8 \u4e86\uff0c\u611f\u5b98\u4e0a\u4f1a\u6bd4\u524d\u8005\u597d\u4e00\u70b9\u3002 \u6700\u540e\u6211\u4eec\u6765\u770b\u770b\u65b0\u7248\u7684http\u8bf7\u6c42\u7ec4\u4ef6\uff0c\u7531\u4e8e\u5176\u4ed6\u5730\u65b9\u4e5f\u6709\u7528\u5230\uff0c\u6240\u4ee5\u6211\u7a0d\u5fae\u590d\u7528\u4e86\u4e00\u4e0b\uff08\u603b\u4f53\u6765\u8bf4\u7ec4\u4ef6\u8bbe\u8ba1\u7684\u4e0d\u662f\u592a\u597d\uff0c\u52c9\u52c9\u5f3a\u5f3a\u6539\u9020\u4e86\uff0c\u540e\u7eed\u80af\u5b9a\u9700\u8981\u91cd\u65b0\u8bbe\u8ba1\u4e00\u756a\u7684\uff09 \u524d\u7aef\u4e0a\u9762\u7684\u6539\u9020\u5c31\u4ecb\u7ecd\u5230\u8fd9\u91cc\uff0c\u5176\u5b9e\u4e5f\u5c31\u662f\u590d\u7528\u4e86\u4e00\u4e0bhttp\u76f8\u5173\u7684\u7ec4\u4ef6\uff0c\u6211\u4eec\u6765\u770b\u770b \u540e\u7aef\u90e8\u5206 \u3002 \u540e\u7aef\u90e8\u5206 \u540e\u7aef\u90e8\u5206\uff0c\u6211\u4eec\u53ea\u9700\u8981\u8865\u5145\u5bf9\u5e94\u7684Constructor\u5373\u53ef\u3002 \u65b0\u589eapp/core/constructor/http_constructor.py import json from app.core.constructor.constructor import ConstructorAbstract from app.crud.config.AddressDao import PityGatewayDao from app.middleware.AsyncHttpClient import AsyncRequest from app.models.constructor import Constructor class HttpConstructor ( ConstructorAbstract ): @staticmethod async def run ( executor , env , index , path , params , req_params , constructor : Constructor , ** kwargs ): try : executor . append ( f \"\u5f53\u524d\u8def\u5f84: { path } , \u7b2c { index + 1 } \u6761 { HttpConstructor . get_name ( constructor ) } \" ) data = json . loads ( constructor . constructor_json ) url = data . get ( \"url\" ) if data . get ( \"base_path\" ): base_path = await PityGatewayDao . query_gateway ( env , data . get ( \"base_path\" )) url = f \" { base_path }{ url } \" headers = json . loads ( data . get ( \"headers\" )) client = await AsyncRequest . client ( url = url , body_type = data . get ( \"body_type\" ), headers = headers , body = data . get ( \"body\" )) resp = await client . invoke ( data . get ( \"request_method\" )) executor . append ( f \"\u5f53\u524d { ConstructorAbstract . get_name ( constructor ) } \u7c7b\u578b\u4e3ahttp, url: { url } \" ) if constructor . value : params [ constructor . value ] = resp executor . append ( f \"\u5f53\u524d { ConstructorAbstract . get_name ( constructor ) } \u8fd4\u56de\u53d8\u91cf: { constructor . value } \\n \u8fd4\u56de\u503c: \\n { resp } \\n \" ) except Exception as e : raise Exception ( f \" { path } -> { constructor . name } \u7b2c { index + 1 } \u4e2a { HttpConstructor . get_name ( constructor ) } \u6267\u884c\u5931\u8d25: { e } \" ) \u6211\u4eec\u7ee7\u627f\u81eaConstructorAbstract\u7c7b\uff0c\u5e76\u5b9e\u73b0\u91cc\u9762\u7684run\u65b9\u6cd5\u3002\u901a\u8fc7\u53cd\u5e8f\u5217\u5316constructor_json\u83b7\u53d6http\u8bf7\u6c42\u7684\u76f8\u5173\u6570\u636e: url request_method headers base_path body \u83b7\u53d6\u5230\u4e86\u4e4b\u540e\u5c31\u53ef\u4ee5\u53d1\u9001http\u8bf7\u6c42\u4e86\uff0c\u6700\u540e\u628a\u8bf7\u6c42\u7ed3\u679c\u8fd4\u56de\u5199\u5165params\u5b57\u5178\uff0c\u548c\u5176\u4ed6\u7c7b\u578b\u7684\u6570\u636e\u6784\u9020\u5668 \u5dee\u4e0d\u591a \u3002 \u6211\u4eec\u5728\u83b7\u53d6\u6570\u636e\u6784\u9020\u5668\u8fd9\u91cc\u52a0\u4e0ahttp\u7c7b\u578b\uff0c\u63a5\u7740\u5c31\u53ef\u4ee5\u56a3\u5f20\u5730\u7b49\u5f85\u5947\u8ff9\u51fa\u73b0\u4e86: \u53ef\u4ee5\u770b\u5230\uff0chttp\u8bf7\u6c42\u5df2\u7ecf\u88ab\u987a\u5229\u83b7\u53d6\u5e76\u5b8c\u6210\u4e86\uff0c\u81f3\u6b64\uff0c\u9664\u4e86mq\u76f8\u5173\u7684\u524d\u540e\u7f6e\u6761\u4ef6\uff0c\u5176\u4ed6\u5185\u5bb9\u6211\u4eec\u57fa\u672c\u4e0a\u90fd\u5df2\u7ecf\u5b8c\u6210\u4e86\u3002 \u4e0b\u4e00\u8282\u6211\u4eec\u8fd8\u662f\u7684\u5c06\u601d\u7eea\u62c9\u56de\u5230 \u5982\u4f55\u63d0\u53d6\u63a5\u53e3\u95f4\u7684\u4f9d\u8d56\u6570\u636e \u3002","title":"136.\u524d\u7f6e\u6761\u4ef6\u652f\u6301HTTP\u8bf7\u6c42"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28136%29%20%E5%89%8D%E7%BD%AE%E6%9D%A1%E4%BB%B6%E6%94%AF%E6%8C%81HTTP%E8%AF%B7%E6%B1%82/#_1","text":"\u4e0a\u4e00\u8282\u6211\u4eec\u7f16\u5199\u4e86 har \u6587\u4ef6\u8f6cRequestInfo\u76f8\u5173\u7684\u5185\u5bb9\uff0c\u4f46\u5c31\u5728\u8fdb\u884c \u4e0b\u4e00\u6b65 \u7684\u65f6\u5019\uff0c\u6211\u53d1\u73b0\u6211\u4eec\u7684\u524d\u7f6e\u6761\u4ef6\u8fd8 \u5e76\u4e0d\u652f\u6301 http\u8bf7\u6c42\uff0c\u8fd9\u5c31\u5bfc\u81f4\u6211\u4eec\u53ea\u80fd\u628a\u62c6\u51fa\u6765\u7684 \u591a\u4e2a\u63a5\u53e3 \u8f6c\u4e3a \u591a\u4e2a\u7528\u4f8b \uff0c\u8fd9\u663e\u7136\u662f\u4e0d\u597d\u7684\u505a\u6cd5\u3002 \u6240\u4ee5\u8fd9\u4e00\u8282\u6211\u4eec\u9700\u8981\u8ba9\u524d\u7f6e\u6761\u4ef6\u652f\u6301 http\u8bf7\u6c42 \uff0c\u5e76\u7a0d\u5fae\u505a\u51fa\u4e00\u4e9b\u6837\u5f0f\u4e0a\u7684\u8c03\u6574\u3002","title":"\u56de\u987e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28136%29%20%E5%89%8D%E7%BD%AE%E6%9D%A1%E4%BB%B6%E6%94%AF%E6%8C%81HTTP%E8%AF%B7%E6%B1%82/#_2","text":"\u6211\u4eec\u8fd9\u6b21\u4e0d\u540c\u4e8e\u4ee5\u5f80\uff0c\u7531\u4e8ehttp\u8bf7\u6c42\u5176\u5b9e\u4e5f\u662f\u524d\u7f6e\u6761\u4ef6\u7684 \u4e00\u79cd \uff0c\u6240\u4ee5\u7406\u8bba\u4e0a\u6765\u8bf4\uff0c\u540e\u7aef\u7684\u589e\u5220\u6539\u67e5\u63a5\u53e3\u90fd\u662f\u6709\u7684\u3002 \u6211\u4eec\u5148\u6539\u9020\u4e0b\u5bf9\u5e94\u7684\u9875\u9762\uff0c\u518d\u5230\u540e\u7aef\u652f\u6301 Http\u6267\u884c\u5668 \u5373\u53ef\u3002 \u6211\u4eec\u5148\u6765\u770b\u770b\u73b0\u6709\u7684\u524d\u540e\u7f6e\u6761\u4ef6: \u53ef\u4ee5\u770b\u5230\u8fd9\u4e2a\u9875\u9762\u786e\u5b9e\u4e0d\u592a\u597d\u770b\uff0c\u4e3a\u5565\u5462\uff0c\u6211\u611f\u89c9\u4e3b\u8981\u662f\u8fd9\u6837: \u6709\u4e9b\u8868\u5355\u4e0d\u9700\u8981\u90a3\u4e48\u957f\u7684\u8f93\u5165\u6846\uff0c\u4f46\u662f\u5374\u72ec\u5360\u4e86\u4e00\u884c\uff0c\u5bfc\u81f4\u6574\u4e2a\u9875\u9762\u5f88\u677e\u6563 \u6240\u4ee5\u6211\u4eec\u9700\u8981\u8fdb\u884c\u4e00\u5b9a\u7684\u6574\u5408\uff0c\u6211\u4eec\u6765\u770b\u770b\u6574\u5408\u540e\u7684: \u4e0d\u80fd\u8bf4\u597d\u770b\u4e86\uff0c\u4f46\u662f\u8d77\u7801\u4e00\u4e2a\u9875\u9762\u5185\u80fd\u591f\u653e\u4e0b\u8fd9\u4e9b\u5185\u5bb9\u4e86\uff0c\u5c11\u4e86\u4e00\u4e2a\u6eda\u52a8\u6761\u3002 \u5176\u5b9e\u6211\u505a\u7684\u5c31\u662f\uff0c\u628a\u6709\u4e9b\u5b57\u6bb5\u4e0d\u9700\u8981\u90a3\u4e48\u591a\u8f93\u5165\u6846\u7684\uff0c\u7ed9\u5408\u5e76\u5230\u4e00\u884c\u663e\u793a\u4e86\uff0c\u8fd9\u6837\u8d77\u7801\u4e0d\u4f1a\u90a3\u4e48 \u5360\u9ad8\u5ea6 \u4e86\u3002 \u63a5\u7740\u6765\u770b\u770bSQL\u524d\u7f6e\u7684\u5bf9\u6bd4: \u6539\u9020\u524d \u6539\u9020\u540e \u9996\u5148\u662f\u5de6\u4fa7\u7684\u83dc\u5355 \u62c9\u9ad8 \u4e86\uff0c\u611f\u5b98\u4e0a\u4f1a\u6bd4\u524d\u8005\u597d\u4e00\u70b9\u3002 \u6700\u540e\u6211\u4eec\u6765\u770b\u770b\u65b0\u7248\u7684http\u8bf7\u6c42\u7ec4\u4ef6\uff0c\u7531\u4e8e\u5176\u4ed6\u5730\u65b9\u4e5f\u6709\u7528\u5230\uff0c\u6240\u4ee5\u6211\u7a0d\u5fae\u590d\u7528\u4e86\u4e00\u4e0b\uff08\u603b\u4f53\u6765\u8bf4\u7ec4\u4ef6\u8bbe\u8ba1\u7684\u4e0d\u662f\u592a\u597d\uff0c\u52c9\u52c9\u5f3a\u5f3a\u6539\u9020\u4e86\uff0c\u540e\u7eed\u80af\u5b9a\u9700\u8981\u91cd\u65b0\u8bbe\u8ba1\u4e00\u756a\u7684\uff09 \u524d\u7aef\u4e0a\u9762\u7684\u6539\u9020\u5c31\u4ecb\u7ecd\u5230\u8fd9\u91cc\uff0c\u5176\u5b9e\u4e5f\u5c31\u662f\u590d\u7528\u4e86\u4e00\u4e0bhttp\u76f8\u5173\u7684\u7ec4\u4ef6\uff0c\u6211\u4eec\u6765\u770b\u770b \u540e\u7aef\u90e8\u5206 \u3002","title":"\u524d\u7aef\u90e8\u5206"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28136%29%20%E5%89%8D%E7%BD%AE%E6%9D%A1%E4%BB%B6%E6%94%AF%E6%8C%81HTTP%E8%AF%B7%E6%B1%82/#_3","text":"\u540e\u7aef\u90e8\u5206\uff0c\u6211\u4eec\u53ea\u9700\u8981\u8865\u5145\u5bf9\u5e94\u7684Constructor\u5373\u53ef\u3002 \u65b0\u589eapp/core/constructor/http_constructor.py import json from app.core.constructor.constructor import ConstructorAbstract from app.crud.config.AddressDao import PityGatewayDao from app.middleware.AsyncHttpClient import AsyncRequest from app.models.constructor import Constructor class HttpConstructor ( ConstructorAbstract ): @staticmethod async def run ( executor , env , index , path , params , req_params , constructor : Constructor , ** kwargs ): try : executor . append ( f \"\u5f53\u524d\u8def\u5f84: { path } , \u7b2c { index + 1 } \u6761 { HttpConstructor . get_name ( constructor ) } \" ) data = json . loads ( constructor . constructor_json ) url = data . get ( \"url\" ) if data . get ( \"base_path\" ): base_path = await PityGatewayDao . query_gateway ( env , data . get ( \"base_path\" )) url = f \" { base_path }{ url } \" headers = json . loads ( data . get ( \"headers\" )) client = await AsyncRequest . client ( url = url , body_type = data . get ( \"body_type\" ), headers = headers , body = data . get ( \"body\" )) resp = await client . invoke ( data . get ( \"request_method\" )) executor . append ( f \"\u5f53\u524d { ConstructorAbstract . get_name ( constructor ) } \u7c7b\u578b\u4e3ahttp, url: { url } \" ) if constructor . value : params [ constructor . value ] = resp executor . append ( f \"\u5f53\u524d { ConstructorAbstract . get_name ( constructor ) } \u8fd4\u56de\u53d8\u91cf: { constructor . value } \\n \u8fd4\u56de\u503c: \\n { resp } \\n \" ) except Exception as e : raise Exception ( f \" { path } -> { constructor . name } \u7b2c { index + 1 } \u4e2a { HttpConstructor . get_name ( constructor ) } \u6267\u884c\u5931\u8d25: { e } \" ) \u6211\u4eec\u7ee7\u627f\u81eaConstructorAbstract\u7c7b\uff0c\u5e76\u5b9e\u73b0\u91cc\u9762\u7684run\u65b9\u6cd5\u3002\u901a\u8fc7\u53cd\u5e8f\u5217\u5316constructor_json\u83b7\u53d6http\u8bf7\u6c42\u7684\u76f8\u5173\u6570\u636e: url request_method headers base_path body \u83b7\u53d6\u5230\u4e86\u4e4b\u540e\u5c31\u53ef\u4ee5\u53d1\u9001http\u8bf7\u6c42\u4e86\uff0c\u6700\u540e\u628a\u8bf7\u6c42\u7ed3\u679c\u8fd4\u56de\u5199\u5165params\u5b57\u5178\uff0c\u548c\u5176\u4ed6\u7c7b\u578b\u7684\u6570\u636e\u6784\u9020\u5668 \u5dee\u4e0d\u591a \u3002 \u6211\u4eec\u5728\u83b7\u53d6\u6570\u636e\u6784\u9020\u5668\u8fd9\u91cc\u52a0\u4e0ahttp\u7c7b\u578b\uff0c\u63a5\u7740\u5c31\u53ef\u4ee5\u56a3\u5f20\u5730\u7b49\u5f85\u5947\u8ff9\u51fa\u73b0\u4e86: \u53ef\u4ee5\u770b\u5230\uff0chttp\u8bf7\u6c42\u5df2\u7ecf\u88ab\u987a\u5229\u83b7\u53d6\u5e76\u5b8c\u6210\u4e86\uff0c\u81f3\u6b64\uff0c\u9664\u4e86mq\u76f8\u5173\u7684\u524d\u540e\u7f6e\u6761\u4ef6\uff0c\u5176\u4ed6\u5185\u5bb9\u6211\u4eec\u57fa\u672c\u4e0a\u90fd\u5df2\u7ecf\u5b8c\u6210\u4e86\u3002 \u4e0b\u4e00\u8282\u6211\u4eec\u8fd8\u662f\u7684\u5c06\u601d\u7eea\u62c9\u56de\u5230 \u5982\u4f55\u63d0\u53d6\u63a5\u53e3\u95f4\u7684\u4f9d\u8d56\u6570\u636e \u3002","title":"\u540e\u7aef\u90e8\u5206"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28137%29%20%E6%8F%90%E5%8F%96%E5%A4%9A%E4%B8%AA%E6%8E%A5%E5%8F%A3%E4%B8%AD%E7%9A%84%E5%8F%82%E6%95%B0/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u5b8c\u6210\u4e86 \u524d\u7f6e\u6761\u4ef6 \u652f\u6301http\u8bf7\u6c42\u7684\u5185\u5bb9\uff0c\u8fd9\u4e00\u8282\u6211\u4eec\u7ee7\u7eed\u5f00\u59cb\u7814\u7a76\u591a\u63a5\u53e3\u4e4b\u95f4\u53c2\u6570\u63d0\u53d6\u7684\u95ee\u9898\u3002 \u7531\u4e8e\u4e4b\u524d\u6211\u4eec\u5df2\u7ecf\u80fd\u591f\u628ahar\u7684\u6570\u636e\u8f6c\u4e3a\u6211\u4eec\u81ea\u8eab\u7684RequestInfo\u4e86\uff0c\u52a0\u4e0a\u5df2\u7ecf\u5b8c\u6210\u4e86http\u8bf7\u6c42\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u5f00\u59cb\u8003\u8651\u63d0\u53d6\u591a\u4e2aRequestInfo\u91cc\u9762\u7684\u53c2\u6570\u4e86\u3002 \u601d\u8def \u5728\u6b64\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u7a0d\u5fae\u634b\u4e00\u634b\u5927\u4f53\u7684\u601d\u8def\uff0c\u6211\u7684\u60f3\u6cd5\u662f\u8fd9\u6837\u7684\uff0c\u5f53\u7136\u80af\u5b9a\u4f1a\u6709\u4e00\u4e9b\u4e0d\u5b8c\u5584\u7684\u5730\u65b9\uff0c\u800c\u4e14\u8fd9\u5757\u5185\u5bb9\u4e5f\u662f\u4e00\u4e2a\u521d\u7248\uff0c\u540e\u7eed\u53ef\u80fd\u4f1a\u6709\u6539\u52a8\u3002 \u524d\u63d0 \u5148\u8bf4\u4e00\u4e0b\u6211\u4eec\u505a\u8fd9\u4e2a\u5de5\u4f5c\u7684\u524d\u63d0\uff0c\u6211\u4eec\u9700\u8981\u505a\u5230\u6700\u6838\u5fc3\u76842\u4e2a\u4e8b\u60c5: \u5b58\u50a8\u6bcf\u4e2a\u8bf7\u6c42\u4e2d\u53ef\u80fd\u4f1a\u88ab\u4e0b\u4e2a\u8bf7\u6c42\u4f7f\u7528\u5230\u7684\u53d8\u91cf \u8bfb\u53d6\u5f53\u524d\u7684\u6570\u636e\uff0c\u770b\u662f\u5426\u5728\u4e0a\u4e2a\u8bf7\u6c42\u4e2d\u51fa\u73b0\u8fc7 \u641e\u6e05\u695a\u4e86\u8fd92\u70b9\uff0c\u6211\u611f\u89c9\u8fd9\u5757\u5185\u5bb9\u5c31\u4e0d\u4f1a\u5f88\u590d\u6742\u3002\u63a5\u7740\u662f\u6574\u4f53\u601d\u8def: \u904d\u5386RequestInfo\u6570\u7ec4\uff0c\u5e76\u5c06response\u548cresponse_headers\u91cc\u9762\u7684\u53d8\u91cf\u4ee5value-\u8def\u5f84\u7684\u5f62\u5f0f\u5b58\u50a8\u4e0b\u6765\uff0c\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u6211\u4eec\u767b\u5f55\u540e\u8fd4\u56de\u4ee5\u4e0bResponse: { \"code\" : 0 , \"data\" : { \"token\" : \"123\" } } \u8fd9\u65f6\u5019\u6211\u4eec\u9700\u8981\u5b58\u50a8\u7684map\u5c31\u53d8\u6210\u4e86\u8fd9\u6837: { \"123\" : \"response.data.token\" } \u8fd9\u65f6\u5019\u5c31\u6709\u4eba\u4f1a\u95ee\u4e86\uff0c\u5982\u679c\u5982\u679c\u51fa\u73b0\u91cd\u590d\u7684\u600e\u4e48\u529e\uff0c\u6bd4\u5982ABC3\u4e2a\u63a5\u53e3\u4f9d\u6b21\u8c03\u7528\uff0cA\u548cB\u4e2d\u90fd\u6709\u503c\u4e3a123\u7684\u6570\u636e\uff0c\u90a3\u8fd9\u4e2a\u76ee\u524d\u6211\u662f\u4ee5 \u7b2c\u4e00\u4e2a\u6570\u636e \u4e3a\u51c6\u3002 \u4f46\u662f\u4e3a\u4e86\u65b9\u4fbf\uff0c\u6211\u8fd8\u662f\u5b58\u653e\u4e86\u4e00\u4e2a\u6570\u7ec4\uff0c\u6240\u4ee5\u5f62\u5f0f\u4f1a\u662f: { \"123\" : [ \"response.data.token\" , \"response.data.xxx.token\" ]} \u8fd9\u6837\u662f\u4e3a\u4e86\u6269\u5c55\uff0c\u4e07\u4e00\u540e\u9762\u6211\u4e0d\u4ee5 \u7b2c\u4e00\u6761 \u6570\u636e\u4e3a\u51c6\u4e86\uff0c\u8d77\u7801\u6211\u51fa\u73b0\u8fc7123\u7684key\u90fd\u88ab\u8bb0\u5f55\u4e0b\u6765\u4e86\uff0c\u5230\u65f6\u5019\u6539\u52a8\u529f\u80fd\u4e5f\u4e0d\u6101\u6709\u4ec0\u4e48\u95ee\u9898\u3002 \u5f53\u8bf7\u6c42\u6570\u636e\u662f\u7b2c\u4e00\u6761\u6570\u636e\uff0c\u6211\u4eec\u4e0d\u4f1a\u505a\u53c2\u6570\u66ff\u6362\uff0c\u5426\u5219\u6211\u4eec\u8981\u904d\u5386body\u548curl\u4ee5\u53carequest_headers\uff0c\u56e0\u4e3a\u4e00\u822c\u6765\u8bf4\u53d8\u91cf\u90fd\u4f1a\u5728\u8fd93\u4e2a\u6570\u636e\u91cc\u9762\u3002\u63a5\u7740\u6211\u4eec\u627e\u5230\u53d8\u91cf\u7684\u65f6\u5019\uff0c\u628a\u53d8\u91cf\u653e\u5230\u5168\u5c40\u7684\u6570\u7ec4\u91cc\u9762\uff0c\u6700\u540e\u6211\u4eec\u5c31\u53ef\u4ee5\u77e5\u9053\u6709\u591a\u5c11\u53d8\u91cf\u53d1\u751f\u4e86\u66ff\u6362\u3002 \u6b65\u9aa4\u5c31\u662f\u8fd9\u4e48\u7b80\u5355\u660e\u4e86\uff0c\u7531\u4e8e\u80af\u5b9a\u4f1a\u5b58\u5728\u4e00\u4e9b\u53d8\u91cf\u540d\u91cd\u590d\u7684\u95ee\u9898\uff0c\u6240\u4ee5\u8fd9\u4e2a\u529f\u80fd\uff0c\u4e5f\u5f80\u5f80\u53ea\u662f\u7528\u6765 \u53c2\u8003 \u800c\u5df2\u3002\u5e76\u4e14\u8fd8\u4f1a\u5b58\u5728\u4e00\u4e2a\u95ee\u9898\uff1a \u5bf9\u4e8e\u5b57\u7b26\u4e32\u7ec4\u5408\u7684\u6570\u636e\uff0c\u662f\u4e0d\u80fd\u591f\u5f88\u597d\u652f\u6301\u7684 \u3002 \u6bd4\u5982\u6211\u7684\u4e00\u4e2a\u6570\u636e\u662f\u8fd9\u6837\u7684: { \"a\" : \"123456\" } \u6211\u5e0c\u671b\u4ed6\u80fd\u591f\u88ab\u66ff\u6362\u4e3a: {\"a\": \"${response.data.token}456\"} \u8fd9\u6837\u7531\u4e8e \u5b57\u7b26\u4e32 \u9700\u8981\u505a\u6bd4\u8f83\u590d\u6742\u7684\u64cd\u4f5c\uff0c\u6240\u4ee5\u6211\u4eec\u8fd9\u91cc\u6682\u65f6\u4e0d\u652f\u6301\uff0c\u53ea\u8fdb\u884c \u5168\u5339\u914d \u3002 \u5f00\u59cb\u884c\u52a8 \u8bf4\u4e86\u4e0a\u9762\u8fd9\u4e48\u591a\uff0c\u6211\u4eec\u5c31\u6765\u5f00\u59cb\u4e00\u6b65\u4e00\u4e2a\u811a\u5370\uff0c\u7f16\u5199\u4ee3\u7801\u5427~ \u7f16\u5199\u5ffd\u7565\u5b57\u6bb5\u76f8\u5173 \u56e0\u4e3aheaders\u91cc\u9762\u5f88\u591a\u90fd\u662f\u91cd\u590d\u7684\uff0c\u6211\u4eec\u6700\u597d\u662f\u5ffd\u7565\u4ed6\u4eec\u3002 class CaseGenerator ( object ): # \u5ffd\u7565\u7684\u5b57\u6bb5 ignored = ( \"Content-Type\" , \"Connection\" , \"Date\" , \"Content-Length\" , \"Host\" , \"access-control-allow-credentials\" , \"access-control-allow-origin\" , \"User-Agent\" , \"Server\" ) @staticmethod def ignore ( key : str ): for ig in CaseGenerator . ignored : if key . lower () . endswith ( ig . lower ()): return True return False \u7f16\u5199\u5b58\u50a8\u76f8\u5173 \u8fd9\u91cc\u6d89\u53ca\u5230\u4e86dfs\uff0c\u4e5f\u5c31\u662f\u6df1\u5ea6\u89e3\u6790JSON\u91cc\u9762\u7684key-value\uff0c\u5e76\u6700\u540e\u628a\u7ed3\u679c\u585e\u5165ans\uff0c\u4e5f\u5c31\u662f\u6211\u4eec\u5b58\u50a8\u53d8\u91cf\u7684\u5b57\u5178\u3002 @staticmethod def dfs ( body , path : str , ans : dict , headers : bool = False ): if isinstance ( body , list ): for i in range ( len ( body )): c_path = f \" { path } . { i } \" CaseGenerator . dfs ( body [ i ], c_path , ans , headers ) elif isinstance ( body , dict ): for k , v in body . items (): c_path = f \" { path } . { k } \" CaseGenerator . dfs ( v , c_path , ans , headers ) else : if not headers or not CaseGenerator . ignore ( path ): # \u5982\u679c\u662fbool\u503c\uff0c\u9700\u8981\u7279\u6b8a\u5904\u7406\u4e00\u4e0b\uff0c\u56e0\u4e3aPython get False/True\u4f1a\u53d8\u6210get 0 1 if isinstance ( body , bool ): ans [ str ( body )] . append ( path ) else : ans [ body ] . append ( path ) @staticmethod def split_body ( request : RequestInfo , ans : dict , var_name : str = '' ): if request . body : try : body = json . loads ( request . response_content ) CaseGenerator . dfs ( body , var_name , ans ) except JSONDecodeError : # \u53ef\u80fdbody\u4e0d\u662fJSON\uff0c\u8df3\u8fc7 pass except Exception as e : raise GenerateException ( f \"\u89e3\u6790\u63a5\u53e3body\u53d8\u91cf\u51fa\u9519: { e } \" ) @staticmethod def split_headers ( request : RequestInfo , ans : dict , var_name : str = \"\" ): try : CaseGenerator . dfs ( request . response_headers , var_name , ans , True ) except Exception as e : raise GenerateException ( f \"\u89e3\u6790\u63a5\u53e3headers\u53d8\u91cf\u51fa\u9519: { e } \" ) \u4e3b\u8981\u662f\u904d\u5386body\u548cheaders\uff0c\u5982\u679c\u4e0d\u662fJSON\u6570\u636e\uff0c\u76f4\u63a5\u5c31pass\u4e86\uff0c\u4e0d\u7ee7\u7eed\u89e3\u6790\u4e86\u3002 \u7f16\u5199\u4e3b\u4f53\u65b9\u6cd5 @staticmethod def extract_field ( requests : List [ RequestInfo ]) -> List [ str ]: \"\"\" \u904d\u5386\u63a5\u53e3\uff0c\u5e76\u63d0\u53d6\u5176\u4e2d\u7684\u53d8\u91cf :param requests: :return: \"\"\" var_pool = defaultdict ( list ) replaced = [] for i in range ( len ( requests )): # \u8bb0\u5f55\u53d8\u91cf CaseGenerator . record_vars ( requests [ i ], var_pool , f \"http_res_ { i + 1 } \" ) if i > 0 : CaseGenerator . replace_vars ( requests [ i ], var_pool , replaced ) return replaced @staticmethod def record_vars ( request : RequestInfo , ans : dict , var_name : str ): CaseGenerator . split_headers ( request , ans , f \" { var_name } .response_headers\" ) CaseGenerator . split_body ( request , ans , f \" { var_name } .response\" ) \u9488\u5bf9\u4e00\u4e2a\u4e2a\u63a5\u53e3\u8bf7\u6c42\uff0c\u6211\u4eec\u90fd\u4f1a\u904d\u5386\uff0c\u53ea\u6709\u5f53\u8bf7\u6c42\u662f\u7b2c\u4e8c\u4e2a\u4ee5\u540e\u7684\u8bf7\u6c42\uff0c\u6211\u4eec\u624d\u66ff\u6362\u6570\u636e\u3002 \u7f16\u5199\u66ff\u6362\u90e8\u5206 \u66ff\u6362\u90e8\u5206\u5206\u4e3a3\u90e8\u5206\uff0c\u66ff\u6362url\uff0cheaders\u548cbody\uff0c\u66ff\u6362body\u548c\u8bb0\u5f55response\u5176\u5b9e\u6bd4\u8f83\u76f8\u4f3c\uff0c\u90fd\u662fdfs\u904d\u5386json\u3002 @staticmethod def replace_vars ( request : RequestInfo , ans : dict , replaced : list ): CaseGenerator . replace_url ( request , ans , replaced ) CaseGenerator . replace_headers ( request , ans , replaced ) CaseGenerator . replace_body ( request , ans , replaced ) \u4ee5\u4e0a\u662f\u4e3b\u4f53\u65b9\u6cd5\uff0c\u6211\u4eec\u5148\u6765\u6253url\u8fd9\u4e2aboss: \u6211\u4eec\u77e5\u9053\uff0curl\u53c2\u6570\u90fd\u662f\u6709\u89c4\u5f8b\u7684\u5b58\u5728: \u534f\u8bae \u7279\u6b8a\u6807\u8bc6 url path\u53c2\u6570 query\u53c2\u6570 http/https :// www.baidu.com /:name/:id ?user=woody&handsome=true \u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u8fd9\u6837\u62c6\u5206url\uff0c\u5148\u6839\u636e?\u5207\u5272path\u53c2\u6570\u548cquery\u53c2\u6570\uff0c\u7136\u540e\u6839\u636e&\u5207\u5272query\u53c2\u6570\uff0c\u6b64\u65f6query\u53d8\u6210: [ \"user=woody\" , \"handsome=true\" ] \u5de6\u4fa7\u5219\u7ee7\u7eed\u6839\u636e/\u5207\u5272urlpath\uff0c\u6293\u53d6\u91cc\u9762\u7684\u53d8\u91cf\u3002\u5177\u4f53\u4ee3\u7801\u5982\u4e0b: @staticmethod def replace_url ( request : RequestInfo , ans : dict , replaced : list ): \"\"\" \u62c6\u89e3url\uff0c\u5c06url\u91cc\u9762\u7684\u8def\u7531path\u548cquery\u53c2\u6570 :return: \"\"\" # \u83b7\u53d6\u524d\u7f00\u548c\u540e\u7f00 url_query = request . url . split ( \"?\" ) # \u6ce8\u610f\u8fd9\u91cc\u8981\u5224\u65ad\uff0c\u5982\u679curl\u91cc\u9762\u6ca1\u6709?\uff0c\u4ee3\u8868query_list\u4e3a\u7a7a\u6570\u7ec4 if len ( url_query ) == 1 : query_list = list () prefix = url_query [ 0 ] else : prefix , suffix = url_query query_list = suffix . split ( \"&\" ) http , prefix = prefix . split ( \"//\" ) url_list = prefix . split ( \"/\" ) new_url = [] new_query = [] for u in url_list : if ans . get ( u ): new_url . append ( ans . get ( u )[ 0 ]) replaced . append ( \" %s => ${ %s }\" % ( u , ans . get ( u )[ 0 ])) else : new_url . append ( u ) for q in query_list : k , v = q . split ( \"=\" ) if ans . get ( v ): new_query . append ( \" %s =${ %s }\" % ( k , ans . get ( v )[ 0 ])) replaced . append ( \" %s => ${ %s }\" % ( k , ans . get ( v )[ 0 ])) else : new_query . append ( q ) # \u66ff\u6362\u6700\u7ec8\u751f\u6210\u7684url if len ( query_list ) == 0 : request . url = f \" { http } // { '/' . join ( new_url ) } \" return request . url = f \" { http } // { '/' . join ( new_url ) } ? { '&' . join ( new_query ) } \" \u63a5\u7740\u6211\u4eec\u8981\u7f16\u5199headers\u548cbody\u7684\u66ff\u6362: @staticmethod def replace_headers ( request : RequestInfo , ans : dict , replaced : list ): for k , v in request . request_headers . items (): if ans . get ( v ): request . request_headers [ k ] = \"${ %s }\" % ans . get ( v )[ 0 ] replaced . append ( \" %s => ${ %s }\" % ( k , ans . get ( v )[ 0 ])) @staticmethod def replace_body ( request : RequestInfo , ans : dict , replaced : list ): if request . body : try : data = json . loads ( request . body ) var_type = list () CaseGenerator . dfs_replace ( data , ans , var_type , replaced ) result = json . dumps ( data , ensure_ascii = False ) for v in var_type : result = result . replace ( f '\" { v } \"' , f \" { v } \" ) request . body = result except JSONDecodeError : pass except Exception as e : logger . error ( f \"\u8f6c\u6362body\u53d8\u91cf\u5931\u8d25: { e } \" ) @staticmethod def dfs_replace ( body , ans : dict , var_type : list , replaced : list ): if isinstance ( body , dict ): for k , v in body . items (): string , value = CaseGenerator . dfs_replace ( v , ans , var_type , replaced ) if value is not None : body [ k ] = \"${ %s }\" % value if not string : var_type . append ( \"${ %s }\" % value ) elif isinstance ( body , list ): for i in range ( len ( body )): string , value = CaseGenerator . dfs_replace ( body [ i ], ans , var_type , replaced ) if value is not None : body [ i ] = \"${ %s }\" % value if not string : var_type . append ( \"${ %s }\" % value ) else : body_str = body if isinstance ( body , bool ): body_str = str ( body ) if ans . get ( body_str ): replaced . append ( \" %s => ${ %s }\" % ( body_str , ans . get ( body_str )[ 0 ])) if not isinstance ( body_str , str ): return False , ans . get ( body_str )[ 0 ] return True , ans . get ( body_str )[ 0 ] return None , None dfs\u4e5f\u5c31\u662f\u6df1\u5ea6\u9012\u5f52\u7684\u65b9\u5f0f\uff0c\u627e\u5230\u5728ans\u91cc\u9762\u7684\u53d8\u91cf\uff0c\u5e76\u52a0\u5165\u5230replaced\uff08\u5df2\u88ab\u66ff\u6362\u7684\u6570\u636e\uff09\uff0c\u6211\u4eec\u9664\u6b64\u4e4b\u5916\u8fd8\u8981\u8bb0\u5f55\u53d8\u91cf\u662f\u5426\u662fstr\u7c7b\u578b\uff0c\u5982\u679c\u4e0d\u662f\uff0c\u6211\u4eec\u5219\u9700\u8981\u66ff\u6362\u4e3a ${\u53d8\u91cf} \uff0c\u5426\u5219\u9700\u8981\u66ff\u6362\u4e3a \"${\u53d8\u91cf}\" \uff0c\u7531\u4e8e\u6211\u4eec\u7684 \u5b57\u5178 \u4e0d\u652f\u6301\u8fd9\u6837\u7684\u6570\u636e: { \"a\" : $ { respo nse .da ta . t oke n }} \u6240\u4ee5\u6211\u4eec\u9700\u8981\u5148\u8f6c\u4e3a\u5b57\u7b26\u4e32\uff0c\u518d\u4f7f\u7528 \u5b57\u7b26\u4e32 replace\u65b9\u6cd5\uff0c\u6240\u4ee5\u8fd9\u91cc\u9700\u8981\u8bb0\u5f55\u4ed6\u662f\u4e0d\u662f\u5b57\u7b26\u4e32\u7c7b\u578b\uff0c\u8fd9\u91cc\u53ef\u80fd\u6bd4\u8f83\u7ed5\u4e00\u70b9\u3002 \u6d4b\u8bd5\u4e00\u4e0b\u5427 \u6211\u7279\u610f\u5f55\u5236\u4e86\u4e00\u4e2ahar\u6587\u4ef6\uff0c\u662f\u8fd9\u6837\u64cd\u4f5c\u7684: \u767b\u5f55pity \u521b\u5efapity\u9879\u76ee\uff0c\u5e76\u628a\u9879\u76ee\u540d\u79f0\u6539\u4e3a\u6211\u7684 \u7528\u6237\u540d\u79f0 \uff0c\u8fd9\u6837\u767b\u5f55\u540e\u7684\u7528\u6237\u4fe1\u606f\u5c31\u5e94\u8be5\u4f1a\u88ab\u66ff\u6362\u5230project_name\u8fd9\u4e2a\u5b57\u6bb5\u91cc\u9762 \u8bdd\u4e0d\u591a\u8bf4\uff0c\u6211\u4eec\u6765\u770b\u770b\u6548\u679c: if __name__ == \"__main__\" : req = HarConvertor . convert ( \"./pity.fun.har\" , \"api.pity.fun\" ) print ( req ) CaseGenerator . extract_field ( req ) print ( req ) \u9996\u5148\u53ef\u4ee5\u770b\u5230\u7684\u662f\uff0ctoken\u5df2\u7ecf\u88ab\u66ff\u6362\u6210\u529f\u4e86\uff0c\u63a5\u7740\u6765\u6211\u4eec\u6765\u786e\u5b9a\u4e0b \u9879\u76ee \u90a3\u5757\u3002 \u8fd9\u662f\u6539\u9020\u4e4b\u524d\u7684body\u5185\u5bb9\uff0c\u6211\u4eec\u641c\u4e0b\u4e0b\u9762\u7684\u90e8\u5206\uff08\u56e0\u4e3aRequestInfo\u6253\u5370\u7684\u65f6\u5019\uff0c\u662f\u5b57\u5178\u7684\u5f62\u5f0f\uff0c\u6240\u4ee5\u987a\u5e8f\u6bd4\u8f83\u6df7\u4e71\u53ef\u80fd\uff09 \u6240\u4ee5\u6211\u8fd9\u8fb9\u5206\u4e862\u6b21\u6253\u5370\uff0c\u66ff\u6362\u524d\u540e\u90fd\u6253\u5370\u4e86\u3002\u53ef\u4ee5\u770b\u5230\uff0c\u6211\u4eec\u7684woody\u548c\u7c73\u6d1b\u90fd\u88ab\u66ff\u6362\u6210\u4e86 \u767b\u5f55\u63a5\u53e3 \u7684response\u90e8\u5206\u3002 \u6700\u540e\u6211\u4eec\u6765\u770b\u770breplaced\u91cc\u9762\u7684\u5185\u5bb9\uff1a \u53ef\u4ee5\u770b\u5230\u91cc\u9762\u66ff\u6362\u4e86woody\uff0c\u66ff\u6362\u4e86\u7c73\u6d1b\uff0c\u4e5f\u66ff\u6362\u4e86\u5176\u4ed6\u7684\u4e00\u4e9b\u5305\u62ecuserId\u4e4b\u7c7b\u7684\u6570\u636e\uff0c\u66ff\u63621\u5904\u5373\u63d2\u5165\u4e00\u6761\u6570\u636e\u3002 \u540e\u7eed\u6211\u4eec\u9700\u8981\u628a\u66ff\u6362\u7684\u8be6\u60c5\u5c55\u793a\u7ed9\u7528\u6237\uff0c\u8ba9\u4ed6\u4eec\u77e5\u9053\u54ea\u91cc\u505a\u4e86\u66ff\u6362\u3002\u518d\u7136\u540e\uff0c\u6211\u4eec\u5c31\u5f97\u5f00\u59cb\u628a\u8fd9\u4e9b\u5185\u5bb9\u8f6c\u6362\u4e3a case+http\u524d\u7f6e\u90e8\u5206 \u4e86\uff0c\u8fd9\u65e0\u7591\u4f1a\u6781\u5927\u5730\u63d0\u9ad8\u7f16\u5199case\u7684\u6548\u7387\u3002 \u4eca\u5929\u7684\u5185\u5bb9\u6bd4\u8f83\u4e30\u5bcc\uff0c\u5927\u5bb6\u53ef\u4ee5\u5148\u6d88\u5316\u6d88\u5316~","title":"137.\u63d0\u53d6\u591a\u4e2a\u63a5\u53e3\u4e2d\u7684\u53c2\u6570"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28137%29%20%E6%8F%90%E5%8F%96%E5%A4%9A%E4%B8%AA%E6%8E%A5%E5%8F%A3%E4%B8%AD%E7%9A%84%E5%8F%82%E6%95%B0/#_1","text":"\u4e0a\u4e00\u8282\u6211\u4eec\u5b8c\u6210\u4e86 \u524d\u7f6e\u6761\u4ef6 \u652f\u6301http\u8bf7\u6c42\u7684\u5185\u5bb9\uff0c\u8fd9\u4e00\u8282\u6211\u4eec\u7ee7\u7eed\u5f00\u59cb\u7814\u7a76\u591a\u63a5\u53e3\u4e4b\u95f4\u53c2\u6570\u63d0\u53d6\u7684\u95ee\u9898\u3002 \u7531\u4e8e\u4e4b\u524d\u6211\u4eec\u5df2\u7ecf\u80fd\u591f\u628ahar\u7684\u6570\u636e\u8f6c\u4e3a\u6211\u4eec\u81ea\u8eab\u7684RequestInfo\u4e86\uff0c\u52a0\u4e0a\u5df2\u7ecf\u5b8c\u6210\u4e86http\u8bf7\u6c42\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u5f00\u59cb\u8003\u8651\u63d0\u53d6\u591a\u4e2aRequestInfo\u91cc\u9762\u7684\u53c2\u6570\u4e86\u3002","title":"\u56de\u987e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28137%29%20%E6%8F%90%E5%8F%96%E5%A4%9A%E4%B8%AA%E6%8E%A5%E5%8F%A3%E4%B8%AD%E7%9A%84%E5%8F%82%E6%95%B0/#_2","text":"\u5728\u6b64\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u7a0d\u5fae\u634b\u4e00\u634b\u5927\u4f53\u7684\u601d\u8def\uff0c\u6211\u7684\u60f3\u6cd5\u662f\u8fd9\u6837\u7684\uff0c\u5f53\u7136\u80af\u5b9a\u4f1a\u6709\u4e00\u4e9b\u4e0d\u5b8c\u5584\u7684\u5730\u65b9\uff0c\u800c\u4e14\u8fd9\u5757\u5185\u5bb9\u4e5f\u662f\u4e00\u4e2a\u521d\u7248\uff0c\u540e\u7eed\u53ef\u80fd\u4f1a\u6709\u6539\u52a8\u3002 \u524d\u63d0 \u5148\u8bf4\u4e00\u4e0b\u6211\u4eec\u505a\u8fd9\u4e2a\u5de5\u4f5c\u7684\u524d\u63d0\uff0c\u6211\u4eec\u9700\u8981\u505a\u5230\u6700\u6838\u5fc3\u76842\u4e2a\u4e8b\u60c5: \u5b58\u50a8\u6bcf\u4e2a\u8bf7\u6c42\u4e2d\u53ef\u80fd\u4f1a\u88ab\u4e0b\u4e2a\u8bf7\u6c42\u4f7f\u7528\u5230\u7684\u53d8\u91cf \u8bfb\u53d6\u5f53\u524d\u7684\u6570\u636e\uff0c\u770b\u662f\u5426\u5728\u4e0a\u4e2a\u8bf7\u6c42\u4e2d\u51fa\u73b0\u8fc7 \u641e\u6e05\u695a\u4e86\u8fd92\u70b9\uff0c\u6211\u611f\u89c9\u8fd9\u5757\u5185\u5bb9\u5c31\u4e0d\u4f1a\u5f88\u590d\u6742\u3002\u63a5\u7740\u662f\u6574\u4f53\u601d\u8def: \u904d\u5386RequestInfo\u6570\u7ec4\uff0c\u5e76\u5c06response\u548cresponse_headers\u91cc\u9762\u7684\u53d8\u91cf\u4ee5value-\u8def\u5f84\u7684\u5f62\u5f0f\u5b58\u50a8\u4e0b\u6765\uff0c\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u6211\u4eec\u767b\u5f55\u540e\u8fd4\u56de\u4ee5\u4e0bResponse: { \"code\" : 0 , \"data\" : { \"token\" : \"123\" } } \u8fd9\u65f6\u5019\u6211\u4eec\u9700\u8981\u5b58\u50a8\u7684map\u5c31\u53d8\u6210\u4e86\u8fd9\u6837: { \"123\" : \"response.data.token\" } \u8fd9\u65f6\u5019\u5c31\u6709\u4eba\u4f1a\u95ee\u4e86\uff0c\u5982\u679c\u5982\u679c\u51fa\u73b0\u91cd\u590d\u7684\u600e\u4e48\u529e\uff0c\u6bd4\u5982ABC3\u4e2a\u63a5\u53e3\u4f9d\u6b21\u8c03\u7528\uff0cA\u548cB\u4e2d\u90fd\u6709\u503c\u4e3a123\u7684\u6570\u636e\uff0c\u90a3\u8fd9\u4e2a\u76ee\u524d\u6211\u662f\u4ee5 \u7b2c\u4e00\u4e2a\u6570\u636e \u4e3a\u51c6\u3002 \u4f46\u662f\u4e3a\u4e86\u65b9\u4fbf\uff0c\u6211\u8fd8\u662f\u5b58\u653e\u4e86\u4e00\u4e2a\u6570\u7ec4\uff0c\u6240\u4ee5\u5f62\u5f0f\u4f1a\u662f: { \"123\" : [ \"response.data.token\" , \"response.data.xxx.token\" ]} \u8fd9\u6837\u662f\u4e3a\u4e86\u6269\u5c55\uff0c\u4e07\u4e00\u540e\u9762\u6211\u4e0d\u4ee5 \u7b2c\u4e00\u6761 \u6570\u636e\u4e3a\u51c6\u4e86\uff0c\u8d77\u7801\u6211\u51fa\u73b0\u8fc7123\u7684key\u90fd\u88ab\u8bb0\u5f55\u4e0b\u6765\u4e86\uff0c\u5230\u65f6\u5019\u6539\u52a8\u529f\u80fd\u4e5f\u4e0d\u6101\u6709\u4ec0\u4e48\u95ee\u9898\u3002 \u5f53\u8bf7\u6c42\u6570\u636e\u662f\u7b2c\u4e00\u6761\u6570\u636e\uff0c\u6211\u4eec\u4e0d\u4f1a\u505a\u53c2\u6570\u66ff\u6362\uff0c\u5426\u5219\u6211\u4eec\u8981\u904d\u5386body\u548curl\u4ee5\u53carequest_headers\uff0c\u56e0\u4e3a\u4e00\u822c\u6765\u8bf4\u53d8\u91cf\u90fd\u4f1a\u5728\u8fd93\u4e2a\u6570\u636e\u91cc\u9762\u3002\u63a5\u7740\u6211\u4eec\u627e\u5230\u53d8\u91cf\u7684\u65f6\u5019\uff0c\u628a\u53d8\u91cf\u653e\u5230\u5168\u5c40\u7684\u6570\u7ec4\u91cc\u9762\uff0c\u6700\u540e\u6211\u4eec\u5c31\u53ef\u4ee5\u77e5\u9053\u6709\u591a\u5c11\u53d8\u91cf\u53d1\u751f\u4e86\u66ff\u6362\u3002 \u6b65\u9aa4\u5c31\u662f\u8fd9\u4e48\u7b80\u5355\u660e\u4e86\uff0c\u7531\u4e8e\u80af\u5b9a\u4f1a\u5b58\u5728\u4e00\u4e9b\u53d8\u91cf\u540d\u91cd\u590d\u7684\u95ee\u9898\uff0c\u6240\u4ee5\u8fd9\u4e2a\u529f\u80fd\uff0c\u4e5f\u5f80\u5f80\u53ea\u662f\u7528\u6765 \u53c2\u8003 \u800c\u5df2\u3002\u5e76\u4e14\u8fd8\u4f1a\u5b58\u5728\u4e00\u4e2a\u95ee\u9898\uff1a \u5bf9\u4e8e\u5b57\u7b26\u4e32\u7ec4\u5408\u7684\u6570\u636e\uff0c\u662f\u4e0d\u80fd\u591f\u5f88\u597d\u652f\u6301\u7684 \u3002 \u6bd4\u5982\u6211\u7684\u4e00\u4e2a\u6570\u636e\u662f\u8fd9\u6837\u7684: { \"a\" : \"123456\" } \u6211\u5e0c\u671b\u4ed6\u80fd\u591f\u88ab\u66ff\u6362\u4e3a: {\"a\": \"${response.data.token}456\"} \u8fd9\u6837\u7531\u4e8e \u5b57\u7b26\u4e32 \u9700\u8981\u505a\u6bd4\u8f83\u590d\u6742\u7684\u64cd\u4f5c\uff0c\u6240\u4ee5\u6211\u4eec\u8fd9\u91cc\u6682\u65f6\u4e0d\u652f\u6301\uff0c\u53ea\u8fdb\u884c \u5168\u5339\u914d \u3002","title":"\u601d\u8def"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28137%29%20%E6%8F%90%E5%8F%96%E5%A4%9A%E4%B8%AA%E6%8E%A5%E5%8F%A3%E4%B8%AD%E7%9A%84%E5%8F%82%E6%95%B0/#_3","text":"\u8bf4\u4e86\u4e0a\u9762\u8fd9\u4e48\u591a\uff0c\u6211\u4eec\u5c31\u6765\u5f00\u59cb\u4e00\u6b65\u4e00\u4e2a\u811a\u5370\uff0c\u7f16\u5199\u4ee3\u7801\u5427~ \u7f16\u5199\u5ffd\u7565\u5b57\u6bb5\u76f8\u5173 \u56e0\u4e3aheaders\u91cc\u9762\u5f88\u591a\u90fd\u662f\u91cd\u590d\u7684\uff0c\u6211\u4eec\u6700\u597d\u662f\u5ffd\u7565\u4ed6\u4eec\u3002 class CaseGenerator ( object ): # \u5ffd\u7565\u7684\u5b57\u6bb5 ignored = ( \"Content-Type\" , \"Connection\" , \"Date\" , \"Content-Length\" , \"Host\" , \"access-control-allow-credentials\" , \"access-control-allow-origin\" , \"User-Agent\" , \"Server\" ) @staticmethod def ignore ( key : str ): for ig in CaseGenerator . ignored : if key . lower () . endswith ( ig . lower ()): return True return False \u7f16\u5199\u5b58\u50a8\u76f8\u5173 \u8fd9\u91cc\u6d89\u53ca\u5230\u4e86dfs\uff0c\u4e5f\u5c31\u662f\u6df1\u5ea6\u89e3\u6790JSON\u91cc\u9762\u7684key-value\uff0c\u5e76\u6700\u540e\u628a\u7ed3\u679c\u585e\u5165ans\uff0c\u4e5f\u5c31\u662f\u6211\u4eec\u5b58\u50a8\u53d8\u91cf\u7684\u5b57\u5178\u3002 @staticmethod def dfs ( body , path : str , ans : dict , headers : bool = False ): if isinstance ( body , list ): for i in range ( len ( body )): c_path = f \" { path } . { i } \" CaseGenerator . dfs ( body [ i ], c_path , ans , headers ) elif isinstance ( body , dict ): for k , v in body . items (): c_path = f \" { path } . { k } \" CaseGenerator . dfs ( v , c_path , ans , headers ) else : if not headers or not CaseGenerator . ignore ( path ): # \u5982\u679c\u662fbool\u503c\uff0c\u9700\u8981\u7279\u6b8a\u5904\u7406\u4e00\u4e0b\uff0c\u56e0\u4e3aPython get False/True\u4f1a\u53d8\u6210get 0 1 if isinstance ( body , bool ): ans [ str ( body )] . append ( path ) else : ans [ body ] . append ( path ) @staticmethod def split_body ( request : RequestInfo , ans : dict , var_name : str = '' ): if request . body : try : body = json . loads ( request . response_content ) CaseGenerator . dfs ( body , var_name , ans ) except JSONDecodeError : # \u53ef\u80fdbody\u4e0d\u662fJSON\uff0c\u8df3\u8fc7 pass except Exception as e : raise GenerateException ( f \"\u89e3\u6790\u63a5\u53e3body\u53d8\u91cf\u51fa\u9519: { e } \" ) @staticmethod def split_headers ( request : RequestInfo , ans : dict , var_name : str = \"\" ): try : CaseGenerator . dfs ( request . response_headers , var_name , ans , True ) except Exception as e : raise GenerateException ( f \"\u89e3\u6790\u63a5\u53e3headers\u53d8\u91cf\u51fa\u9519: { e } \" ) \u4e3b\u8981\u662f\u904d\u5386body\u548cheaders\uff0c\u5982\u679c\u4e0d\u662fJSON\u6570\u636e\uff0c\u76f4\u63a5\u5c31pass\u4e86\uff0c\u4e0d\u7ee7\u7eed\u89e3\u6790\u4e86\u3002 \u7f16\u5199\u4e3b\u4f53\u65b9\u6cd5 @staticmethod def extract_field ( requests : List [ RequestInfo ]) -> List [ str ]: \"\"\" \u904d\u5386\u63a5\u53e3\uff0c\u5e76\u63d0\u53d6\u5176\u4e2d\u7684\u53d8\u91cf :param requests: :return: \"\"\" var_pool = defaultdict ( list ) replaced = [] for i in range ( len ( requests )): # \u8bb0\u5f55\u53d8\u91cf CaseGenerator . record_vars ( requests [ i ], var_pool , f \"http_res_ { i + 1 } \" ) if i > 0 : CaseGenerator . replace_vars ( requests [ i ], var_pool , replaced ) return replaced @staticmethod def record_vars ( request : RequestInfo , ans : dict , var_name : str ): CaseGenerator . split_headers ( request , ans , f \" { var_name } .response_headers\" ) CaseGenerator . split_body ( request , ans , f \" { var_name } .response\" ) \u9488\u5bf9\u4e00\u4e2a\u4e2a\u63a5\u53e3\u8bf7\u6c42\uff0c\u6211\u4eec\u90fd\u4f1a\u904d\u5386\uff0c\u53ea\u6709\u5f53\u8bf7\u6c42\u662f\u7b2c\u4e8c\u4e2a\u4ee5\u540e\u7684\u8bf7\u6c42\uff0c\u6211\u4eec\u624d\u66ff\u6362\u6570\u636e\u3002 \u7f16\u5199\u66ff\u6362\u90e8\u5206 \u66ff\u6362\u90e8\u5206\u5206\u4e3a3\u90e8\u5206\uff0c\u66ff\u6362url\uff0cheaders\u548cbody\uff0c\u66ff\u6362body\u548c\u8bb0\u5f55response\u5176\u5b9e\u6bd4\u8f83\u76f8\u4f3c\uff0c\u90fd\u662fdfs\u904d\u5386json\u3002 @staticmethod def replace_vars ( request : RequestInfo , ans : dict , replaced : list ): CaseGenerator . replace_url ( request , ans , replaced ) CaseGenerator . replace_headers ( request , ans , replaced ) CaseGenerator . replace_body ( request , ans , replaced ) \u4ee5\u4e0a\u662f\u4e3b\u4f53\u65b9\u6cd5\uff0c\u6211\u4eec\u5148\u6765\u6253url\u8fd9\u4e2aboss: \u6211\u4eec\u77e5\u9053\uff0curl\u53c2\u6570\u90fd\u662f\u6709\u89c4\u5f8b\u7684\u5b58\u5728: \u534f\u8bae \u7279\u6b8a\u6807\u8bc6 url path\u53c2\u6570 query\u53c2\u6570 http/https :// www.baidu.com /:name/:id ?user=woody&handsome=true \u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u8fd9\u6837\u62c6\u5206url\uff0c\u5148\u6839\u636e?\u5207\u5272path\u53c2\u6570\u548cquery\u53c2\u6570\uff0c\u7136\u540e\u6839\u636e&\u5207\u5272query\u53c2\u6570\uff0c\u6b64\u65f6query\u53d8\u6210: [ \"user=woody\" , \"handsome=true\" ] \u5de6\u4fa7\u5219\u7ee7\u7eed\u6839\u636e/\u5207\u5272urlpath\uff0c\u6293\u53d6\u91cc\u9762\u7684\u53d8\u91cf\u3002\u5177\u4f53\u4ee3\u7801\u5982\u4e0b: @staticmethod def replace_url ( request : RequestInfo , ans : dict , replaced : list ): \"\"\" \u62c6\u89e3url\uff0c\u5c06url\u91cc\u9762\u7684\u8def\u7531path\u548cquery\u53c2\u6570 :return: \"\"\" # \u83b7\u53d6\u524d\u7f00\u548c\u540e\u7f00 url_query = request . url . split ( \"?\" ) # \u6ce8\u610f\u8fd9\u91cc\u8981\u5224\u65ad\uff0c\u5982\u679curl\u91cc\u9762\u6ca1\u6709?\uff0c\u4ee3\u8868query_list\u4e3a\u7a7a\u6570\u7ec4 if len ( url_query ) == 1 : query_list = list () prefix = url_query [ 0 ] else : prefix , suffix = url_query query_list = suffix . split ( \"&\" ) http , prefix = prefix . split ( \"//\" ) url_list = prefix . split ( \"/\" ) new_url = [] new_query = [] for u in url_list : if ans . get ( u ): new_url . append ( ans . get ( u )[ 0 ]) replaced . append ( \" %s => ${ %s }\" % ( u , ans . get ( u )[ 0 ])) else : new_url . append ( u ) for q in query_list : k , v = q . split ( \"=\" ) if ans . get ( v ): new_query . append ( \" %s =${ %s }\" % ( k , ans . get ( v )[ 0 ])) replaced . append ( \" %s => ${ %s }\" % ( k , ans . get ( v )[ 0 ])) else : new_query . append ( q ) # \u66ff\u6362\u6700\u7ec8\u751f\u6210\u7684url if len ( query_list ) == 0 : request . url = f \" { http } // { '/' . join ( new_url ) } \" return request . url = f \" { http } // { '/' . join ( new_url ) } ? { '&' . join ( new_query ) } \" \u63a5\u7740\u6211\u4eec\u8981\u7f16\u5199headers\u548cbody\u7684\u66ff\u6362: @staticmethod def replace_headers ( request : RequestInfo , ans : dict , replaced : list ): for k , v in request . request_headers . items (): if ans . get ( v ): request . request_headers [ k ] = \"${ %s }\" % ans . get ( v )[ 0 ] replaced . append ( \" %s => ${ %s }\" % ( k , ans . get ( v )[ 0 ])) @staticmethod def replace_body ( request : RequestInfo , ans : dict , replaced : list ): if request . body : try : data = json . loads ( request . body ) var_type = list () CaseGenerator . dfs_replace ( data , ans , var_type , replaced ) result = json . dumps ( data , ensure_ascii = False ) for v in var_type : result = result . replace ( f '\" { v } \"' , f \" { v } \" ) request . body = result except JSONDecodeError : pass except Exception as e : logger . error ( f \"\u8f6c\u6362body\u53d8\u91cf\u5931\u8d25: { e } \" ) @staticmethod def dfs_replace ( body , ans : dict , var_type : list , replaced : list ): if isinstance ( body , dict ): for k , v in body . items (): string , value = CaseGenerator . dfs_replace ( v , ans , var_type , replaced ) if value is not None : body [ k ] = \"${ %s }\" % value if not string : var_type . append ( \"${ %s }\" % value ) elif isinstance ( body , list ): for i in range ( len ( body )): string , value = CaseGenerator . dfs_replace ( body [ i ], ans , var_type , replaced ) if value is not None : body [ i ] = \"${ %s }\" % value if not string : var_type . append ( \"${ %s }\" % value ) else : body_str = body if isinstance ( body , bool ): body_str = str ( body ) if ans . get ( body_str ): replaced . append ( \" %s => ${ %s }\" % ( body_str , ans . get ( body_str )[ 0 ])) if not isinstance ( body_str , str ): return False , ans . get ( body_str )[ 0 ] return True , ans . get ( body_str )[ 0 ] return None , None dfs\u4e5f\u5c31\u662f\u6df1\u5ea6\u9012\u5f52\u7684\u65b9\u5f0f\uff0c\u627e\u5230\u5728ans\u91cc\u9762\u7684\u53d8\u91cf\uff0c\u5e76\u52a0\u5165\u5230replaced\uff08\u5df2\u88ab\u66ff\u6362\u7684\u6570\u636e\uff09\uff0c\u6211\u4eec\u9664\u6b64\u4e4b\u5916\u8fd8\u8981\u8bb0\u5f55\u53d8\u91cf\u662f\u5426\u662fstr\u7c7b\u578b\uff0c\u5982\u679c\u4e0d\u662f\uff0c\u6211\u4eec\u5219\u9700\u8981\u66ff\u6362\u4e3a ${\u53d8\u91cf} \uff0c\u5426\u5219\u9700\u8981\u66ff\u6362\u4e3a \"${\u53d8\u91cf}\" \uff0c\u7531\u4e8e\u6211\u4eec\u7684 \u5b57\u5178 \u4e0d\u652f\u6301\u8fd9\u6837\u7684\u6570\u636e: { \"a\" : $ { respo nse .da ta . t oke n }} \u6240\u4ee5\u6211\u4eec\u9700\u8981\u5148\u8f6c\u4e3a\u5b57\u7b26\u4e32\uff0c\u518d\u4f7f\u7528 \u5b57\u7b26\u4e32 replace\u65b9\u6cd5\uff0c\u6240\u4ee5\u8fd9\u91cc\u9700\u8981\u8bb0\u5f55\u4ed6\u662f\u4e0d\u662f\u5b57\u7b26\u4e32\u7c7b\u578b\uff0c\u8fd9\u91cc\u53ef\u80fd\u6bd4\u8f83\u7ed5\u4e00\u70b9\u3002","title":"\u5f00\u59cb\u884c\u52a8"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28137%29%20%E6%8F%90%E5%8F%96%E5%A4%9A%E4%B8%AA%E6%8E%A5%E5%8F%A3%E4%B8%AD%E7%9A%84%E5%8F%82%E6%95%B0/#_4","text":"\u6211\u7279\u610f\u5f55\u5236\u4e86\u4e00\u4e2ahar\u6587\u4ef6\uff0c\u662f\u8fd9\u6837\u64cd\u4f5c\u7684: \u767b\u5f55pity \u521b\u5efapity\u9879\u76ee\uff0c\u5e76\u628a\u9879\u76ee\u540d\u79f0\u6539\u4e3a\u6211\u7684 \u7528\u6237\u540d\u79f0 \uff0c\u8fd9\u6837\u767b\u5f55\u540e\u7684\u7528\u6237\u4fe1\u606f\u5c31\u5e94\u8be5\u4f1a\u88ab\u66ff\u6362\u5230project_name\u8fd9\u4e2a\u5b57\u6bb5\u91cc\u9762 \u8bdd\u4e0d\u591a\u8bf4\uff0c\u6211\u4eec\u6765\u770b\u770b\u6548\u679c: if __name__ == \"__main__\" : req = HarConvertor . convert ( \"./pity.fun.har\" , \"api.pity.fun\" ) print ( req ) CaseGenerator . extract_field ( req ) print ( req ) \u9996\u5148\u53ef\u4ee5\u770b\u5230\u7684\u662f\uff0ctoken\u5df2\u7ecf\u88ab\u66ff\u6362\u6210\u529f\u4e86\uff0c\u63a5\u7740\u6765\u6211\u4eec\u6765\u786e\u5b9a\u4e0b \u9879\u76ee \u90a3\u5757\u3002 \u8fd9\u662f\u6539\u9020\u4e4b\u524d\u7684body\u5185\u5bb9\uff0c\u6211\u4eec\u641c\u4e0b\u4e0b\u9762\u7684\u90e8\u5206\uff08\u56e0\u4e3aRequestInfo\u6253\u5370\u7684\u65f6\u5019\uff0c\u662f\u5b57\u5178\u7684\u5f62\u5f0f\uff0c\u6240\u4ee5\u987a\u5e8f\u6bd4\u8f83\u6df7\u4e71\u53ef\u80fd\uff09 \u6240\u4ee5\u6211\u8fd9\u8fb9\u5206\u4e862\u6b21\u6253\u5370\uff0c\u66ff\u6362\u524d\u540e\u90fd\u6253\u5370\u4e86\u3002\u53ef\u4ee5\u770b\u5230\uff0c\u6211\u4eec\u7684woody\u548c\u7c73\u6d1b\u90fd\u88ab\u66ff\u6362\u6210\u4e86 \u767b\u5f55\u63a5\u53e3 \u7684response\u90e8\u5206\u3002 \u6700\u540e\u6211\u4eec\u6765\u770b\u770breplaced\u91cc\u9762\u7684\u5185\u5bb9\uff1a \u53ef\u4ee5\u770b\u5230\u91cc\u9762\u66ff\u6362\u4e86woody\uff0c\u66ff\u6362\u4e86\u7c73\u6d1b\uff0c\u4e5f\u66ff\u6362\u4e86\u5176\u4ed6\u7684\u4e00\u4e9b\u5305\u62ecuserId\u4e4b\u7c7b\u7684\u6570\u636e\uff0c\u66ff\u63621\u5904\u5373\u63d2\u5165\u4e00\u6761\u6570\u636e\u3002 \u540e\u7eed\u6211\u4eec\u9700\u8981\u628a\u66ff\u6362\u7684\u8be6\u60c5\u5c55\u793a\u7ed9\u7528\u6237\uff0c\u8ba9\u4ed6\u4eec\u77e5\u9053\u54ea\u91cc\u505a\u4e86\u66ff\u6362\u3002\u518d\u7136\u540e\uff0c\u6211\u4eec\u5c31\u5f97\u5f00\u59cb\u628a\u8fd9\u4e9b\u5185\u5bb9\u8f6c\u6362\u4e3a case+http\u524d\u7f6e\u90e8\u5206 \u4e86\uff0c\u8fd9\u65e0\u7591\u4f1a\u6781\u5927\u5730\u63d0\u9ad8\u7f16\u5199case\u7684\u6548\u7387\u3002 \u4eca\u5929\u7684\u5185\u5bb9\u6bd4\u8f83\u4e30\u5bcc\uff0c\u5927\u5bb6\u53ef\u4ee5\u5148\u6d88\u5316\u6d88\u5316~","title":"\u6d4b\u8bd5\u4e00\u4e0b\u5427"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28138%29%20%E5%AE%8C%E6%88%90%E7%94%A8%E4%BE%8B%E7%94%9F%E6%88%90%E5%8A%9F%E8%83%BD%28%E4%B8%8A%29/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u7f16\u5199\u4e86 \u63d0\u53d6\u53c2\u6570 \u90e8\u5206\uff0c\u6211\u4eec\u5df2\u7ecf\u53ef\u4ee5\u62ff\u5230\u7ec4\u6210\u4e00\u4e2a\u7528\u4f8b\u7684\u5168\u90e8\u6570\u636e\u4e86\u3002 \u63a5\u7740\u6211\u4eec\u5c31\u6765\u5b9e\u73b0\u5b83\u3002\u8001\u89c4\u77e9\uff0c\u5148\u634b\u4e00\u634b\u601d\u8def\u3002 \u601d\u8def \u6211\u4eec\u5728\u9875\u9762\u4e0a\u53ef\u4ee5\u5f55\u5236\u5230\u5177\u4f53\u7684\u63a5\u53e3\u53c2\u6570\uff0c\u5176\u5b9e\u6bcf\u4e00\u6761\u8bb0\u5f55\u90fd\u662fRequestInfo\u7684\u5177\u4f53\u8868\u73b0\u3002\u6240\u4ee5\uff0c\u6211\u4eec\u6839\u636e\u7528\u6237\u9009\u62e9\u7684RequestInfo\u6570\u7ec4\uff0c\u6309\u7167\u4ed6\u4eec\u7684\u987a\u5e8f\uff0c\u5c31\u53ef\u4ee5\u63d0\u53d6\u4e3a\u5177\u4f53\u7684\u7528\u4f8b\u6570\u636e\uff0c\u63a5\u7740\u6211\u4eec\u8c03\u7528\u4e4b\u524d\u7f16\u5199\u8fc7\u7684 \u63d0\u4ea4\u7528\u4f8b\u5168\u90e8\u6570\u636e \u65b9\u6cd5\u5c31\u5b8c\u4e8b\u4e86\u3002 \u8c03\u6574\u679a\u4e3e\u7c7b \u5728\u6b64\u4e4b\u524d\uff0c\u6211\u505a\u4e86\u4e00\u4e2a \u6539\u52a8 \uff1a\u5c06\u66fe\u7ecfconfig.py\u91cc\u9762\u7684\u679a\u4e3e\u7c7b\u6216\u8005\u5b50\u7c7b\u90fd\u62bd\u79bb\u51fa\u6765\uff0c\u653e\u5230 enums \u6587\u4ef6\u5939\u3002 \u8fd9\u91cc\u5c31\u4e0d\u5f97\u4e0d\u601d\u8003\u4e00\u4e0b\u8fd9\u6837\u505a\u7684\u597d\u5904\uff0c\u6700\u8fd1\u51e0\u5929\u4e5f\u662f\u611f\u609f\u4e86\u4e00\u4e9b\uff0c\u4ee5\u4e0b\u662f\u6211\u7684\u4e2a\u4eba\u770b\u6cd5\u3002 \u6709\u4e2a\u670b\u53cb\u4e00\u76f4\u5f88\u7ea0\u7ed3\u4e8e\u4ed6\u7684\u9879\u76ee\u76ee\u5f55\u8bbe\u8ba1\uff0c\u6211\u4ed4\u7ec6\u8003\u8651\u4e86\u4e00\u4e0b\uff0c\u5f97\u51fa\u4e86\u4ee5\u4e0b\u7684\u770b\u6cd5\uff08\u4e2a\u4eba\u89c2\u70b9\uff09\uff1a \u6bcf\u4e2a\u4eba\u90fd\u4f1a\u6709\u81ea\u5df1\u7684\u547d\u540d\u4e60\u60ef\u6216\u8005\u76ee\u5f55\u89c4\u8303\uff0c\u6bd4\u5982\u6709\u7684\u4eba\u559c\u6b22\u7528util\u6709\u7684\u559c\u6b22\u7528utils\uff0c\u6216\u8005\u8bf4\u6709\u7684\u4eba\u559c\u6b22dao dto entity\u7b49Java\u98ce\u683c\u7684\u547d\u540d\uff0c\u6709\u7684\u559c\u6b22\u7528src\uff0cinternal\u8fd9\u6837\u7684\u5185\u90e8\u5305\u547d\u540d\u3002\u4f46\u8fd9\u4e9b\uff0c\u5176\u5b9e\u90fd\u4e0d\u662f\u6700\u91cd\u8981\u7684\u3002 \u6240\u8c13 \u89c4\u8303 \uff0c\u5176\u5b9e\u5c31\u662f\u4e3a\u4e86\u7ed9\u5176\u4ed6\u4eba\u7406\u89e3\uff0c\u5e76\u66f4\u597d\u5730\u5bf9\u4ee3\u7801\u6587\u4ef6\u5206\u7c7b\uff0c\u6bd4\u5982\u6211\u8fd9\u91cc\u6709\u4e2aenums\u6587\u4ef6\u5939\uff0c\u90a3\u4e48\u4e0d\u7528\u60f3\uff0c\u8fdb\u53bb\u5c31\u77e5\u9053\u4ed6\u662f\u653e\u679a\u4e3e\u7c7b\u7684\uff0c\u5982\u679c\u6211\u653e\u4e00\u4e2aorm\u5728\u91cc\u9762\uff0c\u90a3\u81ea\u7136\u662f\u4e0d\u5408\u9002\u7684\u3002\u6240\u4ee5\u57fa\u672c\u7684\u76ee\u5f55\u542b\u4e49\u6ee1\u8db3\u4e86\uff0c\u4e5f\u5c31\u6ca1\u5fc5\u8981\u8fc7\u4e8e\u7ea0\u7ed3\u76ee\u5f55\u89c4\u4e0d\u89c4\u8303\u4e86\u3002\u5982\u679c\u4f5c\u4e3a\u4e00\u4e2a\u56e2\u961f\uff0c\u56e2\u961f\u80af\u5b9a\u6709\u5bf9\u5e94\u7684\u89c4\u8303\uff0c\u5982\u679c\u662f\u4e2a\u4eba\uff0c\u90a3\u4f60\u81ea\u5df1\u5c31\u662f\u89c4\u8303\u3002 \u6dfb\u52a02\u4e2a\u679a\u4e3e\u7c7b app/enums/CaseStatusEnum.py # 1: \u8c03\u8bd5\u4e2d 2: \u6682\u65f6\u5173\u95ed 3: \u6b63\u5e38\u8fd0\u4f5c from enum import IntEnum class CaseStatus ( IntEnum ): debugging = 1 closed = 2 running = 3 app/enums/RequestTypeEnum.py from enum import IntEnum class RequestType ( IntEnum ): http = 1 grpc = 2 dubbo = 3 websocket = 4 \u628aRequestInfo\u653e\u5165schema \u7531\u4e8eRequestInfo\u5728\u7528\u4f8b\u751f\u6210\u9875\u9762\u5373\u5c06\u6210\u4e3a\u4e00\u4e2a \u5165\u53c2 \uff0c\u6240\u4ee5\u4ed6\u662f\u9002\u5408\u653e\u5230schema\u7684: __author__ = \"woody\" import json from typing import TypeVar import pydantic from loguru import logger \"\"\" translate mitmproxy request and response data \"\"\" body = TypeVar ( \"body\" , bytes , str ) class RequestInfo ( pydantic . BaseModel ): url : str body : str request_method : str # request_data: str request_headers : dict response_headers : dict cookies : dict request_cookies : dict response_content : str status_code : int def __init__ ( self , flow = None , ** kwargs ): if flow : kwargs . update ( dict ( status_code = flow . response . status_code , url = flow . request . url , request_method = flow . request . method , request_headers = dict ( flow . request . headers ), response_headers = dict ( flow . response . headers ), response_content = self . get_response ( flow . response ), body = self . get_body ( flow . request ), cookies = dict ( flow . response . cookies ), request_cookies = dict ( flow . request . cookies ), )) super () . __init__ ( ** kwargs ) def from_dict ( self , ** kwargs ): for k , v in kwargs : if not hasattr ( self , k ): raise Exception ( f \"set RequestInfo error, no field: { k } \" ) setattr ( self , k , v ) @classmethod def translate_json ( cls , text ): try : return json . dumps ( json . loads ( text ), indent = 4 , ensure_ascii = False ) except Exception as e : logger . bind ( name = None ) . warning ( f \"\u89e3\u6790json\u683c\u5f0f\u8bf7\u6c42\u5931\u8d25: { e } \" ) return text @classmethod def get_response ( cls , response ): content_type = response . headers . get ( \"Content-Type\" ) if \"json\" in content_type . lower (): return cls . translate_json ( response . text ) if \"text\" in content_type . lower () or \"xml\" in content_type . lower (): return response . text return response . data . decode ( 'utf-8' ) @classmethod def get_body ( cls , request ): if len ( request . content ) == 0 : return '' content_type = request . headers . get ( \"Content-Type\" ) if \"json\" in content_type . lower (): return cls . translate_json ( request . text ) if \"text\" in content_type . lower () or \"xml\" in content_type . lower (): return request . text return request . data . decode ( 'utf-8' ) def dumps ( self ): return json . dumps ( self . dict (), ensure_ascii = False ) \u57fa\u672c\u662f\u4eceapp/core/request/request.py\u91cc\u9762\u62f7\u8d1d\u6765\u7684\u4ee3\u7801\uff0c\u4e0d\u8fc7\u8fd9\u91cc\u591a\u4e86\u4e00\u79cd\u60c5\u51b5: \u7531\u4e8epydantic\u7684\u521d\u59cb\u5316\u4e0d\u9002\u914dmitmproxy\u7684\u521d\u59cb\u5316\uff0c\u4e5f\u5c31\u662fflow\u4e0e\u666e\u901a\u7684__init__()\uff0c\u6240\u4ee5\u6211\u8fd9\u628a\u8fdb\u884c\u4e86\u4e00\u4e0b\u5224\u65ad\u3002 \u5982\u679c\u6709flow\uff0c\u8bf4\u660e\u662f \u5f55\u5236 \u7684\u65f6\u5019)\uff0c\u5426\u5219\u8bf4\u660e\u662f\u8bf7\u6c42\u53c2\u6570\u521d\u59cb\u5316\u7684\u65f6\u5019\u3002 testcase_schema.py\u65b0\u589e\u4e00\u4e2a\u7c7b class TestCaseGeneratorForm ( BaseModel ): directory_id : int requests : List [ RequestInfo ] \u7531\u4e8e\u4e00\u4e2a\u7528\u4f8b\u5fc5\u987b\u6709\u81ea\u5df1\u5f52\u5c5e\u7684 \u76ee\u5f55 \uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u4e3a\u5b83\u5f52\u5c5e\u4e00\u4e2a\u76ee\u5f55\uff0c\u5176\u5b9e\u8fd8\u9700\u8981\u7528\u4f8b\u540d\u79f0\u7b49\u7b49\uff0c\u4f46\u6211\u4eec\u76ee\u524d\u53ea\u505a\u4e00\u4e2a \u96cf\u5f62 \uff0c\u540e\u9762\u53ef\u4ee5\u6162\u6162\u5b8c\u5584\uff0c\u6bd4\u5982\u6211\u4eec\u7ed9\u4e00\u4e2a\u9ed8\u8ba4\u503c\u5c31\u597d\u4e86\u3002 \u65b0\u7684ide\u914d\u8272\u8fd8\u6709\u70b9\u4e0d\u4e60\u60ef\uff0c\u4eca\u5929\u7684\u5185\u5bb9\u5c31\u5230\u8fd9\u91cc\u4e86\uff0c\u4e0b\u4e00\u8282\u6211\u4eec\u7ee7\u7eed\u6df1\u5165\u3002","title":"138.\u5b8c\u6210\u7528\u4f8b\u751f\u6210\u529f\u80fd(\u4e0a)"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28138%29%20%E5%AE%8C%E6%88%90%E7%94%A8%E4%BE%8B%E7%94%9F%E6%88%90%E5%8A%9F%E8%83%BD%28%E4%B8%8A%29/#_1","text":"\u4e0a\u4e00\u8282\u6211\u4eec\u7f16\u5199\u4e86 \u63d0\u53d6\u53c2\u6570 \u90e8\u5206\uff0c\u6211\u4eec\u5df2\u7ecf\u53ef\u4ee5\u62ff\u5230\u7ec4\u6210\u4e00\u4e2a\u7528\u4f8b\u7684\u5168\u90e8\u6570\u636e\u4e86\u3002 \u63a5\u7740\u6211\u4eec\u5c31\u6765\u5b9e\u73b0\u5b83\u3002\u8001\u89c4\u77e9\uff0c\u5148\u634b\u4e00\u634b\u601d\u8def\u3002","title":"\u56de\u987e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28138%29%20%E5%AE%8C%E6%88%90%E7%94%A8%E4%BE%8B%E7%94%9F%E6%88%90%E5%8A%9F%E8%83%BD%28%E4%B8%8A%29/#_2","text":"\u6211\u4eec\u5728\u9875\u9762\u4e0a\u53ef\u4ee5\u5f55\u5236\u5230\u5177\u4f53\u7684\u63a5\u53e3\u53c2\u6570\uff0c\u5176\u5b9e\u6bcf\u4e00\u6761\u8bb0\u5f55\u90fd\u662fRequestInfo\u7684\u5177\u4f53\u8868\u73b0\u3002\u6240\u4ee5\uff0c\u6211\u4eec\u6839\u636e\u7528\u6237\u9009\u62e9\u7684RequestInfo\u6570\u7ec4\uff0c\u6309\u7167\u4ed6\u4eec\u7684\u987a\u5e8f\uff0c\u5c31\u53ef\u4ee5\u63d0\u53d6\u4e3a\u5177\u4f53\u7684\u7528\u4f8b\u6570\u636e\uff0c\u63a5\u7740\u6211\u4eec\u8c03\u7528\u4e4b\u524d\u7f16\u5199\u8fc7\u7684 \u63d0\u4ea4\u7528\u4f8b\u5168\u90e8\u6570\u636e \u65b9\u6cd5\u5c31\u5b8c\u4e8b\u4e86\u3002","title":"\u601d\u8def"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28138%29%20%E5%AE%8C%E6%88%90%E7%94%A8%E4%BE%8B%E7%94%9F%E6%88%90%E5%8A%9F%E8%83%BD%28%E4%B8%8A%29/#_3","text":"\u5728\u6b64\u4e4b\u524d\uff0c\u6211\u505a\u4e86\u4e00\u4e2a \u6539\u52a8 \uff1a\u5c06\u66fe\u7ecfconfig.py\u91cc\u9762\u7684\u679a\u4e3e\u7c7b\u6216\u8005\u5b50\u7c7b\u90fd\u62bd\u79bb\u51fa\u6765\uff0c\u653e\u5230 enums \u6587\u4ef6\u5939\u3002 \u8fd9\u91cc\u5c31\u4e0d\u5f97\u4e0d\u601d\u8003\u4e00\u4e0b\u8fd9\u6837\u505a\u7684\u597d\u5904\uff0c\u6700\u8fd1\u51e0\u5929\u4e5f\u662f\u611f\u609f\u4e86\u4e00\u4e9b\uff0c\u4ee5\u4e0b\u662f\u6211\u7684\u4e2a\u4eba\u770b\u6cd5\u3002 \u6709\u4e2a\u670b\u53cb\u4e00\u76f4\u5f88\u7ea0\u7ed3\u4e8e\u4ed6\u7684\u9879\u76ee\u76ee\u5f55\u8bbe\u8ba1\uff0c\u6211\u4ed4\u7ec6\u8003\u8651\u4e86\u4e00\u4e0b\uff0c\u5f97\u51fa\u4e86\u4ee5\u4e0b\u7684\u770b\u6cd5\uff08\u4e2a\u4eba\u89c2\u70b9\uff09\uff1a \u6bcf\u4e2a\u4eba\u90fd\u4f1a\u6709\u81ea\u5df1\u7684\u547d\u540d\u4e60\u60ef\u6216\u8005\u76ee\u5f55\u89c4\u8303\uff0c\u6bd4\u5982\u6709\u7684\u4eba\u559c\u6b22\u7528util\u6709\u7684\u559c\u6b22\u7528utils\uff0c\u6216\u8005\u8bf4\u6709\u7684\u4eba\u559c\u6b22dao dto entity\u7b49Java\u98ce\u683c\u7684\u547d\u540d\uff0c\u6709\u7684\u559c\u6b22\u7528src\uff0cinternal\u8fd9\u6837\u7684\u5185\u90e8\u5305\u547d\u540d\u3002\u4f46\u8fd9\u4e9b\uff0c\u5176\u5b9e\u90fd\u4e0d\u662f\u6700\u91cd\u8981\u7684\u3002 \u6240\u8c13 \u89c4\u8303 \uff0c\u5176\u5b9e\u5c31\u662f\u4e3a\u4e86\u7ed9\u5176\u4ed6\u4eba\u7406\u89e3\uff0c\u5e76\u66f4\u597d\u5730\u5bf9\u4ee3\u7801\u6587\u4ef6\u5206\u7c7b\uff0c\u6bd4\u5982\u6211\u8fd9\u91cc\u6709\u4e2aenums\u6587\u4ef6\u5939\uff0c\u90a3\u4e48\u4e0d\u7528\u60f3\uff0c\u8fdb\u53bb\u5c31\u77e5\u9053\u4ed6\u662f\u653e\u679a\u4e3e\u7c7b\u7684\uff0c\u5982\u679c\u6211\u653e\u4e00\u4e2aorm\u5728\u91cc\u9762\uff0c\u90a3\u81ea\u7136\u662f\u4e0d\u5408\u9002\u7684\u3002\u6240\u4ee5\u57fa\u672c\u7684\u76ee\u5f55\u542b\u4e49\u6ee1\u8db3\u4e86\uff0c\u4e5f\u5c31\u6ca1\u5fc5\u8981\u8fc7\u4e8e\u7ea0\u7ed3\u76ee\u5f55\u89c4\u4e0d\u89c4\u8303\u4e86\u3002\u5982\u679c\u4f5c\u4e3a\u4e00\u4e2a\u56e2\u961f\uff0c\u56e2\u961f\u80af\u5b9a\u6709\u5bf9\u5e94\u7684\u89c4\u8303\uff0c\u5982\u679c\u662f\u4e2a\u4eba\uff0c\u90a3\u4f60\u81ea\u5df1\u5c31\u662f\u89c4\u8303\u3002 \u6dfb\u52a02\u4e2a\u679a\u4e3e\u7c7b app/enums/CaseStatusEnum.py # 1: \u8c03\u8bd5\u4e2d 2: \u6682\u65f6\u5173\u95ed 3: \u6b63\u5e38\u8fd0\u4f5c from enum import IntEnum class CaseStatus ( IntEnum ): debugging = 1 closed = 2 running = 3 app/enums/RequestTypeEnum.py from enum import IntEnum class RequestType ( IntEnum ): http = 1 grpc = 2 dubbo = 3 websocket = 4","title":"\u8c03\u6574\u679a\u4e3e\u7c7b"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28138%29%20%E5%AE%8C%E6%88%90%E7%94%A8%E4%BE%8B%E7%94%9F%E6%88%90%E5%8A%9F%E8%83%BD%28%E4%B8%8A%29/#requestinfoschema","text":"\u7531\u4e8eRequestInfo\u5728\u7528\u4f8b\u751f\u6210\u9875\u9762\u5373\u5c06\u6210\u4e3a\u4e00\u4e2a \u5165\u53c2 \uff0c\u6240\u4ee5\u4ed6\u662f\u9002\u5408\u653e\u5230schema\u7684: __author__ = \"woody\" import json from typing import TypeVar import pydantic from loguru import logger \"\"\" translate mitmproxy request and response data \"\"\" body = TypeVar ( \"body\" , bytes , str ) class RequestInfo ( pydantic . BaseModel ): url : str body : str request_method : str # request_data: str request_headers : dict response_headers : dict cookies : dict request_cookies : dict response_content : str status_code : int def __init__ ( self , flow = None , ** kwargs ): if flow : kwargs . update ( dict ( status_code = flow . response . status_code , url = flow . request . url , request_method = flow . request . method , request_headers = dict ( flow . request . headers ), response_headers = dict ( flow . response . headers ), response_content = self . get_response ( flow . response ), body = self . get_body ( flow . request ), cookies = dict ( flow . response . cookies ), request_cookies = dict ( flow . request . cookies ), )) super () . __init__ ( ** kwargs ) def from_dict ( self , ** kwargs ): for k , v in kwargs : if not hasattr ( self , k ): raise Exception ( f \"set RequestInfo error, no field: { k } \" ) setattr ( self , k , v ) @classmethod def translate_json ( cls , text ): try : return json . dumps ( json . loads ( text ), indent = 4 , ensure_ascii = False ) except Exception as e : logger . bind ( name = None ) . warning ( f \"\u89e3\u6790json\u683c\u5f0f\u8bf7\u6c42\u5931\u8d25: { e } \" ) return text @classmethod def get_response ( cls , response ): content_type = response . headers . get ( \"Content-Type\" ) if \"json\" in content_type . lower (): return cls . translate_json ( response . text ) if \"text\" in content_type . lower () or \"xml\" in content_type . lower (): return response . text return response . data . decode ( 'utf-8' ) @classmethod def get_body ( cls , request ): if len ( request . content ) == 0 : return '' content_type = request . headers . get ( \"Content-Type\" ) if \"json\" in content_type . lower (): return cls . translate_json ( request . text ) if \"text\" in content_type . lower () or \"xml\" in content_type . lower (): return request . text return request . data . decode ( 'utf-8' ) def dumps ( self ): return json . dumps ( self . dict (), ensure_ascii = False ) \u57fa\u672c\u662f\u4eceapp/core/request/request.py\u91cc\u9762\u62f7\u8d1d\u6765\u7684\u4ee3\u7801\uff0c\u4e0d\u8fc7\u8fd9\u91cc\u591a\u4e86\u4e00\u79cd\u60c5\u51b5: \u7531\u4e8epydantic\u7684\u521d\u59cb\u5316\u4e0d\u9002\u914dmitmproxy\u7684\u521d\u59cb\u5316\uff0c\u4e5f\u5c31\u662fflow\u4e0e\u666e\u901a\u7684__init__()\uff0c\u6240\u4ee5\u6211\u8fd9\u628a\u8fdb\u884c\u4e86\u4e00\u4e0b\u5224\u65ad\u3002 \u5982\u679c\u6709flow\uff0c\u8bf4\u660e\u662f \u5f55\u5236 \u7684\u65f6\u5019)\uff0c\u5426\u5219\u8bf4\u660e\u662f\u8bf7\u6c42\u53c2\u6570\u521d\u59cb\u5316\u7684\u65f6\u5019\u3002","title":"\u628aRequestInfo\u653e\u5165schema"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28138%29%20%E5%AE%8C%E6%88%90%E7%94%A8%E4%BE%8B%E7%94%9F%E6%88%90%E5%8A%9F%E8%83%BD%28%E4%B8%8A%29/#testcase_schemapy","text":"class TestCaseGeneratorForm ( BaseModel ): directory_id : int requests : List [ RequestInfo ] \u7531\u4e8e\u4e00\u4e2a\u7528\u4f8b\u5fc5\u987b\u6709\u81ea\u5df1\u5f52\u5c5e\u7684 \u76ee\u5f55 \uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u4e3a\u5b83\u5f52\u5c5e\u4e00\u4e2a\u76ee\u5f55\uff0c\u5176\u5b9e\u8fd8\u9700\u8981\u7528\u4f8b\u540d\u79f0\u7b49\u7b49\uff0c\u4f46\u6211\u4eec\u76ee\u524d\u53ea\u505a\u4e00\u4e2a \u96cf\u5f62 \uff0c\u540e\u9762\u53ef\u4ee5\u6162\u6162\u5b8c\u5584\uff0c\u6bd4\u5982\u6211\u4eec\u7ed9\u4e00\u4e2a\u9ed8\u8ba4\u503c\u5c31\u597d\u4e86\u3002 \u65b0\u7684ide\u914d\u8272\u8fd8\u6709\u70b9\u4e0d\u4e60\u60ef\uff0c\u4eca\u5929\u7684\u5185\u5bb9\u5c31\u5230\u8fd9\u91cc\u4e86\uff0c\u4e0b\u4e00\u8282\u6211\u4eec\u7ee7\u7eed\u6df1\u5165\u3002","title":"testcase_schema.py\u65b0\u589e\u4e00\u4e2a\u7c7b"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28139%29%20%E5%AE%8C%E6%88%90%E7%94%A8%E4%BE%8B%E7%94%9F%E6%88%90%E5%8A%9F%E8%83%BD%28%E4%B8%8B%29/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u53ea\u634b\u4e86\u634b\u601d\u8def\uff0c\u5e76\u4e14\u8fc1\u79fb\u4e86\u4e00\u4e0b\u679a\u4e3e\u7c7b\u4ee5\u53ca\u5236\u5b9a\u4e862\u4e2aschema\uff0c\u8fd9\u8282\u6211\u4eec\u5c31\u6765\u5b8c\u5584\u5269\u4e0b\u7684\u3002 \u5b8c\u5584CaseGenerator \u8bb0\u5f97\u6211\u4eec\u4e4b\u524d\u7f16\u5199\u7684CaseGenerator\u7c7b\u5417\uff0c\u91cc\u9762\u5305\u62ec\u4e86RequestInfo\u751f\u6210\uff0c\u4f46\u8fd8\u6ca1\u6709case\u751f\u6210\u90e8\u5206\u3002 \u7531\u4e8e\u6211\u4eec\u7684case\u662f\u7531 CASE\u4e3b\u4f53 \u4ee5\u53ca Constructors \uff0c \u65ad\u8a00 \u7b49\u7ec4\u6210\uff0c\u800c\u6211\u4eec\u9ed8\u8ba4\u662f\u4e0d\u5e26\u65ad\u8a00\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u751f\u6210case\u4e3b\u4f53\u548c\u6784\u9020\u65b9\u6cd5\u5373\u53ef\u3002 \u83b7\u53d6bodyType \u7531\u4e8e\u5f55\u5236case\u7684\u65f6\u5019\uff0c\u6211\u4eec\u6839\u672c\u4e0d\u77e5\u9053\u7528\u6237\u662f\u4ec0\u4e48\u8bf7\u6c42\u7c7b\u578b\uff0c\u6240\u4ee5\u6211\u4eec\u76f4\u63a5\u62ff\u5230RequestInfo\u6570\u7ec4\u7684\u6700\u540e\u4e00\u4e2a\u5143\u7d20\uff0c\u6839\u636e\u91cc\u9762Content-type\u6765\u5224\u65ad\u7528\u4f8b\u662f\u4ec0\u4e48\u7c7b\u578b\u3002 \u751f\u6210case\u4e3b\u4f53 \u6211\u8fd9\u91cc\u56fa\u5b9a\u597d\u4e86\u7528\u4f8b\u540d\u79f0\u4e3a \u5f55\u5236\u7528\u4f8b +\u5bf9\u5e94\u7684\u65f6\u95f4\u6233\uff08\u9632\u6b62\u91cd\u590d\uff09\uff0c\u4f46\u5176\u5b9e\u540e\u7eed\u6211\u4eec\u4f1a\u8fdb\u4e00\u6b65\u5347\u7ea7\uff0c\u8ba9\u7528\u6237\u751f\u6210\u7528\u4f8b\u7684\u65f6\u5019\u6709\u4e00\u4e9b\u9009\u9879\u3002 \u63a5\u7740\u6211\u4eec\u7ed9\u4e00\u4e9b\u7528\u4f8b\u7684\u521d\u59cb\u503c\uff0c\u5f97\u5230\u6700\u7ec8\u8fd9\u4e2a\u7ed3\u679c\u3002 \u751f\u6210constructors @staticmethod def generate_constructors ( requests : List [ RequestInfo ]) -> List [ ConstructorForm ]: constructors = [] for r in range ( len ( requests ) - 1 ): name = f \"http\u8bf7\u6c42_ { r + 1 } \" constructor_json = json . dumps ( dict ( body = requests [ r ] . body , headers = requests [ r ] . request_headers , base_path = None , url = requests [ r ] . url , request_method = requests [ r ] . request_method , body_type = CaseGenerator . get_body_type ( requests [ r ] . request_headers ), ), ensure_ascii = False ) c = ConstructorForm ( name = name , value = f \"http_res_ { r + 1 } \" , constructor_json = constructor_json , enable = True , public = True , suffix = False , index = r + 1 , type = ConstructorType . http . value ) constructors . append ( c ) return constructors \u4ee3\u7801\u6bd4\u8f83\u7b80\u5355\uff0c\u6211\u4eec\u53ea\u904d\u5386\u5230request\u7684N-1\u6761\u6570\u636e\uff0c\u5e76\u628abody\u7b49\u53c2\u6570\u8bfb\u53d6\u51fa\u6765\uff0c\u6210\u4e3a\u4e00\u4e2aconstructor_json\uff0c\u6700\u540e\u751f\u6210\u4e00\u4e2aConstructorForm\uff08\u8fd9\u6837\u80fd\u590d\u7528\u4e4b\u524d\u7684\u65b0\u589e\u7528\u4f8b\u65b9\u6cd5\uff09\u3002 \u81f3\u4e8e\u524d\u7f6e\u6761\u4ef6\u7684\u4e00\u4e9b\u662f\u5426 \u516c\u5f00 \uff0c \u5171\u4eab \u7b49\u5c5e\u6027\u4e5f\u9ed8\u8ba4\u6253\u5f00\u4e86\uff0c\u8fd9\u4e2a\u5176\u5b9e\u65e0\u6240\u8c13\uff0c\u6bd5\u7adf \u7528\u4f8b\u751f\u6210\u4e86\u4ee5\u540e\u90fd\u662f\u53ef\u4ee5\u6539\u7684 \u3002 \u7f16\u5199\u751f\u6210\u7528\u4f8b\u63a5\u53e3 @router . post ( \"/generate\" , summary = \"\u751f\u6210\u7528\u4f8b\" ) async def generate_case ( form : TestCaseGeneratorForm , user = Depends ( Permission ()), session = Depends ( get_session )): if len ( form . requests ) == 0 : return PityResponse . failed ( \"\u65e0http\u8bf7\u6c42\uff0c\u8bf7\u68c0\u67e5\u53c2\u6570\" ) // \u63d0\u53d6\u5b57\u6bb5 \uff0c \u66f4\u65b0\u6570\u636e CaseGenerator . extract_field ( form . requests ) cs = CaseGenerator . generate_case ( form . directory_id , form . requests [ - 1 ]) constructors = CaseGenerator . generate_constructors ( form . requests ) info = TestCaseInfo ( constructor = constructors , case = cs ) async with session . begin (): ans = await TestCaseDao . insert_test_case ( session , info , user [ 'id' ]) return PityResponse . success ( ans ) \u524d\u7aef\u90e8\u5206 \u524d\u7aef\u90e8\u5206\u6211\u4eec\u4e4b\u524d\u5c55\u793a\u4e86\u5177\u4f53\u751f\u6210\u7684\u7528\u4f8b\u6570\u636e\uff0c\u8fd9\u6b21\u7684\u6539\u52a8\u4e3b\u8981\u662f\u4ee5\u4e0b2\u70b9: \u5f55\u5236\u5b8c\u540e\u7684\u8868\u683c\u6570\u636e\u8981\u53ef\u4ee5\u9009\u62e9\uff0c\u4e0d\u7136\u5f55\u5236\u5230\u4e71\u4e03\u516b\u7cdf\u7684\uff0c\u4f1a\u5f71\u54cd\u7528\u4f8b\u751f\u6210 \u751f\u6210\u7528\u4f8b\u540e\u8981\u53ef\u4ee5\u7ed9\u51fa\u94fe\u63a5\u8df3\u8f6c\u5230\u5bf9\u5e94\u7684\u7528\u4f8b\u67e5\u770b\u9875 \u8bdd\u4e0d\u591a\u8bf4\uff0c\u5f00\u9020\u3002 service\u5c42 \u8c03\u7528\u751f\u6210\u7528\u4f8b\u63a5\u53e3 // \u751f\u6210\u7528\u4f8b export async function generateCase ( data ) { return request ( ` ${ CONFIG . URL } /testcase/generate` , { headers : auth . headers (), data , method : 'POST' }); } model\u5c42 jsx \u8c03\u7528\u751f\u6210case\u63a5\u53e3\uff0c\u63a5\u7740\u6211\u4eec\u5148 \u5f3a\u5236 \u7ed9\u4e00\u4e2adirectory_id=5\uff0c\u7136\u540e\u628a\u9009\u4e2d\u7684\u63a5\u53e3\u53c2\u6570\u8f6c\u6362\u4e00\u4e0b\uff0c\u53d1\u9001\u7ed9\u540e\u7aef\uff0c\u6700\u540e\u62ff\u5230\u7528\u4f8bid\u5373\u53ef\u3002 \u6574\u4f53\u6d41\u7a0b\u5c31\u662f\u4e0a\u8ff0\u8fd9\u6837\u4e86\uff0c\u6211\u4eec\u6700\u540e\u6765\u770b\u4e00\u4e2a\u56fe\u3002","title":"139.\u5b8c\u6210\u7528\u4f8b\u751f\u6210\u529f\u80fd(\u4e0b)"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28139%29%20%E5%AE%8C%E6%88%90%E7%94%A8%E4%BE%8B%E7%94%9F%E6%88%90%E5%8A%9F%E8%83%BD%28%E4%B8%8B%29/#_1","text":"\u4e0a\u4e00\u8282\u6211\u4eec\u53ea\u634b\u4e86\u634b\u601d\u8def\uff0c\u5e76\u4e14\u8fc1\u79fb\u4e86\u4e00\u4e0b\u679a\u4e3e\u7c7b\u4ee5\u53ca\u5236\u5b9a\u4e862\u4e2aschema\uff0c\u8fd9\u8282\u6211\u4eec\u5c31\u6765\u5b8c\u5584\u5269\u4e0b\u7684\u3002","title":"\u56de\u987e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28139%29%20%E5%AE%8C%E6%88%90%E7%94%A8%E4%BE%8B%E7%94%9F%E6%88%90%E5%8A%9F%E8%83%BD%28%E4%B8%8B%29/#casegenerator","text":"\u8bb0\u5f97\u6211\u4eec\u4e4b\u524d\u7f16\u5199\u7684CaseGenerator\u7c7b\u5417\uff0c\u91cc\u9762\u5305\u62ec\u4e86RequestInfo\u751f\u6210\uff0c\u4f46\u8fd8\u6ca1\u6709case\u751f\u6210\u90e8\u5206\u3002 \u7531\u4e8e\u6211\u4eec\u7684case\u662f\u7531 CASE\u4e3b\u4f53 \u4ee5\u53ca Constructors \uff0c \u65ad\u8a00 \u7b49\u7ec4\u6210\uff0c\u800c\u6211\u4eec\u9ed8\u8ba4\u662f\u4e0d\u5e26\u65ad\u8a00\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u751f\u6210case\u4e3b\u4f53\u548c\u6784\u9020\u65b9\u6cd5\u5373\u53ef\u3002 \u83b7\u53d6bodyType \u7531\u4e8e\u5f55\u5236case\u7684\u65f6\u5019\uff0c\u6211\u4eec\u6839\u672c\u4e0d\u77e5\u9053\u7528\u6237\u662f\u4ec0\u4e48\u8bf7\u6c42\u7c7b\u578b\uff0c\u6240\u4ee5\u6211\u4eec\u76f4\u63a5\u62ff\u5230RequestInfo\u6570\u7ec4\u7684\u6700\u540e\u4e00\u4e2a\u5143\u7d20\uff0c\u6839\u636e\u91cc\u9762Content-type\u6765\u5224\u65ad\u7528\u4f8b\u662f\u4ec0\u4e48\u7c7b\u578b\u3002 \u751f\u6210case\u4e3b\u4f53 \u6211\u8fd9\u91cc\u56fa\u5b9a\u597d\u4e86\u7528\u4f8b\u540d\u79f0\u4e3a \u5f55\u5236\u7528\u4f8b +\u5bf9\u5e94\u7684\u65f6\u95f4\u6233\uff08\u9632\u6b62\u91cd\u590d\uff09\uff0c\u4f46\u5176\u5b9e\u540e\u7eed\u6211\u4eec\u4f1a\u8fdb\u4e00\u6b65\u5347\u7ea7\uff0c\u8ba9\u7528\u6237\u751f\u6210\u7528\u4f8b\u7684\u65f6\u5019\u6709\u4e00\u4e9b\u9009\u9879\u3002 \u63a5\u7740\u6211\u4eec\u7ed9\u4e00\u4e9b\u7528\u4f8b\u7684\u521d\u59cb\u503c\uff0c\u5f97\u5230\u6700\u7ec8\u8fd9\u4e2a\u7ed3\u679c\u3002 \u751f\u6210constructors @staticmethod def generate_constructors ( requests : List [ RequestInfo ]) -> List [ ConstructorForm ]: constructors = [] for r in range ( len ( requests ) - 1 ): name = f \"http\u8bf7\u6c42_ { r + 1 } \" constructor_json = json . dumps ( dict ( body = requests [ r ] . body , headers = requests [ r ] . request_headers , base_path = None , url = requests [ r ] . url , request_method = requests [ r ] . request_method , body_type = CaseGenerator . get_body_type ( requests [ r ] . request_headers ), ), ensure_ascii = False ) c = ConstructorForm ( name = name , value = f \"http_res_ { r + 1 } \" , constructor_json = constructor_json , enable = True , public = True , suffix = False , index = r + 1 , type = ConstructorType . http . value ) constructors . append ( c ) return constructors \u4ee3\u7801\u6bd4\u8f83\u7b80\u5355\uff0c\u6211\u4eec\u53ea\u904d\u5386\u5230request\u7684N-1\u6761\u6570\u636e\uff0c\u5e76\u628abody\u7b49\u53c2\u6570\u8bfb\u53d6\u51fa\u6765\uff0c\u6210\u4e3a\u4e00\u4e2aconstructor_json\uff0c\u6700\u540e\u751f\u6210\u4e00\u4e2aConstructorForm\uff08\u8fd9\u6837\u80fd\u590d\u7528\u4e4b\u524d\u7684\u65b0\u589e\u7528\u4f8b\u65b9\u6cd5\uff09\u3002 \u81f3\u4e8e\u524d\u7f6e\u6761\u4ef6\u7684\u4e00\u4e9b\u662f\u5426 \u516c\u5f00 \uff0c \u5171\u4eab \u7b49\u5c5e\u6027\u4e5f\u9ed8\u8ba4\u6253\u5f00\u4e86\uff0c\u8fd9\u4e2a\u5176\u5b9e\u65e0\u6240\u8c13\uff0c\u6bd5\u7adf \u7528\u4f8b\u751f\u6210\u4e86\u4ee5\u540e\u90fd\u662f\u53ef\u4ee5\u6539\u7684 \u3002 \u7f16\u5199\u751f\u6210\u7528\u4f8b\u63a5\u53e3 @router . post ( \"/generate\" , summary = \"\u751f\u6210\u7528\u4f8b\" ) async def generate_case ( form : TestCaseGeneratorForm , user = Depends ( Permission ()), session = Depends ( get_session )): if len ( form . requests ) == 0 : return PityResponse . failed ( \"\u65e0http\u8bf7\u6c42\uff0c\u8bf7\u68c0\u67e5\u53c2\u6570\" ) // \u63d0\u53d6\u5b57\u6bb5 \uff0c \u66f4\u65b0\u6570\u636e CaseGenerator . extract_field ( form . requests ) cs = CaseGenerator . generate_case ( form . directory_id , form . requests [ - 1 ]) constructors = CaseGenerator . generate_constructors ( form . requests ) info = TestCaseInfo ( constructor = constructors , case = cs ) async with session . begin (): ans = await TestCaseDao . insert_test_case ( session , info , user [ 'id' ]) return PityResponse . success ( ans )","title":"\u5b8c\u5584CaseGenerator"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28139%29%20%E5%AE%8C%E6%88%90%E7%94%A8%E4%BE%8B%E7%94%9F%E6%88%90%E5%8A%9F%E8%83%BD%28%E4%B8%8B%29/#_2","text":"\u524d\u7aef\u90e8\u5206\u6211\u4eec\u4e4b\u524d\u5c55\u793a\u4e86\u5177\u4f53\u751f\u6210\u7684\u7528\u4f8b\u6570\u636e\uff0c\u8fd9\u6b21\u7684\u6539\u52a8\u4e3b\u8981\u662f\u4ee5\u4e0b2\u70b9: \u5f55\u5236\u5b8c\u540e\u7684\u8868\u683c\u6570\u636e\u8981\u53ef\u4ee5\u9009\u62e9\uff0c\u4e0d\u7136\u5f55\u5236\u5230\u4e71\u4e03\u516b\u7cdf\u7684\uff0c\u4f1a\u5f71\u54cd\u7528\u4f8b\u751f\u6210 \u751f\u6210\u7528\u4f8b\u540e\u8981\u53ef\u4ee5\u7ed9\u51fa\u94fe\u63a5\u8df3\u8f6c\u5230\u5bf9\u5e94\u7684\u7528\u4f8b\u67e5\u770b\u9875 \u8bdd\u4e0d\u591a\u8bf4\uff0c\u5f00\u9020\u3002 service\u5c42 \u8c03\u7528\u751f\u6210\u7528\u4f8b\u63a5\u53e3 // \u751f\u6210\u7528\u4f8b export async function generateCase ( data ) { return request ( ` ${ CONFIG . URL } /testcase/generate` , { headers : auth . headers (), data , method : 'POST' }); } model\u5c42 jsx \u8c03\u7528\u751f\u6210case\u63a5\u53e3\uff0c\u63a5\u7740\u6211\u4eec\u5148 \u5f3a\u5236 \u7ed9\u4e00\u4e2adirectory_id=5\uff0c\u7136\u540e\u628a\u9009\u4e2d\u7684\u63a5\u53e3\u53c2\u6570\u8f6c\u6362\u4e00\u4e0b\uff0c\u53d1\u9001\u7ed9\u540e\u7aef\uff0c\u6700\u540e\u62ff\u5230\u7528\u4f8bid\u5373\u53ef\u3002 \u6574\u4f53\u6d41\u7a0b\u5c31\u662f\u4e0a\u8ff0\u8fd9\u6837\u4e86\uff0c\u6211\u4eec\u6700\u540e\u6765\u770b\u4e00\u4e2a\u56fe\u3002","title":"\u524d\u7aef\u90e8\u5206"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2814%29%20%E7%BC%96%E5%86%99%E7%B1%BBpostman%E9%A1%B5%E9%9D%A2%283%29/","text":"\u7f16\u5199\u7c7bpostman\u9875\u9762(3) \u56de\u987e \u8bb0\u5f97\u4e0a\u4e00\u8282\u6211\u4eec\u7f16\u5199\u4e86postman\u7684\u4e2d\u95f4\u90e8\u5206\uff0c\u5176\u5b9e\u8fd8\u6709header\u90e8\u5206\u7684\u4e00\u4e9b\u8868\u5355\u6570\u636e\u6ca1\u6709\u7f16\u5199\u5b8c\u6210\uff0c\u4eca\u5929\u6211\u4eec\u5c31\u5c3d\u91cf\u5b8c\u6210\u5b83\u5e76\u4e14\u5c1d\u8bd5\u8dd1\u4e00\u4e2a\u5c0f\u5c0f\u7684demo\u3002 \u5bfb\u627e\u53ef\u7f16\u8f91\u8868\u683c\u7ec4\u4ef6 \u53ef\u4ee5\u770b\u5230\u8fd9\u91cc\u6bd4\u8f83\u7b80\u5355\uff0c\u57fa\u672c\u4e0a\u5c31\u662f2\u5757: \u6587\u5b57\u90e8\u5206 \u548c \u53ef\u7f16\u8f91\u8868\u683c \u53ef\u7f16\u8f91\u8868\u683c\u7684\u8bdd\uff0c\u6211\u4eec\u53ef\u4ee5\u81ea\u5df1\u5199\uff0c\u4e5f\u53ef\u4ee5\u76f4\u63a5\u7528\u73b0\u6210\u7684\u3002\u6211\u4eec\u4e3a\u4e86\u50bb\u74dc\u4e00\u70b9\uff0c\u5c31\u91c7\u7528ant design pro\u5c01\u88c5\u597d\u7684\u9ad8\u9636\u7ec4\u4ef6(\u610f\u601d\u662f\u529f\u80fd\u9f50\u5168\uff0c\u7b80\u5355\u597d\u7528) \u5177\u4f53\u5730\u5740: ProComponents \u90a3\u4e48\u8fd9\u4e2a\u5c31\u662f\u6211\u4eec\u9700\u8981\u7684\uff0c\u7531\u4e8e\u6211\u4eec\u7528\u7684 JavaScript \u800c\u975e TypeScript \uff0c\u6240\u4ee5\u5462\u6211\u4eec\u9700\u8981\u590d\u6742\u4e00\u70b9\u627e\u5230\u5bf9\u5e94\u7684\u6e90\u7801: \u5148\u5c55\u5f00\u4ee3\u7801\u7136\u540e\u70b9\u51fb\u8fd9\u4e2ajs\u56fe\u6807 \u5728\u5f39\u51fa\u7684\u7f51\u7ad9\u5c31\u53ef\u4ee5\u627e\u5230\u5bf9\u5e94\u7684JS\u4ee3\u7801\u4e86\uff01 \u6211\u4eec\u8fd9\u4e2a\u9879\u76ee\u672c\u6765\u5c31\u5e26\u6709\u4e86pro\u7684\u7ec4\u4ef6\uff0c\u6240\u4ee5\u4e0d\u9700\u8981\u989d\u5916\u5b89\u88c5\u4e86\u54c8\u3002(\u4eb2\u6d4b\u65b0\u7248\u672c\u8fd8\u6709\u70b9\u95ee\u9898) \u7f16\u5199\u53ef\u7f16\u8f91\u8868\u683c\u96cf\u5f62 \u9996\u5148\u5462\uff0c\u6211\u4eec\u8fd9\u4e2a\u7ec4\u4ef6\u662fpostman\u7ec4\u4ef6\uff0c\u4f46\u662f\u5176\u5b9e\u8fd9\u4e2a\u53ef\u7f16\u8f91\u7ec4\u4ef6\u662f\u53ef\u4ee5\u548c\u540e\u9762\u7684 headers \u6807\u7b7e\u8fdb\u884c \u590d\u7528 \u7684\uff0c\u6240\u4ee5\u6211\u4eec\u5355\u72ec\u628a\u8fd9\u4e2a\u7ec4\u4ef6\u62bd\u51fa\u6765\u5c01\u88c5\u3002 \u65b0\u5efa src/components/Table/EditableTable.jsx \u4ee3\u7801\u57fa\u672c\u4e0a\u662f\u590d\u5236\u8fc7\u6765\u7684\uff0c\u4f46\u662f\u6211\u4eec\u62bd\u53d6\u4e86\u51e0\u4e2a\u91cd\u8981\u7684\u53c2\u6570: columns \u7531\u4e8e\u6211\u4eec\u7684\u6bcf\u4e2a\u8868\u683c\u7684\u5b57\u6bb5\u53ef\u80fd\u4e0d\u4e00\u6837\uff0c\u6240\u4ee5\u8bf4\u6211\u4eec\u4e0d\u80fd\u5199\u6b7b dataSource \u5b9e\u9645\u6570\u636e\uff0c\u672c\u6765\u4e0d\u662f\u8fd9\u6837\u7684\uff0c\u4f46\u662f\u53d1\u73b0\u8fd9\u4e2a\u7ec4\u4ef6\u6709\u70b9bug\uff0c\u8ba9\u6211\u6709\u70b9 \u5c0f\u5c34\u5c2c setDataSource \u6539\u53d8dataSource\u7684\u65b9\u6cd5 title \u6bd4\u5982\u8fd9\u91cc\u6211\u4eec\u9700\u8981\u7684title\u662f Query Params \u6ce8\u610f\u8fd9\u91cc\uff0c\u8fd9\u91cc\u6211\u662f\u4ececolumns\u4e2d\u62ff\u5230 \u771f\u5b9e\u5b57\u6bb5 \uff0c\u56e0\u4e3a\u54b1\u4eec\u8fd8\u6709\u5176\u4ed6\u5b57\u6bb5\u6bd4\u5982\u540e\u9762\u7684 \u5220\u9664 \uff0c\u62ff\u5230\u4e4b\u540e\u5728\u7528\u6237\u70b9\u51fb \u65b0\u589e\u4e00\u884c\u6570\u636e \u7684\u65f6\u5019\u9ed8\u8ba4\u7ed9\u5b57\u6bb5\u52a0\u4e0a\u503c\u3002 \u5f15\u5165\u8868\u683c\u7ec4\u4ef6\u5e76\u7f16\u5199columns columns \u6211\u8bbe\u7f6e\u4e863\u4e2a\u5b57\u6bb5\u5206\u522b\u662f KEY , VALUE , DESCRIPTION \u3002\u4e0epostman\u662f\u4fdd\u6301\u4e00\u81f4\u7684\uff0c\u7136\u540e\u6700\u540e\u4e00\u5217\u6211\u8bbe\u7f6e\u4e86\u4e00\u4e2a\u56fe\u6807(\u5220\u9664)\uff0c\u5220\u9664\u65b9\u6cd5\u81ea\u5df1\u624b\u52a8\u7f16\u5199\u4e86\uff08\u8fd8\u662f\u56e0\u4e3a\u4ed6\u6709bug\uff0c\u65e0\u6cd5\u5220\u9664\uff09\u3002\u56e0\u4e3a\u6211\u5728\u5b98\u7f51\u6ca1\u6539\u6e90\u7801\u7684\u60c5\u51b5\u4e0b\u4e5f\u53d1\u73b0 \u65e0\u6cd5\u5220\u9664 \u3002 \u770b\u770b\u6548\u679c: \u96cf\u5f62\u662f\u6709\u4e86 \u5176\u5b9epostman\u505a\u7684\u66f4\u7cbe\u81f4\uff0c\u4e0b\u9762\u7684\u6570\u636e\u4f1a\u6539\u53d8url\u7684\u5185\u5bb9\u3002\u63a5\u4e0b\u6765\u6211\u4eec\u4e5f\u628a\u8fd9\u5757\u5b9e\u73b0\u4e86\u5427\u3002 \u6539\u9020URL \u73b0\u5728\u6211\u4eec\u6709\u4e86params\u53c2\u6570\uff0c\u90a3\u4e48\u6211\u4eec\u7684url\u5c31\u75312\u90e8\u5206\u6784\u6210\u4e86: url params \u6240\u4ee5\u6211\u4eec\u539f\u5148\u7684url\u6539\u53d8\u7684\u65f6\u5019\u5982\u679c\u6709\u53c2\u6570\u53d8\u52a8\u5219\u9700\u8981\u4fee\u6539\u53c2\u6570\u9879\u76ee\uff0c\u5982\u679c\u53c2\u6570\u9879\u76ee\u6709\u53d8\u52a8\u4e5f\u9700\u8981 \u4fee\u6539url \u3002 \u7531\u4e8e\u8fd9\u4e2aProTable\u6709\u4e00\u70b9\u70b9bug\uff0c\u7b14\u8005\u4e5f\u641e\u4e86\u597d\u4e45\u4eca\u665a\uff0c\u4e0d\u8fc7\u6700\u540e\u987a\u5229\u5b8c\u6210\u4e86\uff0c\u5927\u5bb6pull\u6700\u65b0\u7684\u4ee3\u7801\u5c31\u53ef\u4ee5\u770b\u5230\u6548\u679c\u4e86\u3002\u53ef\u60dc\u7684\u662f\u4eca\u5929\u6d6a\u8d39\u592a\u591a\u65f6\u95f4\u4e86\uff0c\u5c31\u53ea\u7b80\u5355\u5bf9\u4ee3\u7801\u7a0d\u4f5c\u63cf\u8ff0\u4e86\u3002 \u8fd9\u4e2a\u8868\u683c\u7ec4\u4ef6\u6709\u4e9b\u53d8\u5316: \u628a\u6b63\u5728\u7f16\u8f91\u7684key\u548c\u4fee\u6539\u53ef\u7f16\u8f91key\u7684\u65b9\u6cd5\u62bd\u79bb\u51fa\u6765\u4e86 extra\u51fd\u6570\u7528\u6765\u5728\u8868\u683c\u6570\u636e\u53d8\u52a8\u7684\u65f6\u5019\u505a\u4e00\u4e9b\u989d\u5916\u7684\u53d8\u52a8\uff0c\u56e0\u4e3a\u8868\u683c\u53d8\u5316\u6211\u4eec\u5f97\u53bb\u66f4\u65b0url \u62fc\u63a5url\u7684\u65b9\u6cd5 url\u7684\u89c4\u5219\u662f http://www.xxx.com + ?\u53c2\u65701=\u503c&\u53c2\u65702=\u503c2 \u6240\u4ee5\u7b2c\u4e00\u4e2a\u53c2\u6570\u7528?\u9694\u5f00\uff0c\u540e\u9762\u90fd\u662f\u7528&\uff0c\u4ee3\u7801\u5199\u7684\u5f88\u6e05\u695a\u4e86\u3002 \u62c6\u89e3url\u7684\u65b9\u6cd5 \u8fd9\u91cc\u5199\u7684 \u6bd4\u8f83\u590d\u6742 \uff0c\u9996\u5148\u5224\u65adurl\u91cc\u9762\u6709\u65e0\u53c2\u6570\uff0c\u6ca1\u6709\u7684\u8bdd\u5c31\u628a\u8868\u5355\u6570\u636e\u6e05\u7a7a\u3002\u63a5\u7740\u5c31\u662f\u53d6url\u7684\u6570\u636e\u7ec4\u6210\u65b0\u7684\u8868\u5355\u3002\u4f46\u662f\u8868\u5355\u7684\u6bcf\u4e00\u884c\u662f\u7528\u65f6\u95f4\u533a\u522b\u7684\uff0c\u8fd9\u91ccjs\u6267\u884c\u592a\u5feb\uff0c\u6240\u4ee5\u6211\u4ee5\u6570\u7ec4\u7d22\u5f15+\u65f6\u95f4+10\u7684\u65b9\u5f0f\uff0c\u5c31\u7b97now\u5168\u90fd\u4e00\u6837\uff0c\u4e5f\u6ca1\u5173\u7cfb\uff0c\u56e0\u4e3a\u7d22\u5f15\u80af\u5b9a\u4e0d\u4e00\u6837\uff0c\u907f\u514d\u4e86\u4e00\u4e0b\u5b50 \u6dfb\u52a0\u591a\u884c \u7684\u95ee\u9898\uff08\u5f53\u7136\u4f60\u4eec\u662f\u770b\u4e0d\u5230\u8fd9\u4e2a\u95ee\u9898\u7684\uff09\u3002 \u5220\u9664\u53c2\u6570 \u5220\u9664\u53c2\u6570\u7684\u65f6\u5019\u4e5f\u91cd\u65b0\u62fc\u63a5url\u7ed9url\u8f93\u5165\u6846 \u8f93\u5165\u6846url\u53d8\u5316\u4e5f\u6539\u53d8\u53c2\u6570\u8868\u683c \u65b0\u589e\u4e86\u4e00\u4e9b\u53d8\u91cf\u548cset\u53d8\u91cf\u7684\u65b9\u6cd5 \u6587\u4ef6\u603b\u4f53\u4ee3\u7801\u53ef\u4ee5\u53bbgithub\u770b\uff0c\u8fd9\u91cc\u7bc7\u5e45\u6709\u9650\u5c31\u4e0d\u8d34\u4e86\u3002 \u6700\u7ec8\u6548\u679c \u627e\u4e86\u4e2a\u622a\u56fe\u8f6f\u4ef6\uff0c\u8ba9\u5927\u5bb6\u770b\u770b\u6548\u679c\u5427\uff0c\u665a\u5b89\u3002 \u5e7f\u544a\u65f6\u95f4 \u9884\u89c8\u5730\u5740: http://47.112.32.195/ \u540e\u7aef\u4ee3\u7801\u5730\u5740: https://github.com/wuranxu/pity \u524d\u7aef\u4ee3\u7801\u5730\u5740: https://github.com/wuranxu/pityWeb \u6b22\u8fce\u5173\u6ce8\u516c\u4f17\u53f7 \u6d4b\u8bd5\u5f00\u53d1\u5165\u5751 \uff0c\u8fd8\u6709\u52a0\u7fa4\u4e00\u8d77\u8ba8\u8bba\u76f8\u5173\u95ee\u9898\u5440\uff01\u5982\u679c\u7fa4\u4e8c\u7ef4\u7801\u8fc7\u671f\u4e86\uff0c\u53ef\u4ee5\u52a0\u6211\u4e2a\u4eba\u5fae\u4fe1: wuranxu \u6211\u62c9\u4f60\u8fdb\u7fa4~","title":"14.\u7f16\u5199\u7c7bpostman\u9875\u9762(3)"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28140%29%20%E9%85%8D%E7%BD%AEMac%E7%8E%AF%E5%A2%83mitmproxy/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u4ecb\u7ecd\u4e86\u5f55\u5236\u7528\u4f8b\u5e76\u751f\u6210\u76f8\u5173\u7684\u529f\u80fd\uff0c\u5f53\u7136\u8fd8\u4e0d\u662f \u5f88\u5b8c\u5584 \uff0c\u6240\u4ee5\u6211\u4eec\u4f1a\u5728\u540e\u9762\u7684\u7ae0\u8282\u7ee7\u7eed\u5b8c\u5584\u4e4b\u3002 \u60f3\u5230\u4e4b\u524d\u6211\u4eec\u5e76\u6ca1\u6709\u5728mac\u73af\u5883\u4e0b\u914d\u7f6e\u8fc7mitmproxy\u4ee3\u7406\uff0c\u4e3a\u4e86\u7167\u987emac\u7cfb\u7edf\u7684\u540c\u5b66\uff0c\u6240\u4ee5\u8fd9\u6b21\u6211\u4eec\u987a\u4fbf\u4ecb\u7ecd\u4e0bmac\u4e0b\u76f8\u5173\u7684\u914d\u7f6e\u3002 \u542f\u52a8mitmproxy \u7531\u4e8e\u6211\u4eec\u4e4b\u524d\u5df2\u7ecf \u4e0d\u91c7\u7528 mitmproxy.exe\u7684\u65b9\u5f0f\u542f\u52a8\uff0c\u800c\u662f\u6362\u6210\u4e86\u5c06mitmproxy\u96c6\u6210\u5230FastApi\u542f\u52a8\u7684\u5f62\u5f0f\uff0c\u6240\u4ee5\u6211\u4eec\u76ee\u524d\u542f\u52a8pity\u5219\u7b49\u4e8e\u542f\u52a8\u4e86 mitmproxy \u3002 \u6240\u4ee5\u6211\u4eec\u4e0d\u9700\u8981\u989d\u5916\u53bb\u5b98\u7f51\u64cd\u4f5c\u4e86\u3002 \u914d\u7f6e\u4ee3\u7406 \u5728Mac\u4e0b\uff0c\u5e94\u8be5\u600e\u4e48\u914d\u7f6e\u4ee3\u7406\u5462\uff1f\u5176\u5b9e\u6211\u4eec\u901a\u8fc7 chrome \u6d4f\u89c8\u5668\uff0c\u641c\u7d22\u5bf9\u5e94\u7684\u4ee3\u7406\uff0c\u4ed6\u5c31\u4f1a\u5f15\u5bfc\u6211\u4eec\u8fdb\u5165\u4ee3\u7406\u8bbe\u7f6e\uff08\u7cfb\u7edf\u7ea7\u522b\u7684\u4ee3\u7406\uff0c\u975echrome\u63d0\u4f9b\uff0c\u5b83\u53ea\u662f\u63d0\u4f9b\u4e00\u4e2a\u8df3\u8f6c\u529f\u80fd\uff09\u3002 \u4e0d\u8fc7\u6211\u4eec\u8fd9\u91cc\u76f4\u63a5\u8fdb\u5165\u914d\u7f6e\uff0c\u6253\u5f00 \u7cfb\u7edf\u504f\u597d\u8bbe\u7f6e -> \u7f51\u7edc : \u63a5\u7740\u6211\u4eec\u70b9\u51fb \u9ad8\u7ea7 \u6309\u94ae\uff0c\u8fdb\u5165\u76f8\u5173\u7684\u914d\u7f6e\u9875\u9762\uff0c\u6ce8\u610f\uff0c\u5de6\u4fa7\u8981\u9009\u62e9\u4f60\u5bf9\u5e94\u7684\u8054\u7f51\u8bbe\u5907\uff0cwifi\u5c31\u9009\u62e9wifi\uff0cUSB\u7f51\u7edc\u9739\u96f3\u7f51\u7edc\u6865\u7b49\uff08\u6709\u7ebf\u7f51\u7edc\uff09\u5c31\u9009\u62e9\u5bf9\u5e94\u7684\u3002 \u8fdb\u5165\u5230\u4ee3\u7406\u9875\u9762\uff0c\u8bb0\u5f97\u540c\u65f6\u914d\u7f6eHTTP\u548cHTTPS\uff0c\u5bf9\u5e94\u7684ip\u5c31\u662fpity\u7684\u542f\u52a8ip\uff0c\u7aef\u53e3\u53f7\u5219\u662fpity mock\u914d\u7f6e\u7684\u7aef\u53e3\u53f7\uff0c\u9ed8\u8ba4\u4e3a7778\uff08\u6211\u8fd9\u91cc\u6ca1\u6709\u914d\u7f6e\uff0c\u6240\u4ee5\u662f\u522b\u7684\u7aef\u53e3\uff09 HTTPS\u4e0d\u914d\u7f6e\u7684\u8bdd\uff0c\u8bbf\u95eehttps\u7f51\u7ad9\u5c31\u4e0d\u4f1a\u8d70\u4ee3\u7406\u3002 \u4e0b\u8f7d\u8bc1\u4e66 \u8001\u89c4\u77e9\uff0c\u914d\u7f6e\u5b8c\u4e86\u4ee3\u7406\u4ee5\u540e\uff0c\u6211\u4eec\u5e94\u5f53\u5c31\u80fd\u8bbf\u95eemitm.it\u4e86\u3002 \u4e0b\u8f7d\u5b8c\u6bd5\u4ee5\u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u4e0b\u8f7d\u8bc1\u4e66\u4e86\uff0cmac\u7684\u8bc1\u4e66\u5b89\u88c5\u6bd4\u8f83\u7b80\u5355\uff0c\u53cc\u51fb\u540e\u5b83\u4f1a\u8fdb\u5165\u4e00\u4e2a \u94a5\u5319\u4e32 \u9875\u9762\u3002 \u63a5\u7740\u6211\u4eec\u627e\u5230\u521a\u624d\u5b89\u88c5\u7684mitmproxy\u8bc1\u4e66\uff0c\u53cc\u51fb\u540e\u5c55\u5f00 \u4fe1\u4efb \u680f\uff0c\u6539\u4e3a\u59cb\u7ec8\u4fe1\u4efb\u5373\u53ef\u3002 \u6d4b\u8bd5\u4e00\u4e0b \u6211\u4eec\u6765\u6d4b\u8bd5\u4e0b\u5f55\u5236\u751f\u6210\u529f\u80fd\u3002 \u81f3\u4e8e\u8fd9\u91cc\u8bf4\u7684\u914d\u7f6e\u597dweb\u4ee3\u7406\uff0c\u5c31\u662f\u4e0a\u8ff0\u6b65\u9aa4\u3002\u4ee3\u7406\u59cb\u7ec8\u662f\u4f5c\u4e3a\u4e00\u4e2a\u4e2d\u95f4\u4eba\uff0c\u62ff\u5230\u6211\u4eec\u548c\u76ee\u6807\u4e4b\u95f4\u7684\u8bf7\u6c42\u6570\u636e\u3002 \u6709\u4e2a\u7591\u60d1 \u76ee\u524d\u4e3a\u6b62\uff0c\u6211\u4eec\u90fd\u662f\u5728\u672c\u5730\u8bbf\u95eemitmproxy\uff0c\u53ef\u662f\u4eca\u5929\u5f53\u6211\u53d1\u73b0\u6211\u7528\u81ea\u5df1\u90e8\u7f72\u7684\u670d\u52a1\u5668\u5f53\u4ee3\u7406\uff0c\u5c45\u7136\u65e0\u6cd5\u8bbf\u95ee\u7f51\u7edc: \u8fd9\u4e2a\u6211\u76ee\u524d\u8fd8\u6ca1\u6709\u597d\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u5982\u679c\u5927\u5bb6\u5185\u90e8\u516c\u53f8\u7528\u7684\u8bdd\uff0c\u5e94\u8be5\u4e0d\u4f1a\u7ecf\u8fc7 \u57df\u540d\u5907\u6848\u68c0\u6d4b \u7684\u73af\u8282\u3002 \u4eca\u5929\u7684\u5185\u5bb9\u6ca1\u6709\u4ee3\u7801\u90e8\u5206\uff0c\u53ea\u662f\u7ed9\u5927\u5bb6\u5c55\u793a\u4e86\u4e00\u4e0bmac\u73af\u5883\u7684mitmproxy\u76f8\u5173\u4ee3\u7406\u914d\u7f6e\u53ca\u4f7f\u7528\uff0c\u4e5f\u6ce1\u51fa\u4e86\u4e00\u4e2a\u95ee\u9898\u3002\u4e0b\u4e00\u8282\u6211\u4eec\u6765\u7f8e\u5316\u4e0b\u7528\u4f8b\u751f\u6210\u65b0\u7684\u5185\u5bb9\uff0c\u53ef\u4ee5\u7ed9\u5927\u5bb6\u770b\u770b\u8c0d\u7167:","title":"140.\u914d\u7f6eMac\u73af\u5883mitmproxy"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28140%29%20%E9%85%8D%E7%BD%AEMac%E7%8E%AF%E5%A2%83mitmproxy/#_1","text":"\u4e0a\u4e00\u8282\u6211\u4eec\u4ecb\u7ecd\u4e86\u5f55\u5236\u7528\u4f8b\u5e76\u751f\u6210\u76f8\u5173\u7684\u529f\u80fd\uff0c\u5f53\u7136\u8fd8\u4e0d\u662f \u5f88\u5b8c\u5584 \uff0c\u6240\u4ee5\u6211\u4eec\u4f1a\u5728\u540e\u9762\u7684\u7ae0\u8282\u7ee7\u7eed\u5b8c\u5584\u4e4b\u3002 \u60f3\u5230\u4e4b\u524d\u6211\u4eec\u5e76\u6ca1\u6709\u5728mac\u73af\u5883\u4e0b\u914d\u7f6e\u8fc7mitmproxy\u4ee3\u7406\uff0c\u4e3a\u4e86\u7167\u987emac\u7cfb\u7edf\u7684\u540c\u5b66\uff0c\u6240\u4ee5\u8fd9\u6b21\u6211\u4eec\u987a\u4fbf\u4ecb\u7ecd\u4e0bmac\u4e0b\u76f8\u5173\u7684\u914d\u7f6e\u3002","title":"\u56de\u987e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28140%29%20%E9%85%8D%E7%BD%AEMac%E7%8E%AF%E5%A2%83mitmproxy/#mitmproxy","text":"\u7531\u4e8e\u6211\u4eec\u4e4b\u524d\u5df2\u7ecf \u4e0d\u91c7\u7528 mitmproxy.exe\u7684\u65b9\u5f0f\u542f\u52a8\uff0c\u800c\u662f\u6362\u6210\u4e86\u5c06mitmproxy\u96c6\u6210\u5230FastApi\u542f\u52a8\u7684\u5f62\u5f0f\uff0c\u6240\u4ee5\u6211\u4eec\u76ee\u524d\u542f\u52a8pity\u5219\u7b49\u4e8e\u542f\u52a8\u4e86 mitmproxy \u3002 \u6240\u4ee5\u6211\u4eec\u4e0d\u9700\u8981\u989d\u5916\u53bb\u5b98\u7f51\u64cd\u4f5c\u4e86\u3002","title":"\u542f\u52a8mitmproxy"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28140%29%20%E9%85%8D%E7%BD%AEMac%E7%8E%AF%E5%A2%83mitmproxy/#_2","text":"\u5728Mac\u4e0b\uff0c\u5e94\u8be5\u600e\u4e48\u914d\u7f6e\u4ee3\u7406\u5462\uff1f\u5176\u5b9e\u6211\u4eec\u901a\u8fc7 chrome \u6d4f\u89c8\u5668\uff0c\u641c\u7d22\u5bf9\u5e94\u7684\u4ee3\u7406\uff0c\u4ed6\u5c31\u4f1a\u5f15\u5bfc\u6211\u4eec\u8fdb\u5165\u4ee3\u7406\u8bbe\u7f6e\uff08\u7cfb\u7edf\u7ea7\u522b\u7684\u4ee3\u7406\uff0c\u975echrome\u63d0\u4f9b\uff0c\u5b83\u53ea\u662f\u63d0\u4f9b\u4e00\u4e2a\u8df3\u8f6c\u529f\u80fd\uff09\u3002 \u4e0d\u8fc7\u6211\u4eec\u8fd9\u91cc\u76f4\u63a5\u8fdb\u5165\u914d\u7f6e\uff0c\u6253\u5f00 \u7cfb\u7edf\u504f\u597d\u8bbe\u7f6e -> \u7f51\u7edc : \u63a5\u7740\u6211\u4eec\u70b9\u51fb \u9ad8\u7ea7 \u6309\u94ae\uff0c\u8fdb\u5165\u76f8\u5173\u7684\u914d\u7f6e\u9875\u9762\uff0c\u6ce8\u610f\uff0c\u5de6\u4fa7\u8981\u9009\u62e9\u4f60\u5bf9\u5e94\u7684\u8054\u7f51\u8bbe\u5907\uff0cwifi\u5c31\u9009\u62e9wifi\uff0cUSB\u7f51\u7edc\u9739\u96f3\u7f51\u7edc\u6865\u7b49\uff08\u6709\u7ebf\u7f51\u7edc\uff09\u5c31\u9009\u62e9\u5bf9\u5e94\u7684\u3002 \u8fdb\u5165\u5230\u4ee3\u7406\u9875\u9762\uff0c\u8bb0\u5f97\u540c\u65f6\u914d\u7f6eHTTP\u548cHTTPS\uff0c\u5bf9\u5e94\u7684ip\u5c31\u662fpity\u7684\u542f\u52a8ip\uff0c\u7aef\u53e3\u53f7\u5219\u662fpity mock\u914d\u7f6e\u7684\u7aef\u53e3\u53f7\uff0c\u9ed8\u8ba4\u4e3a7778\uff08\u6211\u8fd9\u91cc\u6ca1\u6709\u914d\u7f6e\uff0c\u6240\u4ee5\u662f\u522b\u7684\u7aef\u53e3\uff09 HTTPS\u4e0d\u914d\u7f6e\u7684\u8bdd\uff0c\u8bbf\u95eehttps\u7f51\u7ad9\u5c31\u4e0d\u4f1a\u8d70\u4ee3\u7406\u3002","title":"\u914d\u7f6e\u4ee3\u7406"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28140%29%20%E9%85%8D%E7%BD%AEMac%E7%8E%AF%E5%A2%83mitmproxy/#_3","text":"\u8001\u89c4\u77e9\uff0c\u914d\u7f6e\u5b8c\u4e86\u4ee3\u7406\u4ee5\u540e\uff0c\u6211\u4eec\u5e94\u5f53\u5c31\u80fd\u8bbf\u95eemitm.it\u4e86\u3002 \u4e0b\u8f7d\u5b8c\u6bd5\u4ee5\u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u4e0b\u8f7d\u8bc1\u4e66\u4e86\uff0cmac\u7684\u8bc1\u4e66\u5b89\u88c5\u6bd4\u8f83\u7b80\u5355\uff0c\u53cc\u51fb\u540e\u5b83\u4f1a\u8fdb\u5165\u4e00\u4e2a \u94a5\u5319\u4e32 \u9875\u9762\u3002 \u63a5\u7740\u6211\u4eec\u627e\u5230\u521a\u624d\u5b89\u88c5\u7684mitmproxy\u8bc1\u4e66\uff0c\u53cc\u51fb\u540e\u5c55\u5f00 \u4fe1\u4efb \u680f\uff0c\u6539\u4e3a\u59cb\u7ec8\u4fe1\u4efb\u5373\u53ef\u3002","title":"\u4e0b\u8f7d\u8bc1\u4e66"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28140%29%20%E9%85%8D%E7%BD%AEMac%E7%8E%AF%E5%A2%83mitmproxy/#_4","text":"\u6211\u4eec\u6765\u6d4b\u8bd5\u4e0b\u5f55\u5236\u751f\u6210\u529f\u80fd\u3002 \u81f3\u4e8e\u8fd9\u91cc\u8bf4\u7684\u914d\u7f6e\u597dweb\u4ee3\u7406\uff0c\u5c31\u662f\u4e0a\u8ff0\u6b65\u9aa4\u3002\u4ee3\u7406\u59cb\u7ec8\u662f\u4f5c\u4e3a\u4e00\u4e2a\u4e2d\u95f4\u4eba\uff0c\u62ff\u5230\u6211\u4eec\u548c\u76ee\u6807\u4e4b\u95f4\u7684\u8bf7\u6c42\u6570\u636e\u3002","title":"\u6d4b\u8bd5\u4e00\u4e0b"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28140%29%20%E9%85%8D%E7%BD%AEMac%E7%8E%AF%E5%A2%83mitmproxy/#_5","text":"\u76ee\u524d\u4e3a\u6b62\uff0c\u6211\u4eec\u90fd\u662f\u5728\u672c\u5730\u8bbf\u95eemitmproxy\uff0c\u53ef\u662f\u4eca\u5929\u5f53\u6211\u53d1\u73b0\u6211\u7528\u81ea\u5df1\u90e8\u7f72\u7684\u670d\u52a1\u5668\u5f53\u4ee3\u7406\uff0c\u5c45\u7136\u65e0\u6cd5\u8bbf\u95ee\u7f51\u7edc: \u8fd9\u4e2a\u6211\u76ee\u524d\u8fd8\u6ca1\u6709\u597d\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u5982\u679c\u5927\u5bb6\u5185\u90e8\u516c\u53f8\u7528\u7684\u8bdd\uff0c\u5e94\u8be5\u4e0d\u4f1a\u7ecf\u8fc7 \u57df\u540d\u5907\u6848\u68c0\u6d4b \u7684\u73af\u8282\u3002 \u4eca\u5929\u7684\u5185\u5bb9\u6ca1\u6709\u4ee3\u7801\u90e8\u5206\uff0c\u53ea\u662f\u7ed9\u5927\u5bb6\u5c55\u793a\u4e86\u4e00\u4e0bmac\u73af\u5883\u7684mitmproxy\u76f8\u5173\u4ee3\u7406\u914d\u7f6e\u53ca\u4f7f\u7528\uff0c\u4e5f\u6ce1\u51fa\u4e86\u4e00\u4e2a\u95ee\u9898\u3002\u4e0b\u4e00\u8282\u6211\u4eec\u6765\u7f8e\u5316\u4e0b\u7528\u4f8b\u751f\u6210\u65b0\u7684\u5185\u5bb9\uff0c\u53ef\u4ee5\u7ed9\u5927\u5bb6\u770b\u770b\u8c0d\u7167:","title":"\u6709\u4e2a\u7591\u60d1"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28141%29%20%E4%BC%98%E5%8C%96%E6%B7%BB%E5%8A%A0%E7%94%A8%E4%BE%8B%E5%8A%9F%E8%83%BD/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u7f16\u5199\u4e86Mac\u73af\u5883\u914d\u7f6emitmproxy\u76f8\u5173\u7684\u6559\u7a0b\uff0c\u6211\u4eec\u4e5f\u7559\u4e0b\u4e86\u4e00\u4e2a \u7591\u95ee \u3002\uff08\u5176\u5b9e\u6211\u4e5f\u6ca1\u6709\u5f88\u597d\u7684\u529e\u6cd5\u89e3\u51b3\u5b83\uff0c\u5c31\u6682\u65f6\u5148\u653e\u4e00\u653e\uff09\u8fd9\u8282\u6211\u4eec\u53ef\u4ee5\u6536\u62fe\u4e0b\u5fc3\u60c5\uff0c\u628a\u7528\u4f8b\u5f55\u5236\u751f\u6210\u529f\u80fd\u505a\u5f97\u7a0d\u5fae \u7ec6\u81f4 \u4e00\u70b9\u3002\u4e5f\u5c31\u662f\u80fd\u591f\u5728\u6dfb\u52a0\u7528\u4f8b\u7684\u65f6\u5019\uff0c\u591a\u4e00\u4e9b\u9009\u62e9\u3002 \u6539\u9020\u6dfb\u52a0\u7528\u4f8b \u6dfb\u52a0\u7528\u4f8b\u8fd9\u5757\uff0c\u4e4b\u524d\u6211\u4eec\u6539\u9020\u8fc7\u4e00\u6b21\uff0c\u628a\u5b83\u4ece \u72ec\u7acb \u7684\u9875\u9762\u7ed9\u5206\u89e3\u4e86\u51fa\u6765\uff0c\u73b0\u5728\u662f\u4e00\u4e2a\u5f39\u7a97\u5f62\u5f0f: \u4f46\u73b0\u5728\u6211\u4eec\u60f3\u652f\u6301\u4e00\u4e9b\u522b\u7684\u5f62\u5f0f\u7684case\uff0c\u6bd4\u5982har/\u5f55\u5236\u7684\u7528\u4f8b\uff0c\u540e\u7eed\u53ef\u80fd\u8fd8\u8981\u5bfc\u5165httprunner/jmx\u7684\u7528\u4f8b\uff0c\u6240\u4ee5\u6211\u4eec\u70b9\u51fb\u6dfb\u52a0\u7528\u4f8b\u7684\u65f6\u5019\uff0c\u9700\u8981\u589e\u52a0\u4e00\u4e2a\u65b0\u7684\u5165\u53e3, \u5982\u4e0b\u56fe\u6240\u793a: \u70b9\u5f00\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u4e00\u4e2a\u65b0\u7684\u8868\u5355: \u5f55\u5236\u7684\u8bdd\uff0c\u57fa\u672c\u51b3\u5b9a\u76ee\u5f55\u548c\u7528\u4f8b\u540d\u79f0\u5c31\u53ef\u4ee5\u4e86\uff0c\u7a0d\u5fae\u7b80\u5355\u70b9\u3002\u4e0b\u65b9\u76842\u4e2a\u6309\u94ae\u5219\u662f\u7ed9\u7528\u6237\u4e00\u4e2a\u9009\u62e9\uff0c\u5230\u5e95\u662f\u9009\u7528\u5f55\u5236\u5230\u7684\u6309\u94ae\uff0c\u8fd8\u662f\u51b3\u5b9a\u5bfc\u5165har\u6587\u4ef6\u3002 \u8fd92\u8005\u90fd\u6ca1\u6709\u5927\u7684\u533a\u522b\uff0c\u90fd\u662f\u4e3a\u4e86\u5148\u751f\u6210RequestInfo\u6570\u7ec4\uff0c\u63a5\u7740\u5c06\u4ed6\u4eec\u8f6c\u6362\u4e3a \u6d4b\u8bd5\u7528\u4f8b \u3002 \u7f16\u5199\u4ee3\u7801 \u5fae\u8c03\u751f\u6210\u7528\u4f8b\u63a5\u53e3 \u867d\u7136\u6211\u4eec\u53ef\u4ee5\u7b80\u5355\u70b9\uff0c\u8ba9\u7528\u6237\u624b\u52a8\u751f\u6210\u7528\u4f8b\u4e4b\u540e\u53bb\u6539 \u7528\u4f8b\u540d\u79f0 \uff0c\u4f46\u662f\u672c\u8eab\u6211\u4eec\u5c31\u662f\u9700\u8981\u7528\u6237\u9009\u62e9\u76ee\u5f55\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u628a\u7528\u4f8b\u540d\u79f0\u4e5f\u5b89\u6392\u4e86\u3002 \u4e3a\u6b64\u6211\u4eec\u9700\u8981\u4fee\u6539generate_case\u63a5\u53e3: \u4fee\u6539schema \u4fee\u6539\u63a5\u53e3 \u591a\u4f20\u5165\u4e00\u4e2aform\u53c2\u6570 \u4fee\u6539\u5177\u4f53\u7ec6\u8282 \u5220\u9664\u8fd9\u4e00\u884c\u4ee3\u7801\uff0c\u4f7f\u7528\u4f20\u5165\u7684name\u53c2\u6570\u3002 \u7f16\u5199\u5bfc\u5165har\u7684\u63a5\u53e3 \u56e0\u4e3a\u6211\u4eec\u540e\u7eed\u53ef\u80fd\u8fd8\u652f\u6301\u5176\u4ed6\u6587\u4ef6\u7684\u5bfc\u5165\uff0c\u6240\u4ee5url\uff0c\u53c2\u6570\u7b49\u90fd\u4e0d\u80fd\u5199\u6b7b\uff0c\u6700\u597d\u662f\u80fd\u591f\u652f\u6301\u4e00\u4e9b\u7c7b\u578b\uff0c\u6bd4\u5982\u6211\u73b0\u5728\u53ea\u652f\u6301har\uff0c\u90a3\u5c31har=1\uff0c\u6240\u4ee5\u6211\u4eec\u53bb\u5b9a\u4e49\u4e00\u4e2ahar\u679a\u4e3e: \u63a5\u7740\u6211\u4eec\u9700\u8981\u8c03\u6574\u4e00\u4e0b\u4e4b\u524d\u7684\u5bfc\u5165\u65b9\u6cd5\uff0c\u56e0\u4e3a\u6211\u4eec\u4e4b\u524d\u662f\u4f20\u5165\u6587\u4ef6\u8def\u5f84+\u6b63\u5219\u7684\u5f62\u5f0f\uff0c\u6211\u4eec\u8fd9\u91cc\u7684\u4e0a\u4f20har\u63a5\u53e3\u63a5\u6536\u7684\u76f4\u63a5\u5c31\u662f\u6587\u4ef6\u6d41\u5bf9\u8c61\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u6539\u4e3afile_object\uff1a import json import re from typing import List from app.core.request.convertor import Convertor from app.excpetions.convert.ConvertException import HarConvertException from app.schema.request import RequestInfo class HarConvertor ( Convertor ): @staticmethod def convert_from_file ( file , regex : str = None ) -> List [ RequestInfo ]: with open ( file , \"r\" , encoding = \"utf-8\" ) as f : return HarConvertor . _convert ( f , regex ) @staticmethod def _convert ( f , regex : str = None ): try : flag = None if regex is not None : flag = re . compile ( regex ) # \u52a0\u8f7dhar\u8bf7\u6c42\u6570\u636e data = json . load ( f ) ans = [] entries = data . get ( \"log\" , {}) . get ( \"entries\" ) if not entries : raise HarConvertException ( \"entries\u6570\u636e\u4e3a\u7a7a\" ) for entry in entries : # \u5982\u679c\u662ffetch\u6216xhr\u63a5\u53e3\uff0c\u8bf4\u660e\u662fhttp\u8bf7\u6c42\uff08\u6682\u4e0d\u652f\u6301js) if entry . get ( \"_resourceType\" ) . lower () in ( \"fetch\" , \"xhr\" ): request_data = entry . get ( \"request\" ) response_data = entry . get ( \"response\" ) url = request_data . get ( \"url\" ) if flag is not None and not re . findall ( flag , url ): # \u7531\u4e8e\u4e0d\u7b26\u5408\u9884\u671f\u7684url\uff0c\u6240\u4ee5\u8fc7\u6ee4\u6389 continue info = RequestInfo ( url = url , response_data = entry . get ( \"response\" ), body = HarConvertor . get_body ( request_data ), status_code = response_data . get ( \"status\" ), request_method = request_data . get ( \"method\" ), request_headers = HarConvertor . get_kv ( request_data ), response_headers = HarConvertor . get_kv ( response_data ), cookies = HarConvertor . get_kv ( response_data , \"cookies\" ), request_cookies = HarConvertor . get_kv ( request_data , \"cookies\" ), response_content = response_data . get ( \"content\" , {}) . get ( \"text\" ) ) ans . append ( info ) return ans except HarConvertException as e : raise HarConvertException ( f \"har\u6587\u4ef6\u8f6c\u6362\u5f02\u5e38: { e } \" ) except Exception as e : raise HarConvertException ( f \"har\u6587\u4ef6\u8f6c\u6362\u5931\u8d25: { e } \" ) @staticmethod def convert ( file_data , regex : str = None ) -> List [ RequestInfo ]: return HarConvertor . _convert ( file_data , regex ) @staticmethod def get_kv ( request_data : dict , key : str = \"headers\" ) -> dict : \"\"\" \u901a\u8fc7response/request\u83b7\u53d6header\u4fe1\u606f :param key: :param request_data: :return: \"\"\" headers = request_data . get ( key ) result = dict () for h in headers : result [ h . get ( \"name\" )] = h . get ( \"value\" ) return result @staticmethod def get_body ( request_data : dict ): data = request_data . get ( \"postData\" , {}) return data . get ( \"text\" , '' ) if __name__ == \"__main__\" : requests = HarConvertor . convert_from_file ( \"./pity.fun.har\" ) print ( requests ) \u5176\u4ed6\u4ee3\u7801\u6ca1\u53d8\u5316\uff0c\u6211\u4eec\u52a0\u5165\u4e86\u4e00\u4e2a_convert\u65b9\u6cd5\uff0c\u5e76\u5199\u4e86\u4e00\u4e2a\u5185\u90e8\u7684convert_from_file\u7684\u65b9\u6cd5\uff0c\u4ee5\u6b64\u6765\u517c\u5bb9\u4e4b\u524d\u7684\u6d4b\u8bd5\u6570\u636e\u3002 \u6ce8\u610f\u8fd9\u91cc\u8fd8\u6709\u4e00\u4e9b\u53d8\u5316\uff0c\u7531\u4e8e\u6211\u4eec\u4e4b\u524d\u63d0\u53d6\u7684RequestInfo\u88ab\u6211\u4eec\u653e\u5165\u4e86schema\uff0c\u6240\u4ee5\u4ed6\u4e0d\u80fd\u76f4\u63a5\u521d\u59cb\u5316\uff0c\u5f97\u4fee\u6539\u4e0b\u6784\u9020\u7684\u5730\u65b9\u3002 \u63a5\u7740\u6211\u4eec\u5c31\u9700\u8981\u7f16\u5199\u5bf9\u5e94\u7684\u63a5\u53e3\u4e86\uff0c\u6211\u4eec\u5f97\u5148\u7f16\u5199\u4e00\u4e2a\u6839\u636eConvertorType\u503c\u8fd4\u56de\u8f6c\u6362\u5668\u7684\u65b9\u6cd5: \u65b0\u5efaapp/core/request/__init__.py from app.core.request.convertor import Convertor from app.core.request.har_convertor import HarConvertor from app.enums.ConvertorEnum import CaseConvertorType def get_convertor ( c : CaseConvertorType ) -> ( Convertor . convert , str ): if c == CaseConvertorType . har : return HarConvertor . convert , CaseConvertorType . har . name return None , \"\" \u5f53\u7b49\u4e8ehar\u65f6\uff0c\u6211\u4eec\u8fd4\u56deHar\u7684\u6784\u9020\u5668\uff0c\u5426\u5219\u8fd4\u56deNone\uff0c\u7b2c\u4e8c\u4e2a\u53d8\u91cf\u4f1a\u8fd4\u56de\u679a\u4e3e\u540d\u5b57\uff0c\u4e5f\u5c31\u662fhar\u6216\u5176\u4ed6\u3002\u56e0\u4e3a\u6587\u4ef6\u4e0a\u4f20\u7684\u65f6\u5019\u6211\u4eec\u9700\u8981\u5224\u65ad\u540e\u7f00\uff0c\u7528\u6237\u4f1a\u4f20\u5165import_type\uff0c\u6211\u4eec\u987a\u4fbf\u4e5f\u4e00\u8d77\u83b7\u53d6\u4e86\u3002 \u4e0b\u9762\u6765\u770b\u770b\u5177\u4f53\u7684\u63a5\u53e3: \u5f88\u597d\u7406\u89e3\uff0c\u5982\u679c\u8f6c\u6362\u5668\u83b7\u53d6\u5931\u8d25\u4e86\uff0c\u5219\u8fd4\u56de\u3002\u63a5\u7740\u5224\u65ad\u6587\u4ef6\u540e\u7f00\u5bf9\u4e0d\u5bf9\uff0c\u4e0d\u5bf9\u5c31\uff0c\u563f\u563f\u563f\uff01\uff01~ \u6700\u540e\u76f4\u63a5\u8c03\u7528\u8f6c\u6362\u65b9\u6cd5\u5373\u53ef\uff0c\u6bd4\u8f83\u5b9e\u5728\u3002 \u4eca\u5929\u7684\u5185\u5bb9\u5c31\u5148\u4ecb\u7ecd\u5230\u8fd9\u91cc\uff0c\u4e0b\u4e00\u8282\u6211\u4eec\u76f4\u63a5\u8fdb\u5165\u524d\u7aef\u9875\u9762\u7684\u5f00\u53d1\u3002\u987a\u4fbf\u611f\u53d7\u4e0btsx\u7684\u9b45\u529b\u3002","title":"141.\u4f18\u5316\u6dfb\u52a0\u7528\u4f8b\u529f\u80fd"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28141%29%20%E4%BC%98%E5%8C%96%E6%B7%BB%E5%8A%A0%E7%94%A8%E4%BE%8B%E5%8A%9F%E8%83%BD/#_1","text":"\u4e0a\u4e00\u8282\u6211\u4eec\u7f16\u5199\u4e86Mac\u73af\u5883\u914d\u7f6emitmproxy\u76f8\u5173\u7684\u6559\u7a0b\uff0c\u6211\u4eec\u4e5f\u7559\u4e0b\u4e86\u4e00\u4e2a \u7591\u95ee \u3002\uff08\u5176\u5b9e\u6211\u4e5f\u6ca1\u6709\u5f88\u597d\u7684\u529e\u6cd5\u89e3\u51b3\u5b83\uff0c\u5c31\u6682\u65f6\u5148\u653e\u4e00\u653e\uff09\u8fd9\u8282\u6211\u4eec\u53ef\u4ee5\u6536\u62fe\u4e0b\u5fc3\u60c5\uff0c\u628a\u7528\u4f8b\u5f55\u5236\u751f\u6210\u529f\u80fd\u505a\u5f97\u7a0d\u5fae \u7ec6\u81f4 \u4e00\u70b9\u3002\u4e5f\u5c31\u662f\u80fd\u591f\u5728\u6dfb\u52a0\u7528\u4f8b\u7684\u65f6\u5019\uff0c\u591a\u4e00\u4e9b\u9009\u62e9\u3002","title":"\u56de\u987e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28141%29%20%E4%BC%98%E5%8C%96%E6%B7%BB%E5%8A%A0%E7%94%A8%E4%BE%8B%E5%8A%9F%E8%83%BD/#_2","text":"\u6dfb\u52a0\u7528\u4f8b\u8fd9\u5757\uff0c\u4e4b\u524d\u6211\u4eec\u6539\u9020\u8fc7\u4e00\u6b21\uff0c\u628a\u5b83\u4ece \u72ec\u7acb \u7684\u9875\u9762\u7ed9\u5206\u89e3\u4e86\u51fa\u6765\uff0c\u73b0\u5728\u662f\u4e00\u4e2a\u5f39\u7a97\u5f62\u5f0f: \u4f46\u73b0\u5728\u6211\u4eec\u60f3\u652f\u6301\u4e00\u4e9b\u522b\u7684\u5f62\u5f0f\u7684case\uff0c\u6bd4\u5982har/\u5f55\u5236\u7684\u7528\u4f8b\uff0c\u540e\u7eed\u53ef\u80fd\u8fd8\u8981\u5bfc\u5165httprunner/jmx\u7684\u7528\u4f8b\uff0c\u6240\u4ee5\u6211\u4eec\u70b9\u51fb\u6dfb\u52a0\u7528\u4f8b\u7684\u65f6\u5019\uff0c\u9700\u8981\u589e\u52a0\u4e00\u4e2a\u65b0\u7684\u5165\u53e3, \u5982\u4e0b\u56fe\u6240\u793a: \u70b9\u5f00\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u4e00\u4e2a\u65b0\u7684\u8868\u5355: \u5f55\u5236\u7684\u8bdd\uff0c\u57fa\u672c\u51b3\u5b9a\u76ee\u5f55\u548c\u7528\u4f8b\u540d\u79f0\u5c31\u53ef\u4ee5\u4e86\uff0c\u7a0d\u5fae\u7b80\u5355\u70b9\u3002\u4e0b\u65b9\u76842\u4e2a\u6309\u94ae\u5219\u662f\u7ed9\u7528\u6237\u4e00\u4e2a\u9009\u62e9\uff0c\u5230\u5e95\u662f\u9009\u7528\u5f55\u5236\u5230\u7684\u6309\u94ae\uff0c\u8fd8\u662f\u51b3\u5b9a\u5bfc\u5165har\u6587\u4ef6\u3002 \u8fd92\u8005\u90fd\u6ca1\u6709\u5927\u7684\u533a\u522b\uff0c\u90fd\u662f\u4e3a\u4e86\u5148\u751f\u6210RequestInfo\u6570\u7ec4\uff0c\u63a5\u7740\u5c06\u4ed6\u4eec\u8f6c\u6362\u4e3a \u6d4b\u8bd5\u7528\u4f8b \u3002","title":"\u6539\u9020\u6dfb\u52a0\u7528\u4f8b"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28141%29%20%E4%BC%98%E5%8C%96%E6%B7%BB%E5%8A%A0%E7%94%A8%E4%BE%8B%E5%8A%9F%E8%83%BD/#_3","text":"","title":"\u7f16\u5199\u4ee3\u7801"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28141%29%20%E4%BC%98%E5%8C%96%E6%B7%BB%E5%8A%A0%E7%94%A8%E4%BE%8B%E5%8A%9F%E8%83%BD/#_4","text":"\u867d\u7136\u6211\u4eec\u53ef\u4ee5\u7b80\u5355\u70b9\uff0c\u8ba9\u7528\u6237\u624b\u52a8\u751f\u6210\u7528\u4f8b\u4e4b\u540e\u53bb\u6539 \u7528\u4f8b\u540d\u79f0 \uff0c\u4f46\u662f\u672c\u8eab\u6211\u4eec\u5c31\u662f\u9700\u8981\u7528\u6237\u9009\u62e9\u76ee\u5f55\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u628a\u7528\u4f8b\u540d\u79f0\u4e5f\u5b89\u6392\u4e86\u3002 \u4e3a\u6b64\u6211\u4eec\u9700\u8981\u4fee\u6539generate_case\u63a5\u53e3: \u4fee\u6539schema \u4fee\u6539\u63a5\u53e3 \u591a\u4f20\u5165\u4e00\u4e2aform\u53c2\u6570 \u4fee\u6539\u5177\u4f53\u7ec6\u8282 \u5220\u9664\u8fd9\u4e00\u884c\u4ee3\u7801\uff0c\u4f7f\u7528\u4f20\u5165\u7684name\u53c2\u6570\u3002","title":"\u5fae\u8c03\u751f\u6210\u7528\u4f8b\u63a5\u53e3"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28141%29%20%E4%BC%98%E5%8C%96%E6%B7%BB%E5%8A%A0%E7%94%A8%E4%BE%8B%E5%8A%9F%E8%83%BD/#har","text":"\u56e0\u4e3a\u6211\u4eec\u540e\u7eed\u53ef\u80fd\u8fd8\u652f\u6301\u5176\u4ed6\u6587\u4ef6\u7684\u5bfc\u5165\uff0c\u6240\u4ee5url\uff0c\u53c2\u6570\u7b49\u90fd\u4e0d\u80fd\u5199\u6b7b\uff0c\u6700\u597d\u662f\u80fd\u591f\u652f\u6301\u4e00\u4e9b\u7c7b\u578b\uff0c\u6bd4\u5982\u6211\u73b0\u5728\u53ea\u652f\u6301har\uff0c\u90a3\u5c31har=1\uff0c\u6240\u4ee5\u6211\u4eec\u53bb\u5b9a\u4e49\u4e00\u4e2ahar\u679a\u4e3e: \u63a5\u7740\u6211\u4eec\u9700\u8981\u8c03\u6574\u4e00\u4e0b\u4e4b\u524d\u7684\u5bfc\u5165\u65b9\u6cd5\uff0c\u56e0\u4e3a\u6211\u4eec\u4e4b\u524d\u662f\u4f20\u5165\u6587\u4ef6\u8def\u5f84+\u6b63\u5219\u7684\u5f62\u5f0f\uff0c\u6211\u4eec\u8fd9\u91cc\u7684\u4e0a\u4f20har\u63a5\u53e3\u63a5\u6536\u7684\u76f4\u63a5\u5c31\u662f\u6587\u4ef6\u6d41\u5bf9\u8c61\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u6539\u4e3afile_object\uff1a import json import re from typing import List from app.core.request.convertor import Convertor from app.excpetions.convert.ConvertException import HarConvertException from app.schema.request import RequestInfo class HarConvertor ( Convertor ): @staticmethod def convert_from_file ( file , regex : str = None ) -> List [ RequestInfo ]: with open ( file , \"r\" , encoding = \"utf-8\" ) as f : return HarConvertor . _convert ( f , regex ) @staticmethod def _convert ( f , regex : str = None ): try : flag = None if regex is not None : flag = re . compile ( regex ) # \u52a0\u8f7dhar\u8bf7\u6c42\u6570\u636e data = json . load ( f ) ans = [] entries = data . get ( \"log\" , {}) . get ( \"entries\" ) if not entries : raise HarConvertException ( \"entries\u6570\u636e\u4e3a\u7a7a\" ) for entry in entries : # \u5982\u679c\u662ffetch\u6216xhr\u63a5\u53e3\uff0c\u8bf4\u660e\u662fhttp\u8bf7\u6c42\uff08\u6682\u4e0d\u652f\u6301js) if entry . get ( \"_resourceType\" ) . lower () in ( \"fetch\" , \"xhr\" ): request_data = entry . get ( \"request\" ) response_data = entry . get ( \"response\" ) url = request_data . get ( \"url\" ) if flag is not None and not re . findall ( flag , url ): # \u7531\u4e8e\u4e0d\u7b26\u5408\u9884\u671f\u7684url\uff0c\u6240\u4ee5\u8fc7\u6ee4\u6389 continue info = RequestInfo ( url = url , response_data = entry . get ( \"response\" ), body = HarConvertor . get_body ( request_data ), status_code = response_data . get ( \"status\" ), request_method = request_data . get ( \"method\" ), request_headers = HarConvertor . get_kv ( request_data ), response_headers = HarConvertor . get_kv ( response_data ), cookies = HarConvertor . get_kv ( response_data , \"cookies\" ), request_cookies = HarConvertor . get_kv ( request_data , \"cookies\" ), response_content = response_data . get ( \"content\" , {}) . get ( \"text\" ) ) ans . append ( info ) return ans except HarConvertException as e : raise HarConvertException ( f \"har\u6587\u4ef6\u8f6c\u6362\u5f02\u5e38: { e } \" ) except Exception as e : raise HarConvertException ( f \"har\u6587\u4ef6\u8f6c\u6362\u5931\u8d25: { e } \" ) @staticmethod def convert ( file_data , regex : str = None ) -> List [ RequestInfo ]: return HarConvertor . _convert ( file_data , regex ) @staticmethod def get_kv ( request_data : dict , key : str = \"headers\" ) -> dict : \"\"\" \u901a\u8fc7response/request\u83b7\u53d6header\u4fe1\u606f :param key: :param request_data: :return: \"\"\" headers = request_data . get ( key ) result = dict () for h in headers : result [ h . get ( \"name\" )] = h . get ( \"value\" ) return result @staticmethod def get_body ( request_data : dict ): data = request_data . get ( \"postData\" , {}) return data . get ( \"text\" , '' ) if __name__ == \"__main__\" : requests = HarConvertor . convert_from_file ( \"./pity.fun.har\" ) print ( requests ) \u5176\u4ed6\u4ee3\u7801\u6ca1\u53d8\u5316\uff0c\u6211\u4eec\u52a0\u5165\u4e86\u4e00\u4e2a_convert\u65b9\u6cd5\uff0c\u5e76\u5199\u4e86\u4e00\u4e2a\u5185\u90e8\u7684convert_from_file\u7684\u65b9\u6cd5\uff0c\u4ee5\u6b64\u6765\u517c\u5bb9\u4e4b\u524d\u7684\u6d4b\u8bd5\u6570\u636e\u3002 \u6ce8\u610f\u8fd9\u91cc\u8fd8\u6709\u4e00\u4e9b\u53d8\u5316\uff0c\u7531\u4e8e\u6211\u4eec\u4e4b\u524d\u63d0\u53d6\u7684RequestInfo\u88ab\u6211\u4eec\u653e\u5165\u4e86schema\uff0c\u6240\u4ee5\u4ed6\u4e0d\u80fd\u76f4\u63a5\u521d\u59cb\u5316\uff0c\u5f97\u4fee\u6539\u4e0b\u6784\u9020\u7684\u5730\u65b9\u3002 \u63a5\u7740\u6211\u4eec\u5c31\u9700\u8981\u7f16\u5199\u5bf9\u5e94\u7684\u63a5\u53e3\u4e86\uff0c\u6211\u4eec\u5f97\u5148\u7f16\u5199\u4e00\u4e2a\u6839\u636eConvertorType\u503c\u8fd4\u56de\u8f6c\u6362\u5668\u7684\u65b9\u6cd5: \u65b0\u5efaapp/core/request/__init__.py from app.core.request.convertor import Convertor from app.core.request.har_convertor import HarConvertor from app.enums.ConvertorEnum import CaseConvertorType def get_convertor ( c : CaseConvertorType ) -> ( Convertor . convert , str ): if c == CaseConvertorType . har : return HarConvertor . convert , CaseConvertorType . har . name return None , \"\" \u5f53\u7b49\u4e8ehar\u65f6\uff0c\u6211\u4eec\u8fd4\u56deHar\u7684\u6784\u9020\u5668\uff0c\u5426\u5219\u8fd4\u56deNone\uff0c\u7b2c\u4e8c\u4e2a\u53d8\u91cf\u4f1a\u8fd4\u56de\u679a\u4e3e\u540d\u5b57\uff0c\u4e5f\u5c31\u662fhar\u6216\u5176\u4ed6\u3002\u56e0\u4e3a\u6587\u4ef6\u4e0a\u4f20\u7684\u65f6\u5019\u6211\u4eec\u9700\u8981\u5224\u65ad\u540e\u7f00\uff0c\u7528\u6237\u4f1a\u4f20\u5165import_type\uff0c\u6211\u4eec\u987a\u4fbf\u4e5f\u4e00\u8d77\u83b7\u53d6\u4e86\u3002 \u4e0b\u9762\u6765\u770b\u770b\u5177\u4f53\u7684\u63a5\u53e3: \u5f88\u597d\u7406\u89e3\uff0c\u5982\u679c\u8f6c\u6362\u5668\u83b7\u53d6\u5931\u8d25\u4e86\uff0c\u5219\u8fd4\u56de\u3002\u63a5\u7740\u5224\u65ad\u6587\u4ef6\u540e\u7f00\u5bf9\u4e0d\u5bf9\uff0c\u4e0d\u5bf9\u5c31\uff0c\u563f\u563f\u563f\uff01\uff01~ \u6700\u540e\u76f4\u63a5\u8c03\u7528\u8f6c\u6362\u65b9\u6cd5\u5373\u53ef\uff0c\u6bd4\u8f83\u5b9e\u5728\u3002 \u4eca\u5929\u7684\u5185\u5bb9\u5c31\u5148\u4ecb\u7ecd\u5230\u8fd9\u91cc\uff0c\u4e0b\u4e00\u8282\u6211\u4eec\u76f4\u63a5\u8fdb\u5165\u524d\u7aef\u9875\u9762\u7684\u5f00\u53d1\u3002\u987a\u4fbf\u611f\u53d7\u4e0btsx\u7684\u9b45\u529b\u3002","title":"\u7f16\u5199\u5bfc\u5165har\u7684\u63a5\u53e3"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28142%29%20%E9%80%9A%E8%BF%87har%E6%96%87%E4%BB%B6%E7%94%9F%E6%88%90%E7%94%A8%E4%BE%8B/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \u56de\u987e \u6e29\u6545\u800c\u77e5\u65b0\uff0c\u7279\u522b\u662f\u5f88\u4e45\u4e0d\u6765\u8ddf\u7cfb\u5217\u7684\u8bfb\u8005\uff0c\u6bcf\u6b21\u770b\u770b\u56de\u987e\u90fd\u633a\u4e0d\u9519\u7684\uff0c\u8fd8\u8bb0\u5f97\u4e0a\u4e00\u8282\u8bb2\u4e86\u5565\u3002 \u4e0a\u4e00\u8282\u6211\u4eec\u7f16\u5199\u4e86\u5bfc\u5165har\u7684\u63a5\u53e3\uff0c\u8fd9\u4e00\u8282\u6211\u4eec\u5c31\u5b9e\u73b0\u524d\u7aef\u90e8\u5206\u53bb\u914d\u5408\u5b83\u3002 \u7f16\u5199\u524d\u7aef\u90e8\u5206 \u8fd8\u8bb0\u5f97\u4e4b\u524d\u6211\u4eec\u7f16\u5199\u7684\u7528\u4f8b\u5f55\u5236\u9875\u9762\u5417\uff1f\u6211\u51b3\u5b9a\u628a\u5b83\u7684table\u90e8\u5206\u62bd\u79bb\u51fa\u6765\uff0c\u56e0\u4e3a\u8fd9\u5757\u662f\u53ef\u4ee5\u590d\u7528\u7684\u3002 \u5e76\u4e14\u6211\u7ed9\u81ea\u5df1\u5b9a\u4e86\u4e00\u4e2a\u5c0f\u76ee\u6807\uff0c\u540e\u7eed\u7684\u7ec4\u4ef6\u90fd\u57fa\u672c\u4e0a\u7528tsx\u5f00\u53d1\uff0c\u867d\u7136\u5f88\u8270\u96be\uff0c\u4f46\u662f\u6709\u538b\u529b\u5c31\u6709\u52a8\u529b\uff0c\u4f55\u51b5tsx\u5b8c\u7f8e\u517c\u5bb9jsx\u3002 \u63d0\u53d6table\u90e8\u5206\uff0c\u65b0\u5efasrc/components/TestCase/recorder/RequestInfoList.tsx import React from \"react\"; import type {ColumnsType} from \"antd/lib/table/Table\"; import {Modal, Table, Tag, Tooltip} from \"antd\"; import SyntaxHighlighter from \"react-syntax-highlighter\"; import {vs2015} from \"react-syntax-highlighter/dist/cjs/styles/hljs\"; import {TableRowSelection} from \"antd/lib/table/interface\"; import NoRecord from \"@/components/NotFound/NoRecord\"; interface RequestProps { index: number; url: string; request_method: string; status_code: number | string; response_headers: string; request_headers: string; body: string; } interface RequestInfoProps { dataSource: Array<RequestProps>; rowKey?: string; rowSelection: TableRowSelection<any>; loading?: boolean; emptyText?: string | '\u6682\u65e0\u6570\u636e'; } interface TagProps { color: string; fontColor: string; } const tagColor = (method: string): TagProps => { switch (method.toUpperCase()) { case \"GET\": return {color: 'rgb(235, 249, 244)', fontColor: 'rgb(47, 177, 130)'} case \"POST\": return {color: 'rgb(242, 244, 248)', fontColor: 'rgb(5, 112, 175)'} case \"PUT\": return {color: 'rgb(255, 247, 230)', fontColor: 'rgb(255, 174, 0)'} case \"DELETE\": return {color: 'rgb(253, 244, 246)', fontColor: 'rgb(222, 72, 108)'} default: return {color: 'rgb(243, 251, 254)', fontColor: 'rgb(166, 187, 210)'} } } const MethodTag = ({color, text, fontColor}) => { return <Tag style={{color: fontColor, borderRadius: 12, padding: '0 12px'}} color={color}>{text}</Tag> } const Detail = ({name, record}) => { return <a onClick={() => { Modal.info({ title: name, width: 700, bodyStyle: {padding: -12}, content: <SyntaxHighlighter language=\"json\" style={vs2015}>{record[name]}</SyntaxHighlighter> }) }}>\u8be6\u7ec6</a> } const RequestInfoList: React.FC<RequestInfoProps> = ({dataSource, loading, ...restProps}) => { const columns: ColumnsType<RequestProps> = [ { title: '\u7f16\u53f7', key: 'index', render: (text, record, index) => `${index + 1}` }, { title: '\u8bf7\u6c42\u5730\u5740', key: 'url', dataIndex: 'url', width: '20%', render: url => <Tooltip title={url}><a href={url}>{url.slice(0, 48)}</a> </Tooltip> }, { title: '\u8bf7\u6c42\u65b9\u5f0f', key: 'request_method', dataIndex: 'request_method', render: md => <MethodTag fontColor={tagColor(md).fontColor} color={tagColor(md).color} text={md}/> }, { title: '\u8bf7\u6c42headers', key: 'request_headers', dataIndex: 'request_headers', render: (request_headers, record): React.ReactNode => { return <Detail name=\"request_headers\" record={record}/> } }, { title: '\u8bf7\u6c42\u53c2\u6570', key: 'body', dataIndex: 'body', render: (body, record) => { if (!body) { return '-' } return <Detail name=\"body\" record={record}/> } }, { title: '\u8fd4\u56deheaders', key: 'response_headers', dataIndex: 'response_headers', render: (response_headers, record) => { if (!response_headers) { return '-' } return <Detail name=\"response_headers\" record={record}/> } }, { title: 'response', key: 'response_content', dataIndex: 'response_content', render: (response_content, record) => { if (!response_content) { return '-' } return <Detail name=\"response_content\" record={record}/> } }, ] return ( <Table columns={columns} pagination={false} dataSource={dataSource} rowSelection={restProps.rowSelection} rowKey={record => record[restProps.rowKey]} loading={loading} locale={{emptyText: <NoRecord desc={restProps.emptyText} height={150}/>}}/> ) } export default RequestInfoList; \u5176\u5b9e\u5177\u4f53\u7ec6\u8282\u4e5f\u5f88jsx\u5dee\u4e0d\u591a\uff0c\u7531\u4e8ets\u6211\u8fd8\u4e0d\u662f\u5f88\u719f\uff0c\u6211\u6682\u65f6\u628a\u5b83\u5f53\u505aPropType\u5728\u7528\uff08\u4ee5\u524d\u65e9\u671f\u7684\u65f6\u5019\u6211\u4eec\u90fd\u4f1a\u5b9a\u4e49PropType\u4fdd\u8bc1\u7ec4\u4ef6\u7684\u5165\u53c2\uff09\u3002 \u8fd9\u91cc\u6211\u5b9a\u4e49\u4e86RequestInfoProps\u53c2\u6570\uff0c\u4f5c\u4e3aRequestInfoList\u7ec4\u4ef6\u7684\u5165\u53c2\uff0c\u6709\u4e00\u90e8\u5206\u53ef\u4ee5\u7701\u7565\uff0c\u6bd4\u5982emptytext\uff0c\u4e5f\u53ef\u4ee5\u7ed9 \u9ed8\u8ba4\u503c \u3002 \u53ef\u4ee5\u770b\u5230\uff0ctsx\u9664\u4e86\u4e00\u4e9b\u53d8\u91cf\u7c7b\u578b\u7684\u58f0\u660e\uff0cinterface\u7684\u5b9a\u4e49\uff0c<\u6cdb\u578b>\u7684\u4f7f\u7528\uff0c\u5176\u4ed6\u548cjsx\u4e5f\u6ca1\u6709\u592a\u5927\u533a\u522b\uff08\u5b89\u6170\u4f60\u4eec\uff0c\u4e5f\u5b89\u6170\u6211\u81ea\u5df1\uff0c\u53ef\u4ee5\u5c1d\u8bd5\u4e0b\u561b\uff09 \u5bf9\u4e8e\u6211\u6765\u8bf4\uff0c\u5c3d\u91cf\u4e0d\u7528any\u5c31\u884c\u4e86\uff0c\u514d\u5f97\u5199\u6210\u4e86any script. \u62bd\u51fa\u7ec4\u4ef6\u4ee5\u540e\u5462\uff0c\u6211\u4eec\u5c31\u9700\u8981\u4f20\u5165dataSource\u4e86\uff0c\u56e0\u4e3a\u8fd9\u5757\u5185\u5bb9\u662f\u4f1a\u7531\u4ed6\u7684 \u7236\u7ec4\u4ef6 \u51b3\u5b9a\u3002 \u63a5\u7740\u6211\u4eec\u7f16\u5199\u7236\u7ec4\u4ef6\u90e8\u5206\uff0c\u57fa\u672c\u4e0a\u6839\u636e\u7528\u6237\u70b9\u51fb har\u5bfc\u5165 \u548c \u5f55\u5236\u6570\u636e \u6309\u94ae\uff0c\u5c31\u53ef\u4ee5\u51b3\u5b9adataSource\u4e86\uff0c\u5982\u679cdataSource\u4e3a\u7a7a\uff0c\u8fd8\u5f97\u7ed9\u4e2a\u53cb\u597d\u63d0\u793a\uff0c\u8ba9\u7528\u6237\u53bb \u5f55\u5236\u9875\u9762 \u5f55\u5236\u53bb\u3002 \u6211\u4eec\u7684\u8fd9\u4e2a\u8868\u5355\u662f\u653e\u5230Drawer\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u7f16\u5199\u4e00\u4e2aDrawer\u7684tsx\uff0c\u5e76\u628a\u5f00\u542f/\u5173\u95ed \u62bd\u5c49 \u7684\u6743\u5229\u8d4b\u7ed9TestCaseDirectory.jsx\u7ec4\u4ef6\u3002 \u7531\u4e8e\u524d\u7aef\u4ee3\u7801\u5f88\u5360\u7bc7\u5e45\uff0c\u6240\u4ee5\u6211\u4eec\u62bd\u4e00\u90e8\u5206\u51fa\u6765\u8bb2\u89e3: <Drawer title=\"\u751f\u6210\u7528\u4f8b\" onClose={() => setVisible()} visible={visible} width={960} extra={ <Button onClick={onGenerateCase} type=\"primary\"><FireOutlined/> \u751f\u6210\u7528\u4f8b</Button> }> <Form form={form} {...CONFIG.SUB_LAYOUT}> <Row gutter={8}> <Col span={12}> <Form.Item label=\"\u7528\u4f8b\u76ee\u5f55\" name=\"directory_id\" rules={[{required: true, message: '\u8bf7\u9009\u62e9\u7528\u4f8b\u76ee\u5f55'}]}> <TreeSelect placeholder=\"\u8bf7\u9009\u62e9\u7528\u4f8b\u76ee\u5f55\" treeLine treeData={directory}/> </Form.Item> </Col> <Col span={12}> <Form.Item label=\"\u7528\u4f8b\u540d\u79f0\" name=\"name\" rules={[{required: true, message: '\u8bf7\u8f93\u5165\u7528\u4f8b\u540d\u79f0'}]}> <Input placeholder=\"\u8bf7\u8f93\u5165\u7528\u4f8b\u540d\u79f0\"/> </Form.Item> </Col> </Row> </Form> { record.length === 0 ? <Empty image={NoRecord} imageStyle={{height: 220}} description=\"\u5f53\u524d\u6ca1\u6709\u4efb\u4f55\u8bf7\u6c42\u6570\u636e\uff0c\u4f60\u53ef\u4ee5\u9009\u62e9\u3010\u5f55\u5236\u3011\u540e\u7684\u6570\u636e\uff0c\u4e5f\u53ef\u4ee5\u5bfc\u5165har\u6587\u4ef6\u63d0\u53d6\u63a5\u53e3\ud83d\udc4f\"> <Space> <Button onClick={onLoadRecords}><CameraOutlined/> \u5f55\u5236\u8bf7\u6c42</Button> <Upload showUploadList={false} customRequest={onUpload} fileList={[]}> <Button type=\"primary\"> <ImportOutlined/> \u5bfc\u5165Har </Button> </Upload> </Space> </Empty> : <RequestInfoList dataSource={record} rowSelection={rowSelection} rowKey=\"index\" loading={loading.effects['recorder/generateCase']}/> } </Drawer> \u8fd9\u4e2a\u7c7b\u4f3chtml\u7684\u9875\u9762\uff0c\u662f\u6211\u4eec\u7684\u89c6\u56fe\u5c42\u3002\u6211\u4eec\u7684\u5e03\u5c40\u662f\u8fd9\u6837, \u5bf9\u7740\u4ee3\u7801\u770b\u754c\u9762: \u4e0a\u97622\u4e2a\u5b57\u6bb5\u5c5e\u4e8e\u8868\u5355\u4e5f\u5c31\u662fForm\uff0c\u4e0b\u9762\u7684\u5b57\u6bb5\u5c5e\u4e8eRequestInfo\u7ec4\u4ef6\u6216\u8005Empty\uff08\u968f\u7740\u662f\u5426\u6709\u6570\u636e\u5207\u6362\uff09\uff0c\u63a5\u7740\u5c31\u662f\u53f3\u4e0a\u89d2\u7684\u751f\u6210\u6309\u94ae\u3002 \u540e\u7eed\u5bf9\u7740\u7f16\u5199\u4e8b\u4ef6\u5373\u53ef\uff0c\u5176\u5b9e\u524d\u7aef\u4e5f\u4e0d\u7b97 \u590d\u6742 \uff0c\u7b80\u5355\u7684\u8fd8\u662f\u5f88\u597d\u5199\u7684\uff0c\u5c31\u662f\u8fdb\u9636\u611f\u89c9\u5f88\u96be\u3002 \u6700\u540e\u6765\u770b\u770b\u6548\u679c \u522b\u5fd8\u8bb0\u751f\u6210\u540e\u5173\u95ed\u5bf9\u8bdd\u6846\uff0c\u5e76\u4e14\u91cd\u65b0\u83b7\u53d6\u76ee\u5f55\u4e0b\u7684case\u54e6~ \u8fd9\u6837\uff0c\u4e00\u4efd\u7c97\u7cd9\u7684 \u7528\u4f8b\u751f\u6210 \u5c31\u5b8c\u4e8b\u4e86\uff0c\u5176\u5b9e\u8fd8\u6709 \u7528\u4f8b\u5f55\u5236 \u9875\u9762\u6ca1\u6709\u5b8c\u6210\uff0c\u90a3\u4e2a\u5c31\u5148\u6401\u7740\u5427\uff0c\u9700\u8981\u7814\u7a76\u4e00\u4e0bmitmproxy\u4e2d\u7684\u4e00\u4e2a\u53c2\u6570\uff0c\u6682\u4e14\u5356\u4e2a\u5173\u5b50\u3002","title":"142.\u901a\u8fc7har\u6587\u4ef6\u751f\u6210\u7528\u4f8b"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28142%29%20%E9%80%9A%E8%BF%87har%E6%96%87%E4%BB%B6%E7%94%9F%E6%88%90%E7%94%A8%E4%BE%8B/#_1","text":"\u6e29\u6545\u800c\u77e5\u65b0\uff0c\u7279\u522b\u662f\u5f88\u4e45\u4e0d\u6765\u8ddf\u7cfb\u5217\u7684\u8bfb\u8005\uff0c\u6bcf\u6b21\u770b\u770b\u56de\u987e\u90fd\u633a\u4e0d\u9519\u7684\uff0c\u8fd8\u8bb0\u5f97\u4e0a\u4e00\u8282\u8bb2\u4e86\u5565\u3002 \u4e0a\u4e00\u8282\u6211\u4eec\u7f16\u5199\u4e86\u5bfc\u5165har\u7684\u63a5\u53e3\uff0c\u8fd9\u4e00\u8282\u6211\u4eec\u5c31\u5b9e\u73b0\u524d\u7aef\u90e8\u5206\u53bb\u914d\u5408\u5b83\u3002","title":"\u56de\u987e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28142%29%20%E9%80%9A%E8%BF%87har%E6%96%87%E4%BB%B6%E7%94%9F%E6%88%90%E7%94%A8%E4%BE%8B/#_2","text":"\u8fd8\u8bb0\u5f97\u4e4b\u524d\u6211\u4eec\u7f16\u5199\u7684\u7528\u4f8b\u5f55\u5236\u9875\u9762\u5417\uff1f\u6211\u51b3\u5b9a\u628a\u5b83\u7684table\u90e8\u5206\u62bd\u79bb\u51fa\u6765\uff0c\u56e0\u4e3a\u8fd9\u5757\u662f\u53ef\u4ee5\u590d\u7528\u7684\u3002 \u5e76\u4e14\u6211\u7ed9\u81ea\u5df1\u5b9a\u4e86\u4e00\u4e2a\u5c0f\u76ee\u6807\uff0c\u540e\u7eed\u7684\u7ec4\u4ef6\u90fd\u57fa\u672c\u4e0a\u7528tsx\u5f00\u53d1\uff0c\u867d\u7136\u5f88\u8270\u96be\uff0c\u4f46\u662f\u6709\u538b\u529b\u5c31\u6709\u52a8\u529b\uff0c\u4f55\u51b5tsx\u5b8c\u7f8e\u517c\u5bb9jsx\u3002 \u63d0\u53d6table\u90e8\u5206\uff0c\u65b0\u5efasrc/components/TestCase/recorder/RequestInfoList.tsx import React from \"react\"; import type {ColumnsType} from \"antd/lib/table/Table\"; import {Modal, Table, Tag, Tooltip} from \"antd\"; import SyntaxHighlighter from \"react-syntax-highlighter\"; import {vs2015} from \"react-syntax-highlighter/dist/cjs/styles/hljs\"; import {TableRowSelection} from \"antd/lib/table/interface\"; import NoRecord from \"@/components/NotFound/NoRecord\"; interface RequestProps { index: number; url: string; request_method: string; status_code: number | string; response_headers: string; request_headers: string; body: string; } interface RequestInfoProps { dataSource: Array<RequestProps>; rowKey?: string; rowSelection: TableRowSelection<any>; loading?: boolean; emptyText?: string | '\u6682\u65e0\u6570\u636e'; } interface TagProps { color: string; fontColor: string; } const tagColor = (method: string): TagProps => { switch (method.toUpperCase()) { case \"GET\": return {color: 'rgb(235, 249, 244)', fontColor: 'rgb(47, 177, 130)'} case \"POST\": return {color: 'rgb(242, 244, 248)', fontColor: 'rgb(5, 112, 175)'} case \"PUT\": return {color: 'rgb(255, 247, 230)', fontColor: 'rgb(255, 174, 0)'} case \"DELETE\": return {color: 'rgb(253, 244, 246)', fontColor: 'rgb(222, 72, 108)'} default: return {color: 'rgb(243, 251, 254)', fontColor: 'rgb(166, 187, 210)'} } } const MethodTag = ({color, text, fontColor}) => { return <Tag style={{color: fontColor, borderRadius: 12, padding: '0 12px'}} color={color}>{text}</Tag> } const Detail = ({name, record}) => { return <a onClick={() => { Modal.info({ title: name, width: 700, bodyStyle: {padding: -12}, content: <SyntaxHighlighter language=\"json\" style={vs2015}>{record[name]}</SyntaxHighlighter> }) }}>\u8be6\u7ec6</a> } const RequestInfoList: React.FC<RequestInfoProps> = ({dataSource, loading, ...restProps}) => { const columns: ColumnsType<RequestProps> = [ { title: '\u7f16\u53f7', key: 'index', render: (text, record, index) => `${index + 1}` }, { title: '\u8bf7\u6c42\u5730\u5740', key: 'url', dataIndex: 'url', width: '20%', render: url => <Tooltip title={url}><a href={url}>{url.slice(0, 48)}</a> </Tooltip> }, { title: '\u8bf7\u6c42\u65b9\u5f0f', key: 'request_method', dataIndex: 'request_method', render: md => <MethodTag fontColor={tagColor(md).fontColor} color={tagColor(md).color} text={md}/> }, { title: '\u8bf7\u6c42headers', key: 'request_headers', dataIndex: 'request_headers', render: (request_headers, record): React.ReactNode => { return <Detail name=\"request_headers\" record={record}/> } }, { title: '\u8bf7\u6c42\u53c2\u6570', key: 'body', dataIndex: 'body', render: (body, record) => { if (!body) { return '-' } return <Detail name=\"body\" record={record}/> } }, { title: '\u8fd4\u56deheaders', key: 'response_headers', dataIndex: 'response_headers', render: (response_headers, record) => { if (!response_headers) { return '-' } return <Detail name=\"response_headers\" record={record}/> } }, { title: 'response', key: 'response_content', dataIndex: 'response_content', render: (response_content, record) => { if (!response_content) { return '-' } return <Detail name=\"response_content\" record={record}/> } }, ] return ( <Table columns={columns} pagination={false} dataSource={dataSource} rowSelection={restProps.rowSelection} rowKey={record => record[restProps.rowKey]} loading={loading} locale={{emptyText: <NoRecord desc={restProps.emptyText} height={150}/>}}/> ) } export default RequestInfoList; \u5176\u5b9e\u5177\u4f53\u7ec6\u8282\u4e5f\u5f88jsx\u5dee\u4e0d\u591a\uff0c\u7531\u4e8ets\u6211\u8fd8\u4e0d\u662f\u5f88\u719f\uff0c\u6211\u6682\u65f6\u628a\u5b83\u5f53\u505aPropType\u5728\u7528\uff08\u4ee5\u524d\u65e9\u671f\u7684\u65f6\u5019\u6211\u4eec\u90fd\u4f1a\u5b9a\u4e49PropType\u4fdd\u8bc1\u7ec4\u4ef6\u7684\u5165\u53c2\uff09\u3002 \u8fd9\u91cc\u6211\u5b9a\u4e49\u4e86RequestInfoProps\u53c2\u6570\uff0c\u4f5c\u4e3aRequestInfoList\u7ec4\u4ef6\u7684\u5165\u53c2\uff0c\u6709\u4e00\u90e8\u5206\u53ef\u4ee5\u7701\u7565\uff0c\u6bd4\u5982emptytext\uff0c\u4e5f\u53ef\u4ee5\u7ed9 \u9ed8\u8ba4\u503c \u3002 \u53ef\u4ee5\u770b\u5230\uff0ctsx\u9664\u4e86\u4e00\u4e9b\u53d8\u91cf\u7c7b\u578b\u7684\u58f0\u660e\uff0cinterface\u7684\u5b9a\u4e49\uff0c<\u6cdb\u578b>\u7684\u4f7f\u7528\uff0c\u5176\u4ed6\u548cjsx\u4e5f\u6ca1\u6709\u592a\u5927\u533a\u522b\uff08\u5b89\u6170\u4f60\u4eec\uff0c\u4e5f\u5b89\u6170\u6211\u81ea\u5df1\uff0c\u53ef\u4ee5\u5c1d\u8bd5\u4e0b\u561b\uff09 \u5bf9\u4e8e\u6211\u6765\u8bf4\uff0c\u5c3d\u91cf\u4e0d\u7528any\u5c31\u884c\u4e86\uff0c\u514d\u5f97\u5199\u6210\u4e86any script. \u62bd\u51fa\u7ec4\u4ef6\u4ee5\u540e\u5462\uff0c\u6211\u4eec\u5c31\u9700\u8981\u4f20\u5165dataSource\u4e86\uff0c\u56e0\u4e3a\u8fd9\u5757\u5185\u5bb9\u662f\u4f1a\u7531\u4ed6\u7684 \u7236\u7ec4\u4ef6 \u51b3\u5b9a\u3002 \u63a5\u7740\u6211\u4eec\u7f16\u5199\u7236\u7ec4\u4ef6\u90e8\u5206\uff0c\u57fa\u672c\u4e0a\u6839\u636e\u7528\u6237\u70b9\u51fb har\u5bfc\u5165 \u548c \u5f55\u5236\u6570\u636e \u6309\u94ae\uff0c\u5c31\u53ef\u4ee5\u51b3\u5b9adataSource\u4e86\uff0c\u5982\u679cdataSource\u4e3a\u7a7a\uff0c\u8fd8\u5f97\u7ed9\u4e2a\u53cb\u597d\u63d0\u793a\uff0c\u8ba9\u7528\u6237\u53bb \u5f55\u5236\u9875\u9762 \u5f55\u5236\u53bb\u3002 \u6211\u4eec\u7684\u8fd9\u4e2a\u8868\u5355\u662f\u653e\u5230Drawer\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u7f16\u5199\u4e00\u4e2aDrawer\u7684tsx\uff0c\u5e76\u628a\u5f00\u542f/\u5173\u95ed \u62bd\u5c49 \u7684\u6743\u5229\u8d4b\u7ed9TestCaseDirectory.jsx\u7ec4\u4ef6\u3002 \u7531\u4e8e\u524d\u7aef\u4ee3\u7801\u5f88\u5360\u7bc7\u5e45\uff0c\u6240\u4ee5\u6211\u4eec\u62bd\u4e00\u90e8\u5206\u51fa\u6765\u8bb2\u89e3: <Drawer title=\"\u751f\u6210\u7528\u4f8b\" onClose={() => setVisible()} visible={visible} width={960} extra={ <Button onClick={onGenerateCase} type=\"primary\"><FireOutlined/> \u751f\u6210\u7528\u4f8b</Button> }> <Form form={form} {...CONFIG.SUB_LAYOUT}> <Row gutter={8}> <Col span={12}> <Form.Item label=\"\u7528\u4f8b\u76ee\u5f55\" name=\"directory_id\" rules={[{required: true, message: '\u8bf7\u9009\u62e9\u7528\u4f8b\u76ee\u5f55'}]}> <TreeSelect placeholder=\"\u8bf7\u9009\u62e9\u7528\u4f8b\u76ee\u5f55\" treeLine treeData={directory}/> </Form.Item> </Col> <Col span={12}> <Form.Item label=\"\u7528\u4f8b\u540d\u79f0\" name=\"name\" rules={[{required: true, message: '\u8bf7\u8f93\u5165\u7528\u4f8b\u540d\u79f0'}]}> <Input placeholder=\"\u8bf7\u8f93\u5165\u7528\u4f8b\u540d\u79f0\"/> </Form.Item> </Col> </Row> </Form> { record.length === 0 ? <Empty image={NoRecord} imageStyle={{height: 220}} description=\"\u5f53\u524d\u6ca1\u6709\u4efb\u4f55\u8bf7\u6c42\u6570\u636e\uff0c\u4f60\u53ef\u4ee5\u9009\u62e9\u3010\u5f55\u5236\u3011\u540e\u7684\u6570\u636e\uff0c\u4e5f\u53ef\u4ee5\u5bfc\u5165har\u6587\u4ef6\u63d0\u53d6\u63a5\u53e3\ud83d\udc4f\"> <Space> <Button onClick={onLoadRecords}><CameraOutlined/> \u5f55\u5236\u8bf7\u6c42</Button> <Upload showUploadList={false} customRequest={onUpload} fileList={[]}> <Button type=\"primary\"> <ImportOutlined/> \u5bfc\u5165Har </Button> </Upload> </Space> </Empty> : <RequestInfoList dataSource={record} rowSelection={rowSelection} rowKey=\"index\" loading={loading.effects['recorder/generateCase']}/> } </Drawer> \u8fd9\u4e2a\u7c7b\u4f3chtml\u7684\u9875\u9762\uff0c\u662f\u6211\u4eec\u7684\u89c6\u56fe\u5c42\u3002\u6211\u4eec\u7684\u5e03\u5c40\u662f\u8fd9\u6837, \u5bf9\u7740\u4ee3\u7801\u770b\u754c\u9762: \u4e0a\u97622\u4e2a\u5b57\u6bb5\u5c5e\u4e8e\u8868\u5355\u4e5f\u5c31\u662fForm\uff0c\u4e0b\u9762\u7684\u5b57\u6bb5\u5c5e\u4e8eRequestInfo\u7ec4\u4ef6\u6216\u8005Empty\uff08\u968f\u7740\u662f\u5426\u6709\u6570\u636e\u5207\u6362\uff09\uff0c\u63a5\u7740\u5c31\u662f\u53f3\u4e0a\u89d2\u7684\u751f\u6210\u6309\u94ae\u3002 \u540e\u7eed\u5bf9\u7740\u7f16\u5199\u4e8b\u4ef6\u5373\u53ef\uff0c\u5176\u5b9e\u524d\u7aef\u4e5f\u4e0d\u7b97 \u590d\u6742 \uff0c\u7b80\u5355\u7684\u8fd8\u662f\u5f88\u597d\u5199\u7684\uff0c\u5c31\u662f\u8fdb\u9636\u611f\u89c9\u5f88\u96be\u3002","title":"\u7f16\u5199\u524d\u7aef\u90e8\u5206"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28142%29%20%E9%80%9A%E8%BF%87har%E6%96%87%E4%BB%B6%E7%94%9F%E6%88%90%E7%94%A8%E4%BE%8B/#_3","text":"\u522b\u5fd8\u8bb0\u751f\u6210\u540e\u5173\u95ed\u5bf9\u8bdd\u6846\uff0c\u5e76\u4e14\u91cd\u65b0\u83b7\u53d6\u76ee\u5f55\u4e0b\u7684case\u54e6~ \u8fd9\u6837\uff0c\u4e00\u4efd\u7c97\u7cd9\u7684 \u7528\u4f8b\u751f\u6210 \u5c31\u5b8c\u4e8b\u4e86\uff0c\u5176\u5b9e\u8fd8\u6709 \u7528\u4f8b\u5f55\u5236 \u9875\u9762\u6ca1\u6709\u5b8c\u6210\uff0c\u90a3\u4e2a\u5c31\u5148\u6401\u7740\u5427\uff0c\u9700\u8981\u7814\u7a76\u4e00\u4e0bmitmproxy\u4e2d\u7684\u4e00\u4e2a\u53c2\u6570\uff0c\u6682\u4e14\u5356\u4e2a\u5173\u5b50\u3002","title":"\u6700\u540e\u6765\u770b\u770b\u6548\u679c"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28143%29%20%E8%A7%A3%E5%86%B3%E4%BB%A3%E7%90%86%E7%9A%84%E9%9A%BE%E9%A2%98/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u5df2\u7ecf\u80fd\u591f\u6253\u901a\u3010har\u6587\u4ef6\u5b9e\u73b0\u5f55\u5236=>\u7528\u4f8b\u751f\u6210\u3011\u7684\u6574\u4f53\u6d41\u7a0b\u3002\u90a3\u4e48\u8fd9\u4e00\u8282\u6211\u4eec\u5c31\u7ee7\u7eed\u628a\u5f55\u5236\u76f8\u5173\u7684\u903b\u8f91\u7406\u6e05\u695a\u3002 \u8fd8\u8bb0\u5f97\u6211\u4eec\u4e4b\u524d\u629b\u51fa\u7684\u95ee\u9898\u4e0d\uff1f \u6211\u8fd9\u91cc\u5176\u5b9e\u9646\u9646\u7eed\u7eed\u53d1\u73b0\u8fc7\u597d\u51e0\u4e2a\u5751\uff0c\u4f46\u662f\u90fd\u4e00\u4e00\u8e0f\u5e73\u4e86\uff0c\u4eca\u5929\u8fd9\u8282\u5c31\u65e0\u79c1\u5949\u732e\u51fa\u6765\uff0c\u5e0c\u671b\u6709\u7f18\u4eba\u80fd\u5c11\u8e29\u5f2f\u8def\u3002 \u672c\u5730\u4e0d\u6613\u5bdf\u89c9\u7684\u95ee\u9898 \u4e3a\u4ec0\u4e48\u95ee\u9898\u62d6\u4e86\u90a3\u4e48\u4e45\uff0c\u90a3\u662f\u56e0\u4e3a\u8fd9\u4e9b \u95ee\u9898 \u672c\u5730\u90fd\u4e0d\u5bb9\u6613\u53d1\u89c9\uff0c\u53ea\u6709\u5230\u4e86\u7ebf\u4e0a\u624d\u4f1a\u51fa\u73b0\u3002\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u6211\u4eec\u672c\u5730\u542f\u52a8\u7684mitmproxy\u7684\u670d\u52a1\u5730\u5740\u662f: 127.0.0.1:77778 \u6211\u4eec\u7684\u8bf7\u6c42\u7ecf\u8fc7\u4e86\u4ee3\u7406\u4e4b\u540e\uff0c\u4e5f\u8fd8\u662f127.0.0.1\uff0c\u4e5f\u5c31\u662f\u8bf4ip\u5e76\u6ca1\u6709\u53d8\u5316\uff0c\u6240\u4ee5\u8fd9\u4f1a \u5bfc\u81f4\u6211\u4eec\u53d1\u73b0\u4e0d\u4e86\u95ee\u9898 \uff01\uff01\uff01 \u4eca\u5929\u6211\u8981\u8bf4\u7684\u95ee\u9898\u4e3b\u8981\u52062\u7c7b: \u7b2c\u4e09\u65b9\u4e91\u670d\u52a1\u5668\u5546 \u4e4b\u524d\u6211\u4eec\u622a\u8fc7\u56fe\uff0c\u817e\u8baf\u4e91\u4f1a\u62e6\u622a\u6211\u4eec\u7684mitm.it\u9875\u9762\uff0c\u63d0\u793a\u6211\u4eec\u6ca1\u6709\u5907\u6848\uff0c\u8fd9\u5c31\u5bfc\u81f4\u4ec0\u4e48\uff1f \u5bf9\uff0c\u6211\u4eec\u65e0\u6cd5\u901a\u8fc7mitm.it\u5b89\u88c5\u8bc1\u4e66\u3002 ip\u95ee\u9898 \u8fd8\u8bb0\u5f97\u6211\u4eec\u662f\u600e\u4e48\u5224\u5b9a\u4e00\u4e2a\u7528\u6237\u6709\u6ca1\u6709\u5728\u5f55\u5236\uff0c\u5f55\u5236\u5f97\u600e\u4e48\u6837\u7684\u5417\uff1f\u6ca1\u9519\uff0c\u6211\u4eec\u662f\u6839\u636e ip \u6765\u7684\uff0c\u60f3\u4e00\u4e0b\u670d\u52a1\u4e0a\u7ebf\u540e\uff0c\u6211\u4eec\u7684ip\u4f9d\u7136\u662f127.0.0.1, \u7ebf\u4e0a\u6211\u4eec\u53ef\u80fd\u7ecf\u8fc7\u4e86nginx\uff0c\u4e5f\u53ef\u80fd\u7ecf\u8fc7\u4e86\u5176\u4ed6\u5404\u7c7b\u670d\u52a1\u5668\u8f6c\u53d1, \u90a3\u6211\u4eec\u7684\u771f\u5b9eip\uff0c\u4ed6\u4eec\u8fd8\u80fd\u5b8c\u7f8e\u62ff\u5230\u5417\uff1f \u7b54\u6848\u662f\u4e0d\u4e00\u5b9a\u7684\u3002 \u9010\u4e2a\u51fb\u7834 \u4e91\u670d\u52a1\u5668\u5546 \u5bf9\u4ed8\u4ed6\u4eec\uff0c\u5176\u5b9e\u6ca1\u6709\u592a\u591a\u529e\u6cd5\u3002\u4f46\u6211\u4eec\u672c\u5730\u914d\u7f6e \u4ee3\u7406 \u4ee5\u540e\uff0c\u8bbf\u95ee\u5230 mitm.it \uff0c\u53ef\u4ee5\u89c2\u5bdf\u5230\uff0c\u5bf9\u5e94\u7684\u8bc1\u4e66\uff0c\u6211\u4eec\u662f\u53ef\u4ee5\u4e0b\u8f7d\u5230\u7684\uff0c\u800c\u4e14\u4e0d\u540c\u64cd\u4f5c\u7cfb\u7edf\u7684\u8bc1\u4e66\u662f\u56fa\u5b9a\u7684\u3002 \u4e5f\u5c31\u662f\u8bf4\u6211\u4eec\u5728\u81ea\u5df1\u7684Request\u5ba2\u6237\u7aef\u91cc\u9762\u52a0\u4e0a\u81ea\u8eab\u4ee3\u7406\uff08\u4e91\u670d\u52a1\u5668\u7ed9\u81ea\u5df1\u4ee3\u7406\uff09\uff0c\u4e5f\u5c31\u662f\u7c7b\u4f3crequests.get\u4e0b\u8f7dmitm.it\u7684\u6587\u4ef6\uff0c\u4f46\u56e0\u4e3a\u8981\u4ee3\u7406\u624d\u80fd\u8bbf\u95ee\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u7ed9requests\u52a0\u5165proxy\u76f8\u5173\u7684\u53c2\u6570\u3002 \u8fd9\u4e2a\u6211\u5df2\u7ecf\u5c01\u88c5\u597d\u4e86\uff0c\u56e0\u4e3a\u4e4b\u524d\u8ba1\u7b97\u8d70mock\u6a21\u5f0f\u3002 \u4e91\u670d\u52a1\u5668\uff08\u901a\u8fc7\u672c\u673a\u4ee3\u7406\uff09\u8bbf\u95eemitm.it\u884c\u5f97\u901a\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5bf9\u5916\u66b4\u9732\u4e00\u4e2aapi\uff1a \u4e0b\u8f7d\u8bc1\u4e66 \u3002 \u8fd9\u4e2a\u8bc1\u4e66\u53ea\u8981\u4e0b\u8f7d\u5230\uff0c\u6211\u4eec\u5c31\u80fd\u987a\u5229\u5b89\u88c5\u5e76\u901a\u8fc7\u4ee3\u7406\u8bbf\u95ee\u5230\u5176\u4ed6\u9875\u9762\uff0c\u4e3a\u540e\u9762\u5f55\u5236\u505a\u94fa\u57ab\u4e86\u3002 ip\u95ee\u9898 \u8fd9\u4e2a\u662f\u56f0\u6270\u6211\u5f88\u4e45\u7684\u4e00\u4e2a\u95ee\u9898\uff0c\u5148\u6765\u770b\u7b2c\u4e00\u4e2a\u3002\u5148\u5047\u8bbe\u6211\u4eec\u7684\u771f\u5b9eip\u90fd\u662f111.111.111.111\uff0c\u6240\u4ee5\u6211\u4eec\u5bf9\u7167\u5f55\u5236\u72b6\u6001\u8fd9\u4e2a\u63a5\u53e3: \u8fd9\u4e00\u5757\u7684\u5185\u5bb9\uff0c\u6211\u4eec\u5e0c\u671b\u7684\u662f\u6839\u636e\u6211\u4eec\u7684\u771f\u5b9eip\u53bb\u83b7\u53d6redis\u91cc\u9762\u7684\u6570\u636e\uff0c\u4f46\u6700\u7ec8\u8d70\u5411\u4f1a\u662f\u4ec0\u4e48\u5462\uff1f \u524d\u7aef\u9875\u9762\u53d1\u8d77\u8bf7\u6c42 \u8bf7\u6c42\u5230\u8fbe\u670d\u52a1\u7aefnginx nginx\u8f6c\u53d1\u5230pity\u771f\u5b9e\u5730\u5740 \u4e5f\u5c31\u662f\u8bf4\uff0cpity\u6536\u5230\u7684\u8bf7\u6c42\uff0c\u5176\u5b9e\u662f\u7531nginx\u53d1\u7ed9\u5b83\u7684\uff0c\u90a3\u4ed6\u62ff\u5230\u7684\uff0c\u5176\u5b9e\u662fnginx\u7684ip\u5730\u5740\uff0c\u5373 nginx\u670d\u52a1\u5668\u5730\u5740 \u3002 \u8fd9\u5c31\u5f15\u53d1\u7b2c\u4e00\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u83b7\u53d6\u4e0d\u5230\u6211\u4eec\u7684 \u5f55\u5236\u6570\u636e \uff08\u6ce8\u610f\u672c\u5730\u5e76\u4e0d\u4f1a\u51fa\u73b0\u54e6\uff0c\u53ea\u6709\u751f\u4ea7\u4f1a\uff09\u3002 \u90a3\u4e48\u600e\u4e48\u89e3\u51b3\u5462\uff1f\u6211\u4eec\u7684nginx\u5728\u8f6c\u53d1\u7684\u65f6\u5019\uff0c\u8981\u5e26\u4e0a\u5bf9\u5e94\u7684\u914d\u7f6e: * \u6ce8\u610f\u8fd9\u4e2aclient_max_body_size\uff0c\u9ed8\u8ba4\u662f1m\uff0c\u8fd9\u91cc\u662fhar\u5bfc\u5165\u7684\u65f6\u5019\u62a5\u9519\u6211\u4fee\u6539\u7684\u3002 \u8fd93\u4e2a\u914d\u7f6e\u4ee3\u8868\uff0c\u628a\u539f\u59cb\u7684\u5ba2\u6237\u7aefip\u5565\u7684\u4e5f\u90fd\u7ee7\u7eed\u8f6c\u53d1\u8fc7\u53bb\u3002\u5982\u6b64\u6211\u4eec\u5c31\u89e3\u51b3\u4e86\u7b2c\u4e00\u4e2a\u95ee\u9898\u3002 \u7b2c\u4e8c\u4e2a\u95ee\u9898 \u7b2c\u4e8c\u4e2a\u95ee\u9898\u6bd4\u8f83\u7c97\u9c81\uff0c\u7531\u4e8e\u6211\u4eec\u5f55\u5236\u7684\u65f6\u5019\uff0c\u6211\u4eec\u5b9e\u9645\u4e0a\u662f\u8d70\u4e86 mitmproxy \u7684\u4ee3\u7406\uff0c\u4f46\u662f\u4ed6\u4e5f\u5f88\u574f\uff0c\u4e0d\u7ed9\u6211\u4eec\u771f\u5b9eip\uff0c\u53ea\u8981\u6211\u4eec\u7ecf\u8fc7\u4ed6\uff0c\u901a\u8fc7fastapi\u83b7\u53d6\u5230\u7684\uff0c\u90fd\u662fmitmproxy\u90e8\u7f72\u7684\u5730\u5740\u3002 \u7ecf\u8fc7\u6211\u4e0d\u65ad\u7684\u63a2\u7d22\uff0c\u7ec8\u4e8e\u627e\u5230\u4e86\u5bf9\u5e94\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u76f4\u63a5\u4e0a\u7b54\u6848\u3002 \u4fee\u6539uvicorn\u7684\u914d\u7f6e \u6211\u662f\u7528gunicorn\u7684\u65b9\u5f0f\uff0c\u6240\u4ee5\u6211\u5728gunicorn.py\u91cc\u9762\u4fee\u6539uvicorn\u7684\u914d\u7f6e: # \u542f\u52a8\u7684\u8fdb\u7a0b\u6570 workers = multiprocessing . cpu_count () worker_class = 'uvicorn.workers.UvicornWorker' forwarded_allow_ips = \"*\" x_forwarded_for_header = 'X-FORWARDED-FOR' forwarded_allow_ips\u8fd9\u4e2a\u53c2\u6570\u662f\u5141\u8bb8forward\u7684ip\uff0c\u6211\u7406\u89e3\u7684\u610f\u601d\u662f\uff0c\u4f60\u91cd\u5b9a\u5411/\u8f6c\u53d1\u4ee5\u540e\uff0c\u7ee7\u7eed\u8f93\u9001\u4f60\u65e7\u7684ip\u3002 \u5176\u5b9enginx\u7684\u914d\u7f6e\uff0c\u4e5f\u662f\u8fd9\u4e2a\u53c2\u6570\uff0c\u5bf9\u4e0d\uff0c\u5176\u5b9e\u5927\u5bb6\u547d\u540d\u90fd\u5f88\u63a5\u8fd1 \uff0c\u7f51\u7edc\u4e0a\u6709\u4e9b\u4eba\u4f1a\u8981\u6c42\u518d\u6539\u4e00\u4e2aheader\u5565\u7684\u914d\u7f6e\uff0c\u6211\u89c2\u5bdf\u4e86\u4e00\u4e0b\u90a3\u4e2a\u914d\u7f6e\u9ed8\u8ba4\u662f \u5f00 \u7684\uff0c\u6240\u4ee5\u4e0d\u9700\u8981\u4e86\u3002 \u6539\u5b8c\u8fd9\u4e2a\u4e4b\u540e\uff0c\u4f60\u7684mitmproxy\u5c31\u4f1a\u6536\u5230\u4f60\u771f\u5b9e\u5730\u5740\uff0c\u4f46\u662f\u8fd9\u6837\u662f \u4e0d\u591f \u7684\u3002\u6211\u4eec\u5982\u679c\u5f55\u5236\u6570\u636e\uff0c\u4f1a\u8d70\u4ee3\u7406\uff0c\u8fd9\u6837\u6211\u4eec\u7684ip\u4f1a\u88ab\u8bc6\u522b\u4e3amitmproxy\u6240\u5728ip\u3002 \u6240\u4ee5\u6211\u4eec\u9700\u8981\u7ee7\u7eed \u63d0\u5347 \uff08forward)\uff0c\u6211\u4eec\u9700\u8981\u5728mitmproxy\u5f55\u5236\u5230\u63a5\u53e3\u7684\u65f6\u5019 \u4e5f\u8bbe\u7f6eforward \u3002 \u5728\u63d2\u4ef6\u4e2d\uff0c\u628a\u771f\u5b9e\u7684ip\u5730\u5740forward\u5373\u53ef\u3002\u4e0b\u9762\u6765\u5c55\u793a\uff0c\u6211\u5728pity.fun\u8fd9\u4e2a\u5730\u5740\u91cc\u9762\u5f55\u5236\u56de\u653e\u7684\u6210\u679c\u3002 \u52b3\u52a8\u6210\u679c \u914d\u7f6e\u4ee3\u7406 \u5168\u7a0b\u4f7f\u7528pity.fun\u73af\u5883\u5f55\u5236 bug\u8b66\u949f\uff0c\u53ef\u4ee5\u770b\u5230\u6700\u540e \u5f55\u5236\u7ed3\u679c \u591a\u4e86\u4e00\u6761\u5f00\u59cb\u5f55\u5236\u7684\u6570\u636e\uff0c\u6211\u4eec\u4e0b\u671f\u89e3\u51b3\u5b83\u3002","title":"143.\u89e3\u51b3\u4ee3\u7406\u7684\u96be\u9898"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28143%29%20%E8%A7%A3%E5%86%B3%E4%BB%A3%E7%90%86%E7%9A%84%E9%9A%BE%E9%A2%98/#_1","text":"\u4e0a\u4e00\u8282\u6211\u4eec\u5df2\u7ecf\u80fd\u591f\u6253\u901a\u3010har\u6587\u4ef6\u5b9e\u73b0\u5f55\u5236=>\u7528\u4f8b\u751f\u6210\u3011\u7684\u6574\u4f53\u6d41\u7a0b\u3002\u90a3\u4e48\u8fd9\u4e00\u8282\u6211\u4eec\u5c31\u7ee7\u7eed\u628a\u5f55\u5236\u76f8\u5173\u7684\u903b\u8f91\u7406\u6e05\u695a\u3002 \u8fd8\u8bb0\u5f97\u6211\u4eec\u4e4b\u524d\u629b\u51fa\u7684\u95ee\u9898\u4e0d\uff1f \u6211\u8fd9\u91cc\u5176\u5b9e\u9646\u9646\u7eed\u7eed\u53d1\u73b0\u8fc7\u597d\u51e0\u4e2a\u5751\uff0c\u4f46\u662f\u90fd\u4e00\u4e00\u8e0f\u5e73\u4e86\uff0c\u4eca\u5929\u8fd9\u8282\u5c31\u65e0\u79c1\u5949\u732e\u51fa\u6765\uff0c\u5e0c\u671b\u6709\u7f18\u4eba\u80fd\u5c11\u8e29\u5f2f\u8def\u3002","title":"\u56de\u987e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28143%29%20%E8%A7%A3%E5%86%B3%E4%BB%A3%E7%90%86%E7%9A%84%E9%9A%BE%E9%A2%98/#_2","text":"\u4e3a\u4ec0\u4e48\u95ee\u9898\u62d6\u4e86\u90a3\u4e48\u4e45\uff0c\u90a3\u662f\u56e0\u4e3a\u8fd9\u4e9b \u95ee\u9898 \u672c\u5730\u90fd\u4e0d\u5bb9\u6613\u53d1\u89c9\uff0c\u53ea\u6709\u5230\u4e86\u7ebf\u4e0a\u624d\u4f1a\u51fa\u73b0\u3002\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u6211\u4eec\u672c\u5730\u542f\u52a8\u7684mitmproxy\u7684\u670d\u52a1\u5730\u5740\u662f: 127.0.0.1:77778 \u6211\u4eec\u7684\u8bf7\u6c42\u7ecf\u8fc7\u4e86\u4ee3\u7406\u4e4b\u540e\uff0c\u4e5f\u8fd8\u662f127.0.0.1\uff0c\u4e5f\u5c31\u662f\u8bf4ip\u5e76\u6ca1\u6709\u53d8\u5316\uff0c\u6240\u4ee5\u8fd9\u4f1a \u5bfc\u81f4\u6211\u4eec\u53d1\u73b0\u4e0d\u4e86\u95ee\u9898 \uff01\uff01\uff01 \u4eca\u5929\u6211\u8981\u8bf4\u7684\u95ee\u9898\u4e3b\u8981\u52062\u7c7b: \u7b2c\u4e09\u65b9\u4e91\u670d\u52a1\u5668\u5546 \u4e4b\u524d\u6211\u4eec\u622a\u8fc7\u56fe\uff0c\u817e\u8baf\u4e91\u4f1a\u62e6\u622a\u6211\u4eec\u7684mitm.it\u9875\u9762\uff0c\u63d0\u793a\u6211\u4eec\u6ca1\u6709\u5907\u6848\uff0c\u8fd9\u5c31\u5bfc\u81f4\u4ec0\u4e48\uff1f \u5bf9\uff0c\u6211\u4eec\u65e0\u6cd5\u901a\u8fc7mitm.it\u5b89\u88c5\u8bc1\u4e66\u3002 ip\u95ee\u9898 \u8fd8\u8bb0\u5f97\u6211\u4eec\u662f\u600e\u4e48\u5224\u5b9a\u4e00\u4e2a\u7528\u6237\u6709\u6ca1\u6709\u5728\u5f55\u5236\uff0c\u5f55\u5236\u5f97\u600e\u4e48\u6837\u7684\u5417\uff1f\u6ca1\u9519\uff0c\u6211\u4eec\u662f\u6839\u636e ip \u6765\u7684\uff0c\u60f3\u4e00\u4e0b\u670d\u52a1\u4e0a\u7ebf\u540e\uff0c\u6211\u4eec\u7684ip\u4f9d\u7136\u662f127.0.0.1, \u7ebf\u4e0a\u6211\u4eec\u53ef\u80fd\u7ecf\u8fc7\u4e86nginx\uff0c\u4e5f\u53ef\u80fd\u7ecf\u8fc7\u4e86\u5176\u4ed6\u5404\u7c7b\u670d\u52a1\u5668\u8f6c\u53d1, \u90a3\u6211\u4eec\u7684\u771f\u5b9eip\uff0c\u4ed6\u4eec\u8fd8\u80fd\u5b8c\u7f8e\u62ff\u5230\u5417\uff1f \u7b54\u6848\u662f\u4e0d\u4e00\u5b9a\u7684\u3002","title":"\u672c\u5730\u4e0d\u6613\u5bdf\u89c9\u7684\u95ee\u9898"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28143%29%20%E8%A7%A3%E5%86%B3%E4%BB%A3%E7%90%86%E7%9A%84%E9%9A%BE%E9%A2%98/#_3","text":"\u4e91\u670d\u52a1\u5668\u5546 \u5bf9\u4ed8\u4ed6\u4eec\uff0c\u5176\u5b9e\u6ca1\u6709\u592a\u591a\u529e\u6cd5\u3002\u4f46\u6211\u4eec\u672c\u5730\u914d\u7f6e \u4ee3\u7406 \u4ee5\u540e\uff0c\u8bbf\u95ee\u5230 mitm.it \uff0c\u53ef\u4ee5\u89c2\u5bdf\u5230\uff0c\u5bf9\u5e94\u7684\u8bc1\u4e66\uff0c\u6211\u4eec\u662f\u53ef\u4ee5\u4e0b\u8f7d\u5230\u7684\uff0c\u800c\u4e14\u4e0d\u540c\u64cd\u4f5c\u7cfb\u7edf\u7684\u8bc1\u4e66\u662f\u56fa\u5b9a\u7684\u3002 \u4e5f\u5c31\u662f\u8bf4\u6211\u4eec\u5728\u81ea\u5df1\u7684Request\u5ba2\u6237\u7aef\u91cc\u9762\u52a0\u4e0a\u81ea\u8eab\u4ee3\u7406\uff08\u4e91\u670d\u52a1\u5668\u7ed9\u81ea\u5df1\u4ee3\u7406\uff09\uff0c\u4e5f\u5c31\u662f\u7c7b\u4f3crequests.get\u4e0b\u8f7dmitm.it\u7684\u6587\u4ef6\uff0c\u4f46\u56e0\u4e3a\u8981\u4ee3\u7406\u624d\u80fd\u8bbf\u95ee\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u7ed9requests\u52a0\u5165proxy\u76f8\u5173\u7684\u53c2\u6570\u3002 \u8fd9\u4e2a\u6211\u5df2\u7ecf\u5c01\u88c5\u597d\u4e86\uff0c\u56e0\u4e3a\u4e4b\u524d\u8ba1\u7b97\u8d70mock\u6a21\u5f0f\u3002 \u4e91\u670d\u52a1\u5668\uff08\u901a\u8fc7\u672c\u673a\u4ee3\u7406\uff09\u8bbf\u95eemitm.it\u884c\u5f97\u901a\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5bf9\u5916\u66b4\u9732\u4e00\u4e2aapi\uff1a \u4e0b\u8f7d\u8bc1\u4e66 \u3002 \u8fd9\u4e2a\u8bc1\u4e66\u53ea\u8981\u4e0b\u8f7d\u5230\uff0c\u6211\u4eec\u5c31\u80fd\u987a\u5229\u5b89\u88c5\u5e76\u901a\u8fc7\u4ee3\u7406\u8bbf\u95ee\u5230\u5176\u4ed6\u9875\u9762\uff0c\u4e3a\u540e\u9762\u5f55\u5236\u505a\u94fa\u57ab\u4e86\u3002 ip\u95ee\u9898 \u8fd9\u4e2a\u662f\u56f0\u6270\u6211\u5f88\u4e45\u7684\u4e00\u4e2a\u95ee\u9898\uff0c\u5148\u6765\u770b\u7b2c\u4e00\u4e2a\u3002\u5148\u5047\u8bbe\u6211\u4eec\u7684\u771f\u5b9eip\u90fd\u662f111.111.111.111\uff0c\u6240\u4ee5\u6211\u4eec\u5bf9\u7167\u5f55\u5236\u72b6\u6001\u8fd9\u4e2a\u63a5\u53e3: \u8fd9\u4e00\u5757\u7684\u5185\u5bb9\uff0c\u6211\u4eec\u5e0c\u671b\u7684\u662f\u6839\u636e\u6211\u4eec\u7684\u771f\u5b9eip\u53bb\u83b7\u53d6redis\u91cc\u9762\u7684\u6570\u636e\uff0c\u4f46\u6700\u7ec8\u8d70\u5411\u4f1a\u662f\u4ec0\u4e48\u5462\uff1f \u524d\u7aef\u9875\u9762\u53d1\u8d77\u8bf7\u6c42 \u8bf7\u6c42\u5230\u8fbe\u670d\u52a1\u7aefnginx nginx\u8f6c\u53d1\u5230pity\u771f\u5b9e\u5730\u5740 \u4e5f\u5c31\u662f\u8bf4\uff0cpity\u6536\u5230\u7684\u8bf7\u6c42\uff0c\u5176\u5b9e\u662f\u7531nginx\u53d1\u7ed9\u5b83\u7684\uff0c\u90a3\u4ed6\u62ff\u5230\u7684\uff0c\u5176\u5b9e\u662fnginx\u7684ip\u5730\u5740\uff0c\u5373 nginx\u670d\u52a1\u5668\u5730\u5740 \u3002 \u8fd9\u5c31\u5f15\u53d1\u7b2c\u4e00\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u83b7\u53d6\u4e0d\u5230\u6211\u4eec\u7684 \u5f55\u5236\u6570\u636e \uff08\u6ce8\u610f\u672c\u5730\u5e76\u4e0d\u4f1a\u51fa\u73b0\u54e6\uff0c\u53ea\u6709\u751f\u4ea7\u4f1a\uff09\u3002 \u90a3\u4e48\u600e\u4e48\u89e3\u51b3\u5462\uff1f\u6211\u4eec\u7684nginx\u5728\u8f6c\u53d1\u7684\u65f6\u5019\uff0c\u8981\u5e26\u4e0a\u5bf9\u5e94\u7684\u914d\u7f6e: * \u6ce8\u610f\u8fd9\u4e2aclient_max_body_size\uff0c\u9ed8\u8ba4\u662f1m\uff0c\u8fd9\u91cc\u662fhar\u5bfc\u5165\u7684\u65f6\u5019\u62a5\u9519\u6211\u4fee\u6539\u7684\u3002 \u8fd93\u4e2a\u914d\u7f6e\u4ee3\u8868\uff0c\u628a\u539f\u59cb\u7684\u5ba2\u6237\u7aefip\u5565\u7684\u4e5f\u90fd\u7ee7\u7eed\u8f6c\u53d1\u8fc7\u53bb\u3002\u5982\u6b64\u6211\u4eec\u5c31\u89e3\u51b3\u4e86\u7b2c\u4e00\u4e2a\u95ee\u9898\u3002 \u7b2c\u4e8c\u4e2a\u95ee\u9898 \u7b2c\u4e8c\u4e2a\u95ee\u9898\u6bd4\u8f83\u7c97\u9c81\uff0c\u7531\u4e8e\u6211\u4eec\u5f55\u5236\u7684\u65f6\u5019\uff0c\u6211\u4eec\u5b9e\u9645\u4e0a\u662f\u8d70\u4e86 mitmproxy \u7684\u4ee3\u7406\uff0c\u4f46\u662f\u4ed6\u4e5f\u5f88\u574f\uff0c\u4e0d\u7ed9\u6211\u4eec\u771f\u5b9eip\uff0c\u53ea\u8981\u6211\u4eec\u7ecf\u8fc7\u4ed6\uff0c\u901a\u8fc7fastapi\u83b7\u53d6\u5230\u7684\uff0c\u90fd\u662fmitmproxy\u90e8\u7f72\u7684\u5730\u5740\u3002 \u7ecf\u8fc7\u6211\u4e0d\u65ad\u7684\u63a2\u7d22\uff0c\u7ec8\u4e8e\u627e\u5230\u4e86\u5bf9\u5e94\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u76f4\u63a5\u4e0a\u7b54\u6848\u3002 \u4fee\u6539uvicorn\u7684\u914d\u7f6e \u6211\u662f\u7528gunicorn\u7684\u65b9\u5f0f\uff0c\u6240\u4ee5\u6211\u5728gunicorn.py\u91cc\u9762\u4fee\u6539uvicorn\u7684\u914d\u7f6e: # \u542f\u52a8\u7684\u8fdb\u7a0b\u6570 workers = multiprocessing . cpu_count () worker_class = 'uvicorn.workers.UvicornWorker' forwarded_allow_ips = \"*\" x_forwarded_for_header = 'X-FORWARDED-FOR' forwarded_allow_ips\u8fd9\u4e2a\u53c2\u6570\u662f\u5141\u8bb8forward\u7684ip\uff0c\u6211\u7406\u89e3\u7684\u610f\u601d\u662f\uff0c\u4f60\u91cd\u5b9a\u5411/\u8f6c\u53d1\u4ee5\u540e\uff0c\u7ee7\u7eed\u8f93\u9001\u4f60\u65e7\u7684ip\u3002 \u5176\u5b9enginx\u7684\u914d\u7f6e\uff0c\u4e5f\u662f\u8fd9\u4e2a\u53c2\u6570\uff0c\u5bf9\u4e0d\uff0c\u5176\u5b9e\u5927\u5bb6\u547d\u540d\u90fd\u5f88\u63a5\u8fd1 \uff0c\u7f51\u7edc\u4e0a\u6709\u4e9b\u4eba\u4f1a\u8981\u6c42\u518d\u6539\u4e00\u4e2aheader\u5565\u7684\u914d\u7f6e\uff0c\u6211\u89c2\u5bdf\u4e86\u4e00\u4e0b\u90a3\u4e2a\u914d\u7f6e\u9ed8\u8ba4\u662f \u5f00 \u7684\uff0c\u6240\u4ee5\u4e0d\u9700\u8981\u4e86\u3002 \u6539\u5b8c\u8fd9\u4e2a\u4e4b\u540e\uff0c\u4f60\u7684mitmproxy\u5c31\u4f1a\u6536\u5230\u4f60\u771f\u5b9e\u5730\u5740\uff0c\u4f46\u662f\u8fd9\u6837\u662f \u4e0d\u591f \u7684\u3002\u6211\u4eec\u5982\u679c\u5f55\u5236\u6570\u636e\uff0c\u4f1a\u8d70\u4ee3\u7406\uff0c\u8fd9\u6837\u6211\u4eec\u7684ip\u4f1a\u88ab\u8bc6\u522b\u4e3amitmproxy\u6240\u5728ip\u3002 \u6240\u4ee5\u6211\u4eec\u9700\u8981\u7ee7\u7eed \u63d0\u5347 \uff08forward)\uff0c\u6211\u4eec\u9700\u8981\u5728mitmproxy\u5f55\u5236\u5230\u63a5\u53e3\u7684\u65f6\u5019 \u4e5f\u8bbe\u7f6eforward \u3002 \u5728\u63d2\u4ef6\u4e2d\uff0c\u628a\u771f\u5b9e\u7684ip\u5730\u5740forward\u5373\u53ef\u3002\u4e0b\u9762\u6765\u5c55\u793a\uff0c\u6211\u5728pity.fun\u8fd9\u4e2a\u5730\u5740\u91cc\u9762\u5f55\u5236\u56de\u653e\u7684\u6210\u679c\u3002","title":"\u9010\u4e2a\u51fb\u7834"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28143%29%20%E8%A7%A3%E5%86%B3%E4%BB%A3%E7%90%86%E7%9A%84%E9%9A%BE%E9%A2%98/#_4","text":"\u914d\u7f6e\u4ee3\u7406 \u5168\u7a0b\u4f7f\u7528pity.fun\u73af\u5883\u5f55\u5236 bug\u8b66\u949f\uff0c\u53ef\u4ee5\u770b\u5230\u6700\u540e \u5f55\u5236\u7ed3\u679c \u591a\u4e86\u4e00\u6761\u5f00\u59cb\u5f55\u5236\u7684\u6570\u636e\uff0c\u6211\u4eec\u4e0b\u671f\u89e3\u51b3\u5b83\u3002","title":"\u52b3\u52a8\u6210\u679c"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28144%29%20%E5%AE%8C%E6%88%90%E8%AF%81%E4%B9%A6%E4%B8%8B%E8%BD%BD%E5%8A%9F%E8%83%BD/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u68b3\u7406\u4e86\u4ee3\u7406\u7684\u96be\u9898\uff0c\u8fd9\u4e00\u8282\u5c31\u8ba9\u6211\u4eec\u6765\u89e3\u51b3 \u8bc1\u4e66\u4e0b\u8f7d \u95ee\u9898\u3002\u5176\u5b9e\u53ef\u80fd\u8fd9\u4e2a\u529f\u80fd\u4e0d\u662f\u5f88\u7d27\u6025\uff0c\u4f46\u8d77\u7801\u76ee\u524dpity\u8981\u60f3\u505a\u4e00\u4e2a\u5b8c\u6574\u7248\u7684\u6f14\u793a\u529f\u80fd\uff0c\u8fd9\u4e2a\u529f\u80fd\u662f\u5fc5\u4e0d\u53ef\u5c11\u7684\u3002 \u627e\u89c4\u5f8b \u6211\u4eec\u9700\u8981\u5148\u627e\u5230\u5404\u4e2a\u8bc1\u4e66\u7684\u4e0b\u8f7d\u5730\u5740\u89c4\u5f8b\uff0c\u4ece\u800c\u6839\u636e \u89c4\u5f8b \u62fc\u51d1\u51fa\u65b0\u7684url\u3002\u5148\u6302\u4e0a\u4ee3\u7406\uff0c\u7136\u540e\u770b\u770b\u5bf9\u5e94\u7684mitm.it\uff1a \u6ce8\u610f\u8fd9\u4e2a\u540e\u7f00\uff0c\u5206\u522b\u662fp12,pem\u548ccer\u3002\u63a5\u7740\u6211\u4eec\u6765\u770b\u770bF12\uff0c\u5bf9\u5e94\u7684\u94fe\u63a5: \u5176\u5b9e\u524d\u9762\u90fd\u662f\u56fa\u5b9a\u7684\uff0c\u4e5f\u5c31\u662f: http://mitm.it/cert/ \u6839\u636epem\uff0cp12\u7b49\u6240\u6709\u533a\u5206\uff0c\u6240\u4ee5\u6211\u4eec\u5199\u5b9a\u5bf9\u5e94\u7684\u89c4\u5f8b\u5373\u53ef\u3002\u8bdd\u4e0d\u591a\u8bf4\uff0c\u5f00\u59cb\u7f16\u7801: \u8bbe\u7f6e\u679a\u4e3e\u7c7b \u65b0\u5efaapp/enums/CertEnum.py\u6587\u4ef6 from enum import IntEnum class CertType ( IntEnum ): windows = 0 linux = 1 macos = 2 ios = 3 android = 4 def get_suffix ( self ): if self == CertType . windows : return \"p12\" if self in ( CertType . linux , CertType . macos , CertType . ios ): return \"pem\" if self == CertType . android : return \"cer\" raise Exception ( \"unsupported cert type\" ) \u9664\u4e86\u5b9a\u4e49windows\u8fd9\u4e9b\u679a\u4e3e\u503c\u4ee5\u5916\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u628a\u4ed6\u4eec\u548cpem/p12/cer\u5bf9\u5e94\u8d77\u6765\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u5199\u4e00\u4e2aget_url\u7684\u65b9\u6cd5\uff0c\u7ed9\u4ed6\u4eec\u81ea\u52a8 \u5f52\u7c7b \u3002 \u7f16\u5199\u4e0b\u8f7d\u8bc1\u4e66\u63a5\u53e3 \u4fee\u6539app/routers/request/http.py\uff0c\u6211\u4eec\u52a0\u5165\u4ee5\u4e0b\u4ee3\u7801\u3002 @router . get ( \"/cert\" ) async def http_request ( cert : CertType ): try : suffix = cert . get_suffix () client = AsyncRequest ( CERT_URL + suffix ) content = await client . download () shuffle = list ( range ( 0 , 9 )) random . shuffle ( shuffle ) filename = f \" { '' . join ( map ( lambda x : str ( x ), shuffle )) } mitmproxy. { suffix } \" with open ( filename , 'wb' ) as f : f . write ( content ) return PityResponse . file ( filename , f \"mitmproxy. { suffix } \" ) except Exception as e : return PityResponse . failed ( e ) \u9996\u5148\u6211\u4eec\u5148\u83b7\u53d6cert\u679a\u4e3e\uff0c\u7136\u540e\u83b7\u53d6\u5230\u5bf9\u5e94\u7684 \u540e\u7f00 \uff0c\u63a5\u7740\u6211\u4eec\u672c\u5730\u4e0b\u8f7d\u8fd9\u4e2a\u6587\u4ef6\uff0c\u968f\u673a\u751f\u6210\u6587\u4ef6\u540d\uff0c\u6700\u540e\u5199\u5165\u5e76\u8fd4\u56deresponse\u3002 \u6574\u4e2a\u8fc7\u7a0b\u5f88\u7b80\u5355\uff0c\u8fd9\u91cc\u5c31\u4e0d\u591a\u4ecb\u7ecd\u4e86\u3002\u4e0b\u9762\u6211\u4eec\u6765\u770b\u770b\u524d\u7aef\u90e8\u5206\u3002 \u7f16\u5199\u524d\u7aef \u524d\u7aef\u6211\u4eec\u9700\u8981\u52a0\u5165\u4e00\u4e2aDropdown(\u4e0b\u62c9\u83dc\u5355)\uff0c\u8fd9\u6837\u4e0b\u62c9\u80fd\u5c55\u793a\u6240\u6709 \u7c7b\u578b \u7684\u8bc1\u4e66\uff0c\u63a5\u7740\u6211\u4eec\u7f16\u5199menu: \u5176\u5b9e\u4e5f\u5c31\u662f5\u4e2a\u94fe\u63a5\uff0c\u70b9\u51fb\u5206\u522b\u8fdb\u51655\u4e2a\u4e0d\u540c\u7684url\u4e0b\u8f7d\u8bc1\u4e66\uff0c\u6211\u4eec\u6765\u770b\u770b\u6548\u679c: \u8bc1\u4e66\u6211\u4eec\u662f\u4e0b\u8f7d\u597d\u4e86\uff0c\u63a5\u7740\u6211\u4eec\u62ff\u5230mac\u8bd5\u8bd5\uff01~ \u6d4b\u8bd5mac \u8001\u89c4\u77e9\uff0c\u6211\u4eec\u5148\u4e0b\u8f7dmac\u7528\u7684\u8bc1\u4e66\uff0c\u63a5\u7740\u4fe1\u4efb\u4e4b\u3002 \u63a5\u7740\u6211\u4eec\u914d\u7f6e\u597dhttp/https\u7684\u4ee3\u7406\uff0c\u7136\u540e\u5f00\u542f\u5f55\u5236\u8fc7\u7a0b\u4e86~ \u8fd9\u91cc\u5176\u5b9e\u4e0d\u662f\u672c\u5730\u54c8\uff0c\u622a\u56fe\u6709\u70b9\u8bef\u5dee\uff0c\u6ca1\u6709\u663e\u793aurl\u3002 \u540e\u7eed\u6211\u53c8\u6d4b\u8bd5\u4e86 \u5b89\u5353 \uff0c(IOS\u5f88\u9057\u61be\u6ca1\u641e\u5b9a\uff0c\u6211\u592a\u83dc\u4e86\u3002\u3002\u3002\uff09\u9057\u61be\u7684\u662f\u90e8\u5206app\u5e76\u4e0d\u80fd\u88ab\u6293\u5230 \u8bf7\u6c42 \u3002 \u4e0a\u6b21\u6211\u4eec\u90a3\u4e2a\u5f55\u5236\u7684\u95ee\u9898\uff0c\u662f\u56e0\u4e3a\u6211\u4eec\u7684 url \u91cc\u9762\u5e26\u6709regex\u4e5f\u5c31\u662f\u5177\u4f53\u7684\u6b63\u5219: start?regex=api.juejin.cn \u6240\u4ee5\u4e5f\u88ab\u8bef\u4f24\u4e86\uff0c\u5f55\u5236\u4e86\u4e0b\u6765\uff0c\u867d\u7136\u633a\u4e0d\u5e94\u8be5\u7684\u3002\u4e0d\u8fc7\u6211\u4eec\u52a0\u4e00\u4e2a\uff0c\u4e0d\u5f55\u5236\u5305\u542bpity.fun\u7684url\u5373\u53ef\u3002 \u8fd9\u6837\u57fa\u672c\u4e0a\u5c31\u80fd\u89e3\u51b3\u5f55\u5236\u7684\u4e00\u5927\u90e8\u5206\u95ee\u9898\u4e86\uff0c\u8fd8\u6709\u4e2a \u591a\u8bbe\u5907 \u5f55\u5236\u7684\u95ee\u9898\uff0c\u6211\u4eec\u6682\u65f6\u5148\u4e0d\u89e3\u51b3\uff0c\u56e0\u4e3a\u771f\u7684\u6709\u70b9\u9ebb\u70e6\u4e86\u3002 \u5927\u5bb6\u6709\u5174\u8da3\u7684\u53ef\u4ee5\u8fdb\u5165pity.fun\u4e0b\u8f7d\u8bc1\u4e66\uff0c\u5b89\u88c5\u540e\u5f00\u542fpity.fun,\u7aef\u53e37778\u7684\u4ee3\u7406\uff0c\u5c1d\u8bd5\u5f55\u5236\u7528\u4f8b\u5566~","title":"144.\u5b8c\u6210\u8bc1\u4e66\u4e0b\u8f7d\u529f\u80fd"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28144%29%20%E5%AE%8C%E6%88%90%E8%AF%81%E4%B9%A6%E4%B8%8B%E8%BD%BD%E5%8A%9F%E8%83%BD/#_1","text":"\u4e0a\u4e00\u8282\u6211\u4eec\u68b3\u7406\u4e86\u4ee3\u7406\u7684\u96be\u9898\uff0c\u8fd9\u4e00\u8282\u5c31\u8ba9\u6211\u4eec\u6765\u89e3\u51b3 \u8bc1\u4e66\u4e0b\u8f7d \u95ee\u9898\u3002\u5176\u5b9e\u53ef\u80fd\u8fd9\u4e2a\u529f\u80fd\u4e0d\u662f\u5f88\u7d27\u6025\uff0c\u4f46\u8d77\u7801\u76ee\u524dpity\u8981\u60f3\u505a\u4e00\u4e2a\u5b8c\u6574\u7248\u7684\u6f14\u793a\u529f\u80fd\uff0c\u8fd9\u4e2a\u529f\u80fd\u662f\u5fc5\u4e0d\u53ef\u5c11\u7684\u3002","title":"\u56de\u987e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28144%29%20%E5%AE%8C%E6%88%90%E8%AF%81%E4%B9%A6%E4%B8%8B%E8%BD%BD%E5%8A%9F%E8%83%BD/#_2","text":"\u6211\u4eec\u9700\u8981\u5148\u627e\u5230\u5404\u4e2a\u8bc1\u4e66\u7684\u4e0b\u8f7d\u5730\u5740\u89c4\u5f8b\uff0c\u4ece\u800c\u6839\u636e \u89c4\u5f8b \u62fc\u51d1\u51fa\u65b0\u7684url\u3002\u5148\u6302\u4e0a\u4ee3\u7406\uff0c\u7136\u540e\u770b\u770b\u5bf9\u5e94\u7684mitm.it\uff1a \u6ce8\u610f\u8fd9\u4e2a\u540e\u7f00\uff0c\u5206\u522b\u662fp12,pem\u548ccer\u3002\u63a5\u7740\u6211\u4eec\u6765\u770b\u770bF12\uff0c\u5bf9\u5e94\u7684\u94fe\u63a5: \u5176\u5b9e\u524d\u9762\u90fd\u662f\u56fa\u5b9a\u7684\uff0c\u4e5f\u5c31\u662f: http://mitm.it/cert/ \u6839\u636epem\uff0cp12\u7b49\u6240\u6709\u533a\u5206\uff0c\u6240\u4ee5\u6211\u4eec\u5199\u5b9a\u5bf9\u5e94\u7684\u89c4\u5f8b\u5373\u53ef\u3002\u8bdd\u4e0d\u591a\u8bf4\uff0c\u5f00\u59cb\u7f16\u7801:","title":"\u627e\u89c4\u5f8b"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28144%29%20%E5%AE%8C%E6%88%90%E8%AF%81%E4%B9%A6%E4%B8%8B%E8%BD%BD%E5%8A%9F%E8%83%BD/#_3","text":"\u65b0\u5efaapp/enums/CertEnum.py\u6587\u4ef6 from enum import IntEnum class CertType ( IntEnum ): windows = 0 linux = 1 macos = 2 ios = 3 android = 4 def get_suffix ( self ): if self == CertType . windows : return \"p12\" if self in ( CertType . linux , CertType . macos , CertType . ios ): return \"pem\" if self == CertType . android : return \"cer\" raise Exception ( \"unsupported cert type\" ) \u9664\u4e86\u5b9a\u4e49windows\u8fd9\u4e9b\u679a\u4e3e\u503c\u4ee5\u5916\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u628a\u4ed6\u4eec\u548cpem/p12/cer\u5bf9\u5e94\u8d77\u6765\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u5199\u4e00\u4e2aget_url\u7684\u65b9\u6cd5\uff0c\u7ed9\u4ed6\u4eec\u81ea\u52a8 \u5f52\u7c7b \u3002","title":"\u8bbe\u7f6e\u679a\u4e3e\u7c7b"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28144%29%20%E5%AE%8C%E6%88%90%E8%AF%81%E4%B9%A6%E4%B8%8B%E8%BD%BD%E5%8A%9F%E8%83%BD/#_4","text":"\u4fee\u6539app/routers/request/http.py\uff0c\u6211\u4eec\u52a0\u5165\u4ee5\u4e0b\u4ee3\u7801\u3002 @router . get ( \"/cert\" ) async def http_request ( cert : CertType ): try : suffix = cert . get_suffix () client = AsyncRequest ( CERT_URL + suffix ) content = await client . download () shuffle = list ( range ( 0 , 9 )) random . shuffle ( shuffle ) filename = f \" { '' . join ( map ( lambda x : str ( x ), shuffle )) } mitmproxy. { suffix } \" with open ( filename , 'wb' ) as f : f . write ( content ) return PityResponse . file ( filename , f \"mitmproxy. { suffix } \" ) except Exception as e : return PityResponse . failed ( e ) \u9996\u5148\u6211\u4eec\u5148\u83b7\u53d6cert\u679a\u4e3e\uff0c\u7136\u540e\u83b7\u53d6\u5230\u5bf9\u5e94\u7684 \u540e\u7f00 \uff0c\u63a5\u7740\u6211\u4eec\u672c\u5730\u4e0b\u8f7d\u8fd9\u4e2a\u6587\u4ef6\uff0c\u968f\u673a\u751f\u6210\u6587\u4ef6\u540d\uff0c\u6700\u540e\u5199\u5165\u5e76\u8fd4\u56deresponse\u3002 \u6574\u4e2a\u8fc7\u7a0b\u5f88\u7b80\u5355\uff0c\u8fd9\u91cc\u5c31\u4e0d\u591a\u4ecb\u7ecd\u4e86\u3002\u4e0b\u9762\u6211\u4eec\u6765\u770b\u770b\u524d\u7aef\u90e8\u5206\u3002","title":"\u7f16\u5199\u4e0b\u8f7d\u8bc1\u4e66\u63a5\u53e3"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28144%29%20%E5%AE%8C%E6%88%90%E8%AF%81%E4%B9%A6%E4%B8%8B%E8%BD%BD%E5%8A%9F%E8%83%BD/#_5","text":"\u524d\u7aef\u6211\u4eec\u9700\u8981\u52a0\u5165\u4e00\u4e2aDropdown(\u4e0b\u62c9\u83dc\u5355)\uff0c\u8fd9\u6837\u4e0b\u62c9\u80fd\u5c55\u793a\u6240\u6709 \u7c7b\u578b \u7684\u8bc1\u4e66\uff0c\u63a5\u7740\u6211\u4eec\u7f16\u5199menu: \u5176\u5b9e\u4e5f\u5c31\u662f5\u4e2a\u94fe\u63a5\uff0c\u70b9\u51fb\u5206\u522b\u8fdb\u51655\u4e2a\u4e0d\u540c\u7684url\u4e0b\u8f7d\u8bc1\u4e66\uff0c\u6211\u4eec\u6765\u770b\u770b\u6548\u679c: \u8bc1\u4e66\u6211\u4eec\u662f\u4e0b\u8f7d\u597d\u4e86\uff0c\u63a5\u7740\u6211\u4eec\u62ff\u5230mac\u8bd5\u8bd5\uff01~","title":"\u7f16\u5199\u524d\u7aef"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%28144%29%20%E5%AE%8C%E6%88%90%E8%AF%81%E4%B9%A6%E4%B8%8B%E8%BD%BD%E5%8A%9F%E8%83%BD/#mac","text":"\u8001\u89c4\u77e9\uff0c\u6211\u4eec\u5148\u4e0b\u8f7dmac\u7528\u7684\u8bc1\u4e66\uff0c\u63a5\u7740\u4fe1\u4efb\u4e4b\u3002 \u63a5\u7740\u6211\u4eec\u914d\u7f6e\u597dhttp/https\u7684\u4ee3\u7406\uff0c\u7136\u540e\u5f00\u542f\u5f55\u5236\u8fc7\u7a0b\u4e86~ \u8fd9\u91cc\u5176\u5b9e\u4e0d\u662f\u672c\u5730\u54c8\uff0c\u622a\u56fe\u6709\u70b9\u8bef\u5dee\uff0c\u6ca1\u6709\u663e\u793aurl\u3002 \u540e\u7eed\u6211\u53c8\u6d4b\u8bd5\u4e86 \u5b89\u5353 \uff0c(IOS\u5f88\u9057\u61be\u6ca1\u641e\u5b9a\uff0c\u6211\u592a\u83dc\u4e86\u3002\u3002\u3002\uff09\u9057\u61be\u7684\u662f\u90e8\u5206app\u5e76\u4e0d\u80fd\u88ab\u6293\u5230 \u8bf7\u6c42 \u3002 \u4e0a\u6b21\u6211\u4eec\u90a3\u4e2a\u5f55\u5236\u7684\u95ee\u9898\uff0c\u662f\u56e0\u4e3a\u6211\u4eec\u7684 url \u91cc\u9762\u5e26\u6709regex\u4e5f\u5c31\u662f\u5177\u4f53\u7684\u6b63\u5219: start?regex=api.juejin.cn \u6240\u4ee5\u4e5f\u88ab\u8bef\u4f24\u4e86\uff0c\u5f55\u5236\u4e86\u4e0b\u6765\uff0c\u867d\u7136\u633a\u4e0d\u5e94\u8be5\u7684\u3002\u4e0d\u8fc7\u6211\u4eec\u52a0\u4e00\u4e2a\uff0c\u4e0d\u5f55\u5236\u5305\u542bpity.fun\u7684url\u5373\u53ef\u3002 \u8fd9\u6837\u57fa\u672c\u4e0a\u5c31\u80fd\u89e3\u51b3\u5f55\u5236\u7684\u4e00\u5927\u90e8\u5206\u95ee\u9898\u4e86\uff0c\u8fd8\u6709\u4e2a \u591a\u8bbe\u5907 \u5f55\u5236\u7684\u95ee\u9898\uff0c\u6211\u4eec\u6682\u65f6\u5148\u4e0d\u89e3\u51b3\uff0c\u56e0\u4e3a\u771f\u7684\u6709\u70b9\u9ebb\u70e6\u4e86\u3002 \u5927\u5bb6\u6709\u5174\u8da3\u7684\u53ef\u4ee5\u8fdb\u5165pity.fun\u4e0b\u8f7d\u8bc1\u4e66\uff0c\u5b89\u88c5\u540e\u5f00\u542fpity.fun,\u7aef\u53e37778\u7684\u4ee3\u7406\uff0c\u5c1d\u8bd5\u5f55\u5236\u7528\u4f8b\u5566~","title":"\u6d4b\u8bd5mac"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2815%29%20%E7%BC%96%E5%86%99%E7%B1%BBpostman%E9%A1%B5%E9%9D%A2%284%29/","text":"\u7f16\u5199\u7c7bpostman\u9875\u9762(4) \u56de\u987e \u5728\u4e0a\u4e00\u8282\u6211\u4eec\u7ec8\u4e8e\u641e\u5b9a\u4e86 Params \u8fd9\u4e2a\u96be\u5543\u7684\u9aa8\u5934\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u8981\u7f16\u5199headers\uff0c\u4e0e\u4e4b\u7c7b\u4f3c\u7684\u7ec4\u4ef6\uff0c\u4e00\u8d77\u6765\u8bd5\u8bd5\u5427~ \u601d\u8003 \u601d\u8003\u4e00\u4e0b\uff0c headers \u548c params \u90fd\u662f\u952e\u503c\u5bf9\u7684\u5f62\u5f0f\uff0c\u4f3c\u4e4e\u4e0d\u9700\u8981\u592a\u5927\u7684\u6539\u52a8\uff0c\u54b1\u4eec\u6709\u73b0\u6210\u7684\u53ef\u7f16\u8f91\u8868\u683c\uff0c\u6240\u4ee5\u505a\u8d77\u6765\u4f1a\u5f88\u65b9\u4fbf\u3002 \u7f16\u5199Header\u6a21\u5757 \u5176\u5b9e\u7167\u7406\u8bf4\u8fd9\u79cd\u6a21\u5757\u6bd4\u5982params\u8fd8\u6709headers\u90fd\u53ef\u4ee5\u62bd\u51fa\u4e3a\u5355\u72ec\u7684\u7ec4\u4ef6\uff0c\u4e0d\u8fc7\u8fd9\u91cc\u6211\u89c9\u5f97\u4f3c\u4e4e\u590d\u7528\u7684\u5730\u65b9\u6bd4\u8f83\u5c11\uff0c\u6240\u4ee5\u8fd9\u4e2a\u770b\u4eba\uff0c\u5176\u5b9e\u4e5f\u662f\u53ef\u4ee5\u62bd\u51fa\u6765\u7684\uff0c\u6bd5\u7adf\u4e00\u4e2a\u7ec4\u4ef6\u5982\u679c\u592a\u5927\u4e86\u80af\u5b9a\u4f1a\u51fa\u73b0\u5f88\u591a\u8026\u5408\u95ee\u9898\u3002 \u89c2\u5bdfpostman\u7684headers\u6784\u9020 \u53ef\u4ee5\u770b\u5230postman\u7684\u529f\u80fd\u975e\u5e38\u591a\uff0cheaders\u53ef\u4ee5\u9690\u85cf\uff0c\u4e5f\u7ed9\u4e86\u9ed8\u8ba4\u7684headers\uff0c\u8fd9\u8fb9\u6211\u4eec\u5c31 \u7b80\u5355\u70b9 \uff0c\u8bf4\u8bdd\u7684\u65b9\u5f0f\u7b80\u5355\u70b9\u3002\u53ea\u4fdd\u7559\u6838\u5fc3\u8868\u683c\u5c31\u884c\u4e86\uff01 \u65b0\u589e\u53d8\u91cf\u5b58\u653eheaders\u4fe1\u606f\u4ee5\u53ca\u6b63\u5728\u7f16\u8f91\u7684key\u4fe1\u606f \u5b57\u6bb5\u65b9\u9762\u6211\u4eec\u53ef\u4ee5\u590d\u7528\u4e00\u90e8\u5206 \u4f46\u662f\u9700\u8981\u7a0d\u7a0d\u6539\u52a8\uff0c\u56e0\u4e3a\u5728\u5220\u9664\u7684\u65f6\u5019\uff0c params \u9664\u4e86\u8981\u66f4\u65b0\u8868\u683c\u4ee5\u5916\uff0c\u8fd8\u9700\u8981 \u4fee\u6539url \u3002 \u601d\u8def\u662f\u628acolumns\u53d8\u6210\u4e00\u4e2a\u7eaf\u51fd\u6570\uff0c\u53c2\u6570\u4e3aparams\u7684\u65f6\u5019\u8fd4\u56deparams\u7684\u5185\u5bb9\uff0c\u4e3aheaders\u65f6\u8fd4\u56deheaders\u7684\u5185\u5bb9\uff0c\u5176\u4ed6\u7684\u6ca1\u6709\u53d8\u5316\u3002 \u6539\u52a8onDelete\u65b9\u6cd5 \u4e0a\u4e00\u6b65\u6539\u52a8\u5c31\u662f\u4e3a\u4e86onDelete\u80fd\u591f\u5bf9\u4e0d\u540c\u7684\u7c7b\u578b\u505a\u51fa\u4e0d\u540c\u7684\u5220\u9664\u64cd\u4f5c\uff0c\u5982\u679c\u4e0d\u662fparams\u5219\u4e0d\u4fee\u6539url\u4e86\u3002 \u6700\u540e\u662f\u518d\u5f15\u5165\u4e00\u4e2a\u53ef\u7f16\u8f91\u8868\u683c title\u662fheaders\uff0c\u6ca1\u6709extra\uff0c\u6570\u636e\u662fheaders\u548csetHeaders\u7b49\u3002 \u8c03\u6574\u4e00\u4e0bEditableTable\u7ec4\u4ef6 \u8fd9\u91cc\u52a0\u4e86\u4e00\u4e2a\u5224\u65ad\uff0c\u56e0\u4e3a\u4e0d\u4f20\u5165\u8fd9\u4e2a\u5b57\u6bb5\u4f1a\u5bfc\u81f4\u9875\u9762\u5d29\u6e83 \u770b\u770b\u6548\u679c \u53ef\u4ee5\u770b\u5230\u6570\u636e\u4e92\u4e0d\u5f71\u54cd \u7f16\u5199Body(\u91cd\u5934\u620f\u6765\u4e86) \u9996\u5148\u9700\u8981\u4e86\u89e3\u4e00\u4e0b\uff0c\u54b1\u4eec\u7684body\u91cc\u9762\u5176\u5b9e\u662f\u4ee3\u7801\u7f16\u8f91\u5668\uff0c\u6211\u4eec\u53ef\u4ee5\u91c7\u7528\u5f00\u6e90\u7684 monaco react\u7248\u672c \uff0c\u9700\u8981\u4e86\u89e3\u8be6\u60c5\u7684\u8bdd\u53ef\u4ee5\u53bb\u5b83\u7684\u5b98\u7f51\u770b\u3002 \u6ce8\u610f : \u6211\u4eec\u6682\u65f6\u53ea\u652f\u6301JSON\u7c7b\u578b\u7684\u8bf7\u6c42\u4f53\uff0c\u540e\u9762\u4f1a\u589e\u52a0form\u548cfile\u7b49\u7b49\uff0c\u56e0\u4e3a\u6211\u5df2\u7ecf\u5b9e\u5728\u8981\u770b\u5230\u6210\u679c\u4e86\u3002\u3002\u3002 \u5b89\u88c5@monaco-editor/react npm install @monaco-editor/react --save \u7f16\u5199\u7f16\u8f91\u5668\u7ec4\u4ef6 src/components/Postman/CodeEditor.jsx \u8fd9\u91cc\u5f88\u7b80\u5355\u54c8\uff0c\u57fa\u672c\u4e0a\u662f\u628a\u5b98\u7f51\u7684\u4f8b\u5b50\u62ff\u6765\u6284\u4e86\u4e00\u4e0b \u5bf9\u4e8e\u90a3\u79cd\u53ef\u4f20\u53ef\u4e0d\u4f20\u7684\u53d8\u91cf\uff0c\u5c31\u7ed9\u4e00\u4e2a\u9ed8\u8ba4\u503c\uff0c\u6bd4\u5982 height \u548c theme \uff0c\u56e0\u4e3a\u5b83\u652f\u6301\u9ed1\u8272\u4e3b\u9898\u54e6\u3002 \u5f15\u5165\u7ec4\u4ef6 \u5224\u65adbodyType\u662f\u4e0d\u662fraw\uff0c\u5982\u679c\u662fraw\u624d\u663e\u793a\u6b64\u7ec4\u4ef6\uff0c\u5426\u5219\u663e\u793anull\u3002\u4e09\u5143\u8868\u8fbe\u5f0f\u5927\u5bb6\u5e94\u8be5\u90fd\u6e05\u695a\u3002 \u7136\u540e\u5305\u88c5\u4e86\u4e00\u5c42\u5361\u7247\uff0c\u56e0\u4e3a\u539f\u5148\u7684\u4e0d\u5e26\u6709\u8fb9\u6846\uff0c\u6240\u4ee5\u6211\u8fd9\u91cc\u7528Card\u7ec4\u4ef6\u5305\u88c5\u4e86\u4e00\u5c42\uff0c\u7136\u540e\u7ed9\u8fb9\u8ddd\u8bbe\u7f6e\u4e3a0\u3002 \u770b\u770b\u6548\u679c \u53ef\u4ee5\u770b\u5230\u8fd8\u6709\u5177\u4f53\u7684\u9519\u8bef\u63d0\u793a \u603b\u4f53\u8fd8\u662f\u4e0d\u9519\u7684\u5427\uff1f\u81f3\u6b64\uff0c\u6211\u4eec\u4e00\u671f\u7684\u529f\u80fd\u57fa\u672c\u4e0a\u5c31\u5feb\u8981\u641e\u597d\u4e86\uff0c\u8fd8\u5dee\u4e00\u4e2a\u76f8\u5e94\u4fe1\u606f\u680f\u3002\u540e\u9762\u7684\u4e1a\u4e3b\u522b\u6025\uff0c\u6162\u6162\u6765\u3002 \u6765\u4e2a\u52a8\u56fe\u611f\u53d7\u4e0b\u5427 \u8054\u8c03\u63a5\u53e3 \u7f16\u5199\u8bf7\u6c42\u65b9\u6cd5 \u548c\u4ee5\u524d\u4e00\u6837\uff0c\u76f4\u63a5\u63a5\u53d7\u53c2\u6570\u5e76\u8bf7\u6c42\u5373\u53ef import request from '@/utils/request' ; import { CONFIG } from '@/consts/config' ; export async function request ( params ) { return request( ` ${CONFIG.URL} /request/http` , { method : 'POST' , data : params, }); } \u7f16\u5199\u7ec4\u88c5headers\u7684\u65b9\u6cd5 \u56e0\u4e3aheaders\u662f\u4e00\u4e2amap\uff0c\u6240\u4ee5\u54b1\u4eec\u9700\u8981\u628a\u5b83\u4ece\u6570\u7ec4\u53d8\u4e3amap\u3002 \u521b\u5efa\u4e00\u4e9b\u72b6\u6001 loading \u7528\u6765\u5728\u8bf7\u6c42\u7684\u65f6\u5019\u663e\u793a\u4e00\u4e2aloading\u7684\u72b6\u6001 method \u5c06\u8bf7\u6c42\u65b9\u5f0f\u7684select\u7ec4\u4ef6\u6539\u6210\u4e86\u53d7\u63a7\u7ec4\u4ef6\uff0c\u56e0\u4e3a\u6211\u4eec\u9700\u8981\u62ff\u5230\u5b83\u7684\u503c\u3002 response \u540e\u7eed\u6211\u4eec\u4f1a\u9700\u8981\u663e\u793a\u51fa\u5177\u4f53\u7684\u7ed3\u679c\u3002 \u7f16\u5199\u7ec4\u88c5\u8bf7\u6c42\u6570\u636e\u7684\u65b9\u6cd5 onRequest \u8fd9\u4e2a\u65b9\u6cd5\u662f\u70b9\u51fb\u5230 Send \u6309\u94ae\u540e\u6267\u884c\u7684\u65b9\u6cd5\uff0c\u53ef\u4ee5\u770b\u5230\u9996\u5148\u8ba9Send\u6309\u94ae\u5904\u4e8e\u52a0\u8f7d\u4e2d\uff0c\u9632\u6b62\u91cd\u590d\u70b9\u51fb\u3002\u7136\u540e\u5224\u65ad\u53c2\u6570\u662f\u5426\u5408\u7406\uff0c\u4e0d\u5408\u7406\u76f4\u63a5\u5f39\u51fa\u63d0\u793a(\u5f85\u4f1a\u4f1a\u6709\u52a8\u56fe\u6f14\u793a) \u6700\u540e\u5c31\u662f\u6539\u56de\u539f\u6765\u7684\u72b6\u6001\u5e76\u8bbe\u7f6e\u8fd4\u56de\u7ed3\u679c\u4e86\u3002 \u540e\u7aef\u8c03\u6574 \u7531\u4e8e\u5728\u6211\u8bd5\u7528\u7684\u8fc7\u7a0b\u4e2d\u53d1\u73b0\uff0c\u540e\u7aef\u9047\u5230\u4e86\u51e0\u4e2a\u7684\u95ee\u9898\u3002 \u5982\u679cresponse\u662f\u6587\u672c\u6216\u8005\u975eJSON\uff0c\u90a3\u4e48\u7a0b\u5e8f\u4f1a\u76f4\u63a5\u62a5\u9519 \u5982\u679cheaders\u6ca1\u6709\u4f20\u5165\uff0c\u90a3\u4e48\u7a0b\u5e8f\u4e5f\u4f1a\u62a5\u9519 \u89e3\u51b3\u529e\u6cd5\u5982\u56fe\uff0c\u5982\u679c\u80fd\u8f6c\u4e3aJSON\uff0c\u5c31\u76f4\u63a5\u8f6c\u4e3aJSON\uff0c\u5426\u5219\u8fd4\u56detext\u3002 \u5982\u679c\u6ca1\u6709headers\u5219\u76f4\u63a5\u8fd4\u56de{}\u800c\u4e0d\u53bb\u904d\u5386headers\u4e86\u3002 ps: response_header\u4e5f\u9700\u8981\u5224\u65ad\uff0c\u89c1\u5b8c\u6574\u4ee3\u7801\u3002 \u5b8c\u6574\u4ee3\u7801: import datetime import requests class Request (object) : def __init__ (self, url, session=False, **kwargs) : self.url = url self.session = session self.kwargs = kwargs if self.session: self.client = requests.session() return self.client = requests def get (self) : return self.request( \"GET\" ) @staticmethod def get_elapsed (timer: datetime.timedelta) : if timer.seconds > 0 : return f\" {timer.seconds} . {timer.microseconds // 1000 } s\" return f\" {timer.microseconds // 100 } ms\" def request (self, method: str) : status_code = 0 elapsed = \"-1ms\" try : if method.upper() == \"GET\" : response = self.client.get(self.url, **self.kwargs) elif method.upper() == 'POST' : response = self.client.post(self.url, **self.kwargs) else : response = self.client.request(method, self.url, **self.kwargs) status_code = response.status_code if status_code != 200 : return Request.response( False , status_code) elapsed = Request.get_elapsed(response.elapsed) data = self.get_response(response) return Request.response( True , 200 , data, response.headers, response.request.headers, elapsed=elapsed) except Exception as e: return Request.response( False , status_code, msg=str(e), elapsed=elapsed) def post (self) : return self.request( \"POST\" ) def get_response (self, response) : try : return response.json() except : return response.text @staticmethod def response (status, status_code= 200 , response=None, response_header=None, request_header=None, elapsed=None, msg= \"success\" ) : request_header = {k: v for k, v in request_header.items()} if request_header is not None else {} response_header = {k: v for k, v in response_header.items()} if response_header is not None else {} return { \"status\" : status, \"response\" : response, \"status_code\" : status_code, \"response_header\" : response_header, \"request_header\" : request_header, \"msg\" : msg, \"elapsed\" : elapsed, } \u7b80\u5355\u8f93\u51fa\u4e00\u4e0b\u8fd4\u56de\u7ed3\u679c \u611f\u89c9\u7bc7\u5e45\u5df2\u7ecf\u5f88\u957f\u4e86\uff0c\u6587\u5b57\u7684\u65b9\u5f0f\u592a\u6162\u4e86\uff0c\ud83e\udd14\u8981\u4e0d\u8981\u51fa\u4e2a\u89c6\u9891\u5440\uff1f\u4e0d\u7136\u7684\u8bdd\u6211\u611f\u89c9\u6253\u5b57\u597d\u7d2f\uff0c\u6548\u679c\u8fd8\u4e00\u822c\u3002 \u76f4\u63a5\u6765\u770b\u4e00\u4e2a\u5b8c\u6574\u7684\u4f8b\u5b50\uff0c\u6d4b\u81ea\u5df1\u7684\u63a5\u53e3: \u5e7f\u544a\u65f6\u95f4 \u9884\u89c8\u5730\u5740: http://47.112.32.195/ \u540e\u7aef\u4ee3\u7801\u5730\u5740: https://github.com/wuranxu/pity \u524d\u7aef\u4ee3\u7801\u5730\u5740: https://github.com/wuranxu/pityWeb \u6b22\u8fce\u5173\u6ce8\u516c\u4f17\u53f7 \u6d4b\u8bd5\u5f00\u53d1\u5165\u5751 \uff0c\u8fd8\u6709\u52a0\u7fa4\u4e00\u8d77\u8ba8\u8bba\u76f8\u5173\u95ee\u9898\u5440\uff01\u5982\u679c\u7fa4\u4e8c\u7ef4\u7801\u8fc7\u671f\u4e86\uff0c\u53ef\u4ee5\u52a0\u6211\u4e2a\u4eba\u5fae\u4fe1: wuranxu \u6211\u62c9\u4f60\u8fdb\u7fa4~","title":"15.\u7f16\u5199\u7c7bpostman\u9875\u9762(4)"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2816%29%20%E7%BC%96%E5%86%99%E7%B1%BBpostman%E9%A1%B5%E9%9D%A2%285%29/","text":"\u7f16\u5199\u7c7bpostman\u9875\u9762(5) \u56de\u987e \u4e0a\u8282\u6211\u4eec\u628a\u6d41\u7a0b\u4e32\u8d77\u6765\u4e86\uff0c\u4f46\u662f\u8fd8\u6ca1\u6765\u5f97\u53ca\u7f16\u5199\u8fd4\u56de\u9875\u9762\u3002\u90a3\u4e48\u6211\u4eec\u4eca\u5929\u5c31\u628a\u8fd4\u56de\u7ed3\u679c\u5c55\u793a\u51fa\u6765\u3002 \u601d\u8003 \u8fd9\u8fb9\u8865\u5145\u4e00\u4e0b\uff0c\u521a\u624d\u6211\u5c1d\u8bd5\u5728\u81ea\u5df1\u7684\u4e91\u670d\u52a1\u5668\u90e8\u7f72pity\u9879\u76ee\uff0c\u4f46\u662f\u53d1\u73b0\u81ea\u5df1\u7ed9\u81ea\u5df1\u6316\u4e86\u4e2a\u5751\u3002 pity\u9879\u76ee\u6ca1\u6709\u914d\u7f6e requirements.txt \uff0c\u5bfc\u81f4\u8bb8\u591a\u8f6f\u4ef6\u7248\u672c\u6ca1\u6709\u5b89\u88c5\uff0c\u670d\u52a1\u8dd1\u4e0d\u8d77\u6765\uff1b \u63a5\u7740\u6211\u4eec\u5c31\u628a\u9700\u8981\u5b89\u88c5\u7684\u8865\u5168\u4e00\u4e0b\uff01 \u65b0\u5efapity/requirements.txt\u6587\u4ef6 flask-cors logbook pyjwt==1.7.1 mysql-connector-python flask-sqlalchemy flask requests \u5b89\u88c5\u5b8c\u6574\u7248\u672c: pip3 install -r requirements.txt \u7f16\u5199\u8fd4\u56de\u7ed3\u679c\u9875\u9762 \u6211\u4eec\u53d1\u73b0\uff0c\u5728\u8bf7\u6c42body\u4e3a none \u7684\u60c5\u51b5\u4e0b\uff0c\u8fd9\u4e2abody\u4f1a\u538b\u7f29\u5230tab\u9875\u4e0a\uff0c\u5982\u679c\u54b1\u4eec\u8981\u5c55\u793aresponse\u7684\u8bdd\uff0c response \u4e5f\u4f1a\u88ab\u6324\u4e0a\u53bb\uff0c\u8fd9\u6837\u5c31\u975e\u5e38\u96be\u770b\uff0c\u6240\u4ee5\u6211\u4eec\u8fdb\u884c\u4e00\u4e0b\u6539\u9020: \u6211\u4eec\u628abodyType === 'raw'\u6539\u6210'none'\uff0c\u56e0\u4e3a\u6211\u4eec\u8fd9\u8fb9\u6682\u65f6\u53ea\u652f\u6301JSON\u5f62\u5f0f\u7684\u6570\u636e\uff0c\u6240\u4ee5\u6682\u65f6\u53ef\u4ee5\u8fd9\u4e48\u5199\uff0c\u9488\u5bf9none\u7684\u65f6\u5019\u989d\u5916\u5199\u4e00\u4e2adiv\u7ec4\u4ef6\uff0c\u5e76\u7ed9\u5b83\u8bbe\u7f6e\u597d\u9ad8\u5ea6\u548c\u6587\u672c\u5c45\u4e2d\uff0c\u8fd9\u6837\u5c31\u6709\u5185\u5473\u4e86\uff01 \u8fd9\u662f\u6211\u5728mac\u4e0a\u7684\u663e\u793a\u6548\u679c(\u4eca\u5929\u5728\u516c\u53f8\u6478\u9c7c\u5199\u6587\u7ae0) \u7f16\u5199Tabs \u4e0a\u56fe\u5df2\u7ecf\u5feb\u770b\u5230\u5b9e\u9645\u6548\u679c\u4e86\uff0c\u6700\u7ec8\u4ee3\u7801\u8fd8\u5f97\u6da6\u8272\u4e00\u4e0b\u3002 \u6539\u5199\u7f16\u8f91\u5668\u65b9\u6cd5 \u76ee\u524d\u6211\u4eec\u7684\u7f16\u8f91\u5668\uff0c\u521d\u59cb\u503c\u5b57\u6bb5\u662f defaultValue \uff0c\u8fd9\u6837\u7684\u8bdd\u4e00\u65e6\u5237\u65b0\u4e86\u8fd4\u56de\u7ed3\u679c\uff0c\u90a3\u4e48\u8fd9\u4e2a\u503c\u4e0d\u4f1a\u518d\u6b21\u66f4\u65b0\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u6539\u5199\uff0c\u5177\u4f53\u7684\u65b9\u6cd5\u5c31\u662f\u8ba9Editor\u53d8\u6210 \u53d7\u63a7\u7ec4\u4ef6 \u3002 \u53bb\u6389defaultValue\u5b57\u6bb5\uff0c\u6539\u4e3avalue \u7f16\u5199Body tab\u4e0b\u7684\u7f16\u8f91\u5668 \u7b80\u5355\u5c01\u88c5\u5e76\u5f15\u7528\u4e86\u4e00\u4e0b\uff0cJSON.stringify\u8fd9\u4e2a\u65b9\u6cd5\u662f\u7528\u6765\u5e8f\u5217\u5316JSON\u7684\uff0c\u540e\u9762\u7684\u53c2\u6570\u662f\u4e3a\u4e86\u8ba9JSON\u66f4\u7f8e\u89c2\u3002 \u53ef\u80fd\u5927\u5bb6\u6709\u6ce8\u610f\u5230\u6709\u4e2atarBarExtra...\u8fd9\u6837\u7684\u5b57\u6bb5\uff0c\u8fd9\u4e2a\u5b57\u6bb5\u5462\uff0c\u662f\u6211\u4eec\u7528\u6765\u663e\u793ahttp\u72b6\u6001\u7801\u548c\u76f8\u5e94\u65f6\u95f4\u7684\uff0c\u5bf9\u6bd4postman\u5c31\u662f: \u56e0\u4e3a\u91cc\u9762\u5185\u5bb9\u5f88\u591a\uff0c\u6240\u4ee5\u6211\u628a\u5b83\u4f5c\u4e3a\u4e00\u4e2a\u7ec4\u4ef6\u62bd\u79bb\u51fa\u6765\u3002 \u7f16\u5199http\u72b6\u6001\u7801\u7ec4\u4ef6 \u6700\u7ec8\u7ed3\u679c\u5c31\u662f\u8fd9\u6837\uff0c\u7b80\u5355\u7684html\u4ee3\u7801\u3002 \u8fd9\u91cc\u80af\u5b9a\u6709\u5c0f\u4f19\u4f34\u6709 \u7591\u60d1 \uff0c\u4e3a\u4ec0\u4e48\u4f60\u628astyle\u8fd9\u79cd\u6587\u4ef6\u653e\u5230css\u91cc\u9762\u53bb\u5462\uff1f\u5176\u5b9e\u4e0d\u662f\u6211\u4e0d\u60f3\uff0c\u662f \u56e0\u4e3a\u6211\u61d2 \uff0c\u800c\u4e14\u9700\u8981\u6211\u624b\u52a8\u5199\u6837\u5f0f\u7684\u5730\u65b9\u5176\u5b9e\u8fd8\u86ee\u5c11\u7684\uff0c\u5982\u679c\u5199\u7684\u4e00\u822c\u662f\u5728\u540c\u7ea7\u76ee\u5f55\u7f16\u5199 \u540c\u540d\u6587\u4ef6.less \uff0c\u91cc\u9762\u7528less\u7684\u8bed\u6cd5\u53bb\u5199\u6837\u5f0f\uff0c\u8fd9\u91cc\u6211\u6c42\u65b9\u4fbf\uff0c\u5c31\u4e00\u9505\u7aef\u4e86\u3002 \u5927\u6982\u6548\u679c: \u7a0d\u5fae\u8c03\u6574\u4e00\u4e0b\u4e4b\u524d\u7684\u4ee3\u7801 \u8bf7\u6c42\u90e8\u5206\u548c\u5168\u5c40\u7684response\u51b2\u7a81\u4e86\uff0c\u8c03\u6574\u4e00\u4e0b: \u9ad8\u5ea6\u4e5f\u7ed9\u964d\u4f4e\u4e00\u70b9\uff0c\u4e0d\u7136\u592a\u9ad8\u4e86\uff0c\u4e00\u70b9\u90fd\u4e0d\u62ff\u7834\u4ed1\uff01 \u6539\u5199Request\u7c7b \u83b7\u53d6cookie \u6211\u4eec\u4e4b\u524d\u7684\u540e\u7aef\u63a5\u53e3\u5e76\u6ca1\u6709\u62ff\u51facookie\u4fe1\u606f\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u6539\u9020\u4e00\u4e0b\u3002 \u548cheaders\u7b49\u7c7b\u4f3c \u7f16\u5199\u6700\u540e\u7684\u90e8\u5206 \u7531\u4e8ecookies\u548cheaders\u90fd\u662f\u4ee5\u8868\u5355\u7684\u5f62\u5f0f\u5c55\u793a\u7684\uff0c\u800c\u4e14\u90fd\u662f key-value \u7684\u683c\u5f0f\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5c01\u88c5\u6210Table\u7ec4\u4ef6\u3002 \u7f16\u5199columns \u7f16\u5199\u6839\u636e\u4e0d\u540c\u5b57\u6bb5\uff08cookies\u548cresponse_headers\uff09\u6765\u83b7\u53d6\u5bf9\u5e94\u6570\u636e\u7684\u65b9\u6cd5 \u5f15\u51652\u4e2a\u7ec4\u4ef6\u5e76\u4e14\u8bbe\u7f6e\u4e0d\u5206\u9875 \u4e24\u5757\u9664\u4e86\u8fd9\u91cc\u4e0d\u4e00\u6837\uff0c\u5176\u4ed6\u90fd\u662f\u4e00\u6837\u7684\u3002 \u6700\u7ec8\u6548\u679c \u5e7f\u544a\u65f6\u95f4 \u9884\u89c8\u5730\u5740: http://47.112.32.195/ \u540e\u7aef\u4ee3\u7801\u5730\u5740: https://github.com/wuranxu/pity \u524d\u7aef\u4ee3\u7801\u5730\u5740: https://github.com/wuranxu/pityWeb \u6b22\u8fce\u5173\u6ce8\u516c\u4f17\u53f7 \u6d4b\u8bd5\u5f00\u53d1\u5165\u5751 \uff0c\u8fd8\u6709\u52a0\u7fa4\u4e00\u8d77\u8ba8\u8bba\u76f8\u5173\u95ee\u9898\u5440\uff01\u5982\u679c\u7fa4\u4e8c\u7ef4\u7801\u8fc7\u671f\u4e86\uff0c\u53ef\u4ee5\u52a0\u6211\u4e2a\u4eba\u5fae\u4fe1: wuranxu \u6211\u62c9\u4f60\u8fdb\u7fa4~","title":"16.\u7f16\u5199\u7c7bpostman\u9875\u9762(5)"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2817%29%20%E8%AE%BE%E8%AE%A1%E7%94%A8%E4%BE%8B%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/","text":"\u56de\u987e \u5f88\u4e45\u6ca1\u6709\u66f4\u65b0\u6587\u7ae0\u4e86\uff0c\u6b64\u65f6\u5df2\u7ecf\u662f23:23\u4e86\uff0c\u6709\u4e9b\u6127\u759a\uff0c\u56e0\u4e3a\u81ea\u5df1\u6700\u8fd1\u4ea4\u63a5\u7684\u4e8b\u60c5+\u751f\u6d3b\u7684\u4e8b\u60c5\u8fd8\u662f\u6bd4\u8f83\u591a\u7684\uff0c\u6240\u4ee5\u5230\u4e86\u665a\u4e0a\u5c31\u6ca1\u6709\u529b\u6c14\u6765\u66f4\u65b0\u4e86\u3002\u8fd9\u91cc\u5c31\u66f4\u52a0\u4f69\u670dWQRF\u8fd9\u4e2a \u795e\u4e00\u6837\u7684\u7537\u4eba \uff01 \u8bb0\u5f97\u4e0a\u6b21\u8bf4\u5230\uff0c\u6211\u4eec\u5236\u4f5c\u4e86\u4e00\u4e2a\u7b80\u6613\u7684\u652f\u6301 HTTP \u8bf7\u6c42\u7684\u9875\u9762\uff0c\u5b9e\u9645\u4e0a\u6211\u4eec\u5374 \u6ca1\u6709\u628a\u5b83\u7528\u5230\u7528\u4f8b\u4e4b\u4e2d \u3002 \u7528\u4f8b\u8bbe\u8ba1 \u6211\u8fd9\u4e2a\u4eba\u6709\u4e2a\u5f88\u5927\u7684\u7f3a\u70b9\uff0c\u60f3\u5230\u5565\u5c31\u505a\u5565\uff0c\u7ecf\u5e38\u662f\u4e8b\u5148\u8bbe\u8ba1\u4e00\u4e2a\u7b80\u7248\uff0c\u7136\u540e\u540e\u7eed\u8fdb\u884c \u6253\u78e8 \uff0c\u5176\u5b9e\u8fd9\u6837\u5bf9\u4e00\u4e2a\u6210\u719f\u7684\u7cfb\u7edf\u6765\u8bf4\u592a\u4e0d\u53cb\u597d\u4e86\uff0c\u5f88\u591a\u4e1c\u897f\u53ef\u80fd\u5728\u8bbe\u8ba1\u7684\u65f6\u5019\u5c31\u592a\u8fc7\u4e8e\u5c40\u9650\u4e86\u3002\u8fd9\u91cc\u4e0d\u626f\u5e9f\u8bdd\u4e86\uff0c\u76f4\u63a5\u8fdb\u5165\u4e3b\u9898\u5427\u3002 \u5173\u4e8e\u7528\u4f8b \u601d\u8003\u8fc7\u5f88\u591a\u6b21\uff0c\u76ee\u524d\u5728\u516c\u53f8\u5236\u4f5c\u7684\u6d4b\u8bd5\u5e73\u53f0\u6709\u4e2a\u7279\u70b9\uff0c\u5c31\u662f\u4e0d\u9700\u8981\u5199\u4ee3\u7801\u5c31\u53ef\u4ee5\u5b8c\u6210 \u63a5\u53e3\u6d4b\u8bd5\u7528\u4f8b \u7684\u7f16\u5199\uff0c\u53ea\u4e0d\u8fc7\u788d\u4e8e\u5bf9\u5927\u5bb6\u7684\u6210\u957f\u6ca1\u6709\u592a\u5927\u7684 \u63d0\u5347 \uff0c\u6240\u4ee5\u6211\u8fd9\u6b21\u6253\u7b97\u505a\u5230 \u517c\u5bb9 \uff0c\u5982\u679c\u4f60\u613f\u610f\u5199\u4ee3\u7801\uff0c\u90a3\u4e48\u4f60\u53ef\u4ee5 \u5bfc\u5165\u4ee3\u7801 \u6216\u8005\u5728\u7ebf\u7f16\u5199\u4ee3\u7801\uff0c\u5982\u679c\u4e0d\u60f3\u770b\u5230\u4ee3\u7801\uff0c\u4e5f\u53ef\u4ee5\u91c7\u7528 \u65e0\u7801\u6a21\u5f0f \uff0c\u5e76\u4e14\u8fd8\u8981\u505a\u5230\u968f\u65f6\u8f6c\u6362\u3002 \u7528\u4f8b\u7684\u751f\u547d\u5468\u671f \u4ece\u8bbe\u8ba1\u4e0a\u6765\u8bf4\uff0c\u7528\u4f8b\u4ee5\u94fe\u8def\u7684\u5f62\u5f0f\u6267\u884c\uff0c\u4e00\u4e2a\u7528\u4f8b\u4f1a\u6709\u5f88\u591a\u4e2a \u4e34\u65f6\u53d8\u91cf \uff0c\u901a\u8fc7\u5b83\u4eec\uff0c\u6211\u4eec\u53ef\u4ee5\u89e3\u51b3\u6570\u636e\u4f9d\u8d56\uff0c\u5b8c\u6210\u5bf9\u6574\u4e2a\u6d41\u7a0b\u7684\u6d4b\u8bd5\u3002\u7531\u4e8e\u7b14\u8005 \u753b\u56fe\u80fd\u529b \u6709\u9650\uff0c\u6240\u4ee5\u8fd9\u91cc\u5c31\u4e0d\u4e0a\u56fe\u4e86\u3002\u4e00\u4e2a\u7528\u4f8b\u5206\u4e3a\u51e0\u4e2a\u90e8\u5206: \u524d\u7f6esetUp\u64cd\u4f5c \u7528\u4f8b\u6267\u884c \u540e\u7f6etearDown\u64cd\u4f5c \u5176\u4e2d\u6bcf\u4e2a\u64cd\u4f5c\u91cc\u9762\u90fd\u62e5\u6709\u5f88\u591a\u4e2a\u6b65\u9aa4(step)\uff0c\u6bcf\u4e2astep\u4ea7\u751f\u7684\u6570\u636e\u90fd\u4f1a\u5728\u4e3b\u7528\u4f8b\u7684\u751f\u547d\u5468\u671f\u4e2d\u4fdd\u5b58\uff0c\u8fbe\u5230\u6570\u636e\u4e92\u901a\u7684\u6548\u679c\u3002 \u8fd9\u91cc\u7684\u6b65\u9aa4\u53ef\u4ee5\u662f http\u8bf7\u6c42 \uff0c redis\u64cd\u4f5c \uff0c sql\u8bed\u53e5 \uff0c python\u4ee3\u7801\u7247\u6bb5 \u7b49\u7b49\uff0c\u6bcf\u4e2a\u6b65\u9aa4\u90fd\u53ef\u4ee5\u62e5\u6709\u4e00\u4e2a\u8fd4\u56de\u503c\uff0c\u901a\u8fc7\u8fd4\u56de\u503c\u89e3\u51b3\u6570\u636e\u4f9d\u8d56\u95ee\u9898\u3002 \u4e3e\u4f8b \u5982\u679c\u6211\u4eec\u9700\u8981\u83b7\u53d6\u7528\u6237\u7684 \u4f59\u989d \uff0c\u90a3\u4e48\u6211\u4eec\u7684\u7528\u4f8b\u5c06\u8fd9\u6837\u53bb\u7f16\u5199: \u5148\u8bbe\u8ba1\u4e00\u4e2a\u767b\u5f55\u7684\u6d4b\u8bd5\u7528\u4f8b: \u7528\u4f8b\u540d\u79f0: \u7528\u6237\u767b\u5f55 \u524d\u7f6e\u6761\u4ef6: \u65e0 \u7528\u4f8b\u6267\u884c: \u53d1\u9001http\u8bf7\u6c42\uff0c\u83b7\u53d6token \u540e\u7f6e\u6761\u4ef6: \u65e0 \u65ad\u8a00\u8bed\u53e5: \u6821\u9a8chttp\u72b6\u6001\u7801\u7b49 \u7f16\u5199\u83b7\u53d6\u7528\u6237\u4f59\u989d\u7684\u6d4b\u8bd5\u7528\u4f8b(\u4e3b\u7528\u4f8b): \u7528\u4f8b\u540d\u79f0: \u83b7\u53d6\u7528\u6237\u4f59\u989d \u524d\u7f6e\u6761\u4ef6: step1: \u7528\u6237\u767b\u5f55 \u8bb0\u5f55\u8fd4\u56de\u503c\u4e3astep1\uff0c\u901a\u8fc7step1.token\u83b7\u53d6\u5230\u767b\u5f55\u63a5\u53e3\u4e2d\u7684token\u6570\u636e \u7528\u4f8b\u6267\u884c: \u628abody\u4e2d\u7684${step1.token}\u66ff\u6362\u4e3a\u771f\u5b9e\u7684token\uff0c\u53d1\u9001http\u8bf7\u6c42\u3002 \u540e\u7f6e\u6761\u4ef6:\u65e0 \u65ad\u8a00\u8bed\u53e5: \u6821\u9a8ccode\u548cmsg\u4ee5\u53cadata\u5b57\u6bb5\u4e2d\u7684\u4fe1\u606f \u521d\u671f\u770b\u4e0d\u61c2\u4e0d\u8981\u7d27\uff0c\u5927\u6982\u65b9\u5411\u662f\u8fd9\u4e2a\u6837\u5b50\u3002\u4e3b\u8981\u4e5f\u6ca1\u6709\u56fe\u7247\uff0c\u8fd9\u662f\u4e00\u4e2a\u6d41\u7a0b\u5316\u7684\u4e1c\u897f\u3002 \u8865\u5145\u4e00\u4e0b\u56fe\u7247 \u516c\u7528\u7ec4\u4ef6\u5305pity_basic \u4e3b\u8981\u5185\u5bb9\u6709: \u5b58\u50a8\u7528\u4f8b\u751f\u547d\u5468\u671f\u4ea7\u751f\u7684\u53d8\u91cf \u5bfb\u627e\u8bf7\u6c42\u5b57\u6bb5\u4e2d\u7684\u53d8\u91cf\u5e76\u66ff\u6362\u6210\u771f\u5b9e\u6570\u636e redis\u76f8\u5173\u64cd\u4f5c sql\u76f8\u5173\u64cd\u4f5c http\u76f8\u5173\u64cd\u4f5c python\u4ee3\u7801\u5757\u76f8\u5173\u64cd\u4f5c \u4e0a\u8ff0\u7684\u4ee3\u7801\u76f8\u5173\u7684\u64cd\u4f5c\u90fd\u662f\u4e3a\u4e86\u80fd\u5c06 \u6570\u636e\u548c\u4ee3\u7801 \u8fdb\u884c\u4e92\u76f8\u8f6c\u6362\uff0c\u5177\u4f53\u7684\u6784\u601d\u8fd8\u6ca1\u6709\u5b8c\u5168\u60f3\u597d\u3002\u6211\u559c\u6b22\u8fb9\u5199\u8fb9\u60f3\uff0c\u4e0d\u7136\u6211\u60f3\u5f97\u80af\u5b9a\u4e0d\u5168\uff0c\u53ea\u6709\u5199\u7684\u65f6\u5019\u9047\u5230\u95ee\u9898\u4e86\u624d\u80fd\u60f3\u597d\u8981\u600e\u4e48\u505a\u4e0b\u4e00\u6b65\u3002 \u7ed9\u6211\u601d\u8003\u7684\u65f6\u95f4\u6709\u9650\uff0c\u6211\u53ea\u80fd\u8d70\u4e00\u6b65\u7b97\u4e00\u6b65\u4e86\uff01 \u5176\u5b9e\u8fd9\u91cc\u6211\u4e5f\u89c9\u5f97\u81ea\u5df1\u8bf4\u7684\u4e91\u91cc\u96fe\u91cc\uff0c\u8fd8\u662f\u7b49\u540e\u7eed\u6210\u54c1\u51fa\u6765\u4e86\uff0c\u56de\u8fc7\u5934\u6765\u770b\u6216\u8005\u4fee\u6539\u8fd9\u7bc7\u6587\u7ae0\u5427\uff01 \u76ee\u5f55\u5927\u81f4\u7ed3\u6784 \u7f16\u5199\u53d8\u91cf\u67e5\u627e\u76f8\u5173\u65b9\u6cd5 \u8fd9\u8fb9\u6211\u4eec\u81ea\u5df1\u5185\u5b9a\u4e00\u5957\u89c4\u5219\uff0c\u51e1\u662f ${\u53d8\u91cf} \u8fd9\u79cd\u6570\u636e\uff0c\u90fd\u662f\u9700\u8981\u66ff\u6362\u7684\u53d8\u91cf\uff0c\u53ef\u80fd\u7531\u5176\u4ed6\u524d\u7f6e\u6216\u5e38\u91cf\u4ea7\u751f\uff0c\u9700\u8981\u968f\u65f6\u66ff\u6362\u3002\u8fd9\u4e2a\u89c4\u5219\u8981\u6c42\u53d8\u91cf\u5c3d\u91cf\u7b80\u5355\uff0c\u4e0d\u8981\u641e\u7279\u6b8a\u7b26\u53f7\u3002 import re el_exp = r\"\\$\\{(.+)\\}\" pattern = re.compile(el_exp) def get_el_expression (string: str) : \"\"\" \u83b7\u53d6el\u8868\u8fbe\u5f0f :param string: :return: \"\"\" return re.findall(pattern, string) if __name__ == \"__main__\" : s = \"select * from xxx where name = '${mygod}'\" print(get_el_expression(s)) \u9a8c\u8bc1\u8f93\u51fa\u65e0\u8bef\uff0c\u6210\u529f\u627e\u5230\u53d8\u91cf \u6211\u4eec\u7528\u6b63\u5219\u63d0\u53d6\u53d8\u91cf\uff0c\u8fd9\u6837\u5982\u679c\u6211\u4eec\u7684sql\u8bed\u53e5\u91cc\u9762\u6709\u53d8\u91cf\u7684\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u505a\u5230\u52a8\u6001sql\u8bed\u53e5\uff0c\u5982\u4e0a\u56fe\u3002\u4e0d\u8fc7\u57fa\u4e8e\u8fd9\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u63d0\u4f9b\u4e00\u4e2a\u53d8\u91cf\u6c60\uff0c\u7528\u6765\u5b58\u653e\u8fd9\u4e2a\u7528\u4f8b\u7684\u6240\u6709 \u4e34\u65f6\u53d8\u91cf \u3002 \u7f16\u5199\u53d8\u91cf\u6c60\u76f8\u5173\u65b9\u6cd5 \"\"\" pity\u53d8\u91cf\u6c60 \u53d8\u91cf\u6c60\u7684\u751f\u547d\u5468\u671f\u4e0e\u7528\u4f8b\u4fdd\u6301\u4e00\u81f4 \"\"\" __author__ = \"xiaoke\" class VarPool (object) : def __init__ (self, case_id) : \"\"\" :param case_id: \u7528\u6765\u6807\u8bc6\u53d8\u91cf\u6240\u5904\u7684\u4e3b\u751f\u547d\u5468\u671fcase \"\"\" self.cache = dict() self.case_id = case_id def set (self, key, value) : self.cache[key] = value def get (self, key) : return self.cache.get(key) def get_default (self, key, default_value) : return self.cache.get(key, default_value) \u8fd9\u91cc\u521b\u5efa\u4e86\u4e00\u4e2a\u53d8\u91cf\u6c60\u7c7b\uff0c\u5b9e\u9645\u4e0a\u7ef4\u62a4\u4e86\u4e00\u4e2amap\uff0c\u5f53\u7136\u7531\u4e8e\u590d\u6742\u573a\u666f\u4e0b\uff0c\u53ef\u80fd\u4f1a\u6709 \u53d8\u91cf\u51b2\u7a81 \u7684\u60c5\u51b5\uff0c\u6240\u4ee5\u6211\u4eec\u4f1a\u5728web\u9875\u9762\u5c42\u53bb\u63a7\u5236\uff0c\u53bb\u4fdd\u8bc1\u7528\u6237 \u4e0d\u4f7f\u7528\u91cd\u590d\u7684\u53d8\u91cf \u3002 \u4eca\u5929\u7684\u5185\u5bb9\u5c31\u5148\u5230\u8fd9\u91cc\u4e86\uff0c\u4e3b\u8981\u8fd8\u662f\u4e00\u4e2a\u6784\u601d\u7684\u95ee\u9898\u3002\u540e\u9762\u6162\u6162\u8865\u5168\u8fd9\u4e9b\u6982\u5ff5\uff0c\u4f7f\u5b83\u8d8a\u6765\u8d8a\u660e\u6717\u3002\u56e0\u4e3a\u6211\u73b0\u5728\u4e5f\u5f88\u61f5\u903c\uff0c\u5982\u679c\u7591\u60d1\u7684\u8bdd\uff0c\u53ef\u4ee5\u7b49\u6574\u4e2a\u7528\u4f8b\u6d41\u7a0b\u6253\u901a\u4e86\u518d\u6765 \u56de\u987e \u4e00\u4e0b\u3002 \u540e\u7eed\u7684\u8bddpity_basic\u4f1a\u4f5c\u4e3a\u4e00\u4e2a tar\u5305 \uff0c\u53ef\u5728pypi\u4e0b\u8f7d\uff0c\u5355\u72ec\u62bd\u51fa\u8fd9\u4e2a\u5305\u7684\u4e3b\u8981\u539f\u56e0\u8fd8\u662f\u4e3a\u4e86\u652f\u6301 \u4ee3\u7801 \u548c \u65e0\u7801 \u6a21\u5f0f\u7684\u5207\u6362\u3002 pity_basic\u4ee3\u7801\u5730\u5740","title":"17.\u8bbe\u8ba1\u7528\u4f8b\u751f\u547d\u5468\u671f"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2818%29%20%E9%A1%B9%E7%9B%AE%E7%94%A8%E4%BE%8B%E8%A1%A8%E8%AE%BE%E8%AE%A1%E5%92%8C%E6%9D%83%E9%99%90%E6%94%B9%E9%80%A0/","text":"\u56de\u987e \u4e0a\u4e00\u8282\uff0c\u6211\u4eec\u8bf4\u5230\u4e86\u5173\u4e8e\u6574\u4e2a\u7528\u4f8b\u6267\u884c\u7684\u751f\u547d\u5468\u671f\u3002\u6211\u540e\u9762\u7ec6\u60f3\u4e86\u4e00\u4e0b\uff0c\u5982\u679c\u4e00\u5f00\u59cb\u5c31\u8981\u5b8c\u5168\u517c\u5bb9 \u4ee3\u7801\u751f\u6210 \u7684\u8bdd\uff0c\u5199\u8d77\u6765\u4f1a\u5f88\u8d39\u65f6\u95f4\u3002\u4e3a\u4e86\u7ed9\u5927\u5bb6\u4e00\u4e9b\u597d\u7684\u4f53\u9a8c\uff0c\u8fd8\u662f\u5f97\u4e00\u53e3\u4e00\u53e3\u5730\u5403\uff0c\u4e0d\u80fd\u4e00\u4e0b\u5403\u80d6\u3002 \u6240\u4ee5\u6211\u4eec\u5c31\u5148\u5b8c\u6210\u65e0\u7801\u6a21\u5f0f\u5427~ \u7c97\u7565\u5730\u8bbe\u8ba1\u51e0\u4e2a\u6838\u5fc3\u8868 \u6211\u4eec\u7684\u7528\u4f8b\u540e\u7eed\u5982\u679c\u8981\u65b9\u4fbf\u7ba1\u7406\uff0c\u80af\u5b9a\u662f\u9700\u8981\u505a\u4e00\u4e9b \u5206\u7c7b \u548c \u6743\u9650 \u7684\u63a7\u5236\uff0c\u6240\u4ee5\u6211\u4eec\u5148\u8bbe\u8ba1\u51e0\u4e2a\u6838\u5fc3\u7684\u8868: \u9879\u76ee\u8868 \u7528\u4f8b\u5206\u6b65\u5728\u5404\u4e2a\u9879\u76ee\uff0c\u7c7b\u4f3c\u4e8e\u76ee\u5f55\u7684\u6982\u5ff5\uff0c\u4e0d\u540c\u7684\u7528\u4f8b\u4f4d\u4e8e\u4e0d\u540c\u7684\u9879\u76ee\u4e4b\u4e2d\uff0c\u65b9\u4fbf\u7528\u4f8b\u8fdb\u884c\u5206\u7c7b\u3002 \u9879\u76ee\u89d2\u8272\u8868 \u6bcf\u4e2a\u9879\u76ee\u90fd\u662f\u9700\u8981\u6709\u81ea\u5df1\u7684 \u6210\u5458 \uff0c\u5bf9\u4e8e\u6210\u5458\u4eec\u6765\u8bf4\uff0c\u4ed6\u4eec\u56e0\u4e3a\u8eab\u4efd\u7684\u4e0d\u540c\uff0c\u8eab\u4e0a\u62c5\u8d1f\u7684\u804c\u8d23\u4e5f\u4e0d\u4e00\u6837\uff0c\u6211\u4eec\u7ed9\u51fa\u51e0\u4e2a\u7b80\u5355\u7684\u8eab\u4efd\u5982: \u7ec4\u957f\u548c\u7ec4\u5458\uff0c\u5176\u4e2d\u7ec4\u957f\u53ef\u4ee5\u5bf9\u7ec4\u5458\u8fdb\u884c\u76f8\u5173\u6743\u9650\u7684\u53d8\u5316\u3002 \u6d4b\u8bd5\u7528\u4f8b\u8868 \u5b58\u653e\u4e86\u5404\u4e2a\u7528\u4f8b\u7684\u4fe1\u606f\uff0c\u662f\u6d4b\u8bd5\u5e73\u53f0\u7684\u4e00\u4e2a\u6700\u5c0f\u7684\u6267\u884c\u5355\u5143\u3002 \u9879\u76ee\u8868 models/project.py from app.models import db from datetime import datetime class Project (db.Model) : id = db.Column(db.INT, primary_key= True ) name = db.Column(db.String( 16 ), unique= True , index= True ) owner = db.Column(db.INT) created_at = db.Column(db.DATETIME, nullable= False ) updated_at = db.Column(db.DATETIME, nullable= False ) deleted_at = db.Column(db.DATETIME) create_user = db.Column(db.INT, nullable= True ) update_user = db.Column(db.INT, nullable= True ) private = db.Column(db.BOOLEAN, default= False ) def __init__ (self, name, owner, create_user, private=False) : self.name = name self.owner = owner self.private = private self.created_at = datetime.now() self.updated_at = datetime.now() self.create_user = create_user self.update_user = create_user self.deleted_at = None \u5927\u6982\u5206\u4e3a\u4ee5\u4e0b\u51e0\u4e2a\u5b57\u6bb5\uff0c\u9664\u4e86\u521b\u5efa/\u66f4\u65b0\u65f6\u95f4/\u7528\u6237\u4ee5\u5916\uff0c\u8fd8\u6709\u4ee5\u4e0b\u5b57\u6bb5: owner\uff08\u7ec4\u957f\uff09 name\uff08\u9879\u76ee\u540d\uff09 private\uff08\u662f\u5426\u79c1\u6709\uff09 \u9879\u76ee\u89d2\u8272\u8868 models/project_role.py from app.models import db from datetime import datetime class ProjectRole (db.Model) : id = db.Column(db.INT, primary_key= True ) project_id = db.Column(db.INT, index= True ) project_role = db.Column(db.INT, index= True ) created_at = db.Column(db.DATETIME, nullable= False ) updated_at = db.Column(db.DATETIME, nullable= False ) deleted_at = db.Column(db.DATETIME) create_user = db.Column(db.INT, nullable= True ) update_user = db.Column(db.INT, nullable= True ) def __init__ (self, project_id, project_role, create_user) : self.project_id = project_id self.project_role = project_role self.created_at = datetime.now() self.updated_at = datetime.now() self.create_user = create_user self.update_user = create_user self.deleted_at = None \u4e0e\u4e0a\u4e2a\u8868\u5355\u7c7b\u4f3c\uff0cproject_id\u662f\u9879\u76eeid\uff0cproject_role\u662f\u9879\u76ee\u89d2\u8272\u3002 \u54b1\u4eec\u89c4\u5b9a: 1: \u7ec4\u957f 2: \u7ec4\u5458 \u6d4b\u8bd5\u7528\u4f8b\u8868 models/test_case.py from app.models import db from datetime import datetime class TestCase (db.Model) : id = db.Column(db.INT, primary_key= True ) name = db.Column(db.String( 32 ), unique= True , index= True ) request_type = db.Column(db.INT, default= 1 , comment= \"\u8bf7\u6c42\u7c7b\u578b 1: http 2: grpc 3: dubbo\" ) url = db.Column(db.TEXT, nullable= False , comment= \"\u8bf7\u6c42url\" ) request_method = db.Column(db.String( 12 ), nullable= True , comment= \"\u8bf7\u6c42\u65b9\u5f0f, \u5982\u679c\u975ehttp\u53ef\u4e3a\u7a7a\" ) request_header = db.Column(db.TEXT, comment= \"\u8bf7\u6c42\u5934\uff0c\u53ef\u4e3a\u7a7a\" ) project_id = db.Column(db.INT, comment= \"\u6240\u5c5e\u9879\u76ee\" ) tag = db.Column(db.String( 64 ), comment= \"\u7528\u4f8b\u6807\u7b7e\" ) status = db.Column(db.INT, comment= \"\u7528\u4f8b\u72b6\u6001: 1: \u5f85\u5b8c\u6210 2: \u6682\u65f6\u5173\u95ed 3: \u6b63\u5e38\u8fd0\u4f5c\" ) expected = db.Column(db.TEXT, comment= \"\u9884\u671f\u7ed3\u679c, \u652f\u6301el\u8868\u8fbe\u5f0f\" , nullable= False ) created_at = db.Column(db.DATETIME, nullable= False ) updated_at = db.Column(db.DATETIME, nullable= False ) deleted_at = db.Column(db.DATETIME) create_user = db.Column(db.INT, nullable= False ) update_user = db.Column(db.INT, nullable= False ) def __init__ (self, name, request_type, url, project_id, tag, status, expected, create_user, request_header=None, request_method=None) : self.name = name self.request_type = request_type self.url = url self.project_id = project_id self.tag = tag self.status = status self.expected = expected self.create_user = create_user self.update_user = create_user self.request_header = request_header self.request_method = request_method self.created_at = datetime.now() self.updated_at = datetime.now() \u57fa\u672c\u4e0a\u5185\u5bb9\u90fd\u5728comment\u6ce8\u91ca\u91cc\u9762\u4e86\uff0c\u5927\u5bb6\u770b\u7740\u5c31\u884c\uff0c\u4e5f\u4e0d\u591a\u8bb2\u89e3\u4e86\u3002\u80af\u5b9a\u73b0\u5728\u8fd8\u6709\u4e00\u4e9b\u7279\u6027\u6ca1\u6709\u8003\u8651\u5230\u7684\uff0c\u540e\u5e8f\u53ef\u4ee5 \u52a0\u5b57\u6bb5 \u89e3\u51b3\u3002 \u7f16\u5199\u68c0\u67e5\u7528\u6237\u6743\u9650\u7684\u88c5\u9970\u5668 \u6211\u4eec\u5728\u4e0a\u9762\u4e09\u5f20\u8868\u91cc\u9762\u5b9a\u4e49\u597d\u4e86 create_user \u548c update_user \uff0c\u5176\u5b9e\u8fd92\u4e2a\u5b57\u6bb5\u63a5\u53d7\u7684\u90fd\u662f\u54b1\u4eec\u7684\u7528\u6237id\uff0c\u800c\u7528\u6237id\u53c8\u662f\u53ef\u4ee5\u901a\u8fc7 token \u8fdb\u884c\u89e3\u6790\u7684\u3002 \u4e4b\u524d\u7f16\u5199\u8fc7\u7684\u89e3\u6790token\u7684\u65b9\u6cd5 \u8fd8\u8bb0\u5f97\u4e4b\u524d\u7f16\u5199\u8fc7\u7684\u89e3\u6790token\u7684\u65b9\u6cd5\u5417\uff1f\u6211\u4eec\u73b0\u5728\u5c31\u6765\u7f16\u5199\u4e00\u4e2a\u88c5\u9970\u5668: \u81ea\u52a8\u5224\u65ad\u7528\u6237token\u662f\u5426\u6709\u6548\u4ee5\u53ca\u83b7\u53d6\u7528\u6237\u4fe1\u606f\u3002 \u539f\u7406\u5f88\u7b80\u5355\uff0c\u5c31\u662f\u901a\u8fc7headers\u4e2d\u7684token\u5b57\u6bb5\u83b7\u53d6token\uff0c\u7ecf\u8fc7\u89e3\u6790\u540e\u62ff\u5230 \u7528\u6237\u4fe1\u606f \uff0c\u8fd9\u91cc\u66f4\u52a0\u590d\u6742\u4e00\u70b9\uff0c\u5bf9\u4e8e\u90a3\u79cd\u9700\u8981\u6709\u6743\u9650\u63a7\u5236\u7684\u5730\u65b9\uff0c\u6211\u4eec\u505a\u4e86\u4e00\u5c42\u5224\u65ad\uff0c\u5982\u679c\u6743\u9650\u5728\u914d\u7f6e\u8303\u56f4\u4ee5\u4e0b\uff0c\u90a3\u4e48\u666e\u901a\u6210\u5458\u5c31\u4e0d\u80fd\u8c03\u7528\u8fd9\u4e2a\u63a5\u53e3\u3002 \u5b8c\u6574\u4ee3\u7801: from functools import wraps from flask import request, jsonify from app import pity from app.middleware.Jwt import UserToken FORBIDDEN = \"\u5bf9\u4e0d\u8d77, \u4f60\u6ca1\u6709\u8db3\u591f\u7684\u6743\u9650\" class SingletonDecorator : def __init__ (self, cls) : self.cls = cls self.instance = None def __call__ (self, *args, **kwargs) : if self.instance is None : self.instance = self.cls(*args, **kwargs) return self.instance def permission (role=pity.config.get ( \"GUEST\" ) ) : def login_required (func) : @wraps(func) def wrapper (*args, **kwargs) : try : headers = request.headers token = headers.get( 'token' ) if token is None : return jsonify(dict(code= 401 , msg= \"\u7528\u6237\u4fe1\u606f\u8ba4\u8bc1\u5931\u8d25, \u8bf7\u68c0\u67e5\" )) user_info = UserToken.parse_token(token) # \u8fd9\u91cc\u628auser\u4fe1\u606f\u5199\u5165kwargs kwargs[ \"user_info\" ] = user_info except Exception as e: return jsonify(dict(code= 401 , msg=str(e))) # \u5224\u65ad\u7528\u6237\u6743\u9650\u662f\u5426\u8db3\u591f, \u5982\u679c\u4e0d\u8db3\u591f\u5219\u76f4\u63a5\u8fd4\u56de\uff0c\u4e0d\u7ee7\u7eed if user_info.get( \"role\" , 0 ) < role: return jsonify(dict(code= 400 , msg=FORBIDDEN)) return func(*args, **kwargs) return wrapper return login_required kwargs[\"user_info\"] = user_info \u91cd\u70b9\u6ce8\u610f\u4e00\u4e0b\u8fd9\u53e5\u8bdd\u3002 \u4e3a\u4e4b\u524d\u54b1\u4eec\u7f16\u5199\u7684http/request\u63a5\u53e3\u52a0\u5165\u6743\u9650 \u8fd9\u91cc\u63d2\u5165\u54b1\u4eec\u521a\u624d\u7684permission\u5373\u53ef \u7531\u4e8e\u6211\u4eec\u8fd9\u4e2a\u63a5\u53e3\u6682\u65f6\u652f\u6301\u767b\u5f55\u7528\u6237\u4f7f\u7528\uff0c\u6240\u4ee5\u6743\u9650\u9ed8\u8ba4\u5c31\u884c\u4e86\uff0c\u4e5f\u5c31\u662f\u8bf4\u7528\u6237role\u4e3a0(\u666e\u901a\u7528\u6237)\u5373\u53ef\uff01 \u6539\u52a8\u5f88\u7b80\u5355\uff0c\u5bfc\u5165permission\u5e76\u4f7f\u7528 \u8fd9\u91cc\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u6211\u4eec\u7684http_request\u5fc5\u987b\u5e26\u6709 user_info \u53c2\u6570\uff0c\u5426\u5219\u4f1a\u62a5\u9519\uff0c\u56e0\u4e3a\u6211\u4eec\u540e\u7eed\u53ef\u80fd\u4f1a\u7528\u5230\u7528\u6237\u4fe1\u606f\u3002 \u6539\u9020\u524d\u7aef\u4ee3\u7801 \u56e0\u4e3a\u6211\u4eec\u4e4b\u524d\u524d\u7aef\u5728\u8bf7\u6c42\u63a5\u53e3\u7684\u65f6\u5019\uff0c\u662f\u4e0d\u4f1a\u5e26\u4e0a\u7528\u6237token\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981 \u6539\u9020 \u524d\u7aef\u8bf7\u6c42\u65b9\u6cd5: \u5728\u53d1\u9001http\u8bf7\u6c42\u7684\u65f6\u5019\u5e26\u4e0atoken\u6570\u636e \u6821\u9a8c\u8fd4\u56decode\uff0c\u5982\u679c\u4e3a401\u5219\u81ea\u52a8\u6ce8\u9500\u7528\u6237\uff0c\u63d0\u793a\u7528\u6237\u672a\u767b\u5f55\uff01 \u521b\u5efasrc/utils/auth.js import { message } from 'antd' ; export default { headers : ( json = true ) => { const token = localStorage.getItem( 'pityToken' ); const headers = { token }; if (json) { headers[ 'Content-Type' ] = 'application/json' ; } return headers; }, response : ( res, info = false ) => { if (res.code === 0 ) { if (info) { message.info(res.msg); } return true ; } if (res.code === 401 ) { // \u8bf4\u660e\u7528\u6237\u672a\u8ba4\u8bc1 message.info(res.msg); localStorage.setItem( 'pityToken' , null ); localStorage.setItem( 'pityUser' , null ); window .location.href = '/user/login' ; } message.error(res.msg); return false ; }, }; \u8fd9\u91cc\u7f16\u5199\u4e86\u83b7\u53d6token\u5e76\u7ec4\u6210headers\u7684\u65b9\u6cd5\uff0c\u4e5f\u7f16\u5199\u4e86\u9488\u5bf9token\u8fc7\u671f\uff0c\u6743\u9650\u4e0d\u591f\u7684code\u7801\u8fdb\u884c\u4e0d\u540c\u7684\u5904\u7406\u3002 \u4fee\u6539src/services/request.js \u4fee\u6539\u8bf7\u6c42\u7ed3\u679c: \u8bf7\u6c42\u7ed3\u675f\u540e\uff0c\u53ea\u6709\u5f53\u8fd4\u56detrue\u72b6\u6001\u65f6\u624d\u8bbe\u7f6eresponse \u5f00\u59cb\u6d4b\u8bd5 \u53d1\u73b0\u6211\u4eec\u7684\u9519\u8bef\u4fe1\u606f\u5e76\u6ca1\u6709\u5b8c\u5168\u5c55\u793a\uff0c\u662f\u56e0\u4e3a\u6211\u4eec\u9700\u8981\u6ca1\u6709\u9488\u5bf9\u8bf7\u6c42\u5931\u8d25\u7684\u60c5\u51b5\u8fdb\u884c\u6821\u9a8c\uff0c\u6240\u4ee5\u6211\u4eec\u8fd8\u9700\u8981\u8c03\u6574\u540e\u7aef\u63a5\u53e3: \u5224\u65ad\u91cc\u9762\u7684 status \u662f\u5426\u4e3aTrue\uff0c\u4e0d\u4e3aTrue\u7684\u8bdd\u8fd4\u56de 110\u72b6\u6001\u7801 \u6765\u4e2a\u52a8\u6001\u56fe\u6d4b\u8bd5\u4e00\u4e0b\u5427: \u63a5\u7740\u6d4b\u8bd5\u4e00\u4e0b\u6743\u9650 \u901a\u8fc7\u5f00\u53d1\u8005\u5de5\u5177\u7684application\u53ef\u4ee5\u770b\u5230: \u6211\u4eec\u7684role\u9ed8\u8ba4\u662f0 \u63a5\u7740\u6211\u4eec\u8c03\u6574\u4e00\u4e0b\u6743\u9650\u4e3a: \u53ea\u6709 \u7ba1\u7406\u5458\u53ef\u4ee5\u8bf7\u6c42\u63a5\u53e3 \u6765\u4e2a\u52a8\u56fe\u770b\u770b: \u6253\u5b8c\u6536\u5de5\uff0c\u6700\u8fd1\u6e05\u660e\u53ef\u4ee5\u7a0d\u5fae\u66f4\u65b0\u591a\u4e00\u70b9 \ud83d\ude33 \u665a\u5b89\uff0c\u6211\u768412\u4e2a(\u5305\u62ec\u6211\u81ea\u5df1)\u89c2\u4f17\u4eec\uff01 \u5e7f\u544a\u65f6\u95f4 \u9884\u89c8\u5730\u5740: http://47.112.32.195/ \u540e\u7aef\u4ee3\u7801\u5730\u5740: https://github.com/wuranxu/pity \u524d\u7aef\u4ee3\u7801\u5730\u5740: https://github.com/wuranxu/pityWeb \u6b22\u8fce\u5173\u6ce8\u516c\u4f17\u53f7 \u6d4b\u8bd5\u5f00\u53d1\u5165\u5751 \uff0c\u8fd8\u6709\u52a0\u7fa4\u4e00\u8d77\u8ba8\u8bba\u76f8\u5173\u95ee\u9898\u5440\uff01\u5982\u679c\u7fa4\u4e8c\u7ef4\u7801\u8fc7\u671f\u4e86\uff0c\u53ef\u4ee5\u52a0\u6211\u4e2a\u4eba\u5fae\u4fe1: wuranxu \u6211\u62c9\u4f60\u8fdb\u7fa4~","title":"18.\u9879\u76ee\u7528\u4f8b\u8868\u8bbe\u8ba1\u548c\u6743\u9650\u6539\u9020"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2819%29%20%E7%BC%96%E5%86%99%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5%E6%8E%A5%E5%8F%A3%E5%92%8C%E9%A1%B5%E9%9D%A2%281%29/","text":"\u5f00\u7bc7\u95f2\u804a \u6628\u5929\u5728JD\u4e70\u4e86\u4e2a\u8df3\u7ef3\u7684\u73a9\u610f\uff0c\u6253\u7b97\u540e\u9762\u597d\u597d\u953b\u70bc\u4e0b\u8eab\u4f53\u3002\u5e73\u65f6\u4e45\u5750\u53c8\u52a0\u4e0a\u4e0d\u600e\u4e48\u8fd0\u52a8\uff0c\u5bfc\u81f4\u5404\u79cd\u5c0f\u6bdb\u75c5\u8fd8\u662f\u633a\u591a\u7684\uff0c\u5efa\u8bae\u5927\u5bb6\u4e5f\u5728\u5b66\u4e60\u4e4b\u4f59\uff0c\u591a\u653e\u677e\u4e0b\u8eab\u4f53\u3002\u6bd4\u5982\u50cf\u67d0\u699c\u4e00\u5927\u54e5\u5e26\u59b9\u8dd1\u6b65\uff0c\u5e26\u59b9\u7fbd\u6bdb\u7403\uff0c\u90fd\u662f\u5f88\u4e0d\u9519\u7684 \u953b\u70bc\u65b9\u5f0f \u3002\u5bf9\u4e8e\u6211\u8fd9\u79cd\u61d2\u4eba\uff0c\u5c31\u4e70\u6839\u7ef3\u5b50\u8df3\u4e00\u8df3\u5427\uff0c\u4e0d\u7136\u53ef\u80fd\u4e0a\u4e2a6\u697c\u90fd\u5f97\u5598\u6c14\u4e86\uff01 \u56de\u987e \u4e0a\u4e00\u8282\u54b1\u4eec\u5b9a\u5236\u597d\u4e86\u7b80\u5355\u7684\u6743\u9650\u7cfb\u7edf\uff0c\u4e5f\u8bbe\u8ba1\u4e86\u76f8\u5173\u7684\u8868\u6982\u5ff5\u3002\u4f46\u662f\u8868\u53ea\u6709\u5bf9\u5e94\u7684model\uff0c\u5e76\u6ca1\u6709\u7f16\u5199\u5b9e\u9645\u7684\u64cd\u4f5c\u63a5\u53e3\uff0c\u6240\u4ee5\u4eca\u5929\u6211\u4eec\u6765\u5b8c\u5584\u4ed6\u4eec\uff01 \u4e0a\u6b21\u6211\u4eec\u7f16\u5199\u7684 TestCase \u8868\u5b58\u5728\u4e00\u70b9\u95ee\u9898\uff0c\u9996\u5148\u662f\u6ca1\u6709 params \u5b57\u6bb5\uff0c\u4e5f\u6ca1\u6709 body \u5b57\u6bb5\uff0c\u5f53\u7136\u53ef\u80fd\u8fd8\u7f3a\u5c11\u5f88\u591a\u5b57\u6bb5\uff0c\u6211\u4eec\u53ef\u4ee5 \u5728\u540e\u7eed\u7684\u5f00\u53d1\u8fc7\u7a0b\u4e2d\u9646\u7eed\u8865\u5145 \u3002 \u5728dao/ init .py\u52a0\u5165\u65b0\u521b\u5efa\u7684\u8868 \u4fee\u6539TestCase\u8868 \u52a0\u5165params\u548cbody\u5b57\u6bb5 \u7f16\u5199\u9879\u76ee\u548c\u9879\u76ee\u89d2\u8272\u7684\u589e\u5220\u6539\u67e5\u63a5\u53e3 \u9996\u5148\u54b1\u4eec\u660e\u786e\u4e00\u4e2a\u8981\u6c42\uff0c\u56e0\u4e3a\u9879\u76ee\u6709\u516c\u6709\u548c\u79c1\u6709\u7684\u6982\u5ff5\uff0c\u6240\u4ee5\u5bf9\u4e8e\u7528\u6237\u80fd\u770b\u5230\u7684\u9879\u76ee\u5e94\u8be5\u662f\u8fd9\u6837\u7684\u903b\u8f91: \u666e\u901a\u7528\u6237 \u80fd\u770b\u5230 \u516c\u6709\u9879\u76ee \u548c \u79c1\u6709\u9879\u76ee(\u7528\u6237\u5728\u8be5\u6210\u5458\u4e2d\uff0c\u6210\u5458\u6216\u521b\u5efa\u8005) \u7ba1\u7406\u5458 \u80fd\u770b\u5230\u6240\u6709\u9879\u76ee \u7531\u4e8e\u6211\u4eec\u9700\u8981\u901a\u8fc7\u7528\u6237id\u62ff\u5230\u5bf9\u5e94\u6240\u5c5e\u7684project\uff0c\u6240\u4ee5\u6211\u4eec\u5148\u7f16\u5199project_role\u76f8\u5173\u63a5\u53e3 \u8bbe\u8ba1\u8868\u7684\u65f6\u5019\u6f0f\u6389\u4e86\uff0c\u8fd9\u91cc\u8865\u4e0auser_id \u7f16\u5199app/dao/project/ProjectRoleDao.py from app.models import db from app.models.project_role import ProjectRole from app.utils.logger import Log class ProjectRoleDao (object) : log = Log( \"ProjectRoleDao\" ) @staticmethod def list_project_by_user (user_id) : \"\"\" \u901a\u8fc7user_id\u83b7\u53d6\u9879\u76ee\u5217\u8868 :param user_id: :return: \"\"\" try : projects = ProjectRole.query.filter_by(user_id=user_id, deleted_at= None ).all() return [p.id for p in projects], None except Exception as e: ProjectRoleDao.log.error( f\"\u67e5\u8be2\u7528\u6237: {user_id} \u9879\u76ee\u5931\u8d25, {e} \" ) return [], f\"\u67e5\u8be2\u9879\u76ee\u5931\u8d25, {e} \" @staticmethod def add_project_role (user_id, project_id, project_role, user) : \"\"\" \u4e3a\u9879\u76ee\u6dfb\u52a0\u7528\u6237 :param user_id: \u7528\u6237id :param project_id: \u9879\u76eeid :param project_role: \u7528\u6237\u89d2\u8272 :param user: \u521b\u5efa\u4eba :return: \"\"\" try : role = ProjectRole.query.filter_by(user_id=user_id, project_id=project_id, project_role=project_role, deleted_at= None ).first() if role is not None : # \u8bf4\u660e\u89d2\u8272\u5df2\u7ecf\u5b58\u5728\u4e86 return \"\u8be5\u7528\u6237\u5df2\u5b58\u5728\" role = ProjectRole(user_id, project_id, project_role, user) db.session.add(role) db.session.commit() except Exception as e: ProjectRoleDao.log.error( f\"\u6dfb\u52a0\u9879\u76ee\u7528\u6237\u5931\u8d25, {e} \" ) return f\"\u6dfb\u52a0\u9879\u76ee\u7528\u6237\u5931\u8d25, {e} \" return None \u8fd9\u8fb9\u6682\u65f6\u7f16\u5199\u4e862\u4e2a\u63a5\u53e3\uff0c1\u4e2a\u662f\u901a\u8fc7\u7528\u6237\u83b7\u53d6\u5230\u7528\u6237\u7684\u9879\u76ee\uff0c\u53e6\u4e00\u4e2a\u662f\u4e3a\u9879\u76ee\u6dfb\u52a0\u7528\u6237\uff0c\u4ee3\u7801\u5f88\u7b80\u5355\uff0c\u4e5f\u5199\u4e86\u4e00\u4e9b\u6ce8\u91ca\u3002\u7531\u4e8e\u6682\u65f6\u6211\u4eec\u9700\u8981\u5feb\u901f\u505a\u4e00\u4e2a\u5c55\u793a\uff0c\u6240\u4ee5 \u6682\u65f6\u63d0\u4f9b\uff0c\u589e\u548c\u67e5\u529f\u80fd\u5373\u53ef \uff0c\u540e\u7eed\u7684\u63a5\u53e3\u518d\u6162\u6162\u8865\u5145\u3002 \u7f16\u5199app/dao/project/ProjectRole.py \u7531\u4e8e\u6211\u4eec\u5df2\u7ecf\u53ef\u4ee5\u901a\u8fc7user_id\u83b7\u53d6\u5230\u4ed6\u6709\u6743\u9650\u7684\u9879\u76ee\uff0c\u90a3\u4e48\u63a5\u4e0b\u6765\u6211\u4eec\u628a\u5b83\u548c\u5171\u6709\u9879\u76ee\u505a\u4e00\u4e2a\u6574\u5408\u5c31\u53ef\u4ee5\u4e86\u3002\u56e0\u4e3aproject\u4e0d\u53ef\u80fd\u592a\u591a\uff0c\u6240\u4ee5\u8fd9\u8fb9\u6211\u4eec\u76f4\u63a5\u7528 in \u64cd\u4f5c\u7b26\uff0c\u5148\u9884\u60f3\u4e00\u4e0b sql : select * from project where deleted_at is null and (owner = user or project_id in (\u5df2\u7ecf\u67e5\u51fa\u7684\u7528\u6237\u9879\u76ee) or private is false ); \u9996\u5148\u5fc5\u987b\u662f\u672a\u5220\u9664\u7684\uff0c\u5176\u6b21\u662fowner=user\u7684\uff0c\u518d\u5c31\u662f\u975e\u79c1\u6709\u6216\u8005\u7528\u6237\u6709\u6743\u9650\u7684\u3002 \u5982\u679c\u5bf9\u4e8e\u8d85\u7ea7\u7ba1\u7406\u5458\u6765\u8bf4\u7684\u8bdd\uff0c\u90a3\u4e48\u4ed6\u4eec\u5bf9\u4e8e\u6240\u6709\u9879\u76ee\u90fd\u662f\u53ef\u89c1\u7684\u3002 from sqlalchemy import or_ from app import pity from app.dao.project.ProjectRoleDao import ProjectRoleDao from app.models import db from app.models.project import Project from app.utils.logger import Log class ProjectDao (object) : log = Log( \"ProjectDao\" ) @staticmethod def list_project (user, role, page, size, name=None) : \"\"\" \u67e5\u8be2/\u83b7\u53d6\u9879\u76ee\u5217\u8868 :param user: \u5f53\u524d\u7528\u6237 :param role: \u5f53\u524d\u7528\u6237\u89d2\u8272 :param page: \u5f53\u524d\u9875\u7801 :param size: \u5f53\u524dsize :param name: \u9879\u76ee\u540d\u79f0 :return: \"\"\" try : search = [Project.deleted_at == None ] if role != pity.config.get( \"ADMIN\" ): project_list = ProjectRoleDao.list_project_by_user(user) search.append(or_(Project.id in project_list, Project.owner == user, Project.private == False )) if name: search.append(Project.name.ilike( \"%{}%\" .format(name))) data = Project.query.filter(*search) total = data.count() return data.order_by(Project.created_at.desc()).paginate(page, per_page=size).items, total, None except Exception as e: ProjectDao.log.error( f\"\u83b7\u53d6\u7528\u6237: {user} \u9879\u76ee\u5217\u8868\u5931\u8d25, {e} \" ) return 0 , 0 , f\"\u83b7\u53d6\u7528\u6237: {user} \u9879\u76ee\u5217\u8868\u5931\u8d25, {e} \" @staticmethod def add_project (name, owner, user, private) : try : data = Project.query.filter_by(name=name, deleted_at= None ).first() if data is None : return \"\u9879\u76ee\u5df2\u5b58\u5728\" pr = Project(name, owner, user, private) db.session.add(pr) db.session.commit(pr) except Exception as e: ProjectDao.log.error( f\"\u65b0\u589e\u9879\u76ee: {name} \u5931\u8d25, {e} \" ) return 0 , 0 , f\"\u65b0\u589e\u9879\u76ee: {name} \u5931\u8d25, {e} \" \u8fd9\u91cc\u91cd\u70b9\u5173\u6ce8 list_project \uff0c\u91cc\u9762\u5148\u5224\u65ad\u7528\u6237\u662f\u4e0d\u662fADMIN\uff0c\u5982\u679c\u4e0d\u662f\uff0c\u5219\u67e5\u8be2\u4e00\u4e0b\u8fd9\u4e2a\u7528\u6237\u62e5\u6709\u7684\u9879\u76ee\uff0c\u7b49\u4e8e\u8bf4\u662f\u8f6c\u6362\u4e86\u6211\u4eec\u521a\u624d\u5199\u7684sql\u3002 \u6700\u540e\u901a\u8fc7\u9879\u76ee\u7684\u521b\u5efa\u65f6\u95f4\u8fdb\u884c\u4e86\u6392\u5e8f\uff0c\u5e76\u8fdb\u884c\u4e86\u5206\u9875\u5e76\u8fd4\u56de\u4e86\u9879\u76ee\u603b\u6570\uff0c\u7b2c\u4e09\u4e2a\u53c2\u6570\u662ferror\u4fe1\u606f\u3002 \u7f16\u5199\u5177\u4f53\u7684\u63a5\u53e3 /project/insertProject /project/listProject /project/insertProjectRole \u7f16\u5199\u83b7\u53d6\u5206\u9875\u7684\u76f8\u5173\u65b9\u6cd5app/handler/page.py from flask import request # \u9ed8\u8ba4\u9875\u6570\u548c\u9875\u7801 PAGE = 1 SIZE = 10 class PageHandler (object) : @staticmethod def page () : \"\"\" \u83b7\u53d6page\u548csize :return: \"\"\" page = request.args.get( \"page\" ) if page is None or not page.isdigit(): page = PAGE size = request.args.get( \"size\" ) if size is None or not size.isdigit(): size = SIZE return int(page), int(size) \u5982\u679c\u6ca1\u6709\u83b7\u53d6\u5230page/size\u6216\u8005\u8bf4\u4ed6\u4eec\u4e0d\u662f\u975e\u6570\u5b57\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u7ed9\u4e2a\u9ed8\u8ba4\u503c\u3002 \u7bc7\u5e45\u6709\u9650\uff0c\u8fd9\u7bc7\u5185\u5bb9\u5148\u5230\u8fd9\u91cc\u5427\uff01\u518d\u4e0d\u53bb\u505a\u996d\u8981\u997f\u6b7b\u4e86\uff01","title":"19.\u7f16\u5199\u9879\u76ee\u7684\u589e\u5220\u6539\u67e5\u63a5\u53e3 \u548c\u9875\u9762(1)"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%282%29%20%E7%BB%99app%E6%B7%BB%E5%8A%A0%E9%85%8D%E7%BD%AE/","text":"\u7ed9Pity\u6dfb\u52a0\u914d\u7f6e \u56de\u987e \u8fd8\u8bb0\u5f97\u4e0a\u7bc7\u6587\u7ae0\u521b\u7acb\u7684 Flask \u5b9e\u4f8b\u5417\uff1f\u6211\u4eec\u901a\u8fc7\u8fd9\u4e2a\u5b9e\u4f8b\uff0c\u7ed9\u6839\u8def\u7531 / \u7ed1\u5b9a\u4e86\u4e00\u4e2a\u65b9\u6cd5\uff0c\u4ece\u800c\u4f7f\u5f97\u7528\u6237\u8bbf\u95ee\u4e0d\u540c\u8def\u7531\u7684\u65f6\u5019\u53ef\u4ee5\u6267\u884c\u4e0d\u540c\u7684\u65b9\u6cd5\u3002 \u914d\u7f6e \u8981\u77e5\u9053\uff0c\u5728\u4e00\u4e2a Web \u9879\u76ee\u4e2d\uff0c\u6709\u5f88\u591a\u4e1c\u897f\u662f\u53ef\u80fd\u4f1a\u4ea7\u751f\u53d8\u5316\u4ece\u800c\u9700\u8981\u62bd\u51fa\u6765\u4f5c\u4e3a\u914d\u7f6e\u9879\u7684\u3002 \u6240\u4ee5\u6211\u4eec\u63a5\u7740\u6765\u8bb2\u8bb2\u600e\u4e48\u5728 Flask \u5b89\u6392\u54b1\u4eec\u81ea\u5df1\u7684\u914d\u7f6e\u3002 \u79cd\u7c7b Flask \u652f\u6301\u7684\u914d\u7f6e\u79cd\u7c7b\u633a\u591a\uff0c\u5927\u6982\u6709 py\u6587\u4ef6 , Config\u5bf9\u8c61 , JSON \u7b49\u3002 \u6211\u4eec\u8fd9\u91cc\u91c7\u7528 from_object \u7684\u65b9\u5f0f\u3002 \u7f16\u5199pity/config.py\u6587\u4ef6 # \u57fa\u7840\u914d\u7f6e\u7c7b import os class Config (object) : ROOT = os.path.dirname(os.path.abspath(__file__)) LOG_NAME = os.path.join(ROOT, 'logs' , 'pity.log' ) \u76ee\u524d\u52a0\u4e86\u6839\u76ee\u5f55\u914d\u7f6e\u548clog\u6587\u4ef6\u8def\u5f84\u3002 \u4fee\u6539pity/app/ init _.py\u6587\u4ef6\uff0c\u5f15\u5165\u914d\u7f6e\u6587\u4ef6 from flask import Flask from config import Config pity = Flask(__name__) pity.config.from_object(Config) \u6539\u52a8\u5dee\u5f02 \u8fd9\u4e00\u8282\u5c31\u8fd9\u4e48\u7ed3\u675f\u4e86\uff0c\u5982\u679c\u5acc\u5b66\u7684\u4e0d\u591f\u7684\u53ef\u4ee5\u770b\u4e0b\u4e00\u8282\u3002\u81f3\u4e8e\u6709\u7684\u4eba\u95ee\u65e5\u5fd7\u4e3a\u4ec0\u4e48\u4e0d\u7528JSON\u6587\u4ef6\uff0c\u5176\u5b9e\u662f\u53ef\u4ee5\u7684\uff0c\u4e0d\u7528\u592a\u8fc7\u4e8e\u7ea0\u7ed3\u3002 \u5168\u90e8\u4ee3\u7801\u5730\u5740: https://github.com/wuranxu/pity \u89c9\u5f97\u6709\u7528\u7684\u8bdd\u53ef\u4ee5\u5e2e\u5fd9\u70b9\u4e2aStar\u54e6QAQ","title":"2.\u7ed9app\u6dfb\u52a0\u914d\u7f6e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2820%29%20%E7%BC%96%E5%86%99%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5%E6%8E%A5%E5%8F%A3%E5%92%8C%E9%A1%B5%E9%9D%A2%282%29/","text":"\u56de\u987e \u4e0a\u56de\u8bf4\u5230\uff0c\u7f16\u5199\u9879\u76ee\u6743\u9650\u76f8\u5173\u63a5\u53e3\uff0c\u4f46\u662f\u6211\u4eec\u53ea\u5b8c\u6210\u4e86\u6838\u5fc3\u65b9\u6cd5\u7684\u7f16\u5199\uff0c\u8fd9\u6b21\u6211\u4eec\u5c31\u6765\u5b9a\u4e49\u76f8\u5173\u7684\u63a5\u53e3\u3002 \u7f16\u5199\u63a5\u53e3 \u5148\u5b9e\u73b0 \u9879\u76ee \u7684\u67e5\u8be2\u548c\u65b0\u589e\u63a5\u53e3\uff0c\u63a5\u7740\u5b9e\u73b0\u9879\u76ee\u89d2\u8272\u7684\u6dfb\u52a0\u63a5\u53e3\u3002 \u7f16\u5199app/controllers/project/project.py from flask import Blueprint, request, jsonify from app import pity from app.dao.project.ProjectDao import ProjectDao from app.handler.fatcory import ResponseFactory from app.handler.page import PageHandler from app.utils.decorator import permission pr = Blueprint( \"project\" , __name__, url_prefix= \"/project\" ) @pr.route(\"/list\") @permission() def list_project (user_info) : \"\"\" \u83b7\u53d6\u9879\u76ee\u5217\u8868 :param user_info: :return: \"\"\" page, size = PageHandler.page() user_role, user_id = user_info[ \"role\" ], user_info[ \"id\" ] name = request.args.get( \"name\" ) result, total, err = ProjectDao.list_project(user_id, user_role, page, size, name) if err is not None : return jsonify(dict(code= 110 , data=result, msg=err)) return jsonify(dict(code= 0 , data=ResponseFactory.model_to_list(result), msg= \"\u64cd\u4f5c\u6210\u529f\" )) @pr.route(\"/insert\", methods=[\"POST\"]) @permission(pity.config.get(\"MANAGER\")) def insert_project (user_info) : try : user_id = user_info[ \"id\" ] data = request.get_json() if not data.get( \"name\" ) or not data.get( \"owner\" ): return jsonify(dict(code= 101 , msg= \"\u9879\u76ee\u540d\u79f0/\u9879\u76ee\u8d1f\u8d23\u4eba\u4e0d\u80fd\u4e3a\u7a7a\" )) private = data.get( \"private\" , False ) err = ProjectDao.add_project(data.get( \"name\" ), data.get( \"owner\" ), user_id, private) if err is not None : return jsonify(dict(code= 110 , msg=err)) return jsonify(dict(code= 0 , msg= \"\u64cd\u4f5c\u6210\u529f\" )) except Exception as e: return jsonify(dict(code= 111 , msg=str(e))) \u8fd9\u8fb9\u57fa\u672c\u4e0a\u5f88\u7b80\u5355\uff0c\u6d41\u7a0b\u5c31\u662f \u83b7\u53d6\u53c2\u6570->\u6821\u9a8c\u53c2\u6570->\u8c03\u7528\u65b9\u6cd5\uff0c\u83b7\u53d6\u8fd4\u56de\u7ed3\u679c\uff0c\u6210\u529f\u5931\u8d25\u8fd4\u56de\u4e0d\u540c\u7684 response . \u6ce8\u610f\u5230\u4ee3\u7801\u91cc\u9762\u6709\u4e00\u5904bug: \u641c\u7d22\u9879\u76ee\u65f6, \u8fd9\u91cc\u8fd4\u56de\u7684\u5e94\u8be5\u662f\u4e00\u4e2a\u6570\u7ec4\u800c\u4e0d\u662f0 \u628a\u84dd\u56fe\u52a0\u5165run.py \u6d4b\u8bd5\u4e00\u4e0b \u8fd9\u91cc\u6211\u4eec\u5148\u8c03\u7528\u4e86\u767b\u5f55\u63a5\u53e3\u62ff\u5230\u4e86token: \u53d1\u73b0\u62a5\u9519\u4e86 \u4ed4\u7ec6 \u67e5\u770b\u539f\u56e0 \uff0c\u53d1\u73b0\u662f\u8fd9\u91cc\u51fa\u4e86\u95ee\u9898: \u8fd9\u4e2a\u65b9\u6cd5\u5e94\u8be5\u67092\u4e2a\u8fd4\u56de\u503c\uff0c\u662f\u81ea\u5df1\u758f\u5ffd\u4e86 \u53ef\u4ee5\u770b\u5230\u5728\u7528Python\u5199\u591a\u4e2a\u8fd4\u56de\u503c\u7684\u65f6\u5019\uff0c\u4e00\u5b9a\u8981\u8bb0\u5f97\u8fd4\u56de\u591a\u5c11\u5c31\u7528\u591a\u5c11\uff0c\u4e0d\u7136IDE\u5e76\u4e0d\u4f1a \u7ed9\u51fa\u63d0\u793a \u3002\u8fd9\u4e5f\u662fPython\u7684\u4e00\u4e2a\u5c0f\u7f3a\u70b9\u5427\uff0c\u5f53\u7136\u5b83\u4e5f\u53ef\u4ee5\u6307\u5b9a\u8fd4\u56de\u7c7b\u578b\uff0c\u53ea\u4e0d\u8fc7\u6211\u89c9\u5f97\u590d\u6742\u4e86\u3002 \u505a\u51fa\u8fd9\u6837\u7684\u6539\u52a8\u5c31\u53ef\u4ee5\u4e86 \u7531\u4e8eerr\u662f\u6211\u4eec\u9884\u671f\u7684err\uff0c\u5e76\u4e14\u6211\u4eec\u6709\u505atry/except\u5904\u7406\uff0c\u6240\u4ee5\u6211\u4eec\u76f4\u63a5raise\uff0c \u629b\u51fa\u5f02\u5e38 \u5373\u53ef\u3002 \u518d\u6b21\u5c1d\u8bd5 \u6ce8\u610f\u6d4b\u8bd5\u7684\u63a5\u53e3\u662f\u5e26\u6709token\u4fe1\u606f\u7684\u54e6 \u6d4b\u8bd5\u6dfb\u52a0\u9879\u76ee\u63a5\u53e3 \u9664\u4e86token\u4ee5\u5916\u6211\u4eec\u9700\u89813\u4e2a\u6570\u636e: \u9879\u76ee\u540d\u5b57\u3001\u9879\u76ee\u7ba1\u7406\u5458\u3001\u9879\u76ee\u6743\u9650\u3002 \u8fd9\u8fb9\u6211\u76f4\u63a5\u5077\u61d2\uff0c\u53bb\u6570\u636e\u5e93\u67e5\u770b\u6709\u54ea\u4e9b\u7528\u6237: \u53ef\u4ee5\u770b\u5230user_id\u4ece1\u52304\u90fd\u6709\uff0c\u6211\u8fd9\u8fb9\u90094(\u674e\u900d\u9065)\u5f53\u505a\u6211\u8fd9\u4e2a\u6d4b\u8bd5\u9879\u76ee\u7684owner\u3002 \u53ef\u4ee5\u770b\u5230\u6ca1\u6709\u521b\u5efa\u6210\u529f\uff0c\u63d0\u793a\u6211 \u6743\u9650\u4e0d\u8db3 \u3002 \u8fd8\u8bb0\u5f97\u4e4b\u524d\u8bbe\u5b9a\u597d\u7684\u6743\u9650\u7cfb\u7edf\u5417\uff1f\u56e0\u4e3a\u6211\u628a\u8fd9\u4e2a\u63a5\u53e3\u7684\u6743\u9650\u8bbe\u7f6e\u4e3amanager\u4e5f\u5c31\u662f\u7ecf\u7406\u624d\u80fd\u521b\u5efa\u9879\u76ee\u3002\u6240\u4ee5\u5728\u6211\u4eec\u8fd8\u6ca1\u6709\u5b8c\u6210 \u7528\u6237\u7ba1\u7406 \u9875\u9762\u7684\u65f6\u5019\uff0c\u6211\u4eec\u5148\u5728\u6570\u636e\u5e93\u8f6f\u4ef6\u6216\u7528sql\u53bb\u624b\u52a8\u4fee\u6539: \u628arole\u6539\u4e3a2 \u5373\u8d85\u7ea7\u7ba1\u7406\u5458 \u63a5\u7740\u6211\u4eec\u9700\u8981\u91cd\u65b0\u767b\u5f55\uff0c\u83b7\u53d6\u65b0token\u3002 \u53ef\u80fd\u6709\u7684\u8bfb\u8005\u53d1\u73b0\u4e00\u4e2a\u95ee\u9898\uff0c\u8fd9\u6837\u5982\u679c\u6539\u52a8\u4e86\u7528\u6237\u7684\u6743\u9650\uff0c\u7528\u6237\u8fd8\u9700\u8981\u91cd\u65b0\u767b\u5f55\uff0c\u4e3a\u4ec0\u4e48\u4e0d\u80fd\u5728 \u89e3\u6790\u7528\u6237\u4fe1\u606f\u7684\u65f6\u5019\uff0c\u91cd\u65b0\u83b7\u53d6\u4e00\u904d\u7528\u6237\u4fe1\u606f\u5462 \uff1f\u8fd9\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u95ee\u9898\uff0c\u95ee\u5c31\u662f\u4e24\u8005\u90fd\u53ef\u4ee5\u5440\uff0c\u90fd\u6ca1\u6bdb\u75c5\u7684\u3002\u4f60\u751a\u81f3\u53ef\u4ee5\u628a\u7528\u6237\u4fe1\u606f\u7f13\u5b58\u5230redis\uff0c\u4e0d\u7528\u6bcf\u6b21\u90fd\u8bfbdb\u3002 \u91cd\u65b0\u6d4b\u8bd5 role\u53d8\u62102\u4e86 \u73b0\u5728\u63d0\u793a\u9879\u76ee\u5df2\u5b58\u5728 \u53ef\u4ee5\u770b\u5230\u6211\u4eec\u7684\u4ee3\u7801\u5199\u7684\u592a\u968f\u610f\uff0c\u5bfc\u81f4if\u5199\u9519\u4e86\uff0c\u4fee\u6b63\u5982\u4e0b: \u91cd\u542f\u670d\u52a1\u540e\u6d4b\u8bd5 \u53c8\u62a5\u9519\u4e86\uff0ccommit\u662f\u4e00\u4e2a\u4e0d\u63a5\u53d7\u53c2\u6570\u7684\u65b9\u6cd5\uff0c\u6240\u4ee5\u6211\u4eec\u76f4\u63a5\u53bb\u6389\u3002\u800c\u4e14\u8fd8\u6709\u4e00\u4e2a\u95ee\u9898\uff0c\u5c31\u662f\u8fd4\u56de\u503c\u6211\u662f\u590d\u5236\u7684\u4e0a\u4e00\u4e2a\u65b9\u6cd5\u7684\uff0c\u5bfc\u81f4\u591a\u4e862\u4e2a0\u3002\u6211\u4eec\u4e00\u5e76\u5904\u7406\u6389: \u518d\u6b21\u6d4b\u8bd5 \u6210\u529f \u901a\u8fc7project/list\u63a5\u53e3\u53bb\u67e5\u770b \u4e5f\u6210\u529f \u6240\u4ee5\u6211\u4eec\u7f16\u5199\u4ee3\u7801\u9700\u8981\u4ed4\u7ec6\u4e00\u70b9\uff0c\u5c31\u7b97\u662f\u590d\u5236/\u7c98\u8d34\u4e5f\u8981\u66f4 \u7ec6\u5fc3 \uff0c\u4e0d\u80fd\u50cf\u7b14\u8005\u4e00\u6837\u9a6c\u864e\uff01 \u540e\u7eed\u6d4b\u8bd5 \u5176\u5b9e\u6211\u4eec\u8fd9\u8fb9\u7684\u63a5\u53e3\u662f\u5206\u4e0d\u540c\u573a\u666f\u7684\uff0c\u4e0d\u540c\u7684\u89d2\u8272\u9700\u8981\u4e0d\u540c\u7684\u6d4b\u8bd5\u573a\u666f\uff0c\u6211\u4eec\u8fd9\u8fb9\u8bbe\u8ba1\u7528\u4f8b\u7684\u65f6\u5019\u8fd8\u9700\u8981\u8003\u8651\u666e\u901a\u7528\u6237\u7684\u9879\u76ee\u6743\u9650\u95ee\u9898\uff0c\u8fd9\u4e9b\u5c31\u7559\u7ed9\u8bfb\u8005\u8bfe\u540e\u53bb\u6d4b\u8bd5\u4e86\u3002 \u4eca\u5929\u7684\u5185\u5bb9\u5c31\u5230\u8fd9\u91cc\u4e86\uff0c\u53ea\u5199\u4e862\u4e2a\u63a5\u53e3\uff0c\u4e0b\u4e00\u7bc7\u5f00\u59cb\u7ee7\u7eed\u56de\u5230\u524d\u7aef\uff0c\u5199 \u76f8\u5173\u7684\u9875\u9762 \uff01\u5982\u679c\u89c9\u5f97\u6bcf\u7bc7\u7bc7\u5e45\u8f83\u77ed\u7684\u8bdd\uff0c\u53ef\u4ee5\u7ed9\u6211\u63d0\u5efa\u8bae\uff0c\u6211\u4e89\u53d6\u6ee1\u8db3\u5927\u5bb6~","title":"20.\u7f16\u5199\u9879\u76ee\u7684\u589e\u5220\u6539\u67e5\u63a5\u53e3\u548c\u9875\u9762(2)"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2821%29%20%E7%BC%96%E5%86%99%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5%E6%8E%A5%E5%8F%A3%E5%92%8C%E9%A1%B5%E9%9D%A2%283%29/","text":"\u56de\u987e \u4e0a\u56de\u6211\u4eec\u7f16\u5199\u597d\u4e86\u6dfb\u52a0\u9879\u76ee\u548c\u67e5\u8be2\u9879\u76ee2\u4e2a\u63a5\u53e3\uff0c\u90a3\u4eca\u5929\u6211\u4eec\u5c31\u628a\u5b83\u5e94\u7528\u5230\u9879\u76ee\u4e2d\u5427\uff01\u6240\u4ee5\u672c\u8282\u5185\u5bb9\u4f1a\u4ee5 \u524d\u7aef\u90e8\u5206 \u4e3a\u4e3b\uff0c\u76ee\u7684\u662f\u4e3a\u4e86\u8054\u8c03\u540e\u7aef\u7f16\u5199\u597d\u7684\u63a5\u53e3\uff0c\u5e76\u5728\u9875\u9762\u4e0a\u80fd\u591f\u7ed9\u7528\u6237\u4f7f\u7528\u3002 \u8c03\u6574\u9879\u76ee\u8868 \u662f\u8fd9\u6837\u7684\uff0c\u56e0\u4e3a\u6211\u4eec\u7684\u9879\u76ee\u6709\u5bf9\u5e94\u7684\u56fe\u7247\uff0c\u5e76\u4e14\u7f3a\u5c11 \u63cf\u8ff0\u5b57\u6bb5 \uff0c\u6240\u4ee5\u6211\u4eec\u8fd9\u91cc\u628a\u9879\u76ee\u8868\u8fdb\u884c\u4e00\u4e9b\u8c03\u6574\u3002 \u56fe\u7247\u5b57\u6bb5 \u63cf\u8ff0\u5b57\u6bb5 \u63cf\u8ff0\u5b57\u6bb5\u5f88\u597d\u8bf4\uff0c\u81f3\u4e8e\u56fe\u7247\u5b57\u6bb5\u5c31\u6bd4\u8f83\u9ebb\u70e6\u4e86\uff01\u5982\u679c\u5bf9\u4e8e \u5355\u8282\u70b9 \u90e8\u7f72\u7684\u5e94\u7528\uff0c\u56fe\u7247\u53ef\u4ee5\u653e\u5165\u7c7b\u4f3c static \u7684\u76ee\u5f55\u4e2d\uff0c\u4ee5xxx.jpg\u7684\u5f62\u5f0f\u5b58\u5728\u3002\u4f46\u662f\u5982\u679c\u6211\u4eec\u9700\u8981\u90e8\u7f72\u5230 \u591a\u53f0\u673a\u5668 \u7684\u8bdd\uff0c\u5047\u8bbe\u662f2\u53f0\u673a\u5668\uff0c\u7528\u6237\u4e0a\u4f20\u4e00\u6b21\u56fe\u7247\uff0c\u5176\u4e2d\u53ea\u6709\u4e00\u4e2a\u670d\u52a1\u63a5\u6536\u5230\u4e86\u56fe\u7247\u6587\u4ef6\uff0c\u90a3\u5c31\u4f1a\u5f88 \u9ebb\u70e6 \u3002 \u90a3\u4e48\u600e\u4e48\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u5462\uff1f \u5728\u4f01\u4e1a\u4e2d\uff0c\u4e00\u822c\u516c\u53f8\u4f1a\u6709oss(\u4e91\u5b58\u50a8)\u670d\u52a1\uff0c\u6bd4\u5982: \u963f\u91cc\u4e91oss \uff0c \u817e\u8baf\u4e91cos \uff0c\u8fd8\u6709\u4e03\u725b\u4e91\u7b49\u7b49\u3002\u6211\u4e4b\u524d\u592a\u76d1\u7684\u9879\u76ee\u7528\u7684\u5c31\u662f\u4e03\u725b\u4e91+\u81ea\u6709\u57df\u540d\uff0c\u7531\u4e8e\u6ca1\u7eed\u8d39\uff0c\u6240\u4ee5\u6211\u4eec\u6362\u4e00\u79cd\u7b80\u5355\u7684\u65b9\u5f0f: \u76f4\u63a5\u5728\u6570\u636e\u5e93\u52a0\u4e00\u4e2a TEXT \u5b57\u6bb5\uff0c\u5b58\u653e\u56fe\u7247\u7684base64\u6570\u636e\uff0c\u4f46\u662f\u6ce8\u610f\u5927\u5c0f\u4e00\u5b9a\u8981\u9650\u5236\uff0c\u7136\u540ehtml\u91cc\u9762\u901a\u8fc7img\u6807\u7b7e\u89e3\u6790\u6570\u636e\u5373\u53ef\u3002 \u7531\u4e8e\u9879\u76ee\u53ef\u80fd\u4e0d\u592a\u9700\u8981\u5934\u50cf\u8fd9\u79cd\u4e1c\u897f\uff0c\u4ee5\u540e\u8fd9\u79cd\u56fe\u7247\u7559\u5230\u4e2a\u4eba\u5934\u50cf\u4f1a\u6bd4\u8f83\u597d\u4e00\u70b9\uff0cantd\u63d0\u4f9b\u4e86\u6587\u5b57\u5934\u50cf\uff0c\u76f8\u4fe1\u5927\u5bb6\u7528\u8fc7\u9489\u9489\u7b49IM\u5de5\u5177\u7684\u90fd\u77e5\u9053\uff0c\u6709\u7684\u4eba\u5982\u679c\u6ca1\u6709\u5934\u50cf\u7684\u8bdd\uff0c\u4f1a\u7528\u540d\u5b57\u5f53\u5934\u50cf\u6bd4\u5982\"\u9e23\u4eba\"\u3002 \u6240\u4ee5\u6211\u4eec\u8fd9\u91cc\u5c31\u4e0d\u7528\u90a3\u4e48\u9ebb\u70e6\u4e86\uff0c\u76f4\u63a5\u53ea\u52a0\u4e00\u4e2a\u63cf\u8ff0\u5b57\u6bb5\u5c31\u597d\u4e86\uff01\u5934\u50cf\u7528\u9ed8\u8ba4\u7684\u5c31\u884c\uff01 \u8c03\u6574models/Project.py \u6dfb\u52a0\u63cf\u8ff0\u5b57\u6bb5 \u8c03\u6574ProjectDao.py \u8c03\u6574\u6dfb\u52a0\u9879\u76ee\u63a5\u53e3 \u628a \u63cf\u8ff0\u5b57\u6bb5 \u52a0\u8fdb\u53bb\u5373\u53ef\uff0c\u56e0\u4e3a\u8fd9\u4e2a\u5b57\u6bb5\u4e0d\u662f\u5fc5\u586b\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u7ed9\u4ed6\u4e00\u4e2a\u9ed8\u8ba4\u503c: \u7a7a\u5b57\u7b26\u4e32 \u6784\u601d\u9875\u9762 \u56de\u5fc6\u4e00\u4e0b\u6211\u4eec\u5f53\u65f6\u7f16\u5199postman\u9875\u9762\u7684\u65f6\u5019\uff0c\u6211\u4eec\u662f\u628a\u5bf9\u5e94\u7684\u7ec4\u4ef6\u5206\u5c42\u4e86\u3002\u7531\u4e8e\u6211\u4eec\u5f53\u65f6\u505apostman\u9875\u9762\u7684\u65f6\u5019\u662f\u6709\u6210\u54c1\u7ed9\u6211\u4eec\u53c2\u8003\u7684\uff0c\u4f46\u662f\u5173\u4e8e \u9879\u76ee\u7ba1\u7406\u9875\u9762 \uff0c\u6211\u4eec\u7684\u7684\u786e\u786e\u662f\u6ca1\u6709\u4efb\u4f55\u53c2\u8003\uff0c\u6240\u4ee5\u6211\u4eec\u5148\u8981\u5728\u8111\u6d77\u91cc\u6784\u601d\u4e00\u4e0b\u9875\u9762 \u5927\u6982\u957f\u4ec0\u4e48\u6837 \uff01 \u53c2\u8003Ant Design Pro\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u6709\u4e2a\u5927\u6982\u7684\u65b9\u5411\u4e86\uff01 \u91c7\u7528\u8fd9\u79cd \u5361\u7247\u5217\u8868 \uff0c\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u5c55\u793a\u9879\u76ee\u3002 \u5f15\u5165\u6eda\u52a8\u6761 \u8fbe\u5230\u8fd9\u6837\u7684\u6548\u679c\u5c31\u597d\u4e86 \u8fd9\u4e2a\u9875\u9762\u662f\u6211\u4ece\u4e4b\u524d\u4e00\u4e2a \u592a\u76d1 \u4e86\u7684\u9879\u76ee\u91cc\u9762\u62f7\u8d1d\u6765\u7684\uff0c\u4e3a\u4e86\u8282\u7ea6\u65f6\u95f4\u5c31\u7ee7\u7eed\u6cbf\u7528\u4e86\u3002 \u5b89\u88c5\u4f9d\u8d56 cnpm install nprogress --save \u5728src/utils/utils.js\u6dfb\u52a0\u65b9\u6cd5 import NProgress from 'nprogress' ; // \u5f15\u5165\u6837\u5f0f import 'nprogress/nprogress.css' export const process = async func => { NProgress.start(); await func(); NProgress.done(); }; \u8fd9\u6837\u5f53\u6211\u4eec\u9700\u8981\u5728\u67d0\u4e2a\u65b9\u6cd5\u6267\u884c\u4e4b\u524d\u52a0\u8f7d\u8fdb\u5ea6\u6761\u7684\u65f6\u5019\uff0c\u8c03\u7528process\u65b9\u6cd5\u5373\u53ef\u3002 \u9879\u76ee\u5361\u7247\u5217\u8868\u9875\u9762\u4ee3\u7801 \u5176\u5b9e react \u5e76\u4e0d\u662f\u4e00\u4e2a\u5f88\u590d\u6742\u7684\u6846\u67b6\uff0c\u53ef\u80fd\u5bf9\u4e8eJsx\u9700\u8981\u6709\u4e00\u5b9a\u7684\u4e86\u89e3\u3002 \u6211\u4eec\u7684\u7ec4\u4ef6\u90fd\u53ef\u4ee5\u7ec6\u5206\u62104\u4e2a\u90e8\u5206: \u5f15\u7528 \u5373\u5f15\u5165\u5176\u4ed6\u7ec4\u4ef6\u6216\u8005\u5e93 \u72b6\u6001\u7ba1\u7406 \u72b6\u6001\u662f\u4ec0\u4e48\u6982\u5ff5\u5462\uff0c\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u4f60\u9875\u9762\u6709\u4e2aloading\u7ec4\u4ef6\uff0c\u4ec0\u4e48\u65f6\u5019\u4ed6loading\uff0c\u4ec0\u4e48\u65f6\u5019\u7ed3\u675floading\uff0c\u4f60\u901a\u8fc7\u4ec0\u4e48\u6765\u5224\u65ad\u5b83\u662f\u5426loading\uff0c\u8fd9\u4e2a\u5224\u65ad\u7684\u53d8\u91cf\uff0c\u5c31\u53eb\u505a\u72b6\u6001\u3002 \u800c\u54b1\u4eec\u7684\u9875\u9762\u4e5f\u6709\u5f88\u591a\u5730\u65b9\u901a\u8fc7 \u72b6\u6001 \u6765\u5c55\u793a\uff0c\u6bd4\u5982\u6211\u4eec\u901a\u8fc7data(\u6570\u7ec4)\u6765\u5b58\u653e\u6211\u4eec\u7684\u9879\u76ee\u5217\u8868\uff0c\u521d\u59cb\u5316\u4e3a\u7a7a\u6570\u7ec4\u3002 \u5f53\u9875\u9762\u5f00\u59cb\u6e32\u67d3 \uff0c\u7ec4\u4ef6\u5f00\u59cb\u52a0\u8f7d\u7684\u65f6\u5019\uff0c\u6211\u4eec\u53d8\u53bb\u540e\u7aef\u670d\u52a1 \u62c9\u53d6\u6570\u636e \uff0c\u6539\u5199data\u6570\u7ec4\uff0c\u628a\u9879\u76ee\u7684\u4fe1\u606f\u653e\u5165\u5230\u6570\u7ec4\u91cc\u9762\u3002 \u6ce8\u610f\uff0c\u8fd9\u4e2a\u65f6\u5019\u72b6\u6001\u5c31\u53d1\u751f\u4e86\u53d8\u66f4\uff01react\u4f1a\u81ea\u52a8\u5bf9\u6bd4\u53d8\u66f4\u7684\u72b6\u6001\u6765\u6e32\u67d3\u65b0\u7684\u9875\u9762\uff0c\u8fd9\u91cc\u9762\u8fc7\u7a0b\u5f88\u590d\u6742\u3002\u5efa\u8bae\u53bb\u67e5\u9605react\u76f8\u5173\u8d44\u6599\uff0c\u7b14\u8005\u4e5f\u4e0d\u662f\u5f88\u719f\u6089\u91cc\u9762\u7684 \u7ec6\u8282 \uff0c\u60f3\u8981\u4e86\u89e3\u7684\u8bdd\uff0c\u53bb\u641c\u7d22 virtual dom \u3002 \u4ea4\u4e92\u65b9\u6cd5\u7684\u7f16\u5199 \u6211\u4eec\u6709\u5f88\u591a\u7ec4\u4ef6\u90fd\u6709\u6d89\u53ca\u5230\u4e00\u4e9b \u4ea4\u4e92\u65b9\u6cd5 \uff0c\u6bd4\u5982\u8bf4: \u70b9\u51fb\u67d0\u4e2a\u6309\u94ae\uff0c\u89e6\u53d1\u4ec0\u4e48\u4e8b\u4ef6\u3002\u8fd9\u4e9b\u90fd\u662f\u9700\u8981\u7f16\u5199\u65b9\u6cd5\u7684\uff0c\u6bd4\u5982\u4e0a\u56fe\u4e2d \u7528\u6237\u70b9\u51fb \u6dfb\u52a0\u9879\u76ee \uff0c\u6211\u4eec\u9700\u8981\u505a\u4ec0\u4e48\u5462\uff1f \u6211\u4eec\u9700\u8981\u628a\u5bf9\u8bdd\u6846\u663e\u793a\u51fa\u6765\u5bf9\u4e0d\u5bf9\uff1f\u6240\u4ee5\u6211\u4eec\u9700\u8981\u505a\u7684\u5c31\u662f: \u6539\u53d8\u5bf9\u8bdd\u6846\u7684\u72b6\u6001 \uff0c\u628a\u4ed6\u4ece\u9690\u85cf\u6539\u4e3a \u663e\u793a \u3002 \u7c7bHTML\u9875\u9762\u7684\u7f16\u5199 \u8fd9\u4e00\u6b65\u6bd4\u8f83\u7b80\u5355\u4e86\uff0c\u91c7\u7528jsx\u7684\u8bed\u6cd5\u53bb\u7f16\u5199html\u9875\u9762\u3002\u5927\u4f53\u4e0a\u548chtml\u90fd\u5dee\u4e0d\u591a\uff0c\u53ea\u4e0d\u8fc7\u8fd9\u8fb9\u53ef\u4ee5\u5199\u4e00\u4e9bjs\u4ee3\u7801\uff0c\u901a\u8fc7 {} \u5c31\u53ef\u4ee5\u5305\u88f9JS\u4ee3\u7801\uff0c\u76f8\u5bf9\u6765\u8bf4\u8fd8\u662f\u5f88\u65b9\u4fbf\u7684\uff01\u638c\u63e1\u4e86jsx\uff0ces6\uff0c\u57fa\u672c\u4e0areact\u4e0a\u624b\u5c31\u5f88\u5feb\u4e86\uff01 import React, { useEffect, useState } from 'react' ; import { PageContainer } from '@ant-design/pro-layout' ; import { Avatar, Button, Card, Col, Empty, Input, Popover, Row, Select, Spin, Tooltip } from 'antd' ; import { QuestionCircleOutlined } from '@ant-design/icons' ; import FormForModal from '@/components/PityForm/FormForModal' ; import { history } from 'umi' ; import { listProject } from '@/services/project' ; import auth from '@/utils/auth' ; import { process } from '@/utils/utils' ; const {Search} = Input; const {Option} = Select; export default () => { const [data, setData] = useState([]); const [pagination, setPagination] = useState({ current : 1 , pageSize : 10 , total : 0 }); const [visible, setVisible] = useState( false ); const [users, setUsers] = useState([]); const [userMap, setUserMap] = useState({}); useEffect( async () => { await process( async ()=> { const res = await listProject({ page : pagination.current, size : pagination.size}); if (auth.response(res)) { setData(res.data) setPagination({...pagination, total : res.total}) } }); }, []) const onSearchProject = projectName => { // this.props.dispatch({ // type: 'project/fetch', // payload: {page: 1, size: 1000, projectName} // }) } const onHandleModal = status => { setVisible(status); } const onHandleCreate = values => { // this.props.dispatch({ // type: 'project/insert', // payload: values, // }) } const content = ( item ) => { return < div > {/* < p > \u8d1f\u8d23\u4eba: {userMap[item.owner].name} </ p > */} {/* < p > \u7b80\u4ecb: {item.description || '\u65e0'} </ p > */} {/* < p > \u66f4\u65b0\u65f6\u95f4: {item.updateTime} </ p > */} </ div > }; const opt = < Select placeholder = \"\u8bf7\u9009\u62e9\u9879\u76ee\u7ec4\u957f\" > { users.map(item => < Option key = {item.value} value = {item.value} > {item.label} </ Option > ) } </ Select > const fields = [ { name : 'projectName' , label : '\u9879\u76ee\u540d\u79f0' , required : true , message : \"\u8bf7\u8f93\u5165\u9879\u76ee\u540d\u79f0\" , type : 'input' , placeholder : \"\u8bf7\u8f93\u5165\u9879\u76ee\u540d\u79f0\" , }, { name : 'owner' , label : '\u9879\u76ee\u8d1f\u8d23\u4eba' , required : true , component : opt, type : 'select' , }, { name : 'description' , label : '\u9879\u76ee\u63cf\u8ff0' , required : false , message : \"\u8bf7\u8f93\u5165\u9879\u76ee\u63cf\u8ff0\" , type : 'textarea' , placeholder : \"\u8bf7\u8f93\u5165\u9879\u76ee\u63cf\u8ff0\" , }, { name : 'private' , label : '\u662f\u5426\u79c1\u6709' , required : true , message : \"\u8bf7\u9009\u62e9\u9879\u76ee\u662f\u5426\u79c1\u6709\" , type : 'switch' , valuePropName : \"checked\" , }, ] return ( < PageContainer title = {false} > < FormForModal width = {600} title = \"\u6dfb\u52a0\u9879\u76ee\" left = {6} right = {18} record = {{}} visible = {visible} onCancel = {() => { onHandleModal(false) }} fields={fields} onFinish={onHandleCreate} /> < Row gutter = {8} style = {{marginBottom: 16 }}> < Col span = {18} > < Button type = \"primary\" onClick = {() => { onHandleModal(true) }}>\u521b\u5efa\u9879\u76ee < Tooltip title = \"\u53ea\u6709\u8d85\u7ea7\u7ba1\u7406\u5458\u53ef\u4ee5\u521b\u5efa\u9879\u76ee\" > < QuestionCircleOutlined /> </ Tooltip > </ Button > </ Col > < Col span = {6} > < Search onSearch = {onSearchProject} style = {{float: ' right '}} placeholder = \"\u8bf7\u8f93\u5165\u9879\u76ee\u540d\u79f0\" /> </ Col > </ Row > < Spin spinning = {false} > < Row gutter = {16} > { data.length === 0 ? < Col span = {24} style = {{textAlign: ' center ', marginBottom: 12 }}> < Card > < Empty description = \"\u6682\u65e0\u9879\u76ee, \u5feb\u70b9\u51fb\u300e\u521b\u5efa\u9879\u76ee\u300f\u521b\u5efa\u4e00\u4e2a\u5427!\" /> </ Card > </ Col > : data.map(item => < Col span = {4} style = {{marginBottom: 12 }}> < Popover content = {content(item)} placement = \"rightTop\" > < Card hoverable bordered = {false} style = {{borderRadius: 16 , textAlign: ' center '}} bodyStyle = {{padding: 16 }} onClick = {() => { history.push(`/project/${item.id}`); }}> < Avatar style = {{backgroundColor: '# 87d068 '}} size = {64} > {item.name.slice(0, 2)} </ Avatar > < p style = {{ textAlign: ' center ', fontWeight: ' bold ', fontSize: 18 , marginTop: 8 }}> {item.name} </ p > </ Card > </ Popover > </ Col > ) } </ Row > </ Spin > </ PageContainer > ) } \u5148\u5927\u81f4\u7785\u7785\u8fd9\u6bb5\u4ee3\u7801\uff0c\u540e\u7eed\u7b14\u8005\u4f1a\u8ddf\u8fdb\u8bb2\u89e3\u3002\u4eca\u5929\u5185\u5bb9\u5c31\u5230\u8fd9\u91cc\u5427~\ud83d\ude01","title":"21.\u7f16\u5199\u9879\u76ee\u7684\u589e\u5220\u6539\u67e5\u63a5\u53e3\u548c\u9875\u9762(3)"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2822%29%20%E7%BC%96%E5%86%99%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5%E6%8E%A5%E5%8F%A3%E5%92%8C%E9%A1%B5%E9%9D%A2%284%29/","text":"\u95f2\u804a \u672c\u6765\u6253\u7b97\u81ea\u5df1\u8bb0\u5f55\u603b\u7ed3\u4e00\u4e0b\u81ea\u5df1\u8fd9\u51e0\u5e74\u7684\u4e00\u4e2a \u5de5\u4f5c\u5185\u5bb9 \uff0c\u4e5f\u6ca1\u60f3\u8fc7\u53bb\u5927\u529b\u5ba3\u4f20\u5565\u7684\uff0c\u56e0\u4e3a\u603b\u89c9\u5f97\u6587\u7ae0\u6570\u91cf\u6709\u9650\uff0c\u4e5f\u6015\u968f\u65f6\u5c31\u4f1a \u65ad\u66f4 \u3002\u4eca\u5929\u88ab \u996d\u54e5 \u7684\u6307\u70b9\u4e86\u4e00\u4e9b\uff0c\u4e5f\u60f3\u901a\u4e86\u3002\u4e5f\u8bb8\u4e4b\u524d\u65ad\u66f4\u90fd\u662f\u6ca1\u6709\u592a\u591a\u52a8\u529b\u5427\uff0c\u5982\u679c\u6709\u4eba\u770b\u7684\u8bdd\uff0c\u4e5f\u4f1a\u88ab\u52a8\u66f4\u65b0\u7684\u3002 \u81ea\u5df1\u4e00\u76f4\u90fd\u4e0d\u662f\u5f88\u81ea\u4fe1\u5427\uff0c\u56e0\u4e3a\u786e\u5b9e\u89c1\u8bc6\u8fc7\u5f88\u591a \u5927\u795e\u7ea7\u522b \u7684\u4eba\u7269\u3002\u6bd4\u5982 \u5927\u5e08\u5144 \uff0c \u996d\u54e5 \uff0c \u9732\u9732\u54e5 \u7b49\u7b49\u3002\u672c\u6765\u4e5f\u89c9\u5f97\u6587\u7ae0\u53ef\u80fd \u53d7\u4f17\u9762 \u662f\u6ca1\u6709\u76f8\u5173\u7ecf\u9a8c\u7684\u8bfb\u8005\uff0c\u5e0c\u671b\u5927\u4f6c\u4eec\u770b\u5230\u6587\u7ae0\u7684\u9519\u8bef\u53ef\u4ee5\u53ca\u65f6\u6307\u51fa\u5440\uff0c\u6211\u5c06\u7ee7\u7eed \u865a\u5fc3\u5b66\u4e60\uff08\u5e26\u5934\u51b2\u950b\uff09 ~ \u996d\u54e5 \u7684\u516c\u4f17\u53f7: \u6d4b\u8bd5\u5f00\u53d1\u5e72\u8d27 (\u5206\u4eab\u6d4b\u8bd5\u5f00\u53d1\u7684\u4e00\u5207\u5e72\u8d27\uff0c\u641c\u7d22\u6d4b\u8bd5\u5f00\u53d1\uff0c\u7b2c\u4e00\u6761\u5c31\u662f) \u699c\u4e00\u5927\u54e5\u8d6b\u8d6b \uff08\u4e00\u4e2a\u59cb\u7ec8\u5728\u52aa\u529b\u7684\u4eba\uff09\u7684\u516c\u4f17\u53f7: \u6d4b\u8bd5\u5f00\u53d1\u6c34\u8d27 \u770b\u540d\u5b57\u4e5f\u77e5\u9053\u662f\u5206\u4eab\u6210\u957f\u7ecf\u9a8c \u56de\u987e \u4e0a\u4e00\u8282\u5df2\u7ecf\u8d34\u51fa\u4e86 \u9879\u76ee\u5217\u8868 \u9875\u9762\u7684\u5168\u90e8\u524d\u7aef\u4ee3\u7801\uff0c\u7531\u4e8e\u7b14\u8005\u524d\u7aef\u4e5f\u6ca1\u6709\u6df1\u5165\u5b66\u4e60\uff0c\u6240\u4ee5\u53ea\u80fd\u7ed9\u5927\u5bb6\u5927\u6982\u8bb2\u89e3\u4e00\u4e0b\u5427\u3002\u8fd8\u662f\u6309\u7167\u4e4b\u524d\u7684\u51e0\u4e2a\u90e8\u5206\u6765\u8bf4\u5427\uff01 \u72b6\u6001\u7ba1\u7406 \u8bbe\u7f6e\u4e86\u5982\u4e0b\u53d8\u91cf: data \u5b58\u653e\u5f53\u524d\u9879\u76ee\u6570\u7ec4 pagination \u9879\u76ee\u5206\u9875 visible \u521b\u5efa\u9879\u76ee\u8868\u5355\u662f\u5426\u53ef\u89c1\uff0c\u9ed8\u8ba4\u662f\u5426 users \u7531\u4e8e\u6211\u4eec\u9700\u8981\u9009\u62e9 \u9879\u76ee\u7ba1\u7406\u5458 \uff0c\u6240\u4ee5\u9700\u8981\u4e00\u4e2auserId => \u7528\u6237\u4fe1\u606f\u7684\u6620\u5c04\u3002\u5f53\u7136\u8fd9\u4e2a\u63a5\u53e3\u6211\u4eec\u6682\u65f6\u8fd8\u6ca1\u6709\u5b9e\u73b0\u3002 \u65b9\u6cd5\u7f16\u5199 const fetchData = async (current=pagination.current, size=pagination.size) => { await process( async ()=> { const res = await listProject({ page : current, size }); if (auth.response(res)) { setData(res.data) setPagination({...pagination, total : res.total}) } }); } \u8fd9\u4e2a\u65b9\u6cd5\u662f\u83b7\u53d6\u9879\u76ee\u5217\u8868\u7684\u65b9\u6cd5\uff0ccurrent\u4ee3\u8868page\uff0csize\u4ee3\u8868\u5206\u9875\u5927\u5c0f\uff0c\u5982\u679c\u4e0d\u4f20\u5165\u5219\u662fpagination\u9ed8\u8ba4\u7684\u503c\u3002 listProject \u5176\u5b9e\u5c31\u662f\u5305\u88c5\u7684request\u65b9\u6cd5\uff0c\u8bf7\u6c42\u540e\u7aef\u670d\u52a1\u3002 useEffect( async () => { await fetchData(); }, []) const onSearchProject = async projectName => { await process( async ()=> { const res = await listProject({ page : 1 , size : pagination.size, name : projectName}); if (auth.response(res)) { setData(res.data) setPagination({...pagination, current : 1 , total : res.total}) } }); } useEffect \u662f react \u65b0\u7248\u672c\u7684\u7279\u6027\uff0c\u5b83\u652f\u63012\u4e2a\u53c2\u6570\uff0c\u7b2c\u4e00\u4e2a\u662f\u65b9\u6cd5\uff0c\u7b2c\u4e8c\u4e2a\u662f\u53d8\u91cf\u6570\u7ec4\uff0c\u4f20\u5165\u7a7a\u6570\u7ec4\u7684\u8bdd\uff0c\u5219\u6bcf\u6b21\u8fd9\u4e2a\u7ec4\u4ef6\u5f00\u59cb \u6e32\u67d3 \u7684\u65f6\u5019\u4f1a\u8c03\u7528\u4e14\u53ea\u8c03\u7528\u4e00\u6b21\u65b9\u6cd5\u3002 \u6211\u4eec\u5982\u679c\u6b63\u5f0f\u4f7f\u7528\u7684\u8bdd\uff0c\u662f\u4f1a\u6709\u591a\u5957\u6d4b\u8bd5\u73af\u5883\u7684\u3002\u5982\u679c\u6211\u4eec\u5bf9\u9879\u76ee\u505a\u4e86 \u73af\u5883 \u7684\u533a\u5206\uff0c\u90a3\u4e48\u5c31\u5e94\u8be5\u5728\u5207\u6362 \u73af\u5883 \u7684\u65f6\u5019\uff0c\u83b7\u53d6\u4e0d\u540c\u73af\u5883\u7684\u9879\u76ee\u3002 \u5047\u8bbe\u6211\u4eec\u9700\u8981\u5b9e\u73b0\u8fd9\u79cd\u529f\u80fd\uff0c\u90a3\u4e48\u6211\u4eec\u5148\u521b\u5efa\u4e00\u4e2a env \u7684\u53d8\u91cf\uff0c\u7136\u540e\u6539\u5199useEffect: useEffect( async () => { await fetchData(); }, [env]) \u8fd9\u6837\u7684\u8bdd\uff0c\u6bcf\u5f53env\u53d1\u751f\u53d8\u5316\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u5c31\u4f1a\u81ea\u52a8\u6267\u884c\u4e00\u6b21\u3002\u9700\u8981\u8bf4\u660e\u7684\u662f\uff0c\u8fd9\u91cc\u53ea\u662f \u4ecb\u7ecd\u4e00\u4e0buseEffect\u7684\u4f7f\u7528\u65b9\u5f0f\uff0c\u56e0\u4e3a\u6211\u4eec\u8fd9\u8fb9\u6682\u65f6\u8fd8\u6ca1\u6709\u6269\u5c55\u5230\u591a\u5957\u73af\u5883\uff0c\u6240\u4ee5\u6b64\u5904\u6211\u4eec\u9009\u62e9[]\u5373\u53ef \u3002 const onHandleCreate = async values => { const res = await insertProject(values); if (auth.response(res, true )) { // \u521b\u5efa\u6210\u529f\u540e\u81ea\u52a8\u83b7\u53d6\u7b2c\u4e00\u9875\u7684\u6570\u636e, \u56e0\u4e3a\u9879\u76ee\u4f1a\u6309\u521b\u5efa\u65f6\u95f4\u6392\u5e8f await fetchData( 1 ); } } \u8fd9\u8fb9\u4e5f\u5982\u51fa\u4e00\u8f99\uff0c\u521b\u5efa\u5b8c\u6bd5\u4e86\u4e4b\u540e\u5982\u679c\u63a5\u53e3\u672a\u8fd4\u56de\u9519\u8bef\uff0c\u5219\u5237\u65b0\u9879\u76ee\u5217\u8868\u9875\u9762\uff0c\u5e76\u4e14\u81ea\u52a8\u53bb \u7b2c\u4e00\u9875 \u3002 const content = ( item ) => { return < div > {/* < p > \u8d1f\u8d23\u4eba: {userMap[item.owner].name} </ p > */} < p > \u7b80\u4ecb: {item.description || '\u65e0'} </ p > < p > \u66f4\u65b0\u65f6\u95f4: {item.updated_at} </ p > </ div > }; const opt = < Select placeholder = \"\u8bf7\u9009\u62e9\u9879\u76ee\u8d1f\u8d23\u4eba\" > { Object.keys(users).map(id => < Option key = {id} value = {id} > {users[id].name} </ Option > ) } </ Select > const fields = [ { name : 'projectName' , label : '\u9879\u76ee\u540d\u79f0' , required : true , message : \"\u8bf7\u8f93\u5165\u9879\u76ee\u540d\u79f0\" , type : 'input' , placeholder : \"\u8bf7\u8f93\u5165\u9879\u76ee\u540d\u79f0\" , }, { name : 'owner' , label : '\u9879\u76ee\u8d1f\u8d23\u4eba' , required : true , component : opt, type : 'select' , }, { name : 'description' , label : '\u9879\u76ee\u63cf\u8ff0' , required : false , message : \"\u8bf7\u8f93\u5165\u9879\u76ee\u63cf\u8ff0\" , type : 'textarea' , placeholder : \"\u8bf7\u8f93\u5165\u9879\u76ee\u63cf\u8ff0\" , }, { name : 'private' , label : '\u662f\u5426\u79c1\u6709' , required : true , message : \"\u8bf7\u9009\u62e9\u9879\u76ee\u662f\u5426\u79c1\u6709\" , type : 'switch' , valuePropName : \"checked\" , }, ] \u8fd9\u91cc content \u662f\u4e00\u4e2a\u65b9\u6cd5\uff0c\u4f1a\u8fd4\u56de\u4e00\u4e2adiv\u7684html\u7ed3\u6784\uff0c\u76ee\u7684\u662f\u4e3a\u4e86\u5c55\u793a\u9879\u76ee\u7684\u8be6\u60c5\uff0c\u6bd4\u5982 \u8d1f\u8d23\u4eba \uff0c \u9879\u76ee\u63cf\u8ff0 \u7b49\u3002 fields\u7684\u8bdd\uff0c\u662f\u8868\u5355\u7684\u5b57\u6bb5\uff0c\u56e0\u4e3a\u6211\u9488\u5bf9 antd \u7684form\u8fdb\u884c\u4e86\u4e00\u70b9\u5c01\u88c5\uff0c\u7f16\u5199\u4e86\u4e00\u5957\u9ad8\u9636\u7ec4\u4ef6\u3002\u7b49\u4e8e\u8bf4\u662f \u89c4\u5212\u597d\u4e86\u8868\u5355\u91cc\u9762\u7684\u8868\u5355\u7ec4\u6210\uff0c\u7531input\u548cselect\u4ee5\u53caswitch\u7ec4\u4ef6\u7ec4\u6210 \u3002 \u5f85\u4f1a\u4f1a\u8bb2\u8fd9\u4e2a\u7ec4\u4ef6\uff01 \u6700\u540e\u770breturn\u91cc\u9762\u7684\u7ec4\u4ef6 return ( < PageContainer title = {false} > < FormForModal width = {600} title = \"\u6dfb\u52a0\u9879\u76ee\" left = {6} right = {18} record = {{}} visible = {visible} onCancel = {() => setVisible(false)} fields={fields} onFinish={onHandleCreate} /> < Row gutter = {8} style = {{marginBottom: 16 }}> < Col span = {18} > < Button type = \"primary\" onClick = {() => setVisible(true)}>\u521b\u5efa\u9879\u76ee < Tooltip title = \"\u53ea\u6709\u8d85\u7ea7\u7ba1\u7406\u5458\u53ef\u4ee5\u521b\u5efa\u9879\u76ee\" > < QuestionCircleOutlined /> </ Tooltip > </ Button > </ Col > < Col span = {6} > < Search onSearch = {onSearchProject} style = {{float: ' right '}} placeholder = \"\u8bf7\u8f93\u5165\u9879\u76ee\u540d\u79f0\" /> </ Col > </ Row > < Spin spinning = {false} > < Row gutter = {16} > { data.length === 0 ? < Col span = {24} style = {{textAlign: ' center ', marginBottom: 12 }}> < Card > < Empty description = \"\u6682\u65e0\u9879\u76ee, \u5feb\u70b9\u51fb\u300e\u521b\u5efa\u9879\u76ee\u300f\u521b\u5efa\u4e00\u4e2a\u5427!\" /> </ Card > </ Col > : data.map(item => < Col key = {item.id} span = {4} style = {{marginBottom: 12 }}> < Popover content = {content(item)} placement = \"rightTop\" > < Card hoverable bordered = {false} style = {{borderRadius: 16 , textAlign: ' center '}} bodyStyle = {{padding: 16 }} onClick = {() => { history.push(`/project/${item.id}`); }}> < Avatar style = {{backgroundColor: '# 87d068 '}} size = {64} > {item.name.slice(0, 2)} </ Avatar > < p style = {{ textAlign: ' center ', fontWeight: ' bold ', fontSize: 18 , marginTop: 8 }}> {item.name} </ p > </ Card > </ Popover > </ Col > ) } </ Row > </ Spin > </ PageContainer > ) } PageContainer \u662f\u6700\u5916\u5c42\uff0c\u4e5f\u5c31\u662f\u54b1\u4eec\u770b\u5230\u7684\u8fd9\u4e00\u5757: FormForModal \u662f\u4e00\u4e2a\u5bf9\u8bdd\u6846\u8868\u5355\uff0c\u9ed8\u8ba4\u662f\u4e0d\u663e\u793a\u7684\uff0c\u53ea\u6709\u70b9\u51fb \u521b\u5efa\u9879\u76ee \u624d\u4f1a\u663e\u793a\u3002 \u7136\u540e\u7528Row\u5206\u4e862\u884c: \u5206\u522b\u662f \u521b\u5efa\u680f/\u641c\u7d22\u680f\u548c\u9879\u76ee\u5c55\u793a\u680f \u8fd9\u8fb9\u9879\u76ee\u5c55\u793a\u680f\u5982\u679c data.length === 0 \u5c31\u5c55\u793a\u4e00\u4e2a\u7a7a\u72b6\u6001\uff0c\u63d0\u793a\u7528\u6237\u53bb\u6dfb\u52a0\u9879\u76ee\uff0c\u5426\u5219\u5c31\u628a\u9879\u76ee\u5c55\u793a\u51fa\u6765\uff0c\u6bcf\u4e2a\u9879\u76ee\u5360\u5c4f\u5e55\u76841/6\uff0c\u56e0\u4e3aCol\u603b\u5171\u670924\u4efd\u3002 tips: \u8fd9\u91cc\u7c7b\u4f3c\u4e8ebootstrap\uff0c\u4e00\u884c\u5171\u670924\u4efd\uff0c\u6240\u4ee5span={4}\u4ee3\u8868\u7684\u662f4/24\uff0c\u53ef\u53c2\u8003: \u5b98\u7f51\u4ecb\u7ecd \u5176\u4ed6\u7684\u5c31\u662f Card \uff08\u5361\u7247\uff09\u7ec4\u4ef6\u548c Avatar \uff08\u5934\u50cf\uff09\u7ec4\u4ef6\u7684\u4e92\u76f8\u5d4c\u5165\uff0c Popover \u662f\u60ac\u6d6e\u7a97\u53e3\uff0c\u5982\u56fe: \u7f16\u5199\u83b7\u53d6\u7528\u6237\u5217\u8868\u7684\u63a5\u53e3 \u4fee\u6539app/dao/auth/UserDao.py \u7b5b\u9009\u51fa\u672a\u88ab\u5220\u9664\u7684\u7528\u6237\u5373\u53ef\u3002 \u4fee\u6539app/controllers/auth/user.py \u8fd9\u91cc\u6ce8\u610f\u5f00\u542f\u4e00\u4e0b\u6743\u9650\uff0c\u4f46\u662f\u4e0d\u80fd\u63a7\u5236\u592a\u6b7b\uff0c\u80fd\u8ba9\u767b\u5f55\u7528\u6237\u8bbf\u95ee\u5373\u53ef\u3002 \u524d\u7aef\u9875\u9762\u7f16\u5199listUsers\u65b9\u6cd5 \u770b\u4e0b\u6548\u679c \u53d1\u73b0\u4e00\u4e2a\u95ee\u9898: \u521b\u5efa\u6210\u529f\u540e\uff0c\u5bf9\u8bdd\u6846\u6ca1\u6709\u5173\u95ed \u6240\u4ee5\u6211\u4eec\u9700\u8981\u5728\u521b\u5efa\u6210\u679c\u540e\uff0c setVisible(false) \u53bb\u5173\u95ed\u5bf9\u8bdd\u6846\u3002 \u8fd8\u6709\u4e00\u4e2a\u5730\u65b9\u5c31\u662f \u4e4b\u524d\u6ce8\u91ca\u6389\u7684\u9879\u76ee\u8d1f\u8d23\u4eba\uff0c\u73b0\u5728\u53ef\u4ee5\u91cd\u65b0\u5f00\u542f\u4e86\u3002 \u770b\u4e0b\u641c\u7d22\u6548\u679c \u8fd9\u5c31\u662f\u672c\u8282\u7684\u5185\u5bb9\u4e86\uff0c\u5927\u90e8\u5206\u662f\u8bb2\u89e3\u4ee3\u7801\u4e3a\u4e3b\uff0c\u56e0\u4e3a \u524d\u7aef\u5185\u5bb9\u5c45\u591a \uff0c\u6240\u4ee5\u53ef\u80fd\u6709\u70b9\u61f5\u903c\u3002\u5982\u679c\u6709\u4e0d\u7406\u89e3\u7684\u5730\u65b9\uff0c\u8fd8\u8bf7\u591a\u591a\u770b\u770b react \u548c es6 \u76f8\u5173\u7684\u6559\u7a0b\u3002\u7bad\u5934\u51fd\u6570\uff0c\u770b\u7740\u522b\u6015\uff0c\u719f\u6089\u4e86\u5c31\u597d\u3002 \u4e0b\u4e00\u8282\u53ef\u80fd\u662f\u5177\u4f53\u9879\u76ee\u7684\u7f16\u8f91\u9875\u9762\u4e86\uff0c\u611f\u89c9\u8fd9\u4e00\u8bb2\u5c31\u8bb2\u4e86\u4e00\u4e2a\u4e16\u7eaa\uff0c\u518d\u540e\u9762\u5c31\u662f\u7528\u4f8b\u90a3\u5757\u4e86\u3002","title":"22.\u7f16\u5199\u9879\u76ee\u7684\u589e\u5220\u6539\u67e5\u63a5\u53e3\u548c\u9875\u9762(4)"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2823%29%20%E7%BC%96%E5%86%99%E9%A1%B9%E7%9B%AE%E8%AF%A6%E6%83%85%E9%A1%B5%E9%9D%A2/","text":"\u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u4ee5\u7f16\u5199 \u9879\u76ee\u5217\u8868 \u4e3a\u4f8b\u5b50\uff0c\u8bb2\u89e3\u4e86\u4e00\u4e2a\u76f8\u5bf9\u5b8c\u6574\u7684demo\uff0c\u5176\u5b9e\u53ea\u5b8c\u6210\u4e86 \u67e5\u8be2 \u548c \u65b0\u589e \u7684\u529f\u80fd\uff0c\u7531\u4e8e\u7bc7\u5e45\u548c\u65f6\u95f4\u7684\u5173\u7cfb\uff0c\u8fd9\u4e9b\u7b14\u8005\u90fd\u4f1a\u8865\u5168\uff0c\u4f46\u662f\u53ef\u80fd\u4e0d\u4f1a\u5b8c\u5168\u8bb2\u89e3\uff0c\u6240\u4ee5\u5927\u5bb6\u53ef\u4ee5\u5bf9\u7167\u4ee3\u7801\u67e5\u770b\u5bf9\u5e94\u7684\u4ee3\u7801\u6a21\u5757\u3002 \u8fd9\u4e00\u8282\u6211\u4eec\u5f00\u59cb\u8bbe\u8ba1\u9879\u76ee\u7684\u8be6\u60c5\u9875\u9762\u3002 \u8bbe\u8ba1\u9879\u76ee\u9875\u9762 \u5728 \u9879\u76ee\u5217\u8868 \u9875\u9762\uff0c\u6211\u4eec\u53ea\u80fd\u770b\u5230\u9879\u76ee\u7684\u7f29\u7565\uff0c\u5982\u679c\u6211\u4eec\u70b9\u8fdb\u53bb\u9879\u76ee\u7684\u8bdd\uff0c\u662f\u9700\u8981\u80fd\u591f\u770b\u5230\u8fd9\u4e2a\u9879\u76ee\u7684\u5177\u4f53\u4fe1\u606f\u7684\u3002\u6240\u4ee5\u6211\u4eec\u8bbe\u8ba1 \u4e09\u4e2a\u677f\u5757 \uff0c\u4ee5tab\u7684\u5f62\u5f0f\u5c55\u793a: \u7528\u4f8b\u6811 \u6210\u5458\u5217\u8868 \u9879\u76ee\u8bbe\u7f6e \u8bbe\u8ba1\u7528\u4f8b\u8def\u7531 \u5728antd pro\u91cc\u9762\u652f\u6301\u53c2\u6570\u8def\u7531\uff0c\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u6211\u4eec\u9488\u5bf9\u4e0d\u540c\u7684\u9879\u76ee\u8981\u5c55\u793a\u4e0d\u540c\u7684\u5185\u5bb9\uff0c\u8fd9\u91cc\u5c31\u8981\u7528\u5230\u53c2\u6570\u8def\u7531\u4e86\u3002\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5f53\u9879\u76eeid\u662f1\u7684\u65f6\u5019\uff0c\u6211\u7684\u8def\u7531\u53ef\u80fd\u662f /project/1 \u914d\u7f6econfig/routes.js \u6211\u4eec\u521b\u5efa\u4e86\u8fd9\u6837\u4e00\u4e2a\u53c2\u6570\u8def\u7531\uff0c\u5e76\u628a hideInMenu \u8bbe\u7f6e\u4e3atrue\uff0c\u4e5f\u5c31\u662f\u8bf4\u4e0d\u663e\u793a\u4e8e\u5de6\u4fa7\u83dc\u5355\u680f\u3002\u540c\u65f6\uff0c\u8fd9\u4e2a\u8def\u7531\u5bf9\u5e94\u7684\u662f ProjectDetail \u7ec4\u4ef6\u3002 \u7f16\u5199\u540e\u7aef\u63a5\u53e3 \u6211\u4eec\u76ee\u524d\u53ea\u6709\u4e00\u4e2a\u67e5\u8be2 \u9879\u76ee\u5217\u8868 \u7684\u63a5\u53e3\uff0c\u4f46\u662f\u6211\u4eec\u73b0\u5728\u662f\u6ca1\u6709\u7528\u4f8b\u6811\u7684\uff0c\u6240\u4ee5\u6682\u65f6\u8fd9\u4e2a\u9879\u76ee\u53ea\u83b7\u53d6\u5230\u9879\u76ee\u4fe1\u606f\u548c\u9879\u76ee\u89d2\u8272\u3002 ProjectRoleDao.py\u4e2d\u65b0\u589elist_role\u65b9\u6cd5 \u901a\u8fc7project_id\u53bb\u83b7\u53d6 \u8fd9\u4e2a\u9879\u76ee\u7684\u6240\u6709\u89d2\u8272\u5217\u8868 \u3002 ProjectDao.py\u4e2d\u65b0\u589equery_project\u65b9\u6cd5 \u5148\u83b7\u53d6\u5230 \u9879\u76ee\u8be6\u60c5 \uff0c\u7136\u540e\u83b7\u53d6\u9879\u76ee\u89d2\u8272\uff0c\u8fd9\u8fb9\u7684\u8bdd\u7b14\u8005\u662f\u6ca1\u6709\u7528join\u6216\u8005\u5b50\u67e5\u8be2\u7684\uff0c\u56e0\u4e3a\u611f\u89c9sqlalchemy\u7528\u8d77\u6765\u4e0d\u662f\u5f88\u65b9\u4fbf\uff0c\u5927\u5bb6\u4e5f\u53ef\u4ee5 \u81ea\u7531\u53d1\u6325 \u3002 \u6ce8\u610f\uff0c\u7b14\u8005\u4f1a\u8fd4\u56de\u5f88\u591aerr\u6216\u8005None( \u56e0\u4e3a\u53ef\u80fd\u53d7\u5230\u4e86go\u5199\u6cd5\u7684\u5f71\u54cd\uff0c\u8fd9\u91cc\u5927\u5bb6\u53ef\u4ee5\u81ea\u5df1\u6309\u7167\u81ea\u5df1\u7684\u65b9\u5f0f\u53bb\u5199 ) \u7f16\u5199/project/query\u63a5\u53e3 \u8fd9\u90e8\u5f88\u7b80\u5355\uff0c\u8001\u89c4\u77e9\u5148\u6302\u4e0a\u6743\u9650\u548c\u8def\u7531\u7684\u88c5\u9970\u5668\uff0c\u63a5\u7740\u5bf9project_id\u8fdb\u884c \u53c2\u6570\u68c0\u67e5 \uff0c\u7136\u540e\u751f\u6210\u4e00\u4e2a\u7a7a\u7684dict\uff0c\u628arole\u548cproject\u4fe1\u606f\u67e5\u8be2\u51fa\u6765\u4ee5\u540e\u5199\u5165result\u3002 \u7f16\u5199\u9875\u9762\u90e8\u5206 \u5148\u770b\u4e0b\u5927\u81f4\u6548\u679c: \u8fd9\u8fb9\u5206\u4e863\u4e2atab\uff0c\u7b2c\u4e00\u4e2a\u662f\u7528\u4f8b\u5217\u8868\uff0c\u5230\u65f6\u5019\u4f1a\u5448\u73b0\u4e00\u4e2a\u7528\u4f8b\u6811\uff0c\u5de6\u4fa7\u5462\u4f1a\u6839\u636e\u7528\u4f8b\u7684tag/\u7528\u4f8b\u7684\u7ea7\u522b\u53bb \u5c55\u793a\u8be5\u9879\u76ee\u4e0b\u7684\u7528\u4f8b \uff0c\u53f3\u8fb9\u5462\u5219\u662f\u7528\u4f8b\u7684\u5177\u4f53\u4fe1\u606f\u3002 \u6210\u5458\u5217\u8868\u4f1a\u663e\u793a\u8fd9\u4e2a\u9879\u76ee\u4e0b\u7684\u6210\u5458\uff0c\u9875\u9762\u53c2\u8003 Yapi \u3002 \u9879\u76ee\u8bbe\u7f6e\u53ef\u4ee5\u8ba9\u7528\u6237\u5bf9\u9879\u76ee\u7684 \u57fa\u7840\u4fe1\u606f \u8fdb\u884c\u4e00\u4e2a\u66f4\u6539\uff0c\u5927\u6982\u7684\u9875\u9762\u529f\u80fd\u6a21\u5757\u662f\u8fd9\u6837\u3002 \u53ef\u4ee5\u770b\u5230 \u6700\u7ec8\u6548\u679c \u91cc\u9762\u662f\u6ca1\u6709\u5177\u4f53\u7684\u6210\u5458\u5217\u8868\u548c\u9879\u76ee\u8bbe\u7f6e\u7684\uff0c\u6211\u4eec\u5148\u5b8c\u6210\u4e00\u4e2a\u7a7a\u58f3\uff0c\u540e\u7eed\u518d\u8fdb\u884c\u8865\u5145\u3002 \u7f16\u5199ProjectDetail.jsx import React, { useEffect, useState } from 'react' ; import { PageContainer } from '@ant-design/pro-layout' ; import { Avatar, Card, Tabs } from 'antd' ; import { useParams } from 'umi' ; import { process } from '@/utils/utils' ; import { queryProject } from '@/services/project' ; import auth from '@/utils/auth' ; const { TabPane } = Tabs; export default () => { const params = useParams(); const projectId = params.id; const [projectData, setProjectData] = useState({}); const [roles, setRoles] = useState([]); const fetchData = async () => { const res = await queryProject({ projectId }); if (auth.response(res)) { setProjectData(res.data.project); setRoles(res.data.role); } }; useEffect( async () => { await process(fetchData); }, []); return ( < PageContainer title = { < span > < Avatar style = {{ backgroundColor: '# 87d068 ' }}> {projectData.name === undefined ? 'loading...' : projectData.name.slice(0, 2)} </ Avatar > {projectData.name} </ span > }> < Card > < Tabs defaultActiveKey = '1' > < TabPane tab = '\u7528\u4f8b\u5217\u8868' key = '1' > \u8fd9\u91cc\u6ca1\u6709\u7528\u4f8b\uff0c\u6682\u65f6\u66ff\u4ee3\u4e00\u4e0b </ TabPane > < TabPane tab = '\u6210\u5458\u5217\u8868' key = '2' > {/* < ProjectRole /> */} </ TabPane > < TabPane tab = '\u9879\u76ee\u8bbe\u7f6e' key = '3' > {/* < ProjectInfo data = {projectData} /> */} </ TabPane > </ Tabs > </ Card > </ PageContainer > ); }; \u4ee3\u7801\u5f88\u7b80\u77ed\uff0c\u5176\u4e2d\u8bbe\u7f6e\u4e86projectData\u548croles2\u4e2a\u5b57\u6bb5\uff08\u7528\u6765\u5b58\u653e\u9879\u76ee\u4fe1\u606f\u548c\u89d2\u8272\u5217\u8868\uff09\uff0c\u7136\u540e\u7ec4\u4ef6\u52a0\u8f7d\u7684\u65f6\u5019\u4f1a\u53bb\u8bf7\u6c42\u4e00\u4e0b \u67e5\u8be2\u9879\u76ee \u7684\u63a5\u53e3\uff0cprojectId\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 useParams hook \u83b7\u53d6: const params = useParams(); const projectId = params.id; \u5269\u4e0b\u7684\"html\"\u90e8\u5206\u5f88\u7b80\u5355\u4e86\uff0c\u5c31\u662f\u6807\u51c6\u7684PageContainer+\u5361\u7247\u7684\u7ec4\u5408\uff0c\u7136\u540e\u91cc\u9762\u5d4c\u5165\u4e863\u4e2atab\u3002 \u5b8c\u5584\u7f16\u8f91\u9879\u76ee\u529f\u80fd \u53ef\u4ee5\u770b\u5230\u4e0a\u9762\u6709\u88ab\u6ce8\u91ca\u6389\u7684 ProjectInfo \u7ec4\u4ef6\uff0c\u8fd9\u4e2a\u662f\u6211\u4eec\u7528\u6765\u4fee\u6539\u9879\u76ee\u4fe1\u606f\u7684\uff0c\u6211\u4eec\u8fd9\u5c31\u6765\u5b8c\u5584\u5b83\uff01 \u7f16\u5199\u540e\u7aef\u63a5\u53e3 ProjectDap.py\u6dfb\u52a0update_project\u65b9\u6cd5 @staticmethod def update_project (user, role, project_id, name, owner, private, description) : try : data = Project.query.filter_by(id=project_id, deleted_at= None ).first() if data is None : return \"\u9879\u76ee\u4e0d\u5b58\u5728\" data.name = name # \u5982\u679c\u4fee\u6539\u4eba\u4e0d\u662fowner\u6216\u8005\u8d85\u7ba1 if data.owner != owner and (role < pity.config.get( \"ADMIN\" ) or user != data.owner): return \"\u60a8\u6ca1\u6709\u6743\u9650\u4fee\u6539\u9879\u76ee\u8d1f\u8d23\u4eba\" data.owner = owner data.private = private data.description = description data.updated_at = datetime.now() data.update_user = user db.session.commit() except Exception as e: ProjectDao.log.error( f\"\u7f16\u8f91\u9879\u76ee: {name} \u5931\u8d25, {e} \" ) return f\"\u7f16\u8f91\u9879\u76ee: {name} \u5931\u8d25, {e} \" return None \u8fd9\u91cc\u503c\u5f97\u6ce8\u610f\u7684\u5730\u65b9\u662f\uff0c\u6211\u4eec\u53ea\u6709 \u9879\u76ee\u8d1f\u8d23\u4eba \u548c \u8d85\u7ea7\u7ba1\u7406\u5458 \u53ef\u4ee5\u7f16\u8f91\u9879\u76ee\uff0c\u6240\u4ee5\u4e00\u65e6owner\u53d1\u751f\u53d8\u66f4\uff0c\u5219\u9700\u8981\u5bf9\u6743\u9650\u505a\u4e00\u4e2a\u5224\u65ad\u3002\u6700\u540e\u5c31\u662f\u8bb0\u5f97\u66f4\u6539 \u66f4\u65b0\u65f6\u95f4 \u548c \u66f4\u65b0\u4eba \u3002 \u7f16\u5199/project/update\u63a5\u53e3 @pr.route(\"/update\", methods=[\"POST\"]) @permission() def update_project (user_info) : try : user_id, role = user_info[ \"id\" ], user_info[ \"role\" ] data = request.get_json() if data.get( \"id\" ) is None : return jsonify(dict(code= 101 , msg= \"\u9879\u76eeid\u4e0d\u80fd\u4e3a\u7a7a\" )) if not data.get( \"name\" ) or not data.get( \"owner\" ): return jsonify(dict(code= 101 , msg= \"\u9879\u76ee\u540d\u79f0/\u9879\u76ee\u8d1f\u8d23\u4eba\u4e0d\u80fd\u4e3a\u7a7a\" )) private = data.get( \"private\" , False ) err = ProjectDao.update_project(user_id, role, data.get( \"id\" ), data.get( \"name\" ), data.get( \"owner\" ), private, data.get( \"description\" , \"\" )) if err is not None : return jsonify(dict(code= 110 , msg=err)) return jsonify(dict(code= 0 , msg= \"\u64cd\u4f5c\u6210\u529f\" )) except Exception as e: return jsonify(dict(code= 111 , msg=str(e))) \u8fd9\u8fb9\u540c\u6837\u4e5f\u5148\u6821\u9a8c\u53c2\u6570\uff0c\u7136\u540e\u8c03\u7528update_project\u65b9\u6cd5\u3002 src/services/project.js\u7f16\u5199\u66f4\u65b0\u9879\u76ee\u7684\u65b9\u6cd5 \u7f16\u5199ProjectInfo.jsx import React, { useEffect, useState } from 'react' ; import { Row, Col, Select, Tooltip } from 'antd' ; import CustomForm from '@/components/PityForm/CustomForm' ; import { listUsers } from '@/services/user' ; import { updateProject } from '@/services/project' ; import auth from '@/utils/auth' ; const { Option } = Select; export default ({ data }) => { const [users, setUsers] = useState([]); const fetchUsers = async () => { const res = await listUsers(); setUsers(res); }; useEffect( async () => { await fetchUsers(); }, []); const onFinish = async (values) => { const project = { ...data, ...values, }; const res = await updateProject(project); auth.response(res, true ); }; const opt = < Select placeholder = '\u8bf7\u9009\u62e9\u9879\u76ee\u7ec4\u957f' > { users.map(item => < Option key = {item.value} value = {item.id} > < Tooltip title = {item.email} > {item.name} </ Tooltip > </ Option > ) } </ Select > ; const fields = [ { name : 'name' , label : '\u9879\u76ee\u540d\u79f0' , required : true , message : '\u8bf7\u8f93\u5165\u9879\u76ee\u540d\u79f0' , type : 'input' , placeholder : '\u8bf7\u8f93\u5165\u9879\u76ee\u540d\u79f0' , component : null , }, { name : 'owner' , label : '\u9879\u76ee\u8d1f\u8d23\u4eba' , required : true , component : opt, type : 'select' , }, { name : 'description' , label : '\u9879\u76ee\u63cf\u8ff0' , required : false , message : '\u8bf7\u8f93\u5165\u9879\u76ee\u63cf\u8ff0' , type : 'textarea' , placeholder : '\u8bf7\u8f93\u5165\u9879\u76ee\u63cf\u8ff0' , }, { name : 'private' , label : '\u662f\u5426\u79c1\u6709' , required : true , message : '\u8bf7\u9009\u62e9\u9879\u76ee\u662f\u5426\u79c1\u6709' , type : 'switch' , valuePropName : 'checked' , }, ]; return ( < Row gutter = {8} > < Col span = {24} > < CustomForm left = {6} right = {18} record = {data} onFinish = {onFinish} fields = {fields} /> </ Col > </ Row > ); } \u5176\u5b9e \u8fd9\u91ccfields\u548c\u4e4b\u524d\u521b\u5efa\u9879\u76ee\u7684fields\u91cd\u590d\u5b9a\u4e49\u4e86\uff0c\u7b49\u4e8e\u5b58\u653e\u4e862\u4efd\uff0c\u4f46\u662f\u8fd9\u91cc\u6211\u56fe\u65b9\u4fbf\u5c31\u6ca1\u6709\u62bd\u51fa\u6765\uff0c\u56e0\u4e3a\u6015\u4ee5\u540e\u8fd9\u91cc\u6709\u4ec0\u4e48\u53d8\u5316\uff08\u8bf4\u767d\u4e86\u5c31\u662f\u61d2\uff0c\u4f46\u662f\u5343\u4e07\u522b\u548c\u6211\u4e00\u6837\uff0c\u80fd\u5c01\u88c5\u7684\u8fd8\u662f\u5c01\u88c5\uff09 \u7136\u540e\u5728\u7ec4\u4ef6\u52a0\u8f7d\u7684\u65f6\u5019\u4f1a\u83b7\u53d6\u6240\u6709\u7528\u6237\uff08\u56e0\u4e3a\u6211\u4eec\u9700\u8981\u4fee\u6539\u7ec4\u5458\uff09\uff0c\u4f46\u662f\u6211\u7a81\u7136\u60f3\u5230\uff0c\u89d2\u8272\u5217\u8868\u4e5f\u4f1a\u83b7\u53d6\u7ec4\u5458\u8eab\u4efd\uff0c\u6240\u4ee5\u6211\u4eec\u628auser\u7684\u83b7\u53d6\u653e\u5230\u6700\u5916\u5c42\uff0c\u4e5f\u5c31\u662fProject\u5c42\uff0c\u8fd9\u91cc\u5c31\u4e0d\u591a\u5c55\u793a\u4e86\uff0c\u8be6\u7ec6\u53ef\u770b\u6e90\u7801\u3002 CustomForm\u662f\u81ea\u5df1\u5c01\u88c5\u7684\u4e00\u5957\u901a\u7528\u8868\u5355\uff0c\u91cc\u9762\u4e5f\u662f\u89e3\u6790fields\u7136\u540e\u5c55\u793a\u8868\u5355: import { Button, Col, Form, Row, Tooltip, Upload } from 'antd' ; import React from 'react' ; import ProjectAvatar from '@/components/Project/ProjectAvatar' ; import { SaveOutlined } from '@ant-design/icons' ; import getComponent from './index' ; const { Item : FormItem} = Form; export default ({left, right, formName, record, onFinish, fields, dispatch}) => { const [form] = Form.useForm(); const layout = { labelCol : { span : left}, wrapperCol : { span : right}, } return ( < Form form = {form} { ...layout } name = {formName} initialValues = {record} onFinish = {onFinish} > < Row > < Col span = {6}/ > < Col span = {12} style = {{textAlign: ' center '}}> < Tooltip title = \"\u70b9\u51fb\u53ef\u4fee\u6539\u5934\u50cf\" placement = \"rightTop\" > < Upload customRequest = {async fileData => { await dispatch({ type: 'project/uploadFile', payload: { file: fileData.file, project_id: record.id, } }) }} fileList={[]}> < Row style = {{textAlign: ' center ', marginBottom: 16 }}> < ProjectAvatar data = {record}/ > </ Row > </ Upload > </ Tooltip > </ Col > < Col span = {6}/ > </ Row > { fields.map(item => < Row > < Col span = {6}/ > < Col span = {12} > < FormItem label = {item.label} colon = {item.colon || true } rules = { [{ required: item.required , message: item.message }] } name = {item.name} valuePropName = {item.valuePropName || ' value '} > {getComponent(item.type, item.placeholder, item.component)} </ FormItem > </ Col > < Col span = {6}/ > </ Row > ) } < Row > < Col span = {6}/ > < Col span = {12} style = {{textAlign: ' center '}}> < FormItem { ... { labelCol: { span: 0 }, wrapperCol: { span: 24 }, }}> < Button htmlType = \"submit\" type = \"primary\" > < SaveOutlined /> \u4fee\u6539 </ Button > </ FormItem > </ Col > < Col span = {6}/ > </ Row > </ Form > ) } \u5927\u81f4\u5c31\u662f\u628afields\u91cc\u9762\u7684json\u6570\u636e\u53d6\u51fa\uff0c\u7136\u540e\u6309\u7167\u987a\u5e8f\u89e3\u6790\u6210\u8868\u5355\uff0c\u6700\u540e\u7559\u4e00\u4e2a\u4fee\u6539\u7684\u6309\u94ae\uff0c\u6267\u884c \u4fdd\u5b58 \u64cd\u4f5c\u3002 \u770b\u4e0b\u6548\u679c\u5427 \u8fd9\u91cc\u53ef\u4ee5\u770b\u5230\u6700\u4e0a\u65b9\u7684\u9879\u76ee\u540d\u79f0\u8fd8\u6ca1\u6709\u8fdb\u884c\u66f4\u6539\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u91cd\u65b0\u83b7\u53d6\u4e0b\u9879\u76ee\u6570\u636e\u3002 \u8981\u505a\u7684\u5c31\u662f\u4f20\u5165fetchData\u65b9\u6cd5\uff0c\u5e76\u5728\u4fee\u6539\u540e\u6267\u884c\u8fd9\u4e2a\u65b9\u6cd5\u3002 \u66f4\u65b0\u540e \u53ef\u4ee5\u770b\u5230\u53d8\u6210\u4e86QQ\u4e09\u56fd \u4eca\u5929\u7684\u5185\u5bb9\u5c31\u5230\u8fd9\u91cc\u4e86\uff0c\u8fdb\u5ea6\u5f88\u6162\uff0c\u66f4\u65b0\u5f88\u6162\u3002\u5468\u672b\u6109\u5feb\uff0c\u770b RNG VS TES \uff01 \u9879\u76ee\u524d\u7aef\u5730\u5740 \u9879\u76ee\u540e\u7aef\u5730\u5740","title":"23.\u7f16\u5199\u9879\u76ee\u8be6\u60c5\u9875\u9762"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2824%29%20%E7%BC%96%E5%86%99%E6%88%90%E5%91%98%E7%AE%A1%E7%90%86%E5%8A%9F%E8%83%BD/","text":"\u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u7f16\u5199\u4e86 \u9879\u76ee\u8bbe\u7f6e \u76f8\u5173\u529f\u80fd\uff0c\u8fd8\u5269\u4e0b2\u4e2atab\u6ca1\u6709\u7f16\u5199\uff0c\u5206\u522b\u662f: \u7528\u4f8b\u5217\u8868 \u548c \u6210\u5458\u7ba1\u7406 . \u7f16\u5199\u6210\u5458\u5217\u8868\u53ca\u90e8\u5206\u63a5\u53e3 \u6dfb\u52a0\u6210\u5458 \u641c\u7d22\u6210\u5458 \u7f16\u8f91\u6210\u5458 \u5220\u9664\u6210\u5458 \u4eca\u5929\u56e0\u4e3a \u65f6\u95f4\u5173\u7cfb \u5c31\u4e0d\u5c55\u793a\u5220\u9664\u6210\u5458\u4e86\uff0c\u53ea\u7f16\u5199 \u7f16\u8f91/\u65b0\u589e \u6210\u5458\u63a5\u53e3\u548c\u9875\u9762\u3002 \u7f16\u5199\u65b0\u589e/\u7f16\u8f91\u89d2\u8272\u7684\u65b9\u6cd5 \u7531\u4e8e\u4e4b\u524d\u6211\u4eec\u5df2\u7ecf \u7f16\u8f91 \u8fc7 \u65b0\u589e\u89d2\u8272 \u7684\u65b9\u6cd5\u4e86\uff0c\u4f46\u662f\u9700\u8981\u4fee\u6539\u4e00\u70b9: \u8fd9\u91cc\u89d2\u8272\u7684 \u7b5b\u9009\u6761\u4ef6 \u4e0d\u80fd\u52a0\u4e0a\uff0c\u4e3a\u4ec0\u4e48\u5462\uff1f\u56e0\u4e3a\u52a0\u4e0a\u7684\u8bdd\uff0c\u6211\u53ef\u4ee5\u521b\u5efa\u540c\u4e00\u4e2auser_id\u7684\u4e0d\u540c\u89d2\u8272\uff0c\u6bd4\u5982\u4e00\u4e2a\u7ec4\u957f\u4e00\u4e2a\u7ec4\u5458\u3002\u6240\u4ee5\u6211\u4eec\u53ea\u8981user_id\u5728\u6570\u636e\u8868\u91cc\u51fa\u73b0\u8fc7\uff0c\u5c31\u89c6\u4e3a \u91cd\u590d\u6dfb\u52a0 \u3002 \u65b0\u589e\u7f16\u8f91\u65b9\u6cd5 \u7f16\u8f91\u65b9\u6cd5\u6d41\u7a0b\u4f1a\u6bd4\u8f83\u591a\uff0c\u9996\u5148\u6211\u4eec\u9700\u8981\u5224\u65ad\u7528\u6237\u662f\u5426\u662f\u8d85\u7ba1\uff0c\u5982\u4e0d\u662f\uff0c\u5219\u5224\u65ad\u4ed6\u662f\u4e0d\u662fowner\uff0c\u5982\u679c\u4e5f\u4e0d\u662f\uff0c\u5219\u5224\u65ad\u4ed6\u662f\u4e0d\u662f \u7ec4\u957f \uff0c\u5982\u679c\u662f\u5219\u5224\u65ad\u4ed6\u8981\u4fee\u6539\u7684\u7528\u6237\u662f\u4e0d\u662f\u7ec4\u957f\uff0c\u7528\u6237\u662f\u7ec4\u957f\u5219\u4e0d\u8ba9\u4ed6\u4fee\u6539\uff01 @staticmethod def update_project_role (role_id, project_role, user, user_role) : try : role = ProjectRole.query.filter_by(id=role_id, deleted_at= None ).first() if role is None : return \"\u8be5\u7528\u6237\u89d2\u8272\u4e0d\u5b58\u5728\" if user_role != pity.config.get( \"ADMIN\" ): project = Project.query.filter_by(id=role.project_id).first() if project is None : return \"\u8be5\u9879\u76ee\u4e0d\u5b58\u5728\" if project.owner != user and role.project_role == 1 : # \u8bf4\u660e\u65e2\u4e0d\u662fowner\u4e5f\u4e0d\u662f\u8d85\u7ba1\uff0c\u65e0\u6cd5\u4fee\u6539\u963b\u6b62\u7684\u6743\u9650 return \"\u4e0d\u80fd\u4fee\u6539\u5176\u4ed6\u7ec4\u957f\u7684\u6743\u9650\" updater_role = ProjectRole.query.filter_by(user_id=user, project_id=role.project_id, deleted_at= None ).first() if updater_role is None or updater_role.project_role == 1 : return \"\u5bf9\u4e0d\u8d77\uff0c\u4f60\u6ca1\u6709\u6743\u9650\" role.project_role = project_role role.updated_at = datetime.now() role.update_user = user db.session.commit() except Exception as e: ProjectRoleDao.log.error( f\"\u4fee\u6539\u9879\u76ee\u7528\u6237\u5931\u8d25, {e} \" ) return f\"\u4fee\u6539\u9879\u76ee\u7528\u6237\u5931\u8d25, {e} \" return None \u5224\u65ad\u4ed6\u8981\u4fee\u6539\u7684\u89d2\u8272id\u662f\u5426\u5b58\u5728 \u5224\u65ad\u662f\u5426\u662f\u8d85\u7ba1\u6216\u8005owner \u5224\u65ad\u8981\u4fee\u6539\u7684\u662f\u4e0d\u662f\u7ec4\u957f \u5224\u65ad\u4ed6\u81ea\u8eab\u662f\u5426\u662f\u7ec4\u957f \u8fd9\u4e9b\u6821\u9a8c\u90fd\u901a\u8fc7\u4ee5\u540e\uff0c\u624d \u5141\u8bb8\u4ed6\u4fee\u6539\u7ec4\u5458\u7684\u6743\u9650 \u3002 \u8865\u5168\u5177\u4f53\u7684\u63a5\u53e3\u65b9\u6cd5 @pr.route(\"/role/insert\", methods=[\"POST\"]) @permission() def insert_project_role (user_info) : try : data = request.get_json() if data.get( \"user_id\" ) is None or data.get( \"project_role\" ) is None or data.get( \"project_id\" ) is None : return jsonify(dict(code= 101 , msg= \"\u8bf7\u6c42\u53c2\u6570\u6709\u8bef\" )) err = ProjectRoleDao.add_project_role(data.get( \"user_id\" ), data.get( \"project_id\" ), data.get( \"project_role\" ), user_info[ \"id\" ]) if err is not None : return jsonify(dict(code= 110 , msg=err)) except Exception as e: return jsonify(dict(code= 110 , msg=str(e))) return jsonify(dict(code= 0 , msg= \"\u64cd\u4f5c\u6210\u529f\" )) @pr.route(\"/role/update\", methods=[\"POST\"]) @permission() def update_project_role (user_info) : try : data = request.get_json() if data.get( \"user_id\" ) is None or data.get( \"project_role\" ) is None or data.get( \"project_id\" ) is None \\ or data.get( \"id\" ) is None : return jsonify(dict(code= 101 , msg= \"\u8bf7\u6c42\u53c2\u6570\u6709\u8bef\" )) err = ProjectRoleDao.update_project_role(data.get( \"id\" ), data.get( \"project_role\" ), user_info[ \"id\" ], user_info[ \"role\" ]) if err is not None : return jsonify(dict(code= 110 , msg=err)) except Exception as e: return jsonify(dict(code= 110 , msg=str(e))) return jsonify(dict(code= 0 , msg= \"\u64cd\u4f5c\u6210\u529f\" )) 2\u6bb5\u4ee3\u7801\u6bd4\u8f83\u63a5\u8fd1\uff0c\u57fa\u672c\u5c31\u662f\u6821\u9a8c\u53c2\u6570+\u8c03\u7528\u6838\u5fc3\u65b9\u6cd5\u3002 \u7f16\u5199\u524d\u7aef\u90e8\u5206 \u7f16\u5199services\u90e8\u5206: src/services/project.js \u7f16\u5199ProjectRole.jsx\u7ec4\u4ef6 \u9996\u5148\u52a0\u8f7d\u7ec4\u4ef6\u7684\u65f6\u5019\u83b7\u53d6user_id => user\u7684\u6620\u5c04\uff0c\u7ef4\u62a4\u4e00\u4e2a\u5bf9\u8bdd\u6846\uff0c\u7528\u6765\u9009\u62e9\u7528\u6237+\u7528\u6237\u89d2\u8272\u3002 onUpdateRole \u5982\u679c\u66f4\u65b0\u6210\u529f\u5219\u91cd\u65b0\u52a0\u8f7d\u6570\u636e\u3002 onFinish \u65b0\u589e\u89d2\u8272\u4fe1\u606f onConfirm \u7528\u6765\u5220\u9664\u89d2\u8272\uff0c\u76ee\u524d\u529f\u80fd\u672a\u5b8c\u6210\u3002 permission \u8fd9\u8fb9\u5176\u5b9e\u662f\u4e00\u4e2a\u5305\u88c5\u7ec4\u4ef6\uff0c\u5f53project_role\u662f'OWNER'\u7684\u65f6\u5019\uff0c\u6211\u4eec\u628a\u5b83\u8fdb\u884c \u7279\u6b8a\u663e\u793a : \u4e0d\u53ef\u7f16\u8f91 \u7279\u6b8a\u8eab\u4efd\u6807\u8bc6 \u5176\u4ed6\u7528\u6237\u5219\u8fd4\u56de\u4e00\u4e2a\u9009\u62e9\u6846\uff0c\u901a\u8fc7\u9009\u62e9\u4ed6\u7684\u89d2\u8272\u800c\u89e6\u53d1update\u65b9\u6cd5\u3002 fields\u662f\u8868\u5355\u76842\u4e2a\u5b57\u6bb5: \u7528\u6237\u548c\u89d2\u8272 \u6ce8\u610f\u8fd9\u91cc: \u6211\u5728roles\u524d\u9762\u5f3a\u884c\u585e\u4e86\u4e00\u4e2a OWNER \u7684\u6570\u636e\uff0c\u4e3a\u7684\u5c31\u662f\u547c\u5e94\u4e4b\u524d\u9488\u5bf9project_role === 'OWNER'\u7684\u60c5\u51b5\u3002 \u8fd9\u8fb9\u5c31\u662f \u6dfb\u52a0\u6210\u5458 \u7684\u6309\u94ae\u548cList\u5217\u8868\u3002 \u6700\u7ec8\u6548\u679c \u4eca\u5929\u66f4\u7684\u5f88\u4ed3\u4fc3\uff0c\u5230\u5bb6\u6bd4\u8f83\u665a\u3002\u5f88\u591a\u4e1c\u897f\u4e5f\u8bf4\u7684\u4e0d\u6e05\u4e0d\u695a\u7684\uff0c \u51d1\u5408\u770b\u5427 \u3002\u4e0b\u6b21\u54ea\u6015\u4e00\u6b21\u6027\u5199\u4e0d\u5b8c\u4e5f\u4e0d\u5f3a\u884c\u66f4\u6587\u4e86\uff0c\u4e0d\u8fc7\u6709\u4e0d\u61c2\u7684\u6216\u8005\u6709\u5efa\u8bae\u7684\u53ef\u4ee5\u968f\u65f6\u8054\u7cfb\u6211\u5440\uff01\u6211\u77e5\u9053\u5f88\u591a\u8bfb\u8005\u4e0d\u592a\u719f\u6089React\uff0c\u6211\u81ea\u5df1\u4e5f\u6ca1\u529e\u6cd5\u4ece\u6700\u57fa\u7840\u7684\u5730\u65b9\u4ea4\uff0c\u6240\u4ee5\u53ef\u80fd\u5728\u540e\u9762\u82b1\u70b9\u65f6\u95f4\u5927\u81f4\u5199\u4e00\u70b9\u70b9 \u7b80\u5355\u7684\u6559\u7a0b \u5427\u3002 \u524d\u7aef\u5730\u5740: https://github.com/wuranxu/pityWeb \u540e\u7aef\u5730\u5740: https://github.com/wuranxu/pity \u624d\u53d1\u73b0\u4e4b\u524d\u5730\u5740\u90fd\u6ca1\u8d34\u4e0a\uff0c\u8fd9\u91cc\u8865\u4e0a\u4e86\u54c8\u3002\u540e\u9762\u5220\u9664\u7b49\u4ee3\u7801\u5c31\u53ef\u80fd\u4e0d\u8d34\u4e86\uff0c\u5927\u5bb6\u6709\u5174\u8da3\u770b\u4ee3\u7801\u5c31\u53ef\u4ee5\u5566\uff01","title":"24.\u7f16\u5199\u6210\u5458\u7ba1\u7406\u529f\u80fd"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2825%29%20%E7%BC%96%E5%86%99%E7%94%A8%E4%BE%8B%E6%A0%91/","text":"\u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u6211\u4eec\u4e3b\u8981\u9488\u5bf9\u7528\u6237\u7684\u89d2\u8272\u8fdb\u884c \u6dfb\u52a0 \u548c \u4fee\u6539 \u529f\u80fd\uff0c\u8fd8\u5269\u4e0b \u67e5\u8be2 \u548c \u5220\u9664 \uff0c\u8fd9\u4e2a\u7b14\u8005\u5df2\u7ecf\u7528\u4ee3\u7801\u5b9e\u73b0\u4e86\u3002\u5c31\u4e0d\u8bb2\u89e3\u601d\u8def\uff0c\u53ea\u662f\u8d34\u4ee3\u7801\u56de\u987e\u4e00\u4e0b\u3002\u5177\u4f53\u7684\u53ef\u4ee5\u53bb\u9879\u76ee\u91cc\u9762\u67e5\u770b\uff01 \u641c\u7d22\u7528\u6237 \u56e0\u4e3a\u4e00\u4e2a\u9879\u76ee\u7684\u6570\u636e\u90fd\u5df2\u7ecf\u5c55\u793a\u7ed9\u524d\u7aef\u4e86\uff0c\u6240\u4ee5\u6211\u4eec\u8fd9\u91cc\u7528\u524d\u7aef\u6765\u8fdb\u884c\u8fc7\u6ee4\u5373\u53ef\uff0c\u4e0d\u9700\u8981\u518d\u8c03\u7528 \u540e\u7aef\u63a5\u53e3 \u3002 \u5728\u6dfb\u52a0\u6210\u5458\u540c\u4e00\u884c\u6dfb\u52a0\u4e86\u4e00\u4e2a\u641c\u7d22\u6846\uff0c\u7528\u6765\u641c\u7d22\u6210\u5458 \u641c\u7d22\u65b9\u6cd5 \u8fd9\u4e2a\u641c\u7d22\u65b9\u6cd5\u7684\u601d\u8def\u662f\uff0c\u5f53\u7528\u6237\u8f93\u5165\u7a7a\u5b57\u7b26\u4e32\u7684\u65f6\u5019\uff0c\u5219\u8fd8\u539f\u4e4b\u524d\u7684\u6570\u636e\u3002\u800c\u7528\u6237\u8f93\u5165\u4e86\u5bf9\u5e94\u7684 name \uff0c\u90a3\u4e48\u5219\u641c\u7d22roles\u6570\u7ec4\u4e2d\u6240\u6709\u90ae\u4ef6/\u59d3\u540d\u5305\u542bname\u7684\u6570\u636e\uff0c\u5e76\u66f4\u65b0data\u6570\u7ec4\u3002\uff08\u6bd5\u7adf data\u6570\u7ec4 \u624d\u662f\u5177\u4f53\u663e\u793a\u6570\u636e\u7684\u5730\u65b9\uff09 \u5220\u9664\u65b9\u6cd5 \u5220\u9664\u65b9\u6cd5\u4e5f\u5f88\u7b80\u5355\uff0c\u5c31\u662f\u901a\u8fc7id\u5220\u9664\u5bf9\u5e94\u7684\u6570\u636e\uff0c\u5982\u679c\u6210\u529f\u5c31 \u91cd\u65b0\u52a0\u8f7d\u4e0b\u6570\u636e \u3002 \u540e\u7aef\u66f4\u65b0 \u7f16\u5199\u5220\u9664\u7528\u6237\u89d2\u8272\u7684\u65b9\u6cd5\uff0c\u6211\u4eec\u4e0a\u8282\u7f16\u5199\u8fc7\u7c7b\u4f3c\u7684 \u6743\u9650\u6821\u9a8c \u65b9\u6cd5\u3002\u4f46\u662f\u6bcf\u6b21\u90fd\u5148\u5224\u65ad\u4ed6\u662f\u4e0d\u662f \u8d85\u7ba1 \uff0c\u518d\u5224\u65ad\u4ed6\u662f\u4e0d\u662f \u9879\u76eeowner \uff0c\u6700\u540e\u518d\u5224\u65ad\u4ed6\u662f\u4e0d\u662f \u7ec4\u957f \uff0c\u8fd9\u6837\u7684\u6b65\u9aa4\u5176\u5b9e\u5728\u589e/\u5220/\u6539\u90fd\u662f\u9700\u8981\u7684\uff0c\u4e3a\u4f55\u4e0d\u62bd\u51fa\u4e00\u4e2a\u516c\u5171\u65b9\u6cd5\u5462\uff1f \u6240\u4ee5\u6211\u4eec\u8fd9\u91cc\u62bd\u79bb\u4e86 has_permission \u7684\u65b9\u6cd5 \u903b\u8f91\u4e5f\u6bd4\u8f83\u7b80\u5355\uff0c\u57fa\u672c\u662f\u6309\u7167 \u4e0a\u9762\u8bf4\u7684 \u4e00\u6837\uff0c\u5148\u5224\u65ad \u8d85\u7ba1 \uff0c\u518d\u662f \u9879\u76eeowner \uff0c\u8fd9\u91cc\u6709\u4e2a \u7ec4\u957f \u503c\u5f97\u6ce8\u610f\uff0c\u56e0\u4e3a\u7ec4\u957f\u4e0d\u80fd\u4fee\u6539\u7ec4\u957f\u7684\u6743\u9650\uff0c\u6240\u4ee5\u4e00\u65e6\u4ed6\u4e0d\u662f\u8d85\u7ba1\u4e14\u4e0d\u662fowner\uff0c\u90a3\u4e48\u4ed6\u8981\u4fee\u6539\u7ec4\u957f\u7684\u6743\u9650(\u5220\u9664\u6216\u8005\u6539\u52a8)\uff0c\u90a3\u90fd\u662f\u7981\u6b62\u7684\u3002 \u770b\u770b\u6548\u679c \u90a3\u6211\u4eec\u73b0\u5728\u8fdb\u5165\u6b63\u9898\u5427\uff01 \u6539\u52a8\u6d4b\u8bd5\u7528\u4f8b\u8868 \u5176\u5b9e\u5982\u679c\u505a\u7684\u66f4\u5b8c\u7f8e\u7684\u8bdd\uff0c\u7528\u4f8b\u5e94\u8be5\u662f\u6709\u6a21\u5757\u7684\u5212\u5206\u7684\uff0c\u4f46\u662f\u8fd9\u91cc\u6211\u4eec\u5c31\u4e0d\u5206\u90a3\u4e48\u7ec6\u81f4\u4e86\uff0c\u7528\u4f8b\u7684\u76ee\u5f55\u4e0d\u5355\u72ec\u62bd\u51fa\u6765 \u7ef4\u62a4 \u4e86\uff0c\u5c31\u56fe\u4e00\u4e2a\u5b57\u513f: \u7701\u4e8b \u7528\u4f8b\u7b49\u7ea7 \u5b57\u7b26\u4e32\u7c7b\u578b\uff0c\u652f\u6301p0-p3\u6216\u8005\u66f4\u591a\uff0c\u8fd9\u4e2a\u6839\u636e\u5177\u4f53\u7684\u4e1a\u52a1\u9700\u6c42\u5236\u5b9a\u3002 \u7528\u4f8b\u6240\u5c5e\u76ee\u5f55 \u4e3a\u4e86\u66f4\u65b9\u4fbf\u5730\u53bb\u67e5\u770b\u7528\u4f8b\uff0c\u6211\u4eec\u628a\u7528\u4f8b\u6309\u7167 \u76ee\u5f55 \u8fdb\u884c\u5206\u7c7b\uff0c\u8fd9\u6837\u7684\u8bdd\u7528\u4f8b\u5c31\u5f62\u6210\u4e86 3\u7ea7\u7ed3\u6784 : \u9879\u76ee->\u76ee\u5f55->\u7528\u4f8b \u867d\u7136\u8fd9\u8fb9\u6ca1\u6709\u628a \u63a5\u53e3 \u8fd9\u79cd\u5173\u952e\u4fe1\u606f\u5e26\u5165\u8fdb\u6765\uff0c\u4f46\u662f\u540e\u7eed\u53ef\u4ee5\u7cc5\u5408yapi\u76f8\u5173\u7684\u6587\u6863\uff0c\u7528\u4f8b\u901a\u8fc7\u65b0\u589e\u4e00\u4e2a\u5b57\u6bb5: api_id\uff0c\u7528\u6765\u6253\u901a\u6d4b\u8bd5\u7528\u4f8b\u548capi\u4e4b\u95f4\u7684\u8054\u7cfb\u3002\u8fd9\u91cc\u5c31\u5148\u4e0d \u7ea0\u7ed3 \u8fd9\u4e48\u591a\u4e86\uff01 \u5b8c\u5584\u7528\u4f8b\u5217\u8868\u76f8\u5173\u63a5\u53e3 \u65b0\u589e\u83b7\u53d6\u7528\u4f8b\u6811\u7684\u63a5\u53e3 from collections import defaultdict from app.models.test_case import TestCase from app.utils.logger import Log class TestCaseDao (object) : log = Log( \"TestCaseDao\" ) @staticmethod def list_test_case (project_id) : try : case_list = TestCase.query.filter_by(project_id=project_id, deleted_at= None ).order_by( TestCase.name.asc()).all() return TestCaseDao.get_tree(case_list), None except Exception as e: TestCaseDao.log.error( f\"\u83b7\u53d6\u6d4b\u8bd5\u7528\u4f8b\u5931\u8d25: {str(e)} \" ) return [], f\"\u83b7\u53d6\u6d4b\u8bd5\u7528\u4f8b\u5931\u8d25: {str(e)} \" @staticmethod def get_tree (case_list) : result = defaultdict(list) # \u83b7\u53d6\u76ee\u5f55->\u7528\u4f8b\u7684\u6620\u5c04\u5173\u7cfb for cs in case_list: result[cs.catalogue].append(cs) keys = sorted(result.keys()) tree = [dict(key= f\"cat_ {key} \" , children=[{ \"key\" : f\"case_ {child.id} \" , \"title\" : child.name} for child in result[key]], title=key, total=len(result[key])) for key in keys] return tree \u5176\u5b9e\u662f\u4e00\u4e2a\u5f88\u7b80\u5355\u7684\u67e5\u8be2\u63a5\u53e3: \u6839\u636eproject_id\u83b7\u53d6\u7528\u4f8b\u3002\u56e0\u4e3aantd\u4e2d\u7684\u6811\u9700\u8981\u8fd9\u6837\u7684\u6570\u636e\u7ed3\u6784: \u5982\u4e0b\u56fe\u7684json const treeData = [ { title : 'parent 1' , key : '0-0' , children : [ { title : 'parent 1-0' , key : '0-0-0' , disabled : true , children : [ { title : 'leaf' , key : '0-0-0-0' , disableCheckbox : true , }, { title : 'leaf' , key : '0-0-0-1' , }, ], }, { title : 'parent 1-1' , key : '0-0-1' , children : [{ title : < span style = {{ color: '# 1890ff ' }}> sss </ span > , key : '0-0-1-0' }], }, ], }, key\u662f\u7528\u6765\u786e\u5b9a\u6811\u91cc\u9762\u8282\u70b9\u7684\u552f\u4e00\u6027\uff0ctitle\u5c31\u662f\u540d\u5b57\u4e86\uff0cchildren\u5c31\u662f\u6302\u5728\u8be5\u76ee\u5f55\u4e0b\u7684\u540e\u7eed\u8282\u70b9\u3002 \u5b9e\u9645\u6548\u679c: \u6ce8\u610f\u8fd9\u8fb9\u6211\u4eec\u7ed9key\u52a0\u4e86\u524d\u7f00: case_ \u548c cat_ \uff0c\u76ee\u7684\u662f\u4e3a\u4e86\u533a\u5206 \u7528\u4f8b \u548c \u76ee\u5f55 \uff0c\u56e0\u4e3a\u4e0d\u540c\u7684\u6570\u636e\u9700\u8981\u5c55\u793a\u4e0d\u540c\u7684 icon \uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u4f1a\u5c55\u793a\u3002 \u7ee7\u7eed\u6539\u5199/project/query\u63a5\u53e3 \u540e\u7eed\u5982\u679c\u4e00\u4e2a\u9879\u76ee\u6570\u636e\u591a\u7684\u8bdd\uff0c\u53ef\u80fd\u4f1a\u5f15\u5165Redis\u6765\u7f13\u5b58project\u7684\u4fe1\u606f\uff0c\u8fd9\u6837\u4e0d\u5fc5\u6bcf\u6b21\u90fd\u53bb\u6570\u636e\u5e93\u5927\u67e5\u7279\u67e5\u3002 \u7f16\u5199\u7528\u4f8b\u5217\u8868\u9875\u9762 \u9996\u5148\u6211\u4eec\u628a\u9875\u9762\u4e00\u5206\u4e3a\u4e8c\uff0c\u5de6\u4fa7\u5c55\u793a\u6811\uff0c\u53f3\u4fa7\u6839\u636e \u7528\u6237\u9009\u62e9\u7684\u7528\u4f8b \u8fdb\u884c\u5c55\u793a\u3002 \u6548\u679c\u56fe: \u5de6\u4fa77\u4efd\uff0c\u53f3\u4fa717\u4efd\uff0c2\u4e2acard\uff0c\u5982\u679c\u9ad8\u5ea6\u8d85\u51fa\u5219\u81ea\u52a8\u53d8\u4e3a\u6eda\u52a8\u6761\u3002 \u4eca\u5929\u5c31\u4e0d\u8be6\u7ec6\u8bb2 \u524d\u7aef\u7684\u7ec6\u8282 \u4e86\uff0c\u6bd5\u7adf\u672c\u8eab\u6811\u5c31\u590d\u6742\uff0c\u611f\u89c9\u8fd8\u4e0d\u5982\u4e0d\u8bb2\uff0c\u54c8\u54c8\uff01 \u9879\u76ee\u5730\u5740 \u524d\u7aef\u5730\u5740: https://github.com/wuranxu/pityWeb \u540e\u7aef\u5730\u5740: https://github.com/wuranxu/pity \u4e0d\u77e5\u4e0d\u89c9\u5199\u4e86\u8fd9\u4e48\u4e45\u65f6\u95f4\uff0c\u4e0d\u8fc7\u4eca\u5929\u8fd8\u662f\u4ee5\u5199\u4ee3\u7801\u4e3a\u4e3b\uff0c\u7801\u6587\u7684\u65f6\u95f4\u7f29\u6c34\u4e86\uff0c\u5148\u5c3d\u91cf\u52a0\u5feb\u811a\u6b65\u5427\uff01","title":"25.\u7f16\u5199\u7528\u4f8b\u6811"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2826%29%20%E7%BC%96%E5%86%99%E7%94%A8%E4%BE%8B%E8%AF%A6%E6%83%85%E9%A1%B5%281%29/","text":"\u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u5df2\u7ecf\u7f16\u5199\u4e86\u7528\u4f8b\u6811\u7684\u96cf\u5f62\uff0c\u4f46\u662f\u5177\u4f53\u7684\u7528\u4f8b\u9875\u9762\u8fd8\u6ca1\u6709\u53bb\u7f16\u5199\uff0c\u52a0\u4e0a\u7b14\u8005\u505c\u66f4\u4e86\u51e0\u5929\uff0c\u6240\u4ee5\u8fdb\u5ea6\u5c31\u66f4\u7f13\u6162\u4e86\u3002 \u4e0d\u8fc7\u6211\u4eec\u5728\u6b64\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u6539\u4e00\u4e0bantd pro\u7684\u5168\u5c40\u914d\u7f6e\uff0c\u90a3\u5c31\u662f: \u5b57\u4f53\u3002 \u4fee\u6539\u5b57\u4f53 \u5728\u5bf9\u5e94\u7684\u76ee\u5f55\u4e0b\uff0c\u65b0\u589e\u8fd9\u6837\u4e00\u4e2a\u53c2\u6570: font-size-base \uff0c\u56e0\u4e3a12px\u4f1a\u663e\u5f97\u592a\u5c0f\uff0c\u800c14px\u800c\u4f1a\u663e\u5f97\u6587\u5b57\u6bd4\u8f83\u5927\uff0c\u867d\u7136\u4e0d\u7b26\u5408\u8bbe\u8ba1\u903b\u8f91(\u5076\u6570\u50cf\u7d20)\uff0c\u4f46\u662f\u611f\u89c913px\u6548\u679c\u4e5f\u633a\u4e0d\u9519\u3002 \u7f16\u5199\u7528\u4f8b\u540e\u7aef\u90e8\u5206 \u7f16\u5199\u53c2\u6570\u6821\u9a8c\u65b9\u6cd5 \u5728\u6b64\u4e4b\u524d\u5462\uff0c\u6211\u4eec\u9700\u8981\u5148\u65b0\u589e\u4e00\u4e2a\u88c5\u9970\u5668\uff0c\u7528\u6765 \u6821\u9a8c\u53c2\u6570 \uff0c\u8fd9\u8fb9\u4e0d\u6253\u7b97\u91c7\u7528pydantic\uff0c\u6253\u7b97\u7528jsonschema\u4e86\uff0c\u867d\u7136\u611f\u89c9\u524d\u8005\u66f4\u597d\uff0c\u4f46\u662f\u6211\u53ea\u662f\u8fd9\u4e2a\u63a5\u53e3\u60f3\u7528\u4e86\uff0c\u8bf4\u767d\u4e86\uff0c\u5c31\u662f\u73a9\u513f\uff01 \u4e3a\u4ec0\u4e48\u6211\u4eec\u9700\u8981\u8fd9\u4e2a \u65b9\u6cd5 \u5462\uff0c\u56e0\u4e3a\u6211\u4eec\u5bf9\u4e8e\u4e00\u4e2a TestCase \u5bf9\u8c61\u6765\u8bf4\uff0c\u5bf9 \u6bcf\u4e2a\u53c2\u6570\u8fdb\u884c\u6821\u9a8c \uff0c\u5b9e\u5728\u662f\u592a\u9ebb\u70e6\u4e86\uff0c\u6240\u4ee5\u8fd9\u91cc\u6211\u53d7\u4e0d\u4e86\u4e86\u3002 app/utils/decorator.py \u8fd9\u4e2a\u65b9\u6cd5\u5462\uff0c\u5148\u83b7\u53d6json\u6570\u636e\uff0c\u5982\u679c\u6ca1\u83b7\u53d6\u5230\u5219\u76f4\u63a5\u629b\u51fa\u5f02\u5e38\uff0c\u5426\u5219\u8c03\u7528jsonschema\u5e93\u7684 validate \u65b9\u6cd5\uff0c\u4e5f\u5c31\u662f\u6821\u9a8c\u53c2\u6570\u3002 \u4e0d\u8fc7\u8fd9\u4e2a\u65b9\u6cd5\u6709\u4e00\u4e2a\u5f0a\u7aef\u5c31\u662f\uff0c\u53ea\u80fd\u6821\u9a8cjson\u6570\u636e\uff0c\u8bf4\u7684\u5f88\u5bf9\uff01\u5982\u679c\u6709url\u53c2\u6570\u600e\u4e48\u529e\uff0c\u90a3\u662f\u4e0d\u652f\u6301\u7684\uff0c\u7b97\u4e86\u540e\u7eed\u518d\u8bf4\u5427\uff0c\u6bd5\u7adf\u6211\u73b0\u5728\u4e3b\u8981\u8981\u89e3\u51b3\u7684\u4e0d\u662f\u8fd9\u4e2a\u3002 pip3 install jsonschema \u522b\u5fd8\u4e86\u5b89\u88c5\u8fd9\u4e2a\u65b0\u5e93\u54e6\uff0c\u5982\u679c\u662f\u65b0\u73a9\u5bb6\uff0c\u76f4\u63a5\u6309\u7167requirements.txt\u5b89\u88c5\u5373\u53ef\u3002 \u7f16\u5199\u65b0\u589e\u7528\u4f8b\u7684\u65b9\u6cd5 \u4fee\u6539\u7528\u4f8bmodel \u56e0\u4e3a\u4e4b\u524d\u65b0\u589e\u4e86 \u76ee\u5f55 \u548c \u4f18\u5148\u7ea7 2\u4e2a\u5b57\u6bb5\uff0c\u6240\u4ee5\u9700\u8981\u5728__init__\u65b9\u6cd5\u4e2d\u52a0\u5165\u8fd92\u4e2a\u5b57\u6bb5\u3002 \u65b0\u589einsert\u65b9\u6cd5 TestCaseDao.py \u5982\u679c\u9879\u76eeid\u548c\u540d\u5b57\u90fd\u4e00\u6837\uff0c\u5219\u8ba4\u4e3a\u8fd9\u4e2a\u7528\u4f8b\u5df2\u5b58\u5728\uff0c\u4e0d\u5141\u8bb8\u7528\u6237\u7ee7\u7eed\u6dfb\u52a0\u3002 \u8fd9\u8fb9\u5bf9\u4e8e\u6743\u9650\u9650\u5236\u7684\u4e0d\u662f\u5f88\u6b7b\uff0c\u6ca1\u6709\u518d \u6821\u9a8c\u7528\u6237\u662f\u5426\u80fd\u591f\u4e3a\u9879\u76ee\u6dfb\u52a0\u7528\u4f8b \u3002 \u6dfb\u52a0\u63a5\u53e3 \u7f16\u8f91 app/controllers/testcase/testcase.py \u6ce8\u610f\u8fd9\u91cc\u6211\u4eec\u5f15\u5165\u4e86 json_validate \u88c5\u9970\u5668\uff0c\u662f\u7528\u6765\u6821\u9a8c\u54b1\u4eec\u7684json\u53c2\u6570\u7684\u3002 testcase\u6570\u636e testcase = { \"type\" : \"object\" , \"properties\" : { \"id\" : { \"type\" : \"integer\" , }, \"name\" : { \"type\" : \"string\" , }, \"request_type\" : { \"type\" : \"integer\" , }, \"url\" : { \"type\" : \"string\" , }, \"request_method\" : { \"type\" : \"string\" , }, \"request_header\" : { \"type\" : \"string\" , }, \"params\" : { \"type\" : \"string\" , }, \"body\" : { \"type\" : \"string\" , }, \"project_id\" : { \"type\" : \"integer\" , }, \"tag\" : { \"type\" : \"string\" , }, \"status\" : { \"type\" : \"integer\" , }, \"priority\" : { \"type\" : \"string\" , }, \"catalogue\" : { \"type\" : \"string\" , }, \"expected\" : { \"type\" : \"string\" , }, }, \"required\" : [ \"expected\" , \"catalogue\" , \"priority\" , \"status\" , \"project_id\" , \"request_type\" , \"url\" , \"name\" ] } \u5176\u5b9e json_schema \u5c31\u662f\u4e00\u4e2a\u63cf\u8ff0json\u6570\u636e\u7ed3\u6784\u7684\u4e00\u4e32json\uff0c\u4e5f\u8bb8\u8fd9\u4e2a\u5f88\u7ed5\u53e3\uff0c\u4f46\u662f\u770b\u56fe\u4e2d\u53ef\u4ee5\u770b\u51fa: type type\u662fjson\u4e32\u7684\u7c7b\u578b\uff0cobject\u4ee3\u8868\u7684\u662f\u4e00\u4e2a\u5bf9\u8c61\uff0c\u5176\u5b9eJSON\u4e3a\u4ec0\u4e48\u53ebJSON\uff0c\u56e0\u4e3a\u5979\u7684\u5168\u540d\u662f: JavaScript Object Notation \uff0c\u7b80\u5355\u7684\u8bf4\u5979\u5c31\u662f\u6765\u63cf\u8ff0JSON\u5bf9\u8c61\u7684\u3002\u9664\u6b64\u4e4b\u5916\uff0c\u8fd8\u6709 integer , string \u7b49\u7b49\u3002 properities \u5c31\u662f\u8fd9\u4e2a\u5bf9\u8c61\u91cc\u9762\u7684\u5c5e\u6027\uff0c\u5373\u5b57\u6bb5\u3002 required \u4e00\u4e2a\u6570\u7ec4\uff0c\u5b58\u653e\u6570\u7ec4\u5fc5\u987b\u7684\u5b57\u6bb5\u3002 \u6d4b\u8bd5\u4e00\u4e0b \u53bb\u6389\u4e00\u4e2a\u5fc5\u987b\u5b57\u6bb5catalogue json schema\u8fd8\u6709\u63a7\u5236\u6570\u5b57\u8303\u56f4\u7b49\u6821\u9a8c\uff0c\u8fd9\u91cc\u6211\u5c31\u4e0d\u591a\u8bb2\u4e86\uff0c\u5927\u5bb6\u6709\u5174\u8da3\u53ef\u4ee5\u81ea\u884c\u67e5\u9605\u3002 \u4eca\u5929\u5185\u5bb9\u4e0d\u591a\uff0c\u591a\u4e86\u6015\u6d88\u5316\u4e0d\u826f\u3002\u6539\u5929\u53ef\u80fd\u7814\u7a76\u4e00\u4e0b httprunner \uff0c\u6bd5\u7adf\u8fd9\u4e2a\u4e5f\u662f\u4e1a\u754c\u4e3b\u6d41\u9879\u76ee\uff0c\u5408\u9002\u7684\u8bdd\u5c31\u7ed9\u517c\u5bb9\u4e86\u5427\uff0c\u8fd9\u6837\u5e73\u53f0\u53d7\u4f17\u9762\u4e5f\u4f1a\u6bd4\u8f83\u5927\u3002","title":"26.\u7f16\u5199\u7528\u4f8b\u8be6\u60c5\u9875(1)"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2827%29%20%E7%BC%96%E5%86%99%E7%94%A8%E4%BE%8B%E8%AF%A6%E6%83%85%E9%A1%B5%282%29/","text":"\u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u7f16\u5199\u597d\u4e86 \u6dfb\u52a0\u7528\u4f8b \u7684\u63a5\u53e3\uff0c\u5e76\u4e14\u91c7\u7528\u4e86jsonschema\u8fdb\u884c\u53c2\u6570\u6821\u9a8c\uff0c\u5f53\u7136\u4e0d\u662f\u5f88\u597d\u7684\u65b9\u5f0f\uff0c\u8d77\u7801\u89e3\u51b3\u4e86\u5b57\u6bb5\u6821\u9a8c\u7684\u95ee\u9898\u3002 \u90a3\u8fd9\u4e00\u8282\u6211\u4eec\u5c31\u6765\u505a2\u4e2a\u4e8b\u60c5\uff0c\u4e00\u4e2a\u662f \u5b8c\u6210\u65b0\u589e\u7528\u4f8b\u7684\u9875\u9762 \uff0c\u53e6\u4e00\u4e2a\u5462\uff0c\u662f \u5c55\u793a\u6211\u4eec\u5df2\u7ecf\u6dfb\u52a0\u597d\u7684\u7528\u4f8b \u3002 \u601d\u8003\u65b0\u589e\u7528\u4f8b\u9875\u9762 \u4e0a\u4e00\u8282\u6211\u4eec\u5df2\u7ecf\u63d0\u4f9b\u4e86\u8fd9\u6837\u4e00\u4e2a\u7528\u4f8b\u6811\u7684\u9875\u9762\uff0c\u6ce8\u610f\u8fd9\u91cc\u6709\u4e2a + \u7684\u6309\u94ae\uff0c\u4f46\u662f\u4e4b\u524d\u5462\uff0c\u4ed6\u662f\u6ca1\u6709\u4efb\u4f55\u6548\u679c\u7684\u3002 \u6211\u8fd9\u91cc\u89e3\u91ca\u4e00\u4e0b\uff0c\u4e3a\u4ec0\u4e48\u70b9\u51fb + \u4e0d\u76f4\u63a5\u5f39\u51fa \u65b0\u589e\u7528\u4f8b \u7684\u8868\u5355\u5462\uff0c\u90a3\u662f\u56e0\u4e3a\u540e\u7eed\u6211\u4eec\u53ef\u80fd\u4f1a\u628a\u7528\u4f8b\u7684\u76ee\u5f55\u7ed9\u653e\u5f00\uff0c\u800c\u4e0d\u662f\u50cf\u73b0\u5728\u8fd9\u6837\u53ea\u6709\u76ee\u5f55/\u7528\u4f8b\uff0c\u6240\u4ee5\u540e\u7eed\u53ef\u80fd\u662f \u6dfb\u52a0\u76ee\u5f55 \u7528\u3002 \u597d\u4e86\uff0c\u6211\u4eec\u73b0\u5728\u8981\u7f16\u5199\u7684\u5c31\u662f\u7528\u4f8b\u7684\u8868\u5355\u3002\u6309\u7167\u9119\u4eba\u7684\u8bbe\u8ba1\uff0c\u91cc\u9762\u5c31\u662f\u586b\u5165\u4e00\u4e9b \u6838\u5fc3 \u6570\u636e\uff0c\u4e5f\u5c31\u662f\u4e00\u4e2a\u7528\u4f8b\u7684\u5fc5\u5907\u5b57\u6bb5\u3002 \u8fd9\u91cc\u6211\u628a\u7528\u4f8b\u7684setup+teardown\u4f1a\u62bd\u51fa\u6765\uff0c\u4f5c\u4e3a\u5355\u72ec\u7684\u6a21\u5757\uff0c\u4e00\u4e2a\u6700\u57fa\u7840\u7684\u7528\u4f8b\u4e0d\u5305\u542bsetUp\u548ctearDown\u3002\u53c8\u7531\u4e8e\u6211\u4eec\u6682\u65f6\u53ea\u652f\u6301\u4e86 HTTP \u8bf7\u6c42\uff0c\u6240\u4ee5\u6838\u5fc3\u5b57\u6bb5\u5982\u4e0b: \u7528\u4f8b\u540d\u79f0 \u7528\u4f8b\u76ee\u5f55 \u4f18\u5148\u7ea7 \u72b6\u6001 \u8bf7\u6c42\u7c7b\u578b tag \u8bf7\u6c42\u65b9\u5f0f \u8bf7\u6c42\u5730\u5740 \u5176\u4ed6\u7684\u4f5c\u4e3a\u53ef\u9009\u6027\uff0c\u5982\u679c\u9700\u8981\u7684\u8bdd\u53ef\u4ee5\u81ea\u884c\u6dfb\u52a0\uff0c\u6bd4\u5982headers\u7b49\u7b49\u3002\u7b14\u8005\u8003\u8651\u7684\u662f\u628a\u8fd9\u4e9b\u4fe1\u606f\u653e\u5165Drawer\u7ec4\u4ef6\u91cc\u9762\uff0c\u4f9b\u7528\u6237\u586b\u5199\u5e76\u63d0\u4ea4\u8868\u5355\u7684\u5f62\u5f0f\u3002 \u4e00\u4e9b\u60f3\u6cd5 \u4e4b\u524d\u7b14\u8005\u662f\u8fb9\u505a\u8fb9\u60f3\uff0c\u53ef\u80fd\u6709\u5f88\u591a\u4e1c\u897f\u5728\u505a\u7684\u65f6\u5019 \u5e76\u4e0d\u5408\u7406 \uff0c\u4e0d\u4f1a\u662f\u4e00\u4e2a\u5f88\u5b8c\u5584\u7684\u7248\u672c\u3002\u6240\u4ee5\u7b14\u8005\u73b0\u5728 \u6539\u53d8\u4e86\u6253\u6cd5 \uff0c\u662f\u5148\u505a\u5b8c\u4e00\u90e8\u5206\uff0c\u7136\u540e\u9488\u5bf9\u8fd9\u90e8\u5206\u5185\u5bb9\u8bb2\u89e3\u3002\u6240\u4ee5\u5982\u4e0b\u662f\u7b14\u8005\u7f16\u5199\u7684\u521d\u7248\u9875\u9762: \u5927\u81f4\u7684\u9875\u9762\u5206\u4e3a2\u4e2a\u90e8\u5206\u5427\uff0c\u5206\u522b\u662f \u7528\u4f8b\u4fe1\u606f \u548c \u8bf7\u6c42\u4fe1\u606f \u3002 \u6539\u9020\u4e4b\u524d\u7684postman\u9875\u9762 \u4e4b\u524d\u7684postman.jsx\u662f\u6ca1\u6709\u5305\u88c5\u8868\u5355\u7ec4\u4ef6\u7684\uff0c\u5565\u610f\u601d\u5462\uff1f\u4e5f\u5c31\u662f\u8bf4\uff0c\u6ca1\u6709\u5982\u4e0b\u8fd9\u79cd\u6548\u679c: Form\u7ec4\u4ef6\u662fantd\u4e2d\u6bd4\u8f83\u91cd\u8981\u7684\u4e00\u79cd\uff0c\u4e13\u95e8\u7528\u4e8e\u8868\u5355\u7684\u6821\u9a8c\u3002 \u4f46\u662f\u56e0\u4e3a\u6211\u4eec\u4e4b\u524d\u7684Postman\u9875\u9762\u9700\u8981\u5f00\u653e\u7ed9\u7528\u6237\u8c03\u8bd5\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u7f16\u5199\u4e00\u4e2a \u65b0\u7684 \u7ec4\u4ef6\uff0c\u53ebPostmanForm.jsx\u3002 \u7531\u4e8e\u540e\u9762\u6211\u4eec\u9700\u8981\u83b7\u53d6\u5230headers\u7684\u503c\uff0c\u6240\u4ee5\u6211\u4eec\u628aheaders/body\u548csetHeaders/setBody\u65b9\u6cd5\u62bd\u79bb\u51fa\u6765\u3002 \u5176\u5b9e\u8fd9\u91cc\u6211\u8981\u8865\u5145\u8bf4\u660e\u4e00\u4e0b\uff0c\u56e0\u4e3a\u5bf9\u4e8ereact\u7684hooks\u7b14\u8005\u4e0d\u662f\u5f88\u719f\u6089\uff0c\u53ef\u80fd\u5b58\u5728\u72b6\u6001\u7ba1\u7406\u6df7\u4e71\u7684\u95ee\u9898\uff0c\u4f46\u662f\u8003\u8651\u5230\u4e4b\u524d\u719f\u6089\u7684DVA\u548cReducers\u76f8\u5173\u7684\u77e5\u8bc6\u8f83\u4e3a\u6666\u6da9\uff0c\u6240\u4ee5\u6211\u8fd9\u8fb9\u5c31\u4e0d\u901a\u4fd7\u5730\u8bb2\u4e86\uff0c\u6bd5\u7adf\u6211\u4eec\u4e5f\u4e0d\u662f\u4e13\u4e1a\u7684\u524d\u7aef\uff0c\u6709\u4e9b\u4e1c\u897f\u8981\u5148\u53bb\u89e3\u51b3\uff0c\u518d\u53bb\u4f18\u5316\u624d\u884c\u3002\u5f53\u7136\uff0c\u5982\u679c\u6709\u5927\u4f6c\u6709\u66f4\u597d\u7684\u5904\u7406\u65b9\u5f0f\uff0c\u7b14\u8005\u4e5f\u613f\u610f\u865a\u5fc3\u5b66\u4e60\u3002 \u6ce8\u610f\uff0c\u6211\u5728url\u548c\u8bf7\u6c42\u65b9\u5f0f\u90fd\u5957\u4e0a\u4e86Form.Item\u8fd9\u4e2a\u7ec4\u4ef6\uff0c\u8fd9\u4e2a\u7ec4\u4ef6\u53ef\u4ee5\u5c06\u4e4b\u53d8\u4e3a\u8868\u5355\u7684\u4e00\u9879\uff0c\u6240\u4ee5\u5c31\u51fa\u73b0\u4e86\u4e0a\u9762gif\u7684\u6548\u679c\u3002\u4f46\u662f\u5374\u4e0d\u5f97\u4e0d\u62c6\u5206\u8fd92\u4e2a\u63a7\u4ef6\uff0c\u4e0d\u7136\u663e\u793a\u4f1a\u6709\u95ee\u9898\u3002 headers\u7531\u4e8e\u662f\u5217\u8868\uff0c\u4e0d\u597d\u652f\u6301form\uff0cbody\u53c8\u662f\u7b2c\u4e09\u65b9\u7ec4\u4ef6\uff0c\u6240\u4ee5\u6211\u4eec\u5c31\u6b64\u522b\u8fc7\u3002\u5176\u4ed6\u7684\u4ee3\u7801\u57fa\u672c\u4e0a\u5dee\u522b\u4e0d\u5927\uff0c\u4e0epostman.jsx\u7c7b\u4f3c\u3002 \u7f16\u5199\u6dfb\u52a0\u7528\u4f8b\u8868\u5355 \u6548\u679c\u56fe \u4ee3\u7801\u90e8\u5206 onOk \u63d0\u4ea4\u8868\u5355\u89e6\u53d1\u7684\u65b9\u6cd5\uff0c\u8fd9\u8fb9\u65b0\u6dfb\u52a0body\u548cheader2\u4e2a\u53c2\u6570\u3002 translateHeaders \u56e0\u4e3a\u6211\u4eec\u7684headers\u662flist\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u8f6c\u6362\u5b83\u4e3a\u5b57\u7b26\u4e32\u3002 Drawer\u4e5f\u5c31\u662f\u56fe\u4e2d\u7684 \u62bd\u5c49 \u7ec4\u4ef6\uff0c\u5b83\u548cmodal\u5f88\u50cf\u3002\u91cc\u9762\u7684footer\u662f\u5b83\u5e95\u90e8\u7684\"\u63d0\u4ea4\"\u548c\"\u53d6\u6d88\"\u6309\u94ae\uff0c\u5206\u522b\u5bf9\u5e94onOk\u548conCancel\u65b9\u6cd5\u3002 \u63a5\u7740\u5c31\u662fForm\u5d4c\u5957\u76842\u4e2a\u5927\u6a21\u5757: \u7528\u4f8b\u4fe1\u606f\u548c\u8bf7\u6c42\u4fe1\u606f\u3002 \u53ef\u4ee5\u770b\u5230 \u7528\u4f8b\u4fe1\u606f \u548c \u8bf7\u6c42\u4fe1\u606f \u90fd\u662fH3\u6807\u7b7e\uff0c\u5e76\u4e14\u7f16\u5199\u4e86border-left\uff0c\u770b\u7740\u5c31\u6709\u56fe\u4e2d\u7684\u6548\u679c\u4e86\u3002 \u4e2d\u95f4\u7684 fields.map \u5c31\u662f\u81ea\u5b9a\u4e49\u7684\u8868\u5355\u7ec4\u4ef6\u4e86\uff0c\u901a\u8fc7\u89e3\u6790json\u5b8c\u6210\u8868\u5355\u7ec4\u4ef6\u7684\u586b\u5199\u3002 \u5176\u5b9e\u8fd9\u4e48\u8bb2\u8d77\u6765\uff0c\u5982\u679c\u4e0d\u61c2React\u7684\u4eba\uff0c\u597d\u50cf\u767d\u8bb2\u4e86\u3002\u3002\u611f\u89c9\u4e0d\u662f\u5f88\u9002\u5408\u5165\u95e8\uff01\uff01\uff01\u03b5=(\u00b4\u03bf\uff40*)))\u5509 \u603b\u4e4b\u5462\uff0c\u5c31\u662f\u5b9e\u73b0\u4e86gif\u7684\u6548\u679c\uff0c\u540e\u9762\u63a5\u7740\u8bb2\u5c55\u793a\u9875\u9762\u3002\u5982\u679c\u5927\u5bb6\u6709\u5174\u8da3\u7684\u8bdd\uff0c\u53ef\u4ee5\u591a\u591a\u8bfe\u4e0b\u719f\u6089\u719f\u6089React\u548cant design\uff0c\u6d4b\u5f00\u7684\u8bdd\u867d\u7136\u505a\u7684\u662f\u5185\u90e8\u5de5\u5177\uff0c\u4f46\u662f\u5982\u679c\u6d89\u53ca\u5230\u56e2\u961f\u534f\u4f5c\uff0c\u5927\u5bb6\u5f88\u591a\u4eba\u7528\u7c7b\u4f3c\u7684\u6280\u672f\u6808\u5b8c\u6210\u4e0d\u540c\u7684\u529f\u80fd\u6a21\u5757\uff0c\u6211\u4e2a\u4eba\u89c9\u5f97\u6d4b\u5f00\u8fd8\u662f\u8981\u5b66\u4e00\u4e9bvue/react\u7684\uff0c\u4e0d\u7136\u7eaf\u7cb9\u505a\u540e\u7aef\u7684\u8bdd\uff0c\u524d\u7aef\u771f\u7684\u5f88\u96be\u627e\u5230 \u5408\u9002\u7684\u4f19\u4f34 \u5e2e\u4f60\u505a\u3002 \u540e\u7aef\u4e5f\u6709\u6539\u52a8 \u65b0\u7684models/TestCase.py from app.models import db from datetime import datetime class TestCase (db.Model) : id = db.Column(db.INT, primary_key= True ) name = db.Column(db.String( 32 ), unique= True , index= True ) request_type = db.Column(db.INT, default= 1 , comment= \"\u8bf7\u6c42\u7c7b\u578b 1: http 2: grpc 3: dubbo\" ) url = db.Column(db.TEXT, nullable= False , comment= \"\u8bf7\u6c42url\" ) request_method = db.Column(db.String( 12 ), nullable= True , comment= \"\u8bf7\u6c42\u65b9\u5f0f, \u5982\u679c\u975ehttp\u53ef\u4e3a\u7a7a\" ) request_header = db.Column(db.TEXT, comment= \"\u8bf7\u6c42\u5934\uff0c\u53ef\u4e3a\u7a7a\" ) # params = db.Column(db.TEXT, comment=\"\u8bf7\u6c42params\") body = db.Column(db.TEXT, comment= \"\u8bf7\u6c42body\" ) project_id = db.Column(db.INT, comment= \"\u6240\u5c5e\u9879\u76ee\" ) tag = db.Column(db.String( 64 ), comment= \"\u7528\u4f8b\u6807\u7b7e\" ) status = db.Column(db.INT, comment= \"\u7528\u4f8b\u72b6\u6001: 1: \u8c03\u8bd5\u4e2d 2: \u6682\u65f6\u5173\u95ed 3: \u6b63\u5e38\u8fd0\u4f5c\" ) priority = db.Column(db.String( 3 ), comment= \"\u7528\u4f8b\u4f18\u5148\u7ea7: p0-p3\" ) catalogue = db.Column(db.String( 12 ), comment= \"\u7528\u4f8b\u76ee\u5f55\" ) # expected = db.Column(db.TEXT, comment=\"\u9884\u671f\u7ed3\u679c, \u652f\u6301el\u8868\u8fbe\u5f0f\", nullable=False) created_at = db.Column(db.DATETIME, nullable= False ) updated_at = db.Column(db.DATETIME, nullable= False ) deleted_at = db.Column(db.DATETIME) create_user = db.Column(db.INT, nullable= False ) update_user = db.Column(db.INT, nullable= False ) def __init__ (self, name, request_type, url, project_id, status, priority, create_user, catalogue, tag=None, request_header=None, body=None, request_method=None) : self.name = name self.request_type = request_type self.url = url self.priority = priority self.project_id = project_id self.tag = tag self.catalogue = catalogue self.status = status # self.expected = expected self.body = body self.create_user = create_user self.update_user = create_user self.request_header = request_header self.request_method = request_method self.created_at = datetime.now() self.updated_at = datetime.now() \u53bb\u6389\u4e86expected\u548cparams\u5b57\u6bb5\uff0c\u56e0\u4e3aparams\u54b1\u4eec\u76ee\u524d\u4f1a\u5e26\u5165url\uff0c\u6240\u4ee5 \u4e0d\u9700\u8981 \u8fd9\u4e2a\u5b57\u6bb5\u4e86\u3002 \u4eca\u5929\u7684\u5185\u5bb9\uff0c\u4e5f\u53ea\u80fd\u5230\u8fd9\u91cc\u4e86\uff0c\u5570\u55e6\u4e86\u8001\u534a\u5929\u4e86\u3002\u4e0b\u4e00\u8282\u5c55\u793a\u7528\u4f8b\u8be6\u60c5\u9875\u3002","title":"27.\u7f16\u5199\u7528\u4f8b\u8be6\u60c5\u9875(2)"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2828%29%20%E7%BC%96%E5%86%99%E7%94%A8%E4%BE%8B%E8%AF%A6%E6%83%85%E9%A1%B5%283%29/","text":"\u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u7f16\u5199\u4e86 \u6dfb\u52a0\u7528\u4f8b \u7684\u8868\u5355\uff0c\u5e76\u4e14\u6210\u529f\u6dfb\u52a0\u4e86\u4e00\u4e9b\u7528\u4f8b\uff0c\u4f46\u662f\u6211\u4eec\u5728 Tree \u91cc\u9762\u70b9\u51fb\u5bf9\u5e94\u7684 \u7528\u4f8b \uff0c\u53f3\u4fa7Card\u8fd8\u662f\u6ca1\u6709\u663e\u793a\u6570\u636e\uff0c\u6240\u4ee5\u4eca\u5929\u6211\u4eec\u5c31\u6765\u628a\u8fd9\u5757\u4fe1\u606f\u8865\u5168\u3002 \u63d2\u66f2 \u5176\u5b9e\u5468\u4e8c\u665a\u4e0a\uff0c\u7b14\u8005\u5c1d\u8bd5\u4e86\u4e00\u4e0b \u5f55\u5236\u89c6\u9891 \u7684\u65b9\u5f0f\uff0c\u56e0\u4e3a\u6211\u89c9\u5f97\u8fd9\u6837\u8282\u7ea6\u65f6\u95f4\uff0c\u8bb2\u5b8c\u4e00\u8282\u8bfe\u5462\uff0c\u6211\u4e5f\u5199\u4e86\u4e00\u90e8\u5206\u4ee3\u7801\u4e86\uff0c\u4e5f\u4e0d\u7528\u53bb\u8f93\u51fa\u5bf9\u5e94\u7684\u6587\u5b57\uff0c\u5341\u5206\u4fbf\u5229\u3002\u4f46\u53d1\u73b0\u6548\u679c\u5f88\u4e00\u822c\uff0c\u6240\u4ee5\u89c6\u9891\u5c31\u592d\u6298\u4e86\u3002\u7b2c\u4e00\u6b21\u8bd5\u8bb2\u5462\uff0c\u603b\u7ed3\u4e86\u4ee5\u4e0b\u51e0\u4e2a\u95ee\u9898: \u6ca1\u6709\u80cc\u7a3f\u5b50\uff0c\u7b80\u5355\u7684\u8bf4\u5c31\u662f\u5373\u5174\u53d1\u6325\uff0c\u6307\u54ea\u6253\u54ea\uff0c\u6beb\u65e0\u7ae0\u6cd5\uff01\u6240\u4ee5\u4e2d\u9014\u4f1a\u9047\u5230\u8ff7\u832b\u671f\uff0c\u4e0d\u77e5\u9053\u8be5\u8bf4\u5565\u5b50\u4e86\u3002\u5c31\u4f1a\u6709\u4e00\u90e8\u5206\u5361\u987f\u7684\u60c5\u51b5\u51fa\u73b0\u3002 \u8033\u9ea6\u8d28\u91cf\u3002\u56e0\u4e3a\u8bbe\u5907\u5f88\u5ec9\u4ef7\uff0c\u7528\u7684\u662f\u5934\u6234\u5f0f\u8033\u673a\u7684\u9ea6\u514b\u98ce\uff0c\u6240\u4ee5\u4f1a\u51fa\u73b0\u5f88\u5927\u7684\u7535\u6d41\u58f0\uff0c\u867d\u7136\u5f55\u5236\u4e4b\u524d\u7a0d\u5fae\u8c03\u8bd5\u8fc7\uff0c\u4f46\u662f\u5f55\u5b8c\u4e86\u53d1\u73b0\u89c6\u9891\u5145\u6ee1\u4e86\u7535\u6d41\u58f0\u3002 \u65f6\u95f4\u628a\u63e1\u7684\u4e0d\u592a\u597d\uff0c\u4e00\u4e0d\u5c0f\u5fc3\u5c31\u8bb2\u4e861\u4e2a\u5c0f\u65f6\u3002\u672c\u6765\u662f\u6253\u7b9740-45\u5206\u949f\u5427\uff0c\u4e00\u96c6\u8fde\u7eed\u5267\u7684\u65f6\u95f4\u3002 \u5f55\u89c6\u9891\u7684\u8bdd\uff0c\u5c31\u6ca1\u6709\u6587\u5b57\u652f\u6491\u4e86\uff0c\u5bf9\u4e8e\u4e0d\u65b9\u4fbf\u770b\u89c6\u9891\u7684\u8bfb\u8005\u5f88\u96be\u53d7\u3002\u5982\u679c\u914d\u4e0a\u6587\u5b57/PPT\uff0c\u90a3\u4e48\u7b14\u8005\u5c31\u66f4\u82b1\u65f6\u95f4\u4e86\u3002 \u6240\u4ee5\u5176\u5b9e\u7ed3\u8bba\u662f \u4eca\u665a\u518d\u6765\u4e00\u96c6 \uff0c\u770b\u770b\u6548\u679c\u5427\uff01 \u6539\u9020project\u63a5\u53e3 \u4e4b\u524d\u6211\u4eec\u8bf4\u8fc7\u4e86\uff0c\u6211\u4eec\u7684\u5b57\u6bb5\u4e0d\u4e00\u5b9a\u5168\uff0c\u5982\u679c\u540e\u7eed\u6211\u4eec\u9700\u8981\u8ddf\u8fdb\u5fae\u670d\u52a1\u9879\u76ee\u7684\u8bdd\uff0c\u90a3\u4e48\u5728\u670d\u52a1\u53d1\u5e03\u7684\u65f6\u5019\u6267\u884c\u5bf9\u5e94\u670d\u52a1\u7684 \u6d4b\u8bd5\u7528\u4f8b \uff0c\u5c31\u662f\u4e00\u4ef6\u5f88\u91cd\u8981\u7684\u4e8b\u60c5\u3002\u6240\u4ee5\u6211\u4eec\u9700\u8981\u7ed9 project \u5b9a\u4e49\u4e00\u4e2a app\u5b57\u6bb5 \uff0c\u4e3a\u4e86\u540e\u9762\u7684\u6301\u7eed\u96c6\u6210\u5de5\u4f5c\u7684\u987a\u5229\u5c55\u5f00\u3002 \u5728models/project.py\u6dfb\u52a0app\u5b57\u6bb5 \u4fee\u6539\u65b0\u589e/\u7f16\u8f91project\u65b9\u6cd5 \u65b0\u589e\u9879\u76ee \u7f16\u8f91\u9879\u76ee \u8c03\u6574\u63a5\u53e3 \u5728\u7f16\u8f91\u548c\u65b0\u589e\u9879\u76ee\u63a5\u53e3\u90fd\u6dfb\u52a0\u4e86 app \u5b57\u6bb5\uff0c\u56e0\u4e3a\u4ee3\u7801\u6539\u52a8\u6bd4\u8f83\u5c0f\uff0c\u5c31\u622a\u56fe\u4e86github\u7684\u63d0\u4ea4\u8bb0\u5f55\uff0c\u65b9\u4fbf\u5bf9\u6bd4\u3002 \u7f16\u5199\u67e5\u8be2\u7528\u4f8b\u4fe1\u606f\u76f8\u5173\u529f\u80fd \u7f16\u5199\u6839\u636e\u7528\u4f8bid\u83b7\u53d6\u7528\u4f8b\u4fe1\u606f\u7684\u63a5\u53e3 \u5728\u6587\u4ef6 app/dao/test_case/TestCaseDao.py \u65b0\u589equery_test_case\u65b9\u6cd5\u3002 \u6bd4\u8f83\u7b80\u5355\uff0c\u6839\u636eid\u67e5\u8be2\u5bf9\u5e94\u7684\u7528\u4f8b\u5373\u53ef\u3002 \u7f16\u5199 /testcase/query \u63a5\u53e3 \u5148\u5224\u65adcase_id\u662f\u5426\u6709\u4f20\u5e76\u4e14\u662f\u5426\u662f\u6570\u5b57\uff0c\u518d\u53bb\u67e5\u8be2\u5bf9\u5e94\u7684\u6570\u636e\u3002 \u7f16\u5199\u524d\u7aef\u90e8\u5206 \u524d\u7aef\u90e8\u5206\u7684\u5185\u5bb9\u8fd9\u6b21\u6539\u52a8\u5e76\u4e0d\u591a\uff0c\u6211\u4eec\u9700\u8981\u5c55\u793a \u7528\u4f8b\u4fe1\u606f \uff0c\u6211\u4eec\u53bb ant design\u5b98\u7f51 \u627e\u5230 Description\u7ec4\u4ef6 \u3002 \u53ef\u4ee5\u770b\u5230\u8fd9\u4e2a\u5c55\u793a\u5217\u8868\uff0c \u57fa\u672c\u4e0a \u7b26\u5408\u6211\u4eec\u7684\u8981\u6c42\u3002\u5148\u770b\u770b\u6210\u54c1: \u867d\u7136\u6837\u5f0f\u4e0d\u662f\u5f88\u597d\u770b\uff0c\u4f46\u662f\u5148\u51d1\u5408\u7528\uff0c\u6bd5\u7adf\u54b1\u4eec\u529f\u80fd\u5148\u884c\u3002 import React, { useEffect, useState } from 'react' ; import { queryTestCase } from '@/services/testcase' ; import auth from '@/utils/auth' ; import { Badge, Col, Descriptions, Row, Tag } from 'antd' ; import { CONFIG } from '@/consts/config' ; export default ({ caseId, userMap }) => { const [data, setData] = useState({ status : 1 , tag : '' }); useEffect( async () => { if (caseId === null ) { return ; } const res = await queryTestCase({ caseId : caseId }); if (auth.response(res)) { setData(res.data); } }, [caseId]); return ( < Row gutter = {[8, 8 ]}> < Col span = {24} > < Descriptions title = '\u7528\u4f8b\u8be6\u60c5' bordered size = 'small' > < Descriptions.Item label = '\u7528\u4f8b\u540d\u79f0' > < a > {data.name} </ a > </ Descriptions.Item > < Descriptions.Item label = '\u7528\u4f8b\u76ee\u5f55' > {data.catalogue} </ Descriptions.Item > < Descriptions.Item label = '\u7528\u4f8b\u4f18\u5148\u7ea7' > { < Tag color = {CONFIG.CASE_TAG[data.priority]} > {data.priority} </ Tag > } </ Descriptions.Item > < Descriptions.Item label = '\u8bf7\u6c42\u7c7b\u578b' > {CONFIG.REQUEST_TYPE[data.request_type]} </ Descriptions.Item > < Descriptions.Item label = '\u8bf7\u6c42\u65b9\u5f0f' > {data.request_method} </ Descriptions.Item > < Descriptions.Item label = '\u7528\u4f8b\u72b6\u6001' > { < Badge { ...CONFIG.CASE_BADGE [ data.status ]} /> } </ Descriptions.Item > < Descriptions.Item label = '\u7528\u4f8b\u6807\u7b7e' span = {2} > { < div style = {{ textAlign: ' center ' }}> {data.tag ? data.tag.split(',').map(v => < Tag style = {{ marginRight: 4 }} color = 'blue' > {v} </ Tag > ): '\u65e0'} </ div > } </ Descriptions.Item > < Descriptions.Item label = '\u521b\u5efa\u4eba' > {userMap[data.create_user] !== undefined ? userMap[data.create_user].name : 'loading...'} </ Descriptions.Item > < Descriptions.Item label = '\u66f4\u65b0\u4eba' > {userMap[data.update_user] !== undefined ? userMap[data.update_user].name : 'loading...'} </ Descriptions.Item > < Descriptions.Item label = '\u521b\u5efa\u65f6\u95f4' > {data.created_at} </ Descriptions.Item > < Descriptions.Item label = '\u66f4\u65b0\u65f6\u95f4' > {data.updated_at} </ Descriptions.Item > < Descriptions.Item label = '\u8bf7\u6c42url' span = {3} > < a href = {data.url} > {data.url} </ a > </ Descriptions.Item > < Descriptions.Item label = '\u8bf7\u6c42Headers' span = {3} > < pre > {data.request_header} </ pre > </ Descriptions.Item > < Descriptions.Item label = '\u8bf7\u6c42body' span = {3} > < pre > {data.body} </ pre > </ Descriptions.Item > </ Descriptions > </ Col > </ Row > ); } \u89e3\u91ca\u4e00\u4e0b\u4ee3\u7801: useEffect caseId \u901a\u8fc7\u7236\u7ec4\u4ef6\u63a7\u5236\uff0c\u5982\u679c\u4e3anull\u5219\u4e0d\u8fdb\u884c\u4efb\u4f55\u64cd\u4f5c\u3002\u5982\u679c\u53d1\u751f\u6539\u53d8\uff0c\u4e14 \u4e0d\u4e3anull \u7684\u60c5\u51b5\u4e0b\uff0c\u5219\u8bf4\u660e\u7528\u6237\u5728\u5207\u6362 \u5de6\u4fa7\u7528\u4f8b \uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u91cd\u65b0\u83b7\u53d6\u7528\u4f8b\u4fe1\u606f\u3002\u4e5f\u5c31\u662f\u6839\u636e caseId \u8c03\u7528 /testcase/query \u63a5\u53e3\u3002 Component\u90e8\u5206 \u57fa\u672c\u4e0a\u662f\u628aantd\u5b98\u7f51\u7684demo\u62ff\u8fc7\u6765\u4fee\u6539\u4e86\u4e00\u4e0b\uff0c\u6ca1\u6709\u592a\u5927\u7684\u6539\u52a8\u3002 \u4e0b\u671f\u9884\u544a \u8fd9\u8282\u6ca1\u6709\u592a\u591a\u5185\u5bb9\uff0c\u53ea\u662f\u628a\u7528\u4f8b\u6570\u636e \u6e32\u67d3 \u4e86\u51fa\u6765\uff0c\u7c7b\u4f3c\u4e8ejmeter\u7684\u524d\u7f6e/\u540e\u7f6e\u64cd\u4f5c\uff0c\u540e\u9762\u4e5f\u4f1a \u9646\u7eed\u5c55\u5f00 \u3002\u6211\u4eec\u6682\u4e14\u5148\u5b9e\u73b0\u4e00\u4e2a\u6700\u57fa\u7840\u7684\u5355\u63a5\u53e3\u6d4b\u8bd5\u3002 \u524d\u7aef\u4ee3\u7801\u4ed3\u5e93: https://github.com/wuranxu/pityWeb \u540e\u7aef\u4ee3\u7801\u4ed3\u5e93: https://github.com/wuranxu/pity","title":"28.\u7f16\u5199\u7528\u4f8b\u8be6\u60c5\u9875(3)"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2829%29%20%E7%BC%96%E5%86%99%E7%94%A8%E4%BE%8B%E6%89%A7%E8%A1%8C%E7%9A%84%E6%96%B9%E6%B3%95/","text":"\u56de\u987e \u4e0a\u671f\u7f16\u5199\u4e86\u7528\u4f8b\u8be6\u60c5\u9875\uff0c\u8fd9\u671f\u6211\u4eec\u5feb\u5200\u65a9\u4e71\u9ebb\uff0c\u6765\u7f16\u5199 \u7528\u4f8b\u6267\u884c\u529f\u80fd \u3002 \u7f16\u5199\u6267\u884c\u7528\u4f8b\u7684\u65b9\u6cd5 \u7531\u4e8e\u4e4b\u524d\u6211\u4eec\u5df2\u7ecf\u7f16\u5199\u8fc7\u4e86 HTTP\u8bf7\u6c42 \u7684\u65b9\u6cd5\uff0c\u6240\u4ee5\u8fd9\u6b21\u6211\u4eec\u5199\u8d77\u6765\u4e8b\u534a\u529f\u500d\uff0c\u53ea\u9700\u8981\u5957\u4e2a\u58f3\u513f\u5c31\u53ef\u4ee5\u4e86\uff01 \u7f16\u5199app/utils/executor.py import json from app.dao.test_case.TestCaseDao import TestCaseDao from app.middleware.HttpClient import Request from app.utils.logger import Log class Executor (object) : log = Log( \"executor\" ) @staticmethod def run (case_id: int) : result = dict() try : case_info, err = TestCaseDao.query_test_case(case_id) if err: return result, err # \u8bf4\u660e\u53d6\u5230\u4e86\u7528\u4f8b\u6570\u636e if case_info.request_header != \"\" : headers = json.loads(case_info.request_header) else : headers = dict() if case_info.body != '' : body = case_info.body else : body = None request_obj = Request(case_info.url, headers=headers, data=body) method = case_info.request_method.upper() response_info = request_obj.request(method) return response_info, None except Exception as e: Executor.log.error( f\"\u6267\u884c\u7528\u4f8b\u5931\u8d25: {str(e)} \" ) return result, f\"\u6267\u884c\u7528\u4f8b\u5931\u8d25: {str(e)} \" \u6ce8\u610f\u8fd9\u91cc\u7684http\u8bf7\u6c42\u5176\u5b9e\u5f88 \u5c40\u9650 \uff0c\u6bd4\u5982\u4e0d\u652f\u6301 \u6587\u4ef6\u4e0a\u4f20 \uff0c\u4e0d\u652f\u6301 cookies \u7b49\u7b49\u3002\u4f46\u662f\u540e\u7eed\u54b1\u4eec\u53ef\u4ee5\u6162\u6162\u513f\u6765\u5b8c\u5584\u3002 \u7f16\u5199\u63a5\u53e3 \u8c03\u7528\u4e00\u4e0bExecutor\u7c7b\u7684run\u65b9\u6cd5\u5373\u53ef\u3002 \u7f16\u5199\u524d\u7aef\u90e8\u5206 \u7f16\u5199\u8c03\u7528\u540e\u7aef\u7684\u65b9\u6cd5: /request/run \u65b0\u589eplay icon \u8fd9\u91cc\u53eaconsole.log\u8f93\u51fa\u4e86\u6267\u884c\u7ed3\u679c\uff0c\u56e0\u4e3a\u8003\u8651\u5230\u6267\u884c\u7ed3\u679c\u62a5\u544a\u5316\uff0c\u4ee5\u53ca\u540e\u7eed\u9700\u8981 \u6709\u7ec4\u7ec7\u6709\u7eaa\u5f8b \uff0c\u8fd8\u80fd\u968f\u65f6\u67e5\u8be2\u5230\u5386\u53f2\u62a5\u544a\uff0c\u6240\u4ee5\u540e\u9762 \u6d4b\u8bd5\u62a5\u544a \u9875\u9762\u662f\u5fc5\u4e0d\u53ef\u5c11\u7684\u3002\u8fd9\u8fb9\u6ca1\u6709\u843d\u5e93\u4e5f\u6ca1\u6709\u505a\u4efb\u4f55\u64cd\u4f5c\uff0c\u662f\u56e0\u4e3a\u597d\u4e1c\u897f\u8981\u7559\u5230\u540e\u5934\u3002 \u914d\u5bf9\u89c6\u9891: \u6d4b\u8bd5\u5e73\u53f0\u7cfb\u521702","title":"29.\u7f16\u5199\u7528\u4f8b\u6267\u884c\u7684\u65b9\u6cd5"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%283%29%20%E7%BB%99Hello%20World%E6%B7%BB%E5%8A%A0%E6%97%A5%E5%BF%97/","text":"\u7ed9Hello World\u6dfb\u52a0\u65e5\u5fd7 \u56de\u987e \u901a\u8fc7\u4e0a\u7bc7\u5185\u5bb9\uff0c\u6211\u4eec\u5df2\u7ecf\u4f7f\u7528 Flask \u5b8c\u6210\u4e86\u6211\u4eec\u7684\u7b2c\u4e00\u4e2a\u63a5\u53e3\u3002\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c\u4f7f\u7528 Flask \u6765\u7f16\u5199\u63a5\u53e3\u662f\u5341\u5206\u7b80\u5355\u7684\u3002\u90a3\u4e48\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u4e30\u5bcc\u4e00\u4e0b\u4e0a\u9762\u7684\u4f8b\u5b50\u3002 \u9700\u6c42 \u73b0\u5728\u7684\u9700\u6c42\u6765\u4e86\uff0c\u5728\u6211\u4eec\u5e73\u65f6\u7684\u5f00\u53d1\u8fc7\u7a0b\u4e2d\uff0c\u603b\u4f1a\u9047\u5230\u4e00\u4e9b\u95ee\u9898\u3002\u4f46\u662f\u53c8\u4e0d\u662f\u5fc5\u73b0\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4e00\u4e9b\u624b\u6bb5\u6765\u5199\u5165\u65e5\u5fd7\uff0c\u53bb\u53d1\u73b0\u95ee\u9898\u3002\u4e00\u4e2a\u5f88\u660e\u663e\u7684\u4f8b\u5b50\u5c31\u662ftry/exception\uff0c\u9047\u5230\u672a\u77e5\u95ee\u9898\u7684\u65f6\u5019\u53ef\u4ee5\u5c06\u95ee\u9898\u8bb0\u5f55\u81f3\u65e5\u5fd7\u5e76\u5728\u4e8b\u540e\u6392\u67e5\u3002 \u65e5\u5fd7\u6a21\u5757\u9009\u7528 logging \u6211\u4eec\u77e5\u9053\uff0c\u5728Python\u4e2d\u6709\u7cfb\u7edf\u81ea\u5e26\u7684\u529f\u80fd\u53ca\u5176\u5f3a\u5927\u7684logging\u6a21\u5757\u4f9b\u6211\u4eec\u4f7f\u7528\uff0c\u5b83\u7684\u5f3a\u5927\u4e0d\u591a\u505a\u4ecb\u7ecd\u4e86\u3002\u7f51\u4e0a\u7684demo\u5f88\u591a\uff0c\u7a0d\u5faecopy\u4e00\u4e2a\u65e5\u5fd7\u7c7b\u5c31\u80fd\u4f7f\u7528\u3002 logbook \u8fd9\u91cc\u6211\u91c7\u7528\u7684\u662fgithub\u4e0a\u7684 logbook \u5e93\uff0c\u5355\u770bapi\u8c03\u7528\u7684\u8bdd\uff0c\u6bd4logging\u65b9\u4fbf\u8f83\u591a\u3002\u53ef\u80fd\u56e0\u4e3a\u6211\u662f\u4e2a\u559c\u6b22\u5c1d\u9c9c\u7684\u4eba^_^ \u5b89\u88c5logbook \u5728\u7ec8\u7aef\u8f93\u5165 pip3 install logbook \u5e76\u56de\u8f66\u3002 \u5206\u7c7b \u65e5\u5fd7\u6a21\u5757\u5c5e\u4e8epity\u7684\u5de5\u5177\u7c7b\uff0c\u7b14\u8005\u5c06\u4e4b\u5212\u5206\u5230app/utils\u4e0b\u3002 \u7f16\u5199\u65e5\u5fd7\u7c7b import logbook from app import pity class Log (object) : handler = None def __init__ (self, name= 'pity' , filename=pity.config[ 'LOG_NAME' ]) : # Logger\u6807\u8bc6\u9ed8\u8ba4\u4e3aapp \"\"\" :param name: \u4e1a\u52a1\u540d\u79f0 :param filename: \u6587\u4ef6\u540d\u79f0 \"\"\" self.handler = logbook.FileHandler(filename, encoding= 'utf-8' ) self.logger = logbook.Logger(name) self.handler.push_application() def info (self, *args, **kwargs) : return self.logger.info(*args, **kwargs) def error (self, *args, **kwargs) : return self.logger.error(*args, **kwargs) def warning (self, *args, **kwargs) : return self.logger.warning(*args, **kwargs) def debug (self, *args, **kwargs) : return self.logger.debug(*args, **kwargs) \u5728\u8fd9\u91cc\uff0c\u6211\u4eec\u5b9a\u4e49\u4e86\u4e00\u4e2a Log \u7c7b\uff0c\u8fd9\u4e2a\u7c7b\u63a5\u53d7\u7684name\u662f\u65e5\u5fd7\u7684\u5206\u7c7b\uff0c\u5982\u679c\u4e0d\u4f20\u5165\u5219\u9ed8\u8ba4\u4e3a pity \uff0cfilename(\u65e5\u5fd7\u6587\u4ef6\u540d)\u9ed8\u8ba4\u503c\u4e3a\u5f15\u5165config.py\u4e2d\u914d\u7f6e\u7684 LOG_NAME \u3002 \u7136\u540e\u5c06logbook\u4e2d\u7684handler\u8bbe\u4e3a\u5199\u5165\u7684\u6587\u4ef6\uff0c\u5e76\u5c06info/error/warning/debug\u7b49\u5e38\u7528\u65b9\u6cd5\u5c01\u88c5\u5728Log\u7c7b\u4e2d\u3002 \u4fee\u6539run.py from server.app import app from server.app.utils.logger import Log @app.route('/') def hello_world () : log = Log( \"hello world\u4e13\u7528\" ) log.info( \"\u6709\u4eba\u8bbf\u95ee\u4f60\u7684\u7f51\u7ad9\u4e86\" ) return 'Hello World!' if __name__ == '__main__' : app.run() \u8fd0\u884crun.py \u8fdb\u5165\u6d4f\u89c8\u5668\u8f93\u5165http://localhost:5000 \u62a5\u9519\u622a\u56fe \u53d1\u73b0\u5c45\u7136\u62a5\u9519\u4e86\uff0c\u6211\u4eec\u4ed4\u7ec6\u67e5\u770b\u4e0b\u63a7\u5236\u53f0: \u63a7\u5236\u53f0\u62a5\u9519\u4fe1\u606f \u770b\u63d0\u793a\u662f \u6ca1\u6709\u627e\u5230\u5bf9\u5e94\u7684\u6587\u4ef6\u6216\u76ee\u5f55 , \u539f\u6765\u6211\u4eec\u7684pity\u76ee\u5f55\u4e0b\u6ca1\u6709 logs \u76ee\u5f55, \u800c\u8fd9\u79cd\u65e5\u5fd7\u5e93\u4e00\u822c\u4e5f\u4e0d\u4f1a\u5e2e\u5fd9\u521b\u5efa\u76ee\u5f55\uff0c\u6240\u4ee5\u6211\u4eec\u6682\u65f6\u624b\u52a8\u5728pity\u76ee\u5f55\u4e0b\u5efa\u7acblogs\u76ee\u5f55\u5373\u53ef\u3002 \u5efa\u7acb\u4ee5\u540e\u91cd\u542f\u670d\u52a1, \u518d\u6b21\u5c1d\u8bd5 \u3002 \u6210\u529f\u622a\u56fe \u67e5\u770blogs/pity.log\u6587\u4ef6 \u53ef\u4ee5\u770b\u5230\uff0c\u65e5\u5fd7\u6587\u4ef6\u914d\u7f6e\u751f\u6548\uff0c\u5988\u5988\u518d\u4e5f\u4e0d\u7528\u62c5\u5fc3\u6211\u610f\u5916\u51fa\u9519\u4e86\u3002 \u5c06\u65e5\u5fd7\u7c7b\u6539\u4e3a\u5355\u4f8b\u6a21\u5f0f(\u9009\u4fee\u8bfe) \u7f16\u8f91utils/decorator.py ''' \u8fd9\u662f\u4e00\u4e2a\u88c5\u9970\u5668\u65b9\u6cd5\u6587\u4ef6 ''' class SingletonDecorator : def __init__ (self, cls) : self.cls = cls self.instance = None def __call__ (self, *args, **kwds) : if self.instance is None : self.instance = self.cls(*args, **kwds) return self.instance \u5982\u56fe\u6240\u793a\uff0c\u8fd9\u662f\u4e00\u4e2a\u5355\u4f8b\u7c7b\u7684\u88c5\u9970\u5668\u3002\u9996\u5148\u5224\u65ad\u8be5\u7c7b\u7684\u5b9e\u4f8b\u662f\u5426\u662fNone\uff0c\u4e3aNone\u7684\u8bdd\u5219\u751f\u6210\u65b0\u5b9e\u4f8b\uff0c\u5426\u5219\u8fd4\u56de\u8be5\u5b9e\u4f8b\u3002\u8fd9\u6837\u5c31\u786e\u4fdd\u4e86\u53ea\u751f\u6210\u4e00\u6b21\u5b9e\u4f8b\u3002 \u5f53\u7136\u8fd9\u53ea\u662f\u4e00\u4e2a\u529e\u6cd5\uff0c\u53ef\u80fd\u5728\u591a\u7ebf\u7a0b\u7684\u60c5\u51b5\u4e0b\u4f1a\u51fa\u95ee\u9898\u3002\u540e\u7eed\u7684\u4f18\u5316\u548c\u4e86\u89e3\uff0c\u5c31\u4ea4\u7ed9\u540c\u5b66\u4eec\u81ea\u5df1\u4e86\u3002 \u7ed9Log\u7c7b\u52a0\u4e0a\u88c5\u9970\u5668 import logbook from app import pity from .decorator import SingletonDecorator # \u6ce8\u610f\u8fd9\u91cc @SingletonDecorator class Log (object) : handler = None def __init__ (self, name= 'pity' , filename=pity.config[ 'LOG_NAME' ]) : # Logger\u6807\u8bc6\u9ed8\u8ba4\u4e3aapp \"\"\" :param name: \u4e1a\u52a1\u540d\u79f0 :param filename: \u6587\u4ef6\u540d\u79f0 \"\"\" self.handler = logbook.FileHandler(filename, encoding= 'utf-8' ) self.logger = logbook.Logger(name) self.handler.push_application() def info (self, *args, **kwargs) : return self.logger.info(*args, **kwargs) def error (self, *args, **kwargs) : return self.logger.error(*args, **kwargs) def warning (self, *args, **kwargs) : return self.logger.warning(*args, **kwargs) def debug (self, *args, **kwargs) : return self.logger.debug(*args, **kwargs) \u4f5c\u4e1a \u53d1\u73b0\u4e00\u4e2a\u5c0f\u95ee\u9898\uff0c\u65e5\u5fd7\u7684\u65f6\u95f4\u4f3c\u4e4e\u4e0d\u5bf9\uff0c\u53ef\u80fd\u662f\u54ea\u91cc\u51fa\u4e86\u95ee\u9898\u5462\uff1f \u5168\u90e8\u4ee3\u7801\u5730\u5740: https://github.com/wuranxu/pity \u89c9\u5f97\u6709\u7528\u7684\u8bdd\u53ef\u4ee5\u5e2e\u5fd9\u70b9\u4e2aStar\u54e6QAQ","title":"3.\u7ed9Hello World\u6dfb\u52a0\u65e5\u5fd7"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2830%29%20%E5%AE%8C%E5%96%84%E6%96%AD%E8%A8%80%E9%83%A8%E5%88%86/","text":"\u601d\u8003 \u8fd9\u4e2a\u7cfb\u5217\u6ee1\u6253\u6ee1\u7b97\u5df2\u7ecf\u4e00\u4e2a\u6708\u6ca1\u6709\u66f4\u65b0\u4e86\uff0c\u54b1\u867d\u7136\u6c34\u6587\uff0c\u4f46\u662f\u6b63\u4e8b\u8fd8\u662f\u5f97\u5e72\u7684\u3002\u5176\u5b9e\u6709\u65f6\u5019\u6211\u5728\u60f3\uff0c\u7c7b\u4f3c\u7684\u5e73\u53f0\u5df2\u7ecf\u6709\u996d\u4f6c\u8fd9\u5ea7\u9ad8\u5c71\u4e86\uff0c\u6211\u8fd8\u771f\u7684\u6709\u5199\u4e0b\u53bb\u7684\u5fc5\u8981\u5417\uff1f\u4e0d\u7ba1\u600e\u4e48\u8bf4\uff0c \u5199\u70b9\u81ea\u5df1\u559c\u6b22\u7684\u5185\u5bb9\u5427 \uff0c\u54ea\u6015\u662f\u5199\u7ed9\u81ea\u5df1\u770b\u4e5f\u6210\uff0c\u6bd5\u7adf\u81ea\u5df1\u6682\u65f6\u6ca1\u6709\u518d\u505a\u5176\u4ed6\u65b9\u9762\u7684\u5e73\u53f0\u4e86\u3002 \u56de\u987e \u4e0a\u6b21\u5199\u5230\u4e86\u7528\u4f8b\u8be6\u60c5\u9875\u9762\uff0c\u53ef\u4ee5\u6dfb\u52a0\u5bf9\u5e94\u7684\u7528\u4f8b\u4e86\u5e76 \u5728\u7ebf\u6267\u884c \u4e86~ \u7406\u6027\u5206\u6790\u4e00\u4e0b\uff0c\u54b1\u4eec\u8fd8\u7f3a\u5565\uff1f\u5176\u5b9e\u4e0d\u7528\u5206\u6790\uff0c\u7f3a\u7684\u4e1c\u897f\u5f88\u591a\uff0c\u6bd4\u5982: \u8c03\u8bd5\u7ed3\u679c\u600e\u4e48\u5c55\u793a\uff0c\u6d4b\u8bd5\u96c6\u600e\u4e48\u505a\uff0c\u6700\u7ec8\u6d4b\u8bd5\u62a5\u544a\uff0c\u5168\u5c40\u53d8\u91cf\u7b49\u7b49\u3002 \u7531\u4e8e\u6700\u8fd1\u505a\u7684\u90fd\u662f\u4e1a\u52a1\u6d4b\u8bd5\uff0c\u6709\u6d89\u53ca\u5230\u63a5\u53e3\u90e8\u5206\u7684\uff0c\u6240\u4ee5\u6211\u9488\u5bf9\u81ea\u5df1\u7684\u4f7f\u7528\uff0c\u7ed9\u81ea\u5df1\u63d0\u4e86\u4e00\u4e9b\u4f18\u5316\u7684\u5185\u5bb9\u3002 \u56e0\u4e3a\u5e73\u65f6 Yapi \u7528\u7684\u4e5f\u6bd4\u8f83\u591a\uff0c\u6240\u4ee5\u4e2a\u4eba\u8fd8\u662f\u51b3\u5b9a\u4e0eYapi\u8fdb\u884c\u6253\u901a\uff0c\u6839\u636eyapi\u7684\u63a5\u53e3\u6587\u6863\u53bb\u667a\u80fd\u5730\u751f\u6210\u4e00\u4e9b\u57fa\u7840\u7528\u4f8b\u3002 \u5927\u5bb6\u5982\u679c\u6709\u60f3\u6cd5\uff0c\u4e5f\u53ef\u4ee5\u548c\u6211\u8ba8\u8bba\uff0c\u6b22\u8fce\u2795\u6211\u7684\u5fae\u4fe1: wuranxu \u3002\u76ee\u524d\u5462\uff0c\u6709\u4e9b\u5730\u65b9\u6211\u4e5f\u6ca1\u6709\u786e\u5b9a\u6e05\u695a\uff0c\u4ee5\u4e0a\u90fd\u662f\u6211\u5728\u771f\u5b9e\u4f7f\u7528\u8fc7\u7a0b\u4e2d\u9047\u5230\u7684\u4e00\u4e9b\u4e0d\u597d\u7684\u5730\u65b9\u3002 \u81ea\u5df1\u505a\u7684\u4e1c\u897f\uff0c\u81ea\u5df1\u4e00\u5b9a\u8981\u4eb2\u8eab\u53bb\u4f53\u9a8c\uff0c\u8fd9\u6837\u624d\u77e5\u9053\u54ea\u91cc\u4e0d\u987a\u624b\uff0c\u54ea\u91cc\u4e0d\u597d\u7528\u3002\u542c\u53d6\u522b\u4eba\u7684\u5efa\u8bae\u662f\u5173\u952e\uff0c\u81ea\u5df1\u6709\u5207\u8eab\u4f53\u4f1a\u4e5f\u662f\u5173\u952e\u3002 \u4fee\u590dsqlalchemy\u8fde\u63a5\u7684\u95ee\u9898 \u5728\u6211\u81ea\u5df1\u4f7f\u7528\u7684\u8fc7\u7a0b\u4e2d\uff0c\u53d1\u73b0sqlalchemy\u7684Session\u4f1a\u81ea\u52a8\u8fc7\u671f\u3002\u5565\u610f\u601d\u5462\uff0c\u9ed8\u8ba4\u7684Session\u5efa\u7acb\u7684\u65f6\u5019\uff0c\u8fde\u63a5\u662f \u4e0d\u4f1a\u88ab\u91ca\u653e \u7684\u3002\u4f46\u662f\u5462\uff0cmysql\u7684\u6bcf\u4e2a\u8fde\u63a5\u4f1a\u6709\u4e2a\u9ed8\u8ba4\u7684\u8fc7\u671f\u65f6\u95f4\uff0c\u56e0\u4e3a\u4e00\u4e2a\u8fde\u63a5\u5982\u679c\u957f\u65f6\u95f4\u4e0d\u5de5\u4f5c\uff0c\u5c31\u662f \u6d6a\u8d39\u8d44\u6e90 \uff0c\u6240\u4ee5Mysql\u6709\u8fd9\u6837\u7684\u8bbe\u5b9a\u3002 \u56fe\u4e2d\u53ef\u4ee5\u770b\u5230\u8d85\u65f6\u65f6\u95f4\u662f1800\u79d2\u4e5f\u5c31\u662f30\u5206\u949f \u8fd9\u6837\u5c31\u51fa\u73b0\uff0csqlalchemy\u53d6\u51fa\u7684session\u5728mysql\u4e2d\u5df2\u7ecf\u8fc7\u671f\u4e86\uff0c\u901a\u4fd7\u70b9\u6765\u8bb2\u5c31\u662f\uff0c\u4f6030\u5206\u949f\u6ca1\u6709\u7528\u5e73\u53f0\uff0c\u518d\u8c03\u6d89\u53ca\u5230\u6570\u636e\u5e93\u7684\u63a5\u53e3\u7684\u65f6\u5019\uff0c\u5c31\u63d0\u793a\u4f60Mysql Connection not variable\u3002 \u6dfb\u52a0pool_recycle\u53c2\u6570\uff08\u7f29\u77ed\u6211\u4eec\u8fde\u63a5\u56de\u6536\u7684\u65f6\u95f4\uff0c\u5c0f\u4e8ewait_timeout\uff09 \u6269\u5927Mysql\u7684\u8d85\u65f6\u65f6\u95f4\uff0c\u8fd9\u4e2a\u9700\u8981\u6539mysql\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684wait_timeout\u53c2\u6570\uff0c\u6709\u7684\u4eba\u4f1a\u8bbe\u7f6e\u4e3a8\u5c0f\u65f6 \u6dfb\u52a0\u7f16\u8f91\u7528\u4f8b\u7684\u529f\u80fd \u540e\u7aef\u63a5\u53e3\u6539\u9020\uff0c\u7f16\u5199update\u529f\u80fd \u8fd9\u8fb9\u6709\u4e00\u70b9\u9700\u8981\u6ce8\u610f\uff0c\u5148\u901a\u8fc7testcase\u7684id\u548cdeleted_at\u5b57\u6bb5\u53d6\u5230\u6570\u636e\uff0c\u7136\u540e\u8c03\u7528\u4e86 update_model \u65b9\u6cd5\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u7684\u4f5c\u7528\u662f\u5565\u5462\uff0c\u5c31\u662f\u901a\u8fc7setattr\u628aForm\u8868\u5355\u7684\u5185\u5bb9\u8d4b\u4e88\u8fd9\u4e2a\u6570\u636e\u5e93\u5bf9\u8c61\u3002 \u4ee5\u5f80\u6211\u4eec\u7684\u624b\u6bb5\u90fd\u5f88 \u62d9\u52a3 \uff0c\u5982\u679c\u8981\u4fee\u6539testcase\u8fd9\u4e2a\u5bf9\u8c61\uff0c\u6211\u4eec\u4f1a\u7528 data.xxx = xxx \uff0c\u8fd9\u6837\u6548\u7387\u8f83\u4f4e\uff0c\u800c\u4e14\u4ee3\u7801\u91cf\u5f88\u591a\u3002\u7531\u4e8e\u6211\u4eec\u548cPydantic\u8fdb\u884c\u4e86\u6253\u901a\uff0c\u91cc\u9762\u63a5\u53d7\u7684\u5b57\u6bb5\u540d\u5b57\u548c\u6211\u4eecdb\u4e2d\u7684\u5b57\u6bb5\u540d\u5b57\u662f\u4e00\u6837\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5199\u4e00\u4e2a\u901a\u7528\u7684\u529e\u6cd5\u3002 dist\u53c2\u6570\u662f\u88ab\u4fee\u6539\u7684\u5bf9\u8c61 source\u662fPydantic\u7684BaseModel\uff0c\u4e5f\u5c31\u662f\u54b1\u4eec\u5728web\u9875\u9762\u7684\u8868\u5355\u6570\u636e not_null\u662f\u4e2a\u53ef\u9009\u53c2\u6570\uff0c\u5982\u679c\u662fTrue\u7684\u8bdd\uff0c\u90a3\u4e48\u53ea\u6709\u975e\u7a7a\u5b57\u6bb5\u4f1a\u88ab\u66f4\u65b0\uff0c\u8fd9\u70b9\u501f\u9274\u4e86gorm update_user\uff0c\u7531\u4e8e\u6211\u4eec\u7684\u6bcf\u6761\u6570\u636e\u90fd\u5e26\u6709\u8fd9\u4e2aupdated_at, update_user\u4fe1\u606f\uff0c\u6240\u4ee5\u5728update\u7684\u65f6\u5019\u6211\u4eec\u81ea\u52a8\u8bbe\u7f6e\u4e3a\u5f53\u524d\u65f6\u95f4 \u6ce8\u91ca: setattr\u53ef\u4ee5\u52a8\u6001\u8bbe\u7f6e\u5bf9\u8c61\u7684\u5c5e\u6027\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u5bf9\u8c61\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f\u5b57\u6bb5\u540d\uff0c\u7b2c\u4e09\u4e2a\u53c2\u6570\u662f\u5177\u4f53\u7684\u503c\uff0c\u4e0e\u4e4b\u5bf9\u5e94\u7684\u8fd8\u6709getattr \u540e\u7aef\u63a5\u53e3\u5c42 \u524d\u7aef\u903b\u8f91\u7684\u6539\u9020 pityWeb\\src\\components\\TestCase\\TestCaseDetail.jsx \u548c\u521b\u5efa\u903b\u8f91\u7c7b\u4f3c\uff0c\u5728\u70b9\u51fb \u4fdd\u5b58 \u6309\u94ae\u7684\u65f6\u5019\uff0c\u8c03\u7528 onFinish \u65b9\u6cd5\uff0c\u5148\u53bb\u641c\u96c6\u8868\u5355\u7684\u6570\u636e\uff0curl\uff0cheaders\u7b49\u7b49\uff0c\u6700\u540e\u8c03\u7528updateTestCase\u63a5\u53e3\u3002\u6700\u540e\u5c31\u662f\u8c03\u7528init()\u65b9\u6cd5\u91cd\u65b0\u83b7\u53d6\u7528\u4f8b\u7684\u6570\u636e\u3002 \u8c03\u6574\u4e00\u4e0b\u7528\u4f8b\u6811 \u653e\u5f03\u4e4b\u524d\u7684\u7a81\u5140\u5730\u8ba9\u7528\u6237\u9009\u62e9\u7528\u4f8b\uff0c\u4ee5\u8bf4\u660e\u4e66\u7684\u65b9\u5f0f\u8ba9\u7528\u6237\u660e\u767d\u9700\u8981\u70b9\u51fb\u5de6\u4fa7\u7684\u6811\u3002\u5de6\u4fa7\u7684\u6811\u540e\u9762\u9700\u8981\u53ef\u4ee5\u9009\u4e2d\uff0c\u4ee5\u4fbf\u4e8e \u6267\u884c\u591a\u6761\u7528\u4f8b \u548c \u6d4b\u8bd5\u96c6\u6dfb\u52a0 \u7b49\u7b49\u3002 \u7528\u4f8b\u8be6\u60c5\u8c03\u6574 \u5148\u8bf4\u660e\u4e00\u4e0b\uff0c\u8fd9\u5757\u6211\u4e00\u76f4\u89c9\u5f97\u4e0d\u662f\u592a\u7f8e\u89c2\uff0c\u6211\u53ea\u80fd\u8bf4\u8fd9\u80af\u5b9a\u4e0d\u662f\u6700\u7ec8\u6548\u679c\u3002\u6211\u628aheaders\u66ff\u6362\u6210\u4e86\u8868\u683c\uff0c\u628abody\u66ff\u6362\u6210\u4e3a\u4e86json\uff0c\u56e0\u4e3a\u6211\u4eec\u6682\u65f6\u53ea\u652f\u6301JSON\u3002 \u9ad8\u4eae\u4ee3\u7801\u5757\uff0c\u9700\u8981\u5b89\u88c5 react-syntax-highlighter npm install react-syntax-highlighter --save \u4f7f\u7528 \u5148\u5bfc\u5165\u5bf9\u5e94\u7684\u5e93\u548c\u6837\u5f0f\uff0c\u6211\u8fd9\u91cc\u9009\u62e9\u7684\u662fvs2015\uff0c\u518d\u628a\u5b57\u7b26\u4e32\u653e\u5165SyntaxHighlighter\u7ec4\u4ef6\u5185\u5373\u53ef\u3002 \u540e\u7eed\u9884\u544a \u7cfb\u7edf\u8bbe\u7f6e \u5305\u62ecyapi\u76f8\u5173\u914d\u7f6e\uff0c\u7528\u4f8b\u4e0eyapi\u7684\u6253\u901a\uff0c\u81ea\u52a8\u751f\u6210\u7528\u4f8b\u3002 \u6d4b\u8bd5\u62a5\u544a \u6d4b\u8bd5\u7528\u4f8b\u6267\u884c\u8be6\u60c5\u5c55\u793a\u7b49\u3002 \u5168\u5c40\u53d8\u91cf \u5305\u62ec\u73af\u5883\u914d\u7f6e\uff0c\u5730\u5740\u7ba1\u7406\u7b49\u7b49\u3002 \u5b9a\u65f6\u4efb\u52a1 \u8fd9\u5757\u53ef\u80fd\u7528go\u53bb\u5199\uff0c\u4e5f\u53ef\u80fd\u7528celery\u3002 \u6d4b\u8bd5\u96c6 \u5f85\u5b9a\u3002 \u524d\u7aef\u4ee3\u7801\u4ed3\u5e93: https://github.com/wuranxu/pityWeb \u540e\u7aef\u4ee3\u7801\u4ed3\u5e93: https://github.com/wuranxu/pity","title":"30.\u5b8c\u5584\u65ad\u8a00\u90e8\u5206"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2831%29%20%E7%BC%96%E5%86%99%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E9%A1%B5%E9%9D%A2%28%E4%B8%8A%29/","text":"\u5927\u5bb6618\u597d\u5440\uff01 \u8fd9\u4e2a\u7cfb\u5217\u597d\u50cf\u66f4\u65b0\u8fdb\u5ea6\u5f88\u6162\u4e86\uff0c\u6700\u8fd1\u4e3b\u8981\u4ee5\u6c34\u6587\u4e3a\u4e3b\u3002\u4eca\u5929\u5929\u6c14\u6bd4\u8f83\u5dee\uff0c\u6253\u7b97\u6765\u70b9\u5e72\u8d27\u3002\u6070\u5de7\u996d\u54e5\u4e5f\u5728 \u5750\u53f0 (\u5750\u5728\u8bb2\u53f0)\uff0c\u6240\u4ee5\u6211\u5c31\u4e0d\u5ba2\u6c14\u4e86\uff01 \u7f16\u5199\u73af\u5883\u7ba1\u7406\u9875\u9762 \u4e4b\u524d\u7684\u7bc7\u5e45\u91cc\u9762\u8bf4\u8fc7\uff0c\u7528\u4f8b \u6ca1\u6709\u6839\u636e\u73af\u5883 \u53bb\u5212\u5206\u5b83\u7684\u5f52\u5c5e\uff0c\u5176\u5b9e\u8fd9\u6837\u4e5f\u662f\u4e0d\u592a\u5408\u7406\u7684\uff0c\u6bd5\u7adf\u4e0d\u540c\u7684\u73af\u5883\u9700\u8981\u7684\u6570\u636e\u53ef\u80fd\u4e0d\u4e00\u81f4\uff0c\u5e76\u4e0d\u4e00\u5b9a\u80fd\u7f16\u5199\u5b8c\u5168\u901a\u7528\u7684\u7528\u4f8b\u3002\u6240\u4ee5\u4eca\u5929\u6211\u6253\u7b97\u4ece\u8fd9\u4e2a\u9875\u9762\u4e0b\u624b\uff0c \u624b\u628a\u624b \u6559\u5927\u5bb6\u7f16\u5199\u4e00\u4e2a\u5b8c\u6574\u7684CRUD\u529f\u80fd(\u5e26\u524d\u7aef+\u8054\u8c03)\u3002\u540e\u9762\u524d\u7aef\u7684\u90e8\u5206\uff0c\u5982\u679c\u5927\u5bb6\u4e0d\u611f\u5174\u8da3\u7684\u8bdd\uff0c\u53ea\u770b \u540e\u7aef \u5c31\u597d\u4e86\u3002\u56e0\u4e3a\u4f1a\u6709\u4e00\u7cfb\u5217\u7684\u622a\u56fe\uff01\u770b\u5b8c\u4e0d\u8bf4\u534a\u6761\u547d\uff0c\u90a3\u534a\u5c0f\u65f6\u80af\u5b9a\u6ca1\u4e86\u3002 \u6709\u7684\u4eba\u53ef\u80fd\u4e0d\u7406\u89e3\uff0c\u73af\u5883\u4e0d\u5c31\u662f\u90a3\u51e0\u5957\u5417\uff1f\u6d4b\u8bd5/\u9884\u53d1/\u7ebf\u4e0a\u7b49\u7b49\u3002\u662f\u7684\uff0c\u4f46\u662f\u5404\u4e2a\u516c\u53f8\u4f1a\u53eb\u4e0d\u540c\u7684\u540d\u5b57\uff0c\u6240\u4ee5\u6211\u4eec\u4e3a\u4e86\u5236\u4f5c\u4e00\u6b3e\u5927\u4f17\u4e14\u901a\u7528\u7684\u5de5\u5177\uff0c\u6240\u4ee5\u63d0\u4f9b\u4ed6\u4eec\u7ef4\u62a4\u81ea\u5df1\u73af\u5883\u7684\u529f\u80fd\u3002 CRUD/CURD\u662f\u4ec0\u4e48 \u7ecf\u5e38\u901b \u8109\u8109 \u7684\u540c\u5b66\u80af\u5b9a\u90fd\u77e5\u9053\uff0c\u7ecf\u5e38\u80fd\u770b\u5230CURD CRUD CRUD boy\u8fd9\u6837\u7684\u8bcd\u6c47\u3002\u76f4\u767d\u70b9\u8bf4\uff0ccurd\u6307\u7684\u5c31\u662f\u589e\u5220\u6539\u67e5\uff0c\u6211\u4eec\u4eca\u5929\u7684\u5185\u5bb9\u5c31\u662f\u8fd9\u4e2a\uff0c\u4e14\u542c\u6211\u4e00\u4e00\u9053\u6765\u3002 \u589e \u516c\u53f8\u6700\u8fd1\u5f00\u4e86\u4e00\u4e2a\u65b0\u7684\u73af\u5883\uff1afat2\uff0c\u6211\u4eec\u7cfb\u7edf\u5f97\u7ef4\u62a4\u8d77\u6765\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u65b0\u589e\u4e00\u6761 fat2 \u73af\u5883\u7684\u6570\u636e\u3002 \u5220 \u516c\u53f8\u53c8\u4e0d\u7528\u8fd9\u4e2a\u73af\u5883\u4e86\uff0c\u60f3\u53bb\u6389\u8fd9\u4e2a\u73af\u5883\uff0c\u514d\u5f97\u6df7\u6dc6\u89c6\u542c\u3002 \u6539 fat2\u73af\u5883\u516c\u53f8\u89c9\u5f97\u4e0d\u597d\u542c\uff0c\u516c\u53f8\u51b3\u5b9a\u6539\u6210fat-beta\u3002 \u67e5 \u516c\u53f8\u73b0\u5728\u6709100\u591a\u79cd\u73af\u5883\uff0c\u592a\u591a\u4e86\uff0c\u9700\u8981\u67e5\u8be2\u662f\u5426\u6709fat77\u8fd9\u4e2a\u73af\u5883\u3002 \u6ca1\u9519\uff0c\u5176\u5b9e\u5f88\u591a\u5f00\u53d1\u505a\u7684\u529f\u80fd\u90fd\u4e0e\u8fd9\u4e2a\u63a5\u8fd1\u3002\u5927\u90e8\u5206\u65f6\u95f4\u90fd\u662f\u5728\u505a\u4e00\u4e9bcrud\u7684\u5de5\u4f5c\u3002\u4e0a\u8ff0\u662f\u7ec6\u5316\u5230\u6211\u4eec\u8fd9\u4e00\u6b21\u73af\u5883\u7ba1\u7406\u7684\u529f\u80fd\u70b9\uff0c\u5982\u679c\u4f60\u89c9\u5f97\u96be\u7684\u8bdd\uff0c\u8010\u5fc3\u770b\u5b8c\uff08\u6284\u5b8c\uff09\u4f60\u5c31\u4e0d\u4f1a\u89c9\u5f97\u96be\u4e86\u3002 \u660e\u786e\u601d\u8def \u9996\u5148\u6211\u4eec\u5148\u8981\u641e\u6e05\u695a\u672c\u6b21\u9700\u6c42\uff0c\u5176\u5b9e\u9700\u6c42\u5f88\u7b80\u5355\uff0c\u5c31\u662f\u60f3\u7ed9\u7528\u6237\u63d0\u4f9b\u81ea\u5b9a\u4e49\u73af\u5883\u540d\u7684\u529f\u80fd\u3002\u90a3\u4e48\u6211\u4eec\u662f\u4e0d\u662f\u5728\u6570\u636e\u5e93\u9700\u8981\u5b58\u50a8\u8fd9\u4e9b \u73af\u5883 \u7684\u4fe1\u606f\u3002\u6700\u57fa\u672c\u7684\u4fe1\u606f\u9700\u8981\u54ea\u4e9b\u5462\uff1f\u6211\u8fd9\u91cc\u5217\u4e00\u4e0b: \u6570\u636e\u8868\u51c6\u5907 \u6838\u5fc3\u5b57\u6bb5: \u73af\u5883\u540d\u79f0 \u6bd4\u5982fat uat pro (\u662f\u5426\u80fd\u91cd\u590d\uff1f\u90a3\u80af\u5b9a\u662f\u4e0d\u80fd\u91cd\u590d\u7684\u5440\uff01) \u73af\u5883\u5907\u6ce8 \u6bd4\u5982fat\u662f\u6d4b\u8bd5\u73af\u5883\u5565\u7684\u5565\u7684\uff0c\u5176\u5b9e\u4e5f\u53ef\u4ee5\u4e0d\u8981\uff0c\u4f46\u662f\u7ed9\u4f60\u4e00\u4e2a\u9009\u9879\uff0c\u4e07\u4e00\u4f60\u9700\u8981\u6dfb\u52a0\u4e00\u4e9b\u8bf4\u660e\u5462 \u57fa\u672c\u5b57\u6bb5: \u521b\u5efa\u4eba\u662f\u8c01 \u4fee\u6539\u4eba\u662f\u8c01 \u4ec0\u4e48\u65f6\u5019\u521b\u5efa\u7684 \u4ec0\u4e48\u65f6\u5019\u66f4\u65b0\u7684 \u88ab\u5220\u9664\u4e86\u6728\u6709 \u529f\u80fd\u9700\u6c42\u51c6\u5907 \u73af\u5883\u53ef\u4ee5\u901a\u8fc7\u540d\u5b57\u6a21\u7cca\u67e5\u8be2 \u53ef\u4ee5\u7f16\u8f91\uff0c\u7f16\u8f91\u540e\u4f1a\u66f4\u65b0\u7f16\u8f91\u65f6\u95f4 \u53ef\u4ee5\u6dfb\u52a0 \u53ef\u4ee5\u5220\u9664 \u529f\u80fd\u4e00\u62c6\u5206\uff0c\u662f\u4e0d\u662f\u7279\u522b\u7b80\u5355\u4e86\uff0c\u5176\u5b9e\u9700\u6c42\u6ca1\u591a\u5c11\uff0c\u540e\u7aef\u53ef\u80fd1\u5c0f\u65f6\u4e0d\u5230\u5c31\u641e\u5b9a\u4e86\uff0c\u524d\u7aef\u8fd8\u662f\u8d39\u65f6\u95f4\u7684\u3002 \u5f00\u59cb\u884c\u52a8 \u5b9a\u4e49model \u65e2\u7136\u8868\u7684\u5b57\u6bb5\u4e0d\u591a\uff0c\u6570\u636e\u4e5f\u4e0d\u590d\u6742\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u5148\u5b9a\u4e49model\u3002 \u5185\u5bb9\u4e0d\u96be\uff0c\u719f\u6089sqlalchemy\u5c31\u66f4\u8f7b\u677e\u4e86\u3002\u76ee\u7684\u662f\u4e3a\u4e86 \u6620\u5c04\u4e00\u4e2a\u6570\u636e\u8868(\u73af\u5883\u8868)\u7684\u7c7b \u3002 tablename \u8868\u793a\u5f53\u524dclass\u5bf9\u5e94\u7684\u6570\u636e\u5e93\u8868\u540d\uff0c\u6211\u4eec\u8fd9\u91cc\u4e3a\u4e86\u533a\u5206\uff0c\u7edf\u4e00\u52a0\u4e0a pity_ \u524d\u7f00\u3002 \u540e\u9762\u7684\u5185\u5bb9\u5c31\u662f\u5bf9\u5b57\u6bb5\u7684\u5b9a\u4e49\u4ee5\u53ca\u521d\u59cb\u5316\u7c7b\u3002 \u751f\u6210model \u4e3a\u4e86\u80fd\u81ea\u52a8\u751f\u6210\u6570\u636e\u8868\uff0c\u6211\u4eec\u9700\u8981\u5728dao/ init .py\u91cc\u9762import\u8fd9\u4e2amodel\u7c7b\u3002 \u5b9a\u4e49Pydantic\u7684schema \u8fd9\u4e00\u6b65\u7684\u76ee\u7684\u5f88\u7b80\u5355\uff0c\u5c31\u662f\u4e3a\u4e86\u505a\u53c2\u6570\u6821\u9a8c\uff0c\u6bd4\u5982\u6709\u7684\u54e5\u4eec\u5f88\u574f\uff0c\u4ed6\u521b\u5efa\u73af\u5883\u7684\u65f6\u5019\uff0c\u76f4\u63a5\u7ed9\u4f60\u6765\u4e2a\u7a7a\u5b57\u7b26\u4e32\u6216\u8005\u7a7a\u683c\u5b57\u7b26\u4e32\u7684 \u73af\u5883\u540d \uff0c\u6240\u4ee5\u9047\u5230\u8fd9\u6837\u7684\u4eba\uff0c\u6211\u4eec\u8981\u9119\u89c6\u4ed6\uff0c\u5728\u6570\u636e\u63d2\u5165\u6570\u636e\u5e93\u4e4b\u524d\u5c31\u68c0\u6d4b\u5230\uff0c\u5e76\u7ed9\u4ed6\u6c89\u91cd\u6253\u51fb\u3002\u8fd9\u91cc\u719f\u6089pydantic\u7684\u540c\u5b66\uff0c\u90fd\u4e86\u89e3\uff0c\u4e0d\u719f\u6089\u7684\u8bdd\u5efa\u8bae\u53bb\u9605\u8bfb\u4ee5\u4e0bPydantic\u7684\u5b98\u65b9\u6587\u6863\uff0c\u6216\u8005\u7167\u7740\u6284\u5c31\u662f\u4e86\u3002 \u5927\u4f53\u610f\u601d\u5c31\u662f\u5b9a\u4e49\u4e86\u4e00\u4e2aEnvironment\u7684\u8868\u5355\uff0c\u91cc\u9762\u67093\u4e2a\u53c2\u6570: id\u3001name\u3001remarks\uff0c\u5bf9\u5e94\u7684\u5c31\u662fid\uff0c\u73af\u5883\u540d\u548c\u5907\u6ce8\u3002\u5176\u4e2dname\u4e0d\u80fd\u4e3a\u7a7a\uff0c\u5907\u6ce8\u968f\u4fbf\u4f60\uff0c\u5199\u4e0d\u5199\u90fd\u884c\uff0cid\u4f60\u4e5f\u53ef\u4ee5\u4e0d\u4f20\uff0c\u4e0d\u4f20\u5c31\u9ed8\u8ba4\u4e3aNone\u3002 \u7f16\u5199Dao\u5c42\uff08\u4e0edb\u4ea4\u4e92\u7684\u6838\u5fc3\u5185\u5bb9\uff09 \u65b0\u589e\u73af\u5883 \u7531\u4e8e\u73af\u5883\u4e5f\u7b97\u914d\u7f6e\u91cc\u9762\u7684\u4e00\u5957\u5185\u5bb9\uff0c\u540e\u7eed\u8981\u548c\u5168\u5c40\u53d8\u91cf\u653e\u5230\u4e00\u8d77\uff0c\u6240\u4ee5\u6211\u4eec\u7ed9\u4ed6\u5f52\u6863\u5230config\u76ee\u5f55\u4e0b\u3002 \u6765\u770b\u770b\u8fd9\u4e2a \u65b0\u589e\u73af\u5883 \u7684\u529f\u80fd\u90fd\u505a\u4e86\u5565\u3002 \u9996\u5148\u56fa\u5b9a\u642d\u914d\uff0c\u8fd9\u4e2adddd(\u61c2\u7684\u90fd\u61c2)\u3002\u4ece\u6570\u636e\u5e93\u62ff\u5230\u4e00\u4e2asession\uff0c\u7c7b\u4f3c\u4e8edb.cursor()\u4e5f\u7c7b\u4f3c\u4e8ejdbc\u91cc\u9762\u7684getConnection\u3002 with Session() as session: \u63a5\u7740\uff0c\u6839\u636e\u6211\u4eec\u7684\u4e1a\u52a1\u903b\u8f91\uff0c\u867d\u7136\u54b1\u4eec\u6570\u636e\u5e93\u8bbe\u7f6ename\u4e3aunique\uff0c\u6211\u4eec\u8fd8\u662f\u5148\u67e5\u8be2\u662f\u5426\u6709\u8fd9\u4e2aname\u5e76\u4e14deleted_at=None\uff08\u5220\u9664\u65f6\u95f4=None \u4ee3\u8868\u672a\u88ab\u5220\u9664\u7684\uff09\u7684\u73af\u5883\u6570\u636e\uff0c\u5982\u679c\u6709\u7684\u8bdd\uff0c\u6211\u4eec\u4e0d\u7ee7\u7eed\u65b0\u589e\u4e86\uff0c\u8fd4\u56de\u4e00\u4e2a \u63d0\u793a\u4fe1\u606f \u5c31\u884c\u3002 \u5426\u5219\u5462\uff0c\u6211\u4eec\u5c31\u628a\u6570\u636e\u63d2\u5230\u6570\u636e\u5e93\u5e76\u7528session\u8fdb\u884c\u63d0\u4ea4\u3002\u5982\u679c\u4e2d\u9014\u53d1\u751f\u5f02\u5e38\uff0c\u6211\u4eec\u5c31\u8be5\u8bb0\u5f55\u65e5\u5fd7\u7684\u8bb0\u5f55\u65e5\u5fd7\uff0c\u8be5\u8fd4\u56de\u9519\u8bef\u7684\u8fd4\u56de\u9519\u8bef\u3002\u5982\u679c\u6ca1\u5565\u95ee\u9898\u5c31\u8fd4\u56deNone\uff0c\u4ee3\u8868 \u5927\u5409\u5927\u5229\uff0c\u76f8\u5b89\u65e0\u4e8b \u3002 \u7f16\u8f91\u73af\u5883 \u5957\u8def\u90fd\u662f\u4e00\u6837\u7684\uff0c\u751a\u81f3\u4ee3\u7801\u4e5f\u5f88\u63a5\u8fd1\u3002\u4f46\u662f\u6ce8\u610f\u5230\u6709\u4e2a\u533a\u522b\uff0c\u8fd9\u91cc\u8c03\u7528\u4e86update_model\u65b9\u6cd5\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u662f\u5e72\u5565\u7684\u54e9\uff1f \u6211\u4eec\u77e5\u9053\uff0c\u66f4\u65b0\u4e00\u6761\u6570\u636e\uff0c\u6211\u4eec\u9664\u4e86\u9700\u8981\u66f4\u6539\u7684\u5b57\u6bb5\u4ee5\u5916\uff0c\u8fd8\u5f97\u6709\u66f4\u65b0\u4eba\u548c\u66f4\u65b0\u65f6\u95f4\u8fd92\u4e2a\u5b57\u6bb5\u8ddf\u7740\u4fee\u6539\u3002\u6240\u4ee5\u6211\u4eec\u7f16\u5199\u4e86\u4e00\u5957\u901a\u7528\u7684\u65b9\u6cd5\uff0c\u628a\u4f60\u4f20\u5165\u7684data\u6570\u636e\uff0c\u6539\u5230query\u91cc\u9762\uff0c\u987a\u4fbf\u6539\u5199\u4e00\u4e0b\u66f4\u65b0\u65f6\u95f4\u548c\u66f4\u65b0\u4eba\u3002 not_null\u6307\u7684\u662f\uff0c\u53ea\u66f4\u65b0\u975e\u7a7a\u5b57\u6bb5\uff0c\u6bd4\u5982\u6211\u672c\u6765\u6709\u4e2a\u6570\u636e\u662fabc\uff0c\u4f60\u4f20None\u8fdb\u6765\uff0c\u6211\u7ed9\u4ed6\u6539\u6210None\u4e86\uff0c\u8fd9\u6837\u53ef\u80fd\u4f1a\u6709\u8bef\u4f1a\u3002\u8fd9\u91cc\u501f\u9274\u4e86gorm\uff0c\u53ea\u66f4\u65b0\u975enull\u7684\u5b57\u6bb5\u3002dist\u4ee3\u8868\u76ee\u6807\uff0csource\u4ee3\u8868\u6570\u636e\u6e90\u3002 \u5220\u9664\u73af\u5883 \u5176\u5b9e\u5220\u9664\u73af\u5883\uff0c\u6211\u4eec\u8fd9\u91cc\u505a\u7684\u662f \u8f6f\u5220\u9664 \uff0c\u6240\u4ee5\u5176\u5b9e\u5b83\u8fd8\u662f\u4e00\u4e2aupdate\u7684\u64cd\u4f5c\u3002\u6211\u4eec\u901a\u8fc7id\u627e\u5230\u5bf9\u5e94\u7684\u6570\u636e\uff0c\u628a\u5b83\u7684deleted_at\u6539\u6210\u5f53\u524d\u65f6\u95f4\u5373\u53ef\uff0c\u987a\u4fbf\u6539\u4e00\u4e0b\u66f4\u65b0\u4eba\uff08\u7559\u4e0b\u7f6a\u8bc1\uff09\u3002 \u67e5\u8be2\u73af\u5883 \u6ce8\u610f\uff0c\u6211\u8fd9\u513f\u7528\u7684\u662flist_env\u540d\u79f0\uff0c\u4e3a\u5565\u4e0d\u662fsearch\u5462\uff1f\u8fd9\u91cc\u968f\u4f60\u7684\u4fbf\uff0c\u6211\u5176\u5b9e\u662f\u628alist\u548csearch\u5408\u4f53\u4e86\u4e00\u4e0b\u3002\u53ef\u4ee5\u770b\u5230\u6211\u7684name\u53c2\u6570\uff0c\u5982\u679c\u4e0d\u662fNone\u7684\u65f6\u5019\uff0c\u5b83\u5c31\u662f\u4e2asearch\u52a8\u4f5c\uff0c\u5426\u5219\u5b83\u662f\u4e00\u4e2alist\u64cd\u4f5c\u3002 search\u7684\u6839\u672c\u6761\u4ef6\u662f\uff0cdeleted_at == None\uff0c\u4e5f\u5c31\u662f\u8bf4\u4e0d\u7ba1\u600e\u4e48\u6837\uff0c\u54b1\u4eec\u90fd\u5f97\u4fdd\u8bc1\u6570\u636e\u6ca1\u88ab\u5220\u9664\u3002 if name: search.append(Environment.name.ilike( \"%{}%\" .format(name))) \u5982\u679cname\u6709\u4f20\uff0c\u6216\u8005\u4e0d\u4e3a\"\"\u4e5f\u4e0d\u4e3aNone\uff0c\u90a3\u4e48\u6211\u4eec\u52a0\u4e0a\u5bf9name\u7684\u6a21\u7cca\u67e5\u8be2\uff0c\u7b49\u4ef7\u4e8e where name ilike xxxxx \u3002 \u6700\u540e\u5c31\u662f\u81ea\u52a8\u5206\u9875\u4e86\uff0c\u6211\u4eec\u67e5\u51fa\u6765\u7684\u6570\u636e\u5f88\u591a\u7684\u8bdd\uff0c\u4e0d\u53ef\u80fd\u5168\u90e8\u505a\u5c55\u793a\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u8fdb\u884c\u5206\u9875\u3002page\u548csize\u6307\u7684\u5c31\u662f \u5f53\u524d\u9875\u7801 \u548c \u4e00\u9875\u591a\u5c11\u6761\u6570\u636e \u3002 \u6700\u540e\u54b1\u4eec\u901a\u8fc7created_at\u8fdb\u884c\u5012\u5e8f\u6392\u5217\uff0c\u4e5f\u5c31\u662f\u8bf4 \u6700\u65b0\u521b\u5efa\u7684\u5728\u6700\u524d\u9762 \u3002\u8fd4\u56de\u4e00\u4e2atotal\uff0c\u5c31\u662f\u672c\u6b21\u67e5\u8be2\u67e5\u5230\u4e86\u591a\u5c11\u6761\u6570\u636e\uff0c\u4ee5\u4fbf\u4e8e\u524d\u7aef\u8fdb\u884c\u5c55\u793a\u3002 \u7f16\u5199router router\u5c42\u5f88\u7b80\u5355\uff0c\u901a\u8fc7ApiRouter\u65b0\u5efa\u8def\u7531\uff0c\u5e76\u628alist/insert/update/delete\u65b9\u6cd5\u6ce8\u518c\u5230\u8def\u7531\u3002\u53ef\u4ee5\u770b\u5230\u57fa\u672c\u4e0a\u4ee3\u7801\u91cf\u5f88\u5c11\uff0c\u5c5e\u4e8e\u8c03\u7528dao\u5c42\u7684\u6838\u5fc3\u65b9\u6cd5\uff0c\u6839\u636e\u8fd4\u56de\u7ed3\u679c\u6765\u8fd4\u56dehttp response\u3002 \u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0c\u6211\u6ca1\u6709\u7528restful api\u53bb\u5199\u63a5\u53e3\uff0c\u6240\u4ee5udpate/insert\u90fd\u662fpost\u8bf7\u6c42\uff0c\u5176\u4ed6\u662fget\u8bf7\u6c42\u3002\uff08\u672a\u51fa\u73b0put delete\uff09 \u6ce8\u518crouter \u6700\u540e\u628a\u521a\u624d\u7f16\u5199\u7684router\u6ce8\u518c\u5230app(pity)\u5c31\u53ef\u4ee5\u4e86\u3002 \u5267\u900f\u4e0b\u6548\u679c: \u672c\u671f\u5185\u5bb9\u5c31\u5230\u8fd9\u91cc\u4e86\uff0c\u4e0d\u6c34\u6587\u867d\u7136\u5c11\u70b9\u4e50\u8da3\uff0c\u4f46\u662fhin\u5145\u5b9e\u5440\uff01\u4e0b\u4e00\u671f\u4ee5\u524d\u7aef\u600e\u4e48curd\u4e3a\u4e3b\uff0c\u5404\u4f4d\u89c2\u4f17\u59e5\u7237\uff0c\u62dc\u4e86\u4e2a\u62dc\uff01","title":"31.\u7f16\u5199\u73af\u5883\u914d\u7f6e\u9875\u9762(\u4e0a)"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2832%29%20%E7%BC%96%E5%86%99%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E9%A1%B5%E9%9D%A2%28%E4%B8%AD%29/","text":"\u56de\u987e \u5927\u5bb6\u597d\u5440\uff0c\u53c8\u89c1\u9762\u4e86\uff01\u4e0a\u671f\u6211\u4eec\u5df2\u7ecf\u5b8c\u6574\u5730\u7f16\u5199\u4e86\u73af\u5883\u7ba1\u7406CRUD\u7684\u63a5\u53e3\uff0c\u4f46\u662f\u5149\u6709\u63a5\u53e3\u662f\u4e0d\u884c\u7684\uff0c\u6211\u4eec\u9700\u8981\u4e3a\u4e4b\u7f16\u5199\u4e00\u4e2aweb\u9875\u9762\uff0c\u4f7f\u7528\u6237\u80fd\u591f\u5728\u9875\u9762\u4e0a\u7ba1\u7406\u73af\u5883\u6570\u636e\u3002 \u8fd9\u662f\u524d\u7aef\u7cfb\u5217\u6587\u7ae0\u7684 \u7b2c\u4e00\u7bc7 \uff0c\u5305\u542b\u4e86\u90e8\u5206\u6559\u7a0b\u5728\u91cc\u9762\uff0c\u6240\u4ee5\u672c\u6765\u662f\u4e0b\u7bc7\u7684\u5b83\uff0c\u53d8\u6210\u4e86\u4e2d\u7bc7\u3002 \u539f\u578b\u8bbe\u8ba1 \u6211\u4eec\u5728\u5b9e\u73b0\u67d0\u4e2a\u529f\u80fd\u7684\u65f6\u5019\uff0c\u5c31\u7b97\u4e0d\u753b\u51fa\u539f\u578b\uff0c\u5fc3\u4e2d\u4e5f\u4e00\u5b9a\u8bbe\u8ba1\u597d\u5927\u6982\u7684\u7ed3\u6784\u3002\u4ee5\u6211\u4eec\u7684\u73af\u5883\u7ba1\u7406\u4e3a\u4f8b\u5b50\uff0c\u7528\u6237\u53ef\u4ee5\u901a\u8fc7table\u67e5\u770b\u5f53\u524d\u5df2\u6709\u7684\u73af\u5883\uff0c\u4e5f\u63d0\u4f9binput\u8f93\u5165\u6846\u53bb\u641c\u7d22\u5bf9\u5e94\u7684\u73af\u5883\uff0ctable\u7684\u6570\u636e\u968f\u7740\u641c\u7d22\u7684\u7ed3\u679c\u8fdb\u884c\u5207\u6362\u3002\u529f\u80fd\u70b9\u5f88\u7b80\u5355\uff0c\u6211\u4eec\u8bbe\u8ba1\u4e00\u4e0b\u5177\u4f53\u7684\u9875\u9762\u3002 \u7531\u4e8e\u6211\u4e0d\u662f\u4e13\u4e1a\u7684\u8bbe\u8ba1\uff0c\u6240\u4ee5\u6211\u6253\u7b97\u91c7\u7528\u624b\u7ed8\u7684\u65b9\u5f0f\u6765\u7ed9\u5927\u5bb6\u63cf\u8ff0\u4e00\u4e0b\u8981\u505a\u4e2a\u5565\u73a9\u610f\u513f\u3002\u4e0b\u9762\u662f\u6211\u7528\u624b\u5199\u677f\u753b\u7684\u4e00\u4e2a\u8349\u56fe(\u7f8e\u672f\u529f\u5e95\u8f83\u5dee): \u8fd9\u91cc\u53ea\u753b\u51fa\u4e86\u5177\u4f53\u9875\u9762\u7684\u5185\u5bb9\uff0c\u6211\u4eec\u628a\u8fd9\u4e2a\u9875\u9762\u62c6\u62103\u4e2a\u90e8\u5206\u3002 \u65b0\u589e/\u641c\u7d22 \u65b0\u589e\u4ee3\u8868\u65b0\u589e\u4e00\u4e2a\u73af\u5883\uff0c\u8fd9\u6837\u4f1a\u5f39\u51fa\u4e00\u4e2a\u73af\u5883\u5bf9\u8bdd\u6846\u3002\u6700\u53f3\u4fa7\u662f\u641c\u7d22\u6846\uff0c\u6839\u636e\u73af\u5883\u540d\u53bb\u641c\u7d22\u5bf9\u5e94\u7684\u73af\u5883\u3002 \u8868\u683c \u8868\u683c\u662f\u4e3a\u4e86\u5c55\u793a\u76ee\u524d\u5df2\u6709\u7684\u73af\u5883\u6570\u636e\uff0c\u6ce8\u610f\u8fd9\u91cc\u6211\u6f0f\u753b\u4e86\uff0c\u8868\u683c\u6700\u540e\u4e00\u5217\u8fd8\u9700\u8981\u4e00\u4e2a\u64cd\u4f5c\u5217\uff0c\u5305\u542b\"\u4fee\u6539\"\u548c\"\u5220\u9664\"2\u4e2a\u529f\u80fd\u3002 \u5206\u9875 \u5f53\u6570\u636e\u8f83\u591a\u7684\u65f6\u5019\uff0c\u6211\u4eec\u9700\u8981\u5206\u9875\u3002 \u5927\u6982\u7684\u4e00\u4e2a\u9875\u9762\u5c31\u7ed8\u5236\u597d\u4e86\uff0c\u63a5\u7740\u5c31\u662f\u628a\u5b83\u53d8\u73b0\uff01 \u7f16\u5199\u4f20\u7edf\u7684HTML \u4ee3\u7801\u5f88\u7b80\u5355\uff0c\u4e00\u4e2a\u5927\u76d2\u5b50\u4e0b\u9762\u5d4c\u51653\u4e2a\u5c0f\u76d2\u5b50\uff0c\u7b2c\u4e00\u4e2a\u76d2\u5b50\u91cc\u9762\u5305\u542b\u4e00\u4e2abutton\u548c\u4e00\u4e2ainput\uff0c\u7b2c\u4e8c\u4e2a\u76d2\u5b50\u672c\u5e94\u8be5\u662f\u4e2a \u8868\u683c \uff0c\u4f46\u662f\u7531\u4e8e\u6211\u5bf9html\u7684\u8868\u683c\u4e0d\u592a\u719f\u6089\uff0c\u6240\u4ee5\u6211\u653e\u4e86\u4e2a\u7a7a\u6c14\u5728\u90a3\u3002\u7b2c\u4e09\u4e2a\u5c31\u662f\u5206\u9875\uff0c\u4e3a\u4e86\u5077\u61d2\uff0c\u6211\u4e5f\u53ea\u662f\u5199\u4e2a\u540d\u5b57\u3002\u5927\u4f53\u7684\u6548\u679c\u5982\u4e0b: \u8fd9\u4e00\u6b65\u4e3b\u8981\u662f\u4e3a\u4e86\u8ba9\u5927\u5bb6\u80fd\u591f\u660e\u767d\u9875\u9762\u7684\u5e03\u5c40\uff0c\u76f8\u4fe1\u6709html\u57fa\u7840\u7684\u540c\u5b66\u90fd\u80fd\u591f\u770b\u61c2\u3002 \u8bd5\u8bd5React\u7684\u5199\u6cd5 \u4e5f\u8bb8\u7528\u7c7b\u7684\u65b9\u5f0f\u5927\u5bb6\u4f1a\u6bd4\u8f83\u719f\u6089\uff0c\u6211\u4eec\u4eca\u5929\u5c31\u7528\u7c7b\u6765\u7f16\u5199\u4e00\u4e2a\u73af\u5883\u7ba1\u7406\u7684\u7ec4\u4ef6\u3002 \u5148\u6765\u8bb2\u89e3\u4e00\u4e0b\u8fd9\u4e2a\u8fc7\u7a0b\uff0c\u5b9a\u4e49\u4e00\u4e2aEnvironment\u7c7b\uff0c\u96c6\u6210\u81eaReact\u7684Component\u7c7b\uff0c\u91cd\u5199\u91cc\u9762\u7684render\u65b9\u6cd5\u3002 \u8bb2\u4e00\u4e0b\u8fd9\u4e2arender\u65b9\u6cd5\uff0crender\u91cc\u9762\u6211\u4eec\u4e00\u822c\u76f4\u63a5return\u4e86\uff0crender()\u8fd9\u4e2a\u65b9\u6cd5\u4f1a\u5728\u7ec4\u4ef6\u7684\u5404\u4e2a\u751f\u547d\u5468\u671f\u90fd\u8c03\u7528\u5230\uff0c\u6211\u4eec\u8fd9\u91cc\u4e0d\u7ec6\u7a76\u3002 \u7b80\u5355\u7684\u8bf4\uff0crender\u5c31\u662f\u4e3a\u4e86\u628a\u4f60\u7684\u9875\u9762\u7ed9\u6e32\u67d3\u51fa\u6765\u800c\u6267\u884c\u7684\u64cd\u4f5c\uff0c\u6e32\u67d3\u4ec0\u4e48\u9875\u9762\u5462\uff1f \u4f60\u9700\u8981\u7ed9\u5b83return\u4e00\u4e2ahtml\u7684\u7ec4\u4ef6\uff0c\u6211\u4eec\u5148\u770b\u770b\u6548\u679c: \u6700\u540e\u7684export default\uff0c\u5c31\u662f\u5bfc\u51fa\u8fd9\u4e2a\u7c7b\uff0c\u4e3a\u4e86\u7ed9\u522b\u4ebaimport\u7684\u65f6\u5019\u4f7f\u7528\u3002\u4e0d\u7136\u522b\u4eba\u5e76\u4e0d\u77e5\u9053\u5f15\u5165\u6587\u4ef6\u91cc\u7684\u4ec0\u4e48\u7c7b\uff0c\u56e0\u4e3a\u4e00\u4e2a\u6587\u4ef6\u53ef\u80fd\u5305\u542b\u591a\u4e2a\u7c7b\u3002 \u6709\u6ca1\u6709\u89c9\u5f97\u8fd9\u4e2areturn\u91cc\u9762\u7684\u5185\u5bb9\u5f88\u719f\u6089\uff0c\u6ca1\u9519\uff0c\u91cc\u9762\u5176\u5b9e\u662fhtml\u7684\u5199\u6cd5\uff0c\u548chtml\u5dee\u4e0d\u591a, \u4f46\u662f\u6709\u4e9b\u8bb8\u5dee\u522b\u3002 \u7f16\u5199html\u7ed3\u6784 \u6211\u4eec\u590d\u5236\u521a\u624d\u7684html\u4ee3\u7801\u5230\u6b64\u5904: \u53ef\u4ee5\u53d1\u73b0\u9875\u9762\u62a5\u9519\u4e86\uff0c\u56e0\u4e3a\u8fd9\u91cc\u5199\u6cd5\u548chtml\u6709\u4e9b\u8bb8\u4e0d\u4e00\u81f4\u3002\u4e3b\u8981\u4f53\u73b0\u5728style\u91cc\u9762\uff0c\u6211\u4eec\u5bf9\u5b83\u8fdb\u884c\u8c03\u6574: \u6548\u679c: \u89e3\u91ca: \u8fd9\u5e76\u4e0d\u662f\u7eaf\u7cb9\u7684html\uff0c\u800c\u662fReact\u5b9a\u4e49\u7684\u4e00\u5957jsx\u7684\u8bed\u6cd5\u3002\u60f3\u5fc5\u5927\u5bb6\u6709\u6ce8\u610f\u5230\u51e0\u4e2a\u533a\u522b: style\u7684\u5199\u6cd5\u4e0d\u4e00\u6837 \u662f\u7684\uff0c\u5176\u5b9e\u53ef\u4ee5\u7406\u89e3\uff0creact\u4e2d\u7684style\u662f\u7531{{}}\u7ec4\u6210\u7684\uff0c\u5b9e\u9645\u4e0a\uff0c\u4ed6\u662f\u7531{}\u5d4c\u5957\u4e00\u5c42\u5b57\u5178{}\u5b9e\u73b0\u7684\u3002\u6bd4\u5982{{name: \"\u699c\u4e00\u5927\u54e5\"}}\uff0c\u6240\u4ee5\u5f53\u6211\u4eec\u5199 style={{color: \"#ffffff\"}} \u5c31\u7b49\u4ef7\u4e8ehtml\u91cc\u9762\u7684 style=\"color:#ffffff\" \u6709\u90e8\u5206\u5b57\u6bb5\u88ab\u6539\u540d\u4e86 react\u4f30\u8ba1\u662f\u4e3a\u4e86\u7edf\u4e00\u89c4\u8303\uff0c\u91c7\u7528\u7684\u90fd\u662f\u9a7c\u5cf0\u5f0f\u5b57\u6bb5\u3002\u6bd4\u5982\u4e0a\u6587\u4e2d\u6709\u7684marginTop\uff0c\u5176\u5b9e\u5728html\u91cc\u9762\u662fmargin-top\u3002\u8fd9\u4e2a\u5176\u5b9e\u5927\u5bb6\u4e0d\u7528\u592a\u5728\u610f\uff0cide\u4f1a\u7ed9\u4f60\u63d0\u793a: \u5f53\u7136\uff0c\u5982\u679c\u4f60\u5355\u72ec\u7f16\u5199css\u6587\u4ef6\u7684\u65f6\u5019\uff0c\u662f\u6ca1\u6709\u533a\u522b\u7684\u54c8\uff0c\u8fd9\u662f\u884c\u5185\u6837\u5f0f\u7684\u533a\u522b\u3002 \u9664\u6b64\u4e4b\u5916\uff0c\u597d\u50cf \u5dee\u522b\u5e76\u4e0d\u592a\u5927 \uff1f\u6240\u4ee5\u5176\u5b9e\u5b66\u4e60\u6210\u672c\u5e76\u4e0d\u7b97\u592a\u9ad8\u3002 \u4f7f\u7528antd\u6539\u9020\u7ed3\u6784 \u4e3a\u5565\u8981\u7528antd\uff0c\u4f60\u6ca1\u770b\u5230\u8fd9\u4e2a\u9875\u9762\u5947\u4e11\u65e0\u6bd4\u5417\uff1fantd\u5c31\u662f\u4f60\u7684\u7f8e\u56fe\u79c0\u79c0\uff0c\u4e00\u952e\u7f8e\u989c\uff0c\u4f60\u7231\u4e0d\u7231\uff1f \u6539\u9020\u6700\u5916\u5c42div \u9996\u5148\uff0c\u6211\u4eec\u7528Card\u7ec4\u4ef6\uff0c\u5305\u88f9\u6211\u4eec\u7684\u5185\u5bb9\uff0cCard\u9ed8\u8ba4\u5e26\u4e86\u4e00\u4e2a\u5361\u7247\u7684\u6837\u5f0f\uff0c\u6211\u4eec\u6765\u8bd5\u8bd5\u770b: \u4ee3\u7801\u6539\u52a8\u5982\u4e0a\uff0c\u5b9e\u9645\u6548\u679c\uff1a \u52a0\u5165PageContainer\u8c6a\u534e\u5957\u9910 \u6211\u4eec\u4e4b\u524d\u7684\u9875\u9762\u90fd\u4f1a\u6709\u4e2aPageContainer\u7684\u7ec4\u4ef6\u5305\u88f9\uff0c\u8fd9\u6837\u7684\u8bdd\u4f1a\u80fd\u591f\u663e\u793a\u5f53\u524d\u9875\u9762\u7684\u540d\u5b57\u7b49\u4fe1\u606f\uff0c\u4f8b\u5982: \u6211\u4eec\u5728Card\u6700\u5916\u5c42\u4e5f\u5957\u4e0aPageContainer: \u6548\u679c: \u5982\u679ctitle\u4f20\u5165false\u7684\u8bdd\uff0c\u5c31\u4f1a\u663e\u793a\u6210\u9879\u76ee\u5217\u8868\u7684\u9875\u9762\u4e86\u3002 ps: \u6709\u6ca1\u6709\u89c9\u5f97\u9875\u9762\u6e10\u6e10\u7f8e\u5316\u4e86\u4e00\u70b9\uff1f\uff1f \u6539\u9020\u65b0\u589e\u73af\u5883\u6309\u94ae\u548c\u8f93\u5165\u6846 \u5b66\u8fc7bootstrap\u7684\u90fd\u660e\u767d\u6805\u683c\u7cfb\u7edf\u5427\uff1f\u5927\u4f53\u662f\u8bf4\uff0c\u628a\u4e00\u4e2a\u9875\u9762\u5206\u4e3a12\u4efd\uff0c\u4f60\u4e00\u4e2a\u76d2\u5b50\u53606\u4efd\u5c31\u662f6/12 = \u4e00\u534a\u513f\u5bbd\uff0c\u5176\u5b9eantd\u4e5f\u6709\u7c7b\u4f3c\u7684\u5b9e\u73b0\uff0c\u53ea\u4e0d\u8fc7\u5b83\u662f\u6309\u716724\u4efd\u5207\u5272\u5bbd\u5ea6\u7684\u3002 \u6211\u73b0\u5728\u6307\u5b9a \u65b0\u589e\u6309\u94ae \u53606\u4efd\uff0c\u4e2d\u95f4\u7559\u767d12\u4efd\uff0c \u641c\u7d22\u6846 \u5360\u636e6\u4efd\u3002\u90a3\u4e48\u600e\u4e48\u5199\u5462\uff1f \u6548\u679c\u56fe \u6c42\u6c42\u4e86\uff0c\u6362\u4e2a\u6309\u94ae\u548c\u8f93\u5165\u6846\u5427 \u6211\u4eec\u7528\u4e0aantd\u7684\u6309\u94ae\u548c\u8f93\u5165\u6846\u3002\u56e0\u4e3abutton\u548cinput\u662fhtml\u9ed8\u8ba4\u81ea\u5e26\u7684\u7ec4\u4ef6\uff0c\u6240\u4ee5\u6211\u4eec\u4e3a\u4e86\u533a\u522b\uff0c\u81ea\u5b9a\u4e49\u7684\u7ec4\u4ef6\u90fd\u7528\u5927\u5199\u5b57\u6bcd\u5f00\u5934\u54e6\uff0c\u6bd4\u5982Button\u548cInput\u3002 type=primary\u6307\u7684\u662f\u786e\u5b9a\u7c7b\u6309\u94ae\uff0c\u4e00\u822c\u662f\u9ad8\u8d35\u7684\u84dd\u8272\u3002\u5176\u4ed6\u7684\u4e0e\u666e\u901a\u7684html\u5e76\u65e0\u533a\u522b\u5427\uff0cInput.Search\u4ee3\u8868\u6211\u4eec\u7528antd\u5c01\u88c5\u597d\u7684\u641c\u7d22\u7ec4\u4ef6\uff0c\u800c\u4e0d\u662f\u666e\u901a\u7684\u8f93\u5165\u6846\u3002 \u6548\u679c\u56fe\uff0c\u5c31\u95ee\u4f60\u662f\u4e0d\u662f\u7f8e\u56fe\u79c0\u79c0 \u4eca\u5929\u7684\u5185\u5bb9\u5c31\u5230\u8fd9\u513f\u4e86\uff0c\u5176\u5b9e\u54b1\u4eec\u6d4b\u8bd5\u80fd\u5199\u8fd9\u79cd\u9875\u9762\u5c31\u5df2\u7ecf\u5f88\u4e0d\u9519\u4e86\uff0c\u867d\u7136\u6bd4\u4e0d\u4e0a\u4e13\u4e1a\u7684\u524d\u7aef\uff0c\u4f46\u662f\u4e5f\u80fd\u591f\u72ec\u5f53\u4e00\u9762\u4e86\uff01 \u4e0b\u4e00\u7bc7\u4e5f\u4f1a\u662f\u6559\u7a0b\u7c7b\u7684\u6587\u7ae0\uff0c\u8fd92\u7bc7\u8fc7\u540e\uff0c\u524d\u7aef\u7684\u7ec6\u8282\u90e8\u5206\u5c31\u4e0d\u518d\u8d58\u8ff0\u4e86\u3002","title":"32.\u7f16\u5199\u73af\u5883\u914d\u7f6e\u9875\u9762(\u4e2d)"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2833%29%20%E7%BC%96%E5%86%99%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E9%A1%B5%E9%9D%A2%28%E4%B8%8B%29/","text":"\u9605\u8bfb\u672c\u6587\u53ef\u80fd\u9700\u8981\u4e00\u4e9b\u65f6\u95f4\uff0c\u5efa\u8bae\u901a\u52e4/\u8e72\u5751\u7684\u65f6\u5019\u89c2\u770b\u3002 \u56de\u987e \u4e0a\u7bc7\u7f16\u5199\u4e86\u4e00\u90e8\u5206\u7ed3\u6784\uff0c\u8fd8\u5269\u4e0b \u8868\u683c \u6ca1\u6709\u7f16\u5199\u3002\u4ee5\u53ca\u548c\u540e\u7aef\u63a5\u53e3\u7684\u8054\u8c03\uff0c\u4e5f\u4f1a\u5728\u672c\u6587\u8865\u5145\u3002 \u8865\u5145Table\u5185\u5bb9 \u5728\u6b64\u4e4b\u524d\uff0c\u6211\u4eec\u7ed9 \u65b0\u589e\u73af\u5883 \u8fd9\u4e2a\u6309\u94ae\u52a0\u4e00\u4e2aicon\uff0c\u8fd9\u6837\u4f1a\u66f4\u76f4\u89c2\u3002 icon\u5730\u5740: https://ant.design/components/icon-cn/ \u70b9\u51fb\u590d\u5236 \u5176\u5b9eicon\u4e5f\u662f\u4e00\u4e2a\u7ec4\u4ef6\uff0c\u6211\u4eec\u628a\u5b83\u5d4c\u5165\u5230Button \u8865\u5145Table\u7ec4\u4ef6 \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u8fd9\u91cc\u548chtml\u6709\u5927\u4e0d\u4e00\u6837\u7684\u5730\u65b9\u4e86\u3002\u56e0\u4e3a\u6211\u4eec\u9700\u8981\u7528\u5230antd\u7684Table\u7ec4\u4ef6\uff0c\u6240\u4ee5\u6211\u4eec\u6309\u7167\u89c4\u77e9\u884c\u4e8b\uff0c\u6839\u636e\u5b83\u9700\u8981\u7684\u53c2\u6570\u4f20\u5165\u5bf9\u5e94\u7684\u6570\u636e\u5c31\u884c\u3002 \u5148\u7406\u89e3\u4e00\u4e0b\u5b98\u7f51\u7684\u6700\u57fa\u672c\u7684\u8868\u683c\u4f8b\u5b50 dataSource \u4e00\u4e2ajson\u6570\u7ec4\uff0c\u91cc\u9762\u5462\uff0c\u5b58\u653e\u7684\u662f\u6570\u636e\u4fe1\u606f\uff0c\u8fd9\u4e2a\u6570\u636e\u6211\u4eec\u4ece\u54ea\u513f\u6765\u5462\uff1f\u4ece\u540e\u7aef\u63a5\u53e3 /config/environment/list \u83b7\u53d6\u3002 columns \u8fd9\u4e2a\u662f\u8868\u683c\u7684\u5217\u914d\u7f6e\u4fe1\u606f\uff0c\u4e5f\u662f\u4e2ajson\u6570\u7ec4\uff0ckey\u4ee3\u8868\u5217\u7684key\uff0ctitle\u4ee3\u8868\u8868\u5934\u7684\u540d\u5b57\uff0cdataIndex\u4ee3\u8868\u4ecedataSource\u7684\u6570\u636e\u91cc\u9762\u53d6\u4ec0\u4e48\u5b57\u6bb5\uff0c\u6bd4\u5982\u4e0a\u56fe\u7684address\uff0c\u4ee3\u8868\u8fd9\u4e00\u5217\u7684\u5185\u5bb9\u662f\u4eceaddress\u91cc\u9762\u53d6\u7684\u3002 \u6211\u4eec\u5148copy\u5b98\u7f51\u7684\u4ee3\u7801\uff0c\u770b\u770b\u6548\u679c \u53ef\u4ee5\u770b\u5230\uff0c\u6211\u4eec\u5b9e\u73b0\u4e86\u60f3\u8981\u7684\u6548\u679c \u4f46\u662f\u8fd9\u6837\u8fd8\u4e0d\u591f\uff0c\u6570\u636e\u548c\u5185\u5bb9\u90fd\u4e0d\u662f\u6211\u4eec\u60f3\u8981\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u8fd8\u9700\u8981\u6539\u9020\u3002 \u6539\u5199columns \u6211\u4eec\u6709\u81ea\u5df1\u9700\u8981\u5c55\u793a\u7684\u5217\u548c\u5b57\u6bb5: \u5176\u5b9e\u6211\u4eec\u9700\u8981\u5c55\u793aid\uff0c\u73af\u5883\u540d\uff0c\u5907\u6ce8\uff0c\u521b\u5efa\u4eba\u548c\u66f4\u65b0\u65f6\u95f4\u5c31\u53ef\u4ee5\u4e86\u3002\u6240\u4ee5\u5217\u5c31\u8fd9\u51e0\u9879\uff0c\u4f46\u662f\u56e0\u4e3a\u6211\u4eec\u8fd8\u9700\u8981\u7f16\u8f91\u67d0\u4e00\u884c\u548c\u5220\u9664\u67d0\u4e00\u884c\u7684\u529f\u80fd\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u518d\u5b9a\u4e49\u4e00\u5217\u3002 \u5b9a\u4e49\u4e00\u5217\u64cd\u4f5c\u5217 \u64cd\u4f5c\u5217\u63d0\u4f9b\u4e862\u4e2a\u94fe\u63a5 a \uff0c\u5206\u522b\u662f\u7f16\u8f91\u548c\u5220\u9664\uff0c\u7528Divider\u9694\u5f00\uff0c\u8fd9\u4e2a\u662f\u5206\u5272\u7ebf\u3002 \u6682\u65f6\u6539\u53d8dataSource\u7684\u503c \u56e0\u4e3a\u8fd9\u91cc\u7684\u6570\u636e\u90fd\u662f\u5199\u597d\u4e86\u7684\uff0c\u5e76\u4e0d\u662f\u771f\u6b63\u7684\u63a5\u53e3\u8fd4\u56de\uff0c\u53ef\u4ee5\u8bf4\u662f\u5047\u6570\u636e\u3002\u6211\u4eec\u4e3a\u4e86\u6d4b\u8bd5\u5217\u540d\u663e\u793a\u7684\u60c5\u51b5\uff0c\u6211\u4eec\u81ea\u5df1\u7ed9\u4ed6\u8fdb\u884c\u4e00\u4e9b\u8c03\u6574\u3002 \u5bf9\u5e94\u4e0acolumns\u91cc\u9762\u7684remarks\uff0cname,create_user\u7b49\u7b49 \u663e\u793a\u6548\u679c\u5982\u4e0b \u5927\u4f53\u4e0a\u6211\u4eec\u5df2\u7ecf\u5b8c\u6210\u4e86html\u7ed3\u6784\u7684\u7f16\u5199\uff0c\u63a5\u7740\u6211\u4eec\u9700\u8981\u8865\u5168\u529f\u80fd\u3002\u5176\u5b9e\u8def\u8fd8\u5f88\u957f\uff0c\u6211\u4eec\u9700\u8981\u6539\u52a8\u7684\u5730\u65b9\u8fd8\u5f88\u591a\uff0c\u5efa\u8bae\u5927\u5bb6\u8010\u5fc3\u770b\u3002 \u62ff\u5230\u771f\u5b9e\u6570\u636e \u4e0a\u8ff0\u6211\u4eec\u662f\u9020\u4e86\u4e00\u4e2a\u5047\u6570\u636e\uff0c\u90a3\u6211\u4eec\u600e\u4e48\u62ff\u5230\u771f\u5b9e\u6570\u636e\u5462\uff1f\u9996\u5148\uff0c\u6211\u4eec\u9700\u8981\u7ef4\u62a4\u4e00\u4e2a\u53d8\u91cf\uff0c\u4e3e\u4e2a\u4f8b\u5b50\u53eb: data \uff0c\u5b83\u9ed8\u8ba4\u662f\u7a7a\u6570\u7ec4\uff0c\u4e5f\u5c31\u662f\u6ca1\u6570\u636e\u3002\u5f53\u6211\u4eec\u8bf7\u6c42\u4e86/config/environment/list\u63a5\u53e3\u4ee5\u540e\uff0c\u66f4\u65b0data\u53d8\u91cf\uff0c\u7531\u4e8ereact\u4f1a\u81ea\u52a8\u5224\u65ad\u53d8\u91cf\u7684\u66f4\u65b0\u5e76update\u9875\u9762\u5185\u5bb9\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u505a\u7684\u4e8b\u60c5\u5c31\u53d8\u5f97\u5f88\u7b80\u5355\u4e86\u3002 \u7ef4\u62a4data\u53d8\u91cf state \u5927\u5bb6\u6ce8\u610f\uff0c\u8fd9\u4e2a\u662f\u4e00\u4e2a\u56fa\u5b9a\u7684\u5199\u6cd5\uff0c\u522b\u6362\u6210\u522b\u7684\uff0creact\u4f1a\u81ea\u52a8\u76d1\u542cEnvironment\u7ec4\u4ef6\u7684state\u53d8\u91cf\u91cc\u7684\u6570\u636e\u5185\u5bb9\u3002\u8fd9\u4e48\u7406\u89e3\uff0cstate\u7b49\u4e8e\u662f\u4e00\u4e2a\u52a8\u6001\u53d8\u91cf\u6c60\uff0c\u4f60\u5728\u91cc\u9762\u653e\u5165\u4e00\u4e2adata\uff0c\u5f53state\u91cc\u9762\u7684data\u53d1\u751f\u53d8\u5316\uff0creact\u4f1a\u81ea\u52a8\u68c0\u6d4bdata\u662f\u5426\u5728dom\u4e0a\u6709\u663e\u793a\uff0c\u6709\u7684\u8bdd\u5c31 \u81ea\u52a8\u66f4\u65b0 \u3002 \u540c\u65f6\uff0c\u6211\u4eec\u8fd8\u8981\u628a\u539f\u6765\u7684dataSource\u53bb\u6389\uff0c\u6362\u6210data\u3002 \u7f16\u5199\u83b7\u53d6\u540e\u7aef\u7684\u63a5\u53e3 \u8fd9\u8fb9\u6211\u4eec\u4e00\u6b21\u6027\u628a\u589e\u5220\u6539\u67e5\u7684\u63a5\u53e3\u90fd\u7f16\u5199\u597d\uff0c\u4ee5\u4fbf\u4e4b\u540e\u53bb\u4f7f\u7528\u3002\u5176\u5b9e\u5c31\u662frequest\u8bf7\u6c42\uff0c\u7136\u540e\u4f20\u5165\u5bf9\u5e94\u7684\u8bf7\u6c42\u65b9\u5f0f\u548curl\u5730\u5740+\u53c2\u6570\u7b49\u3002\u6ce8\u610f\u4ee5\u4e0b\u56fe\u4e2dpost\u548cget\u7684\u533a\u522b\u3002 \u6709\u540c\u5b66\u53ef\u80fd\u6ce8\u610f\u5230\u4e86\uff0c\u7b2c\u4e00\u4e2alistEnvironment\u63a5\u53e3method\u4e0b\u9762\u4e00\u884c\u7684 params \uff0c\u600e\u4e48\u4e0d\u662fkey-value\u7684\u5f62\u5f0f\uff1f\u6709\u540c\u5b66\u77e5\u9053\u7684\u5417\uff1f \u5176\u5b9e\u8fd9\u91cc\u662f\u4e00\u4e2a\u7701\u7565\u7684\u5199\u6cd5\uff0c\u5f53key\u7684\u540d\u5b57\u548cvalue\u53d8\u91cf\u540d\u4e00\u6837\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u7701\u6389key\u3002\u4e5f\u5c31\u662f\u8bf4: {key: key}\u53ef\u4ee5\u7b80\u5199\u4e3a{key}\uff0c\u6ce8\u610f\uff1a\u524d\u9762\u7684key\u662f\u5b57\u7b26\u4e32\uff0c\u540e\u9762\u7684key\u662f\u53d8\u91cf\u3002\u8fd9\u4e2a\u5927\u5bb6\u8981\u641e\u660e\u767d\u624d\u80fd\u73a9\u5f97\u8f6c\uff01 \u9700\u8981\u7ef4\u62a4\u7684\u53d8\u91cf \u7531\u4e8e\u6211\u4eec\u7684\u73af\u5883\u5217\u8868\u83b7\u53d6\u9875\u652f\u6301\u5206\u9875\uff0c\u6240\u4ee5\u5728\u83b7\u53d6\u5217\u8868\u7684\u65f6\u5019\uff0c\u9700\u8981\u52a0\u4e0a\u5f53\u524dpage\u548csize2\u4e2a\u53c2\u6570\u3002\u8fd9\u8fb9\u6211\u4eec\u8fd8\u5f97\u7ef4\u62a4\u4e00\u4e2a\u53d8\u91cf: pagination\uff0c\u8fd9\u6837\u5f53\u6211\u4eec\u7528\u6237\u5207\u6362\u9875\u7801\u7684\u65f6\u5019\uff0c\u6211\u4eec\u53ef\u4ee5\u53bb\u8bf7\u6c42\u5bf9\u5e94page\u7684\u73af\u5883\u5217\u8868\u3002 \u9ed8\u8ba4current\u4e3a\u7b2c1\u9875\uff0cpageSize\u4e3a8\uff0c\u6570\u636e\u603b\u6570\u4e3a0 \u7531\u4e8e\u6211\u4eec\u7684list\u63a5\u53e3\u8fd8\u9700\u8981\u4e00\u4e2aname\u53c2\u6570\uff0c\u800c\u8fd9\u4e2aname\u4e5f\u4f1a\u8fdb\u884c\u66f4\u6362\uff0c\u6240\u4ee5\u6211\u4eec\u4e5f\u8981\u7ef4\u62a4\u4e00\u4e2aname\u7684\u53d8\u91cf\u3002 \u7f16\u5199\u83b7\u53d6\u73af\u5883\u5217\u8868\u7684\u65b9\u6cd5 \u8fd9\u4e2a\u65b9\u6cd5\u63a5\u53d7page, size\u548cname3\u4e2a\u53c2\u6570\uff0c\u5982\u679c\u4e0d\u4f20\u5165\u7684\u8bdd\uff0c\u9ed8\u8ba4\u4e3astate\u91cc\u9762\u7684\u503c\u3002\u4e3a\u5565\u8981\u8bbe\u5b9a\u53c2\u6570\uff0c\u8fd9\u4e2a\u8bf4\u6765\u8bdd\u957f\uff0c\u56e0\u4e3areact\u7684\u4fee\u6539\u72b6\u6001\u4e0d\u662f\u7acb\u9a6c\u751f\u6548\u7684\uff0c\u662f\u5f02\u6b65\u7684\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u4f60\u5728 \u7ffb\u9875 \u7684\u65f6\u5019\uff0c\u60f3\u7684\u662f\u66f4\u65b0\u4e86\u9875\u7801\u7684\u5f53\u524d\u9875\u4ece1->2\uff0c\u7136\u540e\u91cd\u65b0\u8c03\u7528fetchEnvironmentList\u65b9\u6cd5\uff0c\u53ef\u80fd\u8fd8\u662f\u53d6\u7684\u7b2c\u4e00\u9875\u6570\u636e\u3002\u6240\u4ee5\u6211\u4eec\u9700\u8981\u652f\u6301\u53c2\u6570\u5316\uff0c\u8fd9\u6837 \u66f4\u53ef\u63a7 \u3002 \u5982\u679c\u8bf7\u6c42\u6210\u529f\uff0c\u6211\u4eec\u5c31\u66f4\u65b0data\u7684\u6570\u636e\u4e3aresponse.data\uff0c pagination\u7684total\u5b57\u6bb5\u4e3ares.total\u3002 \u8fd9\u91cc\u6709\u4e2a\u7ec6\u8282\u8981\u503c\u5f97\u6ce8\u610f: \u6211\u4eec\u66f4\u65b0\u72b6\u6001\uff0c\u5fc5\u987b\u7528this.setState\uff0c\u4e0d\u80fd\u76f4\u63a5\u53bb\u4fee\u6539\u5b83\u7684\u503c\u3002\u6bd4\u5982: this.state.data = xxx\uff0c\u8fd9\u6837\u662f\u4e0d\u5bf9\u7684\u3002 \u601d\u8003\u4ec0\u4e48\u65f6\u5019\u4f1a\u53d1\u751f\u83b7\u53d6\u73af\u5883\u5217\u8868\u7684\u8c03\u7528 \u5176\u5b9e\u67092\u4e2a\u5730\u65b9\uff0c\u7b2c\u4e00\u4e2a\u662f\u6211\u521a\u8fdb\u6765\uff0c\u4f60\u8981\u7ed9\u6211\u5c55\u793a\u7b2c\u4e00\u9875\u7684\u6570\u636e\u3002\u7b2c\u4e8c\u4e2a\u662f\u6211\u641c\u7d22\u7684\u65f6\u5019\uff0c\u4f60\u4e5f\u8981\u7ed9\u6211\u5c55\u793a\u65b0\u7684\u6570\u636e\u3002 \u6211\u4eec\u52a0\u4e0a\u4e00\u4e2a\u8fd9\u6837\u7684\u65b9\u6cd5\uff0c componentDidMount \u662freact\u7684\u4e00\u4e2a\u56fa\u5b9a\u7684\u5199\u6cd5\uff0c\u4e5f\u662f\u7ee7\u627f\u81eaComponent\u7684\u65b9\u6cd5\uff0c\u4ee3\u8868\u8fd9\u4e2a\u7ec4\u4ef6\u52a0\u8f7d\u540e\u6267\u884c\u7684\u65b9\u6cd5\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u4ec5\u4ec5\u4f1a\u88ab\u6267\u884c\u4e00\u6b21\uff0c\u6ee1\u8db3\u4e86\u6211\u4eec\u7684\u9700\u6c42\uff08\u4e00\u8fdb\u6765\u5c31\u83b7\u53d6\u73af\u5883\u4fe1\u606f\uff09\u3002 \u770b\u770b\u6548\u679c \u90a3\u4e2a\u521b\u5efa\u4eba\u4e3a1\u7684\u5730\u65b9\uff0c\u5927\u5bb6\u5148\u5ffd\u7565\u6389\uff0c\u56e0\u4e3a\u6211\u5b58\u7684\u662f\u7528\u6237id\u3002 \u7f16\u5199\u67e5\u627e\u7684\u65b9\u6cd5 \u9996\u5148\u6211\u4eec\u9700\u8981\u6539\u5199\u641c\u7d22\u6846\uff0c\u5f53\u641c\u7d22\u6846\u7684\u6587\u672c\u6709\u53d8\u5316\u7684\u65f6\u5019\uff0c\u6211\u4eec\u9700\u8981\u53bb\u66f4\u65b0 name \uff0c\u5176\u6b21\u662f \u7528\u6237\u70b9\u51fb\u641c\u7d22\u6309\u94ae\u6216\u56de\u8f66\u7684\u65f6\u5019 \uff0c\u6211\u4eec\u8981\u53bb\u6839\u636e\u8f93\u5165\u7684\u5185\u5bb9\u641c\u7d22\u5bf9\u5e94\u7684\u73af\u5883\u3002 \u6539\u5199\u641c\u7d22\u6846 \u6ce8\u610f\u4e00\u4e0b\uff0c\u8fd9\u4e2a\u8f93\u5165\u6846\u7684\u5185\u5bb9\u7684value\u662fthis.state.name\uff0c\u7136\u540eonChange\u662fantd\u4e3aInput\u8f93\u5165\u6846\u63d0\u4f9b\u7684\u65b9\u6cd5\uff0ce.target.value\u53ef\u4ee5\u62ff\u5230\u7528\u6237\u8f93\u5165\u7684\u65b0\u503c\uff0c\u63a5\u7740\u6211\u4eec\u6839\u636e\u65b0\u7684\u503c\u6539\u5199name\u5373\u53ef\u3002 onSearch\u65b9\u6cd5\uff0c\u5b9e\u9645\u4e0a\u8c03\u7528\u4e86fetchEnvironmentList\u65b9\u6cd5\uff0c\u7b2c\u4e09\u4e2a\u53c2\u6570\u4f20\u5165\u4e86\u5f53\u524d\u7528\u6237\u8f93\u5165\u7684name\u3002 \u7f16\u5199\u65b0\u589e/\u4fee\u6539\u529f\u80fd \u5176\u5b9e\u65b0\u589e\u548c\u4fee\u6539\u5f88\u7b80\u5355\uff0c\u6211\u4eec\u60f3\u8c61\u6709\u4e00\u4e2a\u5bf9\u8bdd\u6846\uff0c\u91cc\u9762\u53ef\u4ee5\u586b\u5199\u73af\u5883\u540d\u548c\u5907\u6ce8\uff0c\u90a3\u4e0d\u5c31o\u4e86\u5417\uff1f\u96c0\u6c0f\u5982\u6b64\uff01 \u590d\u6742\u7684\u8868\u5355\uff0cantd\u90fd\u7ed9\u6211\u4eec\u5c01\u88c5\u597d\u4e86\uff0c\u535a\u4e3b\u8fd9\u91cc\u53c8\u8fdb\u4e00\u6b65\u5c01\u88c5\u4e86\u4e00\u5c42\uff0c\u6709\u5174\u8da3\u7684\u53ef\u4ee5\u53bb\u770b\u5177\u4f53\u7684\u6e90\u7801\u3002 \u6211\u4eec\u60f3\u505a\u7684\u5c31\u662f\uff0c\u70b9\u51fb \u65b0\u589e\u73af\u5883 \u6309\u94ae\uff0c\u7ed9\u54b1\u5bb6\u5f39\u51fa\u4e00\u4e2a\u5bf9\u8bdd\u6846\uff0c\u90a3\u5bf9\u8bdd\u6846\u5565\u65f6\u5019\u663e\u793a\uff0c\u662f\u4e0d\u662f\u5f88\u660e\u4e86\u4e86\u5462\uff1f\u4f60\u70b9\u7684\u65f6\u5019\u5c31\u663e\u793a\uff0cX\u6389\u5c31\u4e0d\u663e\u793a\u4e86\u3002 \u6240\u4ee5\u6211\u4eec\u9700\u8981\u4e00\u4e2avisible\u7684\u53d8\u91cf(\u9ed8\u8ba4\u4e3afalse)\uff0c\u53bb\u7ba1\u7406\u6211\u4eec\u5bf9\u8bdd\u6846\u662f\u5426\u51fa\u73b0\u3002\u8fd8\u9700\u8981\u4e00\u6761\u8bb0\u5f55record\uff0c\u7528\u4e8e\u521d\u59cb\u5316\u8868\u5355\u7684\u6570\u636e\u3002 Modal(\u4e5f\u5c31\u662f\u5bf9\u8bdd\u6846)\u6211\u4eec\u5df2\u7ecf\u7f16\u5199\u597d\u4e86\uff0conFinish\u4ee3\u8868\u7684\u662f\u8868\u5355\u7684\u63d0\u4ea4\u52a8\u4f5c\uff0c\u5728\u8fd9\u91cc\u67092\u79cd\uff1a \u65b0\u589e\u73af\u5883 \u7f16\u8f91\u73af\u5883 \u600e\u4e48\u533a\u5206\u5b83\u4eec\u5462\uff1f\u6211\u4eec\u6839\u636erecord\u91cc\u9762\u7684id\u662f\u4e0d\u662f0\u6765\u533a\u5206\uff0c\u5982\u679c\u4e0d\u662f0\u8bf4\u660e\u662f\u7f16\u8f91\u52a8\u4f5c\uff0c\u5426\u5219\u5219\u662f\u65b0\u589e\u52a8\u4f5c\u3002\u6240\u4ee5\u6211\u4eec\u5728\u70b9\u51fb \u65b0\u589e\u73af\u5883 \u6309\u94ae\u7684\u65f6\u5019\uff0c\u9700\u8981\u628arecord\u4e5f\u8fdb\u884c\u4e0b\u4fee\u6539\u3002 \u53ef\u4ee5\u770b\u5230\u6211\u4eec\u53ef\u4ee5\u6b63\u786e\u83b7\u53d6\u5230\u8868\u5355\u7684\u6570\u636e \u63a5\u7740\u6211\u4eec\u6765\u7f16\u5199onFinish\u65b9\u6cd5: \u5982\u679c\u6210\u529f\u63d0\u4ea4\uff0c\u6211\u4eec\u9700\u8981\u5173\u95ed\u5bf9\u8bdd\u6846\uff01\u6700\u7ec8\u6211\u4eec\u91cd\u65b0\u83b7\u53d6\u4e00\u904d\u6570\u636e\uff0c\u563f\u563f\u3002 \u6700\u540e\uff0c\u6211\u4eec\u9700\u8981\u4e3a \u7f16\u8f91 \u6309\u94ae\u6dfb\u52a0\u4e00\u4e2a\u70b9\u51fb\u4e8b\u4ef6: \u663e\u793a\u51fa\u5bf9\u8bdd\u6846\u5e76\u628a\u8868\u5355\u521d\u59cb\u5316\u4e3a\u8fd9\u884c\u6570\u636e\u3002 \u7f16\u5199\u5220\u9664\u65b9\u6cd5 \u5220\u9664\u5f88\u7b80\u5355\uff0c\u53ea\u9700\u8981\u4f20\u5165record.id\u7ed9onDelete\u65b9\u6cd5\uff0c\u5e76\u8c03\u7528\u5230\u540e\u7aef\u63a5\u53e3\u5373\u53ef\u3002 \u4f60\u4ee5\u4e3a\uff0c\u8fd9\u5c31\u7ed3\u675f\u4e86\uff1f\u5176\u5b9e\u8fd8\u67092\u4e2a\u5730\u65b9\uff01\u6709\u6ca1\u6709\u60f3\u8fc7\uff0c\u6211\u4eec\u6ca1\u6709\u5904\u7406table\u7ffb\u9875\u7684\u60c5\u51b5\uff0c\u8fd8\u6709\u4e2a\u5c31\u662f\u4e0a\u9762\u7684\u521b\u5efa\u4eba\u662f\u6570\u5b57\u7684\u60c5\u51b5\u3002 \u7f16\u5199\u7ffb\u9875\u529f\u80fd \u53ea\u9700\u8981\u5728table\u7684onChange\u4e8b\u4ef6\u91cc\u9762\u8c03\u7528\u83b7\u53d6\u73af\u5883\u5217\u8868\u7684\u65b9\u6cd5\u5373\u53ef\u3002\u6ce8\u610f\uff0cpagination\u53c2\u6570\u662f\u5f53\u524d\u4f60\u8981\u7ffb\u7684\u9875\u9762\uff0c\u6bd4\u5982\u4f60\u4ece\u7b2c\u4e00\u9875\u5230\u7b2c\u4e8c\u9875\uff0c\u90a3\u4e48pagination\u7684\u6570\u636e\u662f{current: 2, pageSize: 8}\uff0c\u8fd9\u4e2a\u5927\u5bb6\u53ef\u4ee5\u81ea\u5df1console.log\u8f93\u51fa\u8bd5\u8bd5\u3002\u8fd8\u5f97\u6307\u5b9a pagination \u53c2\u6570\u4e3athis.state.pagination\u3002 \u7b80\u5355\u5730\u66ff\u5927\u5bb6\u5c1d\u8bd5\u4e00\u4e0b \u5176\u5b9e\u62c6\u5206\u4e0d\u592a\u5408\u7406\uff0c\u4e0b\u7bc7\u82b1\u4e86\u592a\u591a\u65f6\u95f4\u3002\u4f46\u662f\u4e5f\u4e0d\u60f3\u82b1\u8d39\u592a\u591a\u7bc7\u7ae0\u4e86\u3002\u8f9b\u82e6\u5927\u5bb6\u8010\u5fc3\u770b\u5b8c\u4e86\uff01\u4e0d\u592a\u5b8c\u6574\u7684\u524d\u7aef\u6559\u7a0b\u5c31\u5230\u8fd9\u91cc\u4e86~ \u524d\u7aef\u4ee3\u7801\u4ed3\u5e93: https://github.com/wuranxu/pityWeb \u540e\u7aef\u4ee3\u7801\u4ed3\u5e93: https://github.com/wuranxu/pity","title":"33.\u7f16\u5199\u73af\u5883\u914d\u7f6e\u9875\u9762(\u4e0b)"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2834%29%20%E7%BC%96%E5%86%99%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F%E6%8E%A5%E5%8F%A3/","text":"\u56de\u987e \u4e0a\u4e00\u8282\u54b1\u4eec\u7f16\u5199\u597d\u4e86\u73af\u5883\u7ba1\u7406\u529f\u80fd\uff0c\u8fd9\u4e00\u7ae0\u8282\u6211\u4eec\u6765\u7ee7\u7eed\u5b8c\u5584 \u5168\u5c40\u53d8\u91cf \u529f\u80fd\u3002 \u5168\u5c40\u53d8\u91cf? \u5168\u5c40\u53d8\u91cf\uff0c\u5176\u5b9e\u6211\u89c9\u5f97\u53eb\u5b83\u5168\u5c40\u914d\u7f6e\u66f4\u52a0\u8d34\u5207\u3002\u6211\u7406\u89e3\u7684\u5168\u5c40\u53d8\u91cf\uff0c\u5176\u5b9e\u662f\u6211\u4eec\u5e38\u7528\u7684\u4e00\u4e9b\u4e0d\u592a\u53d8\u5316\u7684\u6570\u636e\uff0c\u800c\u7528\u4f8b\u4e2d\u51fa\u73b0\u7684\u53d8\u91cf\uff0c\u6211\u8ba4\u4e3a\u5b83\u662f\u4e00\u4e2a\u4e34\u65f6\u7684\u6570\u636e\uff0c\u4e0d\u4f1a\u8fdb\u884c \u6c38\u4e45\u5b58\u50a8 \u3002 \u90a3\u4ec0\u4e48\u65f6\u5019\u4f1a\u7528\u5230\u8fd9\u4e9b\u53d8\u91cf\u5462\uff1f\u6bd4\u5982\u54b1\u4eec\u7684\u4e00\u4e9b\u5e38\u7528\u7684\u6d4b\u8bd5\u5730\u5740\uff0cip\u4e5f\u597durl\u4e5f\u597d\uff0c\u5982\u679c\u7528\u4f8b\u4e0d\u628a\u8fd9\u5757\u5185\u5bb9\u62bd\u79bb\u51fa\u6765\uff0c\u4e00\u65e6\u5730\u5740\u53d1\u751f\u53d8\u5316\uff0c\u4f1a\u51fa\u73b02\u4e2a\u95ee\u9898\u3002 \u6211\u4eec\u9700\u8981\u5bf9\u7528\u4f8b\u8fdb\u884c\u4fee\u6539 \u4fee\u6539\u7684\u6210\u672c\u8f83\u5927 \u6709\u540c\u5b66\u53ef\u80fd\u4f1a\u8bf4\uff0c\u90a3\u6211\u53bb \u6570\u636e\u5e93 \u91cc\u9762\u76f4\u63a5update\u4e00\u4e0b\u4e0d\u5c31\u597d\u4e86\uff1f\u662f\u7684\uff0c\u4f60\u53ef\u4ee5\u8fd9\u4e48\u505a\u3002\u4f46\u662f\u8c01\u80fd\u4fdd\u8bc1update\u7684\u65f6\u5019\u4e0d\u4f1a\u51fa\u9519\uff0c\u8c01\u53c8\u80fd\u4fdd\u8bc1\u6bcf\u4e00\u6b21\u90fd\u80fd\u53ca\u65f6update\u4e86\u5462\uff1f\u6240\u4ee5\uff0c\u5982\u679c\u6211\u80fd\u5728 \u5168\u5c40\u53d8\u91cf \u9875\u9762\u8fdb\u884c\u7edf\u4e00\u4fee\u6539\uff0c\u90a3\u4e0d\u662f\u4e8b\u534a\u529f\u500d\u5417\uff1f\u8fd9\u4e5f\u5c31\u662f\u6211\u6240\u8bf4\u7684\uff0c\u5b83\u5176\u5b9e\u66f4\u50cf\u4e00\u4e2a \u5168\u5c40\u914d\u7f6e \u3002 \u8bbe\u8ba1\u601d\u8def \u5176\u5b9e\u6211\u4eec\u63d0\u4f9b\u7684\u5168\u5c40\u914d\u7f6e\uff0c\u7c7b\u4f3c\u4e8eRedis\uff0c\u662f\u4e00\u4e2akey-value\u7684\u5f62\u5f0f\u3002\u7528\u6237\u5982\u679c\u4f7f\u7528\u7684\u8bdd\uff0c\u53ea\u9700\u8981\u8f93\u5165key\uff0c\u5c31\u80fd\u591f\u6620\u5c04\u5230\u5bf9\u5e94\u7684value\u3002 \u60f3\u8c61\u4e00\u4e0b\uff0c\u5982\u679c\u4e00\u4e2avalue\u80fd\u591f\u5b58\u653eint\uff0cstr, float\u7b49\u591a\u79cd\u5bf9\u8c61\uff0c\u90a3\u4e48Mysql\u91cc\u9762\u8fd9\u4e2a\u5b57\u6bb5\u8be5\u5982\u4f55\u8bbe\u8ba1\uff1f\u6240\u4ee5\u8fd9\u4e2a\u65f6\u5019\u6211\u4eec\u5c31\u8981\u52a0\u4ee5\u8f85\u4f50\uff0c\u6211\u4eec\u5f15\u5165\u4e00\u4e2a key_type \u5b57\u6bb5\uff0c\u914d\u5408value\u5b9e\u73b0\u4e00\u4e2a\u5b57\u6bb5\u591a\u79cd\u6570\u636e\u7c7b\u578b\u7684\u529f\u80fd\u3002 \u4f46\u6211\u8fd9\u8fb9\u53c8\u4e0d\u60f3\u592a\u590d\u6742\uff0c\u56e0\u4e3a\u54b1\u90fd\u662f\u61d2\u4eba\u3002\u5176\u5b9e\u6211\u4eec\u5b9a\u4e49\u51e0\u79cd\u7c7b\u578b\u5c31\u591f\u4e86: string json yaml \u4e3a\u4ec0\u4e48\u53ea\u67093\u79cd\u7c7b\u578b\uff1f\u56e0\u4e3a\u5df2\u7ecf\u591f\u4e86\uff0c\u5982\u679c\u662fstring\u7c7b\u578b\uff0c\u5219\u4e0d\u9700\u8981\u8fdb\u884cjson.loads()\u53bb\u83b7\u53d6\u6570\u636e\uff0c\u5982\u679c\u662fjson\uff0c\u6211\u4eec\u9ed8\u8ba4\u901a\u8fc7json.loads()\u53bb\u8f6c\u6362\u4e00\u4e0b\u6570\u636e\u3002\u81f3\u4e8eyaml\uff0c\u7eaf\u7cb9\u662f\u4e3a\u4e86 \u65b0\u9c9c \u3002 \u4e3a\u4ec0\u4e48\u8bf4\u6211\u4eec\u7528json\u5c31\u53ef\u4ee5\u62ff\u5230float,int,bool\u7b49\u7b49\u503c\u5462\uff1f\u6211\u4eec\u6765\u770b\u4e00\u4e2a\u4f8b\u5b50: \u8bc1\u660e\u4e00\u4e0b \u90a3\u4e48\u6211\u4eec\u5b58\u5728\u6570\u636e\u5e93\u7684\u503c\u662fvarchar\u7c7b\u578b\u7684 0.618 \uff0c\u90a3\u6211\u4eec\u653e\u5165Python\u53ef\u4ee5\u8868\u73b0\u4e3a\u8fd9\u6837: a = \"0.618\" \u90a3\u600e\u4e48\u5f97\u5230float\u5462\uff1f a = \"0.618\" import json a = json.loads(a) print(type(a), a) image.png \u540c\u7406\u8bd5\u4e00\u4e0bbool: image.png \u81f3\u4e8estring\u4e3a\u4ec0\u4e48\u548cjson\u533a\u5206\u5f00\uff0c\u5176\u5b9ejson\u5c31\u662f\u4e2astring\uff0c\u6240\u4ee5\u6211\u4eec\u5982\u679c\u9047\u5230string\u7c7b\u578b\u5c31\u4e0d\u505a\u4efb\u4f55json.loads\u7684\u5904\u7406\uff0c\u5373\u53ef\u4fdd\u7559 \u539f\u6ecb\u539f\u5473 \u3002 \u8bbe\u8ba1\u8868 image.png env: \u53d8\u91cf\u5bf9\u5e94\u7684\u73af\u5883\uff0c\u5982\u679cenv\u4e3a0\u7684\u8bdd\uff0c\u8bf4\u660e\u8fd9\u4e2a\u53d8\u91cf\u5c5e\u4e8e\u5168\u90e8\u73af\u5883\u3002 enable: \u53d8\u91cf\u662f\u5426\u53ef\u7528\uff0c\u662f\u4e00\u4e2a\u5f00\u5173\u5b57\u6bb5\uff0c\u53ef\u4e34\u65f6\u5173\u95ed\u8be5\u53d8\u91cf \u6ce8\u610f\u8fd9\u91cc\u6709\u4e00\u4e2a\u8054\u5408\u552f\u4e00\u7d22\u5f15\uff0c\u6839\u636eenv,key\u548cdeleted_at\u751f\u6210\uff0c\u53ea\u6709\u5f53env,key,deleted_at\u90fd\u76f8\u7b49\u7684\u65f6\u5019\uff0c\u6570\u636e\u5e93\u624d\u4e0d\u8ba9\u63d2\u5165\u6570\u636e\u3002\u8fd9\u6837\u89e3\u51b3\u4e86\u4e00\u4e2a\u5728environment\u8868\u91cc\u9762\u51fa\u73b0\u7684\u95ee\u9898: \u5f53\u73af\u5883abc\u88ab\u5220\u9664\u4ee5\u540e\uff0c\u65e0\u6cd5\u518d\u5efa\u7acb\u540d\u4e3aabc\u7684\u73af\u5883 image.png \u6ce8\u518cmodel image.png \u7f16\u5199schema image.png \u7f16\u5199crud\u529f\u80fd from datetime import datetime from sqlalchemy import desc from app.models import Session, update_model from app.models.gconfig import GConfig from app.models.schema.gconfig import GConfigForm from app.utils.logger import Log class GConfigDao (object) : log = Log( \"GConfigDao\" ) @staticmethod def insert_gconfig (data: GConfigForm, user) : try : with Session() as session: query = session.query(GConfig).filter_by(env=data.env, key=data.key, deleted_at= None ).first() if query is not None : return f\"\u53d8\u91cf: {data.key} \u5df2\u5b58\u5728\" config = GConfig(**data.dict(), user=user) session.add(config) session.commit() except Exception as e: GConfigDao.log.error( f\"\u65b0\u589e\u53d8\u91cf: {data.key} \u5931\u8d25, {e} \" ) return f\"\u65b0\u589e\u53d8\u91cf: {data.key} \u5931\u8d25, {str(e)} \" return None @staticmethod def update_gconfig (data: GConfigForm, user) : try : with Session() as session: query = session.query(GConfig).filter_by(id=data.id, deleted_at= None ).first() if query is None : return f\"\u53d8\u91cf {data.key} \u4e0d\u5b58\u5728\" update_model(query, data, user) session.commit() except Exception as e: GConfigDao.log.error( f\"\u7f16\u8f91\u53d8\u91cf\u5931\u8d25: {str(e)} \" ) return f\"\u7f16\u8f91\u53d8\u91cf\u5931\u8d25: {str(e)} \" return None @staticmethod def list_gconfig (page, size, env=None, key=None) : try : search = [GConfig.deleted_at == None ] with Session() as session: if env: search.append(GConfig.env == env) if key: search.append(GConfig.name.ilike( \"%{}%\" .format(key))) data = session.query(GConfig).filter(*search) total = data.count() return data.order_by(desc(GConfig.created_at)).offset((page - 1 ) * size).limit( size).all(), total, None except Exception as e: GConfigDao.log.error( f\"\u83b7\u53d6\u53d8\u91cf\u5217\u8868\u5931\u8d25, {str(e)} \" ) return [], 0 , f\"\u83b7\u53d6\u53d8\u91cf\u5217\u8868\u5931\u8d25, {str(e)} \" @staticmethod def delete_gconfig (id, user) : try : with Session() as session: query = session.query(GConfig).filter_by(id=id).first() if query is None : return f\"\u53d8\u91cf {id} \u4e0d\u5b58\u5728\" query.deleted_at = datetime.now() query.update_user = user session.commit() except Exception as e: GConfigDao.log.error( f\"\u5220\u9664\u53d8\u91cf\u5931\u8d25: {str(e)} \" ) return f\"\u5220\u9664\u53d8\u91cf\u5931\u8d25: {str(e)} \" return None \u770b\u8fc7\u4e0a\u4e00\u7bc7\u6587\u7ae0\u7684\u90fd\u77e5\u9053\u7ec6\u8282\uff0c\u5176\u5b9e\u6211\u5199\u4ee3\u7801\u7684\u65f6\u5019\u4e5f\u662fcopy\u7684\u3002 \u5927\u5bb6\u6709\u6ca1\u6709\u53d1\u73b0: \u7f16\u5199\u4e00\u4e2acrud\u7684\u529f\u80fd\u662f\u771f\u7684\u4e0d\u96be\uff01 \u57fa\u672c\u53ef\u4ee5\u6309\u7167\u56fa\u5b9a\u7684\u5957\u8def\u6765\uff0c\u50cf\u6211\u90fd\u662fcopy\u7684\u4e0a\u4e00\u4e2a\u529f\u80fd\u70b9\u7684\u4ee3\u7801\uff0c\u7136\u540e\u7a0d\u4f5c\u6539\u52a8\u3002 \u7f16\u5199\u6838\u5fc3\u63a5\u53e3 from fastapi import Depends from app.dao.config.GConfigDao import GConfigDao from app.handler.fatcory import ResponseFactory from app.models.schema.gconfig import GConfigForm from app.routers import Permission from app.routers.config.environment import router from config import Config @router.get(\"/gconfig/list\") async def list_gconfig (page: int = 1 , size: int = 8 , env: int = None, key: str = \"\" , user_info=Depends (Permission () ) ) : data, total, err = GConfigDao.list_gconfig(page, size, env, key) if err: return dict(code= 110 , msg=err) return dict(code= 0 , data=ResponseFactory.model_to_list(data), total=total, msg= \"\u64cd\u4f5c\u6210\u529f\" ) @router.post(\"/gconfig/insert\") async def insert_gconfig (data: GConfigForm, user_info=Depends (Permission (Config.ADMIN) ) ) : err = GConfigDao.insert_gconfig(data, user_info[ 'id' ]) if err: return dict(code= 110 , msg=err) return dict(code= 0 , msg= \"\u64cd\u4f5c\u6210\u529f\" ) @router.post(\"/gconfig/update\") async def update_gconfig (data: GConfigForm, user_info=Depends (Permission (Config.ADMIN) ) ) : err = GConfigDao.update_gconfig(data, user_info[ 'id' ]) if err: return dict(code= 110 , msg=err) return dict(code= 0 , msg= \"\u64cd\u4f5c\u6210\u529f\" ) @router.get(\"/gconfig/delete\") async def delete_gconfig (id: int, user_info=Depends (Permission (Config.ADMIN) ) ) : err = GConfigDao.delete_gconfig(id, user_info[ 'id' ]) if err: return dict(code= 110 , msg=err) return dict(code= 0 , msg= \"\u64cd\u4f5c\u6210\u529f\" ) \u5176\u5b9e\u5927\u4f53\u4e0a\u8fd8\u662f\u548c\u4e4b\u524d\u7684 router \u5dee\u4e0d\u591a\uff0c\u4f46\u662f\u8fd9\u91cc\u591a\u4e86\u4e00\u4e2a\u7ec6\u8282: \u5f53config router\u4e0b\u9762\u6709\u4e2a\u6587\u4ef6\u7684\u65f6\u5019\u4f1a\u600e\u4e48\u6837\uff1f image.png \u6211\u4eec\u8fd9\u91cc\u6709\u4e00\u4e2agconfig\u548c\u4e00\u4e2aenvrionment\uff0c\u91cc\u9762\u5927\u69828\u4e2a\u63a5\u53e3\u3002 envrionment\u5b9a\u4e49\u4e86ApiRouter\u7684router\u5bf9\u8c61\uff0cgconfig\u5f15\u5165\u4e86router\u5bf9\u8c61\u3002\u90a3\u4e48\u6211\u4eec\u7684\u63a5\u53e3\u4f1a\u88ab\u6210\u529f\u6ce8\u518c\u5417\uff1f \u7b54\u6848\u662f\u4e0d\u4f1a\u7684\uff0c\u5927\u5bb6\u53ef\u4ee5\u8bd5\u4e00\u8bd5\u3002 \u56e0\u4e3a\u987a\u5e8f\u662f\u8fd9\u6837\u7684: router = ApiRouter() # environment\u4e2d\u53d1\u751f pity.include_router(config.router) router\u6ce8\u518cgconfig\u7684\u63a5\u53e3 \u56e0\u4e3a\u54b1\u4eec\u8fd0\u884c\u7684\u662fmain.py\u6587\u4ef6\uff0cmain.py\u5728import router\u7684\u65f6\u5019\u80af\u5b9a\u662f\u6700\u5148\u53d1\u751f\u7684\u3002\u5176\u5b9eflask\u4e5f\u4f1a\u9047\u5230\u8fd9\u6837\u7684\u95ee\u9898\uff0c\u89e3\u51b3\u65b9\u6cd5\u67092\u4e2a\u3002 \u5feb\u901f\u6cd5 main.py\u6ce8\u518crouter\u7684\u65f6\u5019\uff0c\u9009\u7528\u6700\u540e\u4e00\u4e2a\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0cenvrionment\u521b\u5efa\u4e86router\uff0cgconfig\u5f15\u5165\u4e86router\uff0c\u6211\u4eec\u4ecegconfig import router\u5c31\u884c\u3002\u4f46\u8fd9\u6837\u4e0d\u4f1a\u592a\u4fdd\u9669\uff0c\u56e0\u4e3a\u8fd8\u662f\u53ef\u80fd\u4f1a\u9057\u6f0f\u6216\u8005\u641e\u9519\u3002 \u5229\u7528__init__.py image.png \u6700\u540e\u5728\u6ce8\u518c\u7684\u65f6\u5019import init .py\u91cc\u9762\u7684router\u5373\u53ef\u3002\u7b80\u5355\u7684\u8bf4\u5c31\u662f\u641e\u4e00\u4e2a\u4e13\u95e8\u6536\u96c6router\u7684\u6587\u4ef6\uff0c\u6700\u540e\u96c6\u4e2d\u6ce8\u518c\u3002 image.png \u603b\u7ed3 \u672c\u671f\u9664\u4e86\u5199\u4e86\u5168\u5c40\u53d8\u91cf\u529f\u80fd\u4ee5\u5916\uff0c\u8fd8\u89e3\u51b3\u4e862\u4e2a\u95ee\u9898: \u8054\u5408\u7d22\u5f15\u95ee\u9898 router\u6ce8\u518c\u95ee\u9898 \u5e0c\u671b\u5bf9\u5927\u5bb6\u6709\u5e2e\u52a9~ \u540e\u7aef\u5730\u5740: https://github.com/wuranxu/pity \u524d\u7aef\u5730\u5740: https://github.com/wuranxu/pity \u5173\u6ce8\u6211\u7684\u4e2a\u4eba\u516c\u4f17\u53f7 \u6d4b\u8bd5\u5f00\u53d1\u5751\u8d27 \uff0c\u50ac\u66f4\u4e0d\u8ff7\u8def\u3002","title":"34.\u7f16\u5199\u5168\u5c40\u53d8\u91cf\u63a5\u53e3"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2835%29%20%E7%BC%96%E5%86%99%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F%E7%AE%A1%E7%90%86%E9%A1%B5%E9%9D%A2/","text":"\u6d4b\u8bd5\u5e73\u53f0\u7cfb\u5217(35) \u7f16\u5199\u5168\u5c40\u53d8\u91cf\u7ba1\u7406\u9875\u9762 \u5927\u5bb6\u597d\uff0c\u8fd9\u91cc\u662f\u7c73\u6d1b\uff0c\u4e00\u4e2a\u60f3\u548c\u5927\u5bb6\u4e00\u8d77\u5206\u4eab\u6d4b\u8bd5\u5f00\u53d1\u76f8\u5173\u7684\u6280\u672f\uff0c\u9762\u8bd5\u7ecf\u9a8c\u548c\u6210\u957f\u7ecf\u5386\u7684\u535a\u4e3b\uff01 \u6b22\u8fce\u5927\u5bb6\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7: \u6d4b\u8bd5\u5f00\u53d1\u5751\u8d27 \u3002 \u56de\u987e \u4e4b\u524d\u54b1\u4eec\u7f16\u5199\u4e86\u76f8\u5173\u7684\u540e\u7aef\u63a5\u53e3\uff0c\u73b0\u5728\u7ee7\u7eed\u6765\u5199 \u524d\u7aef \u7684\u9875\u9762\u3002\u6211\u6362\u4e86\u4e2a4k\u663e\u793a\u5668\uff0c\u622a\u56fe\u53ef\u80fd\u8fc7\u4e8e\u9ad8\u6e05\uff0c\u6d41\u91cf\u515a\u4e0d\u5efa\u8bae\u7acb\u5373\u89c2\u770b\u3002 \u8fd9\u53e5\u8bdd\u662f\u5199\u5b8c\u4e86\u518d\u5199\u7684\uff0c\u672c\u7bc7\u5185\u5bb9\u5b66\u4e60\u6307\u65700\u9897\u661f\uff0c\u4ee3\u7801\u6bd4\u8f83\u6666\u6da9\uff0c\u8bb2\u89e3\u4e5f\u4e0d\u591f\u5145\u5206\uff0c\u9002\u5408\u56de\u770b\u3002 \u5e03\u5c40 \u5148\u601d\u8003\u6211\u4eec\u9700\u8981\u7684\u7ec4\u4ef6: \u9700\u8981\u4e00\u4e2a \u73af\u5883\u9009\u62e9 \u6846\uff0c\u7ed9\u7528\u6237\u9009\u62e9\u5f53\u524d\u6240\u5728\u7684\u73af\u5883 \u9700\u8981\u4e00\u4e2a \u641c\u7d22\u6846 \uff0c\u901a\u8fc7key\u53bb\u641c\u7d22\u5bf9\u5e94\u7684\u53d8\u91cf \u9700\u8981\u4e00\u4e2a \u6dfb\u52a0\u53d8\u91cf \u7684\u6309\u94ae \u9700\u8981\u4e00\u4e2a\u8868\u683c\uff0c\u5c55\u793a\u5f53\u524d\u7684\u6570\u636e\u5185\u5bb9 \u5bf9\u6bd4\u524d\u9762\u7684\u7c7b\u4f3c\u9875\u9762\uff0c\u6211\u4eec\u65b0\u589e\u7684\u53ea\u6709 \u73af\u5883\u9009\u62e9\u6846 \uff0c\u6240\u4ee5\u57fa\u672c\u9875\u9762\u7684\u6837\u5f0f\u8fd8\u662f\u4e0d\u53d8\uff0c\u5148\u6765\u4e00\u5f20\u6548\u679c\u56fe\u3002 \u53ef\u4ee5\u770b\u5230\u8fd8\u662f\u52062\u680f\uff0c\u5728 \u6dfb\u52a0\u53d8\u91cf \u6309\u94ae\u4e4b\u524d\u591a\u4e86\u4e2a\u73af\u5883\u9009\u62e9\u6846\u548clabel\u3002 \u5f00\u59cb\u7f16\u5199\u57fa\u672c\u7684React\u6837\u5f0f\u7ec4\u4ef6(\u7c7bHTML) \u9ec4\u8272\u6846\u548c\u84dd\u8272\u6846\u5206\u522b\u662f2\u4e2a Row \uff0c\u5c06\u9875\u9762\u5206\u5272\u4e3a\u4e0a\u4e0b2\u4e2a\u90e8\u5206\u3002\u4e0a\u9762\u90e8\u5206\u5305\u542b3\u4e2a\u6a21\u5757\uff0c\u5bf9\u5e943\u5217: \u5360\u4e8c\u5206\u4e4b\u4e00\u5c4f\u5e55\u5bbd\u5ea6label + select \u5448\u73b0\u73af\u5883\u9009\u9879\u6846 \u5360\u56db\u5206\u4e4b\u4e00\u5c4f\u5e55\u5bbd\u5ea6\u7684\u7a7a\u5217 \u5360\u56db\u5206\u4e4b\u4e00\u5c4f\u5e55\u5bbd\u5ea6\u7684\u5217\uff0c\u5e26\u4e00\u4e2aInput\u8f93\u5165\u6846 \u5176\u5b9e\u5927\u5bb6\u9605\u8bfb\u4ee3\u7801\u7684\u8bdd\uff0c\u53ef\u4ee5\u628aRow\u770b\u505a \uff0cSelect\u8fd9\u79cd\u770b\u4f5c\u5c0f\u5199\u7684 <select> \uff0cInput\u4e5f\u662f\u5982\u6b64\u3002\u81f3\u4e8eCol\uff0c\u5b83\u4e5f\u662f\u4e2adiv\uff0c\u4f46\u662f\u4ed6\u4e0d\u662f\u5360\u5168\u90e8\u5bbd\u5ea6\u7684\uff0c\u4f60\u8bbe\u7f6espan\u5c5e\u6027\u4e3a6\uff0c\u90a3\u5c31\u53606/24\u4e5f\u5c31\u662f\u56db\u5206\u4e4b\u4e00\u7684\u5bbd\u5ea6\u3002 \u81f3\u4e8e\u4e0b\u9762\u7684Table\u5c31\u66f4\u7b80\u5355\u4e86\uff0c\u4ed6\u4e00\u4e2a\u8868\u683c\u5360\u636e\u4e8624\u7684\u5bbd\u5ea6\uff0c\u4e5f\u5c31\u662f100%\u7684\u5bbd\u5ea6\uff0c\u7b2c\u4e8c\u4e2adiv\u8981\u548c\u7b2c\u4e00\u4e2adiv\u6709\u4e00\u5b9a\u9ad8\u5ea6\u5dee\u8ddd\uff0c\u6240\u4ee5\u9700\u8981 margin-top: 8px \u3002 \u6700\u540e\u90a3\u4e2a\u591a\u51fa\u6765\u7684\u6ca1\u6709\u63d0\u53ca\u7684FormForModal\u7ec4\u4ef6\uff0c\u662f\u4e00\u4e2a\u8868\u5355\u7ec4\u4ef6\uff0c\u7528\u6765\u586b\u5199\u53d8\u91cf\u4fe1\u606f\uff0c\u9ed8\u8ba4\u662f\u9690\u85cf\u7684\u3002 \u7f16\u5199\u4ea4\u4e92\u90e8\u5206 \u8fd9\u6b21\u6211\u91c7\u53d6\u4e86 dva \u7ba1\u7406\u5168\u5c40\u72b6\u6001\uff0c\u8fd9\u5757\u5185\u5bb9\u76f8\u5bf9\u6765\u8bf4\u6bd4\u8f83\u6df1\u5965\uff0c\u5bf9\u5927\u5bb6\u6765\u8bf4\u6709\u70b9\u96be\u5ea6\u3002\u4f46\u662f\u5982\u679c\u7167\u7740\u5199\uff0c\u5c31\u5927\u6982\u80fd\u5b66\u7740\u5199\u4e86\u3002 dva\u52062\u4e2a\u6a21\u5757\u53bb\u7ba1\u7406\u6570\u636e: models service service\u76ee\u5f55\u5b58\u653e\u6240\u6709\u548c\u670d\u52a1\u7aef\u6253\u4ea4\u9053\u7684\u65b9\u6cd5\uff0cmodels\u4ee5\u547d\u540d\u7a7a\u95f4\u533a\u5206\u7ec4\u4ef6\u7684\u53d8\u91cf\uff0c\u6700\u7ec8\u5b9e\u73b0\u628a\u7ec4\u4ef6\u6240\u6709\u53d8\u91cf\u641c\u96c6\u5230\u4e00\u4e2a\u5927\u6c60\u5b50\u91cc\u9762\u8fdb\u884c\u7cbe\u7ec6\u5316\u7ba1\u7406\u3002\u8bf4\u7684\u53ef\u80fd\u5927\u5bb6\u4e91\u91cc\u96fe\u91cc\uff0c\u6ca1\u5173\u7cfb\uff0c\u5927\u6982\u610f\u601d\u5c31\u662f\u8bf4\uff0c\u4ee5\u524d\u6211\u4eec\u7ec4\u4ef6\u7684\u72b6\u6001\u90fd\u662f\u5728\u7ec4\u4ef6\u91cc\u9762\u53bb \u5b9a\u4e49\u7684\u53d8\u91cf \uff0c\u4f46\u73b0\u5728\u6211\u4eec\u628a\u5b83\u6258\u7ba1\u7ed9dva\uff0c\u6211\u4eec\u8c03\u7528dva\u63d0\u4f9b\u7684\u65b9\u6cd5\u53bb\u4fee\u6539/\u83b7\u53d6\u8fd9\u4e9b\u503c\uff0c\u8fd9\u6837\u4e0d\u7ba1\u6211\u7684\u7ec4\u4ef6\u5d4c\u5957\u591a\u6df1\uff0c\u90fd\u6ca1\u5173\u7cfb\uff0c\u6211\u53ef\u4ee5\u968f\u65f6\u62ff\u5230\u8fd9\u4e2a\u547d\u540d\u7a7a\u95f4\u4e0b\u9762\u7684\u503c\u3002 \u6240\u4ee5\u6211\u4eec\u9700\u8981\u5148\u7f16\u5199models\u91cc\u9762\u7684\u5185\u5bb9: \u9996\u5148\u5bfc\u51fa\u4e00\u4e2a\u5b57\u5178\uff0c\u91cc\u9762namespace\u5b9a\u4e49\u4e3a gconfig \uff0c\u63a5\u7740\u5b9a\u4e49state\u53d8\u91cf\uff0c\u628a\u53d8\u91cf\u90fd\u7ef4\u62a4\u5728\u91cc\u9762\u3002 key_type \u6307\u7684\u662f\u6570\u503c\u548c\u53d8\u91cf\u7c7b\u578b\u7684\u5173\u7cfb\u3002 reducers \u8fd9\u4e2a\u662f\u56fa\u5b9a\u5199\u6cd5\uff0c\u57fa\u672c\u4e0a\u8fd9\u91cc\u9762\u5199\u7684\u65b9\u6cd5\u90fd\u662f\u7528\u6765\u66f4\u65b0\u72b6\u6001\u7684\uff0c\u4e5f\u5c31\u662f\u66f4\u65b0state\u91cc\u9762\u7684\u5185\u5bb9\u3002 effects \u8fd9\u4e2a\u662f\u7528\u6765\u7f16\u5199\u548c\u540e\u7aef\u4ea4\u4e92\u7684\u65b9\u6cd5\uff0c\u4e5f\u662f\u5f88\u56fa\u5b9a\u7684\u5199\u6cd5\u3002select\u53ef\u4ee5\u4ece\u5f53\u524d\u7684\u72b6\u6001\u91cc\u9762\u62ff\u5230gconfig\u91cc\u9762\u7684state\uff0ccall\u8c03\u7528\u4e86\u540e\u7aef\u65b9\u6cd5\uff0c\u6700\u540e\u6211\u4eec\u7528put\u53bb\u8c03\u7528 reducers \u91cc\u9762\u5199\u7684save\u65b9\u6cd5\uff0c\u5c06\u72b6\u6001\u66f4\u65b0\uff0c\u4e5f\u5c31\u662f\u66f4\u65b0data\uff0cpagination\u7b49\u6570\u636e\u3002 \u8fd9\u4e9b\u5927\u5bb6\u6682\u65f6\u4e0d\u660e\u767d\u6ca1\u5173\u7cfb\uff0cdva\u662f\u4e00\u79cd\u53ef\u9009\u62e9\u7684\u5199\u6cd5\uff0c\u4e5f\u662f\u4e00\u79cd\u72b6\u6001\u7ba1\u7406\u7684\u89e3\u51b3\u65b9\u6848\u3002\u770b\u4e0d\u660e\u767d\u662f\u5f88\u6b63\u5e38\u7684\uff0c\u6211\u5f53\u65f6\u4e5f\u662f\u5b66\u7740\u5199\uff0c\u5199\u4e86\u5f88\u4e45\u6211\u624d\u80fd\u4e0d\u6284\u4ee3\u7801\u5199\u51fa\u4e00\u4e2ademo\u3002 \u540c\u6837\u7c7b\u4f3c\u5730\uff0c\u6211\u4eec\u5199\u51fa\u5176\u4ed6\u7684\u51e0\u4e2a\u65b9\u6cd5: \u8c03\u7528\u65b0\u589e\u63a5\u53e3\u540e\uff0c\u91cd\u65b0\u83b7\u53d6\u6700\u65b0\u7684Gconfig\uff08\u6839\u636e\u5f53\u524d\u7684page\u548c\u641c\u7d22\u9009\u9879\uff09 update\u63a5\u53e3\u4e5f\u662f\u5982\u6b64\u3002 \u5b8c\u5584\u4ea4\u4e92\u90e8\u5206 \u4e3a\u4ee3\u7801\u7f16\u8f91\u5668\u51c6\u5907\u8bed\u8a00\uff0c\u4e0d\u540c\u7684\u8bed\u8a00\u5982JSON\u548cString\u6709\u4e0d\u540c\u7684\u6548\u679c \u7f16\u5199\u73af\u5883\u7684\u8868\u683ccolumns \u73af\u5883\u5217\u5982\u679c\u662f0\u4ee3\u8868\u5168\u90e8\u73af\u5883\uff0c\u5426\u5219envMap\u91cc\u9762\u6ca1\u6709\u7684\u8bdd\uff0c\u4ee3\u8868\u73af\u5883\u53ef\u80fd\u88ab\u5220\u9664\u4e86\uff0c\u7ed9\u4e2a \u7ea2\u8272\u672a\u77e5 \u7684Tag\u5c55\u793a\u3002 \u64cd\u4f5c\u680f\u8fd8\u662f\u4e00\u5982\u65e2\u5f80\uff0c\u5220\u9664\u548c\u7f16\u8f912\u4e2a\u6309\u94ae\u3002 fields\u662f\u8868\u5355\u7684\u5b57\u6bb5 \u83b7\u53d6\u73af\u5883\u5217\u8868\u65b9\u6cd5\u548c\u83b7\u53d6\u53d8\u91cf\u65b9\u6cd5 dispatch\u4ee3\u8868\u8c03\u7528models\u91cc\u9762\u7684\u65b9\u6cd5\uff0c\u6211\u73b0\u5728\u8c03\u7528namespace: gconfig\u4e0b\u7684fetchEnvList\u65b9\u6cd5\uff0c\u62c9\u53d6\u6240\u6709\u7684\u73af\u5883\u3002 getConfig\u901a\u8fc7page\uff0csize\uff0cenv\uff0ckey\u8fd94\u4e2a\u53c2\u6570\uff0c\u5b9e\u73b0\u67e5\u8be2\u53d8\u91cf\u7684\u529f\u80fd\u3002 \u521d\u59cb\u5316\u64cd\u4f5c \u4e00\u5f00\u59cb\uff0c\u6211\u4eec\u9700\u8981\u83b7\u53d6\u6240\u6709\u73af\u5883\u548c\u83b7\u53d6\u5f53\u524d\u53d8\u91cf\uff0c\u4e0b\u9762\u7684useEffect\uff0c\u6211\u4eec\u63a5\u53d7\u4e86\u7b2c\u4e8c\u4e2a\u53c2\u6570\uff0c\u4e00\u4e2a\u6570\u7ec4: \u610f\u601d\u662f \u5f53\u5206\u9875\u91cc\u9762\u7684current\uff0cname\uff0c\u5f53\u524d\u73af\u5883\u53d1\u751f\u53d8\u5316\u65f6\uff0c\u91cd\u65b0\u83b7\u53d6\u5168\u5c40\u53d8\u91cf \uff0c\u8fd9\u4e2a\u529f\u80fd\u5f88\u597d\u7528\u3002 onFinish\u662f\u8868\u5355\u63d0\u4ea4\u7684\u65b9\u6cd5\uff0c\u8001\u5ba2\u6237\u4e86\u3002 save\u662f\u4fee\u6539state\u7684\u65b9\u6cd5\uff0c\u56e0\u4e3a\u7528\u7684\u6bd4\u8f83\u591a\uff0c\u6211\u628a\u5b83\u62bd\u6210\u4e00\u4e2a\u72ec\u7acb\u7684\u65b9\u6cd5\u3002 \u6f14\u793a\u4e00\u4e0buseEffect\u7684\u5f3a\u5927: \u53ef\u4ee5\u770b\u5230\u6211\u4eec\u7684\u9009\u62e9\u6846\u5728\u53d8\u5316\u7684\u65f6\u5019\uff0c\u53ea\u8c03\u7528\u4e86\u4fee\u6539currentEnv\u7684\u65b9\u6cd5\uff0c \u5e76\u6ca1\u6709\u91cd\u65b0\u53bb\u83b7\u53d6\u5168\u5c40\u53d8\u91cf \u3002\u4f46\u56e0\u4e3a\u6211\u4eec\u8bbe\u7f6e\u4e86useEffect\uff0c\u6240\u4ee5\u5f53\u73af\u5883\u53d1\u751f\u53d8\u5316\u7684\u65f6\u5019\uff0c\u6211\u4eec\u4f9d\u7136\u4f1a\u8c03\u7528getConfig\u7684\u65b9\u6cd5\u3002 \u6700\u540e\u7684\u6700\u540e\uff0c\u6211\u4eec\u628a\u7f16\u5199\u7684Gconfig\u7ec4\u4ef6\u7ed9connect\u8d77\u6765\uff0c\u8fd9\u6b65\u5f88\u96be\u7406\u89e3\uff0c\u4e0d\u7406\u89e3\u4e5f\u6ca1\u5173\u7cfb\uff0c\u53cd\u6b63\u4f1a\u6284\u5c31\u884c\uff0c \u6284\u4e0b\u6765\u6539\u6539\u5c31\u53ef\u4ee5\u7528 \u3002 \u5176\u5b9eloading\u4e5f\u7ecf\u8fc7dva\u505a\u4e86\u4e00\u5c42\u5904\u7406\uff0c\u4e0d\u77e5\u9053\u5927\u5bb6\u53d1\u73b0\u4e86\u6ca1\u6709\u5462\uff1f \u524d\u7aef\u4ee3\u7801\u4ed3\u5e93: https://github.com/wuranxu/pityWeb \u540e\u7aef\u4ee3\u7801\u4ed3\u5e93: https://github.com/wuranxu/pity","title":"35.\u7f16\u5199\u5168\u5c40\u53d8\u91cf\u7ba1\u7406\u9875\u9762"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2836%29%20%E4%BD%BF%E7%94%A8%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F/","text":"\u6d4b\u8bd5\u5e73\u53f0\u7cfb\u5217(36) \u4f7f\u7528\u5168\u5c40\u53d8\u91cf \u5927\u5bb6\u597d\uff0c\u8fd9\u91cc\u662f\u8001\u514b\uff0c\u4e00\u4e2a\u60f3\u548c\u5927\u5bb6\u4e00\u8d77\u5206\u4eab\u6d4b\u8bd5\u5f00\u53d1\u76f8\u5173\u7684\u6280\u672f\uff0c\u9762\u8bd5\u7ecf\u9a8c\u548c\u6210\u957f\u7ecf\u5386\u7684\u535a\u4e3b\uff01 \u6b22\u8fce\u5927\u5bb6\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7: \u6d4b\u8bd5\u5f00\u53d1\u5751\u8d27 \u3002 \u56de\u987e \u4e0a\u7bc7\u6211\u4eec\u5df2\u7ecf\u7f16\u5199\u597d\u4e86\u5168\u5c40\u53d8\u91cf\u7684\u9875\u9762\uff0c\u4eca\u5929\u6211\u4eec\u5c31\u6765\u5b66\u4e60\u600e\u4e48\u4f7f\u7528\u4ed6\u3002 Windows\u4e0b\u7684\u73af\u5883\u53d8\u91cf \u5176\u5b9e\u8bf4\u767d\u4e86\uff0c\u5168\u5c40\u53d8\u91cf\u4e5f\u5c31\u662f\u4e00\u4e2a\u53c2\u6570\u7684\u8bfb\u53d6->\u66ff\u6362\u7684\u8fc7\u7a0b\u3002\u6240\u4ee5\u6211\u4eec\u5f97\u5148\u8865\u4e60\u4e00\u4e0bel\u8868\u8fbe\u5f0f\u7684\u77e5\u8bc6\u3002\uff08\u5173\u4e8ejsonpath\uff0c\u8fd9\u4e2a\u6211\u4e0d\u592a\u719f\u6089\uff0c\u6211\u4e0d\u592a\u7b97Java\u6280\u672f\u6808\u7684\uff09 \u6211\u4eec\u90fd\u77e5\u9053\uff0c\u5728Windows\u7b49\u64cd\u4f5c\u7cfb\u7edf\u91cc\u9762\u4f1a\u6709 \u73af\u5883\u53d8\u91cf \u7684\u6982\u5ff5\uff0c\u6bd4\u5982: \u5f53\u6211\u4eececho %JAVA_HOME% \u7684\u65f6\u5019\uff0c\u4e3a\u4ec0\u4e48\u8f93\u51fa\u7684\u4e0d\u662f\"%JAVA_HOME%\"\u5462\uff1f\u56e0\u4e3awindows\u6709\u76f8\u5173\u7684\u7ea6\u5b9a\uff0c\u5f53\u5b57\u7b26\u4e32\u88ab%%\u5305\u88f9\u7684\u8bdd\uff0c\u610f\u5473\u7740\u53d6\u503c\u4f1a\u4ece\u73af\u5883\u53d8\u91cf\u91cc\u9762\u5bfb\u627e\uff0c\u5982\u679c\u627e\u4e0d\u5230\uff0c\u5c31\u4e0d\u8fdb\u884c\u66ff\u6362: \u8fd9\u4e2a\u53d8\u91cf\u4e0d\u5b58\u5728\uff0c\u6240\u4ee5\u4e0d\u8fdb\u884c\u4efb\u4f55\u66ff\u6362\u64cd\u4f5c EL\u8868\u8fbe\u5f0f \u8fd9\u662f\u6211\u5f53\u65f6\u5728\u4e0a\u4e0a\u5bb6\u516c\u53f8\u8bbe\u8ba1\u7684\u4e00\u5957\u53d8\u91cf\u8868\u793a\u8bed\u6cd5\uff0c\u4f46\u662f\u610f\u5916\u649e\u4e86EL\u8868\u8fbe\u5f0f\u3002\u6211\u7ea6\u5b9a\u7684\u662f\u7528 ${} \u5305\u88f9\u8d77\u6765\u7684\u5185\u5bb9\u90fd\u7b97\u4f5c\u53d8\u91cf\uff0c\u8fd9\u6837\u5728\u63a5\u53e3\u6d4b\u8bd5\u4e2d\u5982\u679c\u6709\u9700\u8981\u4f20\u9012\u53d8\u91cf\u7684\u60c5\u51b5\uff0c\u5c31\u53ef\u4ee5\u7528\u8fd9\u4e2a\u65b9\u5f0f\u6765\u89e3\u51b3\u3002 EL\u8868\u8fbe\u5f0f\u6e90\u81ea\u6211\u73b0\u5728\u6b63\u5728\u7ef4\u62a4\u7684\u4e00\u4e2aJSP\u7684\u9879\u76ee\uff0c\u4e5f\u7b97\u662f\u4e00\u79cd\u733f\u7caa\u5427\uff01 \u601d\u8def \u6211\u4eec\u73b0\u5728\u652f\u63013\u79cd\u53d8\u91cf\u7c7b\u578b: JSON/YAML/STRING\u3002\u6211\u4eec\u7684\u6b65\u9aa4\u4e5f\u5f88\u7b80\u5355: \u62ff\u5230\u53d8\u91cf\u7684\u503c\uff08\u53d6\u503c\uff09 \u66ff\u6362\u53d8\u91cf\u4e3a\u5bf9\u5e94\u7684\u771f\u5b9e\u503c(\u66ff\u6362) \u7f16\u5199\u53d8\u91cf\u89e3\u6790\u5668 \u7f16\u5199\u89e3\u6790\u5668\u57fa\u7c7b \u57fa\u7c7b\u67092\u4e2a\u65b9\u6cd5: \u89e3\u6790 \u53d6\u503c \u89e3\u6790\u662f\u4e00\u4e2a\u5f85\u5b9e\u73b0\u7684\u65b9\u6cd5\uff0c\u56e0\u4e3a\u4e0d\u540c\u7684\u7c7b\u578b\u89e3\u6790\u5668\u4e0d\u4e00\u6837\uff0c\u672a\u6765\u5982\u679c\u9700\u8981\u652f\u6301XML\u7c7b\u578b\uff0c\u90a3\u4e5f\u8981\u91cd\u5199\u8fd9\u4e2a\u65b9\u6cd5\u3002 \u53d6\u503c\u6bd4\u8f83\u901a\u7528\uff0c\u76ee\u524d\u6765\u8bb2\uff0c\u6211\u4eec\u89e3\u6790\u5b8cyaml\u4ee5\u540e\u4e5f\u662f\u4e00\u4e2ajson\u5bf9\u8c61\uff0c\u6240\u4ee5\u53ef\u4ee5\u5199\u5728\u57fa\u7c7b\u4e2d\u3002 \u6211\u4eec\u6765\u4ed4\u7ec6\u770b\u770b\u8fd9\u6bb5\u4ee3\u7801: \u53c2\u6570\u90e8\u5206 parse\u63a5\u53d72\u4e2a\u53c2\u6570\uff0cdata\u662f\u89e3\u6790\u540e\u7684\u6570\u636e\uff08\u4e00\u822c\u662fJSON\u5bf9\u8c61\uff09\uff0ckey\u662fel\u8868\u8fbe\u5f0f\u7684\u8def\u5f84\u5982: JAVA_HOME \u3002\u4f46\u662f\u6211\u4eec\u4e0d\u80fd\u53ea\u505a\u6700\u7b80\u5355\u7684\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u83b7\u53d6\u6df1\u5c42\u6b21\u8def\u5f84\u7684\u503c\u3002 \u4e3e\u4e2a\u4f8b\u5b50: \u5168\u5c40\u53d8\u91cf INFO \u7684\u503c\u662f\u4e2aJSON\u7c7b\u578b: { \"name\" : \"wc\" , \"age\" : 19 , \"hobby\" : \"play game\" } \u6211\u4eec\u5982\u679c\u53ea\u901a\u8fc7INFO\u53d6\u5230JSON\u5bf9\u8c61\uff0c\u90a3\u662f\u8fdc\u8fdc\u4e0d\u884c\u7684\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u80fd\u591f\u901a\u8fc7INFO.age\u53d6\u5230\u5bf9\u5e94\u7684\u5e74\u9f84\u3002\u6240\u4ee5\u6211\u4eec\u8fd9\u91cc\u7f16\u5199\u4e86get\u65b9\u6cd5\u3002 \u5b9e\u73b0\u8fc7\u7a0b \u5176\u5b9e\u9053\u7406\u5f88\u7b80\u5355\uff0c\u6211\u4eec\u5148\u901a\u8fc7 . \u53bb\u5206\u5272\u5b57\u7b26\u4e32\uff0c\u5982\u679c\u662fINFO.age\uff0c\u90a3\u4e48\u5b57\u7b26\u4e32\u5c31\u4f1a\u6210\u4e3a: [\"INFO\", \"age\"] \u6570\u7ec4\u3002\u63a5\u7740\u6211\u4eec\u4ece\u6570\u7ec4\u7684 \u7b2c2\u4e2a \u5143\u7d20\u53bb\u904d\u5386\uff0c\u5982\u679c\u53d6\u5230\u7684\u662f\u6570\u5b57\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u6309\u7167\u6570\u7ec4\u7d22\u5f15\u53bb\u53d6\u503c\uff0c\u5982\u679c\u662f\u666e\u901a\u7684key\uff0c\u5c31\u6309\u7167map\u6765\u53d6\u503c\u3002 \u6700\u540e\u505a\u4e00\u4e2a \u5f02\u5e38\u6355\u83b7 \uff0c\u9632\u6b62\u90a3\u79cd\u4e71\u5199\u53d8\u91cf\u7684\u60c5\u51b5\u51fa\u73b0\u3002\u5982\u679cresult\u662f\u5b57\u7b26\u4e32\uff0c\u6211\u4eec\u76f4\u63a5\u8fd4\u56de\u3002\u5982\u679c\u662f\u6570\u5b57\u7c7b\u578b\uff0c\u90a3\u6211\u4eec\u5c31\u5c06\u5b83\u8f6c\u4e3a\u5b57\u7b26\u4e32\u7c7b\u578b\u3002 \u601d\u8003 \u56e0\u4e3a\u6211\u4eec\u73b0\u5728\u662f\u53d6\u503c\uff0c\u540e\u671f\u66ff\u6362\u7684\u65f6\u5019\u662f\u7528replace\u628a ${INFO.age} \u66ff\u6362\u4e3a\u5bf9\u5e94\u7684\u503c\uff0c\u5982\u679c\u4f60\u7684age\u662f19\u8fd9\u4e2a\u6570\u5b57\u7684\u8bdd\uff0c\u60f3\u4e00\u4e0breplace\u4f1a\u51fa\u9519\u5417\uff1f \u5206\u522b\u5b9e\u73b03\u79cd\u89e3\u6790\u5668 \u5148\u770bstring\u7c7b\u578b\uff0c\u56e0\u4e3a\u4ed6\u81ea\u5df1\u4e0d\u53ef\u80fd\u518d\u53bb\u6df1\u5c42\u6b21\u53d6\u503c\u4e86\u3002 \u8bf4\u5230\u8fd9\u91cc\uff0c\u6211\u7a81\u7136\u60f3\u5230\u5b83\u53ef\u4ee5\u76f4\u63a5\u7d22\u5f15\u53bb\u53d6\u5bf9\u5e94\u7684\u5b57\u7b26\u4e32\u5b50\u4e32\uff0c\u4f46\u662f\u6211\u4e0d\u592a\u5efa\u8bae\u652f\u6301\u8fd9\u6837\u7684\u529f\u80fd\u3002\u56e0\u4e3a\u7d22\u5f15\u9700\u89812\u4e2a\u503c\uff0c1\u4e2a\u7684\u8bdd\u6bd4\u8f83\u9e21\u808b\u3002\u8fd9\u6837\u5bf9\u4e8e\u6211\u4eec\u7684el\u8868\u8fbe\u5f0f\u6765\u8bf4\u4e0d\u662f\u592a\u7edf\u4e00\u3002 \u6240\u4ee5\u6211\u4eec\u76f4\u63a5return value\uff0c\u4e5f\u5c31\u662f\u4e0d\u9700\u8981\u8fdb\u884c\u66f4\u6df1\u5c42\u6b21\u53d6\u503c\u4e86\u3002 \u518d\u770bJSON\u548cyaml\u7c7b\u578b\uff0c\u5176\u5b9e\u5c31\u662fload\u4e86\u4e00\u4e0b\u6570\u636e\uff08\u5c06\u5b57\u7b26\u4e32\u6570\u636e\u8f6c\u4e3aJSON\u5bf9\u8c61\uff09\u3002 \u7f16\u5199GConfigDao\u83b7\u53d6key\u7684\u65b9\u6cd5 \u4e4b\u524d\u6211\u4eec\u7684\u67e5\u8be2\u53d8\u91cf\u7684\u65b9\u6cd5\uff0c\u90fd\u662f\u6279\u91cf\u7684\uff0c\u6216\u8005\u8bf4\u662f\u67e5\u8be2\u4e00\u4e2a\u5217\u8868\u3002\u6211\u4eec\u9700\u8981\u4e00\u4e2a\u66f4\u7cbe\u786e\u7684\u641c\u7d22\uff0c\u53ea\u8981\u4e00\u6761\u53d8\u91cf\u7684\u6570\u636e\u3002 \u63a5\u53d7key\u7684\u540d\u5b57\u548c\u5bf9\u5e94\u7684\u73af\u5883\uff0c\u5982\u679c\u73af\u5883\u4e0d\u4f20\u7684\u8bdd\uff0c\u5219\u4e0d\u6839\u636e\u73af\u5883\u53bb\u67e5\u8be2\u3002\u56e0\u4e3a\u76ee\u524d\u6211\u4eec\u7528\u4f8b\u6267\u884c\u7684\u65f6\u5019\u6ca1\u6709\u8ddf\u73af\u5883\u7ed1\u5b9a\uff0c\u6240\u4ee5\u6682\u65f6\u5148\u4e0d\u4f20\u5165env\uff0c\u540e\u7eed\u5907\u7528\u7684\u5b57\u6bb5\u3002 \u8fd9\u91cc\u60f3\u5230\u4e86\u5c0f\u65b9\u7684\u7591\u60d1\uff0c\u4e4b\u524d\u53ef\u80fdgo\u5199\u591a\u4e86\uff0c\u4e0b\u610f\u8bc6\u4f1a\u628aerr return\u56de\u53bb\uff0c\u73b0\u5728\u6539\u6210Python\u7684\u5199\u6cd5\u4e86\u3002 \u6539\u5199\u7528\u4f8b\u7684\u6267\u884c\u90e8\u5206 \u5728\u6211\u7684\u7406\u89e3\u91cc\u9762\uff0c\u7528\u4f8b\u7684\u53d8\u91cf\u66ff\u6362\u662f\u5728 \u7528\u4f8b\u6267\u884c\u7684\u7b2c\u4e00\u6b65 \uff0c\u5e76\u4e14\u66ff\u6362\u7684\u5730\u65b9\u53ea\u6709\u90a3\u51e0\u5904: url request_header body \u56e0\u4e3a\u76ee\u524d\u8fd8\u6ca1\u6709\u524d\u540e\u7f6e\u6761\u4ef6\uff0c\u6240\u4ee5\u540e\u7eed\u518d\u8865\u5145\uff0c\u65ad\u8a00\u91cc\u7684\u5185\u5bb9\u4e5f\u5982\u6b64\uff0c\u5b83\u4eec\u72ec\u7acb\u4e8e\u7528\u4f8b\u4e4b\u5916\u4e86\u3002 \u6539\u9020Executor\u7c7b \u65b0\u589efields\u5b57\u6bb5\uff0c\u5b58\u653e\u9700\u8981\u66ff\u6362\u53d8\u91cf\u7684\u5b57\u6bb5\u3002 \u7f16\u5199parse_gconfig\u65b9\u6cd5 \u4f9d\u6b21\u53bb\u4fee\u6539\u5404\u4e2a\u5b57\u6bb5\u4e2d\u7684\u53d8\u91cf\u3002 \u7f16\u5199get_parser \u8fd9\u4e2a\u662f\u6839\u636egconfig\u7c7b\u578b\u6765\u83b7\u53d6\u5bf9\u5e94\u7684\u89e3\u6790\u5668\uff0c\u5982\u679c0\u5219\u4e3aString\u89e3\u6790\u5668\uff0c1\u5219\u662fJSON\u89e3\u6790\u5668\uff0c2\u5219\u662fYaml\u89e3\u6790\u5668\u3002 parse_field \u8fd9\u4e2a\u65b9\u6cd5\u662f\u5148\u83b7\u53d6\u539f\u59cb\u5b57\u6bb5\u91cc\u9762\u7684el\u8868\u8fbe\u5f0f\uff0c\u7136\u540e\u4f9d\u6b21\u53bb\u89e3\u6790\u5230\u771f\u5b9e\u6570\u636e\uff0c\u6700\u540e\u518d\u4fee\u6539TestCase\u7684\u5b57\u6bb5\uff08\u6ce8\u610f\u53ea\u662f\u4e34\u65f6\u4fee\u6539\uff0c\u4e0d\u4fee\u6539\u6570\u636e\u8868\uff09\u3002 \u76ee\u524d\u4ee3\u7801\u4f18\u5316\u70b9### \u5728run\u65b9\u6cd5\u52a0\u4e0a\u67092\u5904: \u901a\u8fc7key\u83b7\u53d6\u914d\u7f6e\u7684\u65f6\u5019\uff0c\u4e00\u65e6\u4e00\u4e2a\u5b57\u6bb5\u91cc\u9762\u51fa\u73b02\u4e2a\u53c2\u6570\u7684\u65f6\u5019\uff0c\u4f1a\u83b7\u53d62\u6b21key\uff0c\u4e5f\u5c31\u662f\u67e5\u8be2db2\u6b21\uff0c\u8fd9\u6837\u5f00\u9500\u5f88\u5927 \u6bcf\u6b21\u8dd1\u90fd\u4f1a\u6267\u884cdb\uff0c\u5f00\u9500\u5de8\u5927\uff0c\u53ef\u4ee5\u8003\u8651\u672c\u5730\u7f13\u5b58\u6216\u8005redis\u7f13\u5b58\u3002 \u4fee\u6539run\u65b9\u6cd5 -- \u770b\u4e0b\u6548\u679c \u53ef\u4ee5\u770b\u5230\u53c2\u6570\u90fd\u5df2\u7ecf\u8fdb\u884c\u4e86\u66ff\u6362\uff0c\u6211\u4eec\u518d\u6765\u770b\u770b\u53d8\u91cf BASIC_CONFIG \u7684\u5185\u5bb9: -- \u90a3\u4e48\uff0c\u672c\u671f\u5185\u5bb9\u5230\u8fd9\u91cc\u5c31\u7ed3\u675f\u4e86\u3002 \u5728\u7ebf\u6f14\u793a\u5730\u5740: http://47.112.32.195/ \u524d\u7aef\u4ee3\u7801\u4ed3\u5e93: https://github.com/wuranxu/pityWeb \u540e\u7aef\u4ee3\u7801\u4ed3\u5e93: https://github.com/wuranxu/pity","title":"36.\u4f7f\u7528\u5168\u5c40\u53d8\u91cf"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2837%29%20%E8%BF%90%E7%94%A8%E8%A3%85%E9%A5%B0%E5%99%A8%E7%BB%99%E7%94%A8%E4%BE%8B%E5%8A%A0%E4%B8%8A%E6%89%A7%E8%A1%8C%E6%97%A5%E5%BF%97/","text":"\u6d4b\u8bd5\u5e73\u53f0\u7cfb\u5217(37) \u8fd0\u7528\u88c5\u9970\u5668\u7ed9\u7528\u4f8b\u52a0\u4e0a\u6267\u884c\u65e5\u5fd7 \u5927\u5bb6\u597d\uff0c\u8fd9\u91cc\u662f \u7c73\u6d1b \uff0c\u4e00\u4e2a\u60f3\u548c\u5927\u5bb6\u4e00\u8d77\u5206\u4eab\u6d4b\u8bd5\u5f00\u53d1\u76f8\u5173\u7684\u6280\u672f\uff0c\u9762\u8bd5\u7ecf\u9a8c\u548c\u6210\u957f\u7ecf\u5386\u7684\u535a\u4e3b\uff01 \u6b22\u8fce\u5927\u5bb6\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7: \u6d4b\u8bd5\u5f00\u53d1\u5751\u8d27 \u3002 \u56de\u987e \u4e0a\u4e00\u8282\u6210\u529f\u628a\u5168\u5c40\u53d8\u91cf\u8fd0\u7528\u5230\u4e86\u7528\u4f8b\u4e4b\u4e2d\uff0c\u540e\u7eed\u6211\u4eec\u7684\u76ee\u6807\u5c31\u662f\u8981 \u5b8c\u5584\u6267\u884c\u7528\u4f8b\u7684\u8fc7\u7a0b \uff0c\u6682\u65f6\u6211\u4eec\u8fd8\u662f\u5355\u63a5\u53e3+\u7b80\u5355\u65ad\u8a00\u7684\u7ecf\u9a8c\u5b9d\u5b9d\uff0c\u540e\u9762\u6211\u4eec\u6162\u6162\u6210\u957f\u3002 \u4e00\u70b9\u60f3\u6cd5 \u5176\u5b9e React \u633a\u591a\u89c2\u4f17\u8fd8\u662f\u4e0d\u592a\u719f\u6089\u7684\uff0c\u540e\u7eed\u5982\u679c\u6211\u7ed9\u540c\u4e8b\u57f9\u8bad\u7684\u8bdd\uff0c\u53ef\u80fd\u4f1a\u5206\u4eab\u4e00\u4e9b\u5b66\u4e60React\u7684\u8d44\u6599\u3002\u540e\u7eed\u8fd9\u4e2a\u6559\u7a0b\u5c31\u4e0d\u592a\u8bb2\u524d\u7aef\u90e8\u5206\u4e86\uff0c\u5e94\u8be5\u5927\u90e8\u5206\u4eba\u90fd \u6ca1\u5565\u5174\u8da3 \u3002\u4e0d\u8fc7\u6211\u4f1a\u5927\u6982\u5c55\u793a\u4e00\u4e0b\u6700\u65b0\u7684\u9875\u9762\u6548\u679c\u3002 \u524d\u7aef\u4f18\u5316\u5c55\u793a \u628a\u57fa\u7840\u90e8\u5206\uff0cheaders\uff0cbody\u62c6\u51fa\u6765\u52063\u4e2atab\u5c55\u793a\u3002 \u6709\u7528\u5230\u5168\u5c40\u53d8\u91cf\u7684\u5730\u65b9\uff0c\u4f1a\u62c9\u53d6\u51fa\u5168\u5c40\u53d8\u91cf\uff0c\u5e76\u80fd\u770b\u5230\u5bf9\u5e94\u7684\u503c\u3002\u8fd9\u4e2a\u9009\u9879\u4e5f\u53ef\u4ee5\u6536\u8d77\u6765\u3002 \u5f00\u59cb\u672c\u8282\u65c5\u7a0b \u770b\u6807\u9898\u5c31\u53ef\u4ee5\u77e5\u9053\u6211\u4eec\u672c\u8282\u8981\u505a\u5565\u5b50\u4e86\u3002\u5173\u4e8e\u7528\u4f8b\u6267\u884c\u7684\u65e5\u5fd7\uff0c\u60f3\u8d77\u6211\u5728\u4e0a\u5bb6\u5355\u4f4d\u662f\u7c7b\u4f3c\u8fd9\u6837\u7684\u505a\u6cd5: self.logger.append( \"\u6b63\u5728\u66ff\u6362\u5168\u5c40\u53d8\u91cf: {}\" .format(xxx)) \u5728\u4e00\u4e2a\u7528\u4f8b\u7684\u6267\u884c\u8fc7\u7a0b\u4e2d\uff0c\u53ef\u4ee5\u770b\u5230 \u975e\u5e38\u591a \u8fd9\u6837\u7684\u8bed\u53e5\u3002\u90a3\u6211\u4eec\u6709\u6ca1\u6709\u66f4\u597d\u7684\u529e\u6cd5\u5462\uff1f \u7b54\u6848\u662f\u6709\u7684\u3002\u6211\u4eec\u53ef\u4ee5\u7528 \u88c5\u9970\u5668 \u53bb\u5b8c\u6210\u8fd9\u4e2a\u64cd\u4f5c\uff0c\u5728\u65b9\u6cd5\u6267\u884c\u4e4b\u524d\u8bb0\u5f55\u65e5\u5fd7\uff0c\u6267\u884c\u4e4b\u540e\u7ee7\u7eed\u8bb0\u5f55\u65e5\u5fd7\uff0c\u6700\u7ec8\u6c47\u603b\u5230 \u6d4b\u8bd5\u62a5\u544a \u4e2d\u3002 \u521d\u6b65\u8bbe\u60f3 \u7f16\u5199\u4e00\u4e2acase_log\u7684\u88c5\u9970\u5668\uff0c\u7ed9\u5b89\u6392\u5230Executor\u7684\u6bcf\u4e2a\u65b9\u6cd5\u4e0a\u9762\uff0c\u5e76\u5728\u6bcf\u4e2a\u65b9\u6cd5\u6267\u884c\u4e4b\u524d\u8f93\u51fa\u65e5\u5fd7\u5c31\u597d\u4e86\u3002 \u5b9e\u9645\u64cd\u4f5c \u9996\u5148\uff0c\u6211\u4eec\u56de\u5fc6\u4e00\u4e0b\u4e4b\u524d\u7684Executor\u7c7b\u3002 \u5f53\u65f6\u662f\u628aExecutor\u4e2d\u7684\u65b9\u6cd5\u90fd\u8bbe\u7f6e\u4e3a\u4e86 staticmethod \uff0c\u4e5f\u5c31\u662f\u8bf4\u91cc\u9762\u7684\u65b9\u6cd5/\u53d8\u91cf\u90fd\u662f\u901a\u8fc7 \u7c7b \u6765\u8bbf\u95ee\u7684\u3002 \u90a3\u8fd9\u6837\u5c31\u5bfc\u81f4\u4e86\u4e00\u4e2a\u5f88\u9ebb\u70e6\u7684\u95ee\u9898\uff0c\u6211\u4eec\u7684\u65e5\u5fd7\u6570\u636e\uff0c\u5b58\u5230\u54ea\u91cc\u5462\uff1f\u56e0\u4e3a\u662f\u7c7b\u65b9\u6cd5\uff0c\u6240\u4ee5\u8981\u77e5\u9053 \u88c5\u9970\u5668\u63a5\u53d7\u7684\u53c2\u6570\u662f\u4e0d\u5e26\u6709self\u6216\u8005cls\u7684 \u3002 \u6709\u7684\u540c\u5b66\u4f1a\u8f7b\u8511\u4e00\u7b11: \"\u4f60\u5728Executor\u7c7b\u91cc\u9762\u52a0\u4e00\u4e2alogger\u7684\u53d8\u91cf\uff0c\u5b58\u653e\u65e5\u5fd7\u4e0d\u5c31\u597d\u4e86\uff1f\" \u90a3\u6837\u662f\u4e0d\u884c\u7684\uff0c\u56e0\u4e3aExecutor\u662f\u9762\u5411\u6240\u6709\u7528\u6237\u7684\uff0c\u4e00\u65e6\u6709\u591a\u4e2a\u7528\u6237\u5728\u6267\u884c\u7528\u4f8b\uff0c\u90a3\u4f60\u7684logger\u4e0d\u5c31\u9519\u4e71\u4e86\uff1f\u7b80\u5355\u7684\u8bf4\u5c31\u662f\u8fd9\u4e2a\u65b9\u6cd5 \u4e0d\u652f\u6301\u5e76\u53d1 \u3002 \u6211\u4eec\u5728\u5b9e\u9645\u5f00\u53d1\u7684\u65f6\u5019\u4e00\u5b9a\u8981\u8003\u8651\u5230\uff0c\u4f60\u4e0d\u662f\u4e00\u4e2a\u4eba\u5728\u7528\u8fd9\u4e2a\u7cfb\u7edf\u3002\u90a3\u6211\u4eec\u6539\u9020\u5176\u5b9e\u5f88\u7b80\u5355\uff0c\u628a\u65b9\u6cd5\u90fd\u8bbe\u4e3a \u5b9e\u4f8b\u65b9\u6cd5 \uff0c\u5e76\u4e14\u5728\u751f\u6210Executor\u5b9e\u4f8b\u7684\u65f6\u5019\uff0c\u521d\u59cb\u5316\u4e00\u4e2alist()\u7528\u6765\u5b58\u653e\u65e5\u5fd7\u6570\u636e\u3002 \u7740\u624b\u6539\u9020Executor \u65b0\u589e__init__()\u65b9\u6cd5 \u8fd9\u4e2a_logger\u662f\u4e13\u95e8\u5b58\u653e\u65e5\u5fd7\u6570\u636e\u7684\u3002 \u6539\u9020Executor\u4e0b\u7684\u65b9\u6cd5 \u5c31\u50cf\u8fd9\u6837\uff0c\u53bb\u6389@staticmethod\u7684\u88c5\u9970\u5668\uff0c\u628aExecutor.xxx\u90fd\u6362\u6210self.xxx\u3002 \u8fd9\u6837\u5c31\u89e3\u51b3\u4e86\u5e76\u53d1\u7684\u95ee\u9898\uff0c\u56e0\u4e3a\u6211\u6bcf\u4e2a\u7ebf\u7a0b\u62e5\u6709\u7684\u5b9e\u4f8b\u662f\u72ec\u7acb\u7684\uff0c\u5e76\u4e0d\u50cfclass\u4e00\u6837\u662f\u5171\u4eab\u7684\u3002 \u7f16\u5199case_log\u88c5\u9970\u5668 \u6211\u4eec\u901a\u8fc7args[0]\u5c31\u80fd\u83b7\u53d6\u5230self\u4e86( \u81f3\u4e8e\u4e3a\u4ec0\u4e48\uff0c\u5927\u5bb6\u53ef\u4ee5\u601d\u8003\u4e00\u4e0b )\uff0c\u901a\u8fc7self\u5c31\u80fd\u83b7\u53d6\u5230logger\u53d8\u91cf\u4e86\u3002\uff08\u6211\u8fd9\u91cc\u5199\u7684cls\uff0c\u6ca1\u5565\u5173\u7cfb\uff0c\u80fd\u7406\u89e3\u5b83\u662fself\u5c31\u884c\uff09 \u63a5\u7740\u5c31\u662f\u5bf9\u53c2\u6570\u7684\u83b7\u53d6\uff0c\u65e5\u5fd7\u8bdd\u672f\u7684\u6574\u7406\u3002 \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u6211\u8fd9\u91cc\u5bf9\u6bcf\u4e2a\u65b9\u6cd5\u90fd\u83b7\u53d6\u4e86\u4e00\u4e0b__doc__\uff0c\u4e5f\u5c31\u662f\u65b9\u6cd5\u7684\u6ce8\u91ca\uff0c\u5982\u679c\u6ca1\u6709\u7684\u8bdd\u5c31\u4f1a\u53d6\u65b9\u6cd5\u7684\u540d\u5b57\u3002 \u5bf9\u4e8e\u4e00\u4e9b\u7c7b\u53c2\u6570\uff0c\u6211\u4eec\u76f4\u63a5\u8f93\u51fa\u5b83\u7684\u8bdd\u4f1a\u6bd4\u8f83\u96be\u4ee5\u9605\u8bfb\uff0c\u90a3\u6211\u4eec\u9700\u8981\u91cd\u5199\u5b83\u7684__str__\u65b9\u6cd5\uff0c\u5c31\u53ef\u4ee5\u8fbe\u5230\u8bdd\u672f\u53cb\u597d\u7684\u76ee\u7684\u3002 \u6211\u4eec\u53bb\u770b\u770bTestCase\u7c7b\u7684\u6539\u52a8: \u6211\u4eec\u6807\u8bb0\u4e86\u4ed6\u662f\u7528\u4f8b\uff0c\u5e76\u4e14\u7ed9\u51fa\u4e86\u7528\u4f8b\u540d\u5b57\u548cid\uff0c\u56e0\u4e3a\u663e\u793a\u7528\u4f8b\u5168\u90e8\u4fe1\u606f\u4e0d\u592a\u73b0\u5b9e\uff08\u4e3b\u8981\u662f\u5360\u4f4d\u7f6e\uff09\u3002 \u6539\u9020\u6267\u884c\u65b9\u6cd5 \u628a\u65e5\u5fd7\u7ed9join\u4e00\u4e0b\u5e76\u8fd4\u56de\u5373\u53ef\u3002 \u8fd9\u91cc\u9700\u8981\u5b9e\u4f8b\u5316 \u770b\u770bprint\u7684\u6548\u679c: \u867d\u7136\u6548\u679c\u4e0d\u5982\u76f4\u63a5\u7528self.logger.append\u81ea\u7531\u5ea6\u9ad8\uff0c\u4f46\u662f\u4e5f\u8db3\u591f\u4f7f\u7528\u4e86\u3002 \u8fdb\u9636 \u5176\u5b9e\u5f88\u591a\u65f6\u5019\u65e5\u5fd7\u9700\u8981\u9ad8\u4eae\uff0c\u6211\u4eec\u5176\u5b9e\u53ef\u4ee5\u8f93\u51fa html \u683c\u5f0f\u7684\u65e5\u5fd7\uff0c\u65b9\u4fbf\u5c55\u793a \u5173\u952e\u4fe1\u606f \u3002 \u4eca\u5929\u7684\u540e\u7aef\u5185\u5bb9\u5c31\u5230\u8fd9\u513f\u4e86\uff0c\u535a\u4e3b\u7ee7\u7eed\u53bb\u5199\u524d\u7aef\u90e8\u5206\u4e86\u3002 \u5728\u7ebf\u6f14\u793a\u5730\u5740: http://47.112.32.195/ \u524d\u7aef\u4ee3\u7801\u4ed3\u5e93: https://github.com/wuranxu/pityWeb \u540e\u7aef\u4ee3\u7801\u4ed3\u5e93: https://github.com/wuranxu/pity","title":"37.\u8fd0\u7528\u88c5\u9970\u5668\u7ed9\u7528\u4f8b\u52a0\u4e0a\u6267\u884c\u65e5\u5fd7"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2838%29%20%E6%8E%A5%E5%85%A5github%E7%AC%AC%E4%B8%89%E6%96%B9%E7%99%BB%E5%BD%95/","text":"\u5927\u5bb6\u597d\uff0c\u8fd9\u91cc\u662f\u7c73\u6d1b\uff0c\u4e00\u4e2a\u60f3\u548c\u5927\u5bb6\u4e00\u8d77\u5206\u4eab \u6d4b\u8bd5\u5f00\u53d1 \u76f8\u5173\u7684\u6280\u672f\uff0c\u9762\u8bd5\u7ecf\u9a8c\u548c\u6210\u957f\u7ecf\u5386\u7684\u535a\u4e3b\uff01 \u6b22\u8fce\u5927\u5bb6\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7: \u6d4b\u8bd5\u5f00\u53d1\u5751\u8d27 \u3002 \u80cc\u666f\u77e5\u8bc6 \u76ee\u524d\u5e73\u53f0\u7ef4\u7cfb\u4e86\u81ea\u5df1\u7684\u4e00\u5957\u7528\u6237\u7cfb\u7edf\uff0c\u4f46\u662f \u6709\u6ca1\u6709\u89c9\u5f97\u6bcf\u6b21\u6709\u65b0\u7528\u6237\u90fd\u9700\u8981\u624b\u52a8\u6ce8\u518c\u4f1a\u6bd4\u8f83\u9ebb\u70e6\uff1f \u5728\u4f01\u4e1a\u4e2d\uff0c\u5982\u679c\u5927\u5bb6\u6240\u6709\u7cfb\u7edf\u90fd\u7528\u4e00\u4e2a\u8d26\u53f7\u53bb\u767b\u5f55\uff0c\u4f1a\u4e0d\u4f1a\u5341\u5206\u65b9\u4fbf\u5462\uff1f \u5176\u5b9e\u4f01\u4e1a\u5185\u90e8\u90fd\u4f1a\u6709\u8fd9\u6837\u7684sso\u7cfb\u7edf\uff0c\u5b9e\u73b0\u4e00\u4e2a\u8d26\u53f7\u5171\u4eab\u6240\u6709\u5e73\u53f0\u3002\u90a3\u6211\u4eec\u6709\u4ec0\u4e48\u662f\u6bd4\u8f83\u901a\u7528\u7684\uff0c\u5927\u5bb6\u90fd\u6709\u7684\u8d26\u53f7\u5462\uff1f \u5176\u5b9e\u6709\u8bb8\u591a\uff0cQQ/\u5fae\u4fe1/\u652f\u4ed8\u5b9d\u8fd9\u4e9b\u57fa\u672c\u5927\u5bb6\u90fd\u6709\u3002\u4e0d\u8fc7\u8003\u8651\u5230\u63a5\u5165\u7684\u96be\u6613\u7a0b\u5ea6\uff0c\u6211\u8fd9\u8fb9\u9009\u62e9\u4e86\u652f\u6301 github\u8d26\u53f7 \u63a5\u5165\u3002 \u5982\u679c\u4e0d\u4e86\u89e3\u7684\u8bdd\uff0c\u53ef\u4ee5\u641c\u7d22\u5bf9\u5e94\u7684\u5173\u952e\u8bcd: \u5355\u70b9\u767b\u5f55\u3001SSO\u3001OAuth \u6784\u601d \u5355\u70b9\u767b\u5f55\u5176\u5b9e\u8fd8\u5305\u62ecsession\u7b49\u90e8\u5206\uff0c\u4f46\u662f\u56e0\u4e3a\u6211\u4eec\u53ea\u662f\u60f3 \u901a\u8fc7github\u62ff\u5230\u7528\u6237\u4fe1\u606f \uff0c\u5e76\u4e0d\u9700\u8981\u5b83\u5e2e\u6211\u4eec\u7ba1\u7406\u7528\u6237\u767b\u5f55\u72b6\u6001\u3002\u6240\u4ee5\u6211\u4eec\u63a5\u5165\u7684\u8bdd\uff0c\u901a\u8fc7\u83b7\u53d6 \u7528\u6237\u4fe1\u606f \uff0c\u6574\u5408\u5230\u6211\u4eec\u7684pity_user\u8868\u5373\u53ef\u3002 \u521b\u5efaOAuth app github\u5b98\u65b9\u6587\u6863: https://docs.github.com/v3/oauth/ [1] \u8fdb\u5165settings \u9009\u62e9Developer settings \u5207\u6362\u5230OAuth app \u53ef\u4ee5\u770b\u5230\uff0c\u6211\u8fd9\u91cc\u7533\u8bf7\u4e862\u4e2a\uff0c\u4e00\u4e2a\u662flocal\uff08\u672c\u5730\u8c03\u8bd5\u7528\uff09\uff0c\u53e6\u4e00\u4e2a\u662f\u7ebf\u4e0a\u5730\u5740\u3002 \u70b9\u51fbNew OAuth App \u6ce8\u518c\u597d\u4e86\u4e4b\u540e\u5c31\u53ef\u4ee5\u67e5\u770b\u4e86\uff01 \u83b7\u53d6ClientID\u548cClientSecrets \u8fd92\u4e2a\u503c\u8bb0\u5f97\u4fdd\u5b58\u597d\uff0c \u7a0d\u540e\u4f1a\u7528\u5230 \u3002 \u8be6\u7ec6\u63a5\u5165\u6d41\u7a0b \u91cd\u5b9a\u5411\u5230login\u9875\u9762 \u5047\u8bbe\u6211\u4eec\u7684\u9996\u9875\u662fhttps://www.wqrf.com\uff0c\u6211\u4eec\u8bbf\u95ee\u9996\u9875\u7684\u65f6\u5019\uff0c\u7531\u4e8e \u672a\u767b\u5f55 \uff0c\u4f1a\u88ab\u91cd\u5b9a\u5411\u5230\u767b\u5f55\u9875\u3002 \u6211\u4eec\u63d0\u4f9b\u4e00\u4e2a\u6309\u94ae\u6216\u8005\u94fe\u63a5\u53eb: \u7528Github\u767b\u5f55 \uff0c\u5f53\u7528\u6237\u70b9\u51fb\u8fd9\u4e2a\u6309\u94ae\u7684\u65f6\u5019\uff0c\u6211\u4eec\u5c31\u8df3\u8f6c\u5230: \u8fdb\u5165github\u8ba4\u8bc1\u9875\u9762 https://github.com/login/oauth/authorize?client_id= \u4f60\u7533\u8bf7\u7684clientid \u5982\u679c\u7528\u6237\u8fdegithub\u90fd\u6ca1\u767b\u5f55\uff0c\u90a3\u4e48\u8fd9\u4e2a\u9875\u9762\u4f1a\u53d8\u6210\u4e00\u4e2agithub\u7684\u767b\u5f55\u9875\uff0c\u5426\u5219\u4f1a\u53d8\u6210\u4e00\u4e2a\u6388\u6743\u9875\u9762\uff0c\u95ee\u4f60\u662f\u4e0d\u662f\u8981\u767b\u5f55\u8fd9\u4e2a\u7f51\u7ad9\uff0c\u89c1\u4e0b\u56fe: \u56fe\u662f\u672a\u767b\u5f55github\u7684\u60c5\u51b5 \u901a\u8fc7\u9a8c\u8bc1 \u767b\u5f55\u540eGithub\u4f1a\u6839\u636e\u4f60\u7684clientId\u751f\u6210\u4e00\u4e2a code \uff0c\u91cd\u5b9a\u5411\u5230\u4f60\u7684\u4e3b\u9875\u5e76\u5e26\u5165code\u53c2\u6570: https://www.wqrf.com?code= Github\u751f\u6210\u7684code \u83b7\u53d6token \u63a5\u7740\u6211\u4eec\u5c31\u901a\u8fc7code+clientid+secret\u53bb\u62ff\u5230github\u7684token\u3002 \u8c03\u7528github\u63a5\u53e3 \u62ff\u5230\u4e86\u4e4b\u540e\u5c31\u53ef\u4ee5\u5927\u6447\u5927\u6446\u5730\u8c03\u7528github\u7684\u63a5\u53e3 \u83b7\u53d6\u5230\u7528\u6237\u4fe1\u606f \u4e86\u3002 \u603b\u7ed3 \u7b49\u4e0d\u53ca\u7684\u53ef\u4ee5\u770b\u770b\u5177\u4f53\u7684github\u4f7f\u7528\u6587\u6863\uff0c\u867d\u7136\u662f\u82f1\u6587\u7684\uff0c\u4f46\u662f\u5f88\u8be6\u7ec6\u3002\u7b49\u5f97\u53ca\u7684\uff0c\u53ef\u4ee5\u770b\u6211\u4e0b\u4e00\u7bc7 \u5b9e\u64cd \uff01 github\u6700\u8fd1\u6253\u5f00\u90fd\u5f88\u6162\uff0c\u4f1a\u5f71\u54cd\u767b\u5f55\u6548\u679c\u3002 \u53c2\u8003\u8d44\u6599 [1] https://docs.github.com/v3/oauth/: https://docs.github.com/v3/oauth/","title":"38.\u63a5\u5165github\u7b2c\u4e09\u65b9\u767b\u5f55"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2839%29%20%E6%8E%A5%E5%85%A5github%E7%AC%AC%E4%B8%89%E6%96%B9%E7%99%BB%E5%BD%95%28%E4%B8%8B%29/","text":"\u6d4b\u8bd5\u5e73\u53f0\u7cfb\u5217(38) \u63a5\u5165github\u7b2c\u4e09\u65b9\u767b\u5f55(\u4e0b) \u5927\u5bb6\u597d\uff0c\u8fd9\u91cc\u662f\u7c73\u6d1b\uff0c\u4e00\u4e2a\u60f3\u548c\u5927\u5bb6\u4e00\u8d77\u5206\u4eab \u6d4b\u8bd5\u5f00\u53d1 \u76f8\u5173\u7684\u6280\u672f\uff0c\u9762\u8bd5\u7ecf\u9a8c\u548c\u6210\u957f\u7ecf\u5386\u7684\u535a\u4e3b\uff01 \u6b22\u8fce\u5927\u5bb6\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7: \u6d4b\u8bd5\u5f00\u53d1\u5751\u8d27 \u3002 \u4e0a\u7bc7\u6211\u4eec\u60f3\u597d\u4e86\u5177\u4f53\u7684\u601d\u8def\uff0c\u8fd9\u7bc7\u5c31\u6765\u5b9e\u73b0\u4e4b\u3002 \u5b9e\u73b0 \u5176\u5b9e\u540e\u7aef\u8981\u505a\u7684\u90e8\u5206\u5f88\u7b80\u5355\uff0c\u53ea\u9700\u8981\u5b8c\u6210\u540e\u97622\u6b65\u5373\u53ef\uff0c\u5373\u751f\u6210token\u548c\u83b7\u53d6\u7528\u6237\u4fe1\u606f\u3002 \u7f16\u5199register_for_github\u65b9\u6cd5 \u5f53\u4ecegithub\u83b7\u53d6\u5230\u7528\u6237\u4fe1\u606f\u4ee5\u540e\uff0c\u5199\u5165\u6211\u4eec\u81ea\u5df1\u7684\u7528\u6237\u8868\uff0c\u5982\u679c\u6709\u5219\u66f4\u65b0\u7528\u6237\u4fe1\u606f\uff0c\u5982\u679c\u6ca1\u6709\u5219\u65b0\u589e\u4e00\u6761\u8bb0\u5f55\u3002 \u5148\u67e5\u8be2\u5230email\u548cusername\u90fd\u5339\u914d\u7684\u7528\u6237\uff0c\u5982\u679c\u6709\uff0c\u6211\u4eec\u5c31\u66f4\u65b0\u7528\u6237\u7684\u6635\u79f0\u548c\u5934\u50cf\u5b57\u6bb5\uff0c\u5e76\u66f4\u65b0\u4ed6\u7684 \u6700\u540e\u767b\u5f55\u65f6\u95f4 \u3002 \u5982\u679c\u6ca1\u6709\u8be5\u7528\u6237\uff0c\u6211\u4eec\u5c31\u65b0\u751f\u6210\u4e00\u4e2a \u7528\u6237 \u3002\u8fd9\u91cc\u968f\u673a\u4e86\u51e0\u4f4d\u6570\u5b57\u52a0\u76d0\uff0c\u4fdd\u8bc1\u7528\u6237\u7684\u5bc6\u7801\u662f\u968f\u673a\u7684\uff0c\u5982\u679c\u901a\u8fc7github\u767b\u5f55\u7684\u7528\u6237\uff0c \u57fa\u672c\u4e0a\u4e0d\u592a\u5bb9\u6613\u8bd5\u51fa\u4ed6\u5728\u6d4b\u8bd5\u5e73\u53f0\u7528\u6237\u8868\u7684\u5bc6\u7801 \u3002 \u7f16\u5199github\u767b\u5f55\u63a5\u53e3 \u8bf7\u6c42\u53c2\u6570\u4e3acode\uff0c\u8fd9\u91cc\u7528\u5230\u4e86requests\u7684Session\u7c7b\uff0c\u56e0\u4e3a\u6b64\u5904\u9700\u8981\u53d1\u90012\u6b21http\u8bf7\u6c42\u3002 \u83b7\u53d6access_token url: https://github.com/login/oauth/access_token method: GET/POST\u90fd\u53ef\u4ee5 \u53c2\u6570: code\uff0cclientid\u548csecret\uff0c\u4e5f\u5c31\u662f\u524d\u6587\u8981\u6c42\u8bb0\u5f55\u76842\u4e2a\u5b57\u6bb5 \u8fd4\u56de\u6570\u636e\u662f\u8fd9\u6837\u7684: \u4e00\u4e32\u5f88\u666e\u901a\u7684\u6587\u672c\uff0c\u6211\u4eec\u9700\u8981\u4ece\u91cc\u9762\u62ff\u5230 access_token \u3002 \u83b7\u53d6\u7528\u6237\u4fe1\u606f url: https://api.github.com/user method: GET headers: {\"Authrozation\": \"token \u521a\u624d\u751f\u6210\u7684token \"} \u8fd9\u6837\u5c31\u80fd\u62ff\u5230\u7528\u6237\u4fe1\u606f\u4e86: \u53ef\u4ee5\u770b\u5230\u91cc\u9762\u6709login(\u767b\u5f55\u540d)\uff0cemail(\u90ae\u7bb1)\uff0cname(\u6635\u79f0)\uff0c\u5176\u4ed6\u6709\u7528\u7684\u4fe1\u606f\u6211\u4eec\u53ef\u4ee5\u53d6 avatar_url \uff0c\u65b9\u4fbf\u6211\u4eec\u80fd\u76f4\u63a5\u62ff\u5bf9\u65b9\u7684\u5934\u50cf\u6765\u5c55\u793a\u3002 \u524d\u7aef\u90e8\u5206 \u524d\u7aef\u90e8\u5206\u6211\u5df2\u7ecf\u5b9e\u73b0\u4e86\uff0c\u5927\u6982\u601d\u8def\u662f\u63d0\u4f9b github\u767b\u5f55\u7684\u6309\u94ae \uff0c\u5f53\u7528\u6237\u8fdb\u5165\u9875\u9762\u7684\u65f6\u5019\u5224\u65adurl\u91cc\u9762\u662f\u5426\u5305\u542b ?code= , \u5982\u679c\u6709\u5219\u8bf4\u660e\u662fgithub\u767b\u5f55\u6210\u529f\u540e\u7684\u56de\u8c03\u4e8b\u4ef6\uff0c\u518d\u5c06code\u89e3\u6790\u540e\u8c03\u7528\u4e0a\u9762\u7f16\u5199\u7684login\u63a5\u53e3\uff0c\u5176\u4ed6\u903b\u8f91\u4e0e\u666e\u901a\u7528\u6237\u767b\u5f55\u4e00\u81f4\u3002 \u5927\u5bb6\u6709\u5174\u8da3\u53ef\u4ee5\u7814\u7a76\u4e0b\u5177\u4f53\u7684\u5b9e\u73b0\uff0c\u5199\u7684\u6bd4\u8f83\u7cd9\uff0c\u53ef\u4ee5\u901a\u8fc7 \u63d0\u4ea4\u8bb0\u5f55 \u6765\u770b\u5230\u5bf9\u5e94\u7684\u6539\u52a8~ github\u63d0\u901f\u53ef\u4ee5\u53c2\u8003\u8fd9\u4e2a\uff0c\u4eb2\u6d4b\u6709\u6548: https://zhuanlan.zhihu.com/p/107334179 \u5728\u7ebf\u6f14\u793a\u5730\u5740: http://47.112.32.195/ \u524d\u7aef\u4ee3\u7801\u4ed3\u5e93: https://github.com/wuranxu/pityWeb \u540e\u7aef\u4ee3\u7801\u4ed3\u5e93: https://github.com/wuranxu/pity","title":"39.\u63a5\u5165github\u7b2c\u4e09\u65b9\u767b\u5f55(\u4e0b)"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%284%29%20%E4%BD%BF%E7%94%A8%E8%93%9D%E5%9B%BE%28Blueprint%29/","text":"\u4f7f\u7528Flask\u84dd\u56fe(blueprint) \u56de\u987e \u5148\u6765\u770b\u4e00\u4e0b\u4e0a\u4e00\u7bc7\u7684\u4f5c\u4e1a\u5427\uff0c\u4f7f\u7528 logbook \u7684\u65f6\u5019\uff0c\u9047\u5230\u4e86\u65f6\u533a\u4e0d\u5bf9\u7684\u60c5\u51b5\u3002\u90a3\u4e48\u6211\u4eec\u600e\u4e48\u53bb\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u5462\uff1f \u5b9e\u9645\u4e0alogbook\u9ed8\u8ba4\u91c7\u7528\u7684\u662f\u4e16\u754c\u6807\u51c6\u65f6\u95f4( utc )\uff0c\u800c\u6211\u4eec\u7684\u5317\u4eac\u65f6\u95f4\u662f\u6bd4\u4e16\u754c\u6807\u51c6\u65f6\u95f4\u65e98\u4e2a\u5c0f\u65f6\u7684\u3002 \u89e3\u51b3\u65b9\u6848 \u5176\u5b9e\u5728\u6211\u4eec\u5de5\u4f5c\u4e2d\u7ecf\u5e38\u4f1a\u9047\u5230\u5f88\u591a\u5947\u602a\u7684\u95ee\u9898\uff0c\u6700\u6700\u7b80\u5355\u7684\u65b9\u5f0f\u5c31\u662f\u4f7f\u7528\u641c\u7d22\u5f15\u64ce\u641c\u7d22\u5bf9\u5e94\u7684\u62a5\u9519\u4fe1\u606f\u3002\u7136\u540e\u627e\u5230\u7ed3\u679c\u6700\u63a5\u8fd1\u7684\u5185\u5bb9\uff0c\u4e00\u822c\u5728 Stack Overflow segmentfault \u7b80\u4e66 CSDN \u535a\u5ba2\u56ed \u5f00\u6e90\u4e2d\u56fd \u7b49\u793e\u533a\u53ef\u4ee5\u627e\u5230\u5bf9\u5e94\u7684\u7b54\u6848\u3002 \u9047\u5230\u95ee\u9898\u5176\u5b9e\u5e76\u4e0d\u53ef\u6015\uff0c\u6211\u4eec\u6709\u81ea\u5df1\u7684\u5957\u8def\u53bb\u89e3\u51b3\u5c31\u597d\u3002 \u8fd9\u91cc\u6211\u4ecb\u7ecd\u4e00\u4e0b\uff0c\u6211\u4e2a\u4eba\u5de5\u4f5c\u4e2d\u7684\u4e00\u4e9b\u89e3\u51b3\u95ee\u9898\u7684\u65b9\u5f0f\u5427\u3002 \u5b98\u65b9\u6587\u6863 \u4e00\u5207\u5927\u5bb6\u5e38\u89c1\u7684\u95ee\u9898\uff0c\u57fa\u672c\u4e0a\u90fd\u4f1a\u88ab\u5199\u5165\u5230\u5b98\u65b9\u6587\u6863\u91cc\u3002\u5b98\u65b9\u6587\u6863\u4e00\u822c\u542b\u6709\u5982\u4f55\u4f7f\u7528\uff0c\u4ee5\u53ca\u4e00\u4e9b\u9700\u8981\u6ce8\u610f\u7684\u5730\u65b9\u3002 Logbook\u5b98\u7f51 logbook\u5b98\u7f51\u622a\u56fe \u7531\u4e8e\u5b98\u7f51\u662f\u82f1\u6587\u7248\uff0c\u6240\u4ee5\u9700\u8981\u6709\u4e00\u5b9a\u7684\u82f1\u6587\u57fa\u7840\u3002\u7531\u4e8e\u6ca1\u6709 \u641c\u7d22\u6846 \uff0c\u6240\u4ee5\u53ea\u80fd\u6682\u65f6\u5229\u7528\u6d4f\u89c8\u5668\u7684ctrl+f\u641c\u7d22\u5173\u952e\u5b57\u4e86\u3002\u8bd5\u56fe\u641c\u7d22\"time\"\u548c\"utc\"\u5173\u952e\u5b57\uff0c\u65e0\u679c\u3002 Github/Stack Overflow \u4f5c\u4e3a\u4e00\u4e2astar\u91cf1000+\u7684opensource\u9879\u76ee\uff0c\u5fc5\u5b9a\u4f1a\u6709\u4e00\u7fa4\u4fa0\u4e49\u4eba\u58eb\u5e2e\u5fd9\u7ef4\u62a4\u66f4\u65b0\u4ee5\u53ca\u63d0\u51fa\u89e3\u51b3\u95ee\u9898(\u8fd9\u4e5f\u662f\u6211\u9009\u62e9\u5b83\u7684\u539f\u56e0)\u3002\u6240\u4ee5\u80af\u5b9a\u4e0d\u53ea\u662f\u6211\u4e00\u4e2a\u4eba\u9047\u5230\u4e86\u65f6\u95f4\u7684\u95ee\u9898\u3002 \u679c\u65ad\u8fdb\u5165github\uff0c\u641c\u7d22 logbook \u8fdb\u5165\u4e4b\u540e\u70b9\u51fbissues(\u95ee\u9898)\u9875\u9762 \u53ef\u4ee5\u770b\u5230\uff0c\u76ee\u524d\u670932\u4e2a\u6253\u5f00\u7684\u95ee\u9898\uff0c\u91cc\u9762\u90fd\u662f\u5173\u4e8e\u5927\u5bb6\u4f7f\u7528\u95ee\u9898\u4e4b\u540e\u7684\u53cd\u9988\u3002\u7b2c\u4e00\u773c\u5c31\u770b\u5230\u4e86correct date\u8fd9\u4e2a\u95ee\u9898\uff0c\u6ce8\u610f\u4e0a\u9762\u662f\u6709\u641c\u7d22\u6846\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u641c\u7d22utc\u3002\u73b0\u5728\u6211\u4eec\u5148\u4e0d\u641c\u7d22, \u8fdb\u5165\u67e5\u770b\u4e00\u4e0b\u3002 \u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u4e0d\u662f\u6211\u4eec\u60f3\u8981\u7684\u7b54\u6848\uff0c\u8fd9\u4e9b\u4eba\u548c\u6211\u4eec\u4e00\u6837\u90fd\u662f\u88ab\u56f0\u60d1\u7684\u3002\u4f46\u6ca1\u5173\u7cfb\uff0c\u6211\u4eec\u53ef\u4ee5\u5229\u7528\u521a\u624d\u7684\u641c\u7d22\u6846\u3002\u5728\u641c\u7d22\u6846\u4e2d\u8f93\u5165 utc \uff0c\u6211\u4eec\u4f18\u5148\u770b\u6211\u4eec\u9700\u8981\u7684\u95ee\u9898\u3002 (\u7b80\u5355\u7684\u6539\u53d8\uff0c\u53ef\u4ee5\u5141\u8bb8\u5c55\u793a\u672c\u5730\u65f6\u95f4) \u6211\u4eec\u8fdb\u5165\u8fd9\u4e2aissue \u53ef\u4ee5\u770b\u5230\u8fd9\u662f\u4e00\u4e2a pull requests \uff0c\u7b80\u79f0pr\u3002pr\u5927\u6982\u610f\u601d\u662f\u8bf4\uff0c\u867d\u7136\u9879\u76ee\u662fA\u6216\u8005A\u56e2\u961f\u505a\u7684\uff0c\u4f46\u662f\u4f60\u6709\u4e00\u4e9b\u6539\u8fdb\u6216\u8005\u4fee\u590d\uff0c\u53ef\u4ee5\u63d0\u4ea4pr\u5e76\u901a\u8fc7A\u5ba1\u6838\u8fc7\u540e\u5c06\u4f60\u7684\u4ee3\u7801\u5408\u5e76\u5230master\u5206\u652f(\u8fd9\u4e2a\u597d\u50cf\u662fgit\u6559\u7a0b\u4e86)\u3002\u8fd9\u91cc\u53ef\u4ee5\u770b\u5230\u8fd9\u4eba\u8bf4\u4ed6\u4e0d\u60f3\u663e\u793autc\u65f6\u95f4\uff0c\u4f46\u662f\u53c8\u6728\u6709\u73b0\u6709\u65b9\u6cd5\u663e\u793a\u672c\u5730\u65f6\u95f4\u3002 \u5728\u4e00\u5927\u5806\u5df4\u62c9\u5df4\u62c9\u53ca\u4e92\u76f8\u8ba8\u8bba\u4ee5\u540e\uff0c\u5c06api\u547d\u540d\u4e3a set_datetime_format \uff0c\u597d\u4e86\uff0c\u6211\u4eec\u60f3\u8981\u7684\u4e1c\u897f\u62ff\u5230\u4e86\u3002\u73b0\u5728\u53bb\u4ee3\u7801\u91cc\u770b\u770b\u5427\uff01 \u6240\u4ee5\u53ef\u4ee5\u770b\u5230\uff0c\u6211\u4eec\u8c03\u7528logbook.set_datetime_format(\"local\")\uff0c\u8fd9\u6837\u5c31\u80fd\u628a\u65f6\u95f4\u8bbe\u7f6e\u4e3a\u672c\u5730\u65f6\u95f4\u4e86\u3002\u63a5\u7740\u6765\u6d4b\u8bd5\u4e00\u4e0b~ \u5148\u4e0alogger.py\u6587\u4ef6 import logbook from app import pity from .decorator import SingletonDecorator # \u6ce8\u610f\u8fd9\u91cc @SingletonDecorator class Log (object) : handler = None def __init__ (self, name= 'pity' , filename=pity.config[ 'LOG_NAME' ]) : # Logger\u6807\u8bc6\u9ed8\u8ba4\u4e3aapp \"\"\" :param name: \u4e1a\u52a1\u540d\u79f0 :param filename: \u6587\u4ef6\u540d\u79f0 \"\"\" self.handler = logbook.FileHandler(filename, encoding= 'utf-8' ) logbook.set_datetime_format( \"local\" ) # \u5c06\u65e5\u5fd7\u65f6\u95f4\u8bbe\u7f6e\u4e3a\u672c\u5730\u65f6\u95f4 self.logger = logbook.Logger(name) self.handler.push_application() def info (self, *args, **kwargs) : return self.logger.info(*args, **kwargs) def error (self, *args, **kwargs) : return self.logger.error(*args, **kwargs) def warning (self, *args, **kwargs) : return self.logger.warning(*args, **kwargs) def debug (self, *args, **kwargs) : return self.logger.debug(*args, **kwargs) \u63a5\u4e0b\u6765\u6d4b\u8bd5\u4e00\u4e0b\u4fee\u6539\u540e\u7684hello world\u63a5\u53e3run.py from datetime import datetime from app import pity from app.utils.logger import Log @pity.route('/') def hello_world () : log = Log( \"hello world\" ) log.info( \"\u6709\u4eba\u8bbf\u95ee\u4e86\u4f60\u7684\u7f51\u7ad9\u4e86\" ) now = datetime.now().strftime( \"%Y-%M-%d %H:%M:%S\" ) print(now) return now if __name__ == \"__main__\" : pity.run( \"0.0.0.0\" , threaded= True , port= \"7777\" ) StackOverflow \u5b66\u4e60 golang \u4ee5\u6765\uff0c\u65f6\u5e38\u4f1a\u7528\u5230\uff0c\u6240\u4ee5\u5927\u5bb6\u53ef\u4ee5\u591a\u4e0a\u53bb\u4e00\u4e0b\u3002\u867d\u7136\u82f1\u6587\u5c45\u591a\uff0c\u4f46\u662f\u4e5f\u987a\u4fbf\u57f9\u517b\u4e0b\u81ea\u5df1\u7684\u9605\u8bfb\u80fd\u529b\u3002\u597d\u4e86\uff0c\u6211\u8981\u53bb\u7ed9\u521a\u624d\u90a32\u4e2a\u7528\u6237\u56de\u7b54\u4e00\u4e0b\u8bbe\u7f6elocal_format_string\u4e86\u3002 \u4f7f\u7528\u84dd\u56feblueprint \u5f15\u5165\u76ee\u7684 \u4e0d\u77e5\u9053\u5927\u5bb6\u6709\u6ca1\u6709\u5173\u6ce8\u8fc7\u6d4f\u89c8\u5668\u7684url\u60c5\u51b5\uff0c\u4f5c\u4e3a\u4e00\u4e2a\u6d4b\u8bd5\uff0c\u6bd4\u5982\u6211\u4eec\u4f1a\u7ecf\u5e38\u89c1\u5230 /login \u8fd9\u4e9burl\uff0c\u4e0d\u540c\u7684url\u5f53\u7136\u6709\u81ea\u5df1\u4e0d\u540c\u7684\u542b\u4e49\u5566\u3002\u5982\u679c\u6211\u4eec\u63a5\u4e0b\u6765\u63a5\u53e3\u5f88\u591a\uff0c\u6bd4\u5982\u4e00\u4e2auser\uff0c\u9700\u8981\u6709\u589e\u5220\u6539\u67e5\u7b49\u63a5\u53e3\uff0c\u5982\u679c\u5168\u90e8\u5199\u5728run.py\u91cc\u9762\uff0c\u4f1a\u592a\u6742\u4e71\u4e86\u3002\u6240\u4ee5\u6211\u4eec\u6253\u7b97\u5f15\u5165 \u84dd\u56fe \u6765\u5e2e\u6211\u4eec\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002 \u4f7f\u7528\u65b9\u6cd5 \u6211\u4e00\u822c\u90fd\u4f1a\u629b\u51fa\u5b98\u7f51\u7684\u5b9e\u4f8b\uff0c\u4f46\u662f\u6211\u8fd9\u91cc\u63a8\u8350\u4e00\u672c\u4e66\uff0cFlask\u76f8\u5173\u7684\uff0c\u6211\u4eec\u53eb\u5b83 \u72d7\u4e66 \u3002\u957f\u4e0b\u9762\u8fd9\u4e2a\u6837\u5b50~\u5982\u679c\u8981\u6df1\u5165\u5b66\u4e60flask\u7684\u8bdd\uff0c\u9002\u5408\u770b\u770b\uff0c\u4e5f\u4e0d\u539a\u91cd\u3002 \u5e9f\u8bdd\u5c11\u8bf4\uff0c\u4eca\u5929\u4f5c\u4e1a\u8bb2\u592a\u591a\u4e86\uff0c\u6b63\u9898\u6ca1\u4e86\u3002 \u7531\u4e8e\u6211\u4eec\u505a \u524d\u540e\u7aef\u5206\u79bb \uff0c\u6240\u4ee5\u540e\u7aef\u675c\u7edd\u4efb\u4f55\u4e0ehtml\u6709\u5173\u7684\u4e1c\u897f\uff0c\u6bd4\u5982\u6211\u5982\u679c\u73b0\u5728\u8981\u505a\u7528\u6237\u6a21\u5757\u7684\u8bdd\u3002\u6211\u9700\u8981\u6211\u7684url\u8def\u5f84\u7edf\u4e00\u4ee5/user\u5f00\u59cb\uff0c\u540e\u9762\u518d\u6309\u7167\u5185\u5bb9\u5212\u5206\u3002 \u4ee5\u7b80\u4e66\u4e3a\u4f8b\uff0c\u5927\u6982\u8bb2\u4e00\u4e0b\uff0c\u867d\u7136\u8fd9\u4f3c\u4e4e\u662f\u524d\u7aef\u7684\u8def\u7531\u3002\u4e0d\u8fc7\u540e\u7aef\u4e5f\u5dee\u4e0d\u591a\u9002\u5e94\uff0c\u5927\u5bb6\u53ef\u4ee5\u4e86\u89e3\u4e0brestful api\u7684\u6982\u5ff5\u3002 \u6bd4\u5982\u6211\u8fd9\u8fb9\u7684\u7528\u6237\u767b\u5f55\u63a5\u53e3\uff0c\u6211\u662f\u6253\u7b97\u8fd9\u6837\u547d\u540d: /user/register, \u524d\u9762\u7684user\u4ee3\u8868\u6a21\u5757\uff0c\u540e\u9762\u4ee3\u8868\u5185\u5bb9\u3002\u8fd9\u6837\u7279\u522b\u6e05\u6670\u660e\u4e86\u3002 \u90a3\u6211\u4eec\u5f00\u59cb\u5427\uff01 \u9996\u5148\u6211\u4eec\u9700\u8981\u521b\u5efacontroller\u6587\u4ef6\u5939\uff0c\u4e13\u95e8\u5904\u7406\u8def\u7531\u548c\u65b9\u6cd5\u7684\u6620\u5c04\u3002\u4e3e\u4e2a\u6817\u5b50\uff01 \u8fd9\u91cc\u6211\u521b\u5efa\u4e86auth(\u8ba4\u8bc1\u6a21\u5757)\uff0c\u53c8\u521b\u5efa\u4e86 user.py \u6587\u4ef6\u3002 user.py from flask import Blueprint from flask import jsonify auth = Blueprint( \"auth\" , __name__, url_prefix= \"/auth\" ) # \u8fd9\u91cc\u4ee5auth.route\u6ce8\u518c\u7684\u51fd\u6570\u90fd\u4f1a\u81ea\u5e26/auth\uff0c\u6240\u4ee5url\u662f/auth/register @auth.route(\"/register\") def register () : return jsonify(dict(status= True , msg= \"\u6ce8\u518c\u6210\u529f\" )) \u8fd9\u91cc\u6211\u76f4\u63a5return\u4e86json\u5b57\u7b26\u4e32: {\"status\": true, \"msg\": \"\u6ce8\u518c\u6210\u529f\"} \uff0c\u56e0\u4e3a\u6211\u7684\u5177\u4f53\u51fd\u6570\u8fd8\u6ca1\u5f00\u59cb\u5199\u3002 \u7136\u540e\u6211\u4eec\u9700\u8981\u5728app\u4e2d\u6ce8\u518c\u8fd9\u4e2a\u84dd\u56fe! app/__init__.py \u4ee3\u7801\u5982\u4e0b from flask import Flask from app.controllers.auth.user import auth from config import Config pity = Flask(__name__) # \u6ce8\u518c\u84dd\u56fe pity.register_blueprint(auth) pity.config.from_object(Config) \u597d\u5566\uff0c\u6211\u4eec\u91cd\u542frun.py\u670d\u52a1\u3002 \u7136\u540e\u8fdb\u5165\u6d4f\u89c8\u5668\uff0c\u8f93\u5165 localhost:7777/auth/register \u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u8fb9msg\u5e76\u4e0d\u662f \u6ce8\u518c\u6210\u529f \u7684\u4e2d\u6587\uff0c\u8fd9\u4e2a\u8ddf\u5b57\u7b26\u7f16\u7801\u6709\u5173\u7cfb\u3002 \u600e\u4e48\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u5462\uff0c\u563f\u563f\uff0c\u8fd8\u662f\u6211\u521a\u624d\u8bf4\u7684\uff0c\u53ef\u4ee5\u53bb\u641c\u7d22 flask jsonify \u4e2d\u6587\u4e71\u7801\u3002 \u603b\u7ed3 \u8fd9\u6837\u6211\u4eec\u7684\u4e00\u4e2a\u84dd\u56fe\u5c31\u63cf\u7ed8\u5b8c\u4e86\uff0c\u54c8\u54c8\u54c8 \u65ad\u66f4\u7684\u60f3\u6cd5\u6108\u6f14\u6108\u70c8\uff0c\u575a\u6301\u5440~~ \u8fd9\u5c31\u5f53\u505a\u4e0b\u6b21\u7684\u4f5c\u4e1a\u5427\uff0c\u4e0d\u8fc7\u4e5f\u662f\u9009\u4fee\u3002\u6bd5\u7adf\u7ed9\u524d\u7aef\u4f7f\u7528\u7684\u8bdd\uff0c\u95ee\u9898\u4e0d\u5927\u3002 \u8fd9\u4e2a\u662f\u6700\u7ec8\u6548\u679c~ \u5168\u90e8\u4ee3\u7801\u5730\u5740: https://github.com/wuranxu/pity \u89c9\u5f97\u6709\u7528\u7684\u8bdd\u53ef\u4ee5\u5e2e\u5fd9\u70b9\u4e2aStar\u54e6QAQ","title":"4.\u4f7f\u7528\u84dd\u56fe(Blueprint)"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2840%29%20%E6%89%BE%E4%B8%AA%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE%E6%B5%8B%E8%AF%95/","text":"\u5927\u5bb6\u597d\uff0c\u6211\u662f\u7c73\u6d1b\uff0c\u4e00\u4e2a\u6d4b\u8bd5\u5f00\u53d1\u535a\u4e3b\uff0cworld\u5f88\u5927\uff0c \u4f60\u5e94\u8be5\u53bb\u770b\u770b\uff01 \u6b22\u8fce\u5927\u5bb6\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7: \u6d4b\u8bd5\u5f00\u53d1\u5751\u8d27 \u3002 \u56de\u987e \u4e0a\u5468\u63d2\u64ad\u4e86\u4e00\u4e2agithub\u767b\u5f55\u7684\u5185\u5bb9\uff0c\u6ca1\u5565\u53cd\u54cd\u3002\u90a3\u6211\u4eec\u8fd9\u5468\u5c31\u7ee7\u7eed\u5b8c\u5584\u7528\u4f8b\u76f8\u5173\u7684\u5185\u5bb9\u3002 \u9898\u5916\u8bdd \u5176\u5b9e\u867d\u7136\u6211\u5728\u505a\u8fd9\u6837\u4e00\u4e2a\u6d4b\u8bd5\u5e73\u53f0\uff0c\u4f46\u5176\u5b9e\u5c31\u50cf\u996d\u54e5\u8bf4\u7684\uff0c\u5b58\u5728\u4e00\u4e9b\u95ee\u9898: \u81ea\u5df1\u7684\u5e73\u53f0\u6ca1\u6709\u843d\u5730 \u534a\u6210\u54c1 \u81ea\u5df1\u90fd\u6ca1\u6709\u4eb2\u8eab\u4f7f\u7528 \u786e\u5b9e\uff0c\u867d\u7136\u4e0a\u5bb6\u516c\u53f8\u652f\u6491\u5230\u4e86\u767e\u5206\u4e4b90\u591a\u7684\u4e1a\u52a1\u7ebf\uff0c\u4f46\u662f\u91cc\u9762\u7ed3\u5408\u4e86\u5f88\u591a\u516c\u53f8\u7684\u5185\u5bb9\uff0c\u6bd4\u5982 grpc \uff0c \u5fae\u670d\u52a1\u81ea\u52a8\u5bfb\u5740 \uff0c yapi \uff0c \u5185\u90e8\u53d1\u5e03\u7cfb\u7edf\uff0c\u6570\u636e\u5de5\u5382 \u7b49\u76f8\u5173\u7684\u5185\u5bb9\u3002 \u8fd9\u4e2a\u9879\u76ee\u867d\u7136\u548c\u5f53\u65f6\u7684\u5185\u5bb9\u5982\u51fa\u4e00\u8f99(\u6362\u4e86\u4e00\u79cd\u8bed\u8a00\u5b9e\u73b0)\uff0c\u4f46\u786e\u53c8\u4e0d\u592a\u4e00\u6837\u3002 \u4e3a\u4e86\u66f4\u597d\u5730\u652f\u6301\u5e73\u53f0\u7684\u53d1\u5c55\uff0c\u52a0\u4e0a\u65f6\u95f4\u5173\u7cfb\uff0c\u6240\u4ee5\u6211\u6253\u7b97\u6311\u9009\u4e00\u4e2a\u9ebb\u96c0\u867d\u5c0f\uff0c\u4f46\u53c8 \u4e94\u810f\u4ff1\u5168 \u7684\u9879\u76ee\u6765\u8fdb\u884c\u6d4b\u8bd5\u3002 \u4e3a\u4e86\u540e\u7eed\u8986\u76d6\u7387\u76f8\u5173\u7684\u529f\u80fd\uff0c\u6211\u5f97\u627e\u4e00\u4e2a\u5f00\u6e90\u7684Java\u9879\u76ee\uff0c\u4e8e\u662f\u6211\u53d1\u73b0\u4e86\u5b83\uff0c\u4e00\u4e2a\u535a\u5ba2\u7cfb\u7edf\u57fa\u4e8espringboot+vue+element-ui: \u4e00\u822c\u8fd9\u6837\u5f00\u6e90\u7684\u9879\u76ee\u90fd\u5dee\u4e0d\u591a\u662f\u4e2a\u534a\u6210\u54c1\uff0c\u4f46\u53ea\u8981\u4ed6\u6709\u5b8c\u5584\u7684\u767b\u5f55\uff08token/cookie\u673a\u5236\uff09\uff0c\u52a0\u4e0a\u6709\u4e00\u90e8\u5206crud\u529f\u80fd\u5c31\u884c\u3002 \u8fd9\u4e2a\u5730\u5740\u6211\u5df2\u7ecf\u90e8\u7f72\u5230\u6211\u81ea\u5df1\u7684\u670d\u52a1\u5668\u4e86\uff0c\u4ee5\u540e\u5c31\u53ef\u4ee5\u76f4\u63a5\u6765\u6d4b\u8bd5\u8fd9\u4e2a\u670d\u52a1\u4e86\uff0c\u4f46\u7b2c\u4e00\u6b65\u6211\u4eec\u5148\u8981\u62ce\u51fa\u91cc\u9762\u7684\u63a5\u53e3\u6570\u636e\u3002 \u670d\u52a1\u5730\u5740: http://47.112.32.195:8081/index.html \u5f00\u59cb\u7814\u7a76 \u5927\u6982\u7ffb\u9605\u4e86\u4e00\u4e0b\u5b83\u7684\u8ba4\u8bc1\u6a21\u5757\uff0c\u91c7\u7528\u7684\u662f spring-security \uff0c\u8fd9\u662f\u6211 \u6ca1\u63a5\u89e6 \u8fc7\u7684\u5168\u65b0\u9886\u57df\u3002 \u4e0d\u8fc7\u54b1\u4eec\u4e0d\u7528\u614c\uff0c\u5148\u770b\u770b\u4ed6\u7684\u767b\u5f55\u662f\u548b\u800d\u7684\u3002 \u8bf7\u6c42\u6570\u636e \u8fd4\u56de\u6570\u636e \u53ef\u4ee5\u770b\u5230\uff0c\u5b83\u662f\u4e00\u4e2aform\u8868\u5355\u7684POST\u8bf7\u6c42\uff0c\u8fd4\u56de\u7684\u5185\u5bb9 \u8fd8\u6ca1\u6709token\u8fd9\u6837\u7684\u4fe1\u606f \u3002\u8fd9\u53ef\u5982\u4f55\u662f\u597d\uff1f\u522b\u6015\uff0c\u6211\u4eec\u505a\u8fd9\u6837\u7684\u5de5\u5177\uff0c\u4e0d\u6015\u7279\u4f8b\u591a\uff0c\u5c31\u6015\u7279\u4f8b\u5c11\uff0c\u5bfc\u81f4 \u517c\u5bb9\u6027\u4e0d\u597d \uff01 \u54b1\u4eec\u597d\u50cf\u4e4b\u524d\u53ea\u652f\u6301\u4e86JSON\uff0c\u6211\u4eec\u8c03\u8bd5\u4e00\u4e0b\u767b\u5f55\u63a5\u53e3\uff0c\u786e\u8ba4\u4e00\u4e0b: header\u90e8\u5206 \u53ef\u4ee5\u770b\u5230\u767b\u5f55\u5931\u8d25\u4e86 \u627e\u4e0b\u539f\u56e0 \u901a\u8fc7debug\u53d1\u73b0username\u662f\u7a7a\u5b57\u7b26\u4e32 \u9879\u76ee\u5730\u5740: https://github.com/lenve/VBlog.git \u6211\u4eec\u628a\u9879\u76ee\u62c9\u5230\u672c\u5730 https://github.com/lenve/VBlog.git debug\u53d1\u73b0\uff0cusername\u662f\u7a7a\u5b57\u7b26\u4e32\u3002 \u5927\u6982\u7387\u662f\u6211\u4eec\u7684 requests \u8bf7\u6c42\u7684\u59ff\u52bf\u4e0d\u5bf9\uff0c\u90a3\u600e\u4e48\u529e\u5462\uff1f \u5148\u770b\u770b\u6211\u4eec\u73b0\u5728\u7684requests\u8bf7\u6c42\u65b9\u6cd5\u600e\u4e48\u5c01\u88c5\u7684\u3002 \u53ef\u4ee5\u770b\u5230\u662f\u8fd9\u6837\u5c01\u88c5\u7684\uff0c \u7136\u800c \u6211\u4eec\u7684body\u662f\u4e2a\u5b57\u7b26\u4e32\uff0c\u4f46\u662f\u5982\u679c\u6211\u4eec\u8981\u8bf7\u6c42form\u8868\u5355\u7684\u65f6\u5019\uff0cbody\u9700\u8981\u662fdict\u3002 \u6539\u9020\u5982\u4e0b: \u5982\u679cContent-Type\u91cc\u9762\u5e26\u6709form\u4e86\uff0c\u90a3\u6211\u4eec\u628abody\u8981\u53d8\u6210dict\uff08\u901a\u8fc7json.loads\uff09\u3002 \u6539\u9020\u540e\u5b9e\u9a8c\u4e00\u4e0b: \u5982\u6b64\uff0c\u6211\u4eec\u4fbf\u652f\u6301\u4e86json\u8fd8\u6709form\u7684http\u8bf7\u6c42\uff0c\u81f3\u4e8efile\u7c7b\u578b\uff0c\u6211\u4eec\u9047\u5230\u518d\u7ee7\u7eed\u7814\u7a76\u3002 \u53ef\u662ftoken\u5462\uff1f \u522b\u6025\uff0c\u6211\u4eec\u5207\u6362\u5230 Cookie tab\uff0c\u53ef\u4ee5\u770b\u5230Cookie\u91cc\u9762\u5df2\u5e26\u4e0a\u4e86JSESSIONID\uff0c\u6211\u4eec\u53ef\u901a\u8fc7\u8fd9\u4e2a\uff0c\u7ee7\u7eed\u6211\u4eec\u540e\u9762\u9700\u8981\u767b\u5f55\u7684\u8bf7\u6c42\u3002\u4e0etoken\u76f8\u5dee\u4e0d\u5927\u3002 \u8bb0\u4e00\u4e0b \u4f18\u5316\u70b9 \uff0c\u5f53\u8bf7\u6c42\u7c7b\u578b\u5207\u6362\u5230form/json\u7684\u65f6\u5019\u81ea\u52a8\u6539\u53d8Content-Type\uff0c\u8fd9\u6837\u4f53\u9a8c\u4f1a\u66f4\u597d\u4e00\u4e9b\uff01 \u4e0b\u4e00\u7bc7\uff0c\u6211\u4eec\u5f00\u59cb\u7f16\u5199 \u6570\u636e\u521d\u59cb\u5316 \u76f8\u5173\u7684\u5de5\u4f5c\u3002\u6bd4\u5982\u6211\u8981\u67e5\u8be2\u4e00\u7bc7\u6587\u7ae0\uff0c\u9700\u8981\u5148\u767b\u5f55\uff0c\u90a3\u4e48\u9700\u8981\u521d\u59cb\u5316\u7684\u6570\u636e\u5c31\u662f\u4e0a\u9762\u63d0\u5230\u7684 JSESSIONID \u3002 \u5728\u7ebf\u6f14\u793a\u5730\u5740: http://47.112.32.195/ \u524d\u7aef\u4ee3\u7801\u4ed3\u5e93: https://github.com/wuranxu/pityWeb \u540e\u7aef\u4ee3\u7801\u4ed3\u5e93: https://github.com/wuranxu/pity","title":"40.\u627e\u4e2a\u5f00\u6e90\u9879\u76ee\u6d4b\u8bd5"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2841%29%20%E7%BC%96%E5%86%99%E6%95%B0%E6%8D%AE%E6%9E%84%E9%80%A0%E5%99%A8%E5%8A%9F%E8%83%BD%EF%BC%88%E4%B8%8A%EF%BC%89/","text":"\u5927\u5bb6\u597d\uff0c\u6211\u662f\u7c73\u6d1b\uff0c\u4e00\u4e2a \u6d4b\u8bd5\u5f00\u53d1 \u535a\u4e3b\uff0cworld\u5f88\u5927\uff0c \u4f60\u5e94\u8be5\u53bb\u770b\u770b\uff01 \u6b22\u8fce\u5927\u5bb6\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7: \u6d4b\u8bd5\u5f00\u53d1\u5751\u8d27 \u3002 \u8fd9\u7bc7\u6587\u7ae0\u9605\u8bfb\u9700\u8981\u4e00\u5b9a\u7684\u8010\u5fc3\uff0c\u5982\u679c\u770b\u7684\u4e0d\u723d\u53ef\u4ee5 \u70b9\u4e2a\u8d5e \u63d0\u9192\u4e00\u4e0b\u535a\u4e3b\u3002 \u56de\u987e \u4e0a\u7bc7\u5df2\u7ecf\u627e\u5230\u4e86\u4e00\u4e2a \u53ef\u6d4b \u7684\u9879\u76ee\uff0c\u4f46\u662f\u9047\u5230\u4e86\u9700\u8981\u767b\u5f55\u7684\u95ee\u9898\u3002\u6b63\u5e38\u6765\u8bf4\uff0c\u6211\u4eec\u5982\u679c\u5199\u4ee3\u7801\u7684\u8bdd\uff0c\u80af\u5b9a\u5f88\u65b9\u4fbf\uff0c\u5728setUp\u8fd9\u7c7b\u65b9\u6cd5\u91cc \u5494\u5494\u5494 \u767b\u5f55\u4e00\u4e0b\uff0c\u5b58\u50a8\u5bf9\u5e94\u7684JSESSIONID\uff0c\u7136\u540e\u6d4b\u8bd5\u51fd\u6570\u5c31\u80fd\u591f\u7528JSESSIONID\u7545\u901a\u65e0\u963b\u8bbf\u95ee\u9879\u76ee\u4e86\u3002 \u627e\u4e2a\u4f8b\u5b50 \u4e0b\u9762\u6211\u4eec\u6765\u770b\u4e00\u4e2a \u7b80\u5355 \u7684\u4f8b\u5b50: \u7531\u4e8e\u8fd9\u4e2a\u9879\u76ee\u5f88\u8001\u4e86\uff0c\u5f88\u591a\u56fe\u7247\u8fc7\u671f\u4e86\u90fd \u5982\u56fe\u6240\u793a\uff0c\u6211\u60f3\u6d4b\u8bd5\u4e00\u4e2a \u83b7\u53d6\u7528\u6237\u5217\u8868\u7684\u63a5\u53e3 \uff0c\u5bf9\u5e94\u8fd9\u4e2a\u9875\u9762\u3002\u56e0\u4e3a\u6211\u4eec\u6682\u65f6\u6ca1\u6709\u6574\u7406\u51fa\u5bf9\u5e94\u7684\u63a5\u53e3\u6587\u6863\uff0c\u53ea\u80fd\u81ea\u5df1\u770b\u4ee3\u7801\u6216\u8005 \u6293\u5305 \u53bb\u4e86\u89e3\u8fd9\u4e2a\u8bf7\u6c42\u3002 \u597d\u5728\u8fd9\u4e2a\u8bf7\u6c42\u6bd4\u8f83\u7b80\u5355\uff0c\u662f\u4e2aGET\uff0c\u5e76\u4e14\u63a5\u53d7\u4e00\u4e2a nickname \u5b57\u6bb5\u3002\u6839\u636e \u7ecf\u9a8c \uff0c\u8fd9\u4e2a\u63a5\u53e3\u53ef\u4ee5\u6839\u636e\u5bf9\u5e94\u7684\u7528\u6237\u540d\u67e5\u8be2\u5bf9\u5e94\u7684\u7528\u6237\u4fe1\u606f\u3002 \u53ef\u4ee5\u770b\u5230\u8fd9\u4e2a\u63a5\u53e3\u662f\u9700\u8981\u767b\u5f55\u7684 \u5e73\u53f0\u5316\u601d\u8def \u90a3\u4e48\u5e73\u53f0\u5316\u7684\u8bdd\uff0c\u5e94\u8be5\u600e\u4e48\u505a\u5462\uff1f\u6211\u4eec\u521a\u624d\u68b3\u7406\u4e86\u5177\u4f53\u7684\u8fc7\u7a0b\u3002 \u8bbe\u8ba1\u7528\u4f8b \u8c03\u7528login\u63a5\u53e3\uff0c\u83b7\u53d6\u5230\u51ed\u636e\uff08token/cookie\u7b49\uff09 \u6839\u636e\u51ed\u636e\u8bf7\u6c42 \u83b7\u53d6\u7528\u6237\u5217\u8868\u63a5\u53e3 \u6839\u636e\u5bf9\u5e94\u7684\u7528\u4f8b\u5236\u9020\u4e0d\u540c\u7684\u8bf7\u6c42\u53c2\u6570\uff08nickname\uff09 \u6839\u636e\u7528\u4f8b\u7f16\u5199\u5bf9\u5e94\u7684\u65ad\u8a00\u4fe1\u606f \u719f\u6089Python+excel\u7684\u670b\u53cb\uff0c\u53ef\u80fd\u4f1a\u5728excel\u6dfb\u52a0\u4e86\u597d\u591a\u6761\u6d4b\u8bd5\u6570\u636e\u548c\u671f\u671b\u7ed3\u679c\u4e86\uff0c\u5176\u5b9e \u5e73\u53f0\u5316 \u4e5f\u662f\u7c7b\u4f3c\u3002 \u6211\u4eec\u53ea\u9700\u8981\u5173\u5fc3\u4e00\u4e2a\u7528\u4f8b\u7684\u771f\u6b63\u6267\u884c\u8fc7\u7a0b: \u767b\u5f55\u83b7\u53d6\u51ed\u636e \u901a\u8fc7\u51ed\u636e\u8bf7\u6c42\u63a5\u53e3 \u660e\u767d\u8fd9\u70b9\u7684\u8bdd\uff0c\u6211\u4eec\u5c31\u5f00\u59cb\u6539\u9020\u6211\u4eec\u7684 Executor \u7c7b\u4e86\u3002\u6240\u4ee5\u6211\u4eec\u8981\u505a\u7684\u5c31\u662f\u5148 \u6267\u884c\u767b\u5f55\u7528\u4f8b \uff0c\u518d \u6267\u884c\u6d4b\u8bd5\u7528\u4f8b \u3002\u6362\u53e5\u8bdd\u8bf4\uff0c\u767b\u5f55\u7528\u4f8b\u662f\u8be5\u6d4b\u8bd5\u7528\u4f8b\u7684 \u524d\u7f6e\u6761\u4ef6 (setUp/\u521d\u59cb\u5316\u6570\u636e\u64cd\u4f5c)\uff0c\u6211\u8fd9\u91cc\u7ed9\u4ed6\u53d6\u4e86\u4e2a\u540d\u513f: \u6570\u636e\u6784\u9020\u5668 \uff0c\u56e0\u4e3a\u6211\u4eec\u5e38\u8bf4\u7684\u63a5\u53e3\u4e4b\u95f4\u7684\u4f9d\u8d56\uff0c\u5e38\u5e38\u662f\u6570\u636e\u5f15\u8d77\uff0c\u5982\u679c\u767b\u5f55\u540e\u80fd\u62ff\u5230\u51ed\u636e\uff0c\u90a3\u4e48\u6211\u4eec\u5bf9\u767b\u5f55\u7684\u4f9d\u8d56\u5c31\u88ab\u89e3\u51b3\u4e86\u3002 \u6211\u4eec\u6267\u884c\u7528\u4f8b\u7684\u65f6\u5019\uff0c\u662f\u8fd9\u6837\u7684\u987a\u5e8f\uff0c\u5982\u679c\u7528\u4f8b\u6709 \u6570\u636e\u6784\u9020\u5668 \uff0c\u90a3\u4e48\u6211\u4eec\u5148\u6267\u884c \u6570\u636e\u6784\u9020\u5668 \u65b9\u6cd5\uff0c\u76ee\u7684\u5c31\u662f\u628a \u4f9d\u8d56\u6570\u636e \u62ff\u5230\u3002 Constructor\u8868 \u8868\u8bbe\u8ba1 id,deleted_at,created_at,create_user,update_user\u8fd9\u4e9b\u5b57\u6bb5\u90fd\u662f\u8001\u751f\u5e38\u8c08\u4e86\uff0c\u4e0d\u8d58\u8ff0\u4e86\u3002 type \u6211\u4eec\u7684\u6570\u636e\u53ef\u80fd\u6765\u81ea\u4e00\u6b21http\u8bf7\u6c42\uff0credis\u64cd\u4f5c\uff0csql\u67e5\u8be2\uff0c\u5176\u5b83\u6d4b\u8bd5\u7528\u4f8b\u7b49\u7b49\u3002\u6211\u6682\u65f6\u5b9a\u4e863\u4e2a\u6700\u5e38\u89c1\u7684: 0: testcase 1: sql 2: redis \u5176\u4ed6\u7684\u6211\u4eec\u540e\u7eed\u9047\u5230\u518d\u8865\u5145\uff0c\u80af\u5b9a\u4f1a\u6709\u7684\uff0c\u6bd4\u5982py\u811a\u672c\u7b49\u7b49 \u3002 name\uff1a\u6784\u9020\u5668\u7684\u63cf\u8ff0 enable: \u662f\u5426\u5f00\u542f \u6bd4\u5982\u67d0\u5929\u4f60\u6682\u65f6\u4e0d\u9700\u8981\u8fdb\u884c\u8fd9\u4e2a\u64cd\u4f5c\u4e86\uff0c\u4f60\u53ef\u4ee5\u4e34\u65f6\u5173\u95ed\uff0c\u540e\u7eed\u53ef\u4ee5\u6253\u5f00\u3002 public: \u662f\u5426\u516c\u5f00\uff0c\u4e0d\u516c\u5f00\u5c31\u53ea\u80fd\u4f60\u81ea\u5df1\u8212\u670d\u522b\u4eba\u4e0d\u80fd\u8212\u670d case_id: \u8fd9\u4e2a\u6784\u9020\u5668\u6240\u5c5e\u7684case_id value: \u6784\u9020\u5668\u7684\u8fd4\u56de\u503c \u8fd9\u4e2a\u5927\u5bb6\u80fd\u7406\u89e3\u5427\uff0c\u6211\u6784\u9020\u4e86\u6570\u636e\uff0c\u662f\u4e3a\u4e86 \u8ba9\u81ea\u5df1\u518d\u53d6\u51fa\u6765 \u3002\u6bd4\u5982\u6211set woody=\"\u5e05\u54e5\"\uff0c\u540e\u7eed\u6211\u662f\u8981\u7528\u8fd9\u4e2a \u5e05\u54e5\u7684 \uff0c\u90a3\u4e48\u6b64\u65f6\u7684woody\u5c31\u662fvalue\u4e86\uff0c\u6216\u8005\u53ebreturn_value\u66f4\u65b9\u4fbf\u7406\u89e3\u3002 constructor_json: \u6784\u9020json \u7531\u4e8e\u6211\u4eec\u4e0d\u540c\u7684\u6570\u636e\uff0c\u5bf9\u5e94\u4e0d\u540c\u7684\u6570\u636e\u683c\u5f0f\u3002\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5982\u679c\u6211\u662f\u4e2asql\u7c7b\u578b\uff0c\u6211\u53ef\u80fd\u9700\u8981jdbcUrl\uff08\u6570\u636e\u5e93\u8fde\u63a5\u5730\u5740\uff09\uff0csql\u7b49\u5173\u952e\u4fe1\u606f\uff0c\u5176\u5b9e\u8fd9\u79cd\u60c5\u51b5\u6211\u4eec\u7528 mongo \u5f53\u6570\u636e\u5e93\u4f1a\u66f4\u8212\u670d\u3002\u53ea\u4e0d\u8fc7\u4e3a\u4e86\u964d\u4f4e\u7cfb\u7edf\u590d\u6742\u5ea6\uff0c\u5c3d\u91cf\u5c11\u5f15\u5165\u65b0\u7684\u7ec4\u4ef6\uff0c\u80fd\u5fcd\u5c31\u5fcd\u4e86\u3002 \u5b9a\u4e49\u9020\u6570\u5668\u8bf7\u6c42\u53c2\u6570 \u57fa\u672c\u4e0a\u6ca1\u6709\u4ec0\u4e48\u5927\u7684\u533a\u522b \u7f16\u5199\u65b0\u589e\u6570\u636e\u6784\u9020\u5668\u529f\u80fd \u4fee\u6539\u548c\u5220\u9664\u7684\u6682\u65f6\u8fd8\u6ca1\u5b8c\u6210 \u9875\u9762\u64cd\u4f5c \u4e3a\u5bf9\u5e94\u7684\u7528\u4f8b\u6dfb\u52a0\u6784\u9020\u5668 \u9009\u62e9\u6d4b\u8bd5\u7528\u4f8b\u7c7b\u578b \u63d0\u524d\u51c6\u5907\u597d\u4e86\u4e00\u4e2a\u6b63\u5e38\u767b\u5f55\u7684\u7528\u4f8b \u6700\u540e\u7684\u6548\u679c\u5c31\u662f\uff0c \u67e5\u8be2\u6240\u6709\u7528\u6237\u5217\u8868 \u7528\u4f8b\u62e5\u6709\u4e86\u4e00\u4e2a \u7528\u6237\u6b63\u5e38\u767b\u5f55 \u7684\u6570\u636e\u6784\u9020\u5668\u3002 \u8fd9\u671f\u7684\u5185\u5bb9\u5c31\u5230\u8fd9\u91cc\u4e86\uff0c\u592a\u591a\u4e86\u6211\u81ea\u5df1\u90fd\u6d88\u5316\u4e0d\u826f\u3002 \u5728\u7ebf\u6f14\u793a\u5730\u5740: http://47.112.32.195/ \u524d\u7aef\u4ee3\u7801\u4ed3\u5e93: https://github.com/wuranxu/pityWeb \u540e\u7aef\u4ee3\u7801\u4ed3\u5e93: https://github.com/wuranxu/pity","title":"41.\u7f16\u5199\u6570\u636e\u6784\u9020\u5668\u529f\u80fd\uff08\u4e0a\uff09"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2842%29%20%E7%BC%96%E5%86%99%E6%95%B0%E6%8D%AE%E6%9E%84%E9%80%A0%E5%99%A8%E5%8A%9F%E8%83%BD%EF%BC%88%E4%B8%8B%EF%BC%89/","text":"\u5927\u5bb6\u597d\uff0c\u6211\u662f\u7c73\u6d1b\uff0c\u4e00\u4e2a \u6d4b\u8bd5\u5f00\u53d1 \u535a\u4e3b\uff01 \u5982\u679c\u9605\u8bfb\u5b8c\u6bd5\u540e\u60f3\u548c\u4f5c\u8005\u6709\u66f4\u591a\u4ea4\u6d41\uff0c\u53ef\u4ee5\u70b9\u51fb \u9605\u8bfb\u539f\u6587 \u627e\u5230\u5e95\u90e8\u8bc4\u8bba\u533a\uff0c\u7ed9\u4f5c\u8005\u7559\u8a00\u5566\uff01 \u6b22\u8fce\u5927\u5bb6\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7: \u6d4b\u8bd5\u5f00\u53d1\u5751\u8d27 \u3002 \u56de\u987e \u4e0a\u7bc7\u5df2\u7ecf\u7f16\u5199\u4e86 \u6dfb\u52a0\u6570\u636e\u6784\u9020\u5668 \u7684\u76f8\u5173\u65b9\u6cd5\uff0c\u73b0\u5728\u6211\u4eec\u5c31\u6765\u8fd0\u52a8\u5230\u7528\u4f8b\u4e2d\u53bb\u3002 \u7f16\u5199\u6839\u636ecase_id\u67e5\u8be2\u6240\u6709\u6784\u9020\u5668\u65b9\u6cd5 \u8fd9\u91cc\u662f\u4e3a\u4e86\u627e\u51fa\u6211\u8981\u8fd0\u884c\u7684case\u7684\u6240\u6709\u6570\u636e\u6784\u9020\u65b9\u6cd5 \u7f16\u5199\u67e5\u627e\u6570\u636e\u6784\u9020\u5668\u65b9\u6cd5 ConstructorDao\u6dfb\u52a0static\u65b9\u6cd5 \u4e0d\u4e3a\u522b\u7684\uff0c\u56e0\u4e3a\u6211\u4eec\u5982\u679c\u5224\u65adcase\u6709\u6570\u636e\u6784\u9020\u6570\u636e\uff0c\u90a3\u6211\u4eec\u5c31\u8981\u83b7\u53d6\u5230\u8fd9\u4e2a\u6570\u636e\u5440\uff01 \u6539\u9020Executor\u7c7b \u65b0\u589e\u89e3\u6790\u53c2\u6570\u7684\u65b9\u6cd5 \u8fd8\u8bb0\u5f97\u4e4b\u524d\u6211\u4eec \u5168\u5c40\u53d8\u91cf \u66ff\u6362\u53d8\u91cf\u7684\u5185\u5bb9\u5417\uff1f\u5f53\u65f6\u662f\u53ea\u66ff\u6362headers\uff0cbody\u7b49\u5185\u5bb9\uff0c\u5176\u5b9e\u4e0d\u592a\u5168\u9762\u3002 \u4e00\u4e2aTestCase\u7c7b\uff0c\u91cc\u9762\u6709\u592a\u591a\u5b57\u6bb5\u4e86\u3002\u6211\u4eec\u53d6\u6570\u636e\u4ee5\u540e\uff0c\u6bcf\u4e2a\u5b57\u6bb5\u90fd\u9700\u8981check\u4e00\u904d\uff0c\u6240\u4ee5\u8fd9\u91cc\u904d\u5386\u4e00\u4e2atestcase\u7684\u6240\u6709\u5b57\u6bb5\uff0c\u53bb\u91cc\u9762\u6316\u6398\u53d8\u91cf\uff0c\u8fd9\u6837\u4f1a\u6700\u5168\u9762\u3002\uff08 \u6548\u7387\u4e5f\u4f1a\u6bd4\u8f83\u4f4e \uff0c\u4f46\u662f\u7531\u4e8e\u6211\u4eec\u7684\u6570\u636e\u6784\u9020\u5668\u53ea\u544a\u8bc9\u4e86\u8fd4\u56de\uff0c\u5e76\u6ca1\u544a\u8bc9\u5177\u4f53\u5728\u54ea\u7528\uff0c\u6240\u4ee5\u8fd9\u6837\u7684\u8fc7\u7a0b\u662f\u6709\u5fc5\u8981\u7684\uff09 \u8fd9\u91cc\u6709\u4e2a\u7279\u4f8b\uff0crequest_header\u6211\u4eec\u672c\u8eab\u5df2\u7ecf\u662f\u5904\u7406\u4e3ajson\u5b57\u7b26\u4e32\u4e86\uff0c\u6240\u4ee5\u91cc\u9762\u7684\u6570\u636e\u5929\u7136\u662f\u5b57\u7b26\u4e32\uff0c\u6211\u4eec\u4e0d\u9700\u8981\u8fdb\u884c\u4e00\u6b21 \u5e8f\u5217\u5316 \u3002 \u5c3d\u7ba1\u88c5\u9970\u5668\u81ea\u52a8\u751f\u6210\u4e86\u4e0d\u5c11\u65e5\u5fd7\uff0c\u4f46\u662f\u8fd8\u662f\u4e0d\u591f \u6211\u4eec\u9700\u8981\u53ef\u4ee5\u624b\u52a8\u5199\u5165\u65e5\u5fd7\u7684\u529f\u80fd\uff0c\u4e8e\u662f\u5c01\u88c5\u4e86append\u65b9\u6cd5 \u65b0\u589e\u83b7\u53d6\u6784\u9020\u6570\u636e\u548c\u6267\u884c\u6784\u9020\u6570\u636e\u65b9\u6cd5 \u53ef\u4ee5\u770b\u5230\uff0c\u76ee\u524d\u6784\u9020\u5668\u53ea\u652f\u6301\u4e86type == 0\u4e5f\u5c31\u662f\u6d4b\u8bd5\u7528\u4f8b\u7c7b\u578b\u3002\u5982\u679c\u662fcase\u7c7b\u578b\uff0c\u90a3\u4e48Executor\u4f1a\u518d\u6b21\u751f\u6210\u4e00\u4e2a\uff0c\u53bb\u6267\u884c\u7528\u4f8b\u4e2d\u7684\u7528\u4f8b\uff0c\u6700\u7ec8\u62ff\u5230result\u4fe1\u606f\uff0c\u5e76\u6839\u636e\u6211\u4eec\u8bbe\u5b9a\u7684 value \uff0c\u628acase\u6267\u884c\u7684\u6570\u636e\u5168\u90e8\u585e\u7ed9\u4f20\u9012\u8fdb\u6765\u7684params\u5b57\u5178\u3002 \u8fd9\u4e2a\u8fc7\u7a0b\u5c31\u8bb0\u5f55\u4e86\u6240\u6709\u6784\u9020\u6761\u4ef6\u91cc\u9762\u7684\u6570\u636e\uff0c\u4e3a\u5c06\u6765\u53d6\u6570\u636e\u505a\u597d\u4e86\u94fa\u57ab\u3002 \u6539\u9020run\u65b9\u6cd5 \u65b0\u589e\u4e863\u4e2a\u53c2\u6570\uff0c\u5206\u522b\u662fparams_pool\uff0crequest_param\u548cpath\u3002 \u89e3\u91ca\u4e00\u4e0b: params_pool \u8fd9\u4e2a\u662f\u603b\u4f53\u7684\u5168\u5c40\u7684\u6570\u636e\u6c60\uff0c\u4ece\u7b2c\u4e00\u4e2a\u7528\u4f8b\u5f00\u59cb\u79ef\u7d2f\uff0c\u6240\u4ee5\u6211\u4eec\u7ea6\u5b9a\uff0c\u4e0d\u8981\u586b\u5199\u91cd\u590d\u7684 \u8fd4\u56de\u503c \u3002 \u6bd4\u5982\u6784\u9020\u56681\u8fd4\u56de\u53d8\u91cfvalue1\uff0c\u6784\u9020\u56682\u8fd4\u56de\u53d8\u91cfvalue2\uff0c\u90a3\u6700\u7ec8\u8fd9\u4e2aparams_pool\u7684\u5185\u5bb9\u4f1a\u662f: { \"value1\" : value1\u8fd4\u56de\u6570\u636e, \"value2\" : value2\u8fd4\u56de\u6570\u636e } request_param \u5728\u4e0a\u4e00\u7bc7\u6f0f\u6389\u4e86\u4e2a\u5185\u5bb9\uff0c\u6211\u4eec\u6709\u4e00\u4e2a\u52a8\u6001\u53c2\u6570\u7684\u5b57\u6bb5\u3002\u56e0\u4e3a\u6211\u4eec\u7528\u4f8b\u53c2\u6570\u5982\u679c\u5199\u6b7b\u4f1a\u5f88\u96be\u7528\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u8ba9\u7528\u4f8b\u52a8\u8d77\u6765\uff0c\u800c\u4e0d\u662f\u6b7b\u6570\u636e\uff0c\u4f46\u53c8\u4e0d\u662f \u5168\u5c40\u53d8\u91cf \u90a3\u4e48\u523b\u677f\u3002 \u6240\u4ee5\u6211\u4eec\u9700\u8981\u8ba9\u7528\u4f8b\u80fd\u63a5\u53d7\u5bf9\u5e94\u7684\u6570\u636e\u53bb\u6267\u884c\uff0c\u6bd4\u5982\u4e00\u4e2a\u767b\u5f55\u7528\u4f8b\uff0c\u91cc\u9762\u5199\u4e86\u7528\u6237\u540d\u662fabc\uff0c\u8fd9\u91cc\u6211\u4f20\u5165\u6211\u8fd9\u4e2a\u573a\u666f\u9700\u8981\u7684\u7528\u6237woody\u5c31\u53ef\u4ee5\u8fbe\u5230 \u901a\u8fc7\u53c2\u6570\u4fee\u6539\u7528\u4f8b\u7684\u76ee\u7684 \u3002 path \u8fd9\u4e2a\u5f88\u597d\u7406\u89e3\uff0c\u6211\u7684case\u8def\u5f84\u3002\u6bd4\u5982\u6211\u662fA\u7528\u4f8b\uff0c\u5728\u6267\u884cA\u7684\u6784\u9020\u6761\u4ef61->B\u7528\u4f8b\uff0c\u90a3\u4e48\u4e3a\u4e86\u4e0d\u8ba9\u6211\u51cc\u4e71\uff0c\u6211\u4f1a\u7ed9\u51fa\u4e00\u4e2apath: A->B\uff0c \u8fd9\u6837\u5c31\u4f1a\u6bd4\u8f83\u597d\u533a\u5206\u3002 \u518d\u8bb2\u8bb2\u7528\u4f8b\u7684\u7ec6\u8282\uff0c\u6211\u4eec\u6309\u7167step\uff08\u6ce8\u91ca\u6709\u5199\uff09\u5c06\u7528\u4f8b\u8fc7\u7a0b\u62c6\u5206\uff0c\u8fd9\u6837\u601d\u8def\u5c31\u5f88\u6e05\u6670\u4e86\u3002 \u56de\u5230\u6700\u521d\u7684\u4f8b\u5b50 \u6211\u4eec\u8fd8\u662f\u5f97\u5148\u767b\u5f55\uff0c\u518d\u901a\u8fc7JSESSIONID\u53bb\u8bf7\u6c42 \u83b7\u53d6\u7528\u6237\u5217\u8868\u63a5\u53e3 \u7684\u3002 \u6211\u4eec\u5e94\u8be5\u600e\u4e48\u505a\u5462\uff1f \u7f16\u5199\u4e00\u4e2a\u767b\u5f55\u7528\u4f8b \u7f16\u5199\u7528\u4f8b\u57fa\u672c\u4fe1\u606f header\u4fe1\u606f body\u4fe1\u606f \u6d4b\u8bd5\u4e00\u4e0b: \u6d4b\u8bd5\u6210\u529f\uff0c\u80fd\u591f\u6b63\u5e38\u767b\u5f55 \u628a\u767b\u5f55\u7528\u4f8b\u6dfb\u52a0\u4e3a\u67e5\u8be2\u6240\u6709\u7528\u6237\u5217\u8868\u7684 \u6570\u636e\u6784\u9020\u5668 \u53d6\u6570\u636e \u6211\u4eec\u767b\u5f55\u540e\uff0c\u9700\u8981\u7528\u5230cookie\u91cc\u9762\u7684JSESSIONID\u3002 \u6ce8\u610f\u8fd9\u91cc\uff0c\u6211\u4eec\u628a\u767b\u5f55\u540e\u7684\u53d8\u91cf\u8bbe\u7f6e\u4e3a\u4e86 blog_login \uff0c\u901a\u8fc7cookies.JSESSIONID\u62ff\u5230\u5bf9\u5e94\u7684\u6570\u636e\uff0c\u5e76\u4f20\u9012\u7ed9\u5f53\u524d\u7528\u4f8b\u3002 \u770b\u770b\u6548\u679c: \u6210\u529f\u62ff\u5230response \u7531\u4e8e\u65e5\u5fd7\u4e0d\u592a\u53cb\u597d\uff0c\u540e\u7eed\u8fd8\u5f97\u6539\u9020\u3002\u65ad\u8a00\u4e5f\u6ca1\u6709\u6dfb\u52a0\uff0c\u8fd8\u9700\u52aa\u529b\u5440\uff01 \u5982\u679c\u4fee\u6539\u6216\u8005 \u5199\u9519 \u8fd9\u4e2a\u53d8\u91cf: \u6545\u610f\u5199\u9519SESSIONID \u53ef\u4ee5\u770b\u5230\u53d8\u91cf\u66ff\u6362\u5931\u8d25\u4e86 \u767b\u5f55\u51ed\u8bc1\u6ca1\u6709\u83b7\u53d6\u5230\uff0c\u81ea\u7136\u5c31\u767b\u5f55\u5931\u8d25\u4e86\uff01 \u5728\u7ebf\u6f14\u793a\u5730\u5740: http://47.112.32.195/ \u524d\u7aef\u4ee3\u7801\u4ed3\u5e93: https://github.com/wuranxu/pityWeb \u540e\u7aef\u4ee3\u7801\u4ed3\u5e93: https://github.com/wuranxu/pity","title":"42.\u7f16\u5199\u6570\u636e\u6784\u9020\u5668\u529f\u80fd\uff08\u4e0b\uff09"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2843%29%20aiohttp%E5%88%9D%E4%BD%93%E9%AA%8C/","text":"\u5927\u5bb6\u597d\uff0c\u6211\u662f\u7c73\u6d1b\uff0c\u4e00\u4f4d\u6d4b\u8bd5\u7403\u8ff7\uff01 \u5982\u679c\u9605\u8bfb\u5b8c\u6bd5\u540e\u60f3\u548c\u4f5c\u8005\u6709\u66f4\u591a\u4ea4\u6d41\uff0c\u53ef\u4ee5\u70b9\u51fb \u9605\u8bfb\u539f\u6587 \u627e\u5230\u5e95\u90e8\u8bc4\u8bba\u533a\uff0c\u7ed9\u4f5c\u8005\u7559\u8a00\u5566\uff01 \u6b22\u8fce\u5927\u5bb6\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7: \u6d4b\u8bd5\u5f00\u53d1\u5751\u8d27 \u3002 \uff08 \u672c\u6587\u5982\u679c\u6709\u9519\u8bef\uff0c\u8bf7\u53ca\u65f6\u5728\u516c\u4f17\u53f7\u53d1\u6d88\u606f\u6307\u6b63\uff0c\u6709\u9519\u6f0f\u6211\u5c31\u5220\u4e86\u4ee5\u514d\u8bef\u5bfc\u5927\u5bb6 \uff01\uff09 \u56de\u987e \u4e0a\u56de\u6211\u4eec\u641e\u5b9a\u4e86\u4e00\u6574\u5957\u6d41\u7a0b\uff0c\u5173\u4e8e \u6570\u636e\u6784\u9020\u5668 \u7684\uff0c\u4eca\u5929\u6211\u4eec\u6765\u5f15\u5165aiohttp\u3002 \u5728\u6b64\u4e4b\u524d\u6211\u4eec\u7b80\u5355\u8bf4\u4e0b \u9884\u5907\u77e5\u8bc6 : Python\u7684\u5f02\u6b65 \u5176\u5b9e\u5199\u8fd9\u7bc7\u6587\u7ae0\u7684\u65f6\u5019\u6211\u5185\u5fc3\u662f\u5f88 \u7ea0\u7ed3 \u7684\uff0c\u56e0\u4e3a\u6211\u5176\u5b9e\u4e5f\u4e0d\u7b97\u592a\u660e\u767d\u91cc\u5934\u7684\u95e8\u8def\u3002\u867d\u7136\u770b\u4e86\u5f88\u591a\u6587\u7ae0\uff0c\u4f46\u611f\u89c9\u5199\u8d77\u5f02\u6b65\u7684\u4ee3\u7801\u8fd8\u662f\u4f1a\u6bd4\u8f83\u8d39\u52b2\u3002 \u5927\u5bb6\u53ef\u4ee5\u53bb\u641c\u7d22\u4e00\u4e9b\u5f02\u6b65\u7684\u6587\u7ae0\uff0c\u8ba9\u6211\u8bb2\u6211\u8fd8\u8bb2\u7684\u4e0d\u592a\u900f\u5f7b\u3002 \u53c2\u8003: \u5f02\u6b65io: https://www.liaoxuefeng.com/wiki/1016959663602400/1017959540289152 \u4e3e\u4e2a\u9c9c\u6d3b\u7684\u4f8b\u5b50 \u6bd4\u5982\u53bb\u4e70\u65e9\u9910\u5e76\u6253\u5305\u56de\u5bb6\u3002\u6211\u65e9\u4e0a\u8981\u5403\u4e00\u7897\u6c64\u9762+\u4e00\u676f\u8c46\u6d46+2\u4e2a\u6cb9\u997c\u3002\u5f88\u53ef\u60dc\u7684\u662f\uff0c\u8fd93\u4e2a\u644a\u5b50\u867d\u7136\u5728\u4e00\u8d77\uff0c\u4f46\u662f\u90fd\u662f\u8981 \u6392\u961f \u7684\u3002 Python\u540c\u6b65\u573a\u666f: \u6211\u4e70\u8c46\u6d46\uff0c\u7b49\u8c46\u6d46\u6253\u597d\u3002 \u6211\u4e70\u6c64\u9762\uff0c\u7b49\u6c64\u9762\u505a\u597d\u3002 \u6211\u4e70\u6cb9\u997c\uff0c\u7b49\u6cb9\u997c\u505a\u597d\u3002 \u8fd9\u5c31\u662f\u4e00\u4e2a\u4e2a\u7684\u540c\u6b65\u4efb\u52a1\uff0c\u6211\u53ea\u6709 \u505a\u5b8c\u4e86\u4e00\u4e2a \u624d\u80fd \u53bb\u505a\u4e0b\u4e00\u4e2a \u3002\u8017\u8d39\u603b\u65f6\u95f4\u4e3a3\u4e2a\u6b65\u9aa4\u7684\u8017\u65f6\u603b\u548c\u3002 Python\u5f02\u6b65(asyncio)\u5c31\u7c7b\u4f3c\u8fd9\u6837\u7684\u573a\u666f: \u6211\u5148\u548c\u8001\u677f\u8bf4\u6211\u8981\u4e00\u7897\u6c64\u9762\uff0c\u8fd9\u65f6\u5019\u8001\u677f\u6b63\u5728\u5236\u4f5c\u4e2d\u6216\u8005\u6392\u961f\u4e2d\uff0c\u4f46\u662f\u4ed6\u5df2\u7ecf\u5728\u5904\u7406\u6211\u7684\u9700\u6c42\u4e86 \u6211\u518d\u53bb\u548c\u5305\u5b50\u94fa\u7684\u4eba\u8bf4\u6765\u676f\u8c46\u6d46 \u6700\u540e\u53bb\u6cb9\u8d27\u94fa\u5b50\u8ddf\u8001\u677f\u8bf4\u89812\u4e2a\u6cb9\u997c \u5982\u679c1\uff0c2\uff0c3\u91cc\u9762\u4efb\u610f\u4e00\u4e2a\u597d\u4e86\uff0c\u90fd\u4f1a\u901a\u77e5\u6211\u53bb\u62ff\uff0c\u8fd9\u6837\u867d\u7136\u6211\u8fd8\u662f\u4e00\u4e2a\u4eba\uff0c\u4f46\u662f\u6211\u6548\u7387\u66f4\u9ad8\u4e86\u3002\u8017\u65f6\u603b\u65f6\u95f4\u4ec5\u4ec5\u662f\u4e00\u4e2a\u7ebf\u7a0b\u5185\u90e8\u7684\u5207\u6362+\u6700\u6162\u7684\u90a3\u4e2a\u65f6\u95f4\u3002 \u5e38\u89c4\u591a\u7ebf\u7a0b\u573a\u666f: \u6211\u54e5\u53bb\u5e2e\u6211\u4e70\u8c46\u6d46\uff0c\u7b49\u8c46\u6d46\u6253\u597d\u3002 \u6211\u59d0\u53bb\u5e2e\u6211\u4e70\u6c64\u9762\uff0c\u7b49\u6c64\u9762\u505a\u597d\u3002 \u6211\u81ea\u5df1\u53bb\u4e70\u6cb9\u997c\uff0c\u7b49\u6cb9\u997c\u505a\u597d\u3002 \u7b49\u4e8e\u662f\u6d3e\u51fa\u4e863\u4e2a\u4eba\uff0c\u53bb\u505a3\u4ef6\u4e8b\u60c5\u3002\u6bcf\u4ef6\u4e8b\u60c5\u4e4b\u95f4\u6ca1\u6709\u5565\u5173\u7cfb\uff0c\u8017\u8d39\u603b\u65f6\u95f4 \u4ee5\u6700\u6162\u7684\u90a3\u4e2a\u4e3a\u51c6 \u3002 \u6211\u4eec\u91cd\u70b9\u8bb2\u8bb2asyncio\u505a\u7684\u4e8b\u60c5\uff0c\u5176\u5b9e\u4ed6\u662f\u6709\u4e00\u4e2aevent_loop\uff0c\u4f60\u53ef\u4ee5\u7406\u89e3\u4e3a\u7ba1\u7406\u7ebf\u7a0b\u4e2d\u4e8b\u4ef6\u7684\u4e1c\u897f\u6ca1\uff0c\u5b83\u5e2e\u52a9\u6211\u4eec\u8fdb\u884c\u4e8b\u60c5\u7684\u5207\u6362\u3002 \u6bd4\u5982\u4e0a\u9762\u8bf4\u7684\uff0c \u8ddf\u8001\u677f\u8bf4\u5b8c\u4e70\u8c46\u6d46\u4e86 \uff0c\u8001\u677f\u5728\u90a3\u5fd9\u6d3b\u4e86\uff0c\u8fd9\u65f6\u5019\u4f60\u5c31\u8be5\u8ba9\u51fa\u8d44\u6e90\uff0c\u5207\u6362\u5230\u4e0b\u4e00\u4e2a\u4e8b\u4ef6(\u53bb\u4e70\u6c64\u9762)\uff0c\u6700\u540e\u8c46\u6d46\u505a\u597d\u4e86\uff0c\u4f60\u600e\u4e48\u77e5\u9053\u53bb\u62ff\u5462\uff1f\u4e5f\u662f\u8fd9\u4e2aevent_loop\u901a\u77e5\u4f60\uff0c\u8ba9\u4f60\u80fd\u591f\u56de\u53bb\u62ff\u8c46\u6d46\u3002 \u5927\u81f4\u539f\u7406\u5c31\u662f\u8fd9\u6837\uff0c\u6211\u4eec\u8fd8\u4e0d\u9700\u8981\u638c\u63e1\u600e\u4e48\u5207\u6362\u4e8b\u4ef6\uff0c\u6211\u4eec\u53ea\u9700\u8981\u544a\u8bc9event_loop\uff0c\u6211\u4eec\u7684 \u4e70\u8c46\u6d46 \u662f\u4e00\u4e2a\u5f02\u6b65\u65b9\u6cd5\uff0c\u5176\u4e2d \u7b49\u5f85\u8001\u677f\u628a\u5305\u5b50\u505a\u597d\u7684\u65f6\u95f4 \uff0c\u53ef\u4ee5\u8ba9\u51fa\u8d44\u6e90\u7ed9\u5176\u4ed6\u4e8b\u4ef6\u3002 \u719f\u6089async\u548cawait \u5f53\u6211\u4eec\u7ed9\u4e00\u4e2a\u65b9\u6cd5\uff0c\u52a0\u4e0a\u4e86 async \u5173\u952e\u5b57\u4e4b\u540e\uff0c\u5b83\u5c31\u53d8\u6210\u4e86\u4e00\u4e2a\u5f02\u6b65\u65b9\u6cd5\uff0c\u800c\u6211\u4eec\u7684 await \u5173\u952e\u5b57\uff0c\u53ea\u80fd\u5728async\u65b9\u6cd5\u4e2d\u4f7f\u7528\uff0c\u610f\u601d\u662f\u5b83 \u8ba9\u51fa\u5bf9\u5f53\u524d\u7ebf\u7a0b\u7684\u63a7\u5236\u6743 \uff0c\u53ef\u4ee5\u8ba9\u7ebf\u7a0b\u53bb\u6267\u884c\u5176\u4ed6\u5185\u5bb9\u3002 \u4e00\u822c\u6765\u8bf4\u6211\u4eec\u81ea\u5df1\u7f16\u5199\u7684\u65b9\u6cd5\uff0c\u4e0d\u662f\u5728\u65b9\u6cd5\u524d\u52a0\u4e2a async \uff0c\u8c03\u7528\u65b9\u6cd5\u7684\u65f6\u5019\u52a0\u4e2aawait\u5c31\u884c\u5f97\u901a\u7684\u3002\u6bd4\u5982\u6211\u4eec\u7528requests\uff0c\u4ed6\u91cc\u5934\u5168\u662f\u540c\u6b65\u65b9\u6cd5\uff0c\u6211\u4eec\u5c31\u7b97\u7ed9\u4e86async\u548cawait\u4e5f\u6ca1\u4ec0\u4e48\u4f5c\u7528\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u4e00\u4e2a \u5f02\u6b65http \u8bf7\u6c42\u5e93\u3002 \u4ee5\u4e0a\u9762\u7684\u4f8b\u5b50\u6765\u8bf4\uff0c\u5982\u679c\u6211\u53bb\u6cb9\u997c\u644a\uff0c\u8001\u677f\u8bf4\u4e0d\u8bb8\u8d70\uff0c\u9a6c\u4e0a\u5c31\u597d\u4e86\u3002\u90a3\u6211\u5c31\u53ea\u80fd\u7559\u5728\u90a3\u8fb9\uff0c\u5148\u8001\u8001\u5b9e\u5b9e\u628a\u6cb9\u997c\u4e70\u4e86\u518d\u53bb\u4e0b\u4e00\u4e2a\u5730\u65b9\u3002 \u4e0d\u77e5\u9053\u8fd9\u6837\u8bf4\uff0c\u662f\u4e0d\u662f\u6bd4\u8f83\u597d\u7406\u89e3\u3002 aiohttp aiohttp\u662f\u4e00\u4e2a\u5f02\u6b65\u7684http\u6846\u67b6\uff0c\u4f60\u53ef\u4ee5\u628a\u5b83\u7406\u89e3\u4e3a\u5f02\u6b65\u7248\u7684 requests \u3002\u6211\u4eec\u8fd8\u6709\u8bb8\u591a\u8fd9\u6837\u7684\u5e93\u6bd4\u5982 aiofile \uff0c\u8fd9\u4e9b\u6539\u9020\u540e\u7684\u5f02\u6b65\u7c7b\u5e93\uff0c\u4ee5\u540e\u4f1a\u6709\u66f4\u591a\u7684\u5f02\u6b65\u7c7b\u5e93\u51fa\u73b0\u3002 \u4e3a\u4ec0\u4e48\u6211\u4eec\u8981\u8fd9\u4e48\u9ebb\u70e6\u5462\uff1f\u662frequest\u4e0d\u9999\u4e86\u5417\uff1f\u5176\u5b9e\u4e5f\u4e0d\u662f\u3002Python\u4e00\u76f4\u88ab\u4eba\u8bdf\u75c5\u6267\u884c\u6162\uff0c\u8fd9\u70b9\u5728\u6211\u4e0a\u5bb6\u516c\u53f8\u4f7f\u7528\u65f6 \u6df1\u6709\u611f\u89e6 \u3002 \u66fe\u7ecf\u7684\u96be\u9898 \u6709\u90a3\u4e48\u4e00\u4e2a\u9700\u6c42\uff0c\u5f53\u65f6\u662f\u4ece\u522b\u4eba\u7684\u63a5\u53e3\u91cc\u9762\u6293\u53d6\u516c\u53f8\u6240\u6709\u670d\u52a1\u7684\u6570\u636e\uff0c\u5e76\u5199\u5165\u5230\u6211\u4eec\u672c\u5730\u6570\u636e\u5e93\u3002\u5927\u6982\u51e0\u5343\u4e2aapp\uff0c\u540c\u6b65\u4e00\u6b21\u90a3\u662f\u6162\u7684\u5f88\u554a\uff0c\u5199\u4f2a\u4ee3\u7801\u5c31\u662f: for i in range( 100 ): r = requests.get( \"xxx\" ) data = r.json() cursor.execute( \"insert into xxx....\" ) \u6162\u7684\u539f\u56e0\u4e3b\u8981\u662fhttp\u8fc7\u7a0b\u6bd4\u8f83\u8017\u65f6\uff0c\u6211\u4eec\u5728\u7b49\u5f85\u54cd\u5e94\u7684\u65f6\u5019\uff0c\u5176\u4ed6\u7684\u4efb\u52a1\u6ca1\u6709\u540c\u65f6\u8fdb\u884c\u3002 \u5c31\u597d\u50cf\u8fd9\u91cc\u6709100\u4ea9\u7530\uff0c\u5c311\u4e2a\u4eba\u79cd\uff0c\u7b49\u4ed6\u79cd\u5b8c\u7530\u90fd\u7334\u5e74\u9a6c\u6708\u4e86\u3002\u6709\u4eba\u4f1a\u95ee\uff0c\u4f60\u548b\u4e0d\u7528threading\uff0c\u591a\u5f00\u51e0\u4e2a\u7ebf\u7a0b\uff0c\u4e5f\u5c31\u662f\u591a\u53eb\u51e0\u4e2a\u4eba\uff0c\u6bd4\u5982\u53eb100\u4e2a\u4eba\uff0c\u4e00\u8d77\u79cd\uff0c\u90a3\u4e0d\u5c31\u5feb\u4e86\u5417\uff1f \u6211\u4e5f\u60f3\uff0c\u53ef\u662fGIL\u5b9e\u529b\u4e0d\u5141\u8bb8\u554a\uff0c\u867d\u7136\u6211\u6ca1\u6709\u4eb2\u81ea\u8fd9\u6837\u505a\uff0c\u4f46\u662f\u7ed3\u5c40\u5e94\u8be5\u662f\u53ef\u4ee5\u9884\u6599\u7684\u3002 \u5982\u679c\u6709\u5174\u8da3\u7684\u8bdd\uff0c\u6211\u4ee5\u540e\u53ef\u80fd\u4f1a\u505a\u8fd9\u6837\u7684\u6d4b\u8bd5\u3002 \u90a3\u4e48\u4f1a\u6709\u4eba\u95ee\uff0c\u90a3\u4f60\u600e\u4e48\u641e\u5b9a\u7684\uff1f\u5176\u5b9e\u6211\u662f\u7528\u4e86go\u53bb\u8c03\u6574\u4e86\u4ee3\u7801\uff0c\u7528\u51e0\u5341\u4e2agoroutine\u53bb\u5b8c\u6210\u4e86\u8fd9\u4e2a\u4e8b\u60c5\uff0c\u901f\u5ea6\u5927\u6982\u5feb\u4e86\u4e2a\u51e0\u767e\u500d\uff0c\u4e00\u5c0f\u4f1a\u5c31 \u540c\u6b65\u5b8c\u4e86 \u3002 \u8bd5\u8bd5aiohttp \u60f3\u5230\u4e86\u4e0a\u8ff0\u7684\u96be\u9898\uff0c\u53c8\u60f3\u8d77\u81ea\u5df1\u4ee5\u540e\u8981\u6279\u91cf\u8dd1\u7528\u4f8b\u3002\u6240\u4ee5\u6211\u4e0d\u7981\u795e\u4f24\uff0c\u51b3\u5b9a\u5c1d\u8bd5\u4e00\u4e0baiohttp\u5427\u3002 \u5728\u6b64\u4e4b\u524d\uff0c\u6211\u4e5f\u53ea\u662f\u542c\u8fc7\u5b83\u7684\u5927\u540d\uff0c\u5e76\u65e0\u5b9e\u9645\u7ecf\u9a8c\u3002 \u76f8\u5173\u6587\u6863: https://docs.aiohttp.org/en/stable/ \u770b\u770bdemo \u6539\u9020\u4e4b\u524d\u7684HttpClient.py \u6211\u4eec\u65b0\u5efa\u4e00\u4e2a\u6587\u4ef6\uff0c\u53eb AsyncHttpClient.py \u3002 \u7f16\u5199\u597d\u6784\u9020\u51fd\u6570 \u548c\u4ee5\u524d\u51e0\u4e4e\u4e00\u6837\uff0c\u591a\u4e86\u4e00\u4e2atimeout\uff0c\u56e0\u4e3aaiohttp\u7684timeout\u4e0d\u662fint/float\u7c7b\u578b\uff0c\u800c\u662faiohttp.ClientTimeout. \u7f16\u5199get_cookie\u65b9\u6cd5 def get_cookie (self, session) : cookies = session.cookie_jar.filter_cookies(self.url) return {k: v.value for k, v in cookies.items()} \u901a\u8fc7session\u4e2d\u7684cookie_jar\u53bb\u83b7\u53d6cookie. \u7f16\u5199\u83b7\u53d6resp\u65b9\u6cd5 \u5f53response\u662fjson\u6211\u4eec\u7ed9\u4ed6\u53cd\u5e8f\u5217\u5316\u4e3aPython\u5bf9\u8c61\uff0c\u5426\u5219\u8fd4\u56de\u5b57\u7b26\u4e32 \u7f16\u5199collect\u65b9\u6cd5 \u5176\u5b9e\u8fd9\u4e2a\u65b9\u6cd5\u5c31\u662f\u7ec4\u88c5\u4e86\u8bf7\u6c42\u7684\u4e00\u4e9b\u6570\u636e\u3002 \u548c\u4e4b\u524d\u7684\u6bd4\u8f83\u7c7b\u4f3c \u7f16\u5199invoke\u65b9\u6cd5 \uff08\u51fa\u4e8e\u8ddf\u98ce\uff0c\u6211\u5728\u5f88\u591arpc\u6846\u67b6\u90fd\u770b\u5230\u7c7b\u4f3c\u8fd9\u6837\u7684\u53eb\u6cd5\uff09 \u9996\u5148\u7528async with\u83b7\u53d6\u4e86\u4e00\u4e2asession\uff0c\u6ce8\u610f\u8fd9\u91cc\u6234\u4e0a\u4e86Cookie\u3002\u5176\u4ed6\u5730\u65b9\u6ca1\u6709\u4ec0\u4e48\u533a\u522b\uff0c\u5e76\u989d\u5916\u8ba1\u7b97\u4e86\u8bf7\u6c42\u65f6\u95f4\u3002 \u5982\u4f55\u4f7f\u7528 \u5148\u770b\u770b\u6211\u4eechttp\u6d4b\u8bd5\u8fd9\u4e2a\u63a5\u53e3\uff0c\u5c06\u65b9\u6cd5\u6539\u4e3aasync\uff0crequest\u90e8\u5206\u6539\u4e3aAsyncRequest\uff0c\u5e76await invoke\u8fd4\u56de\u7684\u5185\u5bb9\u3002 \u8bd5\u8bd5request\u8bf7\u6c42 \u70b9\u4eae\uff0c\u5b8c\u7f8e \u5c0f\u6d4b\u8bd5\u4ee3\u7801 import asyncio import time import aiohttp import requests url = \"https://www.baidu.com\" async def fetchBaidu () : async with aiohttp.ClientSession() as session: resp = await session.get(url) text = await resp.text(encoding= 'utf-8' ) print(text.split( \"\\n\" )[ 0 ]) async def main () : start = time.time() await asyncio.gather(*(fetchBaidu() for _ in range( 200 ))) print( \"\u82b1\u8d39\u65f6\u95f4:\" , time.time() - start) def main2 () : start = time.time() session = requests.Session() for i in range( 200 ): r = session.get(url) print(r.text.split( \"\\n\" )[ 0 ]) print( \"\u82b1\u8d39\u65f6\u95f4:\" , time.time() - start) if __name__ == \"__main__\" : asyncio.run(main()) # main2() \u76ee\u524d\u662f200\u6b21\u6d4b\u8bd5\uff0c\u8fd9\u662faiohttp\u7684\u901f\u5ea6: aiohttp \u666e\u901a\u7684requests \u5faa\u73af\u592a\u591a\u7684\u8bdd\uff0c\u767e\u5ea6\u6709\u70b9 \u4e0d\u5f00\u5fc3\u4e86 \u3002 \u4eca\u5929\u7684\u5185\u5bb9\u5c31\u5206\u4eab\u5230\u8fd9\u91cc\u4e86\uff0c\u5927\u5bb6\u53ef\u4ee5\u62ff\u7740\u8fd9\u4e2a\u811a\u672c\u73a9\u73a9\uff0c\u8bd5\u8bd5\u770b\uff0c\u770b\u770baiohttp\u5c4c\u5728\u54ea\u91cc\uff01","title":"43.aiohttp\u521d\u4f53\u9a8c"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2844%29%20%E5%89%8D%E5%90%8E%E7%AB%AF%E5%90%88%E5%B9%B6%28%E4%B8%8A%29/","text":"\u5927\u5bb6\u597d\uff0c\u6211\u662f\u7c73\u6d1b\uff0c\u4e00\u4f4d\u809d\u5e1d\uff01 \u6b22\u8fce\u5927\u5bb6\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7: \u6d4b\u8bd5\u5f00\u53d1\u5751\u8d27 \u3002 \u786c\u8d27\u9884\u8b66\uff01\uff01\uff01\u5bf9\u809d\u5e1d\u4e0d\u611f\u5174\u8da3\u53ef\u76f4\u63a5\u8df3\u8fc7\u3002 \u56de\u987e \u4e0a\u7bc7\u5176\u5b9e\u6211\u4eec\u8fd8\u5728\u5f04 \u6570\u636e\u6784\u9020\u5668 \uff0c\u800c\u4e14\u8fd8\u6ca1\u7ed3\u675f\u3002\u5176\u5b9e\u535a\u4e3b\u6211\u65e9\u5c31\u5df2\u7ecf\u66f4\u4e862\u7bc7\u4e86\uff0c\u53ea\u4e0d\u8fc7\u8fd8\u6ca1 \u53d1\u51fa\u6765 \u3002 \u8fd9\u7bc7\u6211\u4eec\u5148\u4e0d\u7ba1 \u6570\u636e\u6784\u9020\u5668 \uff0c\u8c08\u70b9\u522b\u7684\u3002 \u6211\u4e3a\u4ec0\u4e48\u662f\u809d\u5e1d \u4e8b\u60c5\u5c31\u6e90\u4e8e\u6211\u5468\u4e94\u665a\u4e0a\u95f2\u7740\u6ca1\u4e8b\uff0c\u5728\u5bfb\u627e\u5f02\u6b65\u76f8\u5173\u7684 \u7c7b\u5e93 \uff0c\u53d1\u73b0\u4e86\u4e00\u4e2a\u6bd4\u8f83\u6f02\u4eae\u7684\u5b98\u65b9\u6587\u6863\u7f51\u7ad9: https://aioredis.readthedocs.io/en/latest/getting-started/ \u5927\u6982\u957f\u8fd9\u6837 \u7ec6\u5fc3\u7684\u670b\u53cb\u53ef\u80fd\u53d1\u73b0\u4e86\uff0c\u8fd9\u4e2a\u662f\u4e0d\u662f\u548c httprunner \u7684\u5b98\u7f51\u957f\u5f97\u5f88\u50cf\u554a\u3002 \u5c31\u5728\u6211\u53d1\u73b0\u8fd9\u4e2a \u65b0\u5927\u9646 \u4e4b\u540e\uff0c\u6211\u5c31\u4e00\u53d1\u4e0d\u53ef\u6536\u62fe\u3002 \u9996\u5148\u6211\u4eec\u89c2\u5bdf\u4ed6\u7684\u57df\u540d: readthedocs.org\uff0c\u5176\u5b9e\u5f88\u591a\u5176\u4ed6\u9879\u76ee\u4e5f\u6709\u7c7b\u4f3c\u7684 \u5b98\u65b9\u6587\u6863 \u3002 \u60f3\u7740httprunner\u505a\u4e86\u8fd9\u4e48\u5e05\u6c14\u7684\u5b98\u7f51\uff0c\u90a3\u6211\u4eec\u867d\u7136\u4e0d\u80fd\u8bf4\u8981\u8d76\u4e0a\u4ed6\uff08\u6bd5\u7adf\u4eba\u5bb6\u8fd8\u662f\u6709\u51e0\u628a\u5237\u5b50\u7684\uff09\uff0c\u4f46\u662f\u4e5f\u8981\u50cf\u4ed6\u770b\u9f50\u5427\uff0c\u628a\u5b98\u7f51 \u6574\u4e00\u6574 \u3002 \u4e8e\u662f\u6211\u4e5f\u6709\u4e86\u4e2a\u8fd9\u6837\u7684\u7f51\u7ad9: https://pity.readthedocs.io/requirements/%E5%87%86%E5%A4%87%E6%9D%A1%E4%BB%B6/ \u4f60\u522b\u8bf4\uff0c\u662f\u4e0d\u662f\u8fd8 \u50cf\u6a21\u50cf\u6837 \u7684\uff1f\u6628\u665a\u5f04\u9875\u9762+\u5199\u6587\u6863+\u4eca\u5929\u5199\u6587\u6863\uff0c\u5230\u73b0\u5728\u624d\u7b97\u5b8c\u3002 \u6211\u613f\u79f0\u81ea\u5df1\u4e3a\u809d\u5e1d\uff0c\u56e0\u4e3a\u6211\u6628\u665a3\u70b9\u624d\u8c03\u597d\uff08\u5751\u591a\u8d44\u6599\u5c11\uff09\u3002\u540e\u9762\u6211\u4f1a\u653e\u51fa\u6587\u7ae0 \u6559\u5927\u5bb6 \u600e\u4e48\u5f04\uff01 \u56de\u5230\u4eca\u5929\u7684\u8bdd\u9898 \u53e4\u8bed\u6709\u4e91: \u5929\u4e0b\u5927\u4e8b\uff0c\u5206\u4e45\u5fc5\u5408\u5408\u4e45\u5fc5\u5206 \uff01\u5728\u6211\u4eec\u524d\u540e\u7aef\u8fd9\u91cc\uff0c\u5176\u5b9e\u4e5f\u53ef\u4ee5\u5206\u5206\u5408\u5408\uff01\u4e14\u542c\u6211\u6162\u6162\u9053\u6765~ \u719f\u6089\u8fd9\u4e2a\u5e73\u53f0\u7684\u5144\u5f1f\u96c6\u7f8e\u840c\u5e94\u8be5\u90fd\u77e5\u9053\uff0c\u9879\u76ee\u7684\u524d\u7aef\u662f React \u5f00\u53d1\uff0c\u72ec\u7acb\u8d77\u7684\u4e00\u4e2a\u670d\u52a1\uff0c\u540e\u7aef\u91cc\u9762\u6839\u672c\u6ca1\u6709 templates , static \u8fd9\u6837\u7684 \u9759\u6001\u8d44\u6e90 \u6570\u636e\u3002 \u6ce8\u610f\u8fd9\u53e5\u8bdd: \u5982\u679c\u8bf4\u524d\u540e\u7aef\u5206\u79bb\u662f\u5265\u79bbflask/django\u4e2d\u7684static\u8d44\u6e90\uff0c\u90a3\u4e48\u524d\u540e\u7aef\u5408\u5e76\uff08\u6211\u81ea\u5df1\u968f\u4fbf\u53d6\u7684\u540d\uff09\u5c31\u662f\u628a\u5b83\u585e\u56de\u5a18\u80ce\u91cc\uff01 \u4eca\u5929\u5c31\u52a8\u624b\uff0c\u7acb\u523b\uff01\uff01\u6211\u4eec\u5148\u6765\u770b\u4e00\u4e0b\u6211\u81ea\u5df1 \u5b98\u65b9 \u7ed9\u51fa\u7684\u597d\u574f\u5904\u3002 \u4e86\u89e3\u8def\u7531 \u6211\u4eec\u505a\u4e86\u524d\u540e\u7aef\u5206\u79bb\u7684\u9879\u76ee\u540e\uff0c\u524d\u7aef\u6709url\u6bd4\u5982\u6211\u4eec\u5e38\u7528\u7684: /user/login \uff0c\u8fd8\u6709\u4e00\u4e9b \u9759\u6001\u8d44\u6e90 \u5982\u56fe\u7247, js,css\u7b49\u3002 \u4e00\u65e6\u5408\u5e76\u540e\uff0c\u60f3\u4e00\u4e0b\u662f\u4e0d\u662f\u53ef\u80fd\u4f1a\u548c\u6211\u4eec\u5728FastApi\u5b9a\u4e49\u7684\u8def\u7531\u4e32\u4e86\uff0c\u5982\u679c\u4ed6\u4eec\u90fd\u662f \u4e2d\u534e\u7530\u56ed\u72ac \u7684\u8bdd\uff0c\u6211\u4eec\u53ef\u4ee5\u53eb\u4ed6\u4eec\u4e32\u4e32\u3002 \u524d\u7aef\u8def\u7531\u7c7b\u578b \u5176\u5b9e\uff0c\u524d\u7aef\u8def\u7531\u662f\u52062\u79cd\u7684\uff0c\u7b2c\u4e00\u79cd\u5c31\u662f\u6211\u4eec\u76ee\u524d\u7684 browser \u6a21\u5f0f\uff0c\u548c\u6b63\u5e38\u7684\u8def\u7531\u6ca1\u533a\u522b\uff0c\u6bd4\u5982: \u4f46\u5176\u5b9e\u8fd8\u6709\u4e00\u79cd\u8def\u7531\u7c7b\u578b\u662fhash\u7c7b\u578b\uff0c\u4f60\u4eec\u53ef\u80fd\u5728\u516c\u53f8\u4e5f\u770b\u5230\u8fc7: \u6bd4\u5982\u5927\u540d\u9f0e\u9f0e\u7684element-ui\u5c31\u662f\u5982\u6b64 \u770b\u5230\u4e2d\u95f4\u90a3\u4e2a/#/\u6ca1\u6709\uff0c\u90a3\u5c31\u662fhash\u8def\u7531\u7684\u6807\u5fd7\u3002\u5176\u5b9e\u5bf9\u6211\u4eec\u7528\u6237\u4f7f\u7528\u6765\u8bf4\u662f\u6ca1\u6709\u4ec0\u4e48\u533a\u522b\u7684\uff0c\u5c31\u662f\u611f\u5b98\u4e0a\u7684\u3002 hash\u8def\u7531\u53ef\u4ee5\u7ed9\u6211\u4eec\u5e26\u6765\u4e00\u4e2a\u597d\u5904\uff0c\u6211\u4eec\u53ef\u4ee5\u907f\u514d \u4e32\u4e32 \u3002\u56e0\u4e3ahash\u8def\u7531\u4e0d\u7b97\u5f88\u89c4\u5219\u7684\u8def\u7531\u3002 \u773c\u7785\u7740\u5185\u5bb9\u6bd4\u8f83\u591a\uff0c\u8d76\u7d27\u5207\u6362\u5230\u4e0b\u4e00\u8282\u3002 \u4ee5\u540e\u6587\u672b\u53ea\u9700\u8981\u4e00\u4e2a\u5730\u5740\uff0c\u91cc\u9762\u6709\u5404\u79cd\u4f20\u9001\u95e8\u4e86\uff01 https://pity.readthedocs.io/","title":"44.\u524d\u540e\u7aef\u5408\u5e76(\u4e0a)"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2845%29%20%E5%89%8D%E5%90%8E%E7%AB%AF%E5%90%88%E5%B9%B6%28%E4%B8%8B%29/","text":"\u5927\u5bb6\u597d\uff0c\u6211\u662f\u7c73\u6d1b\uff0c\u4e00\u4f4d\u8e29\u5751\u4eba\uff01 \u6b22\u8fce\u5927\u5bb6\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7: \u6d4b\u8bd5\u5f00\u53d1\u5751\u8d27 \u3002 \u786c\u8d27\u9884\u8b66\uff01\uff01\uff01\u8fd9\u7bc7\u6587\u7ae0\u4e3b\u8981\u8bb2\u5982\u4f55\u5728FastApi\u6574\u5408React\u9759\u6001\u8d44\u6e90\uff08vue\u540c\u7406\uff09\u3002 \u56de\u987e \u4e0a\u6b21\u6211\u4eec\u8bf4\u4e86hash\u8def\u7531\u548cbrowser\u8def\u7531\u3002\u4eca\u5929\u804a\u804aFlask\uff0cDjango\uff0cFastApi\u90fd\u901a\u7528\u7684\u8def\u7531\u3002 \u8def\u7531 \u4eba\u4eec\u603b\u8bf4url\uff0curl\uff0c\u90a3url\u5230\u5e95\u662f\u4ec0\u4e48\u5462\uff1f\u4e3a\u4ec0\u4e48\u7ed9\u4f60\u4e00\u4e2aurl\u4f60\u5c31\u4e0d\u4f1a\u8c03\u5230\u522b\u4eba\u7684\u63a5\u53e3\u4e86\u5462\uff1f \u5f88\u660e\u663e\uff0c URL\uff08Uniform Resource Locator,\u7edf\u4e00\u8d44\u6e90\u5b9a\u4f4d\u5668\uff09 \u662f\u4e00\u4e2a\u4fbf\u4e8e\u6211\u4eec\u5b9a\u4f4d\u5230\u67d0\u4e00\u4e2a\u5177\u4f53\u8d44\u6e90\u7684\u7b80\u79f0\u3002 \u90a3\u8def\u7531\u53c8\u662f\u4ec0\u4e48\u9b3c\uff1f\u7b80\u5355\u70b9\u8bf4\uff0c \u8def\u7531\u5c31\u662furl\u5230\u4f60\u5bf9\u5e94\u6267\u884c\u65b9\u6cd5\u4e4b\u95f4\u7684\u6620\u5c04 \u3002 \u719f\u6089django\u7684\u540c\u5b66\uff08\u4e0d\u5305\u62ec\u6211\uff09\u53ef\u80fd\u90fd\u77e5\u9053\uff0cdjango\u7f16\u5199\u63a5\u53e3\u7684\u65f6\u5019\u662f\u53ef\u4ee5\u901a\u8fc7\u6b63\u5219\u8868\u8fbe\u5f0f\u53bb\u5339\u914d\u4f60\u7684url\u89c4\u5219\uff0c\u7136\u540e\u6620\u5c04\u5230\u5bf9\u5e94\u7684\u6267\u884c\u51fd\u6570\u7684\u3002 \u6240\u4ee5 \u4ece\u8fd9\u91cc \u6211\u4eec\u5c31\u53ef\u4ee5\u77e5\u9053\uff0c\u4f60\u7ed9\u4e86\u6211url\uff0c\u901a\u8fc7ip\u548cport\uff08\u7aef\u53e3\uff09\u627e\u5230\u4e86\u6211\u7684\u670d\u52a1\uff0c\u4f46\u662f\u6211\u670d\u52a1\u91cc\u9762\u6709 \u8fa3\u4e48\u591a \u7684\u51fd\u6570\uff0c\u6211\u548b\u77e5\u9053 \u5339\u914d\u54ea\u4e00\u4e2a\uff0c\u6267\u884c\u54ea\u4e00\u4e2a \u5462\uff1f\u600e\u4e48\u8fd8\u4e0d\u4f1a\u4e32\u5462\uff1f \u6240\u4ee5\u51fa\u73b0\u4e86\u4e0a\u9762\u8bf4\u7684\uff0c\u8def\u7531\u89c4\u5219\uff08django\uff09,Flask\u4e2d\u7684 @app.route \uff0cFastApi\u4e2d\u7684 @app.get \u3002 \u518d\u804a\u4e32\u4e32 \u56de\u5230\u4e0a\u7bc7\u6587\u7ae0\u8bf4\u7684\u4e32\u4e32\uff0c\u524d\u7aef\u6211\u4eec\u5b9a\u4e49\u4e86\u81ea\u5df1\u7684\u8def\u7531\uff0c\u540e\u7aef\u4e5f\u6709\u81ea\u5df1\u7684\u8def\u7531\u3002\u4e3a\u4ec0\u4e48hash\u8def\u7531\u5c31\u4e0d\u4f1a\u4e32\u4e86\u5462\uff1f\u90a3\u662f\u56e0\u4e3a\u54b1\u4eec\u540e\u7aef\u5b9a\u4e49\u8def\u7531\u7684\u65f6\u5019\uff0c\u6ca1\u4ec0\u4e48\u4eba\u4f1a\u8fd9\u6837\u5b9a\u4e49: @app.route(\"/haha/#/nihaihaoma\") \u8fd9\u6837\u5b9a\u4e49\u7684\u90fd\u662f\u5367\u9f99\u51e4\u96cf\uff0c\u8d77\u7801 \u5728\u5ea7\u7684\u5404\u4f4d \u90fd\u4e0d\u662f\u3002\u6240\u4ee5\u8def\u7531\u5339\u914d\u4e0d\u4e0a\uff0c\u4f1a\u600e\u4e48\u6837\uff1f\u5c31\u4e0d\u4f1a\u4e32\u4e86\u5440\uff01 \u6253\u5305\u9759\u6001\u8d44\u6e90 \u6211\u4eec\u5728pityWeb\u76ee\u5f55\u8fd0\u884c npm run build \u7b49\u5f85\u6253\u5305\u5b8c\u6210\u540e\uff0c\u628adist\u91cc\u7684\u6240\u6709\u5185\u5bb9\u5168\u90e8\u653e\u5230statics\u76ee\u5f55\u4e2d\u53bb\uff0c\u8fd9\u91cc\u4e3a\u4ec0\u4e48\u662f statics \u800c\u4e0d\u662f static \uff0c\u7a0d\u540e\u518d\u8bf4\u3002 FastApi\u4e2d\u7684\u9759\u6001\u8d44\u6e90 \u6211\u4eec\u770b\u5b98\u7f51\u7ed9\u7684\u4f8b\u5b50: \u8349\u8349\u51e0\u53e5\u5c31\u5b8c\u4e8b\u4e86 \u6211\u4eec\u4ee5Flask\u8fdb\u884c\u5bf9\u7167\u5f00\u53d1\uff0c\u6211\u8bb0\u5f97flask\u662f\u53ef\u4ee5\u8bbe\u7f6e\u9759\u6001\u8d44\u6e90\u76ee\u5f55\u7684\uff0c\u5176\u5b9e\u8fd9\u91cc\u662f\u4e00\u4e2a\u610f\u601d\u3002\u5927\u81f4\u5c31\u662f\u628astatic\u6587\u4ef6\u5939\u4e0b\u7684\u5185\u5bb9\u5f53\u505a\u4e86\u9759\u6001\u8d44\u6e90\u3002 \u64cd\u7ec3\u8d77\u6765 \u597d\u5bb6\u4f19\uff0c\u6211\u6309\u7167 \u5b98\u65b9\u6587\u6863 \u5386\u7ec3\uff0c\u76f4\u63a5\u7ed9\u6211\u6c89\u75db\u6253\u51fb\u3002 \u6211\u60f3\u8c61\u4e2d\u7684\u6837\u5b50: \u8fdb\u5165http://localhost7777\uff0c\u5c31\u80fd\u7ed9\u54b1\u8fd4\u56de\u767b\u5f55\u9875\u9762\u3002 \u5b9e\u9645\u4e0a\u7684\u6837\u5b50: \u5b98\u7f51\u4e00\u53e5\u8bdd\uff0c\u5176\u4ed6\u5168\u9760\u81ea\u5df1 \u4e5f\u8bb8\u8fd9\u5c31\u662fFastApi\u7684\u9b45\u529b\u5427\uff0c\u5feb\u5230\u8ba9\u4f60\u8ffd\u4e0d\u4e0a\uff0c\u4f60\u5c31\u9a82\u4e0d\u4e86\u4ed6\u4e86\u3002\u4f60\u7684\u5200\u867d\u7136\u957f 40\u7c73 \uff0c\u4f46\u4ed6\u5df2\u7ecf\u8dd1\u4e86 100\u7c73 \u4e86\uff01 \u5c1d\u8bd5\u89e3\u51b3 \u65e2\u7136\u5b83\u4e0d\u7ed9\u529b\uff0c\u54b1\u4eec\u5df2\u7ecf \u4e0a\u4e86\u8d3c\u8239 \uff0c\u90a3\u603b\u4e0d\u80fd\u4e34\u9635\u8131\u9003\u5427\uff01\u4e8e\u662f\u6211\u5f00\u542f\u4e86\u5927\u6d77\u635e\u9488\u6a21\u5f0f\uff0c\u597d\u5728\u8ba9\u6211\u627e\u5230\u4e86\u89e3\u51b3\u65b9\u6848\u3002 \u4e00\u4e00\u5206\u6790\uff0c\u9996\u5148\uff0c\u4e3a\u4ec0\u4e48\u4ed6\u4f1a\u8bf4 not found !\u90a3\u80af\u5b9a\u662f\u8def\u7531\u89c4\u5219\u6ca1\u6709\u5339\u914d\u5230\uff01 \u6211\u4eec\u786e\u5b9e\u6ca1\u6709\u5199 / \u7684\u8def\u7531\u89c4\u5219\uff0c\u6240\u4ee5\u5408\u60c5\u5408\u7406\u3002\u4f46\u6211\u4eec\u73b0\u5728\u60f3\u8981\uff0c\u7528\u6237\u8fdb\u5165\u9996\u9875\u7684\u65f6\u5019\uff0c\u81ea\u52a8\u52a0\u8f7d\u6211\u4eec\u6253\u5305\u540e\u7684index.html\u6587\u4ef6\uff0c\u4e5f\u5c31\u662f\u8bf4\u6211\u4eec\u8981\u76f4\u63a5\u8fd4\u56de\u8fd9\u4e2ahtml\uff08\u4e5f\u5c31\u662f\u524d\u7aef\u9996\u9875\uff09\u3002 \u6240\u4ee5\u6211\u4eec\u8981\u52a0\u4e0a\u8fd9\u4e2a: \u4e5f\u5c31\u662f\u9996\u9875\u8def\u7531 \u52a0\u597d\u4e86\u4e4b\u540e\u91cd\u542f\u670d\u52a1\u770b\u770b\u6548\u679c: \u53ef\u4ee5\u770b\u5230\u8def\u7531\u968f\u6211\u4eec\u5fc3\u610f\u4e86\uff0c\u5176\u4ed6\u7684\u8fd8\u4e0d\u592a\u5982\u610f \u522b\u614c\uff0c\u6211\u4eec\u7ee7\u7eed\u6392\u67e5\uff0c\u6253\u5f00F12: \u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u4e9b\u6587\u4ef6\u90fd\u627e\u4e0d\u5230\u5440 \u7ee7\u7eed\u56de\u5fc6\u6211\u4eec\u7684\u8def\u7531\u5339\u914d\u89c4\u5219\uff0c\u6211\u4eec\u6ca1\u6709\u5199: /{filename} \u8fd9\u6837\u7684\u8def\u7531\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u4e3a\u8fd9\u6837\u7684\u8def\u7531\u505a\u4e2a \u5339\u914d \u3002 \u56e0\u4e3a\u6211\u4eec\u5728\u8bbe\u8ba1\u4e4b\u521d\uff0c\u540e\u7aef\u8def\u7531\u90fd\u662f \u4e1a\u52a1 \u52a0 \u540d\u79f0 \uff0c\u6240\u4ee5\u4e0d\u4f1a\u4e32\u3002\u6bd4\u5982: /request/http, /auth/login\u3002\uff08\u8fd9\u5c31\u4f53\u73b0\u4e86\u4e00\u4e2a\u597d\u7684\u8bbe\u8ba1\u7684\u4f5c\u7528\u4e86\uff09 \u6211\u4eec\u8865\u5145\u4e00\u4e0b\u8fd9\u4e2a\u8def\u7531 \u8fd9\u4e2a\u8def\u7531\u4f1a\u5339\u914d\u5230\u521a\u624d\u6211\u4eec\u627e\u4e0d\u5230\u7684\u6587\u4ef6\uff0c\u5e76\u5224\u65ad\u662f\u4e0d\u662f\u6587\u4ef6\uff0c\u4e0d\u662f\u5c31\u76f4\u63a5\u7ed9\u4ed6\u4e2a 404 \u3002\u5982\u679c\u662f\uff0c\u6211\u4eec\u5c31\u6253\u5f00\u6587\u4ef6\u5e76\u8bfb\u5185\u5bb9\uff0c\u518d\u731c\u51fa\u6587\u4ef6\u7684\u7c7b\u578b\uff0c\u8fd4\u56de\u5bf9\u5e94\u7c7b\u578b\u7684Response\u3002 \u8fd9\u6837\u7684\u597d\u5904\u5c31\u662fcss\u5c31\u8fd4\u56dexxx.css\uff0cjs\u5c31\u662fxxx.js\uff0c\u4e0d\u4f1a\u4e71\u5957\u3002 \u518d\u6765\u8bd5\u8bd5: \u8bf6\uff0c\u4f60\u522b\u8bf4\uff0c\u6548\u679c\u8fd8\u4e0d\u9519 \u4f46\u662f\u53d1\u73b0\u4e2a\u95ee\u9898\u6ca1\uff1flogo\u53c8\u6ca1\u4e86\uff01\uff01\uff01\u7ee7\u7eed\u770bF12: \u8fd9\u4e2a\u6587\u4ef6\u4e0d\u6309\u5957\u8def\u51fa\u724c\u5440 \u4ed6\u7684url\u662f/static/xxxx\uff0c\u8fd9\u6837\u6211\u4eec\u7684\u8def\u7531\u89c4\u5219\u5339\u914d\u4e0d\u5230\u7684\u3002 \u6240\u4ee5\u6211\u4eec\u8fd8\u5f97\u518d\u5199\u4e2a\u8def\u7531: /static/{filename} \u4ee3\u7801\u57fa\u672c\u548c\u4e0a\u8ff0\u4e00\u6837\uff0c\u53ea\u662f\u53d6\u6587\u4ef6\u7684\u5730\u513f\u4e0d\u4e00\u6837\uff0c\u4ecestatics/static\u53d6 \u5148\u524d\u6539\u540d\u4e3astatics\u4e5f\u662f\u8fd9\u4e2a\u539f\u56e0\uff0c\u91cc\u5934\u6709\u91cd\u540d\u6587\u4ef6\uff0c\u5bfc\u81f4\u8def\u7531\u4e00\u5f00\u59cb\u8fdb\u4e0d\u6765\uff08\u8fd9\u662f\u6211\u8e29\u7684\u5751\uff0c\u6ca1\u8ba9\u4f60\u4eec\u8e29\uff09\u3002 \u6700\u540e\u8bd5\u8bd5\uff0c\u4e8b\u4e0d\u8fc7\u4e09: \u5b8c\u7f8e\u52a0\u8f7d \u540e\u7aef\u4e5f\u62ff\u5230\u4e86\u8bf7\u6c42\u9759\u6001\u8d44\u6e90\u7684\u4fe1\u606f \u968f\u4fbf\u64cd\u4f5c\u4e5f\u6ca1\u5565\u95ee\u9898\uff08\u56e0\u4e3a\u6539\u4e86\u8def\u7531\u4e3ahash\u6a21\u5f0f\uff0c\u975ehash\u6a21\u5f0f \u5237\u65b0\u4f1a\u62a5404 \uff0c\u8fd9\u4e5f\u662f\u4e2a\u5751\uff09 \u540c\u7406\uff0cFlask\u4e5f\u53ef\u4ee5\u7c7b\u4f3c\u53bb\u6574\u5408 \u9759\u6001\u8d44\u6e90 \u3002 \u9047\u5230\u95ee\u9898\u4e0d\u53ef\u6015\uff0c\u6162\u6162\u627e\u5bfb\u539f\u56e0\u5c31\u597d\uff01\u4e0d\u8981\u614c\u4e71~ \u914d\u5408 \u90e8\u7f72\u65b9\u6848\u6587\u7ae0 \u53e3\u611f\u66f4\u4f73\u54e6\u3002 https://pity.readthedocs.io/deploy/%E9%83%A8%E7%BD%B2/ \ud83d\ude04\u6700\u540e\u65e0\u803b\u6765\u4e00\u6ce2 \u6c42\u5173\u6ce8 \uff0c\u5927\u5bb6\u5468\u672b\u6109\u5feb~~","title":"45.\u524d\u540e\u7aef\u5408\u5e76(\u4e0b)"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2846%29%20%E7%94%A8%E4%BE%8B%E5%B9%B6%E5%8F%91%E4%B9%8B%E6%88%91%E5%85%A8%E9%83%BD%E8%A6%81/","text":"\u5927\u5bb6\u597d\uff0c\u6211\u662f\u7c73\u6d1b\uff0c\u6c42\u4e09\u8fde\uff01\u6c42\u5173\u6ce8 \u6d4b\u8bd5\u5f00\u53d1\u5751\u8d27 ! \u5982\u679c\u9605\u8bfb\u5b8c\u6bd5\u540e\u60f3\u548c\u4f5c\u8005\u6709\u66f4\u591a\u4ea4\u6d41\uff0c\u53ef\u4ee5\u70b9\u51fb \u9605\u8bfb\u539f\u6587 \u627e\u5230\u5e95\u90e8\u8bc4\u8bba\u533a\uff0c\u7ed9\u4f5c\u8005\u7559\u8a00\u5566\uff01 \u56de\u987e \u524d\u4e00\u7ae0\u6211\u4eec\u628ahttp\u6362\u6210\u4e86aiohttp\uff0c\u5b8c\u6210\u4e86 \u6570\u636e\u6784\u9020\u5668 \u529f\u80fd\u3002\u4eca\u5929\u5c31\u8f7b\u677e\u70b9\u5427~ \u7528\u4f8b\u8fd0\u884c \u76ee\u524d\u6211\u4eec\u5f00\u653e\u4e86api\uff0c /request/run \u8fd9\u4e2a\u63a5\u53e3\u53bb\u8fd0\u884c\u5355\u4e2a \u7528\u4f8b \u3002\u4f46\u662f\u6211\u4eec\u7684\u76ee\u6807\u5e76\u4e0d\u662f \u505a\u4e00\u4e2a\u73a9\u5177 \uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u60f3\u4e00\u4e0b\u600e\u4e48\u53bb\u652f\u6301\u591a\u6761\u7528\u4f8b\u4e00\u8d77\u6267\u884c\u3002 \u81f3\u4e8e\u6d4b\u8bd5\u96c6\uff0c\u6d4b\u8bd5\u8ba1\u5212\uff0c\u5b9a\u65f6\u4efb\u52a1\u8fd9\u79cd\u4e5f\u4f1a\u9646\u7eed\u5c55\u5f00\uff0c\u5148\u628a\u773c\u524d\u7684 \u56f0\u96be \u7ed9\u89e3\u51b3\u3002 \u6240\u4ee5\u6211\u4eec\u9700\u8981\u5728\u9875\u9762\u4e0a\u53ef\u4ee5 \u591a\u9009 \u7528\u4f8b\u6765\u6267\u884c\uff0c\u5e76\u80fd\u770b\u5230\u4e00\u4e2a\u5177\u4f53\u7684\u62a5\u544a\uff0c\u6709\u4e86\u8fd9\u4e00\u6b65\uff0c\u540e\u7eed\u6574\u5408\u6d4b\u8bd5\u96c6\u548c\u6d4b\u8bd5\u8ba1\u5212\u5c31\u6613\u5982\u53cd\u638c\u4e86\u3002 MQ/celery\uff1f \u5176\u5b9e\u662f\u53ef\u4ee5\u7528mq\u7684\u65b9\u5f0f\u53bb\u6267\u884c\u7528\u4f8b\uff0c\u7528\u6237\u9009\u5b9a\u4e86\u4e00\u6279\u7528\u4f8b\uff0c\u76f4\u63a5\u5f80mq\u91cc\u9762\u585e\u5c31 \u5b8c\u4e8b \u4e86\uff0c\u5269\u4e0b\u7684\u4ea4\u7ed9\u6d88\u8d39\u8005\u3002 \u8fd9\u6837\u7684\u597d\u5904\u5c31\u662f\u8026\u5408\u5ea6\u5927\u5927\u964d\u4f4e\uff0c\u6211\u4eec\u7684\u540e\u7aef\u670d\u52a1\u548c\u6d88\u8d39\u8005\u662f\u5b8c\u5168\u5206\u5f00\u7684\uff0c\u5c31\u7b97\u8981\u8fd9\u4e48\u73a9\uff0c\u6d88\u8d39\u8005\u4e5f\u4e0d\u4f1a\u7528 Python \u6765\u505a\u3002\u8fd9\u6837\u6211\u4eec\u5728\u540e\u7aef\u670d\u52a1\u4e0a\u7ebf\u7684\u65f6\u5019\u4e0d\u4f1a\u5f71\u54cd\u5230 \u6267\u884c\u7ed3\u679c \u3002 \u4e0d\u8fc7\u8fd9\u4e48\u505a\u5176\u5b9e\u589e\u52a0\u4e86\u6211\u4eec\u7cfb\u7edf\u7684\u590d\u6742\u5ea6\uff0c\u8fd9\u662f\u6211\u4e0d\u60f3\u8981\u7684\u3002 \u6211\u4eec\u8fd8\u662f\u5148\u89c2\u5bdf\u4e0bPython\u6279\u91cf\u6267\u884ccase\u7684\u6548\u7387\u5427\uff01 \u666e\u901a\u65b9\u5f0f \u5148\u7f16\u5199\u4e00\u4e2a \u540c\u6b65\u7248\u672c \u7684\u6279\u91cf\u8fd0\u884c\u65b9\u6cd5\u3002 \u7531\u4e8e\u6211\u7684 run \u65b9\u6cd5\u5df2\u7ecf\u88ab\u6539\u9020\u4e3a\u5f02\u6b65\u65b9\u6cd5\u4e86\uff0c\u6240\u4ee5\u8fd9\u8fb9\u5199\u6cd5\u662f\u8fd9\u4e48\u5199\uff0c\u4f46\u5176\u5b9e\u8fd8\u662f \u540c\u6b65 \u7684\u6267\u884c\u8fc7\u7a0b\u3002 \u4ee3\u7801\u5f88\u7b80\u5355\uff0c\u6211\u4eec\u901a\u8fc7 \u5faa\u73af \u6267\u884c\u6bcf\u4e2acase\uff0c\u7136\u540e\u628a\u7ed3\u679c\u5199\u5230data\u5b57\u5178\u91cc\u9762\uff0c\u6700\u540e\u8f93\u51fa\u5177\u4f53\u7684 \u8017\u65f6 \uff08\u53ea\u662f\u6d4b\u8bd5\u7528\uff09\u3002 \u53ef\u4ee5\u770b\u5230\uff0c\u5728\u672c\u5730\u6570\u636e\u5e93+\u6211\u7684\u9ad8\u914d\u7f6e\u673a\u5668\u52a0\u6301\u4e0b\u8fd8\u662f\u9700\u898130\u591a\u79d2\u6267\u884c100\u6765\u4e2a\u7528\u4f8b\u3002\u5176\u5b9e \u5df2\u7ecf\u80fd\u591f\u63a5\u53d7 \u4e86\uff0c\u4f46\u662f\u540e\u7eed\u6570\u91cf\u66f4\u5927\u7684\u8bdd\uff0c\u600e\u4e48\u529e\uff01\u54b1\u4eec\u76f4\u63a5\u4e00\u6b65\u5230\u4f4d\uff0c\u5f00\u59cb\u6539\u9020\u3002 \u4e0d\u53ea\u662fhttp\u6709\u5f02\u6b65\u5e93 \u5176\u5b9emysql\u4e5f\u6709\u4e2a\u5f02\u6b65\u5e93: aiomysql\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u5148\u5b89\u88c5\u4f9d\u8d56: pip3 install aiomysql \u8fd9\u4e2a\u5e93\u53ef\u4ee5\u5d4c\u5165\u5230sqlalchemy\uff0c\u56e0\u4e3asqlalchemy1.4\u4ee5\u4e0a\u5df2\u7ecf\u652f\u6301\u4e86asyncio\uff08\u6211\u4e2a\u4eba\u8ba4\u4e3a\u8fd9\u662f\u4e00\u4e2a\u5927\u7684\u8d8b\u52bf\uff0c \u80fd\u5feb\u4e3a\u5565\u8981\u6162 \u5462\uff1f\u5982\u679cPython\u6709\u5f88\u5feb\u7684\u901f\u5ea6+\u6781\u9ad8\u7684\u5f00\u53d1\u6548\u7387\uff0c\u4e0d\u8bf4\u5927\u578b\u4e1a\u52a1\u670d\u52a1\uff0c\u8d77\u7801\u6d4b\u8bd5\u5e73\u53f0\u7684\u5e02\u573a\u662f\u53ef\u4ee5\u62ff\u634f\u7684\u56db\u6b7b\u7684\uff01\uff09 \u53ef\u80fd\u56e0\u4e3a\u6211\u6700\u8fd1Java\u5199\u7684\u6bd4\u8f83\u591a\uff0c\u5904\u7406\u5d4c\u5957\u5f88\u6df1\u7684JSON\uff0c\u9700\u8981\u5b9a\u4e49\u5404\u79cdclass\uff0c\u8981\u4e0d\u5c31\u662f\u5404\u79cd\u8f6c\u6362\u7c7b\u578b\uff0c\u96be\u53d7\u554a\u3002 config.py\u65b0\u589e\u5f02\u6b65SQLALCHEMY_URI ASYNC_SQLALCHEMY_URI = f'mysql+aiomysql:// {MYSQL_USER} : {MYSQL_PWD} @ {MYSQL_HOST} : {MYSQL_PORT} / {DBNAME} ' \u65b0\u589e\u5f02\u6b65session\u548c\u5f02\u6b65engine \u6539\u9020\u540c\u6b65\u65b9\u6cd5\u4e3a\u5f02\u6b65\uff0c\u4ee5\u83b7\u53d6\u6d4b\u8bd5\u7528\u4f8b\u65b9\u6cd5\u4e3a\u4f8b \u5176\u5b9e\u548c\u540c\u6b65\u7684\u533a\u522b\u4e5f\u5c314\u4e2a\u5730\u65b9 \u9700\u8981\u6539\u4e3aasync\u65b9\u6cd5 with\u8bed\u53e5\u8981\u6539\u4e3aasync with select(\u8868).where(\u6761\u4ef6)\uff0c\u9700\u8981\u7528async_session.execute\u8c03\u7528 \u62ff\u6570\u636e\u7528result.scalars.first()\u6216\u8005all()\u90fd\u53ef\u4ee5\uff0c\u548c\u4ee5\u524d\u51e0\u4e4e\u4e00\u6837 \u6539\u9020\u5b8c\u4e86\u4e4b\u540e\u8bb0\u5f97\u5728\u8c03\u7528\u5b83\u7684\u5730\u65b9\u4e5f\u6539\u5199\u4e00\u4e0b \u6539\u9020\u4e4b\u540e \u5f02\u6b65\u548c\u540c\u6b65\u7684\u5173\u952e\u5c31\u662fgather \u867d\u7136\u6ca1\u5feb\u592a\u591a\uff0c\u4f46\u662f\u4e5f\u662f\u6709\u660e\u663e\u8fdb\u6b65\u7684\uff0c\u6211\u5df2\u7ecf\u628a case\u8fd0\u884c\u7684\u65b9\u6cd5 \u91cc\u9762\u7684db\u64cd\u4f5c\u5168\u90e8\u6539\u4e3a\u4e86\u5f02\u6b65\u3002 \u5feb\u4e8620\u79d2\u5de6\u53f3 \u4e0d\u5f97\u4e0d\u611f\u53f9\uff0cfastapi\u8fd8\u662f\u5feb\u7684\u5440\uff01 \u5177\u4f53\u7684\u7ec6\u8282\u53ef\u4ee5\u53c2\u770b\u6211\u7684\u9879\u76ee: https://github.com/wuranxu/pity\u3002\u70b9\u51fb \u9605\u8bfb\u539f\u6587 \u53ef\u4ee5\u770b\u5230\u6574\u4e2a\u6587\u7ae0\u54e6\uff01","title":"46.\u7528\u4f8b\u5e76\u53d1\u4e4b\u6211\u5168\u90fd\u8981"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2847%29%20%E7%BC%96%E5%86%99%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A%E4%B9%8B%E6%9E%84%E5%BB%BA%E8%AE%B0%E5%BD%95/","text":"\u5927\u5bb6\u597d\uff0c\u6211\u662f\u7c73\u6d1b\uff0c\u6c42\u4e09\u8fde\uff01\u6c42\u5173\u6ce8 \u6d4b\u8bd5\u5f00\u53d1\u5751\u8d27 ! \u5982\u679c\u9605\u8bfb\u5b8c\u6bd5\u540e\u60f3\u548c\u4f5c\u8005\u6709\u66f4\u591a\u4ea4\u6d41\uff0c\u53ef\u4ee5\u70b9\u51fb \u9605\u8bfb\u539f\u6587 \u627e\u5230\u5e95\u90e8\u8bc4\u8bba\u533a\uff0c\u7ed9\u4f5c\u8005\u7559\u8a00\u5566\uff01 \u9879\u76ee\u5730\u5740: https://pity.readthedocs.io/ \ud83d\udcd9 \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u8bf4\u5230\u4e86\u53bb \u5e76\u53d1\u6267\u884c \u7528\u4f8b\uff0c\u6211\u4eec\u63d0\u4f9b\u4e86\u4e00\u4e2aasync\u7684\u63a5\u53e3\uff0c\u5229\u7528asyncio\u8fbe\u5230\u4e86\u63d0\u5347\u7528\u4f8b\u6267\u884c\u901f\u5ea6\u7684\u4f5c\u7528\u3002 \u4eca\u5929\u6211\u4eec\u5c31\u6765\u5b8c\u5584\u6211\u4eec\u7684 \u6d4b\u8bd5\u62a5\u544a \u76f8\u5173\u7684\u529f\u80fd\u3002 \ud83d\udcd9 \u660e\u786e\u76ee\u6807 \u76ee\u524d\u5bf9\u6211\u4eec\u6765\u8bf4\uff1a \u6700\u5173\u952e\u7684 \u5c31\u662f \u7528\u4f8b\u53ef\u4ee5\u6279\u91cf\u6267\u884c \u3002\u4e0a\u4e00\u6b65\u6211\u4eec\u5df2\u7ecf\u5b8c\u5584\u4e86\uff0c\u90a3\u7528\u4f8b\u53ef\u4e0d\u80fd\u53ea\u6267\u884c\u4e0d\u8f93\u51fa\u3002\u6240\u4ee5\u6211\u4eec\u4eca\u5929\u641e\u5b9a\u5b83\uff01 tips: \u6700\u8fd1\u867d\u7136\u6ca1\u66f4\u6587\uff0c\u4f46\u662f\u4ee3\u7801\u5199\u7684\u8fdb\u6b65\u6bd4\u8f83\u8d85\u524d\u4e86\uff0c\u6211\u4e5f\u6709\u70b9 \u4e0d\u592a\u9002\u5e94 \u73b0\u5728\u7684\u6a21\u5f0f\u3002 \u6211\u4eec\u628a\u6bcf\u6b21\u7528\u6237\u7684 \u6267\u884c \uff0c\u7b97\u4f5c\u4e00\u6b21\u6784\u5efa\uff0c\u4eca\u5929\u8981\u505a\u7684\u5c31\u662f\u751f\u6210\u8fd9\u6837\u7684\u6784\u5efa\u6570\u636e\u3002 \ud83d\udcd9 \u7ad9\u5728\u5de8\u4eba\u7684\u80a9\u8180\u4e0a \u4ee5 jenkins \u4e3a\u4f8b\uff0c\u5b83\u7684\u6bcf\u4e00\u6b21\u89e6\u53d1\u90fd\u4f1a\u751f\u6210\u4e00\u4e2a \u6784\u5efa\u8bb0\u5f55 \u3002 \u6211\u4eec\u6709\u597d\u7684\u4ea7\u54c1\u53bb\u5bf9\u6bd4\u5b66\u4e60\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u4f1a\u5c11\u8d70\u5f88\u591a \u5f2f\u8def \u3002 \u4ee5\u4e0a\u56fe\u4e3a\u4f8b\uff0cjenkins\u6784\u5efa\u7684\u8bb0\u5f55\u90fd\u5728\u8fd9\u91cc\u8fdb\u884c\u5c55\u793a\uff0c\u5927\u5bb6\u53ef\u4ee5\u641c\u7d22\u4e5f\u53ef\u4ee5\u770b\u5230\u5177\u4f53\u7684 \u6267\u884c\u65f6\u95f4 \uff0c\u6700\u91cd\u8981\u7684\u662f\u6211\u4eec\u77e5\u9053\u6267\u884c\u7684 \u7ed3\u679c \u3002(\u7ea2\u8272\u4ee3\u8868\u5931\u8d25\u4e86) \ud83d\udcd9 \u8868\u8bbe\u8ba1 \u8868\u8bbe\u8ba1\u662f\u4e2a\u8001\u8bdd\u9898\u4e86\uff0c\u6211\u4eec\u8fd8\u662f\u62c6\u52063\u4e2a\u6a21\u5757: \u901a\u7528\u5b57\u6bb5(\u5305\u62ec\u4e3b\u952e\uff0c\u521b\u5efa\u66f4\u65b0\u65f6\u95f4\uff0c\u521b\u5efa\u4eba\u66f4\u65b0\u4eba\u7b49) \u4e1a\u52a1\u5b57\u6bb5 \u9884\u7559\u5b57\u6bb5 class PityReport (Base) : __tablename__ = 'pity_report' id = Column(INT, primary_key= True ) # \u6267\u884c\u4eba 0\u5219\u4e3aCPU executor = Column(INT, index= True ) # \u73af\u5883 env = Column(INT, nullable= False ) # \u82b1\u8d39\u65f6\u95f4 cost = Column(String( 8 )) # \u6d4b\u8bd5\u96c6\u5408id\uff0c\u9884\u7559\u5b57\u6bb5 plan_id = Column(INT, index= True , nullable= True ) # \u5f00\u59cb\u65f6\u95f4 start_at = Column(DATETIME, nullable= False ) # \u7ed3\u675f\u65f6\u95f4 finished_at = Column(DATETIME) # \u6210\u529f\u6570\u91cf success_count = Column(INT, nullable= False , default= 0 ) error_count = Column(INT, nullable= False , default= 0 ) failed_count = Column(INT, nullable= False , default= 0 ) skipped_count = Column(INT, nullable= False , default= 0 ) # \u6267\u884c\u72b6\u6001 status = Column(SMALLINT, nullable= False , comment= \"0: pending, 1: running, 2: stopped, 3: finished\" , index= True ) # case\u6267\u884c\u6a21\u5f0f mode = Column(SMALLINT, default= 0 , comment= \"0: \u624b\u52a8, 1: \u81ea\u52a8, 2: \u6d4b\u8bd5\u96c6, 3: pipeline, 4: \u5176\u4ed6\" ) deleted_at = Column(DATETIME, index= True ) def __init__ (self, executor: int, env: int, success_count: int = 0 , failed_count: int = 0 , error_count: int = 0 , skipped_count: int = 0 , status: int = 0 , mode: int = 0 , plan_id: int = None, finished_at: datetime = None, cost=None) : self.executor = executor self.env = env self.start_at = datetime.now() self.success_count = success_count self.cost = cost self.failed_count = failed_count self.error_count = error_count self.skipped_count = skipped_count self.status = status self.mode = mode self.status = status self.plan_id = plan_id self.finished_at = finished_at self.deleted_at = None \u8868\u91cc\u9762\u6ce8\u91ca\u90fd\u5199\u7684\u5f88\u6e05\u695a\uff0c\u6211\u4eec\u6765\u7b80\u5355\u8bf4\u4e0b\u3002 executor \u672c\u6b21\u6784\u5efa\u89e6\u53d1\u4eba\uff0c\u53ef\u80fd\u662f\u4eba\u6216\u8005\u7cfb\u7edf\uff08system\uff09\uff0c\u8fd9\u91cc\u6211\u53eb\u505aCPU\u3002 env \u6784\u5efa\u6267\u884c\u7684\u73af\u5883\uff0c\u4e0e\u73af\u5883\u8868\u5bf9\u5e94\u3002 \u5176\u4ed6\u7684\u5305\u62ec\uff0c\u6267\u884c\u8017\u65f6\uff0c\u6267\u884c\u6210\u529f\u5931\u8d25\u7b49\u6570\u91cf\uff0c\u5f00\u59cb/\u7ed3\u675f\u65f6\u95f4\uff0c\u6267\u884c\u6a21\u5f0f\u5927\u5bb6\u5e94\u8be5\u90fd\u6bd4\u8f83\u6e05\u695a\u3002 \ud83d\udcd9 \u62a5\u544a\u8868\u7684\u4e0d\u540c\u4e4b\u5904 \u62a5\u544a\u8868\u548c\u5176\u4ed6\u6570\u636e\u4e0d\u4e00\u6837\u7684\u5730\u65b9\u5728\u4e8e\uff0c\u6211\u4eec\u7684 \u6d41\u7a0b \u4e0d\u4e00\u6837\u3002\u4e00\u6b21\u62a5\u544a\u5f88\u53ef\u80fd\u662f\u5148\u8bfb\u5230\u4e00\u90e8\u5206\u6570\u636e\uff1a \u6bd4\u5982\u6267\u884c\u4eba\uff0c\u5f00\u59cb\u65f6\u95f4\u7b49\u7b49\u3002\u5230\u6784\u5efa\u5b8c\u6210\u4e86\u4ee5\u540e\uff0c\u6211\u4eec\u624d\u80fd\u62ff\u5230\u5269\u4e0b\u7684\u6570\u636e\u3002\u6700\u540e\uff0c\u6211\u4eec\u6ca1\u6709 \u624b\u52a8\u6dfb\u52a0 \u62a5\u544a\u8fd9\u6837\u7684\u8bc9\u6c42\uff0c\u6240\u4ee5\u6211\u4eec \u65b0\u589e\u62a5\u544a \u7684\u65f6\u5019\u8981\u62c6\u5206\u4e3a2\u4e2a\u65b9\u6cd5\u3002 \u68b3\u7406\u4e00\u4e0b\u6574\u4e2a\u8fc7\u7a0b\uff0cinsert\u62ff\u5230report_id\uff0c\u5e76\u8bb0\u5f55\u5f00\u59cb/\u6267\u884c\u4eba\u76f8\u5173\u4fe1\u606f\uff0c\u7528\u4f8b\u98de\u901f\u8fd0\u884c\uff0c\u7ed3\u675f\u540e\u628a\u641c\u96c6\u7684\u6570\u636e\u5199\u56de\u5230report_id\u8fd9\u6761\u6570\u636e\u3002 \ud83c\udf66 start\u65b9\u6cd5 dao/test_case/TestReport.py \u65b0\u5efa\u8fd9\u6837\u7684\u6570\u636e\uff0c\u5229\u7528 aiomysql \u8fdb\u884c\u5f02\u6b65\u64cd\u4f5c\u3002\u628a\u6838\u5fc3\u6570\u636e\u4f20\u5165: \u73af\u5883 \uff0c \u6267\u884c\u4eba \uff0c \u6a21\u5f0f \u3002\u56e0\u4e3a\u6211\u4eec\u8fd9\u91cc\u76ee\u524d\u8fd8\u53ea\u652f\u6301\u624b\u52a8\u6267\u884c\uff0c\u6240\u4ee5mode\u4e00\u822c\u5199\u6b7b\u4e3a 0 \u3002 \u5176\u5b9e\u4ee3\u7801\u6ca1\u5565\u96be\u5ea6\uff0c\u7406\u89e3\u5c31\u597d\u3002\u7b80\u5355\u7684\u8bf4\u5c31\u662f\u65b0\u63d2\u5165\u4e00\u6761\u6570\u636e\uff0c\u4f46\u662f\u4e0d\u662f \u5b8c\u6574 \u7684\u6570\u636e\u3002 \ud83d\udcd9 update\u65b9\u6cd5 \u5728\u6267\u884c\u8fc7\u7a0b\u4e2d\uff0c\u53ef\u80fd\u9700\u8981\u4fee\u6539\u6784\u5efa\u7684\u72b6\u6001\u3002\u6bd4\u5982\u6211\u4eec\u6784\u5efa\u5982\u679c\u88ab\u7528\u6237 \u624b\u52a8\u505c\u6b62 \u4e86\uff0c\u6211\u4eec\u9700\u8981\u628a\u62a5\u544a\u72b6\u6001\u6539\u4e3a \u5df2\u505c\u6b62 \uff0c\u6240\u4ee5\u8fd9\u8fb9\u6709\u4e2aupdate\u7684\u65b9\u6cd5\uff0c\u4e00\u822c\u662f\u7528\u6765\u4fee\u6539\u72b6\u6001\u7684\u3002\u5982\u679c\u540e\u7eed\u8fd8\u6709\u5176\u4ed6\u7684\u6570\u636e\u8981\u4fee\u6539\uff0c\u4e5f\u53ef\u4ee5 \u8c03\u6574\u4e00\u4e0b\u8fd9\u4e2a\u65b9\u6cd5 \u3002 \ud83c\udf66 end\u65b9\u6cd5 \u5f53\u7528\u4f8b\u7ed3\u675f\u4e4b\u540e\uff0c\u6211\u4eec\u628a\u641c\u96c6\u5230\u7684\u6240\u6709\u6570\u636e\u90fd\u56de\u5199\u5230\u8fd9\u6761\u6570\u636e\u4e2d\u3002\u5229\u7528mysql\u4e3b\u952e\u7684\u7279\u6027\uff0c\u4fdd\u8bc1\u6211\u4eec\u6bcf\u6b21\u65b0\u589e\u7684id\u90fd\u662f\u552f\u4e00\u7684\uff0c\u6240\u4ee5\u6570\u636e \u5e76\u4e0d\u4f1a\u4e32 \u3002 \ud83d\udcd9 \u65b0\u589e\u5e76\u53d1\u6267\u884c\u7528\u4f8b\u65b9\u6cd5 \u65b0\u589erun_multiple\u65b9\u6cd5 \u63a5\u53e3\u5b9e\u73b0 \u5728Executor\u7c7b\u4e0b\u9762\u7f16\u5199\u9759\u6001\u65b9\u6cd5: run_multiple \u3002 \u5177\u4f53\u7684\u5e76\u53d1\u8fc7\u7a0b\u548c\u4e4b\u524d\u5dee\u4e0d\u591a\uff0c\u6ce8\u91ca\u5df2\u7ecf\u5199\u7684\u5f88\u6e05\u695a\u4e86\uff0c\u4ecestep1\u5230step5.\u5176\u4ed6\u65e0\u975e\u662f\u4e00\u4e9b\u83b7\u53d6\u7528\u4f8b \u6267\u884c\u6570\u636e \u7684\u4fe1\u606f\u3002 \u6700\u540e\u4e3a\u5565\u9700\u8981\u8fd4\u56dereport_id\u5462\uff0c\u56e0\u4e3a\u524d\u7aef\u9875\u9762\u901a\u8fc7report_id\u53ef\u81ea\u52a8\u5230\u8fbe\u62a5\u544a\u9875\u9762\u3002 \u60f3\u8c61\u4e00\u4e0b: \u524d\u7aef\u901a\u8fc7\u8bbf\u95ee: /report/4 \u5c31\u53ef\u4ee5\u62ff\u5230\u5bf9\u5e94\u62a5\u544a\u7684\u6570\u636e\uff0c\u90a3\u5c31\u6253\u901a\u4e86\u6574\u4e2a\u6267\u884c->\u62a5\u544a\u7684\u8fc7\u7a0b\uff0c\u867d\u7136\u76ee\u524d\u8fd8\u6ca1\u6709 \u81ea\u52a8\u6267\u884c\u90a3\u4e00\u6b65 \u3002 \u4eca\u5929\u7684\u5185\u5bb9\u5c31\u5230\u8fd9\u91cc\u7ed3\u675f\u4e86\uff0c\u4e0b\u4e00\u7bc7\u8bb2\u7f16\u5199\u6784\u5efa\u5386\u53f2\u9875\u9762\uff0c\u7c7b\u4f3c\u4e8ejenkins \u5de6\u4fa7\u6784\u5efa\u8bb0\u5f55 \u3002","title":"47.\u7f16\u5199\u6d4b\u8bd5\u62a5\u544a\u4e4b\u6784\u5efa\u8bb0\u5f55"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2848%29%20%E7%BC%96%E5%86%99%E6%9E%84%E5%BB%BA%E5%8E%86%E5%8F%B2%E9%A1%B5%E9%9D%A2/","text":"\u5927\u5bb6\u597d\uff0c\u6211\u662f\u7c73\u6d1b\uff0c\u6c42\u4e09\u8fde\uff01\u6c42\u5173\u6ce8 \u6d4b\u8bd5\u5f00\u53d1\u5751\u8d27 ! \u5982\u679c\u9605\u8bfb\u5b8c\u6bd5\u540e\u60f3\u548c\u4f5c\u8005\u6709\u66f4\u591a\u4ea4\u6d41\uff0c\u53ef\u4ee5\u70b9\u51fb \u9605\u8bfb\u539f\u6587 \u627e\u5230\u5e95\u90e8\u8bc4\u8bba\u533a\uff0c\u7ed9\u4f5c\u8005\u7559\u8a00\u5566\uff01 \u9879\u76ee\u5730\u5740: https://pity.readthedocs.io/ \ud83d\udcd2 \u56de\u987e \u5176\u5b9e\u6211\u4e0d\u7528\u56de\u987e\u5566\uff0c\u6211\u4e0a\u7bc7\u8bb2\u7684\u662f\u600e\u4e48\u751f\u6210 \u6784\u5efa\u6570\u636e \uff0c\u6bd5\u7adf\u6211\u662f\u8fde\u7eed\u5199\u4f5c\ud83d\ude01\u3002 \ud83d\udcd2 \u7f16\u5199\u83b7\u53d6/\u67e5\u8be2\u62a5\u544a\u63a5\u53e3 \u62a5\u544a\u7684\u6570\u636e\u662f\u6709\u4e86\uff0c\u6211\u4eec\u601d\u8003\u4e00\u4e0b\u6211\u4eec\u9700\u8981\u600e\u4e48\u53bb\u67e5\u627e\u5230\u6211\u4eec\u60f3\u8981\u7684\u90a3\u6b21 \u6784\u5efa\u8bb0\u5f55 \u3002 \u65f6\u95f4\u7ef4\u5ea6 \u6bd4\u5982\u6211\u60f3\u67e5\u627e\u8fd92\u5929\u7684\u3002 \u6267\u884c\u4eba\u7ef4\u5ea6 \u6211\u60f3\u67e5\u521a\u624d\u56e2\u961f\u91cc\u9762xxx\u6267\u884c\u7684\u8fc7\u7684\u6570\u636e\u3002 \u6d4b\u8bd5\u8ba1\u5212\u7ea7\u522b\uff08\u8fd9\u91cc\u8fd8\u6ca1\u652f\u6301\u5440\uff0c\u56e0\u4e3a\u8fd8\u53ea\u662f\u624b\u52a8\uff09 \u6211\u60f3\u77e5\u9053\u6211\u8fd9\u4e2a\u6d4b\u8bd5\u8ba1\u5212\u8dd1\u7684\u548b\u6837\u4e86\uff0c\u6211\u53ea \u76ef\u7740\u4ed6 \u770b\u3002 \u7b49\u7b49\u7b49\u7b49\uff0c\u6709\u9700\u8981\u53ef\u4ee5\u7ee7\u7eed\u52a0 \u6211\u8fd9\u91cc\u652f\u6301\u4e862\u4e2a\u7ef4\u5ea6\uff0c\u65f6\u95f4\u548c\u6267\u884c\u4eba \u8fd9\u5f02\u6b65\u5199\u8d77\u6765\u4e5f\u6162\u6162\u5f00\u59cb \u987a\u624b \u4e86\uff0c\u4e0d\u8fc7\u56e0\u4e3asqlalchemy\u8fd8\u4e0d\u592a\u652f\u6301\u8fd9\u5757\u3002\u6211\u67e5\u8be2\u4e86\u5f88\u4e45\u4e5f\u6ca1\u627e\u5230\u597d\u7684 \u5206\u9875\u67e5\u8be2 \u65b9\u5f0f\u3002\u53ea\u80fd\u7528\u4e86\u571f\u65b9\u6cd5\u4e86: \u6839\u636e\u6761\u4ef6\u67e5\u8be2\u6570\u91cf \u6839\u636e\u6761\u4ef6\u5206\u9875\u67e5\u8be2 \u8fd4\u56de2\u4e2a\u53c2\u6570\uff0c\u5206\u522b\u662f\u5177\u4f53\u7684\u6570\u636e\u548c\u603b\u7684\u67e5\u8be2\u6570\u91cf\uff0c\u8fd9\u4e2a\u6784\u5efa\u8bb0\u5f55\u6bd4\u8f83\u5927\uff0c\u505a\u5206\u9875\u4f1a\u6bd4\u8f83\u5408\u9002\u3002\u800c\u4e14\u65f6\u95f4\u53c2\u6570\u662f \u5fc5\u4f20 \uff0c\u8fd9\u91cc\u5982\u679c\u505a\u597d\u4e00\u70b9\u53ef\u4ee5\u663e\u793a\u65f6\u95f4\u8303\u56f4\uff0c\u6bd4\u5982\u53ea\u80fd\u67e5\u8be2 1\u4e2a\u6708 \u4e4b\u5185\u7684\u6570\u636e\uff0c\u4e0d\u7136\u6570\u636e\u591a\u4e86\u4f1a \u5fd2\u6162 \u3002 \u63a5\u7740\u5c31\u662f\u7f16\u5199report/list\u63a5\u53e3\u4e86 \ud83d\udcd2 \u804a\u804a\u524d\u7aef \u5176\u5b9e\u524d\u7aef\u5c31\u662f\u4e2a\u5f88\u7b80\u5355\u7684 \u67e5\u8be2\u64cd\u4f5c \uff0c\u7ecf\u8fc7\u8fd9\u4e48\u591a\u5e74\u6211\u5b9e\u8df5\u6211\u662f\u53d1\u73b0\uff0c\u524d\u7aef\u96be\u5728\u8bbe\u8ba1\u548c\u6837\u5f0f\u4e0a\uff0c\u903b\u8f91\u5904\u7406\u5e76\u4e0d\u590d\u6742\u3002\u6240\u4ee5\u6211\u8fd8\u662f\u89c9\u5f97\u5927\u5bb6\u80fd\u7528\u8fd9\u79cd \u73b0\u6210 \u7684UI\u7ec4\u4ef6\u5c31\u7528\uff0c\u4e0d\u7136\u5199\u539f\u751f\u7684 \u53c8\u4e0d\u597d\u770b\u53c8\u9ebb\u70e6 \u3002 \u62a5\u544a\u5217\u8868\u9875\u9762\u6574\u4f53\u957f\u8fd9\u6837 \u5177\u4f53\u6570\u636e\u9875\u9762 \u6784\u5efaid\u5de6\u8fb9\u7684\u2714\u548c\u2716\u662f\u7c7b\u4f3cjenkins\u7684 \u6210\u529f \u8fd8\u662f \u5931\u8d25 \u7684\u72b6\u6001\u3002 \u7136\u540e\u4e0a\u65b9\u5c31\u662f \u62a5\u544a\u67e5\u8be2\u7ef4\u5ea6 \u4e86\uff0c\u5e76\u4e0d\u7b97\u96be\u3002 \u4eca\u5929\u7684\u5185\u5bb9\u5c31\u5230\u8fd9\u91cc\u5427\uff0c\u5927\u5bb6\u53ef\u80fd\u4e5f\u53d1\u73b0\u4e86\u3002\u6211\u4eec\u8fd9\u53ea\u6709\u6c47\u603b\u7684\u6570\u636e\uff0c\u535a\u4e3b\u5e76\u6ca1\u6709\u5b58\u50a8 \u6bcf\u6761\u7528\u4f8b \u7684\u6267\u884c\u7ed3\u679c\uff0c\u90a3\u8fd9\u7b97\u4ec0\u4e48\u62a5\u544a\uff1f \u6ca1\u4e8b\u513f\uff0c\u4e0b\u4e00\u8282\u6211\u4eec\u5c31\u6765\u8bb2 \u5982\u4f55\u5199\u5165/\u83b7\u53d6case\u6267\u884c\u62a5\u544a \u3002 \u56fe\u4e2d\u5c31\u662f\u6700\u7ec8\u62a5\u544a\u6548\u679c\u56fe\u4e86","title":"48.\u7f16\u5199\u6784\u5efa\u5386\u53f2\u9875\u9762"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2849%29%20%E5%86%99%E5%85%A5%E8%AF%BB%E5%8F%96%E7%94%A8%E4%BE%8B%E6%89%A7%E8%A1%8C%E6%95%B0%E6%8D%AE/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u8fd9\u662f\u4e00\u4e2a\u5b8c\u6574\u7684 \u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0\u7cfb\u5217\u6559\u7a0b \uff0c\u5e0c\u671b\u80fd\u548c\u5927\u5bb6\u4e00\u8d77\u5b66\u4e60\uff0c\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u5e73\u53f0\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u6d4b\u8bd5\u5f00\u53d1\u5751\u8d27 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \u5982\u679c\u9605\u8bfb\u5b8c\u6bd5\u540e\u60f3\u548c\u4f5c\u8005\u6709\u66f4\u591a\u4ea4\u6d41\uff0c\u53ef\u4ee5\u70b9\u51fb \u9605\u8bfb\u539f\u6587 \u627e\u5230\u5e95\u90e8\u8bc4\u8bba\u533a\uff0c\u7ed9\u4f5c\u8005\u7559\u8a00\u5566\uff01 \u9879\u76ee\u5730\u5740: https://pity.readthedocs.io/ \ud83d\udcd2 \u56de\u987e \u4e0a\u4e00\u7bc7\u6211\u4eec\u5df2\u7ecf\u6210\u529f\u7f16\u5199\u4e86 \u67e5\u8be2\u62a5\u544a \u76f8\u5173\u7684\u63a5\u53e3\u3002\u63a5\u7740\u8ba9\u6211\u4eec\u6765\u770b\u5355\u4e2a\u7528\u4f8b\u5199\u5165/\u8bfb\u53d6\u7684\u7ec6\u5219\u3002 \ud83d\udcd2 \u8bbe\u8ba1\u6d4b\u8bd5\u7ed3\u679c\u8868 \u8001\u89c4\u77e9\uff0c\u6211\u4eec\u5148\u8bbe\u8ba1\u9700\u8981\u5199\u5165\u7684 \u6570\u636e\u8868 \u3002 \u8fd9\u91cc\u5148\u8bf4\u4e00\u4e2a\u9898\u5916\u8bdd\uff0c\u5176\u5b9e\u6211\u4eec\u9488\u5bf9\u4e00\u6b21\u63a5\u53e3\u6d4b\u8bd5\uff0c\u6700\u5173\u5fc3\u7684\u90e8\u5206\u662furl\uff0cmethod\uff0c\u8f93\u5165\u8f93\u51fa\u7b49\u90e8\u5206\u3002\u5176\u5b9e\u8fd9\u4e9b\u5185\u5bb9\u5728case\u8868\u91cc\u9762\u90fd\u6709\u6d89\u53ca\u5230\uff0c\u4f46\u56e0\u4e3a\u6211\u4eec\u652f\u6301\u4e86 \u53d8\u91cf\u5f62\u5f0f \u7684\u6570\u636e\uff0c\u6240\u4ee5case\u8868\u5b58\u653e\u7684\u53ef\u80fd\u53ea\u662f\u521d\u59cb\u503c\uff0c\u800c\u4e0d\u662f\u63a5\u53e3\u8bf7\u6c42\u65f6\u5019\u7684 \u5b9e\u9645\u503c \u3002\u6240\u4ee5\u6211\u4eec\u8fd9\u8fb9\u8bbe\u7f6e\u5b57\u6bb5\u7684\u65f6\u5019\u62ff\u5230\u6211\u4eec\u6700\u5173\u952e\u7684\u4fe1\u606f\u5373\u53ef\uff0c\u54ea\u6015\u5b58\u5728\u4e00\u5b9a\u7684 \u6570\u636e\u5197\u4f59 (\u6307\u7684\u662fcase\u8868\u6709\u7684\u6570\u636e\uff0c\u6d4b\u8bd5\u7ed3\u679c\u8868\u4e5f\u6709)\u3002 \u81f3\u4e8e\u7528\u4f8b\u7b49\u7ea7\uff0c\u7528\u4f8b\u7684project_id\u8fd9\u4e9b\u4fe1\u606f\uff0c\u5b8c\u5168\u53ef\u4ee5\u8ba9 \u7528\u6237\u5728\u67e5\u770b\u7528\u4f8b\u7684\u65f6\u5019\u83b7\u53d6 \u3002 class PityTestResult (Base) : __tablename__ = 'pity_test_result' id = Column(INT, primary_key= True ) # \u62a5\u544aid report_id = Column(INT, index= True ) # case_id case_id = Column(INT, index= True ) # case_name case_name = Column(String( 32 )) status = Column(SMALLINT, comment= \"\u5bf9\u5e94\u72b6\u6001 0: \u6210\u529f 1: \u5931\u8d25 2: \u51fa\u9519 3: \u8df3\u8fc7\" ) # \u5f00\u59cb\u65f6\u95f4 start_at = Column(DATETIME, nullable= False ) # \u7ed3\u675f\u65f6\u95f4 finished_at = Column(DATETIME, nullable= False ) case_log = Column(TEXT) # \u91cd\u8bd5\u6b21\u6570\uff0c\u9884\u7559\u5b57\u6bb5 retry = Column(INT, default= 0 ) # http\u72b6\u6001\u7801 status_code = Column(INT) url = Column(TEXT, nullable= False ) body = Column(TEXT) request_method = Column(String( 12 ), nullable= True ) request_headers = Column(TEXT) cost = Column(String( 12 ), nullable= False ) asserts = Column(TEXT) response_headers = Column(TEXT) response = Column(TEXT) cookies = Column(TEXT) deleted_at = Column(DATETIME, index= True ) \u8fd9\u8fb9\u7684case_name\uff0crequest_method\u6570\u636e\u90fd\u662f\u5197\u4f59\u7684\uff0c\u4f46\u5e76\u4e0d\u4f1a\u592a\u591a\u3002\u56e0\u4e3a\u6211\u6ca1\u6709\u5fc5\u8981\u4e3a\u4e86\u83b7\u53d6 case_name \u518d\u53bb\u67e5\u8be2\u4e00\u6b21case\u8868\uff0c\u800c\u6211\u53c8\u4e0d\u5f97\u4e0d\u5728\u62a5\u544a\u4e2d\u663e\u793a \u7528\u4f8b\u540d\u79f0 \u3002 init\u65b9\u6cd5\u5982\u4e0b \ud83d\udcd2 \u7f16\u5199\u6838\u5fc3\u65b9\u6cd5 \ud83c\udf66 \u65b0\u589e\u6d4b\u8bd5\u7ed3\u679c \u9664\u4e86\u5f02\u6b65session\u5927\u5bb6\u53ef\u80fd\u4e0d\u592a\u719f\u6089\u4ee5\u5916\uff0c\u5176\u4ed6\u7684\u90fd\u5e94\u8be5\u5f88\u4e86\u89e3\u4e86 \u6838\u5fc3\u5c31\u662f\u65b0\u5efaResult\u5bf9\u8c61\uff0csession.add(\u65b0\u5bf9\u8c61)\u63d2\u5165\u5230db\u3002 \ud83c\udf66 \u901a\u8fc7report_id\u67e5\u8be2\u6d4b\u8bd5\u7ed3\u679c \u6839\u636e\u5f00\u59cb\u6267\u884c\u65f6\u95f4\u6392\u5e8f \ud83c\udf66 \u8c03\u6574\u6267\u884c\u7528\u4f8b\u65b9\u6cd5: run_single \u5728\u7528\u4f8b\u6267\u884c\u5b8c\u6210\u540e\u641c\u96c6\u6570\u636e\u5e76\u63d2\u5165 \ud83d\udcd2 \u7f16\u5199\u83b7\u53d6\u5355\u4e2a\u62a5\u544a\u6570\u636e\u63a5\u53e3 \u8fd9\u8fb9\u62a5\u544a\u5206\u4e3a2\u4e2a\u90e8\u5206\uff0c1\u4e2a\u662f\u62a5\u544a\u7684\u5177\u4f53\u5185\u5bb9\u6bd4\u5982 \u6267\u884c\u73af\u5883 \uff0c \u6210\u529f\u6570\u91cf \u7b49\u7b49\u3002\u53e61\u4e2a\u90e8\u5206\u662f\u5177\u4f53\u6267\u884c\u7684case\u7ed3\u679c\u3002 \u5728TestReportDao\u4e2d\u65b0\u589equery\u65b9\u6cd5 \u6211\u4eec\u5148\u6839\u636ereport_id\u83b7\u53d6\u6267\u884c\u4fe1\u606f\uff08\u6784\u5efa\u5c42\uff09\uff0c\u518d\u6839\u636ereport_id\u67e5\u51fa\u6240\u6709\u6267\u884c\u7ed3\u679c\uff08\u7528\u4f8b\u5c42\uff09\uff0c\u6700\u540e\u8fd4\u56dereport\u6570\u636e\u548ctest_data\u3002 \ud83d\udcd2 \u8c03\u6574\u524d\u7aef\u9875\u9762 \u524d\u7aef\u6839\u636ereport\u663e\u793a\u4e0a\u534a\u90e8\u5206\uff0c\u6839\u636etest_data\u663e\u793a\u4e0b\u9762\u90e8\u5206\u6570\u636e \u4e0a\u9762\u53ef\u4ee5\u770b\u52303\u4e2acase\uff0c\u5171\u6210\u529f\u4e863\u4e2a\uff0c\u901a\u8fc7\u7387\u5927\u4e8e90%\u7684\u65f6\u5019\u4f1a\u88ab \u70b9\u4e2a\u8d5e \u3002 \u70b9\u51fb\u4e0b\u9762\u7684 \u66f4\u591a \u6309\u94ae\u53ef\u4ee5\u67e5\u770b\u5230\u5177\u4f53\u7684case\u6267\u884c\u7ec6\u8282: \u7528\u4f8b\u8be6\u60c5\uff0cget\u8bf7\u6c42\u65e0body \u65e5\u5fd7\u6570\u636e\uff0c\u53ef\u4ee5\u770b\u5230\u5177\u4f53\u66ff\u6362\u5185\u5bb9 \u6700\u540e\u751f\u6210\u4e86\u601d\u7ef4\u5bfc\u56fe\uff0c\u53ef\u4ee5\u770b\u5230\u5177\u4f53\u7684\u6267\u884c\u987a\u5e8f\u548c\u7528\u4f8b\u4f9d\u8d56\u5173\u7cfb\uff0c\u6211\u81ea\u5df1\u90fd\u89c9\u5f97\u5f88\u9177\uff01 \u591a\u7684\u4e0d\u8bf4\u4e86\uff0c \u70b9\u4e2a\u8d5e \u518d\u8d70\u5427~","title":"49.\u5199\u5165\u8bfb\u53d6\u7528\u4f8b\u6267\u884c\u6570\u636e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%285%29%20%E5%BC%95%E5%85%A5Ant%20design%20Pro/","text":"\u5f15\u5165Ant Design Pro \u56de\u987e \u8fd8\u662f\u7ee7\u7eed\u56de\u987e\u4e0b\u4e4b\u524d\u7684\u4f5c\u4e1a, \u8fd4\u56de\u7684\u4e2d\u6587\u53d8\u6210\u4e86ascii\u5b57\u7b26\uff0c\u4e0d\u8981\u7d27\uff0c\u6211\u4eec\u5149\u8363\u5730\u767e\u5ea6\u4e00\u54c8\u3002 \u968f\u4fbf\u70b9\u8fdb\u53bb\u770b\u770b\uff0c\u90fd\u53ef\u4ee5\u627e\u5230\u6b63\u786e\u7b54\u6848: \u53ef\u4ee5\u770b\u5230\uff0c\u6211\u4eec\u9700\u8981\u4fee\u6539config\u4e2d\u7684 JSON_AS_ASCII \u5b57\u6bb5\u4e3aFalse\u3002 \u4f46\u662f\u6211\u4eec\u672c\u8eab\u662f\u6ca1\u6709\u8fd9\u4e2a\u914d\u7f6e\u9879\u7684\uff0c\u6240\u4ee5\u76f4\u63a5\u7ed9\u52a0\u4e0a\u5c31\u597d\u4e86\u3002 pity/config.py import os class Config (object) : ROOT = os.path.dirname(os.path.abspath(__file__)) LOG_NAME = os.path.join(ROOT, 'logs' , 'pity.log' ) # Flask jsonify\u7f16\u7801\u95ee\u9898 JSON_AS_ASCII = False \u518d\u8bd5\u4e00\u4e0b\uff0c\u53ef\u4ee5\u53d1\u73b0\u95ee\u9898\u5b8c\u7f8e\u89e3\u51b3\u4e86\uff0c\u8fd9\u91cc\u7bc7\u5e45\u539f\u56e0\u5c31\u4e0d\u4e0a\u56fe\u4e86\u3002 \u524d\u8a00 \u5728\u5f00\u59cb\u4e4b\u524d\uff0c\u5e0c\u671b\u8bfb\u8005\u4eec\u5df2\u7ecf\u80fd\u591f\u638c\u63e1\u4e86\u4e00\u90e8\u5206 react \u7684\u77e5\u8bc6\uff0c\u8fd9\u91cc\u5047\u5b9a\u6211\u4eec\u5df2\u7ecf\u4e86\u89e3\u4e86react\uff0credux\u548cdva/umi\u76f8\u5173\u7684\u77e5\u8bc6\u3002\u5e76\u6709\u505a\u8fc7\u76f8\u5173\u7ec3\u4e60\u3002 \u5982\u679c\u8fd8\u4e0d\u4e86\u89e3\u4ee5\u4e0a\u76f8\u5173\u7684\u77e5\u8bc6\uff0c\u5efa\u8bae\u53bb\u4ee5\u4e0b\u7f51\u7ad9\u5b66\u4e60\u4e00\u904d\uff0c\u4e0b\u9762\u7ed9\u51fa\u4e00\u4e2a\u5927\u6982\u5b66\u4e60\u7684\u8def\u7ebf\u5427\u3002 html/css/js \u8fd9\u91cc\u63a8\u8350\u5927\u5bb6\u53bb w3cschool \u7a0d\u4f5c\u4e86\u89e3\uff0c\u4e0d\u8fc7\u770b\u672c\u7bc7\u6587\u7ae0\u7684\u540c\u5b66\u80af\u5b9a\u90fd\u662f\u6709\u4e00\u5b9a\u57fa\u7840\u7684\u3002\u90a3\u4e48\u5c31\u5f53\u505a\u5de9\u56fa\u597d\u4e86\u3002 es6 \u8fd9\u91cc\u6211\u6ca1\u6709\u7cfb\u7edf\u770b\u8fc7\u6559\u7a0b\uff0c\u6211\u662f\u5728\u4e00\u672c\u53eb\u505a react\u5b66\u4e60\u624b\u518c \u7684\u4e66\u4e0a\u9762\u770b\u5230\u7684\u3002\u8fd9\u91cc\u8fd8\u662f\u653e\u4e00\u4e0b\u5730\u5740\u5427\uff0c\u53ef\u4ee5\u53bb\u962e\u4e00\u5cf0\u8001\u5e08\u7684\u535a\u5ba2\u770b\uff0c\u4e5f\u53ef\u4ee5\u53bb \u8fd9\u91cc \u5b66\u4e60es6\u7684\u4e00\u4e9b\u65b0\u7279\u6027\u3002\u6bd4\u5982\u7bad\u5934\u51fd\u6570\uff0cpromise\uff0clet\u7b49\u3002 react+redux react\u7684\u8bdd\uff0c\u4e00\u5f00\u59cb\u6211\u51e0\u4e4e\u662f\u6ca1\u6709\u5165\u95e8\u3002\u62ff\u7740 react-element \u91cc\u7684demo\u5c31\u5f00\u59cb\u5b9e\u64cd\u4e86\uff0c\u9047\u5230\u4e86\u5404\u79cd\u5404\u6837\u7684\u95ee\u9898\u3002\u5728\u5bfb\u627esolution\u7684\u65f6\u5019\u9047\u5230\u4e86\u4e00\u672c\u540d\u66f0 react\u5c0f\u4e66 \u7684\u6559\u7a0b\uff0c\u89c9\u5f97\u5b9e\u5728\u662f\u518d\u5408\u9002\u4e0d\u8fc7\u4e86\u3002\u540c\u65f6\u91cc\u9762\u8fd8\u6709redux\u7684\u90e8\u5206\u6559\u7a0b(\u7b2c\u4e09\u90e8\u5206)\u3002 dva dva\u662f\u4e00\u4e2a\u5c01\u88c5\u4e86redux\u548crouter\u7b49\u65b9\u6cd5\u7684\u6846\u67b6\uff0c\u638c\u63e1\u4e86\u5b83\u7684api\uff0c\u53ef\u4ee5\u5feb\u901f\u5b8c\u6210react\u9879\u76ee\u7684\u5f00\u53d1\u3002\u5177\u4f53\u6559\u7a0b\u8fd8\u8bf7\u770b \u5b98\u7f51dvajs \u3002 Ant Design Pro\u4ecb\u7ecd Ant Design (\u7b80\u79f0antd)\uff0c\u5b83\u662f\u8682\u8681\u91d1\u670d\u7684\u524d\u7aef\u8bbe\u8ba1\u56e2\u961f\u51fa\u54c1\u7684\u4e00\u6b3eUI\u7ec4\u4ef6\u5e93\uff0c\u5982\u679c\u8981\u7c7b\u6bd4\u7684\u8bdd\uff0c\u6211\u4f1a\u628a\u4ed6\u6bd4\u4f5cbootstrap\uff0c\u4f46\u662f\u5b83\u53c8\u8fdc\u8fdc\u6bd4bootstrap\u597d\u770b\u4e14\u4ea4\u4e92\u6027\u66f4\u5f3a\u3002\u800cantd pro\uff0c\u5c31\u662f\u5b83\u7684\u4e13\u4e1a\u7248\u3002\u4e3a\u4ec0\u4e48\u5462\uff0c\u56e0\u4e3aantd pro\u5df2\u7ecf\u662f\u4e00\u4e2a\u5b8c\u6574\u7684\u4e2d\u540e\u53f0\u9879\u76ee\uff0c\u6211\u4eec\u5982\u679c\u9700\u8981\u5feb\u901f\u5f00\u53d1\u7684\u8bdd\uff0c\u76f4\u63a5\u62ff\u7740\u91cc\u9762\u7684\u9875\u9762\u4fee\u6539\u4fbf\u662f\u4e86\u3002\u4f46\u662f\u6211\u4e2a\u4eba\u603b\u7ed3\u4e86\u4e00\u4e0b\uff0c\u7f3a\u70b9\u4e5f\u5f88\u660e\u663e\uff0c\u5c31\u662f antd pro\u505a\u51fa\u6765\u7684\u7cfb\u7edf\u51e0\u4e4e\u90fd\u957f\u4e00\u4e2a\u6837\uff0c\u957f\u4e45\u4e86\u4f1a\u6709\u5ba1\u7f8e\u75b2\u52b3\uff0c\u81f3\u5c11\u6211\u5bf9bootstrap\u4e5f\u662f\u8fd9\u6837\u7684 \uff0c\u5f53\u7136\u8682\u8681\u51fa\u7684\u4e1c\u897f\u54c1\u8d28\u662f\u771f\u7684\u68d2\uff01 \u8bdd\u4e0d\u591a\u8bf4\uff0c\u5148\u770b\u770b\u5b83\u7684 \u9884\u89c8\u9875\u9762 \u3002 \u4ee5\u4e0b\u662f\u968f\u4fbf\u622a\u53d6\u7684\u51e0\u4e2a\u56fe\u7247\uff0c\u611f\u53d7\u4e00\u4e0b\u5b83\u7684\u7f8e\u3002 \u6761\u4ef6\u51c6\u5907 \u786e\u4fdd\u4f60\u5b89\u88c5\u4e86 Nodejs \uff0c\u8fd9\u6837\u4f60\u5c31\u62e5\u6709\u5f3a\u5927\u7684\u5305\u7ba1\u7406\u5de5\u5177 Npm \u4f7f\u7528npm\u5b89\u88c5cnpm\uff0c\u56e0\u4e3a\u56fd\u5185\u6709\u5f88\u591a\u8d44\u6e90\u662f\u8bbf\u95ee\u53d7\u9650\u7684\uff0c\u6240\u4ee5\u9700\u8981\u6dd8\u5b9d\u5f00\u6e90\u7684cnpm\u3002 npm install -g cnpm --registry=https://registry.npm.taobao.org \u5b89\u88c5yarn cnpm install -g yarn \u5b89\u88c5 Umi cnpm install -g umi \u521b\u5efaantd pro\u9879\u76ee \u5148\u5728pity\u540c\u7ea7\u5efa\u7acbpityWeb\u9879\u76ee, \u7136\u540e\u8fdb\u5165pityWeb\u8f93\u5165\u5982\u4e0b\u547d\u4ee4, \u5f00\u59cb\u7b49\u5f85: yarn create umi \u9009\u62e9ant design pro\u5e76\u56de\u8f66 \u9009\u62e9pro v4\u5e76\u56de\u8f66 \u9009\u62e9JavaScript\u5e76\u56de\u8f66 \u9009\u62e9simple\u5e76\u56de\u8f66 \u9009\u62e9ant design 4\u5e76\u56de\u8f66 \u5b89\u88c5\u6210\u529f\u622a\u56fe \u5b89\u88c5antd pro\u4f9d\u8d56\u5305 \u8fdb\u5165 pityWeb \u76ee\u5f55\u6267\u884c\u547d\u4ee4 cnpm install \u5c1d\u8bd5\u5728\u672c\u5730\u8fd0\u884cantd pro \u5c1d\u8bd5\u5728\u672c\u5730\u8fd0\u884cantd pro \u5728 pityWeb \u76ee\u5f55\u4e0b\u8f93\u5165 npm start \u5e76\u56de\u8f66 \u63a5\u7740\u6d4f\u89c8\u5668\u5c31\u81ea\u52a8\u6253\u5f00\u4e86\u9875\u9762http://localhost:8000\uff08\u5982\u679c\u6ca1\u6709\u7684\u8bdd\u5c31\u624b\u52a8\u6253\u5f00\uff09\uff0c\u90a3\u4e48\u6211\u4eec\u7684antd pro\u5c31\u6210\u529f\u90e8\u7f72\u4e86\u3002 \u540e\u7aef\u4ee3\u7801\u5730\u5740: https://github.com/wuranxu/pity \u524d\u7aef\u4ee3\u7801\u5730\u5740: https://github.com/wuranxu/pityWeb \u89c9\u5f97\u6709\u7528\u7684\u8bdd\u53ef\u4ee5\u5e2e\u5fd9\u70b9\u4e2aStar\u54e6QAQ","title":"5.\u5f15\u5165Ant design Pro"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2850%29%20%E7%BC%96%E5%86%99%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E9%85%8D%E7%BD%AE%E5%8A%9F%E8%83%BD/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u8fd9\u662f\u4e00\u4e2a\u5b8c\u6574\u7684 \u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0\u7cfb\u5217\u6559\u7a0b \uff0c\u5e0c\u671b\u80fd\u548c\u5927\u5bb6\u4e00\u8d77\u5b66\u4e60\uff0c\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u5e73\u53f0\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u6d4b\u8bd5\u5f00\u53d1\u5751\u8d27 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \ud83d\udcd2 \u56de\u987e \u4e0a\u4e00\u7bc7\u6211\u4eec\u5df2\u7ecf \u57fa\u672c\u7ed3\u675f \u4e86\u5bf9\u6d4b\u8bd5\u62a5\u544a\u76f8\u5173\u7684\u5904\u7406\u5de5\u4f5c\uff0c\u5176\u5b9e\u535a\u4e3b\u6700\u8fd1\u5728\u8003\u8651\u600e\u4e48\u53bb\u4f18\u5316\u7528\u4f8b\u7f16\u5199/\u8fd0\u884c\u76f8\u5173\u7684\u5730\u65b9\uff0c\u56e0\u4e3a\u53d1\u73b0\u4e4b\u524d\u5199\u7684\u8fc7\u4e8e\u8fa3\u9e21\u4e86\uff0c\u7528\u4f8b\u8fd8\u662f\u4e0d\u80fd \u5b8c\u5168\u4f9d\u9644 \u4e8e\u9879\u76ee\uff0c\u5f97\u6709\u81ea\u5df1\u7684\u751f\u5b58\u4e4b\u9053\u5440\uff01 \u4e8e\u662f\u6211\u51b3\u5b9a\u628a \u9879\u76ee \u548c\u7528\u4f8b\u5728\u9875\u9762\u4e0a\u8fdb\u884c\u62c6\u5206\uff0c\u4f46\u662f\u4ecd\u7136\u4fdd\u6301\u6811\u7684\u5f62\u5f0f\u3002\u76ee\u524d\u8fd8\u6ca1\u6709\u60f3\u5230\u5f88\u597d\u7684UI\u5c55\u793a\u6548\u679c\uff0c\u60f3\u5230\u7684\u8bdd\u4e5f\u5f97\u5468\u672b\u82b1\u65f6\u95f4\u53bb\u505a\u4e86\uff0c\u6240\u4ee5\u6211\u4eec\u5148\u505a\u6570\u636e\u5e93\u76f8\u5173\u7684 \u6570\u636e\u6784\u9020\u5668 \u5de5\u4f5c\u3002 \ud83d\udcd2 \u4e3a\u4ec0\u4e48\u8981\u505a\u8fd9\u5757\uff1f \u6211\u4eec\u77e5\u9053\uff0c\u5728\u63a5\u53e3\u6d4b\u8bd5\u4e2d\uff0c\u7ecf\u5e38\u8981\u62ff\u6570\u636e\u5e93\u7684\u6570\u636e\u8fdb\u884c \u65ad\u8a00\u64cd\u4f5c \u6216\u8005 \u67e5\u8be2\u6570\u636e \uff0c\u53ef\u80fd\u6709\u4e00\u4e9b\u540c\u5b66\u4e0d\u4f1a\u53bbdb\u91cc\u9762\u8fdb\u884c\u6821\u9a8c\uff0c\u8fd9\u4e2a\u4e89\u8bae\u54b1\u4eec\u5148\u4e0d\u7ba1\uff0c\u4f46\u6211\u662f\u652f\u6301\u53bbdb\u91cc\u9762\u6821\u9a8c\u6570\u636e\u7684\u3002 \u90a3\u4e48\u64cd\u4f5cdb\uff0c\u5c31\u5f97\u6709db\u7684\u4e00\u4e9b\u8fde\u63a5\u4fe1\u606f\u3002\u56e0\u4e3a\u672c\u4eba\u4ece\u672a\u7528\u8fc7Oracle\uff0c\u6240\u4ee5\u5f88\u793c\u8c8c\u5730\u62d2\u7edd\u652f\u6301 Oracle \u3002 \u9009\u5b9a\u597d\u5e38\u89c1\u7684\u5173\u7cfb\u578b\u6570\u636e\u5e93: Mysql+Postgresql\u5373\u53ef\u3002\u6211\u4eec\u4e0d\u4f46\u6709sql\uff0c\u8fd8\u4f1a\u652f\u6301 Redis \u3002 \ud83d\udcd2 \u672c\u8282\u5185\u5bb9 \u8bbe\u8ba1\u597d\u6570\u636e\u8868\u5b58\u653e\u7684\u6838\u5fc3\u4fe1\u606f \u5b8c\u6210\u6570\u636e\u5e93\u914d\u7f6e\u7684 \u589e\u5220\u6539\u67e5 \u529f\u80fd \ud83c\udf66 \u8bbe\u8ba1\u6570\u636e\u5e93\u914d\u7f6e\u8868 \u9996\u5148\u7ed9\u5b83\u53d6\u4e2a\u540d\u5b57: pity_database_info \uff0c\u4e00\u76ee\u4e86\u7136\u53ef\u4ee5\u77e5\u9053\u5b83\u662f\u6570\u636e\u5e93\u914d\u7f6e\u76f8\u5173\u7684\u8868\u3002 id env sql_type (\u6570\u636e\u5e93\u7c7b\u578b, 0: mysql 1:postgres) name (\u6570\u636e\u5e93\u914d\u7f6e\u7684\u540d\u79f0\uff0c\u6bd4\u5982: \u8ba2\u5355\u8868) host port username password database create_user update_user created_at updated_at deleted_at \u57fa\u672c\u4e0a\u6211\u4eec\u901a\u8fc7host:port/database@username:password\u5c31\u53ef\u4ee5\u8fde\u63a5\u4e0a\u54b1\u4eec\u7684\u6570\u636e\u5e93\uff0c\u80fd\u8fde\u4e0a\u4e86\uff0c\u54b1\u4eec\u8fd8\u6015\u64cd\u4f5c\u4e0d\u4e86\u6570\u636e\u5e93\u5417\uff1f \u6700\u7ec8\u4ee3\u7801\u5982\u56fe\uff0c\u53ef\u4ee5\u770b\u5230\u5b57\u6bb5\u5b9a\u4e49\u4e00\u76ee\u4e86\u7136 \ud83d\udcd2 \u7f16\u5199DbConfigDao.py \u9996\u5148\u7f16\u5199 \u67e5\u8be2\u529f\u80fd \uff0c\u6211\u4eec\u53ef\u4ee5\u6839\u636e env\u73af\u5883 , name\u522b\u540d , database\u6570\u636e\u5e93\u540d 3\u4e2a\u7ef4\u5ea6\u6765\u67e5\u8be2\uff0c\u81f3\u4e8e\u540e\u7eed\u9700\u4e0d\u9700\u8981host\uff0c\u5f85\u5b9a\uff0c\u8981\u52a0\u4e5f\u5f88\u65b9\u4fbf\u3002 \u4ee3\u7801\u5982\u56fe\u6240\u793a \u6ce8\u610f\uff0c\u4e0d\u8bba\u662f\u6211\u4eec\u4ece Flask \u5207\u6362\u5230\u4e86 FastApi \uff0c\u8fd8\u662f\u6211\u4eec\u4ece\u540c\u6b65\u5207\u6362\u5230 \u5f02\u6b65 \uff0c\u786e\u5b9e\u90fd\u9700\u8981\u4e00\u4e2a\u8fc7\u7a0b\u3002\u4f46\u5927\u5bb6\u4e5f\u4e0d\u8981\u60ca\u614c\uff0c\u5176\u5b9e\u5bf9\u6211\u4eec\u6765\u8bf4\uff0c\u5f02\u6b65\u662f\u4e00\u4e2a \u63d0\u901f \u7684\u8fc7\u7a0b\u3002 \u91cd\u70b9\u662f\u638c\u63e1async/await\u7684\u5199\u6cd5\uff0c\u53bb\u6389\u8fd92\u4e2a\u5173\u952e\u5b57\u4e4b\u540e\uff0c\u6709\u6ca1\u6709\u53d1\u73b0\u5f02\u6b65\u548c\u540c\u6b65\u4ee3\u7801\u57fa\u672c\u4e00\u81f4\uff1f\u6240\u4ee5\uff0c\u6211\u4eec\u8981\u514b\u670d\u4e00\u4e0b\uff0c\u672a\u6765\u5f02\u6b65\u5fc5\u5b9a\u662f Python \u7684\u8d8b\u52bf\u3002 query\u662f\u54b1\u4eec\u7684\u67e5\u8be2\u6761\u4ef6\uff0c\u5f53name\u5b58\u5728\uff0c\u5c31\u4ee5\u5b83\u4e3a\u67e5\u8be2\u6761\u4ef6\u3002\u7b80\u5355\u89e3\u91ca\u4e0b: if name \u5728Python\u91cc\u9762\uff0c\u5982\u679cif\u540e\u7684\u5bf9\u8c61\u4e0d\u662fbool\u5bf9\u8c61\u7684\u8bdd\uff0c\u4f1a\u81ea\u52a8\u8fdb\u884c \u8f6c\u4e49 \uff0c\u5305\u62ecwhile\u4e5f\u662f\u3002 \u6bd4\u5982\u5927\u5bb6\u719f\u6089\u7684 while 1: ,\u4e4b\u6240\u4ee5\u80fd\u4e00\u76f4\u5faa\u73af\u4e0b\u53bb\uff0c\u662f\u56e0\u4e3a1\u88ab\u8f6c\u4e49\u4e3a\u4e86True\uff0c\u6548\u679c\u7b49\u540c\u4e8e while True: \uff0c\u8fd9\u6837\u5224\u65ad \u6bd4\u8f83\u7b80\u6d01 \uff0c\u4f46\u5b58\u5728\u4e00\u4e9b \u9677\u9631 \u3002 \u63a5\u7740\u8bf4\u8fd9\u4e2a\u529f\u80fd\uff0c\u9009\u62e9\u597d\u5bf9\u8c61\u7684\u67e5\u8be2\u6761\u4ef6\u4e86\u4e4b\u540e\uff0c\u6211\u4eec\u5c31\u8c03\u7528session.execute\u65b9\u6cd5\uff0c\u67e5\u627e\u51fa\u6570\u636e\uff0c\u6700\u540e\u8fd4\u56de\u3002 \u5982\u679c\u9047\u5230 \u5f02\u5e38 \uff0c\u6211\u4eec\u76f4\u63a5\u629b\u51fa\uff0c\u7ed9router\u5904\u7406\u3002 \ud83c\udf66 \u7f16\u5199\u65b0\u589e/\u5220\u9664/\u4fee\u6539\u529f\u80fd \u65b0\u589e/\u7f16\u8f91 \u5220\u9664 \u5176\u5b9e\u8981\u6ce8\u610f\u7684\u70b9\u662f\uff0c\u6211\u4eec\u4f7f\u7528\u4e86 async with session.begin() \uff0c\u5e76\u5728\u4ee3\u7801\u5757\u91cc\u9762\u7ee7\u7eed\u64cd\u4f5c\u3002 \u8fd9\u91cc \u535a\u4e3b \u8fd8\u6ca1\u6709\u5b8c\u5168\u53bb\u7814\u7a76\uff0c\u53ea\u662f\u77e5\u9053\u9700\u8981\u8fd9\u4e48\u4f7f\u7528\uff0c\u5927\u80c6\u63e3\u6d4b\u4e00\u4e0b\u662f\u56e0\u4e3awith...begin\u65b9\u6cd5\u7ed3\u675f\u540e\u4f1a \u81ea\u52a8\u63d0\u4ea4 \u6570\u636e\u5e93\u7684\u53d8\u66f4\uff0c\u4f46\u4e0d\u786e\u5b9a\u662f\u4e0d\u662f\u8fd9\u6837\uff0c\u6709\u5174\u8da3\u7684\u670b\u53cb\u53ef\u4ee5\u53bb\u7814\u7a76\u4e0b\u3002 \ud83d\udcd2 \u7f16\u5199Router router\u5c42\u6bd4\u8f83\u7b80\u5355\uff0c\u57fa\u672c\u5c31\u662f\u8c03\u7528dao\u5c42\u65b9\u6cd5\u5373\u53ef\uff0c\u53ea\u9700\u8981\u5305\u88c5\u4e0btry catch \u8fd9\u8fb9\u6211\u5c01\u88c5\u4e86\u4e13\u95e8\u7684Response\uff0c\u8fd9\u6837\u4ee5\u540e\u5c31\u4e0d\u9700\u8981\u4e00\u76f4\u624b\u5199 dict(code=0,msg=\"success\") \u8fd9\u6837\u7684\u8fd4\u56de\u4e86\u3002 \u5177\u4f53\u5b9e\u73b0 \ud83d\udcd2 \u6d4b\u8bd5\u4e00\u4e0b \u67e5\u8be2/\u65b0\u589e/\u7f16\u8f91/\u5220\u9664\u90fd\u6ca1\u95ee\u9898 \u540e\u7aef\u8fd9\u5757\u5185\u5bb9\u5e76\u6ca1\u6709\u7ed3\u675f\uff0c\u76ee\u524d\u6211\u4eec\u53ea\u662f\u80fd\u591f\u628a\u6570\u636e\u5e93\u914d\u7f6e\u7ba1\u7406\u8d77\u6765\uff0c\u8fd8\u8fbe\u4e0d\u5230\u4f7f\u7528\u7684\u6548\u679c\u3002 \u4e0b\u4e00\u7bc7 \u5c06\u4ecb\u7ecd\u5982\u4f55 \u5728\u7ebf\u6267\u884cSQL\u5e76\u8fd4\u56de \uff0c\u5e76\u7528\u4e8ecase\u6570\u636e\u6784\u9020\u5668\u4e4b\u4e2d\u3002\u7bc7\u5e45\u53ef\u80fd\u4f1a\u6bd4\u8f83\u957f\uff0c\u800c\u6211\u4e5f\u9700\u8981\u505a\u4e00\u90e8\u5206 \u524d\u7aef \u7684\u5185\u5bb9\u3002 \u5bf9\u5e94\u7684\u6570\u636e\u5e93\u914d\u7f6e\u9875\u9762\u4f1a\u5728\u8fd9\u513f\uff0c\u53ea\u6709super idol\u6709\u6743\u9650 \u4eca\u5929\u7684\u5185\u5bb9\u5230\u8fd9\u513f\u5c31\u7ed3\u675f\u5566\uff0c\u611f\u8c22\u5927\u5bb6\u7684 \u89c2\u770b \u3002\u5982\u679c\u5927\u5bb6\u611f\u5174\u8da3\u7684\u8bdd\uff0c\u53ef\u4ee5\u548c\u6211\u4e00\u8d77\u6572\u8d77\u6765\u3002\u6211\u4e5f\u4f1a\u5c3d\u5feb\u7ed9\u4e00\u4e2a \u53ef\u7528\u7684\u7248\u672c \u3002 \u6700\u540e\uff0c\u611f\u8c22 \u6d4b\u8bd5\u5f00\u53d1\u5e72\u8d27 \u7684\u652f\u6301\uff0c \u996d\u4f6c\u725b\u903c\uff0c\u70ed\u996d\u795e\u6559\u725b\u903c \uff01","title":"50.\u7f16\u5199\u6570\u636e\u5e93\u8fde\u63a5\u914d\u7f6e\u529f\u80fd"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2851%29%20%E7%BC%96%E5%86%99%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E7%9B%B8%E5%85%B3%E6%96%B9%E6%B3%95/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u5b8c\u6574\u7684 \u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0\u7cfb\u5217\u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u80fd\u591f\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u6d4b\u8bd5\u5f00\u53d1\u5751\u8d27 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \ud83d\udcd2 \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u8fb9\u5199\u4e86 \u6570\u636e\u5e93\u914d\u7f6e \u7684\u529f\u80fd\u63a5\u53e3\uff0c\u4f46\u662f\u524d\u7aef\u9875\u9762\u8fd8\u6ca1\u6709\u505a\u5c55\u793a\u3002 \u5982\u679c\u5b8c\u6210\u4e86\u524d\u7aef\u9875\u9762\u589e\u5220\u6539\u67e5\u9875\u9762\uff0c\u6211\u60f3\u6211\u4eec\u8fd8\u9700\u8981\u51e0\u4e2a\u529f\u80fd: \u5728\u7ebf\u6d4b\u8bd5\u8fde\u63a5 \u56e0\u4e3a\u6709\u7684\u65f6\u5019 \u6570\u636e\u5e93\u914d\u7f6e \u4f1a\u53d1\u751f\u53d8\u5316\uff0c\u5982\u679c\u6211\u4eec\u4e0d\u652f\u6301\u5728\u7ebf\u6d4b\u8bd5\u529f\u80fd\u7684\u8bdd\uff0c\u53ef\u80fd\u5927\u5bb6\u8fd8\u9700\u8981\u624b\u52a8\u53bb\u8fde\u63a5\u4e00\u4e0b\uff0c \u975e\u5e38\u96be\u7528 \uff01 \u5728\u7ebf\u6267\u884cSQL \u8fd9\u4e2a\u662f\u4e3a\u4e86\u80fd\u591f\u7ed9 \u7528\u6237 \u5728\u7ebf\u8fd0\u884csql\u8bed\u53e5\uff0c\u7c7b\u4f3c\u4e8e\u5c0fide\u7684\u529f\u80fd\uff0c\u5f53\u7136\u6211\u4eec\u53ea\u505a\u6700\u6838\u5fc3\u7684\u90e8\u5206\u3002 \u90a3\u4e48\u4eca\u5929\u6211\u4eec\u5c31\u6765\u5b8c\u5584\u524d\u7aef\u9875\u9762\u5e76 \u5b8c\u6210\u5728\u7ebf\u8fde\u63a5\u6d4b\u8bd5\u529f\u80fd \u3002 \ud83d\udcd2 \u524d\u7aef\u90e8\u5206 \u524d\u7aef\u90e8\u5206\u8fd8\u662f\u4ee5\u5f80\u7684 dispatch \u6a21\u5f0f\uff0cservice.js\u7528\u4e8e\u53d1\u9001http\u8bf7\u6c42\uff0cmodel\u7528\u4e8e\u7ba1\u7406\u53d8\u91cf\uff0c\u7ec4\u4ef6\u901a\u8fc7dispatch\u53bb\u8c03\u7528\u5177\u4f53\u7684\u65b9\u6cd5\u3002 \u524d\u7aef\u9875\u9762\u8fd8\u662f\u52063\u4e2a\u90e8\u5206\uff0c\u53ef\u4ee5\u7406\u89e3\u4e3a3\u4e2adiv: \u641c\u7d22\u680f \u6dfb\u52a0\u680f \u8868\u683c\u680f \u8fd9\u662f\u9700\u8981\u586b\u5199\u7684\u8868\u5355 \u5927\u6982\u7684\u9875\u9762\u5c55\u793a\u662f\u8fd9\u6837\uff0c\u6211\u4eec\u4eca\u5929\u91cd\u70b9\u8bb2\u4e00\u4e0b\u6570\u636e\u5e93\u8fde\u63a5\u8fd9\u5757\u3002 \ud83d\udcd2 \u601d\u8003\u600e\u4e48\u505a \u8fde\u63a5\u90e8\u5206\u6211\u4eec\u4ecd\u7136\u6253\u7b97\u91c7\u7528 sqlalchemy \uff0c\u65e2\u7136\u5df2\u7ecf\u5f00\u59cb\u7528\u4e86\uff0c\u800c\u4e14\u4ed6\u4e5f\u652f\u6301\u5f02\u6b65session\uff0c\u5728 \u6ca1\u9047\u5230\u5927\u5751 \u7684\u65f6\u5019\u6211\u4eec\u5c31\u4e0d\u8003\u8651\u66f4\u6362\u4e86\u3002 \u9996\u5148\u6211\u4eec\u8003\u8651\u4ee5\u4e0b\u51e0\u4e2a\u70b9: \ud83c\udf66 \u8fde\u63a5\u590d\u7528 \u9996\u5148\u8981\u6e05\u695a\uff0c\u6211\u4eec\u4e4b\u6240\u4ee5\u505a\u6570\u636e\u5e93\u8fde\u63a5\u914d\u7f6e\uff0c\u662f\u56e0\u4e3a\u6211\u4eec\u5728 \u6784\u9020\u6570\u636e \u7684\u65f6\u5019\u4f1a\u7528\u5230\uff0c\u90a3\u4e48\u6211\u4eec\u52bf\u5fc5\u8981\u7ef4\u62a4\u4e00\u4e2a\u6570\u636e\u5e93\u8fde\u63a5\u7684map\uff0c\u5145\u5f53\u7f13\u5b58\u7684\u4f5c\u7528\u3002 \u5f53\u6211\u4eec\u7684\u8d26\u53f7\u5bc6\u7801\u7b49\u8fde\u63a5\u4fe1\u606f\u6ca1\u6709\u53d8\u5316\u7684\u65f6\u5019\uff0c\u6211\u4eec\u662f\u4e0d\u662f\u53ef\u4ee5\u628a \u4e0a\u6b21\u8fde\u63a5\u7528\u7684session \u62ff\u51fa\u6765\u7ee7\u7eed\u4f7f\u7528\uff1f\u7b54\u6848\u662f\u80af\u5b9a\u7684\uff01 \u800c\u4e14\u5f53\u6211\u4eec\u6d4b\u8bd5\u8fde\u63a5\u4ee5\u540e\uff0c\u8fd9\u4e2a\u6570\u636e\u5e93\u914d\u7f6e\u5c31\u88ab\u7f13\u5b58\u4e86\u8d77\u6765\uff0c\u5982\u679c\u6211\u4eec\u8981\u4f7f\u7528\uff0c\u76f4\u63a5\u4ece\u8fde\u63a5\u7f13\u5b58\u91cc\u9762\u62ff\u5c31\u53ef\u4ee5\u4e86\u3002\u914d\u5408sqlalchemy\u672c\u8eab\u81ea\u5e26\u7684\u8fde\u63a5\u6c60\uff0c\u57fa\u672c\u4e0a\u6211\u4eec\u8981\u505a\u7684\u5c31\u6bd4\u8f83\u7b80\u5355\uff0c\u53ea\u662f\u5305\u4e00\u5c42dict\u5373\u53ef\u3002 \ud83c\udf66 \u7f13\u5b58\u6269\u5f20\u95ee\u9898 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u6211\u73b0\u5728\u914d\u7f6e\u4e86A\u6570\u636e\u5e93\u8fde\u63a5\uff0c\u6d4b\u8bd5\u4e86\u4e00\u904d\uff0c\u4f60\u7ed9\u6211\u7f13\u5b58\u8d77\u6765\u4e86\uff0c\u63a5\u7740\u6211\u628aA\u6539\u6210B\uff0c\u7531\u4e8e A\u548cB\u7684\u914d\u7f6e\u4e0d\u4e00\u6837 \uff0c\u6240\u4ee5\u7f13\u5b58\u91cc\u9762\u73b0\u5728\u9700\u8981\u63d2\u5165\u4e00\u6761B\u6570\u636e\uff0c\u5982\u679c\u6539\u7684\u9891\u7e41\uff0c\u5c31\u4f1a\u4f7f\u5f97\u8fd9\u4e2adict\u65e0\u9650\u6269\u5f20\uff0c\u5185\u5b58\u4e5f\u4f1a\u5360\u7528\u53d8\u5927\u3002\u4f46\u56e0\u4e3a\u6570\u636e\u5e93\u914d\u7f6e\u4e0d\u592a\u53ef\u80fd\u7ecf\u5e38\u53d8\u5316\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u5728update\u914d\u7f6e\u7684\u65f6\u5019\u6e05\u695a\u4e4b\u524d\u7684\u7f13\u5b58\u3002 \ud83c\udf66 \u591a\u7ebf\u7a0b\u8bbf\u95ee\u7f13\u5b58\u7684\u95ee\u9898 Python\u7684\u591a\u7ebf\u7a0b\u6211\u4e0d\u662f \u592a\u719f\u6089 \uff0c\u4e0d\u592a\u786e\u5b9aFastapi\u5185\u90e8\u662f\u5426\u4f1a\u6709\u591a\u4e2a\u7ebf\u7a0b\u540c\u65f6\u8bfb\u5199\u7f13\u5b58\u7684\u60c5\u51b5\uff0c\u5982\u679c\u6709\uff0c\u90a3\u80af\u5b9a\u4f1a\u51fa\u95ee\u9898\u7684\uff0c\u6211\u4eec\u9700\u8981\u52a0\ud83d\udd12\uff0c\u6682\u65f6\u6211\u4eec\u53ef\u4ee5\u5148 \u89c2\u671b\u4e00\u4e0b \u3002 \ud83d\udcd2 \u52a8\u8d77\u624b\u6765 \u6211\u4eec\u5bf9\u4e4b\u524d\u7684models/ init .py\u65b9\u6cd5\u8fdb\u884c\u4e00\u4e9b\u6539\u9020\uff0c\u6211\u4eec\u9700\u8981\u589e\u52a0\u4e00\u4e2aDatabaseHelper\u7c7b\u3002 \u4e3a\u4ec0\u4e48\u8981\u4f20\u5165\u8fd9\u4e48\u591a\u53c2\u6570\uff0c\u662f\u56e0\u4e3a\u4f20\u5165\u914d\u7f6eid\u7684\u8bdd\uff0c\u9700\u8981\u518d\u6b21\u67e5\u8be2\u6570\u636e\u5e93\uff0c\u6bd4\u8f83\u9ebb\u70e6 init\u65b9\u6cd5 init\u65b9\u6cd5\u521b\u5efa\u4e86\u6211\u4eec\u5185\u90e8\u7684dict\u7f13\u5b58\uff0ckey\u662f\u6570\u636e\u5e93\u7684\u8fde\u63a5\u4fe1\u606f\uff0cvalue\u662f\u5bf9\u5e94\u7684session\u3002 get_connection \u901a\u8fc7\u6570\u636e\u5e93\u914d\u7f6e\u53bb\u83b7\u53d6\u5230\u5bf9\u5e94\u7684\u8fde\u63a5\u4fe1\u606f\uff0c\u9996\u5148\u62fc\u63a5key\uff0c\u62ff\u5230\u552f\u4e00\u7684key\u6807\u8bc6\uff0c\u63a5\u7740\u53bb\u7f13\u5b58\u627e\u6709\u6ca1\u6709\u521d\u59cb\u5316\u8fd9\u4e2a\u8fde\u63a5\uff0c\u6709\u7684\u8bdd\u76f4\u63a5\u8fd4\u56de\uff0c\u6ca1\u6709\u5c31\u5f00\u59cb\u5efa\u7acb\u8fde\u63a5\u3002 get_jdbc_url \u8fd9\u91cc\u5176\u5b9e\u662f\u628a\u6570\u636e\u5e93\u914d\u7f6e\u8f6c\u4e3a\u4e86\u6570\u636e\u5e93\u8fde\u63a5url \u6ce8\u610f: pg\u6211\u8fd8\u6ca1\u6709\u627e\u5230\u5408\u9002\u7684\u5f02\u6b65\u5e93\uff0c\u6240\u4ee5\u6682\u65f6\u5148\u4e0d\u652f\u6301\u5b83\uff0c\u540e\u9762\u518d\u652f\u6301\uff0c\u603b\u611f\u89c9pg\u7528\u7684\u4eba\u5e76\u6ca1\u6709\u90a3\u4e48\u591a\u3002 \u5220\u9664\u7f13\u5b58\u7684\u65b9\u6cd5 \u5148\u5224\u65ad\u662f\u5426\u6709\u8be5key\uff0c\u6709\u5219\u5220\u9664 \u6d4b\u8bd5\u8fde\u63a5\u7684\u65b9\u6cd5 \u63a5\u53d7\u4e00\u4e2asession\uff0c\u5982\u679c\u4e3a\u7a7a\uff0c\u5219\u8fd4\u56de\u9519\u8bef\u4fe1\u606f\u3002\u6700\u540eexecute\u4e00\u53e5 select 1 \u6d4b\u8bd5\u662f\u5426\u80fd\u591f\u6b63\u5e38\u8fde\u4e0a\u6570\u636e\u5e93\uff0c\u4e0d\u80fd\u5219\u8fd4\u56de\u9519\u8bef\u4fe1\u606f\u3002 \u6700\u540e\u6211\u4eec\u518d\u5b9e\u4f8b\u5316\u8fd9\u4e2aHelper\uff0c\u7edf\u4e00\u8c03\u7528\u8fd9\u4e2a\u5bf9\u8c61\u5373\u53ef \u6539\u5199update\u65b9\u6cd5 \u52a0\u5165\u5220\u9664\u7f13\u5b58\u7684\u90e8\u5206 \u7f16\u5199\u5728\u7ebf\u6d4b\u8bd5\u65b9\u6cd5 \u5982\u679csession\u6ca1\u83b7\u53d6\u5230\uff0c\u8fd4\u56de\u9519\u8bef\u4fe1\u606f \ud83d\udcd2 \u6d4b\u8bd5\u4e00\u54c8 \u5bc6\u7801\u4e0d\u6b63\u786e\u7684\u65f6\u5019 \u8fd9\u662f\u5bc6\u7801\u6b63\u786e\u7684\u60c5\u51b5\u4e0b \u4eca\u5929\u7684\u5185\u5bb9\u5230\u8fd9\u91cc\u5c31\u7ed3\u675f\u4e86\uff0c\u4e0b\u4e00\u8282\u6211\u4eec\u7f16\u5199\u5728\u7ebf\u6267\u884c SQL \u529f\u80fd\u3002","title":"51.\u7f16\u5199\u6570\u636e\u5e93\u8fde\u63a5\u76f8\u5173\u65b9\u6cd5"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2852%29%20%E6%94%B9%E9%80%A0%E5%BC%82%E6%AD%A5%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E6%96%B9%E6%A1%88/","text":"\u5927\u5bb6\u597d\uff0c\u6211\u662f\u7c73\u6d1b\uff0c\u6c42\u4e09\u8fde\uff01\u6c42\u5173\u6ce8 \u6d4b\u8bd5\u5f00\u53d1\u5751\u8d27 ! \ud83d\udcd2 \u56de\u987e \u4e0a\u8282\u6211\u4eec\u7f16\u5199\u4e86 \u5f02\u6b65sql\u8fde\u63a5 \u7684\u529f\u80fd\uff0c\u7ecf\u8fc7\u535a\u4e3b\u4e00\u756a\u6fc0\u70c8\u7684\u601d\u60f3\u6597\u4e89\uff0c\u8fd8\u662f\u51b3\u5b9a\u6682\u65f6\u5148\u4f7f\u7528 \u540c\u6b65 \u7684\u65b9\u5f0f\u3002 \u4e3a\u4ec0\u4e48\u5462\uff1f\u4e3b\u8981\u662f\u4ee5\u4e0b\u51e0\u4e2a\u539f\u56e0: \u5f02\u6b65( AsyncEngine )\u7684\u529f\u80fd\u8fd8\u5f88\u591a\u90fd\u4e0d\u5b8c\u5584 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u4e3a\u4e86\u8ba9 \u5728\u7ebf\u6267\u884cSQL \u529f\u80fd\u66f4\u52a0\u53cb\u597d\uff0c\u5e76\u4e14\u9632\u6b62\u7528\u6237\u5199\u9519\u8868\u540d\uff0c\u6211\u4eec\u9700\u8981\u5c55\u793a\u51fadb\u4e0b\u6709\u54ea\u4e9b\u8868\uff0c\u5982\u679c\u80fd\u5c55\u793a\u51fa\u8868\u6709\u4ec0\u4e48\u5b57\u6bb5\uff0c\u90a3\u5c31\u66f4\u5b8c\u7f8e\u4e86\uff01\u4f46 \u5f02\u6b65Engine \u7684\u8bdd\uff0c\u8fd8\u786e\u5b9e\u5f88\u591a\u529f\u80fd\u90fd\u662f \u652f\u6301\u4e0d\u4e86 \u7684\uff0c\u8fd8\u9700\u8981\u7b49\u4ed6\u4eec\u6162\u6162\u5b8c\u5584\u3002 pg\u7684\u5f02\u6b65\u5e93\u8fd8\u6ca1\u9009\u5b9a \u867d\u7136\u6709\u4e00\u5b9a\u7684\u65b9\u5411\uff0c\u6bd4\u5982GINO\u8fd9\u6837\u7684\u5f15\u64ce\u90fd\u505a\u4e86\u4e00\u4e9bsqlalchemy\u7684\u529f\u80fd\uff0c\u5e76\u4e0d\u53ea\u662f\u5355\u7eaf\u7684\u5f02\u6b65\u6570\u636e\u5e93driver\u3002\u800c\u540c\u6b65\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u7528\u73b0\u6709\u7684 psycopg2 \u3002 \u5f02\u6b65\u540c\u6b65\u6027\u80fd\u5dee\u8ddd\u76ee\u524d\u6765\u770b\u4e0d\u7b97\u5927 \ud83d\udcd2 \u5f00\u59cb\u6539\u9020 \u4fee\u6539get_jdbc_url\u65b9\u6cd5 mysql\u4f7f\u7528\u5b98\u65b9\u7684mysql-connetor\uff0cpg\u4f7f\u7528psycopg2 \u4fee\u6539test_connection\u65b9\u6cd5 \u53bb\u6389\u4e86async\u76f8\u5173\u4ee3\u7801 \u4fee\u6539get_connection\u65b9\u6cd5 \u9664\u4e86\u6539\u6389\u4e86\u5f02\u6b65\u4ee3\u7801\u4ee5\u5916\uff0c\u6ce8\u7bad\u5934\u5904 \u8fd9\u8fb9\u7f13\u5b58\u4e86engine\u548csession2\u4e2a\u53d8\u91cf\uff0c\u800c\u4e0d\u53ea\u662f\u5355\u7eaf\u7684session\uff0c\u56e0\u4e3a\u6211\u4eec\u83b7\u53d6\u6570\u636e\u5e93\u6709\u54ea\u4e9b\u8868\uff0c\u9700\u8981\u7528\u5230 engine \u3002 \u867d\u7136\u8bf4 show tables \u4e5f\u53ef\u4ee5\u62ff\u5230\u8868\u4fe1\u606f\uff0c\u4f46\u662f\u4e0d\u591f\u5168\u9762\u3002 \ud83d\udcd2 \u7f16\u5199\u5728\u7ebf\u6267\u884cSQL\u7684\u65b9\u6cd5 \u5728DbConfigDao.py\u6587\u4ef6\u4e2d\u589e\u52a0online_sql\u65b9\u6cd5\uff0c\u63a5\u53d72\u4e2a\u53c2\u6570: \u6570\u636e\u5e93\u914d\u7f6eid sql \u5177\u4f53\u7684sql\u8bed\u53e5 \u53ef\u4ee5\u770b\u5230\uff0c\u6211\u4eec\u5148\u901a\u8fc7get_connection\u83b7\u53d6\u5230\u8fd9\u4e2a\u914d\u7f6e\u7684\u8fde\u63a5session\uff0c\u7136\u540eexecute\u6267\u884c\u4e86sql\u8bed\u53e5\uff0c\u6700\u540e\u8c03\u7528: result.mappings().all() \u62ff\u5230\u8fd4\u56de\u6570\u636e\uff0c\u8fd9\u4e2amappings()\u7684\u597d\u5904\u662f\u4ec0\u4e48\u5462\uff1f\u5c31\u662f\u53ef\u4ee5\u628a\u6267\u884c\u7ed3\u679c\u6309\u7167\u4e0b\u9762\u7684\u683c\u5f0f\u8fd4\u56de\uff0c\u5f53\u7136\u4e5f\u662f \u67e5\u4e86\u8bb8\u4e45 \u5f97\u51fa\u7684\u7ed3\u679c\u3002 [ { \"\u5b57\u6bb51\" : \"\u5b57\u6bb51\u7684\u503c\" } ] \ud83d\udcd2 \u7f16\u5199\u63a5\u53e3 \u65b0\u589e\u4e86online\u8def\u7531 \u8fd9\u91cc\u7684\u53c2\u6570\u662f\u914d\u7f6eid\u548csql\u8bed\u53e5\uff0c\u6211\u4eec\u6765\u770b\u770b\u5bf9\u5e94\u7684\u8fd4\u56de\u7ed3\u679c: \u53ef\u4ee5\u770b\u5230\uff0c\u57fa\u672c\u4e0a\u5c31\u662f\u539f\u751f\u6267\u884csql\u4e86\uff0c \u975e\u5e38\u597d\u7528 !\u56e0\u4e3a\u672c\u4eba\u76ee\u524d\u7535\u8111\u6ca1\u6709\u88c5pg\uff0c\u6240\u4ee5\u5bf9pg\u7684\u517c\u5bb9\u6027\u53ef\u80fd\u4e0d\u662f\u5f88\u597d\uff0c\u5927\u5bb6\u6709\u7591\u95ee\u7684\u8bdd\u53ef\u4ee5\u7ed9\u6211\u63d0issue\uff0c\u6211\u4f1a \u5c3d\u5feb\u517c\u5bb9 \u7684\u3002 \u9879\u76ee\u5730\u5740: https://github.com/wuranxu/pity \u56e0\u4e3a\u540c\u6b65\u5f02\u6b65\u7684\u65b9\u6cd5\uff0c\u6709\u4e00\u4e9b\u803d\u6401\u4e86\u8fdb\u5ea6\uff0c\u4e0d\u8981\u7d27\uff0c\u4e0b\u4e00\u8282\u540e\u7aef\u7684\u5185\u5bb9\u4f1a\u504f\u5c11\uff0c\u4e3b\u8981\u8bb2\u600e\u4e48\u60f3datagrip\u4e00\u6837\u5c55\u793a \u6570\u636e\u8868 \u7ed3\u6784\uff0c\u5e76\u8ba9\u7528\u6237\u53ef\u4ee5 \u5728\u7ebf\u7f16\u5199sql \uff0c\u6700\u7ec8\u5c31\u662f\u5d4c\u5165\u5230 \u6570\u636e\u6784\u9020\u5668 \uff08\u524d\u7f6e\u6761\u4ef6\uff09\u4e4b\u4e2d\u3002 PS: \u9879\u76ee\u6709\u4e86\u65b0\u7684\u57df\u540d\u4e86\uff0c\u5927\u5bb6\u53ef\u4ee5\u901a\u8fc7\u4e0b\u9762\u7684\u7f51\u5740\u5728\u7ebf\u4f53\u9a8c\u3002\u8fd9\u4e2a\u57df\u540d\u6211\u4e00\u53e3\u6c14\u4e70\u4e8610\u5e74\uff0c\u5e0c\u671b\u81ea\u5df1\u4e5f\u80fd \u7ee7\u7eed\u7ef4\u62a4 \u4e0b\u53bb~ http://test.pity.fun","title":"52.\u6539\u9020\u5f02\u6b65\u6570\u636e\u5e93\u8fde\u63a5\u65b9\u6848"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2853%29%20%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E6%8E%A5%E5%8F%A3%E9%80%82%E9%85%8D%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2%28%E4%B8%8A%29/","text":"\u5927\u5bb6\u597d\uff0c\u6211\u662f\u7c73\u6d1b\uff0c\u6c42\u4e09\u8fde\uff01\u6c42\u5173\u6ce8 \u6d4b\u8bd5\u5f00\u53d1\u5751\u8d27 ! \ud83d\udcd2 \u56de\u987e \u4e0a\u4e00\u7bc7\u6211\u4eec\u8d39\u4e86\u70b9\u529f\u592b\uff0c\u5c06\u5f02\u6b65\u4ee3\u7801\u6539\u56de\u4e86 \u540c\u6b65\u4ee3\u7801 \uff0c\u4f46\u4e5f\u4e0d\u80fd\u8bf4\u4e00\u65e0\u6240\u83b7\uff0c\u6211\u4eec\u7f16\u5199\u597d\u4e86\u5728\u7ebf\u8fd0\u884csql\u8bed\u53e5\u7684\u529f\u80fd\uff0c\u5e76\u8fd4\u56de\u4e86\u60f3\u8981\u7684 \u5b57\u6bb5 -> \u5b57\u6bb5\u503c \u7684\u5217\u8868\u6570\u636e\u3002 \u4eca\u5929\u6211\u4eec\u5c31\u6765\u5b8c\u5584\u4e00\u4e0b\u9875\u9762\u90e8\u5206\u3002 \u672c\u6587\u56e0\u4e3a\u6bd4\u8f83\u590d\u6742\u800c\u5206\u4e3a2\u8282\uff0c\u6709\u4e00\u5b9a\u7684\u96be\u5ea6\uff0c\u535a\u4e3b\u6211\u4e5f\u4f1a\u5c3d\u91cf\u8bb2\u6e05\u695a\uff0c\u5927\u5bb6\u8fd8\u9700\u8981\u591a\u7406\u89e3\u3002 \ud83d\udcd2 \u600e\u4e48\u67e5\u8be2\u5230\u6570\u636e\u8868\u548c\u5177\u4f53\u5b57\u6bb5\u5462 \u8fd9\u4e2a \u529f\u80fd \u6211\u8ba4\u4e3a\u662f\u4e00\u4e2a\u6bd4\u8f83\u5927\u7684\u4eae\u70b9\uff0c\u4e00\u822c\u6765\u8bf4\u6211\u4eec\u5728\u7ebf\u6267\u884c\u6d4b\u8bd5\uff0c\u5c31\u62ff\u6211\u4ee5\u524d\u505a\u7684\u5e73\u53f0\u4e3e\u4f8b\uff0c\u90fd \u53ea\u662f\u4e3a\u4e86\u80fd\u8ba9\u7528\u6237\u5728\u7ebf\u6267\u884c\u4e0bSQL \uff0c\u6240\u4ee5\u5bf9\u4e8e\u6570\u636e\u8868\uff0c\u5b57\u6bb5\u7b49\u7684\u5c55\u793a\u90fd\u662f\u653e\u5f03\u7684\u3002 \u4eca\u5929\u5462\uff0c\u6211\u4eec\u5c31\u6765 \u6574\u4e00\u6574 \u8fd9\u5757\u7684\u529f\u80fd\u3002 \ud83c\udf66 \u901a\u8fc7Engine\u83b7\u53d6\u8868\u6570\u636e \u6211\u4eec\u90fd\u77e5\u9053\uff0c\u53ef\u4ee5\u901a\u8fc7\u6267\u884c show tables \u6765\u67e5\u770b\u8868\u4fe1\u606f\uff0c\u4f46\u662f\u6211\u4eec\u4e0d\u4f46\u8981\u4fe1\u606f\uff0c\u8fd8\u8981\u5b57\u6bb5\uff0c\u90a3\u8be5\u600e\u4e48\u505a\u5462\uff1f \u800c\u4e14\u6211\u4eec\u8fd8\u9700\u8981\u628a\u6240\u6709\u6570\u636e\u5e93\u914d\u7f6e\u90fd \u62c9\u51fa \u54e6\uff0c\u6ca1\u4e8b\uff0c\u770b\u6211 \u64cd\u4f5c \u5c31\u884c\u4e86\uff01 \u5728sqlalchemy\u91cc\u9762\uff0c\u53ef\u4ee5\u7528engine.table_names()\u62ff\u5230\u5177\u4f53\u7684\u8868\u4fe1\u606f\uff0c\u800c\u4e14\u662f\u5e26\u4e0a \u5b57\u6bb5 \u7684\uff0c\u518d\u5bf9\u6bd4\u4e00\u4e0b\u6211\u4eec\u7684 \u53c2\u8003\u9879\u76ee \uff0c\u6211\u4eec\u5c31\u80fd\u660e\u786e\u5230\u81ea\u5df1\u7684\u65b9\u5411\u4e86\u3002 \u8fd9\u5c31\u662f\u6211\u4eec\u7684\u65b9\u5411\uff0c\u4e5f\u662f\u8001\u5e08 \ud83d\udcd2 \u540e\u7aef\u9700\u8981\u505a\u4ec0\u4e48 \u6211\u4eec\u65e2\u7136\u5df2\u7ecf\u770b\u5230\u4e86 \u5927\u6982\u60f3\u8981\u5b9e\u73b0 \u7684UI\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u53bbant.design\u5b98\u7f51\u627e\u5bf9\u5e94\u7684 \u6811\u7ec4\u4ef6 \u3002 \u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u79cd\u7ec4\u4ef6\u57fa\u672c\u7b26\u5408\u6211\u4eec\u7684\u8981\u6c42 \u90a3\u4e48\u6211\u4eec\u7684\u6570\u636e \u8be5\u600e\u4e48\u51c6\u5907 \u5462\uff1f\u5728\u524d\u7aef\u4e0d\u65b9\u4fbf\u5904\u7406\u7684\u65f6\u5019\uff0c\u6211\u4eec\u540e\u7aef\u53ef\u4ee5\u5c3d\u91cf\u8fd4\u56de \u524d\u7aef\u4f7f\u7528\u8212\u670d \u7684\u6570\u636e\u3002\u5148\u770b\u770b\u7ec4\u4ef6\u9700\u8981\u7684\u6570\u636e: const treeData = [ { title: 'parent 0 ', key: ' 0 -0 ', children: [ { title: 'leaf 0 -0 ', key: ' 0 -0 -0 ', isLeaf: true }, { title: 'leaf 0 -1 ', key: ' 0 -0 -1 ', isLeaf: true }, ], }, { title: 'parent 1 ', key: ' 0 -1 ', children: [ { title: 'leaf 1 -0 ', key: ' 0 -1 -0 ', isLeaf: true }, { title: 'leaf 1 -1 ', key: ' 0 -1 -1 ', isLeaf: true }, ], }, ]; \u6211\u4eec\u4e00\u6b65\u4e00\u6b65\u6765\u5206\u6790: \u9876\u5c42 \u9876\u5c42\u662f\u4e00\u4e2a \u5217\u8868 \uff0c\u5217\u8868\u91cc\u9762\u662f\u4e00\u4e2adict\uff08\u4ee5Python\u6570\u636e\u7ed3\u6784\u4e3a\u4f8b\uff09\u3002 \u5217\u8868\u5143\u7d20 \u5217\u8868\u5143\u7d20\u53c8\u5305\u62ec: title \uff08\u5c55\u793a\u540d\u79f0\uff09, key (\u552f\u4e00\u6807\u8bc6\uff0c\u4e3a\u4e86\u65b9\u4fbf\u9009\u4e2d\u7684\u65f6\u5019\u77e5\u9053\u9009\u5230\u4e86\u54ea\u4e2a\u5143\u7d20\uff0c\u548ccss\u4e2d\u7684id\u63a5\u8fd1\u7684\u6982\u5ff5), children (\u662f\u5426\u6709\u5b69\u5b50\uff0c\u5b69\u5b50\u4e5f\u662f\u4e00\u6837\u7684\u5217\u8868)\u3002 \u5982\u679c\u4e00\u4e2a\u6570\u636e \u5d4c\u5957\u6bd4\u8f83\u6df1 \uff0c\u90a3\u4e48\u53ef\u80fd\u4f1a\u5728children\u91cc\u9762\u6709\u5f88\u591a\u5c42children, \u63a5\u4e0b\u6765\u6211\u4eec\u5c31\u8981\u5904\u7406\u8fd9\u5757\u3002 \ud83d\udcd2 \u6784\u601d\u51fa\u524d\u7aef\u9700\u8981\u7684\u6570\u636e \u5176\u5b9e\u8fd9\u4e2a\u5f88\u50cf\u6211\u4eec\u7684\u6587\u4ef6\u5939\u7684\u611f\u89c9\uff0c\u6211\u8fd9\u8fb9\u5217\u4e2a \u76ee\u5f55 \u7ed9\u5927\u5bb6\u770b\u770b\u3002 fat\u662f\u73af\u5883\uff0c\u6700\u5927\u7684\u5206\u7c7b\uff0c\u63a5\u7740 pity \u662f\u6570\u636e\u5e93\u540d\uff0cpity\u4e0b\u9762\u8fd8\u6709pity_testcase\uff08\u6570\u636e\u8868\uff09,\u6570\u636e\u8868\u4e0b\u9762\u8fd8\u6709id\uff0cname\u7b49\u5b57\u6bb5\u3002 \u90a3\u4e48\u5982\u679c\u6211\u4eec\u662f\u8fd9\u4e9b\u6570\u636e\uff0c\u8981\u7ed9\u524d\u7aef\u662f\u600e\u4e48\u5c55\u793a\u7684\u5462\uff1f\u6309\u7167\u4ed6\u4eec\u7684\u89c4\u5219: const treeData = [ { title: \"fat\" , key: \"env_fat\" , children: [ { \"title\" : \"pity\" , \"key\" : \"database_pity\" , \"children\" : [ { \"title\" : \"pity_testcase\" , key: \"table_pity_testcase\" , children: [ { \"title\" : \"id\" , \"key\" : \"column_id\" // \u8fd9\u91cc\u5c31\u6ca1\u6709children\u4e86\uff0c\u56e0\u4e3a\u5b57\u6bb5\u662f\u6700\u540e\u4e00\u7ea7\u4e86 }, { \"title\" : \"name\" , \"key\" : \"column_name\" }, { \"title\" : \"create_time\" , \"key\" : \"column_create_time\" } ] } ] } ] } ] \u53ef\u4ee5\u770b\u5230\uff0c\u6570\u636e\u662f\u8fd9\u6837\u4e00\u5c42\u4e00\u5c42\u7684\uff0c\u53ef\u8c13 \u5341\u5206\u590d\u6742 !\u5927\u5bb6\u770b\u5230\u53ef\u80fd\u4f1a\u89c9\u5f97\uff0c\u8981\u6211\u624b\u52a8\u5199\u8fd8\u884c\uff0c\u8981\u6211 \u6839\u636e\u6570\u636e\u5e93\u7684\u6570\u636e \u751f\u6210\uff0c\u90a3\u6211\u8fd8\u662f \u56de\u53bb\u5b66\u4e60\u4e86\u6811 \u4e4b\u540e\u518d\u6765\u5427\uff01 \u5176\u5b9educk\u4e0d\u5fc5\uff0c\u6211\u4eec\u53ea\u8981\u7406\u6e05\u695a\u601d\u8def\u5c31\u884c\u3002 \ud83c\udf66 \u786e\u5b9a\u552f\u4e00key \u5927\u5bb6\u6709\u6ca1\u6709\u53d1\u73b0\uff0c\u867d\u7136fat\u8fd9\u79cdenv\u662f\u6709id\u7684\uff0c\u4f46\u662f\u5b83\u4e5f\u53ef\u80fd\u548c\u5176\u4ed6\u8868\u7684id\u4e32\u4e86\uff0c\u6240\u4ee5\u6211\u4eec\u662f\u4e0d\u80fd\u4ee5id\u4e3akey\u7684\u3002\u4f46\u5982\u679c\u6211\u4eec\u52a0\u4e0a \u8868\u540d \u7684\u524d\u7f00\uff0c\u6bd4\u5982 env_1 \uff0c\u8fd9\u6837\u662f\u4e0d\u662f\u4e0d\u4f1a\u4e32\u4e86\u5462\uff1f \u90a3\u5982\u679c\u6709\u7684\u6570\u636e\u6ca1\u6709id\u5462\uff1f\u6bd4\u5982\u6570\u636e\u8868\u7684\u5b57\u6bb5\u6570\u636e\uff0c\u5176\u5b9e\u6ca1\u4e8b\uff0c\u6211\u4eec\u53ea\u8981\u5e26\u4e0a\u5b83\u7238\u7238\u7684id\u5373\u53ef\uff0c\u6bd4\u5982 \u6570\u636e\u8868\u5b57\u6bb5 \u867d\u7136\u6ca1\u6709id\uff0c\u4f46\u662f \u6570\u636e\u8868 \u7684\u7238\u7238\u6709\uff0c\u5373\u6211\u4eec\u7684 pity_database_info \u8868\uff0c\u5b83\u662f\u6709\u552f\u4e00id\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u5e26\u4e0a\u4ed6\u7236\u4eb2\u7684\u7236\u4eb2\u7684id\u5373\u53ef\u3002 \ud83d\udcd2 \u5404\u4e2a\u51fb\u7834 \u73af\u5883\u5c42\uff08\u7b2c\u4e00\u5c42\uff09 \u9996\u5148\u6211\u4eec\u9700\u8981\u83b7\u53d6\u5230\u5f53\u524d\u6709\u591a\u5c11\u73af\u5883\uff0c\u5e76\u62ff\u5230\u73af\u5883\u7684\u5177\u4f53id->\u73af\u5883\u540d\u79f0\u7684\u5bf9\u5e94\u5173\u7cfb\uff0c\u56e0\u4e3a\u6211\u4eec\u7684 pity_database_info \u5b58\u653e\u7684env \u662f \u4e3b\u952e \uff0c\u800c\u4e0d\u662f\u5bf9\u5e94\u7684\u73af\u5883\u540d\u3002 \u5047\u8bbe\u6211\u4eec\u62ff\u5230\u4e86\u73af\u5883\u5217\u8868\uff0c\u90a3\u6211\u4eec\u53ef\u4ee5\u9020\u51fa\u7b2c\u4e00\u5c42\u6570\u636e, \u8fd9\u91cc\u7528\u4f2a\u4ee3\u7801\u5c55\u793a: envList = [{ \"id\" : 1 , \"name\" : fat}, { \"id\" : 2 , \"name\" : \"uat\" }] result = [] for env in envList: result.append({ title: env.get( \"name\" ), key: f\"env_ {env.get( \"id\" )} \" , children: [] }) \u8fd9\u6837\u6211\u4eec\u5c31\u5b8c\u6210\u4e86\u6700\u5916\u5c42\u6570\u636e\u7684\u7f16\u5199\uff0cresult\u76ee\u524d\u7684\u7ed3\u679c: [ { \"title\" : \"fat\" , \"key\" : \"env_1\" , children: [] }, { \"title\" : \"uat\" , \"key\" : \"env_2\" , children: [] } ] \u53ef\u4ee5\u770b\u5230\uff0c \u96cf\u5f62 \u5df2\u7ecf\u51fa\u6765\u4e86\u3002 \u6211\u4eec\u53bb\u653e\u5230\u6811\u91cc\u9762\u770b\u770b\u6548\u679c: \u53ef\u4ee5\u770b\u5230\u5df2\u7ecf\u67092\u4e2a\u76ee\u5f55\u4e86 \u56fe\u4e2d\u663e\u793a\u4e862\u4e2a\u76ee\u5f55\u4e86\uff0c\u4f46\u662f\u56e0\u4e3a\u6ca1\u6709children\u7684\u7f18\u6545\uff0c\u6240\u4ee5\u76ee\u5f55\u5c55\u5f00\u540e\u662f \u6ca1\u6709\u5185\u5bb9 \u7684~ \u5269\u4e0b\u7684\u5c31\u4ea4\u7ed9 \u4e0b\u4e00\u8282 \u6765\u89e3\u51b3\u4e86\uff01\uff01\uff01 \u9879\u76ee\u6587\u6863\u5730\u5740: https://pity.readthedocs.org","title":"53.\u6570\u636e\u5e93\u8868\u63a5\u53e3\u9002\u914d\u524d\u7aef\u9875\u9762(\u4e0a)"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2854%29%20%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E6%8E%A5%E5%8F%A3%E9%80%82%E9%85%8D%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2%28%E4%B8%8B%29/","text":"\u5927\u5bb6\u597d\uff0c\u6211\u662f\u7c73\u6d1b\uff0c\u6c42\u4e09\u8fde\uff01\u6c42\u5173\u6ce8 \u6d4b\u8bd5\u5f00\u53d1\u5751\u8d27 ! \ud83d\udcd2 \u56de\u987e \u4e0a\u4e00\u7bc7\u6211\u4eec\u7f16\u5199\u4e86\u6811\u7684\u6700\u5916\u5c42\uff0c\u4f46\u662f\u56e0\u4e3a\u6211\u4eec\u8fd8\u6709 \u5f88\u6df1\u7684\u5c42\u7ea7 \u8981\u5d4c\u5957\uff0c\u6240\u4ee5\u6211\u4eec\u73b0\u5728\u5f00\u59cb\u3002 \u51c6\u5907\u597d\u4e86\u5417\uff1f \u672c\u6587\u4f9d\u65e7\u6709\u4e00\u5b9a\u7684\u96be\u5ea6\uff0c\u9700\u8981\u5927\u5bb6\u7406\u89e3\u503c\u4f20\u9012\u548c\u5f15\u7528\u4f20\u9012 \u3002 \u5148\u770b\u770b\u6700\u7ec8\u6548\u679c\u56fe\uff0c\u6765\u70b9\u4fe1\u5fc3\u3002 \ud83d\udcd2 \u5b9e\u73b0\u4f2a\u4ee3\u7801 \u4e0a\u4e00\u8282\u6211\u4eec\u5199\u7684\u90fd\u662f \u4f2a\u4ee3\u7801 \uff0c\u8fd9\u6b21\u76f4\u63a5\u6765\u5b9e\u73b0\u5b83\u3002 \u7f16\u5199\u65b9\u6cd5\uff0c\u67e5\u8be2\u6570\u636e\u5e93\u548c\u6570\u636e\u8868 result \u662f\u6211\u4eec\u6700\u7ec8\u8fd4\u56de\u7ed3\u679c\u3002 \u6700\u5916\u5c42\u6211\u4eec\u5148\u67e5\u8be2\u6240\u6709\u7684 \u73af\u5883 \uff0c\u5e76\u751f\u6210\u4e00\u4e2a\u6620\u5c04\u5173\u7cfb: \u73af\u5883id => \u73af\u5883\u540d\u79f0 \ud83c\udf66 \u4e3a\u4ec0\u4e48\u9700\u8981env_index \u90a3\u4e48 env_index \u53c8\u662f\u5e72\u4ec0\u4e48\u7684\u5462\uff1f \u56e0\u4e3a\u73af\u5883\u662f\u6700\u5916\u5c42\uff0c\u6211\u4eec\u9700\u8981\u901a\u8fc7\u73af\u5883id\u627e\u5230\u6211\u4eec\u8981\u5f80\u54ea\u4e2a\u73af\u5883\u7684children\u91cc\u9762\u52a0\u7b2c\u4e8c\u5c42\u7684\u6570\u636e\uff0c\u800c\u6211\u4eec\u751f\u6210\u7684\u662f\u4e00\u4e2a\u5217\u8868\uff0c\u8fd9\u5c31\u5bfc\u81f4\u5982\u679c\u6211\u4eec\u9700\u8981\u63d2\u5165\u73af\u5883id=2\u7684children\u7684\u65f6\u5019\uff0c\u4e0d\u5f97\u4e0d\u53bb\u641c\u7d22\u4e00\u6b21result\uff0c\u4eceresult\u91cc\u9762\u627e\u5230id=\"env_2\"\u7684\u90a3\u6761\u6570\u636e\uff0c\u63a5\u7740\u53bbappend\u5230\u4ed6\u7684children\u3002 \u8fd9\u6837\u65f6\u95f4\u590d\u6742\u5ea6\u4f1a\u975e\u5e38\u9ad8\uff0c\u4f46\u662f\u5982\u679c\u6211\u4eec\u63d0\u524d\u8bb0\u5f55\u4e86\uff0c\u6211\u73af\u5883id=2\u7684\u65f6\u5019\u63d2\u5165\u5230result\u7684\u7b2c\u51e0\u4e2achildren\uff0c\u90a3\u4e48\u5c31\u7701\u7565\u4e86\u4ece\u6570\u7ec4\u4e2d\u67e5\u8be2\u7684\u90a3\u6b65\uff0c\u7b49\u4e8e\u7528 \u7a7a\u95f4 \uff08env_idx\uff09\u6362\u4e86 \u67e5\u8be2\u7684\u65f6\u95f4 \u3002 \ud83c\udf66 \u5b8c\u6210\u7b2c\u4e00\u5c42\u6570\u636e\u5f55\u5165 \u63a5\u7740\u83b7\u53d6session\uff0c\u5e76\u67e5\u51fa\u6240\u6709\u6ca1\u88ab\u5220\u9664\u7684database\u6570\u636e \u53ef\u4ee5\u770b\u5230\uff0c\u6211\u4eec\u904d\u5386\u62ff\u5230\u7684 PityDatabase \u6570\u636e\uff0c\u63a5\u7740\u4eceenv_map\u91cc\u628a \u73af\u5883id \u8f6c\u4e3a \u73af\u5883\u540d \u3002 \u518d\u5f00\u59cb\u5224\u65adenv_index\u91cc\u9762\u73af\u5883\u540d\u7684\u7d22\u5f15\uff0c\u5728result\u7684\u7b2c\u51e0\u4e2a\uff0c\u5982\u679c\u6ca1\u6709\u7684\u8bdd\uff0c\u8bf4\u660eresult\u91cc\u9762\u8fd8\u6ca1\u6709\u8fd9\u4e2a\u73af\u5883\u7684\u4efb\u4f55\u6570\u636e\u3002 \u90a3\u6211\u4eec\u5c31\u63d2\u5165\u4e00\u6761 \u73af\u5883\u6570\u636e \u3002 result.append(dict(title=name, key= f\"env_ {name} \" , children=list())) \u90a3\u6b64\u65f6result\u5c31\u53d8\u6210\u4e86: [ {title: \"fat\" , key: \"env_3\" . children: []} ] \u8fd9\u662f\u73af\u58833\u5728result\u7684\u7d22\u5f15\u80af\u5b9a\u662f\u6570\u7ec4\u7684\u6700\u540e\u4e00\u4e2a\u5143\u7d20\uff0c\u56e0\u4e3a\u6211\u4eec\u521a\u521a\u624dappend\u8fdb\u53bb\u7684\uff0c\u6240\u4ee5idx = len(result)-1 \u63a5\u7740\u6211\u4eec\u628aidx\u5b58\u8d77\u6765\uff0c\u8fd9\u4e2a\u53ef\u4ee5\u7406\u89e3\u7684\u5427~ MetaData \u662f\u6211\u4eec\u83b7\u53d6\u6570\u636e\u8868\u7684\u5173\u952e\uff0c\u4e3a\u4e86\u907f\u514d\u91cd\u590d\u751f\u6210\uff0c\u6211\u8fd9\u8fb9\u53ea\u5728\u6700\u5916\u5c42\u751f\u6210\u4e86\uff0c\u4f20\u9012\u7ed9 get_tables \u65b9\u6cd5\u3002 \ud83d\udcd2 \u5b9e\u73b0\u5185\u5c42\u6570\u636e \u6ce8\u610f\u8fd9\u91cc\u6211\u7528get_tables\u65b9\u6cd5\u7684\u65f6\u5019\uff0c\u5c06result[idx]['children']\u53c2\u6570\u4f20\u4e86\u8fdb\u53bb\uff0c\u610f\u5473\u7740 \u540e\u7eed\u6240\u6709\u7684\u6570\u636e \u90fd\u4f1aappend\u5230\u8fd9\u4e2achildren\u91cc\u9762\u53bb\uff0c \u5341\u5206\u65b9\u4fbf \u3002 \u800cchildren\u662f\u4e2alist\uff0clist\u662f \u5f15\u7528\u4f20\u9012 \u7684\u3002\u6240\u4ee5\u6211\u5728get_tables\u91cc\u9762\u5bf9list\u7684\u6539\u52a8\uff0c\u5176\u5b9e\u4e5f\u662f\u751f\u6548\u7684\uff0c\u53ef\u4ee5\u770b\u5230get_tables\u6ca1\u6709\u4efb\u4f55\u8fd4\u56de\uff0c\u90a3\u662f\u56e0\u4e3a\u6211\u7684result\u91cc\u5934\u7684children\u88ab\u6539\u6389\u4e86\uff0c\u5bfc\u81f4\u4e86\u6211\u7684result\u95f4\u63a5\u88ab\u6539\u6389\u4e86\uff0c \u5c31\u8fd9\u4e2a\u9053\u7406 \u3002 \ud83c\udf66 \u770b\u770bget_tables\u600e\u4e48\u5199 \u6211\u4eec\u5148\u901a\u8fc7db_helper\u83b7\u53d6\u5230\u5f53\u65f6\u7684\u8fde\u63a5conn\uff0c\u91cc\u9762\u5305\u542b\u4e86session\u548cengine\uff0c\u8fd8\u8bb0\u5f97\u4e0d\uff1f \u6211\u4eec\u518d\u6b21\u65b0\u5efa\u4e00\u4e2alist\uff0c\u53ebdatabase_child\uff0c\u770b\u540d\u5b57\u5c31\u77e5\u9053\uff0c\u4ed6\u662fdatabase\u518d\u4e0b\u9762\u4e00\u5c42\u7684\u6570\u636e\u3002 \u6211\u4eec\u7f16\u5199\u5f53\u524ddatabase\u5c42\u7684\u8282\u70b9\u6570\u636e\uff0c\u5176\u5b9e\u5c31\u662f\u4e2adict\uff0ctitle\u56e0\u4e3a\u6211\u4eec\u9700\u8981\u5c55\u793a\u5bf9\u5e94\u7684\u6570\u636e\u5e93ip+port\uff0c\u6240\u4ee5\u662f\u8fd9\u6837: f\"{data.database}\uff08{data.host}:{data.port}\uff09\" \u56e0\u4e3adatabase\u6709\u552f\u4e00id\uff0c\u6240\u4ee5key\u53ef\u4ee5\u53eb\u300edatabase_{data.id}\u300f children\u5373\u662f\u4e0a\u4e00\u6b65\u521b\u5efa\u7684list(). \u83b7\u53d6engine meta\u83b7\u53d6\u8868\u4fe1\u606f \u904d\u5386\u8868 \u8fd9\u8fb9\u518d\u6b21\u8bf4\u660e\u4e00\u4e0b\uff0cget_tables\u53c2\u6570\u4e2d\u7684children\uff0c\u662f\u73af\u5883\u7684\u4e0b\u4e00\u5c42\uff0cdatabase_child\u662f\u6570\u636e\u5e93\u7684\u4e0b\u4e00\u5c42\uff0c\u800cdbs\u5219\u662f\u5f53\u524d\u5c42\u6b21\u3002 \u904d\u5386\u8868\u4e86\u4ee5\u540e\uff0c\u6211\u4eec\u4e34\u65f6\u521b\u5efatemp\u6570\u7ec4\uff08temp\u662f\u6570\u636e\u8868\u7684\u4e0b\u4e00\u5c42\uff0c\u5b9e\u9645\u4e0a\u5b58\u7684\u662f \u5b57\u6bb5\u4fe1\u606f \u3002\uff09 \u8fd9\u6bb5\u4ee3\u7801\u662f\u628atable\u8fd9\u4e00\u5c42\u52a0\u5230database_child\u6570\u7ec4\u91cc\u9762\u53bb \u5927\u5bb6\u5982\u679c\u5b9e\u5728\u770b\u4e0d\u660e\u767d\uff0c\u4ee5key\u4e3a\u6807\u51c6: key\u4ee5env\u5f00\u5934\u8bf4\u660e\u662f\u73af\u5883\u5c42 \u4ee5database\u5f00\u5934\u8bf4\u660e\u662f\u6570\u636e\u5e93\u5c42 \u4ee5table\u5f00\u5934\u8bf4\u660e\u662f\u6570\u636e\u8868\u5c42 \u4ee5column\u5f00\u5934\u8bf4\u660e\u662f\u5b57\u6bb5\u5c42 \u904d\u5386\u5b57\u6bb5\u6570\u636e\uff0c\u5e76\u628a\u5bf9\u5e94\u7684\u5b57\u6bb5\u52a0\u5230temp\u6570\u7ec4\uff0c\u56e0\u4e3a \u6539\u4e86temp\u6570\u7ec4 \uff0c\u6240\u4ee5\u5b9e\u9645\u4e0adatabase_child(\u8868\u90a3\u4e00\u5c42)\u4e5f\u5f97\u5230\u4e86\u6539\u52a8\u3002 primary_key\u5b57\u6bb5\u4ee3\u8868\u662f\u5426\u662f\u4e3b\u952e \u6700\u7ec8\u628a\u54b1\u4eec\u8fd9\u4e00\u5c42\u7684dbs->\u5e26\u6709\u8868\u6570\u636e->\u5e26\u6709\u5b57\u6bb5\u6570\u636e\uff0c\u7ed9\u52a0\u5165\u5230\u521a\u624d\u4f20\u9012\u7ed9\u54b1\u4eec\u7684children\u6570\u7ec4\u4e2d\u3002 \ud83d\udcd2 \u67e5\u770b\u5b8c\u6210\u6570\u636e \u53ef\u4ee5\u770b\u5230\u6570\u636e\u6b63\u5e38\u5c55\u793a\u4e86\uff0c\u548c\u524d\u7aef\u9700\u8981\u7684\u4e00\u6837 \u8fd9\u6837 \u524d\u7aef\u4ed4 \u5c31\u4e0d\u4f1a\u518d\u7ea0\u7ed3\u6570\u636e\u600e\u4e48\u8f6c\u6362\u4e86\uff0c \u975e\u5e38\u597d\u7528 \uff01 \ud83c\udf66 \u770b\u770b\u5b9e\u6218\u6548\u679c \u7531\u4e8e \u539f\u751f\u7ec4\u4ef6 \u63d0\u4f9b\u7684\u56fe\u6807\u5565\u7684\u90fd\u6bd4\u8f83\u7c97\u7cd9\uff0c\u6211\u4eec\u9700\u8981\u8fdb\u884c\u4e00\u4e0b\u8c03\u6574\u3002 \u518d\u6765\u4e00\u53d1\u6548\u679c\u56fe\uff0c\u7531\u4e8e\u53f3\u4fa7\u7684 SQL\u7f16\u8f91\u5668 \u8fd8\u5728\u8def\u4e0a\uff0c\u6211\u4eec\u5c31\u4e0d\u5e9f\u8bdd\u4e86\u3002","title":"54.\u6570\u636e\u5e93\u8868\u63a5\u53e3\u9002\u914d\u524d\u7aef\u9875\u9762(\u4e0b)"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2855%29%20%E5%BC%95%E5%85%A5AceEditor%28%E4%BB%A3%E7%A0%81%E7%BC%96%E8%BE%91%E5%99%A8%29/","text":"\u5927\u5bb6\u597d\uff0c\u6211\u662f\u7c73\u6d1b\uff0c\u6c42\u4e09\u8fde\uff01\u6c42\u5173\u6ce8 \u6d4b\u8bd5\u5f00\u53d1\u5751\u8d27 ! \ud83d\udcd2 \u56de\u987e \u6211\u4eec\u4e0a\u4e00\u8282\u5df2\u7ecf\u5199\u597d\u4e86 \u5de6\u4fa7 \u6570\u636e\u8868\u76ee\u5f55\uff0c\u4eca\u5929\u7ee7\u7eed\u5b8c\u6210sql\u7f16\u8f91\u5668\u7684\u90e8\u5206\u3002 \ud83d\udcd2 \u8c03\u7814\u7ec4\u4ef6 monaco \u56e0\u4e3a\u6211\u4eec\u7684\u9879\u76ee\u7528\u7684\u662f React \uff0c\u5e02\u9762\u4e0a\u5f88\u591a\u7f16\u8f91\u5668\u90fd\u662fjs\u7f16\u5199\uff0creact\u63d0\u4f9b\u4e86\u4e00\u5c42\u65b9\u4fbf\u7684\u5c01\u88c5\u3002 \u6bd4\u5982\u6211\u4eec\u5728 HTTP\u8c03\u8bd5 \u9875\u9762\u7528\u7684JSON\u7f16\u8f91\u5668\uff0c\u662f\u4ee5monaco\u4e3a\u539f\u578b\u5c01\u88c5\u6210\u7684 React\u7ec4\u4ef6 \u3002 \u8fd9\u4e2a\u5c31\u662fmonaco monaco\u5462\uff0c\u662f\u5fae\u8f6f\u5f00\u6e90\u7684\uff0c\u5927\u5bb6\u719f\u6089\u7684 VsCode \u5176\u5b9e\u5185\u90e8\u6838\u5fc3\u4e5f\u662fmonaco\u3002 \u4f18\u70b9\u662f\u7f8e\u89c2\uff0c\u4e13\u4e1a\uff0c\u7f3a\u70b9\u662f \u4f7f\u7528\u6bd4\u8f83\u590d\u6742 \u3002 AceEditor \u7528\u8fc7yapi\u7684\u4eba\u90fd\u77e5\u9053\uff0c\u91cc\u9762\u586b\u5199JSON_SCHEMA\u7684\u65f6\u5019\u7528\u5230\u4e86JSON\u7f16\u8f91\u5668\uff0c\u4f1a\u6821\u9a8c\u4f60\u7684 JSON\u683c\u5f0f \u3002\u91cc\u5934\u7684\u7f16\u8f91\u5668\u5c31\u662f AceEditor \u3002 \u6211\u89c9\u5f97\u5b83\u7684\u4f18\u70b9\u5c31\u662f\u529f\u80fd\u6bd4\u8f83\u5f3a\u5927\uff0c\u5305\u62ec\u4ee3\u7801\u8865\u5168\uff0cUI\u54cd\u5e94\u90fd\u505a\u7684\u5f88\u68d2\uff0c\u552f\u4e00\u7684\u7f3a\u70b9\u53ef\u80fd\u5c31\u662f \u4e3b\u9898 \u5f88\u5c11\uff0c\u4e0d\u592a\u597d\u770b\u3002 CodeMirror \u8fd9\u662f\u6211\u6700\u5f00\u59cb\u8c03\u7814\u8fc7\u7684\u4e00\u6b3e\u63d2\u4ef6\uff0c\u5305\u62ec\u5927\u540d\u9f0e\u9f0e\u7684 leetcode \u90fd\u662f\u7528\u7684\u5b83\u3002\u5982\u679c\u7528\u597d\u4e86\u81ea\u7136\u975e\u5e38 \u725b\u903c \uff0c\u4f46\u6211\u786e\u5b9e\u73a9\u4e0d\u592a\u8f6c\uff0c\u89c9\u5f97\u91cc\u9762\u7684API\u592a\u751f\u786c\u4e86\u3002 React\u5bf9\u5e94\u7684\u5b9e\u73b0: react-codemirror2 \u552f\u4e00\u7f3a\u70b9\u5c31\u662f\u4f7f\u7528\u56f0\u96be\uff0c \u9047\u5230\u95ee\u9898\u4e0d\u597d\u89e3\u51b3 \u3002 \ud83d\udcd2 \u6700\u7ec8\u9009\u578b \u7531\u4e8e AceEditor \u6211\u5728\u516c\u53f8\u5b9e\u73b0\u4e86\u4e00\u5957\uff0c\u4e3a\u4e86\u907f\u514d \u91cd\u590d\u9020\u8f6e\u5b50 \uff0c\u82b1\u66f4\u591a\u7684\u65f6\u95f4\u53bb\u641e\u4e00\u5957\u65b0\u7684\u3002\u6211\u51b3\u5b9a\u76f4\u63a5\u642c\u8fd0\u8fc7\u6765\u3002 \u5f53\u7136\u5982\u679c \u4ee5\u540e\u6709\u65f6\u95f4 \uff0c\u6211\u4f1a\u5411leetcode\u5b66\u4e60\uff0c\u505a\u4e00\u4e2a \u66f4\u597d\u7528 \u7684\u7f16\u8f91\u5668\u3002 \ud83d\udcd2 \u5c01\u88c5\u7f16\u8f91\u5668\u7ec4\u4ef6 \u7b80\u5355\u770b\u770b\u5c31\u884c \u63a5\u53d7value, \u8bed\u8a00\uff0c\u6539\u53d8value\u7684\u4e8b\u4ef6\u4ee5\u53ca\u9ad8\u5ea6\u548ctheme\u3002\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u5bf9\u7f16\u8f91\u5668\u7684\u4e3b\u9898\uff0c\u5185\u5bb9\u7b49\u8fdb\u884c \u5b8c\u7f8e\u63a7\u5236 \u3002 \u8fd8\u662f\u770b\u770b\u4e0b\u6700\u7ec8 \u9875\u9762\u6210\u679c \u5427~ \u9875\u9762\u5206\u4e3a3\u5757\uff0c\u5de6\u4fa7\u662f\u4e0a\u4e00\u8282\u7f16\u5199\u597d\u7684\u90e8\u5206\uff0c\u53f3\u4fa7\u4e0a\u534a\u90e8\u5206\u662f \u7f16\u8f91\u5668 \uff0c\u4e0b\u534a\u90e8\u5206\u662f \u8fd4\u56de\u7ed3\u679c \u3002 \u9009\u4e2ddb\u540e\u7684\u6548\u679c \u81ea\u52a8\u8865\u5168 \u5207\u6362\u4e3b\u9898 \u6267\u884c\u540e\u7684\u7ed3\u679c \u6e10\u6e10\u5730\u6210\u578b\u4e86\u4e00\u70b9~ \ud83d\udcd2 \u540e\u7aefbug\u4fee\u590d \u5148\u7ed9\u5927\u5bb6\u9053\u4e2a\u6b49\uff0c\u81ea\u5df1\u4e0a\u4e00\u8282\u5199\u7684 \u4ee3\u7801 \u6ca1\u6709\u7ecf\u8fc7 \u5f88\u4e25\u8c28 \u7684\u6d4b\u8bd5\uff0c\u5bfc\u81f4\u51fa\u4e86\u4e00\u4e9b\u95ee\u9898: \u95ee\u98981: \u591a\u4e2afat\u73af\u5883 \u8fd9\u4e2a\u95ee\u9898\u6211\u73b0\u5728\u662f\u4fee\u590d\u4e86 \u53ef\u4ee5\u770b\u5230\uff0c\u51fa\u73b0\u4e862\u4e2a fat \u6570\u636e\u3002 \u4ed4\u7ec6\u627e\u4e00\u4e0b\u539f\u56e0\uff0c\u53d1\u73b0\u662f\u8fd9\u91cc\u51fa\u4e86\u5c94\u5b50: \u8fd9\u91cc\u6211\u4eec\u6dfb\u52a0\u597d\u7b2c\u4e00\u4e2afat\u6570\u636e\u540e\uff0cidx=0\u5bf9\u4e0d\uff0c\u6240\u4ee5env_index\u91cc\u9762\u7684\u6570\u636e\u662f\u8fd9\u6837\u7684: env_idx = { \"fat\" : 0 } \u90a3\u4e48\u5f53\u7b2c\u4e8c\u4e2afat\u6765\u4e86\uff0c\u4f1a\u53d6\u5230idx=0\uff0c\u5224\u65ad if not idx \uff0c\u8fd9\u91ccnot idx\u81ea\u52a8\u9690\u5f0f\u8f6c\u6362\u4e3aTrue\u4e86\uff0c\u5bfc\u81f4\u53c8append\u4e86\u4e00\u6b21result\u3002 \u6240\u4ee5\u8fd9\u65f6\u5019\u6211\u4eec\u9700\u8981\u6362\u4e2a\u5224\u65ad\u65b9\u5f0f if idx is None \uff0c\u8fd9\u4e2a\u5224\u65ad\u4ee3\u8868\u5b57\u5178\u91cc\u9762\u6ca1\u6709\u8fd9\u4e2akey\u3002 \u8fd9\u6837\u5c31ok\u4e86 \u95ee\u98982: \u5929\u771f\u7684\u4ee5\u4e3aMetaData\u53ef\u4ee5\u590d\u7528 get_tables\u8fd9\u4e2a\u65b9\u6cd5 \u8fd8\u8bb0\u5f97get_tables\u91cc\u9762\u8fd9\u4e2ametadata\u53d8\u91cf\u5417\uff1f\u4e4b\u524d\u662f\u901a\u8fc7\u65b9\u6cd5\u4f20\u9012\u8fdb\u6765\u7684\u53c2\u6570\uff0c\u8fd9\u6837\u53ea\u9700\u8981\u5b9e\u4f8b\u5316MetaData()\u4e00\u6b21\u3002 \u4f46\u662f \u5751\u5c31\u5751\u5728 \uff0c\u540e\u7eed\u751f\u6210\u7684\u6570\u636e\uff0c\u4e5f\u4f1a\u5e26\u4e0a\u4e4b\u524d\u83b7\u5f97\u7684 \u8868\u4fe1\u606f \uff0c\u6240\u4ee5\u6211\u4eec\u8fd8\u662f\u4e0d\u80fd\u590d\u7528\u8fd9\u4e2a\u5bf9\u8c61\u3002 \ud83d\udcd2 \u6539\u9020online_sql\u65b9\u6cd5 \u524d\u9762\u6211\u4eec\u5df2\u7ecf\u5b9e\u73b0\u8fc7 \u5728\u7ebf\u6267\u884csql\u7684\u65b9\u6cd5 \u4e86\uff0c\u4f46\u662f\u4f1a\u53d1\u73b0\u6709\u4e00\u4e9b\u95ee\u9898\u3002 datetime\u4e0d\u662f\u6211\u4eec\u60f3\u8981\u7684 \u6240\u4ee5\u6211\u4eec\u9700\u8981\u81ea\u884c\u5904\u7406\uff0c\u62ff\u5230\u6211\u4eec\u6807\u51c6\u7684datetime\u3002 \u7f16\u51992\u4e2a\u65b0\u7684\u65b9\u6cd5\uff0c\u65b9\u6cd5json_serialize\u662f\u9488\u5bf9datetime\u6570\u636e\u8fdb\u884c\u5e8f\u5217\u5316 \u62ff\u5230\u5b57\u6bb5\u91cc\u9762\u7684keys()\uff0c\u4e5f\u5c31\u662f\u5217\u540d\uff0c\u7528\u4e8e\u524d\u7aef\u5c55\u793a\u3002 \u5bf9\u4e8eupdate\u8fd9\u79cd\u6ca1\u6709\u8fd4\u56de\u7ed3\u679c\u7684\u65b9\u6cd5\u6ca1\u6709\u517c\u5bb9 \u5982\u679csql\u6ca1\u6709\u8fd4\u56de\u503c\uff0c\u90a3\u4e00\u5b9a\u662fdelete/insert/update\u4e4b\u7c7b\u7684\u8bed\u53e5 \u6211\u4eec\u8fd4\u56de \u66f4\u65b0\u7684\u884c\u6570 \u5c31\u597d\uff0c\u4e0d\u7ba1\u662f \u589e\u5220 \u8fd8\u662f \u6539 \u3002 \u6dfb\u52a0 \u5168\u5c40loading \uff0c\u4f7f\u5f97\u4f53\u9a8c\u66f4\u597d\u3002 \u52a0\u8f7d\u6570\u636e\u8868\u7684\u8fc7\u7a0b\u4f1a\u6bd4\u8f83\u7f13\u6162 \ud83d\udcd2 \u540e\u7aef\u672a\u6765\u4f18\u5316 \u7531\u4e8e\u6570\u636e\u8868\u4e0d\u4f1a\u4e00\u76f4\u4fee\u6539\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u4ed6\u4eec\u7684\u6570\u636e\u653e\u5230 redis \u4e4b\u4e2d\u3002\u8fd9\u6837\u6211\u4eec\u6548\u7387\u4f1a\u63d0\u9ad8\u5f88\u591a\uff0c\u52a0\u8f7d\u901f\u5ea6\u4e5f\u4e0d\u4f1a\u50cf\u73b0\u5728\u8fd9\u4e48\u6162\u3002 \u6700\u540e\uff0cpg\u7684\u652f\u6301\u8fd8\u4e0d\u662f\u5f88\u5b8c\u5584\uff0c\u76ee\u524d\u6765\u8bf4\u5904\u4e8e\u5f85\u6d4b\u72b6\u6001\uff0c\u6709\u611f\u5174\u8da3\u7684\u5c0f\u4f19\u4f34\u53ef\u4ee5\u63d0\u4f9b\u4e0bpg\u7684\u8fde\u63a5\u6216\u8005\u81ea\u6d4b\u4e00\u4e0b\u3002 \u6570\u636e\u5e93\u7684\u914d\u7f6e\u9700\u8981\u7ba1\u7406\u5458\uff0c\u5982\u679c\u4f60\u4e0d\u662f\u53ef\u4ee5\u8054\u7cfb\u6211\uff0c\u6211\u7ed9\u4f60\u6dfb\u52a0\u3002 \u4eca\u5929\u7684\u5185\u5bb9\u5c31\u6e2f\uff08\u809d\uff09\u5230\u8fd9\u91cc\u4e86\uff0c\u6570\u636e\u5e93\u8fd9\u5757\u603b\u7b97\u544a\u4e00\u6bb5\u843d\u4e86~\u5927\u5bb6 \u5468\u672bhappy ~ \u6587\u6863\u5730\u5740: https://pity.readthedocs.org","title":"55.\u5f15\u5165AceEditor(\u4ee3\u7801\u7f16\u8f91\u5668)"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2856%29%20JSON%E6%B7%B1%E5%B1%82%E6%AC%A1%E5%AF%B9%E6%AF%94%E6%96%B9%E6%A1%88/","text":"\u5927\u5bb6\u597d\uff0c\u6211\u662f\u7c73\u6d1b\uff0c\u6c42\u4e09\u8fde\uff01\u6c42\u5173\u6ce8 \u6d4b\u8bd5\u5f00\u53d1\u5751\u8d27 ! \ud83d\udcd2 \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u5f15\u5165\u4e86 AceEditor \u5e2e\u52a9\u6211\u4eec\u5728\u7ebf\u6267\u884c/\u8c03\u8bd5SQL\u8bed\u53e5\uff0c\u8fd9\u4e00\u5c4a\u6211\u4eec\u8bb2\u70b9\u513f \u65ad\u8a00 \u76f8\u5173\u7684\u5185\u5bb9\u3002 \ud83d\udcd2 \u6570\u636e\u6bd4\u5bf9 \u5728 \u63a5\u53e3\u6d4b\u8bd5 \u4e2d\uff0c\u6211\u4eec\u5e38\u5e38\u9700\u8981\u5bf9\u63a5\u53e3\u7684\u8fd4\u56de\u53c2\u6570\u8fdb\u884c \u6821\u9a8c \u3002\u5982\u679c\u91c7\u7528\u6570\u636e\u9a71\u52a8\u7684\u65b9\u5f0f\uff0c\u6d89\u53ca\u5230\u591a\u7ec4\u5165\u53c2/\u51fa\u53c2\u7684\u6bd4\u5bf9\u7684\u60c5\u51b5\u4e0b\uff0c\u600e\u4e48\u5bf9\u9884\u671fjson\u548c\u5b9e\u9645json\u8fdb\u884c\u4e00\u4e2a\u5168\u65b9\u4f4d\u7684\u5bf9\u6bd4\u5462\uff1f \u4eca\u5929\uff0c\u4ed6\u6765\u4e86\u3002 \u5176\u5b9e\u8fd9\u4e2a\u8bdd\u9898\u5f88\u65e9\u4ee5\u524d\u6e90\u81ea\u4e8e \u866b\u5e08selenium\u7fa4 \uff0c \u5927\u5e08\u5144 \u5bf9 \u7cbe\u54e5 \u7684\u6307\u70b9\uff0c\u800c\u6211\u548c\u996d\u4f6c\uff0c\u5c5e\u4e8e \u5077\u5e08\u6210\u529f \u7684\u5178\u8303\u3002 \u4e0d\u8fc7\u6211\u5728\u8fd9\u4e2a\u57fa\u7840\u4e0a\u4e5f\u52a0\u4e86\u4e00\u70b9\u81ea\u5df1\u7684\u4e1c\u897f\uff0c\u6700\u7ec8\u6548\u679c\u662f\u4e00\u6837\u7684\u3002 \ud83d\udcd2 \u6838\u5fc3\u70b9 \u8fd9\u4e2a\u7b97\u6cd5\u7684\u6838\u5fc3\u70b9\u5c31\u5728\u4e8e\u9012\u5f52\uff0c\u4e00\u5c42\u4e00\u5c42\u53bb\u9012\u5f52\uff0c\u6700\u7ec8\u8fbe\u5230 \u62ff\u5230 \u6240\u6709\u5dee\u5f02\u7684\u8fc7\u7a0b\u3002 \ud83d\udcd2 \u5177\u4f53\u4e00\u70b9 \u5177\u4f53\u4e00\u70b9\uff0c\u5047\u8bbe\u6211\u4eec\u73b0\u5728\u67092\u4e2ajson\u5bf9\u8c61\uff0c\u5206\u522b\u662f: # \u9884\u671f\u7ed3\u679c a = \"\"\" { \"name\": \"lixiaoyao\", \"age\": 19, \"wife\": [\"linyueru\", \"zhaolinger\"], \"job\": { \"yuhang\": \"\u6df7\u6df7\", \"suzhou\": \"\u6797\u5bb6\u5821\u59d1\u7237\", \"suoyaota\": \"\u4ed9\u5251\u6d3e\u5f1f\u5b50\" } } \"\"\" # \u5b9e\u9645\u7ed3\u679c b = \"\"\" { \"name\": \"lixiaoyao\", \"age\": 23, \"wife\": [\"anu\", \"zhaolinger\"], \"job\": { \"yuhang\": \"\u6df7\u6df7\", \"suzhou\": \"\u6797\u5bb6\u5821\u59d1\u7237\", \"suoyaota\": \"\u4ed9\u5251\u6d3e\u5b50\u5f1f\" } } \"\"\" \u4e0d\u4ed4\u7ec6\u770b\u8fd8\u633a\u96be\u53d1\u73b0\u8fd9\u91cc\u9762\u7684 \u5dee\u5f02 \uff0c\u56e0\u4e3ajson\u5185\u5bb9\u4e0d\u7b97\u5f88\u5c11\uff0c\u6240\u4ee5\u8089\u773c\u6bd4\u8f83\u96be\u770b\u51fa\u6765\u3002 \u90a3\u4e48\u6211\u4eec\u4f55\u4e0d\u5229\u7528\u4ee3\u7801\uff0c\u53bb\u5e2e\u6211\u4eec \u667a\u80fd\u5bf9\u6bd4 \u5462\uff1f \ud83d\udcd2 \u6b65\u6b65\u4e3a\u8425 \ud83c\udf66 \u786e\u8ba4\u53c2\u6570 \u9996\u5148\u6211\u4eec\u9700\u8981\u77e5\u9053\u6211\u4eec\u8981\u6bd4\u5bf9\u4ec0\u4e48\uff0c\u5176\u5b9e\u5c31\u662f2\u4e2astring\uff0c\u4f46\u4ed6\u4eec\u662f JSON\u683c\u5f0f \u7684\u3002 \u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u786e\u5b9a\u597d2\u4e2a\u57fa\u672c\u53c2\u6570: def compare(a: str, b: str) a \u9884\u671f\u7ed3\u679c b \u5b9e\u9645\u7ed3\u679c \u4f46\u662f\u6211\u4eec\u9700\u8981\u6df1\u5c42\u6b21\u6bd4\u5bf9\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u989d\u5916\u4f20\u5165\u4e00\u4e9b\u6570\u636e: ans \u7528\u6765\u5b58\u653e\u6bd4\u5bf9\u7684\u4fe1\u606f\uff0c\u6bd4\u5982 123 != 124 path \u8fd9\u4e2a\u7528\u6765\u5b58\u653e\u5f53\u524d\u7684\u8def\u5f84\uff0c\u6bd4\u5982\u4e0a\u8ff0\u4f8b\u5b50\u7684job->suoyaota\u8fd9\u4e2a\u5730\u65b9\u7684\u503c\u5c31\u4e0d\u4e00\u6837\uff0c\u4e00\u4e2a\u662f \u4ed9\u5251\u6d3e\u5f1f\u5b50 \uff0c\u53e6\u4e00\u4e2a\u662f \u4ed9\u5251\u6d3e\u5b50\u5f1f \uff0c\u6240\u4ee5\u6211\u4eec\u4e0d\u4f46\u8981\u8bb0\u5f55\u503c\uff0c\u8fd8\u8981\u8bb0\u5f55\u4ed6\u7684\u8def\u5f84\u3002 \ud83c\udf66 \u601d\u8003 \u5728Python\u4e2d\uff0c\u6570\u636e\u7ed3\u6784\u8f83\u4e3a\u7b80\u5355\uff0c\u6211\u4eec\u770b\u770bJSON\u5e8f\u5217\u5316JSONDecoder\u7c7b \u5c31\u80fd\u5927\u6982\u77e5\u9053\u4e86: \u53ef\u4ee5\u770b\u5230\uff0c\u57fa\u672c\u4e0ajson\u7684\u6570\u636e\u7c7b\u578b\u80fd\u591f\u5bf9\u5e94\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u518d\u7b80\u5316\u4e00\u4e0b: \u80fd\u7ee7\u7eed\u6df1\u5165\u5bf9\u6bd4 \u548c \u4e0d\u80fd\u7ee7\u7eed\u6df1\u5165\u5bf9\u6bd4 \u8fd92\u79cd\u3002 \u4ec0\u4e48\u610f\u601d\u5462\uff1f \u6bd4\u5982a\u548cb\u7684name\u90fd\u662flixiaoyao\uff0clixiaoyao\u662f\u4e2a \u5b57\u7b26\u4e32 \uff0c\u5f53\u5b83\u4e0d\u4e3ajson\u5b57\u7b26\u4e32\u7684\u65f6\u5019\uff0c\u662f\u4e00\u4e2a \u4e0d\u80fd\u7ee7\u7eed\u6df1\u5165\u5bf9\u6bd4 \u7684\u6570\u636e\u3002 \u6240\u4ee5\u6b64\u65f6\u6211\u4eec\u7684\u9012\u5f52\u5230\u8fd9\u4e00\u5c42\u5c31\u5e94\u8be5\u7ec8\u6b62\uff0c\u76f4\u63a5\u6bd4\u5bf9a\u548cb\u7684name\u5b57\u6bb5\uff0c\u5982\u679c\u4e0d\u4e00\u6837\uff0c\u6839\u636epath\uff0c\u628adiff\u7ed3\u679c\u6dfb\u52a0\u5230ans\u4e2d\u3002 \u90a3\u4ec0\u4e48\u53c8\u662f\u53ef\u6df1\u5165\u6bd4\u8f83\u5bf9\u8c61\u5462\uff1f\u6211\u8ba4\u4e3a\u67093\u79cd: List Python\u7684\u6570\u7ec4\u91cc\u9762\u53ef\u4ee5\u7ee7\u7eed\u904d\u5386\uff0c\u91cc\u9762\u8fd8\u6709\u53ef\u80fd\u7ee7\u7eed\u6709json\u6570\u636e\uff0c\u6240\u4ee5\u53ef\u7ee7\u7eed\u5bf9\u6bd4\u3002 Dict \u8fd9\u4e2a\u4e0d\u7528\u591a\u8bf4\u4e86\uff0c\u5927\u5bb6\u90fd\u77e5\u9053\u8fd9\u4e2a\u662f\u6700\u5bb9\u6613 \u75af\u72c2\u5d4c\u5957 \u7684\u3002 JSON\u5b57\u7b26\u4e32 \u6ce8\u610f\u4ed6\u5176\u5b9e\u662f\u5b57\u7b26\u4e32\u7684\u4e00\u79cd\uff0c\u53ea\u4e0d\u8fc7\u4ed6\u80fd\u88ab\u53cd\u5e8f\u5217\u5316\u4e3a \u53ef\u7ee7\u7eed\u904d\u5386 \u7684\u5bf9\u8c61\u3002 \ud83d\udcd2 \u7f16\u5199\u8f6c\u6362\u4e3aPython\u5bf9\u8c61\u7684\u65b9\u6cd5 def _to_json (string) : try : float(string) return string except : try : if isinstance(string, str): return json.loads(string) return string except : return string \u9996\u5148\u6211\u4eec\u62ff\u5230\u7684\u6570\u636e\u662f \u6211\u4eec\u671f\u671b\u5b83 \u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u6211\u4eec\u6700\u5148\u5224\u65ad\u5b83\u662f\u4e0d\u662f\u6570\u503c\u7c7b\u578b\uff0c\u5982\u679c\u662f\uff0c\u76f4\u63a5\u8fd4\u56de\u8fd9\u4e2a\u5b57\u7b26\u4e32\u3002 \u4e3a\u4ec0\u4e48\u5462\uff1f\u56e0\u4e3a\u8fd9\u4e2a\u5b57\u7b26\u4e32\u5982\u679c\u662f\u6570\u503c\u7c7b\u578b\uff0c\u90a3\u4e48\u4ed6\u5df2\u7ecf\u786e\u5b9a\u4e0d\u53ef\u7ee7\u7eed\u904d\u5386\u4e86\uff0c\u6211\u4eec\u628a\u5b83\u539f\u8def\u8fd4\u56de\u3002 \u4f46\u56e0\u4e3a\u4ed6\u4e5f\u53ef\u80fd\u4e0d\u662f\u5b57\u7b26\u4e32\u800c\u662fPython\u5bf9\u8c61\u6bd4\u5982dict\u6216\u8005\u5176\u4ed6\u6570\u636e\uff0c\u6240\u4ee5\u6211\u4eec\u63a5\u7740\u5224\u65ad\u4ed6\u662f\u4e0d\u662f\u5b57\u7b26\u4e32\uff0c\u5982\u679c\u80fd\u88ab\u53cd\u5e8f\u5217\u5316\u53c8\u4e0d\u662f\u6570\u503c\u7684\u8bdd\uff0c\u90a3\u8bf4\u660e\u4ed6\u5c31\u662f JSON\u5b57\u7b26\u4e32 \uff0c\u5982\u679c\u901a\u901a\u4e0d\u662f\uff0c\u90a3\u6211\u4eec\u628a\u6570\u636e\u539f\u8def\u8fd4\u56de\u3002 \u8fd9\u4e00\u6b65\u53ea\u662f\u4e3a\u4e86\u7b5b\u9009\u51fa\u5b57\u7b26\u4e32\u5185\u5bb9\u4e3aJSON\u7684\u6570\u636e\uff0c\u5982\u679c\u4e0d\u662f\u5219\u76f4\u63a5\u8fd4\u56de\u4e4b\u524d\u7684\u6570\u636e\u3002 \ud83d\udcd2 \u7f16\u5199_compare\u6838\u5fc3\u65b9\u6cd5 def _compare (self, a, b, ans, path) : a = self._to_json(a) b = self._to_json(b) if type(a) != type(b): ans.append( f\" {self._weight(path)} \u7c7b\u578b\u4e0d\u4e00\u81f4, \u5206\u522b\u4e3a {type(a)} {type(b)} \" ) return if isinstance(a, dict): keys = [] for key in a.keys(): pt = path + \"/\" + key if key in b.keys(): self._compare(a[key], b[key], ans, pt) keys.append(key) else : ans.append( f\" {self._weight(pt)} \u5728\u540e\u8005\u4e2d\u4e0d\u5b58\u5728\" ) for key in b.keys(): if key not in keys: pt = path + \"/\" + key ans.append( f\" {self._weight(pt)} \u5728\u540e\u8005\u4e2d\u591a\u51fa\" ) elif isinstance(a, list): i = j = 0 while i < len(a): pt = path + \"/\" + str(i) if j >= len(b): ans.append( f\" {self._weight(pt)} \u5728\u540e\u8005\u4e2d\u4e0d\u5b58\u5728\" ) i += 1 j += 1 continue self._compare(a[i], b[j], ans, pt) i += 1 j += 1 while j < len(b): pt = path + \"/\" + str(j) ans.append( f\" {self._weight(pt)} \u5728\u524d\u8005\u4e2d\u4e0d\u5b58\u5728\" ) j += 1 else : if a != b: ans.append( f\" {self._weight(path)} \u6570\u636e\u4e0d\u4e00\u81f4: {JsonService._color(a)} \" f\"!= {self._color(b, 1 )} \" if path != \"\" else f\"\u6570\u636e\u4e0d\u4e00\u81f4: {self._color(a)} != {JsonService._color(b, 1 )} \" ) \u5148\u7528_to_json\u8f6c\u4e3aPython\u5bf9\u8c61\uff0c\u83b7\u5f97 a \u548c b \u3002\u63a5\u7740\u5224\u65ad\u4ed6\u4eec\u7684\u7c7b\u578b\u662f\u5426\u4e00\u81f4\uff0c\u5982\u679c\u4e0d\u4e00\u81f4\u5219 \u6ca1\u5fc5\u8981 \u7ee7\u7eed\u6bd4\u8f83\u4e86\uff0c\u6bd4\u5982\u4e00\u4e2a\u662flist\uff0c\u53e6\u4e00\u4e2a\u662fdict\uff0c\u6839\u672c\u6ca1\u6709\u6bd4\u8f83\u7684\u610f\u4e49\uff0c\u76f4\u63a5ans.append\u9519\u8bef\u4fe1\u606f\u5373\u53ef\uff0c\u8bb0\u5f97\u5e26\u4e0apath\u53c2\u6570\u3002 self._weight\u662f\u4e3a\u4e86\u5728html\u65e5\u5fd7\u4e2d\u66f4\u597d\u5730\u5c55\u793a\u6548\u679c\uff0c\u52a0\u4e86\u4e00\u4e9bstyle\u6837\u5f0f\uff0c\u53ef\u4ee5\u5148\u5ffd\u7565\u3002 \u5982\u679c\u7c7b\u578b\u4e5f\u4e00\u81f4\u4e86\uff0c\u6211\u4eec\u7ee7\u7eed\u6765\u770ba\u662f\u4ec0\u4e48\u7c7b\u578b\u3002 \u5982\u679c\u662f\u5b57\u5178 \u6211\u4eec\u7684\u6bd4\u8f83\u662f\u4ee5a\uff08\u9884\u671f\u7ed3\u679c\uff09\u4e3a\u5355\u4f4d\u7684\uff0c\u6240\u4ee5\u4e00\u5207\u4ee5a\u4e3a\u6807\u51c6\u3002 \u90a3\u4e48\u6211\u4eec\u904d\u5386a\u548cb\u7684keys\uff0c\u5206\u522b\u627e\u51faa\u5b57\u5178\u91cc\u9762\u6709\uff0cb\u5b57\u5178\u6ca1\u6709\u7684key\uff0c\u548cb\u5b57\u5178\u91cc\u9762\u6709\uff0c\u800ca\u5b57\u5178\u91cc\u9762\u6ca1\u6709\u7684key\u3002 \u6ce8\u610f\uff0c\u8fd9\u91cc\u4ee3\u7801\u53ef\u4ee5\u7b80\u5316\uff0c\u5b57\u5178\u7684keys\u662f\u652f\u6301\u96c6\u5408\u64cd\u4f5c\u7684\uff0c\u4ea4\u7531\u5927\u5bb6\u601d\u8003\u4f18\u5316\u3002 \u4e2d\u95f4\u53bb\u904d\u5386\u4e86a\u548cb\u90fd\u6709key\uff0c\u7136\u540e\u7ee7\u7eed\u8c03\u7528\u4e86self._compare\u65b9\u6cd5\uff0c\u5e76\u628apath\u6539\u4e3a\u4e86path+\"/\"+key\uff0c\u8fd9\u6837\u7684\u8bdd\u8def\u5f84\u5c31\u4e3a\u5b57\u5178\u7684\u6df1\u4e00\u5c42\u7684\u8def\u5f84\u4e86\uff0c\u7ee7\u7eed\u9012\u5f52\u8c03\u7528\u3002 \u5982\u679c\u662flist \u4e0edict\u5176\u5b9e\u7c7b\u4f3c\uff0c\u5b9a\u4e49\u4e862\u4e2a\u6307\u9488\uff0c\u4f9d\u6b21\u8d70\u5b8c2\u4e2a\u6570\u7ec4\uff0c\u5f53a\u6570\u7ec4\u5df2\u7ecf\u8d70\u5b8c\u4e86\uff0cb\u91cc\u9762\u8fd8\u6709\u503c\uff0c\u5c31\u628ab\u91cc\u9762\u5269\u4e0b\u7684\u503c\uff08\u5c5e\u4e8e\u591a\u51fa\u7684\u4fe1\u606f\uff09\u90fd\u6dfb\u52a0\u5230 \u9519\u8bef\u4fe1\u606f \u4e4b\u4e2d\u3002 \u5176\u4e2d\u4e5f\u83b7\u53d6\u4e86\u65b0\u7684path\uff0c\u53ea\u4e0d\u8fc7\u6570\u7ec4\u662f\u7528\u7684\u7d22\u5f15\uff0c\u800cdict\u7528\u7684\u662fkey\u4f5c\u4e3a\u8def\u5f84\u3002 \u63a5\u7740\u9012\u5f52\u3002\u3002\u3002 \u5982\u679c\u4e0d\u662f\u8fd92\u79cd \u6ce8\u610f\u8fd9\u91cc\u662f\u9012\u5f52\u7ed3\u675f\u7684\u6761\u4ef6\uff0c\u90a3\u6211\u4eec\u76f4\u63a5\u6bd4\u8f83\u3002\u6570\u636e\u4e0d\u4e00\u81f4\uff0c\u5219\u628a \u4e0d\u4e00\u81f4\u7684\u6570\u636e \u5199\u5230ans\u6570\u7ec4\u4e2d\u3002 \u5927\u4f53\u601d\u8def\u5c31\u662f\u8fd9\u6837\uff0c\u7ed9\u5927\u5bb6\u770b\u770bcolor\u548cweight\u3002 \ud83d\udcd2 \u6d4b\u9a8c\u521a\u624d\u7684\u7ed3\u679c \u4e3a\u4e86\u65b9\u4fbf\u663e\u793adiff\uff0c\u6211\u53d6\u6d88\u4e86\u6587\u5b57\u9ad8\u4eae \u53ef\u4ee5\u770b\u5230age\u4e0d\u4e00\u6837\uff0c\u8001\u5a46\u4e0d\u4e00\u6837\uff0c\u9501\u5996\u5854\u7684 \u804c\u4e1a \u4e5f\u4e0d\u4e00\u6837\u3002\u6240\u4ee5\uff0c\u4f60\u5b66\u8d39\u4e86\u5417\uff1f \ud83d\udcd2 \u63d0\u9ad8\u70b9 \u4f18\u5316\u5b57\u5178\u4e4b\u95f4\u7684key \ud83d\udcd2 \u6700\u7ec8\u6e90\u7801+\u6d4b\u8bd5\u4ee3\u7801 import json class JsonCompare : def compare (self, exp, act) : ans = [] self._compare(exp, act, ans, '' ) return ans def _compare (self, a, b, ans, path) : a = self._to_json(a) b = self._to_json(b) if type(a) != type(b): ans.append( f\" {path} \u7c7b\u578b\u4e0d\u4e00\u81f4, \u5206\u522b\u4e3a {type(a)} {type(b)} \" ) return if isinstance(a, dict): keys = [] for key in a.keys(): pt = path + \"/\" + key if key in b.keys(): self._compare(a[key], b[key], ans, pt) keys.append(key) else : ans.append( f\" {pt} \u5728\u540e\u8005\u4e2d\u4e0d\u5b58\u5728\" ) for key in b.keys(): if key not in keys: pt = path + \"/\" + key ans.append( f\" {pt} \u5728\u540e\u8005\u4e2d\u591a\u51fa\" ) elif isinstance(a, list): i = j = 0 while i < len(a): pt = path + \"/\" + str(i) if j >= len(b): ans.append( f\" {pt} \u5728\u540e\u8005\u4e2d\u4e0d\u5b58\u5728\" ) i += 1 j += 1 continue self._compare(a[i], b[j], ans, pt) i += 1 j += 1 while j < len(b): pt = path + \"/\" + str(j) ans.append( f\" {pt} \u5728\u524d\u8005\u4e2d\u4e0d\u5b58\u5728\" ) j += 1 else : if a != b: ans.append( f\" {path} \u6570\u636e\u4e0d\u4e00\u81f4: {a} \" f\"!= {b} \" if path != \"\" else f\"\u6570\u636e\u4e0d\u4e00\u81f4: {a} != {b} \" ) def _color (self, text, _type= 0 ) : if _type == 0 : # \u8bf4\u660e\u662f\u7eff\u8272 return \"\"\"<span style=\"color: #13CE66\">{}</span>\"\"\" .format(text) return \"\"\"<span style=\"color: #FF4949\">{}</span>\"\"\" .format(text) def _weight (self, text) : return \"\"\"<span style=\"font-weight: 700\">{}</span>\"\"\" .format(text) def _to_json (self, string) : try : float(string) return string except : try : if isinstance(string, str): return json.loads(string) return string except : return string if __name__ == \"__main__\" : # \u9884\u671f\u7ed3\u679c a = \"\"\" { \"name\": \"lixiaoyao\", \"age\": 19, \"wife\": [\"linyueru\", \"zhaolinger\"], \"job\": { \"yuhang\": \"\u6df7\u6df7\", \"suzhou\": \"\u6797\u5bb6\u5821\u59d1\u7237\", \"suoyaota\": \"\u4ed9\u5251\u6d3e\u5f1f\u5b50\" } } \"\"\" # \u5b9e\u9645\u7ed3\u679c b = \"\"\" { \"name\": \"lixiaoyao\", \"age\": 23, \"wife\": [\"anu\", \"zhaolinger\"], \"job\": { \"yuhang\": \"\u6df7\u6df7\", \"suzhou\": \"\u6797\u5bb6\u5821\u59d1\u7237\", \"suoyaota\": \"\u4ed9\u5251\u6d3e\u5b50\u5f1f\" } } \"\"\" obj = JsonCompare() ans = obj.compare(a, b) print(ans)","title":"56.JSON\u6df1\u5c42\u6b21\u5bf9\u6bd4\u65b9\u6848"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2857%29%20%E7%BE%8E%E5%8C%96%E4%BB%A3%E7%A0%81%E7%BC%96%E8%BE%91%E5%99%A8/","text":"Hello, \u5927\u5bb6\u597d~\u6211\u662f\u7c73\u6d1b\uff0c\u6b22\u6ce8\u8fce\u6211\u7684\u5173\u516c\u53f7\u4f17 \u6d4b\u8bd5\u5f00\u53d1\u5751\u8d27 ! \ud83d\udcd2 \u56de\u987e \u4e0a\u8282\u6211\u4eec\u7f16\u5199\u4e86 JSON \u6bd4\u5bf9\u76f8\u5173\u65b9\u6cd5\uff0c\u867d\u7136\u8fd8\u6ca1\u6709\u8fd0\u7528\u5230 \u65ad\u8a00 \u4e4b\u4e2d\uff0c\u4f46\u4e1d\u6beb\u4e0d\u5f71\u54cd\u6211\u4eec \u63d2\u64ad \u53e6\u4e00\u7bc7\u6587\u7ae0\u3002 \u5176\u5b9e\u6211\u4eec\u7684 AceEditor \u5f15\u5165\u8bb8\u591a\u4e3b\u9898\u7684\u65f6\u5019\u4f1a\u6709\u4e9b\u5361\u987f\uff0c\u76ee\u524d\u8fd8\u4e0d\u77e5\u9053\u662f\u4e3b\u9898\u592a\u591a\u5462\uff0c\u8fd8\u662f \u8865\u5168\u4ee3\u7801 \u592a\u591a\uff0c\u6240\u4ee5\u6211\u4eec\u5148\u51cf\u5c11\u4e0b\u4e3b\u9898\u518d\u8bf4\u3002 \u4f46\u7531\u4e8e\u4e2a\u4eba\u4e00\u76f4\u6ca1\u6709\u7279\u522b\u559c\u6b22\u7684\u4e3b\u9898\uff0c\u6240\u4ee5\u5176\u5b9e\u5f88\u662f \u82e6\u607c \uff0c\u4f46\u6211\u770b\u5230leetcode\u7684\u4ee3\u7801\u7f16\u8f91\u5668\uff0c\u53c8\u5f88\u7fa1\u6155\uff0c\u5b83\u7684monaco-editor\u652f\u6301\u4e86material\uff0c\u5982\u56fe\u3002 leetcode\u7684\u7f16\u8f91\u5668\u5982\u6b64\u6f47\u6d12 \ud83d\udcd2 \u8c03\u7814\u4e00\u756a \u5728\u7ecf\u5386\u4e86 \u5404\u79cd\u8c03\u7814 \u4e4b\u540e\uff0c\u53d1\u73b0\u4e862\u4e2a\u6781\u54c1\u7f51\u7ad9\u3002 http://tmtheme-editor.herokuapp.com/#!/editor/theme/Material%20One%20Dark \u4e00\u952e\u751f\u6210\u4e3b\u9898\u6587\u4ef6 \u4f46\u662f\u4e3b\u9898\u6587\u4ef6\u662ftmTheme\u683c\u5f0f\u7684\uff0c\u4e0d\u662f\u592a\u597d\u7528\u3002 \u6700\u5de6\u4fa7\u53ef\u4ee5\u9009\u5404\u79cd\u4e3b\u9898 \u6211\u4eec\u627e\u5230\u81ea\u5df1\u6700\u60f3\u8981\u76842\u4e2a: material one dark\u548catom dark \u53ef\u4ee5\u770b\u5230\u4e3b\u9898\u975e\u5e38\u7cbe\u7f8e\uff0c\u662f\u6211\u60f3\u8981\u7684 \u70b9\u51fbDownload\u5c31\u53ef\u4ee5\u4e0b\u8f7d\u5230\u5bf9\u5e94\u7684\u4e3b\u9898\u6587\u4ef6\u5566\uff0c\u5176\u5b9e\u8fd9\u6587\u4ef6\u662f\u7528\u4e8evscode\u4e4b\u4e2d\u7684\uff0c\u4f46\u54b1\u4eec\u60f3\u5d4c\u5165WebIDE \u600e\u4e48\u5f04 \u5462\uff1f \u6211\u4eec\u8fd8\u6709\u4e0b\u9762\u4e00\u4e2a\u7f51\u7ad9: https://bitwiser.in/monaco-themes/ \u8fd9\u4e2a\u7f51\u7ad9\u53ef\u4ee5\u628a\u4e3b\u9898\u6587\u4ef6\u8f6c\u4e3aJSON\u6587\u4ef6\uff0c\u8fd9\u6837\u5c31\u80fd\u5d4c\u5165\u5230 monaco\u7f16\u8f91\u5668 \u4e86\uff01 \ud83d\udcd2 \u8a00\u5f52\u6b63\u4f20 \u4e0d\u8fc7\u8bdd\u8bf4\u56de\u6765\uff0c\u6211\u4eec\u56e0\u4e3a\u662f\u8981\u6539\u9020AceEditor\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u627e\u627eAceEditor\u600e\u4e48\u6dfb\u52a0 \u81ea\u5b9a\u4e49\u4e3b\u9898 \u3002 \u82e6\u5fc3\u4eba\uff0c\u5929\u4e0d\u8d1f \u3002\u5728Ace\u7684github\u5b98\u7f51\u627e\u5230\u4e86\u8fd9\u6837\u7684\u6587\u6863: \u6211\u4eec\u6765\u7ffb\u8bd1\u4e00\u4e0b\u4ed6\u7684\u6b65\u9aa4: \u628a\u4ee3\u7801\u62c9\u4e0b\u6765\uff0c\u8fdb\u5165tool\u6587\u4ef6\u5939\uff0c\u5e76\u5b89\u88c5\u4f9d\u8d56 \u628atmtheme\u6587\u4ef6\u653e\u5230ththemes\u76ee\u5f55\u91cc\u9762 \u66f4\u65b0ththeme.js\u6587\u4ef6\uff0c\u5305\u542b\u6211\u4eec\u7684\u65b0\u4e3b\u9898 \u6267\u884c node tmtheme.js \u7b80\u5355\u7c97\u66b4\uff01\uff01\uff01 \ud83c\udf66 \u8bd5\u9a8c\u4e00\u4e0b \u5148\u628a\u4e0b\u8f7d\u4e0b\u6765\u7684One Dark\u6587\u4ef6\u6254\u8fdb\u53bb \u628a\u4e3b\u9898\u5199\u8fdb\u53bb \u6211\u8fd9\u7701\u7565\u4e86npm install\u7684\u6b65\u9aa4\uff0c\u6211\u4eec\u76f4\u63a5node\u6267\u884cththeme.js \u4f3c\u4e4e\u6ca1\u770b\u5230\u62a5\u9519 \u6211\u4eec\u53bb\u68c0\u67e5\u4e0b\u6709\u6ca1\u6709\u6587\u4ef6\u751f\u6210: \u6700\u7ec8\u5728ace/lib/ace/theme\u6587\u4ef6\u5939\u627e\u5230\u5acc\u7591\u4eba \ud83c\udf66 \u7ed3\u5408react-ace \u56e0\u4e3a\u6211\u4eec\u7528\u7684\u662fReact\u7ec4\u4ef6\uff0c\u90a3\u4e48\u6211\u4eec\u52bf\u5fc5\u8981\u50cf\u4e4b\u524d\u7684\u4e3b\u9898\u4e00\u6837import. \u4f46\u6211\u4eec\u751f\u6210\u4e86js\u548ccss\uff0c\u6ca1\u4e8b\u6211\u4eec\u6765\u770b\u4e0b\u6bd4\u5982monokai\u662f\u600e\u4e48\u73a9\u7684: \u53ef\u4ee5\u770b\u5230\u4ed6\u628acss\u76f4\u63a5\u5199\u5165\u5230cssText\u4e86 \u8fd9\u6837\u5c31\u8fbe\u5230\u4e86 \u53ea\u5f15\u5165js \u5c31\u80fd\u6709\u6837\u5f0f\u7684\u76ee\u7684\uff0c\u597d\u5bb6\u4f19\uff01\uff01\uff01 \u8bdd\u4e0d\u591a\u8bf4\uff0c\u6211\u4eec\u4e5f\u6765\u8bd5\u9a8c\u4e00\u4e0b: \u7167\u642cmonokai\u7684\u4ee3\u7801\uff0c\u628a\u5b83require\u65f6\u5019\u7528\u7684 \u76f8\u5bf9\u8def\u5f84 \u90fd\u6539\u4e3a \u7edd\u5bf9\u8def\u5f84 \uff0c\u6700\u540e\u628acssText\u7528``\u62ec\u8d77\u6765\u5199\u8fdb\u53bb\u3002 cssClass\u7b49\u5b57\u6bb5\u540d\u5b57\u4e5f\u8981\u6539\u6389\u54e6~ ace.define( \"ace/theme/material-one-dark\" ,[ \"require\" , \"exports\" , \"module\" , \"ace/lib/dom\" ], function ( require, exports, module ) { exports.isDark = false ; exports.cssClass = \"ace-material-one-dark\" ; exports.cssText = ` .ace-material-one-dark .ace_gutter { background: #272B33; color: rgb(103,111,122) } .ace-material-one-dark .ace_print-margin { // width: 1px; background: #e8e8e8 } .ace-material-one-dark { background-color: #272B33; color: #A6B2C0 } .ace-material-one-dark .ace_cursor { color: #528BFF } .ace-material-one-dark .ace_marker-layer .ace_selection { background: #3D4350 } .ace-material-one-dark.ace_multiselect .ace_selection.ace_start { box-shadow: 0 0 3px 0px #272B33; border-radius: 2px } .ace-material-one-dark .ace_marker-layer .ace_step { background: rgb(198, 219, 174) } .ace-material-one-dark .ace_marker-layer .ace_bracket { margin: -1px 0 0 -1px; border: 1px solid #747369 } .ace-material-one-dark .ace_marker-layer .ace_active-line { background: #2B313A } .ace-material-one-dark .ace_gutter-active-line { background-color: #2B313A } .ace-material-one-dark .ace_marker-layer .ace_selected-word { border: 1px solid #3D4350 } .ace-material-one-dark .ace_fold { background-color: #61AEEF; border-color: #A6B2C0 } .ace-material-one-dark .ace_keyword { color: #C679DD } .ace-material-one-dark .ace_keyword.ace_operator { color: #A6B2C0 } .ace-material-one-dark .ace_keyword.ace_other.ace_unit { color: #D2945D } .ace-material-one-dark .ace_constant { color: #D2945D } .ace-material-one-dark .ace_constant.ace_numeric { color: #D2945D } .ace-material-one-dark .ace_constant.ace_character.ace_escape { color: #57B6C2 } .ace-material-one-dark .ace_support.ace_function { color: #57B6C2 } .ace-material-one-dark .ace_support.ace_class { color: #E5C17C } .ace-material-one-dark .ace_storage { color: #C679DD } .ace-material-one-dark .ace_invalid.ace_illegal { color: #272B33; background-color: #f2777a } .ace-material-one-dark .ace_invalid.ace_deprecated { color: #272B33; background-color: #d27b53 } .ace-material-one-dark .ace_string { color: #90C378 } .ace-material-one-dark .ace_string.ace_regexp { color: #57B6C2 } .ace-material-one-dark .ace_comment { font-style: italic; color: #59626F } .ace-material-one-dark .ace_variable { color: #DF6A73 } .ace-material-one-dark .ace_meta.ace_selector { color: #C679DD } .ace-material-one-dark .ace_entity.ace_other.ace_attribute-name { color: #D2945D } .ace-material-one-dark .ace_entity.ace_name.ace_function { color: #61AEEF } .ace-material-one-dark .ace_entity.ace_name.ace_tag { color: #DF6A73 } .ace-material-one-dark .ace_markup.ace_list { color: #DF6A73 } ` ; var dom = require ( \"ace/lib/dom\" ); dom.importCssString(exports.cssText, exports.cssClass); }); ( function ( ) { ace.require([ \"ace/theme/ace-material-one-dark\" ], function ( m ) { if ( typeof module == \"object\" && typeof exports == \"object\" && module ) { module .exports = m; } }); })(); \u6700\u7ec8\u6587\u4ef6\u5982\u4e0a\uff0c\u6211\u4eec\u7ed9\u4ed6\u53d6\u540d\u53ebMaterialOneDark.js\uff0c\u7136\u540e\u5728\u7f16\u8f91\u5668\u5f15\u5165: \u8bbe\u7f6e\u4e3a\u9ed8\u8ba4\u4e3b\u9898 \u770b\u770b\u6548\u679c: \u975e\u5e38\u975e\u5e38\u975e\u5e38nice \u5fc3\u6ee1\u610f\u8db3\uff0c\u6253\u5b8c\u6536\u5de5~\uff01 \u5728\u7ebf\u4f53\u9a8c\u5730\u5740 : http://pity.buzz","title":"57.\u7f8e\u5316\u4ee3\u7801\u7f16\u8f91\u5668"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2858%29%20%E8%AE%BE%E8%AE%A1%E7%94%A8%E4%BE%8B%E7%9B%AE%E5%BD%95/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u5b8c\u6574\u7684 \u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0\u7cfb\u5217\u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u80fd\u591f\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u6d4b\u8bd5\u5f00\u53d1\u5751\u8d27 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \ud83d\udcd2 \u56de\u987e \u4e0a\u4e00\u7bc7\u6211\u4eec \u5f00\u4e86\u4e2a\u5c0f\u5dee \uff0c\u53bb\u641e\u4e86\u4e0b\u7f16\u8f91\u5668\u90a3\u5757\u3002\u4e3a\u4ec0\u4e48\u6211 \u5982\u6b64\u91cd\u89c6 \u7f16\u8f91\u5668\u7684\u4f53\u9a8c\uff0c\u90a3\u662f\u56e0\u4e3a\u540e\u7eed\u6211\u4eec\u9700\u8981\u7528\u6237\u5728\u9875\u9762\u4e0a\u8865\u8db3 Python\u6216\u5176\u4ed6\u811a\u672c \uff0c\u5982\u679c\u6ca1\u6709\u4e00\u4e2a\u8fd8\u7b97\u597d\u7528\u7684\u7f16\u8f91\u5668\uff0c\u90a3\u5c06\u975e\u5e38\u9e21\u808b\u3002 \u4f46\u4e4b\u524d\u53d1\u73b0\u7f16\u8f91\u5668\u4f1a\u7565\u5361\uff0c\u627e\u5230\u4e86\u5177\u4f53\u7684\u539f\u56e0: \u6211\u4eec\u6bcf\u6b21\u5728render\u8fc7\u7a0b\u4e2d\u90fd\u4f1a\u6dfb\u52a0 \u4ee3\u7801\u8865\u5168 \u63d0\u793a\uff0c\u8fd9\u6837\u662f\u4e0d\u5408\u7406\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u5bf9\u7f16\u8f91\u5668\u8fdb\u884c\u4e00\u4e0b\u6539\u9020\u3002 \u5728DidMount\u751f\u547d\u5468\u671f\u6267\u884caddCompleter\u65b9\u6cd5\uff0c\u7531\u4e8etables\u662f\u53ef\u53d8\u7684\uff0c\u6240\u4ee5\u4e0d\u7528\u62c5\u5fc3\u81ea\u52a8\u8865\u5168\u7684\u5185\u5bb9\u4e0d\u66f4\u65b0 \ud83d\udcd2 \u601d\u8003\u73b0\u5728\u7684\u4e0d\u8db3 \u5176\u5b9e\u73b0\u5728\u7684\u60c5\u51b5\u6bd4\u8f83\u590d\u6742\uff0c\u6211\u4eec\u5728\u5199\u7528\u4f8b\u7684\u65f6\u5019\uff0c\u5fc5\u987b\u8981\u5148 \u8fdb\u5165\u9879\u76ee\u4e4b\u4e2d \uff0c\u7136\u540e\u5728\u9879\u76ee\u91cc\u9762\u627e\u5230 \u7528\u4f8b\u5217\u8868 tab\u9875\u3002 \u6709\u6ca1\u6709\u89c9\u5f97 \u8fd9\u6837\u4e0d\u592a\u597d ~ \u6211\u4eec\u5982\u679c\u5de6\u4fa7\u662f\u76ee\u5f55\uff0c\u53f3\u4fa7\u662fcase\u5217\u8868\uff0c\u5176\u5b9e\u4f1a\u597d\u5f88\u591a\u3002\u800c\u4e14\u968f\u7740\u4e1a\u52a1\u7684\u6df1\u5165\uff0c\u76ee\u5f55\u5206\u7c7b\u80af\u5b9a\u4e0d\u80fd\u50cf\u76ee\u524d\u4e00\u6837 \u53ea\u67092\u7ea7 \u3002 \u4e0d\u7ba1\u600e\u4e48\u8bf4\uff0c\u6211\u4eec\u5148\u8bd5\u9a8c\u4e00\u4e0b\u5427~ \ud83d\udcd2 \u8bbe\u8ba1\u7528\u4f8b\u76ee\u5f55\u8868 \u629b\u5f00\u4e3b\u952e\uff0c\u66f4\u65b0/\u521b\u5efa\u65f6\u95f4\u548c\u7528\u6237\u8fd9\u6837\u7684\u57fa\u7840\u4fe1\u606f\u4e4b\u540e\uff0c\u5176\u5b9e\u6838\u5fc3\u53ea\u67093\u4e2a\u5b57\u6bb5: project_id \u6211\u4eec\u7684\u76ee\u5f55\u9700\u8981\u548c\u9879\u76ee\u6302\u94a9\uff0c\u8fd9\u6837\u7684\u8bdd\u80fd\u5bf9 \u76ee\u5f55 \u8fdb\u884c\u5f88\u597d\u7684\u5206\u7c7b\uff0c\u4ece\u800c\u8fbe\u5230\u5bf9case\u8fdb\u884c\u5f52\u7c7b\u7684\u76ee\u7684\u3002 name \u76ee\u5f55\u540d\u79f0\uff0c\u8fd9\u4e2a\u4e0d\u9700\u8981\u591a\u8bf4\u4e86\u3002 parent \u8fd9\u4e2a\u662f\u5f88\u5173\u952e\u7684\u5b57\u6bb5\uff0c\u56e0\u4e3a\u6211\u4eec\u7684\u76ee\u5f55\u662f\u652f\u6301\u5d4c\u5957\u7684\uff0c\u76ee\u5f55\u5982\u679c\u6ca1\u6709\u7236\u7ea7\uff0c\u90a3\u4e48\u5b83\u5c31\u662f\u4e00\u4e2a \u6839\u76ee\u5f55 \u3002 \u6211\u4eec\u8981\u5c55\u793a\u4e00\u4e2a\u6811\u7ed3\u6784\uff0c\u53ef\u79bb\u4e0d\u5f00\u8fd9\u73a9\u610f\u513f \ud83d\udcd2 \u7f16\u5199\u589e\u5220\u6539\u63a5\u53e3 insert \u5148\u5224\u65ad\u662f\u5426\u6709\u540c\u7ea7\u5e76\u4e14\u540c\u9879\u76ee\u540c\u540d\u7684\u76ee\u5f55\u5b58\u5728 \u6709\u7684\u4eba\u53ef\u80fd\u5f88\u7591\u60d1\uff0c\u4e3a\u4ec0\u4e48\u660e\u660e\u8bbe\u7f6e\u4e86 \u552f\u4e00\u7d22\u5f15 \uff0c\u8fd8\u8981\u53bb\u5148\u67e5\u8be2\u4e00\u6b21\u6570\u636e\u5e93\u5462\uff1f\u5176\u5b9e\u5427\uff0c\u552f\u4e00\u7d22\u5f15\u662f\u54b1\u4eec\u7684\u515c\u5e95\u65b9\u6848\uff0c\u662f\u4e3a\u4e86\u63a7\u5236\u6570\u636e\u7684 \u552f\u4e00\u6027 \u3002\u4f46\u6211\u4eec\u66f4\u5e94\u8be5\u4ece\u4e1a\u52a1\u7684\u89d2\u5ea6\u53bb\u89c4\u907f\u6389\u91cd\u590d\u6570\u636e\u51fa\u73b0\u7684\u53ef\u80fd\uff0c\u6240\u4ee5\u6709\u8fd9\u6837\u4e00\u5c42\u5224\u65ad\uff0c\u8fd9\u4e5f\u53ea\u662f \u4e2a\u4eba\u7406\u89e3 \u54c8\u3002 \u53ef\u4ee5\u770b\u5230\u4ee3\u7801\u6bd4\u8f83\u6e05\u6670\uff0c\u901a\u8fc7with session.begin\u5728session.add\u4e4b\u540e\u81ea\u52a8\u63d0\u4ea4\u5230\u6570\u636e\u5e93\uff0c\u5b8c\u6210\u5bf9 \u6570\u636e\u7684\u5f55\u5165 \u3002 \u5728postman\u6d4b\u8bd5\u4e00\u4e0b: \u9996\u6b21\u521b\u5efa \u518d\u6b21\u521b\u5efa update\u548cdelete \u57fa\u672c\u4e0a\u90fd\u662f\u8001\u4e00\u5957\uff0c \u8fd9\u4e5f\u5c31\u662f\u4e3a\u4ec0\u4e48\u5927\u5bb6\u90fd\u8bf4CRUD BOY\u5f88\u6ca1\u610f\u601d\uff0c\u56e0\u4e3a\u770b\u8d77\u6765\u6280\u672f\u542b\u91cf\u786e\u5b9e\u4e00\u822c\u3002 \u63a5\u7740\u53bb\u5b8c\u5584\u4fee\u6539\u548c\u5220\u9664\u7684\u63a5\u53e3: \u6ce8\u610fdelete\u63a5\u53e3\u662fget\u8bf7\u6c42\u54e6\uff0c\u56e0\u4e3a\u6211\u4eec\u53ea\u9700\u8981\u4e00\u4e2aid\u5373\u53ef \ud83d\udcd2 \u91cd\u5934\u620f \u91cd\u70b9\u6765\u4e86\uff0c\u63a5\u7740\u662f\u7f16\u5199\u83b7\u53d6\u76ee\u5f55\u6811\u7684\u63a5\u53e3\u4e86~ \ud83c\udf66 \u901a\u8fc7project_id\u83b7\u53d6\u6240\u6709\u76ee\u5f55 \u53c2\u6570\u662fproject_id \u6211\u4eec\u9700\u8981\u4e00\u6b21\u6027\u62ff\u51fa \u4e00\u4e2a\u9879\u76ee \u4e0b\u9762\u7684\u6240\u6709\u76ee\u5f55\u3002 \ud83c\udf66 \u7f16\u5199get_testcase_directory_tree\u65b9\u6cd5 \u8fd9\u91cc\u7a0d\u5fae\u6709\u70b9\u513f\u590d\u6742\uff0c\u6211\u4eec\u4e00\u4e2a\u4e00\u4e2a\u6765\u5206\u6790: \u901a\u8fc7\u9879\u76eeid\u83b7\u53d6\u5230\u6240\u6709\u76ee\u5f55\u6811 \u521b\u5efa\u6700\u7ec8\u8fd4\u56de\u7ed3\u679c: ans \u521b\u5efa\u76ee\u5f55id -> \u76ee\u5f55\u7684\u6620\u5c04\u5173\u7cfb \u521b\u5efa\u7236\u76ee\u5f55 -> \u5b50\u76ee\u5f55\u7684\u6620\u5c04\uff0c\u5b50\u76ee\u5f55\u662f\u4e00\u4e2alist \u904d\u5386\u83b7\u53d6\u5230\u7684\u76ee\u5f55\uff0c\u5982\u679cparent\u4e3a\u7a7a\uff0c\u8bf4\u660e\u662f\u6839\u76ee\u5f55\uff0c\u6211\u4eec\u76f4\u63a5\u52a0\u5230ans\u4e4b\u4e2d\uff0c\u5426\u5219\u8bf4\u660e\u4ed6\u4e0d\u662f\u6839\u76ee\u5f55\uff0c\u6211\u4eec\u62ff\u5230\u4ed6\u7684parent\u5e76\u5199\u5165parent_map\u4e4b\u4e2d \u6700\u540e\u8bbe\u7f6eid -> directory\u7684\u6620\u5c04 \u5982\u679c\u4e00\u6765\uff0c\u6211\u4eec\u901a\u8fc7\u4e00\u6b21\u904d\u5386\u62ff\u5230\u4e86 \u6240\u6709\u6839\u76ee\u5f55 \uff0c\u4ee5\u53ca \u6839\u76ee\u5f55\u6709\u54ea\u4e9b\u5b69\u5b50 \uff0c \u76ee\u5f55id->\u76ee\u5f55 \u76843\u4e2a\u91cd\u8981\u7ebf\u7d22\u3002 \u904d\u5386ans\uff0c\u628a\u4ed6\u4eec\u7684\u5b50\u5b50\u5b59\u5b59\u90fd\u585e\u8fdbchildren\u5217\u8868\u91cc\u53bb \u6765\u770b\u770bget_directory\u65b9\u6cd5\uff0c\u5148\u901a\u8fc7parent_map\u62ff\u5230\u5f53\u524d\u7684\u7236\u76ee\u5f55\u4e0b\u9762 \u662f\u5426\u8fd8\u6709\u5b50\u76ee\u5f55 ->current\uff0c\u5982\u679c\u6ca1\u6709\uff0c\u5219\u8bf4\u660e\u8fd9\u4e00\u5c42\u76ee\u5f55\u5df2\u7ecf\u6ca1\u6709\u5b50\u76ee\u5f55\u4e86\uff0c\u53ef\u4ee5return\u4e86\u3002 \u5982\u679c\u6709\u7684\u8bdd\uff0c\u904d\u5386current\uff0c\u4e5f\u5c31\u662f \u5b50\u76ee\u5f55\u5217\u8868 \uff0c\u63a5\u7740\u4eceans_map\u62ff\u5230\u5b50\u76ee\u5f55\u7684\u4fe1\u606f\uff0c\u65b0\u5efachild\u5217\u8868\uff0c\u5e76\u628a\u5f53\u524d\u5b50\u76ee\u5f55\u7684\u4fe1\u606f\u6dfb\u52a0\u5230\u7236\u76ee\u5f55\u4e0b\u9762\u7684children\uff0c\u63a5\u7740\u9012\u5f52\u7ee7\u7eed\u627e \u5b50\u76ee\u5f55 \u7684 \u5b50\u76ee\u5f55 \u3002 \u5982\u6b64\u53cd\u590d\uff0c\u5373\u53ef\u751f\u6210\u4e00\u68f5\u6811\u3002\u7f16\u5199\u83b7\u53d6\u76ee\u5f55\u6811\u7684\u63a5\u53e3: \ud83d\udcd2 \u770b\u4e0b\u6700\u7ec8\u6548\u679c \u6570\u636e\u91cf\u6bd4\u8f83\u5c11\uff0c\u540e\u7eed\u9700\u8981\u653e\u5165redis\u7f13\u5b58 \u4eca\u5929\u7684\u5185\u5bb9\u5c31\u5206\u4eab\u5230\u8fd9\u513f\u4e86\uff0c\u6709\u5174\u8da3\u7684\u670b\u53cb\u4eec\u53ef\u4ee5\u4e00\u8d77\u52a8\u624b\u5199\u8d77\u6765\u5440\uff01~ \u5728\u7ebf\u4f53\u9a8c\u5730\u5740: http://test.pity.fun","title":"58.\u8bbe\u8ba1\u7528\u4f8b\u76ee\u5f55"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2859%29%20%E8%B0%83%E6%95%B4%E7%94%A8%E4%BE%8B%E5%88%97%E8%A1%A8%E9%A1%B5/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u8fd9\u662f\u4e00\u4e2a\u5b8c\u6574\u7684 \u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0\u7cfb\u5217\u6559\u7a0b \uff0c\u5e0c\u671b\u80fd\u548c\u5927\u5bb6\u4e00\u8d77\u5b66\u4e60\uff0c\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u5e73\u53f0\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u6d4b\u8bd5\u5f00\u53d1\u5751\u8d27 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \ud83d\udcd2 \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u8bb2\u4e86 \u600e\u4e48\u53bb\u8bbe\u8ba1 \u7528\u4f8b\u76ee\u5f55\u8868\uff0c\u800c\u56e0\u4e3a\u4e4b\u524d\u6211\u4eec\u7684case\u662f\u8ddf\u9879\u76ee\u7ed1\u5b9a\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u8fd9\u4e00\u8282\u53bb\u6539\u8fdbcase\u76f8\u5173\u90e8\u5206\u3002 \ud83d\udcd2 \u7406\u6e05\u5173\u7cfb \u4e4b\u524d \u7528\u4f8b\u8868 \u91cc\u9762\u4f1a\u6709\u4e00\u4e2aproject_id\u548ccategory\u5b57\u6bb5\uff0c\u5206\u522b\u4ee3\u8868\u9879\u76ee\u548c\u76ee\u5f55\u3002\u6211\u4eec\u4e0a\u8282\u5df2\u7ecf\u5236\u9020\u4e86\u76ee\u5f55\u8868\uff0c\u6240\u4ee5\u9700\u8981\u5148\u53bb\u6389\u4e4b\u524d\u7684project_id\u5b57\u6bb5\u548c\u76ee\u5f55\u5b57\u6bb5\uff0c\u6539\u4e3a directory_id \u5b57\u6bb5\u3002 \u5176\u5b9e\u6211\u4eec\u53ef\u4ee5\u7b80\u5355\u70b9\uff0c\u628aproject_id\u76f4\u63a5\u6362\u6210 directory_id \uff0c\u63a5\u7740\u5220\u9664category\u5b57\u6bb5\u3002\u4f46\u8fd9\u6837\u7684\u8bdd\uff0c\u4f1a\u5f71\u54cd\u5230 \u9879\u76ee\u5217\u8868 \u9875\u9762\u3002 \u4f46\u6ca1\u5173\u7cfb\uff0c\u672c\u6765\u6211\u4eec\u5c31\u662f\u8981\u628a\u9879\u76ee\u5217\u8868\u9875\u91cc\u7684case\u9875\u9762\u5254\u9664\u7684\u3002 \u539f\u6765\u7684project_id\u6362\u6210\u4e86directory_id\u5e76\u4e14\u6ce8\u91ca\u6389\u4e86category form\u5b57\u6bb5\u91cc\u9762\u4e5f\u505a\u7c7b\u4f3c\u7684\u4e8b\u60c5 \ud83d\udcd2 \u6539\u5199\u67e5\u8be2\u9879\u76ee\u7684\u63a5\u53e3 \u53bb\u6389\u539f\u5148\u67e5\u8be2case\u6811\u7684\u65b9\u6cd5\uff0c\u4e0d\u8fd4\u56detree\u4e86 \u9875\u9762\u4e0a\u7684\u6539\u52a8: \u53bb\u6389\u4e86\u5de6\u4fa7\u7684\u7528\u4f8b\u5217\u8868 \ud83d\udcd2 \u89c4\u5212\u4e00\u4e0b\u5217\u8868\u9875 \u65e2\u7136\u65e7\u7684\u5217\u8868\u9875\u7ed9\u5e72\u6389\u4e86\uff0c\u90a3\u4e48\u65b0\u7684 \u5217\u8868\u9875 \u5e94\u8be5\u600e\u4e48\u5c55\u793a\u5462\uff1f \u4e0a\u8282\u6211\u4eec\u7f16\u5199\u4e86case\u76ee\u5f55\uff0c\u90a3\u7528\u4f8b\u662f\u8ddf\u76ee\u5f55\u5173\u8054\u8d77\u6765\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u5927\u6982\u8bbe\u60f3\u4e00\u4e0b\u8fd9\u6837\u4e00\u4e2a\u9875\u9762: \u56e0\u4e3a\u6ca1\u753b\u539f\u578b\u56fe\uff0c\u6240\u4ee5\u76f4\u63a5\u7528\u505a\u597d\u7684\u9875\u9762\u5c55\u793a\u4e86 \u53ef\u4ee5\u770b\u5230\uff0c \u5e03\u5c40 \u662f\u5de6\u53f3\u5e03\u5c40: \u5de6\u4fa7 \u9879\u76ee\u9009\u62e9\u548c\u76ee\u5f55\u6811\uff0c\u76ee\u5f55\u6811\u7ecf\u8fc7\u6211\u4eec\u4e0a\u4e00\u8282\u7684\u5904\u7406\uff0c\u53ef\u4ee5 \u75af\u72c2\u5d4c\u5957 \u3002\u76ee\u524d\u6765\u770b\u7684\u8bdd\uff0c\u76ee\u5f55 \u8fd8\u4e0d\u652f\u6301\u79fb\u52a8 \uff0c\u6bd4\u8f83\u53ef\u60dc\u3002 \u53f3\u4fa7 \u53f3\u4fa7\u5c31\u662f\u4e00\u4e2a\u7528\u4f8b\u5217\u8868\u9875\uff0cXXX\u76ee\u5f55\u4e0b\u7684\u7528\u4f8b\u5217\u8868\uff0c\u5176\u4e2d\u8fd8\u80fd\u591f\u6839\u636e \u7528\u4f8b\u540d\u79f0 \u548c\u521b\u5efa\u4eba\u6765\u8fc7\u6ee4case\u3002 \u8fd9\u8fb9case\u5c31\u6ca1\u6709\u7ee7\u7eed\u505a\u5206\u9875\u4e86\uff0c\u5355\u4e2a\u76ee\u5f55\u4e0b\u7684case\u5e94\u8be5\u4e0d\u4f1a\u5230\u51e0\u5343\u6761\u90a3\u4e48\u5938\u5f20\u3002 \ud83d\udcd2 \u63a5\u4e0b\u6765\u5e72\u561b\uff1f \u5f53\u7136\u662f\u4e3a\u524d\u7aef\u7684\u5c55\u793a \u63d0\u4f9b\u8fd9\u4e9b\u6570\u636e \u3002\u6211\u4eec\u76ee\u524d\u9700\u8981\u652f\u6301\u521b\u5efa\u4eba+\u7528\u4f8b\u540d\u79f0+\u76ee\u5f55\u7684\u65b9\u5f0f\u8fdb\u884c\u67e5\u8be2\u3002 \u800c\u76ee\u5f55\u53c8\u4f1a\u5d4c\u5957\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u627e\u51fa\u76ee\u5f55\u7684 \u6240\u6709\u513f\u5b50 \u3002\u53c8\u56e0\u4e3a\u76ee\u5f55\u4e0d\u53ef\u80fd\u4f1a\u90a3\u4e48\u90a3\u4e48\u591a\uff0c\u6240\u4ee5\u6211\u4eec\u627e\u51fa \u5f85\u67e5\u76ee\u5f55 \u548c \u6240\u6709\u975e\u6839\u8282\u70b9\u76ee\u5f55 \u3002 \u6bd4\u5982\u6211\u8981\u67e5\u6839\u76ee\u5f55A\u4e0b\u7684\u6570\u636e\uff0c\u90a3\u4e48\u5176\u4ed6\u6839\u76ee\u5f55\u80af\u5b9a\u4e0d\u662fA\u7684\u513f\u5b50\uff0c\u800c\u662fA\u7684\u5144\u5f1f\u3002 \u5982\u679c\u7528\u4e00\u5c42\u5c42for\u5faa\u73af\u53bb \u67e5\u8be2 \u6570\u636e\u7684\u8bdd\uff0c\u52bf\u5fc5\u4f1a\u5f88\u5f71\u54cd\u6027\u80fd\uff0c\u5f53\u7136\u6211\u8fd9\u91cc\u5efa\u8bae\u5927\u5bb6\u628a\u67e5\u8be2\u7684\u7ed3\u679c\u7f13\u5b58\u5230redis\uff0c\u4e00\u822c\u6765\u8bf4\u76ee\u5f55\u54b1\u4eec\u4e0d\u4f1a \u8f7b\u6613\u66f4\u6362 \uff0c\u66f4\u6362\u7684\u65f6\u5019 \u5220\u9664\u4e0b\u7f13\u5b58 \u5373\u53ef\uff0c\u8fd9\u6837\u4f1a\u4e8b\u534a\u529f\u500d\u3002 \ud83c\udf66 \u5f00\u59cb\u884c\u52a8 \u7f16\u5199\u83b7\u53d6A\u4e0b\u9762\u6240\u6709\u5b50\u76ee\u5f55\u7684\u65b9\u6cd5 \u9996\u5148\u627e\u51fa\u6240\u6709parent \u7b49\u4e8e directory_id \u6216\u8005 \u4e0d\u662f\u6839\u76ee\u5f55\u7684\u6570\u636e \u548c\u4e4b\u524d\u4e00\u6837\uff0c\u628a\u4ed6\u4eec\u585e\u5230\u4e00\u4e2amap\u91cc\u9762\u53bb\uff0c\u8fd9\u6837\u5efa\u7acbparent -> son\uff08\u4e5f\u5c31\u662f\u7236\u4eb2\u5230\u513f\u5b50\u4e4b\u95f4\u7684\u6620\u5c04\uff09 \u7f16\u5199\u83b7\u53d6\u513f\u5b50\u7684\u65b9\u6cd5\uff08\u9012\u5f52\uff09\uff0c\u628a\u6240\u6709\u7684\u5b69\u5b50\u8282\u70b9\u90fd\u653e\u5230result\u4e4b\u4e2d \u8c03\u6574list_testcase\u65b9\u6cd5 \u9996\u5148\u83b7\u53d6\u6240\u6709directory_id\u4e0b\u7684\u76ee\u5f55\uff0c\u7136\u540e\u627e\u51fa \u672a\u5220\u9664 \u4e14directory_id in\u8fd9\u4e9b\u76ee\u5f55\u7684case\u3002 \u4e4b\u540e\u5982\u679c\u6709\u5176\u4ed6\u6761\u4ef6\uff0c\u6bd4\u5982name\uff0ccreate_user\u8fd9\u6837\u7684\uff0c\u518d\u52a0\u5165 \u7b5b\u9009\u6761\u4ef6 \u3002 \u63a5\u7740\u6839\u636ecase\u540d\u79f0\u6392\u5e8f\u5373\u53ef\u3002 \ud83c\udf66 \u5b8c\u5584list\u63a5\u53e3 \ud83c\udf66 \u6700\u7ec8\u6548\u679c \u53ea\u770b\u53f3\u4fa7\u7684\u8bdd\uff0c\u4ed6\u5c31\u662f\u4e00\u4e2a \u5217\u8868\u9875 \u9762\uff0c\u4f46\u8fd9\u8fb9\u7684\u533a\u522b\u5c31\u662f\u4ed6\u548c\u5de6\u4fa7\u76ee\u5f55\u6811\u8fdb\u884c\u4e86 \u6253\u901a \u3002 \u62dc\u4e86\u4e2a\u62dc\uff0c\u4e0b\u7bc7\u8bb2\u4e0b \u5982\u4f55\u90e8\u7f72 \uff0c\u81f3\u4e8e\u7528\u4f8b\u7684\u7f16\u8f91/\u65b0\u589e/\u6267\u884c\u8fd9\u5757\uff0c\u8fd8\u9700\u8981\u4e00\u4e9b\u65f6\u95f4\u3002","title":"59.\u8c03\u6574\u7528\u4f8b\u5217\u8868\u9875"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%286%29%20%E9%85%8D%E7%BD%AEflask-sqlalchemy/","text":"\u914d\u7f6eflask-sqlalchemy \u8bf4\u5230 flask-sqlalchemy \uff0c\u6709\u4e9b\u4eba\u53ef\u80fd\u4e0d\u592a\u6e05\u695a\u662f\u4ec0\u4e48\u4e1c\u897f\u3002\u7b80\u5355\u7684\u8bf4\uff0c\u4ed6\u5c31\u662f\u4e00\u4e2aorm\u5e93\uff0c\u5e2e\u52a9\u54b1\u4eec\u80fd\u591f\u66f4\u597d\u5730\u8ddf db \u6253\u4ea4\u9053\u7684\u3002\u7b14\u8005\u6709\u4e00\u7bc7 \u6587\u7ae0 \u6709\u7565\u5fae\u7684\u4ecb\u7ecd\uff0c\u53ef\u4ee5\u901f\u89c8\u4e00\u904d\u4e86\u89e3\u4e00\u4e0b\uff08\u5176\u5b9e\u4e3b\u8981\u662f\u7b14\u8005\u624d\u758f\u5b66\u6d45\uff0c\u8bb2\u4e0d\u51fa\u4ec0\u4e48\u6df1\u5965\u7684\u3002 \u65e2\u7136\u662f\u767b\u5f55\uff0c\u90a3\u4e48\u80af\u5b9a\u9700\u8981\u6709\u6301\u4e45\u5316\u7684\u6570\u636e\u3002\u90a3\u4e48\u6211\u4eec\u80af\u5b9a\u9700\u8981\u5efa\u7acb\u7528\u6237\u76f8\u5173\u7684\u8868\u3002 \u524d\u7f6e\u51c6\u5907 \u5b89\u88c5MySQL \u6839\u636e\u81ea\u5df1\u7684\u7cfb\u7edf(Windows/Mac/Linux)\u5b89\u88c5\u597d\u5bf9\u5e94\u7684MySQL\u5e76\u8bbe\u7f6e\u597d\u8d26\u53f7\u5bc6\u7801\uff0c\u8fd9\u91cc\u5c31\u4e0d\u6559\u80b2\u5927\u5bb6\u600e\u4e48\u5b89\u88c5\u4e86\u3002\u7aef\u53e3\u53f7\u7528\u9ed8\u8ba4\u76843306\u5373\u53ef\uff0c\u5e76\u4e14\u786e\u4fdd\u670d\u52a1\u8981\u542f\u52a8\u6210\u529f\u54e6\uff01 \u5b89\u88c5mysql-connector-python(mysql\u5b98\u65b9\u9a71\u52a8) cmd\u7a97\u53e3\u6267\u884c pip3 install mysql-connector-python \u914d\u7f6eMySQL\u8fde\u63a5\u4fe1\u606f pity/config.py\u914d\u7f6emysql\u8fde\u63a5\u4fe1\u606f MySQL\u914d\u7f6e \u6ce8\u610f: \u4e00\u5b9a\u8981\u786e\u4fddMySQL\u7684\u5e93\u5b58\u5728\u54e6, \u6ca1\u6709\u7684\u8bdd\u53ef\u4ee5\u7528Navicat\u6216Datagrip\u65b0\u5efa\u3002 \u53ef\u4ee5\u770b\u51fa\u4ee5\u4e0a\u5305\u542b\u4e865\u4e2a\u91cd\u70b9\u5185\u5bb9\uff0cmysql\u7684\u5730\u5740\uff0c\u7aef\u53e3\u53f7\uff0c\u7528\u6237\u540d\uff0c\u5bc6\u7801\u548c\u5e93\u540d\u3002\u63a5\u4e0b\u6765\u7684SQLALCHEMY_DATABASE_URI\u4ee3\u8868\u4e86sql\u7684\u8fde\u63a5\u4fe1\u606f\uff0c flask_sqlalchemy \u4f1a\u81ea\u52a8\u6839\u636e\u8fd9\u4e2a\u53d8\u91cf\u53bb\u83b7\u53d6db\u8fde\u63a5\u7b49\u3002\u5176\u4e2d mysql+mysqlconnector \uff0c\u4ee3\u8868\u7684\u662f\u8bd5\u7528mysql\u8fde\u63a5\u7684\u65b9\u5f0f\uff0c\u5927\u5bb6\u90fd\u77e5\u9053Python\u8fde\u63a5mysql\u6709\u5f88\u591a\u5e93\u6bd4\u5982pymysql\uff0cmysqldb\u7b49\u3002\u8fd9\u91cc\u5c31\u662f\u4e00\u4e2a\u8bf4\u660e\u3002 \u81f3\u4e8e\u540e\u9762\u7684\u8b66\u544a\u5927\u5bb6\u53ef\u52a0\u53ef\u4e0d\u52a0\uff0c\u5982\u679c\u88ab\u8b66\u544a\u5f97\u592a\u70e6\u4e86\u53ef\u4ee5\u8fd9\u6837\u89e3\u51b3\u3002 SQLALCHEMY_DATABASE_URI = 'mysql+mysqlconnector://{}:{}@{}:{}/{}' .format( MYSQL_USER, MYSQL_PWD, MYSQL_HOST, MYSQL_PORT, DBNAME) \u5728 pity/app/models/__init__.py \u521d\u59cb\u5316db \u4ee3\u7801\u5f88\u7b80\u5355\uff0c\u5c31\u662f\u5c06app\u8d4b\u7ed9SQLAlchemy\u4ece\u800c\u751f\u6210\u4e00\u4e2adb\u5bf9\u8c61\u3002 from flask_sqlalchemy import SQLAlchemy from app import pity db = SQLAlchemy(pity) \u914d\u5907\u7528\u6237\u7c7b \u5728models\u76ee\u5f55\u5efa\u7acb\u7528\u6237\u8868 \u9996\u5148\u54b1\u4eec\u8fd9\u4e2a\u5e73\u53f0\u80af\u5b9a\u4e0d\u662f\u90a3\u79cd\u4e0d\u9700\u8981\u767b\u5f55\u7684\uff0c\u56e0\u4e3a\u4f1a\u505a\u4e00\u5c0f\u90e8\u5206\u7684 \u6743\u9650\u63a7\u5236 \uff0c\u4f46\u662f\u80af\u5b9a\u4e5f\u4e0d\u4f1a\u5f88\u590d\u6742\u5316\u3002\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5148\u7b80\u7565\u8bbe\u8ba1\u4e00\u4e0b \u7528\u6237\u8868 \u3002 \u65e2\u7136\u662fOrm\uff0c\u90a3\u4e48\u54b1\u4eec\u7684 User\u8868 \u7684\u4f53\u73b0\u5373\u662f Python \u4e2d\u7684\u4e00\u4e2a\u7c7b\u3002 \u56e0\u4e3a\u76ee\u524d\uff0c\u8fd8\u4e0d\u592a\u4e86\u89e3\u7528\u6237\u8868\u7684\u5177\u4f53\u9700\u8981\u5b57\u6bb5\u3002\u4f46\u662f\u6211\u4eec\u80fd\u5927\u6982\u8bbe\u8ba1\u4e00\u4e0b\u8fd9\u4e2a\u8868\uff0c\u9996\u5148\u9700\u8981\u7684\u5b57\u6bb5\u80af\u5b9a\u6709\u7528\u6237\u540d\uff0c\u5bc6\u7801\uff0c\u7528\u6237id\uff0c\u90ae\u7bb1\uff0c\u56e2\u961fid\uff0c\u804c\u4f4d\u7b49\u3002\u5176\u4ed6\u7684\u4fe1\u606f\u6bd4\u5982enable(\u662f\u5426\u53ef\u7528)\uff0ccreate_time(\u521b\u5efa\u65f6\u95f4)\u7b49\u4fe1\u606f\u6682\u65f6\u5148\u4e0d\u8003\u8651\u4e86\u3002\u540e\u7eed\u53ef\u4ee5\u968f\u610f\u6dfb\u52a0\u3002 \u90a3\u4e48 User\u8868 \u6211\u7684\u5927\u6982\u8bbe\u8ba1\u5982\u4e0b: \u5927\u81f4\u8bb2\u4e00\u4e0b\u5427\uff0c\u5927\u6982\u5c31\u521b\u5efa\u4e86\u4ee5\u4e0a\u51e0\u4e2a\u5b57\u6bb5\u3002unique\u662f\u5b57\u6bb5\u662f\u5426\u552f\u4e00(\u53ef\u91cd\u590d)\uff0cprimary key\u81ea\u7136\u5c31\u662f\u4e3b\u952e\uff0cdb.String\u5bf9\u5e94varchar\uff0cdb.INT\u5bf9\u5e94int\uff0c\u4e5f\u5c31\u662f\u8bf4\u3002\u73b0\u5728\u6211\u4eec\u8981\u64cd\u4f5c\u6570\u636e\u8868\uff0c\u53ea\u9700\u8981\u5bf9\u8fd9\u4e2aUser\u7c7b\u64cd\u4f5c\u5c31\u884c\u4e86\uff0c\u56e0\u4e3asqlalchemy\u4f1a\u81ea\u52a8\u6620\u5c04\u5230\u5bf9\u5e94\u5e93--\u5bf9\u5e94\u8868\u8fdb\u884c\u64cd\u4f5c\u3002 from app.models import db from datetime import datetime class User (db.Model) : id = db.Column(db.INT, primary_key= True ) username = db.Column(db.String( 16 ), unique= True , index= True ) name = db.Column(db.String( 16 ), index= True ) password = db.Column(db.String( 32 ), unique= False ) email = db.Column(db.String( 64 ), unique= True , nullable= False ) role = db.Column(db.INT, default= 0 , comment= \"0: \u666e\u901a\u7528\u6237 1: \u7ec4\u957f 2: \u8d85\u7ea7\u7ba1\u7406\u5458\" ) created_at = db.Column(db.DATETIME, nullable= False ) updated_at = db.Column(db.DATETIME, nullable= False ) deleted_at = db.Column(db.DATETIME) last_login_at = db.Column(db.DATETIME) def __init__ (self, username, name, password, email) : self.username = username self.password = password self.email = email self.name = name self.created_at = datetime.now() self.updated_at = datetime.now() self.role = 0 def __repr__ (self) : return '<User %r>' % self.username \u5728\u5f15\u5165models\u7684\u5730\u65b9\u521d\u59cb\u5316\u6570\u636e\u8868 \u6211\u4eec\u5728 pity/dao/__init__.py dao\u5c42\u521d\u59cb\u5316\u6240\u6709\u8868\uff0c\u4ee5\u540e\u65b0\u589e\u4e00\u4e2a\u8868\u90fd\u9700\u8981\u5728\u8fd9\u513fimport\u4e00\u6b21 from app.models import db from app.models.user import User db.create_all() \u5728run.py\u5f15\u5165dao\u5305\u4f7f\u5f97\u5efa\u8868\u8bed\u53e5db.create_all()\u751f\u6548 \u91cd\u542f\u670d\u52a1\u540e\u53ef\u4ee5\u770b\u5230\u51fa\u73b0\u4e86user\u8868: \u5e7f\u544a\u65f6\u95f4 \u540e\u7aef\u4ee3\u7801\u5730\u5740: https://github.com/wuranxu/pity \u524d\u7aef\u4ee3\u7801\u5730\u5740: https://github.com/wuranxu/pityWeb \u6b22\u8fce\u5173\u6ce8\u516c\u4f17\u53f7 \u6d4b\u8bd5\u5f00\u53d1\u5165\u5751 \uff0c\u8fd8\u6709\u52a0\u7fa4\u4e00\u8d77\u8ba8\u8bba\u76f8\u5173\u95ee\u9898\u5440\uff01\u5982\u679c\u7fa4\u4e8c\u7ef4\u7801\u8fc7\u671f\u4e86\uff0c\u53ef\u4ee5\u52a0\u6211\u4e2a\u4eba\u5fae\u4fe1: wuranxu \u6211\u62c9\u4f60\u8fdb\u7fa4~","title":"6.\u914d\u7f6eflask-sqlalchemy"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2860%29%20%E5%9C%A8Linux%E6%9C%BA%E5%99%A8%E4%B8%8A%E9%83%A8%E7%BD%B2Pity/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u8fd9\u662f\u4e00\u4e2a\u5b8c\u6574\u7684 \u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0\u7cfb\u5217\u6559\u7a0b \uff0c\u5e0c\u671b\u80fd\u548c\u5927\u5bb6\u4e00\u8d77\u5b66\u4e60\uff0c\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u5e73\u53f0\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u6d4b\u8bd5\u5f00\u53d1\u5751\u8d27 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \ud83d\udcd2 \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u7f16\u5199\u4e86 \u7528\u4f8b\u5217\u8868 \u76f8\u5173\u6539\u9020\uff0c\u4f46\u7531\u4e8e\u7f16\u8f91/\u65b0\u589ecase\u7684\u9875\u9762\u8fd8\u5f97\u597d\u597d\u8bbe\u8ba1\u4e00\u756a\uff0c\u800c \u540e\u7aef\u63a5\u53e3 \u4e5f\u6ca1\u5565\u5927\u7684\u53d8\u5316\u3002 \u6240\u4ee5\u4eca\u5929\u6211\u4eec\u6765\u804a\u804a\u600e\u4e48\u90e8\u7f72\u3002 \ud83d\udcd2 \u90e8\u7f72\u670d\u52a1\u7684\u51e0\u79cd\u65b9\u5f0f \u5176\u5b9e\u6211\u4eec\u5982\u679c\u662f\u5728 \u516c\u53f8 \u4f7f\u7528\u7684\u8bdd\uff0c\u4e00\u822c\u516c\u53f8\u8fd0\u7ef4\u90fd\u4f1a\u63d0\u4f9b\u90e8\u7f72\u670d\u52a1\u7684\u5e73\u53f0\uff0c\u4f46\u53ef\u80fd\u90fd\u662f\u4ee5\u4e1a\u52a1\u4ee3\u7801\u4f7f\u7528\u7684\u8bed\u8a00\u4e3a\u4e3b\u3002 \u6bd4\u5982\u6211\u4e0a\u5bb6\u516c\u53f8\uff0c \u4e1a\u52a1\u4ee3\u7801 \u662f\u7528\u7684Java\uff0c\u6240\u4ee5\u5728Java\u670d\u52a1\u7684\u90e8\u7f72\u4e0a\uff0c\u57fa\u672c\u4e0a\u63a5\u5165\u516c\u53f8\u53d1\u5e03\u7cfb\u7edf\u5373\u53ef\u3002\u4e0d\u626f\u8fdc\u4e86\uff0c\u6709\u7684\u516c\u53f8\u6d4b\u8bd5\u4f1a\u81ea\u5df1\u7ef4\u62a4\u4e00\u53f0\u670d\u52a1\u5668\uff0c\u968f\u4fbf\u513f\u4f60\u73a9\uff0c\u4e0d\u8d70\u53d1\u5e03\u7cfb\u7edf\u3002\uff08\u5f53\u7136\u5982\u679c\u4f60\u4eec\u516c\u53f8\u652f\u6301Python\u670d\u52a1\u7684\u53d1\u5e03\uff0c\u5efa\u8bae\u8fd8\u662f\u7528\u516c\u53f8\u7684\u53d1\u5e03\u7cfb\u7edf\uff0c\u8d35\u5728\u7a33\u5b9a+\u53ef\u89c6\u5316\uff09 \u5982\u679c\u6211\u4eec\u662f\u81ea\u5df1\u7ef4\u62a4\u81ea\u5df1\u7684\u670d\u52a1\u5668\uff0c\u8be5\u600e\u4e48 \u90e8\u7f72\u54b1\u4eec\u7684\u7cfb\u7edf \u5462\uff1f \u4ee5\u4e0b\u662fPity\u7684 \u90e8\u7f72\u6559\u7a0b \uff0c\u5982\u679c\u60f3\u770b\u5176\u4ed6Python\u90e8\u7f72\u65b9\u5f0f\u7684\uff0c\u53ef\u4ee5\u5148\u8df3\u8fc7\u54c8\u3002 \ud83d\udcd2 \u6570\u636e\u5e93 \u6570\u636e\u5e93\u8fd9\u5757\u6bd4\u8f83\u7b80\u5355\uff0cPity\u63d0\u4f9b\u4e86\u81ea\u52a8\u5efa\u8868\u529f\u80fd\uff0c\u5e95\u5c42\u4f7f\u7528\u7684\u662f MySQL \uff0c\u6240\u4ee5\u5927\u5bb6\u9700\u8981\u51c6\u5907\u4e00\u53f0MySQL\u670d\u52a1\u5668\uff0c\u6216\u8005\u5c31\u5728\u4f60\u7684\u670d\u52a1\u5668\u5b89\u88c5\u597dMySQL\u4e5f\u662f\u4e00\u6837\u3002 \u5177\u4f53\u7684\u5b89\u88c5\u8fc7\u7a0b\u6211\u8fd9\u513f\u5c31\u4e0d\u7ec6\u8bf4\u4e86\u3002 \u5b89\u88c5\u597d\u4ee5\u540e\u6211\u4eec\u4f1a\u62ff\u5230\u7528\u6237\u540d\uff0c\u5bc6\u7801\uff0chost\u548cport\u4fe1\u606f\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u521b\u5efa\u6570\u636e\u5e93: create database pity; \ud83c\udf66 \u4fee\u6539pity\u5173\u4e8e\u6570\u636e\u5e93\u7684\u914d\u7f6e \u5728pity/Config.py\u4fee\u6539SQLALCHEMY\u7684\u8fde\u63a5\u4e32: \u914d\u7f6e\u6210\u4f60\u4eec\u672c\u5730\u7684\u6570\u636e\u5e93\u8fde\u63a5 \u8fd9\u6837\u4f60\u7684\u6570\u636e\u5c31\u80fd\u597d\u597d\u4fdd\u5b58\u5728\u4f60\u4eec\u7684 \u6570\u636e\u5e93 \u4e86\u3002 \ud83d\udcd2 \u5b89\u88c5\u4f9d\u8d56 pip3 install -r requirements.txt \u4e5f\u53ef\u4ee5\u4f7f\u7528\u8c46\u74e3\u6e90: pip3 install -r requirements.txt -i https://pypi.douban.com/simple \u5982\u679c\u8fc7\u7a0b\u4e2d\u5b89\u88c5\u5931\u8d25\u4e86\uff0c\u5efa\u8bae \u5347\u7ea7\u4e00\u4e0bpip \u3002 \ud83d\udcd2 \u6d4b\u8bd5\u670d\u52a1\u662f\u5426\u542f\u52a8 \u5982\u679c\u542f\u52a8\u670d\u52a1\u7684\u65f6\u5019\u62a5\u6ca1\u6709logs\u6587\u4ef6\u5939\uff0c\u53ef\u4ee5\u5728pity\u6839\u76ee\u5f55\u65b0\u5efa\u6587\u4ef6\u5939: logs \uff0c\u56e0\u4e3agithub\u4f1a\u81ea\u52a8\u5ffd\u7565\u6389\u7a7a\u6587\u4ef6\u5939\uff0c\u6240\u4ee5\u53ef\u80fd\u9700\u8981\u5927\u5bb6\u81ea\u5df1\u521b\u5efa\u3002 \u5728pity\u76ee\u5f55\u4e0b\u542f\u52a8\u670d\u52a1: python3 main.py \u5982\u679c\u51fa\u73b0\u8fd9\u6837\u7684\u56fe\u7247\uff0c\u5219\u662f\u542f\u52a8\u6210\u529f\u4e86 \u6253\u5f00 http://\u670d\u52a1\u5668ip:7777 : \ud83d\udcd2 \u6b63\u9898 \u6211\u4eec\u4eca\u5929\u4e3b\u8981\u662f\u8bb2\u600e\u4e48\u7528gunicorn\u90e8\u7f72Python\u670d\u52a1\uff0c\u53ea\u4e0d\u8fc7\u535a\u4e3b\u6211\u5148\u7528\u4e86\u81ea\u5df1\u7684\u9879\u76ee \u63a2\u8def \u3002 \u56de\u5230\u6b63\u9898\uff0c\u6211\u4eec\u5148\u6765\u770b\u4e00\u770b\u6700\u7b80\u5355\u7684\u4e00\u4e2a \u90e8\u7f72\u65b9\u5f0f \u3002 \ud83c\udf66 \u7ecf\u5178\u90e8\u7f72\u65b9\u5f0f \u5728\u89e3\u51b3\u597d\u6240\u6709\u73af\u5883\u4f9d\u8d56\u4ee5\u540e\uff0c\u6211\u4eec\u901a\u8fc7python3 xxx.py\u542f\u52a8\u670d\u52a1\uff0c\u8fd9\u6837\u5176\u4ed6\u4eba\u5c31\u80fd\u591f\u901a\u8fc7\u670d\u52a1\u5668ip+\u7aef\u53e3\u8bbf\u95ee\u9875\u9762\u4e86\u3002 http://\u670d\u52a1\u5668ip:\u7aef\u53e3\u53f7/ \u601d\u8003\u4e00\u4e0b\u8fd9\u6837\u505a\u7684\u5f0a\u7aef: \u670d\u52a1\u5668\u4f1a\u4e00\u76f4\u6253\u5370\u7740\u8bf7\u6c42\u4fe1\u606f\uff0c\u5e76\u6ca1\u6709\u5728\u540e\u53f0\u8fd0\u884c \u5c31\u50cf\u73b0\u5728\u8fd9\u6837\uff0cshell\u4f1a\u4e00\u76f4\u6301\u7eed\u4fdd\u6301\u8fd9\u6837\u7684\u72b6\u6001 \u7a0b\u5e8f\u5982\u679c\u81ea\u52a8\u5b95\u673a\uff0c\u4e0d\u80fd\u81ea\u52a8\u6062\u590d \u6bd4\u5982\u54ea\u5929\u7a0b\u5e8f\u4e0d\u5c0f\u5fc3\u5d29\u6e83\u4e86\uff0c\u6709\u7684\u5f02\u5e38\u6ca1\u6709\u88ab \u81ea\u52a8\u6355\u83b7 \uff0c\u5bfc\u81f4\u6574\u4e2aPython\u7a0b\u5e8f\u5d29\u6e83\uff0c\u4ece\u800c\u5bfc\u81f4 \u7cfb\u7edf\u65e0\u6cd5\u8bbf\u95ee \u3002 Python GIL\u6027\u80fd\u592a\u5dee \ud83c\udf66 \u6539\u8fdb\u4e00\u4e0b \u9488\u5bf9\u7ecf\u5178\u90e8\u7f72\uff0c\u5176\u5b9e\u4e5f\u6709\u4e00\u4e9b\u5904\u7406\u65b9\u5f0f\uff0c\u6bd4\u5982\u7b2c\u4e00\u6761\uff0c\u6211\u4eec\u53ef\u4ee5\u7528 nohup \u5e2e\u6211\u4eec\u89e3\u51b3\u7b2c\u4e00\u4e2a\u56f0\u96be\u3002 nohup python xxx.py & \u7136\u540e\u53ef\u4ee5\u770b\u5230 \u5f53\u524d\u76ee\u5f55 \u751f\u6210\u4e86nohup.out\u7684\u6587\u4ef6\uff0c\u800c\u4f60\u7684\u63a7\u5236\u53f0\u7a97\u53e3\u4e5f\u6ca1\u6709\u518d \u505c\u7559 \u5728\u670d\u52a1\u8f93\u51fa\u7a97\u53e3\u3002 \u4f46\u8fd8\u6709\u5176\u4ed6\u56f0\u96be\uff0c\u6211\u4eec\u600e\u4e48\u89e3\u51b3\u5462\uff1f\u522b\u614c\uff01\u6211\u4eec\u8fd8\u6709gunicorn+supervisor \ud83d\udcd2 supervisor supervisor\u662f\u4e00\u4e2a\u6258\u7ba1\u5bb9\u5668\uff0c\u4f60\u7684\u5e94\u7528\u4f1a\u88ab\u6258\u7ba1\u5230\u91cc\u9762\uff0c\u800c\u4ed6\u4f1a\u63d0\u4f9b\u4e00\u4e2a \u5b88\u62a4\u7ebf\u7a0b \uff0c\u4e13\u95e8\u76d1\u63a7\u4f60\u7684\u5e94\u7528\u3002\u5f53\u4f60\u7684\u5e94\u7528\u4e0d\u5c0f\u5fc3\u5d29\u4e86\uff0c\u4ed6\u4f1a\u81ea\u52a8\u628a\u5e94\u7528\u62c9\u8d77\uff0c \u975e\u5e38\u597d\u7528 \uff01 \u9047\u5230\u975e\u4ee3\u7801\u9519\u8bef\uff0c\u6bd4\u5982\u6709\u4eba\u8bef\u64cd\u4f5ckill\u6389\u4f60\u7684\u7a0b\u5e8f\uff0c\u5b83\u4f1a\u81ea\u52a8\u5e2e\u5fd9\u62c9\u8d77\uff0c\u6beb\u65e0\u6ce2\u6f9c\u3002 \ud83d\udcd2 gunicorn gunicorn\u57fa\u4e8egevent\uff0c\u5dee\u4e0d\u591a\u7b97\u662f\u4e2a\u63d0\u5347app\u6027\u80fd\u7684\u5e93\uff0c\u5b83\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u7684web\u5e94\u7528\u63d0\u5347\u6027\u80fd\uff0c\u5e76\u4e14\u4ed6\u4e5f\u6709\u81ea\u52a8\u91cd\u542f\u7684\u529f\u80fd\uff0c\u8fd8\u53ef\u4ee5\u5f00\u542f\u6839\u636e\u670d\u52a1\u5668\u914d\u7f6e\u5f00\u542f\u4e0d\u540c\u6570\u91cf\u7684 worker \u3002 \ud83d\udcd2 \u600e\u4e48\u4f7f\u7528\u5462 \ud83c\udf66 \u5b89\u88c5Gunicorn pip3 install gunicorn \u4ee5\u6211\u4eec\u7684app\u4e3a\u4f8b\uff0c\u6211\u4eec\u7684app\u540d\u5b57\u53ebpity\uff0c\u6587\u4ef6\u662fmain.py\uff0c\u6240\u4ee5\u53d6\u5230app\u7684\u65b9\u6cd5\u5c31\u662f: main:pity \ud83c\udf66 \u666e\u901agunicorn\u6a21\u5f0f \u5b89\u88c5\u597d\u4ee5\u540egunicorn\u547d\u4ee4\u5c31\u80fd\u591f\u4f7f\u7528\u4e86\uff0c\u8f93\u5165\u547d\u4ee4: # FastApi\u5e94\u7528 gunicorn -k uvicorn.workers.UvicornWorker main:pity -b 0.0.0.0:7777 -w 4 & \u89e3\u91ca\u4e00\u4e0b\u53c2\u6570: -k: \u8fd9\u4e2a\u662f\u6307\u5b9aworker\u4e3aUvicorn\u7684Worker\uff0c\u4e3afastapi\u4e13\u5c5e\uff0c\u5176\u4ed6\u6bd4\u5982flask\u5e94\u7528\u4e0d\u9700\u8981\u5e26\u4e0a\u8fd9\u4e2a\u53c2\u6570\u3002 -w workers\u6570\u91cf\uff0c\u4e5f\u5c31\u662f\u8d77\u7684\u7ebf\u7a0b\u6570\u91cf\uff0c\u4e00\u822c\u6839\u636e\u81ea\u5df1 CPU\u5185\u6838 \u6765\u3002\u6bd4\u5982\u6211\u7684\u670d\u52a1\u5668\u662f4\u6838\u7684\uff0c\u90a3\u6211\u5c31\u8bbe\u5b9a\u4e3a4\u3002 main:pity\u5c31\u662f\u4e0a\u9762\u8bf4\u7684app\u7684\u5177\u4f53\u4f4d\u7f6e\u3002 \ud83d\udcd2 \u8bd5\u9a8c\u4e00\u4e0b \u53ef\u4ee5\u770b\u5230\u670d\u52a1\u90fd\u542f\u52a8\u6210\u529f\u4e86 ps -ef | grep gunicorn\u53ef\u4ee5\u770b\u5230\u8fd9\u4e9b\u4e2a\u7ebf\u7a0b \ud83c\udf66 \u914d\u7f6e\u6587\u4ef6\u7684\u65b9\u5f0f\u542f\u52a8 \u6211\u4eec\u7f16\u5199gunicorn.py\u6587\u4ef6\uff08\u914d\u7f6e\u6587\u4ef6\uff09: import os import gevent.monkey gevent.monkey.patch_all() import multiprocessing # debug = True loglevel = 'debug' bind = \"0.0.0.0:7777\" pidfile = \"logs/gunicorn.pid\" accesslog = \"logs/access.log\" errorlog = \"logs/debug.log\" daemon = True timeout = 60 # \u542f\u52a8\u7684\u8fdb\u7a0b\u6570 # workers = multiprocessing.cpu_count() workers = 8 worker_class = 'gevent' x_forwarded_for_header = 'X-FORWARDED-FOR' \u914d\u7f6e\u597dbind\u5730\u5740\uff0c\u65e5\u5fd7\u4fe1\u606f\uff0cworkders\u6570\u91cf\uff0c multiprocessing.cpu_count() \u4f1a\u8fd4\u56deCPU\u6570\u91cf\u3002 \u8bb0\u5f97\u5b89\u88c5gevent \uff0c\u7528pip\u3002 \u53ef\u4ee5\u770b\u5230\u670d\u52a1\u8d77\u6765\u4e86\uff0c\u8fd9\u8fb9\u6211\u5f00\u4e868\u4e2a workder \u3002 \u5176\u5b9e\u8fd9\u4e2a\u65f6\u5019gunicorn\u5df2\u7ecf\u5177\u5907\u4e86 \u81ea\u52a8\u62c9\u8d77 \u529f\u80fd\uff0c\u4f46gunicorn\u4e5f\u53ef\u80fd\u88abkill\u6389\uff0c\u6240\u4ee5\u6211\u4eec\u66f4\u7a33\u59a5\u70b9\u513f\u7684\u8bdd\uff0c\u9700\u8981 supervisor \u3002 \ud83c\udf66 supervisor \u8fd9\u5757\u7684\u8d44\u6599\u6bd4\u8f83\u591a\uff0c\u5927\u5bb6\u53ef\u4ee5\u5c3d\u60c5\u767e\u5ea6\uff0c\u56e0\u4e3a\u535a\u4e3b\u4e3b\u8981\u8bb2\u7684\u662f\u90e8\u7f72\u65b9\u5f0f\uff0c\u8fd8\u5f97\u9760\u5927\u5bb6\u81ea\u5df1\u53bb \u5b9e\u8df5 \u5450\u3002 \ud83d\udcd2 \u66f4\u591a\u90e8\u7f72\u65b9\u5f0f docker \uff0c k8s \u4ec0\u4e48\u7684\u4e5f\u662f\u4e0d\u9519\u7684\u9009\u62e9\uff0c\u5982\u679c\u5927\u5bb6\u6709\u5174\u8da3\u4e5f\u53ef\u4ee5\u591a\u7814\u7a76\u4e00\u4e0b\uff0c\u4f5c\u4e3a \u6d4b\u8bd5 \u7684\u6211\u4eec\uff0c\u638c\u63e1\u597d\u57fa\u672c\u7684\u7528\u6cd5\u5373\u53ef\u3002 \u5982\u679c\u6709\u5174\u8da3\u4e5f\u6b22\u8fce\u5927\u5bb6\u4e00\u8d77 \u63a2\u8ba8 ~~","title":"60.\u5728Linux\u673a\u5668\u4e0a\u90e8\u7f72Pity"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2861%29%20%E9%87%8D%E6%9E%84%E7%94%A8%E4%BE%8B%E8%AF%A6%E6%83%85%E9%A1%B5%E9%9D%A2/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u8fd9\u662f\u4e00\u4e2a\u5b8c\u6574\u7684 \u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0\u7cfb\u5217\u6559\u7a0b \uff0c\u5e0c\u671b\u80fd\u548c\u5927\u5bb6\u4e00\u8d77\u5b66\u4e60\uff0c\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u5e73\u53f0\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u6d4b\u8bd5\u5f00\u53d1\u5751\u8d27 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \ud83d\udcd2 \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u63d2\u5165\u4e86 \u9898\u5916\u8bdd : \u90e8\u7f72\u76f8\u5173\u7684\u5185\u5bb9\uff0c\u8ba9\u6211\u4eec\u8fd9\u8282\u7ee7\u7eed\u56de\u5230case\u76f8\u5173\u7684\u8bdd\u9898\u3002 \ud83d\udcd2 \u65b0\u7684\u7bc7\u7ae0 \u5176\u5b9e\u5728\u4e4b\u524d\u7684 \u7528\u4f8b\u7f16\u5199 \u76f8\u5173\u9875\u9762\u5e9f\u5f03\u4ee5\u540e\uff0c\u6211\u4e00\u76f4\u5728\u601d\u8003\u600e\u4e48\u53bb\u6784\u5efa\u4e00\u4e2a\u5408\u7406\u7684\uff0c\u4eba\u6027\u5316\u7684 \u7528\u4f8b\u7f16\u5199 \u9875\u9762\u3002 \u4f46\u5176\u5b9e\u4e5f\u6ca1\u6709\u627e\u5230\u597d\u7684 \u89e3\u51b3\u65b9\u6848 \uff0c\u671f\u95f4\u4e5f\u53c2\u8003\u8fc7\u4e00\u4e9b\u5176\u4ed6\u4f18\u79c0\u7684\u5f00\u6e90\u9879\u76ee\u3002\u6700\u7ec8\u5462\uff0c\u6211\u8fd8\u662f\u56de\u5f52\u5230\u4e86Tab\u6a21\u5f0f: \u6700\u7ec8\u6548\u679c\u5927\u6982\u4f1a\u957f\u8fd9\u6837: \u4e3b\u8981\u5206\u4e3a2\u5757\uff0c\u4e0a\u9762\u662f \u7528\u4f8b\u76f8\u5173\u7684\u6570\u636e \uff0c\u4e0b\u9762\u662f\u7f16\u5199\u7528\u4f8b\u7684\u6838\u5fc3\u5730\u65b9\uff0c\u5206\u4e3a\u5e38\u89c1\u7684\u6a21\u5757\u3002 \u4e0b\u65b9\u5206\u4e3a4\u4e2a\u6b65\u9aa4\uff0c\u6570\u636e\u6784\u9020\u5668\uff08\u524d\u7f6e\u6761\u4ef6\uff09-> \u63a5\u53e3\u8bf7\u6c42 -> \u65ad\u8a00 -> \u6570\u636e\u6e05\u7406\u3002 \u7b26\u5408 \u4eba\u4f53\u5de5\u5b66\u8bbe\u8ba1 \u7684setUp -> test -> assert -> tearDown \ud83d\udcd2 \u76f8\u5173\u6539\u9020 \u8fd9\u4e9b\u57fa\u672c\u4e0a\u7b97\u662f\u524d\u7aef\u9875\u9762\u7684\u6539\u9020\uff0c\u4f46\u662f\u540e\u7aef\u63a5\u53e3\u4e5f\u4f1a\u6709\u4e00\u4e9b\u53d8\u5316\u3002\u6240\u4ee5\u6211\u4eec\u5f97\u5bf9 \u63a5\u53e3 \u505a\u4e00\u4e9b\u9002\u914d\u3002 \u67e5\u8be2\u5355\u4e2a\u9879\u76ee\u7684\u65f6\u5019\uff0c\u6211\u4eec\u628acase\u4fe1\u606f\u83b7\u53d6\u6b65\u9aa4\u5220\u6389\uff0c\u52a0\u5feb\u63a5\u53e3\u54cd\u5e94\u901f\u5ea6 \ud83c\udf66 \u7f16\u5199\u6839\u636e\u7528\u4f8bid\u83b7\u53d6\u524d\u7f6e\u6761\u4ef6\u7684\u65b9\u6cd5 \u6ce8\u610f\u8fd9\u91cc\u6709\u4e00\u4e2a\u4f0f\u7b14: \u6211\u4eec\u7684\u524d\u7f6e\u6761\u4ef6\u80af\u5b9a\u662f\u6709\u987a\u5e8f\u53bb\u6267\u884c\u7684\uff0c\u4f46\u6211\u8fd9\u8fb9\u6309\u7167 \u521b\u5efa\u65f6\u95f4 \u6392\u5e8f\uff0c\u663e\u7136\u662f\u4e0d\u53cb\u597d\u7684\uff0c\u4f46\u540e\u9762\u6211\u4eec\u4f1a\u652f\u6301\u53d8\u66f4\u524d\u7f6e\u6761\u4ef6\u6267\u884c\u987a\u5e8f\u7684\u529f\u80fd\u3002 \u8fd9\u5c31\u662f\u9884\u89c8\u56fe \ud83c\udf66 \u8c03\u6574\u83b7\u53d6\u7528\u4f8b\u5217\u8868\u65b9\u6cd5 \u6539\u4e3a\u5f02\u6b65\u6267\u884c\uff0c\u5e76\u4e14\u652f\u6301\u6839\u636e \u76ee\u5f55 \u83b7\u53d6case\uff0c\u51cf\u5c11\u5927\u89c4\u6a21\u67e5\u8be2case\u7684\u6b21\u6570\u3002 \ud83c\udf66 \u8c03\u6574\u83b7\u53d6\u5355\u4e2acase\u7684\u65b9\u6cd5 \u53ef\u4ee5\u770b\u5230\u6539\u52a8\u8fd8\u662f\u633a\u591a\u7684 \u4ee5\u524d\u53ea\u62fftestcase\uff0c\u73b0\u5728\u9700\u8981\u62ff\u5230case\u7684 \u57fa\u672c\u4fe1\u606f \uff0c \u524d\u7f6e\u6761\u4ef6 \uff0c\u65ad\u8a00\u4fe1\u606f\uff0c\u6700\u540e\u5c01\u88c5\u5230\u4e00\u4e2a\u5b57\u5178\u91cc\u9762\u8fd4\u56de\uff0c\u540e\u9762\u8fd8\u4f1a\u6709 \u540e\u7f6e\u6761\u4ef6 \u3002 \u8fd9\u8fb9\u6ca1\u6709\u9009\u62e9\u7528join\uff0c\u56e0\u4e3a\u6d89\u53ca\u7684\u8868\u6bd4\u8f83\u591a\uff0c\u6240\u4ee5\u6211\u4eec\u67e5\u8be2\u591a\u6b21\uff0c\u540e\u7eed\u6211\u4eec\u53ef\u4ee5\u628a\u67e5\u8be2\u597d\u7684\u6570\u636e\u90fd\u653e\u5165redis\uff0c\u51cf\u8f7b\u6570\u636e\u5e93\u7684\u538b\u529b\u3002 \u4e3a\u4ec0\u4e48\u8981\u82b1\u8fd9\u4e48\u591a\u65f6\u95f4\u8fdb\u884c\u8fd9\u5757\u7684\u6539\u9020\uff0c\u5176\u5b9e\u662f\u56e0\u4e3a\u4e4b\u524d\u786e\u5b9e \u592a\u96be\u7528 \u4e86\u3002 \u6bd4\u5982\u6211\u81ea\u5df1\u90fd\u89c9\u5f97\u6dfb\u52a0\u4e00\u4e2a \u524d\u7f6e\u6761\u4ef6 \u7279\u522b\u8d39\u52b2\uff0c\u6dfb\u52a0\u540e\u8fd8\u4e0d\u80fd\u5c55\u793a\u51fa\u6765\u3002 \u4eca\u5929\u7684\u5185\u5bb9\u5c31\u4ecb\u7ecd\u5230\u8fd9\u91cc\uff0c\u4e0b\u4e00\u8282\u8bb2 \u5982\u4f55\u63a7\u5236\u524d\u7f6e\u6761\u4ef6\u7684\u6267\u884c\u987a\u5e8f \u3002","title":"61.\u91cd\u6784\u7528\u4f8b\u8be6\u60c5\u9875\u9762"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2862%29%20%E8%AE%A9%E5%89%8D%E7%BD%AE%E6%9D%A1%E4%BB%B6%E6%9C%89%E8%87%AA%E5%B7%B1%E7%9A%84%E9%A1%BA%E5%BA%8F/","text":"\u5927\u5bb6\u597d~\u6211\u662f\u7c73\u6d1b\uff0c\u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u6d4b\u8bd5\u5f00\u53d1\u5751\u8d27 ! \ud83d\udcd2 \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u8bb2\u4e86 \u7528\u4f8b\u7f16\u8f91\u9875\u9762 \u76f8\u5173\u7684\u8c03\u6574\uff0c\u4f46\u56e0\u4e3a\u6211\u4eec\u7684\u524d\u7f6e\u6761\u4ef6\u8fd8\u4e0d\u652f\u6301\u6309\u987a\u5e8f\u6267\u884c\uff0c\u6240\u4ee5\u6211\u4eec\u4eca\u5929\u6765\u641e\u5b9a\u5b83\u3002 \ud83d\udcd2 \u601d\u8003\u4e00\u4e0b\u8be5\u600e\u4e48\u505a \u5176\u5b9e\u6bd4\u8f83\u7b80\u5355\uff0c\u6211\u4eec\u7ed9\u524d\u7f6e\u6761\u4ef6\u7684\u8868\uff0c\u52a0\u4e00\u4e2a index \u7684\u5b57\u6bb5\uff0c\u8fd9\u6837\u7684\u8bdd\u5b83\u5c31\u6709\u4e86\u81ea\u5df1\u7684 \u987a\u5e8f \uff0c\u4ee5\u540e\u6211\u4eec\u53d6 \u7528\u4f8b\u7684\u524d\u7f6e\u6761\u4ef6 \u5c31\u53ef\u4ee5\u6839\u636eindex\u6765\u83b7\u53d6\u987a\u5e8f\u4e86\uff0c\u6267\u884ccase\u7684\u65f6\u5019\u4e5f\u4e0d\u4f1a\u9519\u4e71\u4e86\u3002 \ud83d\udcd2 \u52a8\u8d77\u6765 \ud83c\udf66 \u65b0\u589eindex\u5b57\u6bb5 \u52a0\u5165index\u5b57\u6bb5\uff0cINT\u7c7b\u578b \ud83c\udf66 \u7f16\u5199\u83b7\u53d6\u6700\u65b0\u7d22\u5f15\u7684\u65b9\u6cd5 \u5148\u67e5\u8be2\u8fd9\u4e2acase\u4e0b\u7684\u6240\u6709\u524d\u7f6e\u6761\u4ef6\uff0c\u6309index\u7684\u5012\u5e8f\u6392\u5217\uff0c\u5982\u679c\u6ca1\u67e5\u5230\uff0c\u5219\u8bf4\u660e\u6ca1\u6709\u524d\u7f6e\u6761\u4ef6\uff0c\u76f4\u63a5\u8fd4\u56de0\uff0c\u5426\u5219\u8fd4\u56deindex+1\u3002 \u63a5\u7740\u5728\u63d2\u5165\u524d\u7f6e\u6761\u4ef6\u7684\u65f6\u5019\uff0c\u7ed9\u5b83\u8d4b\u4e88\u6700\u65b0\u7684index \ud83c\udf66 \u6ce8\u610f\u4e00\u4e2a\u95ee\u9898 \u5982\u679c\u8c03\u6574\u987a\u5e8f\u7684\u65f6\u5019\uff0c\u53ef\u80fd \u6bcf\u4e2a\u5143\u7d20 \u90fd\u632a\u52a8\u4e86\uff0c\u90a3\u8be5\u600e\u4e48\u529e\u5462\uff1f \u6240\u4ee5\u6211\u4eec\u9700\u8981\u4e00\u4e2a\u6279\u91cf\u66f4\u65b0index\u7684\u65b9\u6cd5: \ud83c\udf66 \u7f16\u5199\u66f4\u65b0\u987a\u5e8f\u7684\u65b9\u6cd5 \u5728sqlalchemy\u91cc\u9762\uff0c\u53ef\u4ee5\u7528 bulk_update_mappings \u53bb\u6279\u91cf\u66f4\u65b0\u4e00\u4e9b\u6570\u636e\uff0c\u4f46\u524d\u63d0\u662f \u5fc5\u987b\u5e26\u4e0aid\u5b57\u6bb5 \u3002 \u9057\u61be\u7684\u662f\uff0c\u5f02\u6b65session\u4e0d\u652f\u6301\u8fd9\u65b9\u6cd5\u3002\u6240\u4ee5\u6211\u4eec\u7684\u65b9\u6cd5\u7f16\u5199\u8d77\u6765\u5f88\u7b80\u5355: \u62fc\u63a5\u4e00\u4e2a\u6570\u7ec4\uff0c\u91cc\u9762\u5b58\u653eid\u548cindex \u76f4\u63a5\u66f4\u65b0\u540ecommit\u5373\u53ef\u3002 \u4f1a\u6709\u4e00\u5b9a\u7684\u5ef6\u8fdf\uff0c\u56e0\u4e3a\u662f\u771f\u6b63\u53bb\u66f4\u65b0\u6570\u636e\u5e93\u4e86 \u4e4b\u524d\u7684\u6f14\u793a\u56fe\u662f\u6ca1\u53bb\u5b9e\u9645 \u66f4\u65b0\u6570\u636e\u5e93 \u7684\u3002 \ud83c\udf66 \u7f16\u5199\u66f4\u65b0\u548c\u5220\u9664\u6570\u636e\u6784\u9020\u5668\u7684\u65b9\u6cd5 \u53ef\u4ee5\u770b\u5230\u66f4\u65b0\u548c\u5220\u9664\u5176\u5b9e\u90fd\u662fupdate\u7684\u64cd\u4f5c\uff0c\u56e0\u4e3a\u54b1\u4eec\u662f \u8f6f\u5220\u9664 \uff0c\u6240\u4ee5\u5176\u5b9e\u5c31\u662f\u628aconstructor\u7684deleted_at\u6539\u6210\u4e86\u5f53\u524d\u65f6\u95f4\u3002 \u63a5\u7740\u7f16\u5199\u5220\u9664\u548c\u66f4\u65b0\u7684\u63a5\u53e3 \ud83c\udf66 \u524d\u7aef\u8fdb\u884c\u9002\u914d \u70b9\u51fb\u7f16\u8f91\u6309\u94ae\uff0c\u53ef\u4ee5\u5f39\u51fa\u5bf9\u5e94\u7684\u6570\u636e\u6784\u9020\u5668 \u7ed9\u4e2a\u53cb\u597d\u7684\u63d0\u793a\uff0c\u4ee5\u514d\u8bef\u5220 \u597d\u4e86\uff0c\u4eca\u5929\u7684\u5185\u5bb9\u5c31\u8bf4\u5230\u8fd9\u91cc\u4e86\u3002 \u5176\u5b9e \u6700\u82b1\u65f6\u95f4\u7684\u8fd8\u662f\u5728\u524d\u7aef\u7684\u4ea4\u4e92\u4e0a\u9762\uff0c\u4f46\u5927\u4f53\u4e0a \u6570\u636e\u6784\u9020\u5668 \u7b97\u662f\u53ef\u7528\u4e86\u3002 \u4e0b\u4e00\u8282\u6211\u4eec\u8bb2\u8bb2 \u8f6f\u5220\u9664\u4e4b\u6b87 ~","title":"62.\u8ba9\u524d\u7f6e\u6761\u4ef6\u6709\u81ea\u5df1\u7684\u987a\u5e8f"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2863%29%20%E8%BD%AF%E5%88%A0%E9%99%A4%E4%B9%8B%E6%AE%87/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u8fd9\u662f\u4e00\u4e2a\u5b8c\u6574\u7684 \u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0\u7cfb\u5217\u6559\u7a0b \uff0c\u5e0c\u671b\u80fd\u548c\u5927\u5bb6\u4e00\u8d77\u5b66\u4e60\uff0c\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u5e73\u53f0\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u6d4b\u8bd5\u5f00\u53d1\u5751\u8d27 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \ud83d\udcd2 \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u57fa\u672c\u4e0a\u641e\u5b9a\u4e86 \u6570\u636e\u6784\u9020\u5668 \u7684\u589e\u5220\u6539\u7b49\u64cd\u4f5c\uff0c\u8fd9\u4e00\u7bc7\u6211\u4eec\u6765\u8bb2\u8bb2 \u8f6f\u5220\u9664 \u76f8\u5173\u7684\u5185\u5bb9\u3002 \ud83d\udcd2 \u4ec0\u4e48\u662f\u8f6f\u5220\u9664 \u5148\u58f0\u660e\u4e00\u4e0b\uff0c\u6211 \u6ca1\u6709 \u67e5\u9605\u5173\u4e8e\u5177\u4f53 \u8f6f\u5220\u9664 \u7684\u8d44\u6599\uff0c\u5927\u5bb6\u6709\u5174\u8da3\u7684\u53ef\u4ee5\u81ea\u5df1\u53bb\u641c\u7d22\u4e0b\uff0c\u6211\u8bf4\u7684\u90fd\u662f\u81ea\u5df1\u7684 \u7406\u89e3 \u3002 \u5220\u9664\u6570\u636e\uff0c\u4e00\u822c\u6765\u8bf4\u6211\u4eec\u662f\u4ece \u6570\u636e\u5e93 \u6216\u5176\u4ed6\u5b58\u50a8\u4ecb\u8d28\u91cc\u9762\u5220\u9664\u6570\u636e\uff0c\u4e3e\u4e2a\ud83c\udf30\u6817\u5b50: \u6211\u4eec\u9700\u8981\u628a \u6570\u636e\u8868 \u91cc\u9762\u7684\u7528\u6237A\u5220\u9664\u6389\uff0c\u90a3\u6211\u4eec\u6700 \u5e38\u89c1 \u7684\u65b9\u5f0f\u5c31\u662f: delete from user where name = 'A' ; \u8fd9\u4e2a\u6211\u7406\u89e3\u7684\u8bdd\uff0c\u5c31\u662f \u7269\u7406\u5220\u9664 \uff0c\u5220\u9664\u4e86\u4ee5\u540e\uff0c\u6211\u4eec\u7684\u6570\u636e\u8868\u91cc\u9762 \u4e0d\u518d\u6709\u8fd9\u6761\u6570\u636e\u7684\u4fe1\u606f \uff0c\u5982\u679c\u8fd8\u9700\u8981\u8fd9\u4e2a\u7528\u6237\uff0c\u5219\u9700\u8981\u91cd\u65b0insert\u4e00\u904d\u3002 \u90a3 \u8f6f\u5220\u9664 \u53c8\u662f\u4ec0\u4e48\u5462\uff1f\u8f6f\u5220\u9664\u4e5f\u53ef\u4ee5\u53eb\u505a \u903b\u8f91\u5220\u9664 \uff0c\u6bd4\u5982\u6211\u4eec\u7ed9User\u8868\u5b9a\u4e49\u4e00\u4e2a\u5b57\u6bb5: deleted_at\uff08 \u4ee3\u8868\u8fd9\u6761\u6570\u636e\u5220\u9664\u7684\u65f6\u95f4 \uff09\uff0c\u5982\u679c\u8fd9\u4e2a\u5b57\u6bb5\u4e0d\u4e3a\u7a7a\uff0c\u8bf4\u660e \u7528\u6237\u672a\u88ab\u5220\u9664 , \u53cd\u4e4b\u5219\u8bf4\u660e \u7528\u6237\u5df2\u7ecf\u88ab\u5220\u9664\u4e86 \u3002\u56e0\u4e3a\u53ea\u662f\u903b\u8f91\u4e0a\u7684\"\u5220\u9664\"\uff0c\u5e76\u4e0d\u662f\u771f\u6b63\u5220\u6389\u4e86\u8fd9\u6761\u6570\u636e\uff0c\u6240\u4ee5\u53c8\u53eb\u505a\u903b\u8f91\u5220\u9664\u3002 \ud83c\udf66 \u8f6f\u5220\u9664\u7684\u4f18\u70b9 \u8f6f\u5220\u9664\u5bf9\u6bd4\u7269\u7406\u5220\u9664\u7684\u8bdd\uff0c\u597d\u5904\u5728\u54ea\u5462\uff1f\u6211\u8ba4\u4e3a\u6709\u4ee5\u4e0b\u51e0\u4e2a\u65b9\u9762: \u6570\u636e\u672a\u88ab \u771f\u5b9e\u5220\u9664 \uff0c\u6570\u636e\u66f4\u53ef\u9760 \u53ef\u4ee5\u901a\u8fc7\u628a\u5220\u9664\u7684\u65f6\u95f4\u6233\u8d4b\u4e88\u7ed9deleted_at\uff0c\u4ece\u800c\u77e5\u9053\u5220\u9664\u7684\u65f6\u95f4\uff0c\u65e0\u5f62\u4e4b\u4e2d\u8bb0\u5f55\u4e86\u7528\u6237\u7684\u5220\u9664\u64cd\u4f5c \u5bf9\u4e8e\u7528\u6237\u800c\u8a00\u548c\u7269\u7406\u5220\u9664\u6ca1\u4ec0\u4e48\u533a\u522b \u62e5\u6709\u5929\u7136\u7684\u56de\u6536\u7ad9\u529f\u80fd \ud83c\udf66 \u8f6f\u5220\u9664\u7684\u7f3a\u70b9 \u4e0a\u9762\u63d0\u5230\u4e86 \u8f6f\u5220\u9664 \u7684\u597d\u5904\uff0c\u8fd9\u91cc\u5c31\u6765\u8bf4\u8bf4\u8f6f\u5220\u9664\u8ba9\u4eba \u53c8\u7231\u53c8\u6068 \u7684\u5730\u65b9\u3002 \u67e5\u8be2\u6570\u636e\u66f4\u52a0\u590d\u6742 \u67e5\u8be2\u6761\u4ef6\u9700\u8981\u5e26\u5165 deleted_at is null \uff0c\u5426\u5219\u4f1a\u67e5\u8be2\u51fa \u88ab\u5220\u9664 \u7684\u6570\u636e\u3002 \u9664\u4e86\u8fd9\u4e2a\u4ee5\u5916\uff0c\u8fd8\u6709\u4e00\u4e2a\u6bd4\u8f83\u68d8\u624b\u7684\u95ee\u9898\uff0c\u4e14\u542c\u6211\u6162\u6162\u9053\u6765\u3002 \ud83d\udcd2 \u7d22\u5f15\u4e4b\u6b87 \u7d22\u5f15\u8fd9\u5757\u662f\u4e00\u4e2a\u6bd4\u8f83 \u68d8\u624b \u7684\u95ee\u9898\uff0c\u7279\u522b\u662f\u5f53\u6211\u4eec\u6709\u552f\u4e00\u7d22\u5f15\u7684\u65f6\u5019\uff0c\u6211\u4eec\u5148\u6765\u770b\u4e00\u79cd\u573a\u666f\u3002 \u7528\u6237\u8868 \u6211\u4eec\u7684\u7528\u6237\u8868\u91cc\u9762\u6709email\u5b57\u6bb5\uff0c\u4f46email\u5927\u5bb6\u90fd\u61c2\u7684\uff0c\u662f \u4e0d\u53ef\u4ee5\u91cd\u590d \u7684\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u7ed9\u5b83\u52a0\u4e0a \u552f\u4e00\u7d22\u5f15 \u3002 \ud83d\udcd2 \u573a\u666f\u4e00 \u6765\u770b\u7b2c\u4e00\u79cd\u573a\u666f\uff0c\u6211\u4eec\u4e3a\u7528\u6237\u8868\u521b\u5efa\u4e86\u4e00\u6761\u6570\u636e\uff1a email -> 123456 @qq.com deleted_at -> null \u6211\u4eec\u8fd9\u65f6\u5019\u8981 \u5220\u9664\u8fd9\u6761\u6570\u636e \uff0c\u4f46\u56e0\u4e3a\u8f6f\u5220\u9664\u7684\u539f\u56e0\u6211\u4eec\u4f1a\u5199\u8fd9\u6837\u7684sql: update user set deleted_at = now () where email= '12345@qq.com' ; \u4f60\u4ee5\u4e3a\u8fd9\u5c31\u6ca1\u4e8b\u513f\u4e86\u5417\uff1f \u63a5\u4e0b\u6765\u7684\u4e8b\u60c5\u5c31\u8ba9\u4eba \u8111\u5d29 \u4e86\uff0c\u7531\u4e8e\u552f\u4e00\u7d22\u5f15 email_uidx \u7684\u5b58\u5728\uff0c\u6211\u6ca1\u6cd5\u518d\u65b0\u63d2\u5165\u4e00\u6761email=123456@qq.com\u7684\u6570\u636e\u4e86\u3002 \u6267\u884c \u63d2\u5165\u8bed\u53e5 \u7684\u65f6\u5019\uff0c\u4f1a\u62a5duplicate index\u7684\u9519\u8bef\uff0c\u76f8\u4fe1\u5927\u5bb6\u4e5f\u4e0d\u5c11\u89c1\u3002 \u90a3\u8fd9\u4e2a\u95ee\u9898\u600e\u4e48\u89e3\u51b3\u5462\uff1f\u6211\u4eec\u6765\u770b\u770b \u573a\u666f\u4e8c \u3002 \ud83c\udf66 \u8bd5\u7740\u89e3\u51b3\u4e00\u4e0b \u4e3a\u4e86\u89e3\u51b3\u573a\u666f\u4e00\u7684 \u552f\u4e00\u7d22\u5f15 \u95ee\u9898\uff0c\u6211\u4eec\u60f3\u5230\u4e86 \u8054\u5408\u7d22\u5f15 \uff0c\u5565\u5b50\u53eb\u8054\u5408\u552f\u4e00\u7d22\u5f15\u5462\uff1f\u5c31\u662f\u591a\u4e2a\u5b57\u6bb5\u540c\u65f6\u76f8\u540c\u7684\u65f6\u5019\uff0c\u6570\u636e\u624d\u7b97\u91cd\u590d\uff0c\u4e5f\u5c31\u662f\u89e6\u53d1 duplicate index \u62a5\u9519\u3002 \u4e8e\u662f\u6211\u4eec\u521b\u5efa\u4e00\u4e2a\u8054\u5408\u552f\u4e00\u7d22\u5f15: ALTER TABLE user ADD UNIQUE INDEX (email, deleted_at); \u8fd9\u65f6\u5019\uff0c\u6211\u4eec\u518d\u6765\u770b\u573a\u666f\u4e00: \u521b\u5efa\u7528\u6237 email= 12345 @qq.com deleted_at=null \u63a5\u7740\uff0c\u6211\u4eec\u5220\u9664\u4e4b\uff0c\u8fd9\u65f6\u5019\u5b83\u53d8\u6210\u4e86: email= 12345 @qq.com deleted_at= 2021 -09 -12 20 : 13 : 00 \u7136\u540e\u6211\u4eec\u7ee7\u7eed\u6dfb\u52a0 12345@qq.com \u7684\u7528\u6237\uff0c\u53d1\u73b0 \u53ef\u4ee5\u6dfb\u52a0\u4e86 \u3002 \u4f60\u4ee5\u4e3a\u8fd9\u5c31 \u5b8c\u4e8b \u4e86\uff1f\u90a3\u6211\u4eec\u518d\u770b\u770b\u573a\u666f\u4e8c: \ud83d\udcd2 \u573a\u666f\u4e8c \u8fd9\u4e2a\u6bd4\u8f83\u7b80\u5355\uff0c\u6211\u4eecinsert2\u6761\u76f8\u540c\u7684\u6570\u636e: insert into user (email, deleted_at) values ( '12345@qq.com' , null ); insert into user (email, deleted_at) values ( '12345@qq.com' , null ); \u597d\u4e45\u6ca1\u5199sql\uff0c\u4e5f\u4e0d\u77e5\u9053\u5199\u7684\u5bf9\u4e0d\u5bf9\uff0c\u51d1\u5408\u770b\uff0c\u5927\u6982\u662f\u8fd9\u4e48\u4e2a\u610f\u601d\u3002 \u8fd9\u65f6\u5019 \u5947\u8ff9\u51fa\u73b0\u4e86 \uff0c\u53ef\u4ee5\u53d1\u73b02\u6761\u6570\u636e\u90fd\u63d2\u5165\u6210\u529f\u4e86\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u4e4b\u524d\u7684email\u7684 \u552f\u4e00\u6027 \u5f97\u4e0d\u5230\u4fdd\u8bc1\u4e86\u3002 \u8fd9\u662f\u4e3a\u4ec0\u4e48\u5462\uff1f \u539f\u6765\uff0c\u5f53\u8054\u5408\u7d22\u5f15\u91cc\u9762\u6709\u5b57\u6bb5\u4e3anull\u7684\u65f6\u5019\uff0c\u8054\u5408\u7d22\u5f15\u4f1a \u81ea\u52a8\u5931\u6548 \u3002 \u90a3\u8fd9\u4e2a\u771f\u7684\u662f \u975e\u5e38\u96be\u53d7 \uff0c\u53ef\u8c13\u662f\u4fee\u590d\u4e86\u4e00\u4e2abug\u53c8\u5bfc\u81f4\u4e86\u53e6\u4e00\u4e2abug\u3002 \ud83d\udcd2 \u89e3\u51b3\u65b9\u6848\u4e00 \u5176\u5b9e\u6211\u4eec\u53ef\u4ee5\u628a deleted_at \u8bbe\u7f6e\u4e3a\u548c\u4e3b\u952e\u4e00\u6837\u7684\u81ea\u589eid\uff0c\u6bcf\u5f53\u88ab\u5220\u9664\u7684\u65f6\u5019\u5c31+1\uff0c\u6062\u590d\u7684\u65f6\u5019\u4e5f+1\uff0c\u9ed8\u8ba4\u4e3a0\uff0c\u8fd9\u6837\u4e5f\u4e0d\u4f1a\u56e0\u4e3a\u9ed8\u8ba4\u4e3aNULL\u800c\u5f15\u53d1\u552f\u4e00\u7d22\u5f15\u5931\u6548\u3002 \ud83d\udcd2 \u89e3\u51b3\u65b9\u6848\u4e8c \u6211\u4eec\u53ef\u4ee5\u628a deleted_at \u8bbe\u7f6e\u4e3a\u65f6\u95f4\u6233\uff0c\u9ed8\u8ba4\u4e3a0\uff08\u4ee3\u8868\u672a\u5220\u9664\uff09\uff0c\u4e00\u822c\u6765\u8bf4\uff0c\u624b\u52a8\u64cd\u4f5c \u5220\u9664\u64cd\u4f5c \u65f6\u95f4\u6233\u80af\u5b9a\u6709\u7ec6\u5fae\u53d8\u5316\uff0c\u8fd9\u6837\u7d22\u5f15\u5c06\u4e0d\u4f1a\u751f\u6548\uff0c\u4e5f\u5c31\u662f\u4e0d\u4f1a\u5f71\u54cd\u5230\u4e4b\u524d\u7684\u6570\u636e\u3002 \u4f46\u4e5f\u6709\u4e00\u4e2a\u7f3a\u70b9: \u5982\u679c\u4e00\u4e2a\u6570\u636e\u88ab\u5220\u9664\u591a\u6b21\uff0c\u6570\u636e\u5e93\u5c06\u5b58\u5728 \u8bb8\u591a \u76f8\u540c\u7684\u88ab\u5220\u9664\u7684\u6570\u636e\uff0c\u5f53\u7136\u4e00\u822c\u4eba\u4e5f\u4e0d\u4f1a\u505a\u8fa3\u4e48\u65e0\u804a\u7684\u4e8b\u60c5\u3002 class Model (Base) : deleted_at = Column(BIGINT, nullable= False , default= 0 ) \u53ef\u4ee5\u770b\u5230deleted_at\u5982\u6b64\u5b9a\u4e49\uff0c\u5f53\u6709\u5220\u9664\u64cd\u4f5c\u7684\u65f6\u5019\uff0c\u6211\u4eec\u8bbe\u7f6edeleted_at = time.time()\u5373\u53ef\u3002 import time model.deleted_at = time.time() \u5927\u5bb6\u5982\u679c\u6709\u66f4\u5408\u9002\u7684\u65b9\u6848\uff0c\u4e5f\u6b22\u8fce \u4e00\u8d77\u63a2\u8ba8 ~\u611f\u6fc0\u4e0d\u5c3d\uff01~","title":"63.\u8f6f\u5220\u9664\u4e4b\u6b87"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2864%29%20%E7%94%A8Sqlalchemy%E5%A1%AB%E6%96%AD%E8%A8%80%E7%9A%84%E5%9D%91/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u8fd9\u662f\u4e00\u4e2a\u5b8c\u6574\u7684 \u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0\u7cfb\u5217\u6559\u7a0b \uff0c\u5e0c\u671b\u80fd\u548c\u5927\u5bb6\u4e00\u8d77\u5b66\u4e60\uff0c\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u5e73\u53f0\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u6d4b\u8bd5\u5f00\u53d1\u5751\u8d27 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \ud83d\udcd2 \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u8bb2\u4e86 \u8f6f\u5220\u9664 \uff0c\u4e00\u4e2a\u770b\u4f3c\u65e0\u5173\u7d27\u8981\u5374\u53c8\u5f88\u4e25\u8083\u7684\u95ee\u9898\u3002\u5982\u4eca\u6211\u4eec\u6765\u586b\u4e00\u4e0b \u4e4b\u524d\u7684\u5751 \u3002 \ud83d\udcd2 \u4e4b\u524d\u57cb\u7684\u5751 \u4e4b\u524d\u6211\u4eec\u5728\u7528\u4f8b\u8be6\u60c5\u9875\u9762\uff0c\u53ea\u662f\u8ba9\u7528\u6237\u53ef\u4ee5 \u6dfb\u52a0\u65ad\u8a00 \uff0c\u4f46\u662f\u6ca1\u6709\u652f\u6301\u7f16\u8f91\u548c\u5220\u9664\u7684\u529f\u80fd\uff0c\u751a\u81f3\u8fde\u5c55\u793a\u7684\u9875\u9762 \u90fd\u5187 \uff0c\u90a3\u4eca\u5929\u6211\u4eec\u5c31\u6765 \u597d\u597d\u586b\u5751 : \u5b8c\u6210\u8fd9\u5757\u7684\u7f16\u8f91\u548c\u5220\u9664\u529f\u80fd\u3002 \ud83c\udf66 \u8001\u89c4\u77e9 \u505a\u5b8c\u4e4b\u524d\uff0c\u770b\u4e0b\u5f53\u524d\u7684\u6548\u679c\u56fe: \u63d0\u4f9b\u4e86\u4e00\u4e2a\u5c0f\u5c0f\u7684\u9875\u9762 \u5176\u5b9e\u5c31\u662f\u5728 \u65ad\u8a00 tab\u4e0b\u9762\u5199\u4e86\u4e2acurd\u7684 \u5c0f\u9875\u9762 \u3002 \ud83d\udcd2 \u540e\u7aef\u7684\u6539\u52a8 \u4e4b\u6240\u4ee5\u628a\u8fd9\u4e00\u8282\u5355\u72ec\u62c9\u51fa\u6765\u8bb2\uff0c\u662f\u56e0\u4e3a\u4ee5\u5f80\u6211\u4eec\u90fd\u662f \u65b0\u589e/\u7f16\u8f91\u6570\u636e \u4ee5\u540e\uff0c\u53bb\u8bf7\u6c42\u4e00\u6b21list\u63a5\u53e3\uff0c\u7b49\u4e8e\u662f\u8bf7\u6c42\u4e862\u6b21\u3002 \u8fd9\u6b21\u6211\u4eec\u6362\u4e2a\u65b9\u5411\uff0c\u8bf7\u6c42\u540e\u76f4\u63a5\u62ff\u5230\u6700\u65b0\u7684\u90a3\u6761\u6570\u636e\uff0c\u7136\u540e\u6574\u5408\u5230\u73b0\u6709\u7684table\u4e4b\u4e2d\u3002 \u5176\u5b9e\u4e4b\u6240\u4ee5\u8fd9\u4e48\u505a\uff0c\u662f\u56e0\u4e3a\u6211\u8fd9\u4e2a\u9875\u9762\u5f88\u5927\uff0c\u91cc\u9762\u6709case\u7684\u5f88\u591a\u4fe1\u606f\uff0c\u6d89\u53ca\u5230\u591a\u4e2a\u8868\uff0c \u5c40\u90e8\u6570\u636e \u7684\u5237\u65b0\u6211\u53c8\u4e0d\u60f3\u5355\u72ec\u5305\u88c5\u4e00\u4e2a\u63a5\u53e3\u3002 \u8ba9\u6211\u4eec\u770b\u770b\u600e\u4e48\u505a\u5427\uff01 \ud83c\udf66 \u4e86\u89e3SqlAlchemy\u7684\u673a\u5236 SqlAchemy\u662f\u4e00\u6b3e\u5927\u5bb6\u6bd4\u8f83\u719f\u6089\u7684 orm \u5e93\uff0c\u5728\u6211\u7684\u4f7f\u7528\u8fc7\u7a0b\u4e2d\u53d1\u73b0\u4e00\u4e2a\u7279\u70b9: \u6bd4\u5982\u6211\u65b0\u5efa\u4e86\u4e00\u4e2a model \uff0c\u4f7f\u7528session.add\u66f4\u65b0\u5230db\u91cc\u9762\uff0c\u5982\u679c\u662f\u540c\u6b65session\u5219\u8fd8\u9700\u8981commit\u64cd\u4f5c\u3002 \u4f46\u6211\u4eec\u5982\u4eca\u7684\u9700\u6c42\u662f\uff0cinsert\u5230\u6570\u636e\u5e93\u4e4b\u540e\u62ff\u5230\u6700\u65b0\u7684\u6570\u636e\u3002\u5176\u5b9esqlalchemy\u4f1a\u9ed8\u8ba4\u628a\u4e4b\u524d\u63d2\u5165\u8fc7\u7684\u6570\u636e\u9500\u6bc1\u6389\uff0c\u4e5f\u53ef\u80fd\u4e0d\u662f\u9500\u6bc1\uff0c\u53cd\u6b63\u5c31\u662fsession\u7ed3\u675f\u4e86\u4e4b\u540e\uff0c\u6570\u636e\u5c06 \u4e0d\u590d\u5b58\u5728 \u3002 \u6240\u4ee5\u6211\u4eec\u767e\u5ea6\u67e5\u4e86\u4e00\u4e0b\uff0c\u6709\u8fd9\u6837\u4e00\u4e2a\u65b9\u6cd5\uff0c\u53ef\u4ee5\u4fdd\u7559\u539f\u5148\u7684\u6570\u636e: session.expunge(data) \ud83c\udf66 \u7f16\u5199\u65b0\u589e\u65ad\u8a00\u7684\u63a5\u53e3 \u65b0\u589e\u7684\u63a5\u53e3\u548c\u4e4b\u524d\u7684\u533a\u522b\u5c31\u5728\u8fd9\u4e86 \u9996\u5148\u7528session.flush()\u7b49\u5f85\u6570\u636e\u66f4\u65b0\uff0crefresh\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u62ff\u5230insert\u4e4b\u540e\u7684id\u3002 \u6700\u540e\u6211\u4eec\u7528expunge\u65b9\u6cd5\uff0c\u4fdd\u7559\u8fd9\u4e2a\u5bf9\u8c61\uff0c\u518d\u8fd4\u56de\u5373\u53ef\u3002 \ud83c\udf66 \u7f16\u5199\u7f16\u8f91\u65ad\u8a00\u7684\u63a5\u53e3 \u548c\u65b0\u589e\u7c7b\u4f3c \u7f16\u8f91\u548c\u65b0\u589e\u7c7b\u4f3c\uff0c\u4f46\u56e0\u4e3a\u6211\u4eec\u4e0d\u9700\u8981 \u83b7\u53d6\u4e3b\u952eid \uff0c\u56e0\u4e3a\u54b1\u4eec\u672c\u6765\u5c31\u6709\uff0c\u6240\u4ee5\u53ea\u9700\u8981expunge\u5373\u53ef\u3002 \ud83c\udf66 \u7f16\u5199\u5220\u9664\u65ad\u8a00\u7684\u63a5\u53e3 \u5220\u9664\u4e5f\u662f\u4e00\u79cdupdate \u56e0\u4e3a\u8f6f\u5220\u9664\u7684\u7f18\u6545\uff0c\u6211\u4eec\u5b9e\u9645\u4e0a\u6267\u884c\u7684\u4e5f\u662f update \u64cd\u4f5c\u3002 \u8fd9\u6837\u65ad\u8a00\u7684\u7f16\u8f91/\u5220\u9664\u5c31\u5b8c\u6210\u4e86 \ud83d\udcd2 \u65b0\u589e\u6267\u884c\u7528\u4f8b\u7684\u529f\u80fd \u5176\u5b9e\u5f88\u7b80\u5355\uff0c\u8c03\u7528\u4e00\u4e0b\u4e4b\u524d\u7684 \u63a5\u53e3 \u5373\u53ef\u3002\u770b\u770b\u56fe\u5427~ \u6267\u884c\u4e0b\u770b\u770b\u6548\u679c \u81f3\u6b64\uff0c\u4e00\u4e2acase\u7684\u767e\u5206\u4e4b80\u7684\u6267\u884c\u6d41\u7a0b\u5c31\u5df2\u7ecf\u5b8c\u6bd5\u4e86\u3002\u63a5\u4e0b\u6765\u8fd8\u662f\u6709 \u5f88\u591a\u4e8b\u60c5 \u9700\u8981\u505a\u7684: \u5b9a\u65f6\u4efb\u52a1\u6267\u884ccase \u7528\u4f8b\u53d8\u91cf/\u5168\u5c40\u53d8\u91cf\u76ee\u524d\u5e94\u8be5\u8fd8\u6ca1\u5e94\u7528\u5230\u65ad\u8a00\u4e4b\u4e2d \u65ad\u8a00\u8fd8\u4e0d\u652f\u6301JSON\u5bf9\u6bd4\u7b49\u7b49 \u7528\u4f8b\u8bc4\u5206\u7cfb\u7edf \u7528\u6237\u64cd\u4f5c\u8bb0\u5f55 \u5de5\u4f5c\u53f0\u672a\u5b8c\u6210 \u7528\u6237\u8d44\u6599\u4fee\u6539 \u7528\u6237\u7ba1\u7406\u529f\u80fd \u4e03\u725b\u4e91/\u963f\u91cc\u4e91oss\u63a5\u5165 \u5176\u4ed6\u524d\u7f6e\u6761\u4ef6\u7c7b\u578b \u540e\u7f6e\u6761\u4ef6 ...... \u5c31\u4ee5\u4e0a\u5df2\u7ecf\u6709\u5f88\u591a\u5185\u5bb9\u4e86\uff0c\u66f4\u522b\u8bf4\u672a\u6765\u7684: \u6570\u636e\u5de5\u5382 \u7cbe\u51c6\u6d4b\u8bd5\u7b49\u7b49 \u4e0d\u8fc7\u8bdd\u8bf4\u56de\u6765\uff0c\u8fd9\u4e2a\u5e73\u53f0\u5e0c\u671b\u7684\u5c31\u662f \u771f\u6b63\u4ece0\u52301\u505a\u6210\u4e00\u4e2a\u5b8c\u5168\u4f53\u7684\u5e73\u53f0 \uff0c\u6162\u6162\u586b\u5751\u5427~","title":"64.\u7528Sqlalchemy\u586b\u65ad\u8a00\u7684\u5751"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2865%29%20%E5%BC%82%E6%AD%A5%E6%96%B9%E6%B3%95%E8%A3%85%E9%A5%B0%E5%99%A8/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u5b8c\u6574\u7684 \u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0\u7cfb\u5217\u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u80fd\u591f\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u6d4b\u8bd5\u5f00\u53d1\u5751\u8d27 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \ud83d\udcd2 \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec \u5b8c\u5584 \u4e86\u4e00\u6574\u5957\u6d4b\u8bd5\u7528\u4f8b\u6267\u884c\u7684 \u6d41\u7a0b \uff0c\u8fd9\u4e00\u8282\u6211\u4eec\u6765\u8bb2\u8bb2async\u65b9\u6cd5\u7684 \u88c5\u9970\u5668 \u3002 \u5728\u6b64\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u6765\u770b\u4e0b\u7528\u4e8e \u5f02\u6b65\u65b9\u6cd5 \u7684\u88c5\u9970\u5668\u3002 \ud83d\udcd2 \u65e5\u5fd7\u88c5\u9970\u5668 \u8fd8\u8bb0\u5f97\u6211\u4eec\u4e4b\u524d\u7f16\u5199\u8fc7\u7684 \u65e5\u5fd7\u88c5\u9970\u5668 \u5417\uff1f\u4e0d\u8bb0\u5f97\u7684\u8bdd\u4e5f\u6ca1\u5173\u7cfb\uff0c\u54b1\u4eec \u73b0\u5364 \u4e00\u4e2a\u3002 import functools def log (func) : @functools.wraps(func) def wrapper (*args, **kwargs) : print( \"\u6b63\u5728\u6267\u884c\u65b9\u6cd5: \" , func.__name__) print( \"\u53c2\u6570: \" , *args, *[ f\" {k} = {v} \" for k, v in kwargs.items()]) result = func(*args, **kwargs) print( \"\u6267\u884c\u7ed3\u679c: \" , result) return result return wrapper @log def print_user (name, age, height= 180 ) : return f\"hello, {name} . Age: {age} , Height: {height} \" if __name__ == \"__main__\" : print_user( \"klose\" , 43 , height= 182 ) \u6211\u4eec\u7f16\u5199\u4e86\u4e00\u4e2a print_user (\u6253\u5370\u7528\u6237\u4fe1\u606f)\u7684\u65b9\u6cd5\uff0c\u5e76\u7ed9\u4ed6\u52a0\u4e0a\u4e86log\u88c5\u9970\u5668\uff0c\u8fd9\u6837\u4e00\u65e6\u8fd9\u4e2a\u65b9\u6cd5 \u6267\u884c \u4e86\uff0c\u6211\u4eec\u5c31\u4f1a\u8f93\u51fa\u8fd9\u4e9b\u6570\u636e\u5230\u65e5\u5fd7\u91cc\u9762\u3002 \u56e0\u4e3a\u8fd9\u91cc\u6211\u6ca1\u6709\u73b0\u6210\u7684\u65e5\u5fd7\u5305\uff0c\u6240\u4ee5\u6211\u7528\u4e86print\u4ee3\u66ff\u3002\u8f93\u5165\u5230\u65e5\u5fd7\u9700\u8981\u8bb0\u5f55\u4ec0\u4e48\u5185\u5bb9\u5462\uff1f \u8c03\u7528\u4e86\u4ec0\u4e48\u65b9\u6cd5 \u65b9\u6cd5\u7684\u53c2\u6570\u662f\u4ec0\u4e48 \u65b9\u6cd5\u7684\u8fd4\u56de\u503c\u662f\u4ec0\u4e48 \u6211\u4eec\u6765\u770b\u770b\u8f93\u51fa: \u8fd9\u4e2a\u88c5\u9970\u5668\u7684\u76ee\u7684\u662f\u5f53\u6211\u4eec\u53d1\u73b0\u8fd9\u4e2a\u65b9\u6cd5\u62a5\u9519\u4e86\uff0c\u80fd\u591f\u56de\u6eaf\u5230\u5f53\u65f6\u7684\u53c2\u6570\u4fe1\u606f\uff0c\u4ee5\u4fbf\u4e8e\u6392\u67e5\u95ee\u9898\uff0c\u5f53\u7136\u8fd9\u8fb9\u4e0d\u4f1a\u6709\u62a5\u9519\uff0c\u56e0\u4e3a\u573a\u666f\u6bd4\u8f83\u7b80\u5355 \u5c31\u662f\u8fd9\u4e48\u4e2a\u573a\u666f\uff0c\u666e\u901a\u7684 \u88c5\u9970\u5668 \u5b9e\u73b0\u5982\u4e0a\u3002\u63a5\u7740\u6211\u4eec\u6765 \u601d\u8003\u4e00\u4e2a\u95ee\u9898 \uff0c\u5982\u679c\u6211\u4eec\u7684\u65b9\u6cd5\u662f \u5f02\u6b65 \u7684\uff0c\u5728\u88c5\u9970\u5668\u4e0d\u53d8\u7684\u60c5\u51b5\u4e0b\uff0c\u4f1a\u662f\u4ec0\u4e48\u8f93\u51fa\u5462\uff1f \u6c42\u8c46\u9ebb\u888b\u3002 \u6211\u4eec\u6765\u8fdb\u884c\u4e0b\u7b80\u5355\u7684\u6539\u9020\u3002 \ud83d\udcd2 async\u65b9\u6cd5\u7684\u88c5\u9970\u5668 @log async def print_user (name, age, height= 180 ) : return f\"hello, {name} . Age: {age} , Height: {height} \" \u53ea\u9700\u8981\u628aprint_user\u65b9\u6cd5\u6539\u4e3a async \uff0c\u7136\u540e\u7528asyncio.run\u6267\u884c print_user \u65b9\u6cd5\u5373\u53ef\u3002\u6765\u770b\u4e0b\u8f93\u51fa: @log async def print_user (name, age, height= 180 ) : return f\"hello, {name} . Age: {age} , Height: {height} \" if __name__ == \"__main__\" : asyncio.run(print_user( \"klose\" , 43 , height= 182 )) \u53ef\u4ee5\u770b\u5230\uff0c \u6267\u884c\u7ed3\u679c \u53d8\u6210\u4e86 coroutine \u4e86\uff0c\u4e5f\u5c31\u662f\u8bf4\u62ff\u4e0d\u5230 \u8fd4\u56de\u503c \u4e86\u3002 \u90a3\u4e48\u63a5\u4e0b\u6765\u5c31\u8fdb\u5165\u6211\u4eec\u7684 \u6539\u9020\u9636\u6bb5 \uff0c\u8ba9 \u88c5\u9970\u5668 \u4e5f\u652f\u6301\u5f02\u6b65\u65b9\u6cd5\u3002 \ud83d\udcd2 \u67e5\u8be2\u8d44\u6599 \u901a\u8fc7google\uff0c\u6211\u4eec\u53d1\u73b0asyncio\u6709\u8fd9\u6837\u4e00\u4e2a\u65b9\u6cd5: iscoroutinefunction \u770b\u540d\u5b57\u5c31\u77e5\u9053\uff0c\u662f\u5224\u65ad\u4e00\u4e2a function \u662f\u4e0d\u662f coroutine \uff0c\u5982\u679c\u8fd9\u62db\u6709\u7528\u7684\u8bdd\uff0c\u90a3\u8bf4\u660e\u6211\u4eec\u7684\u95ee\u9898\u80fd\u591f\u89e3\u51b3\u4e86\u3002 def log (func) : if asyncio.iscoroutinefunction(func): @functools.wraps(func) async def wrapper (*args, **kwargs) : print( \"\u6b63\u5728\u6267\u884c\u65b9\u6cd5: \" , func.__name__) print( \"\u53c2\u6570: \" , *args, *[ f\" {k} = {v} \" for k, v in kwargs.items()]) result = await func(*args, **kwargs) print( \"\u6267\u884c\u7ed3\u679c: \" , result) return result else : @functools.wraps(func) def wrapper (*args, **kwargs) : print( \"\u6b63\u5728\u6267\u884c\u65b9\u6cd5: \" , func.__name__) print( \"\u53c2\u6570: \" , *args, *[ f\" {k} = {v} \" for k, v in kwargs.items()]) result = func(*args, **kwargs) print( \"\u6267\u884c\u7ed3\u679c: \" , result) return result return wrapper \u6211\u4eec\u628a\u4ee3\u7801\u6539\u6210\u8fd9\u4e2a\u6837\u5b50: \u53ef\u4ee5\u770b\u5230\uff0c\u88c5\u9970\u5668\u53c8\u548c\u4e0a\u4e00\u6b21\u8bb2\u7684\u4e00\u6837\uff0c\u8fdb\u5165\u4e86\u4e00\u4e2a\u5206\u6c34\u5cad\uff0c\u5f53iscoroutine\u6210\u7acb\u7684\u65f6\u5019\uff0c\u5f62\u6210\u4e86\u4e00\u4e2a async \u7684\u88c5\u9970\u5668\uff0c\u53cd\u4e4b\u5219\u662f\u666e\u901a\u7684\u88c5\u9970\u5668\u3002 \ud83c\udf66 \u8bd5\u8bd5\u6548\u679c\u5148 \u6548\u679c\u826f\u597d \u518d\u8bd5\u8bd5\u628alog\u653e\u5230\u666e\u901a\u65b9\u6cd5\u4e0a\u9762: \u6ce8\u610f\u770b\u65b9\u6cd5\u540d, \u6267\u884c\u7684\u786e\u5b9e\u662fprint_user2\u65b9\u6cd5 \ud83d\udcd2 \u4ee3\u7801\u5197\u4f59 \u7ec6\u5fc3\u7684\u670b\u53cb\u53ef\u80fd\u53d1\u73b0\u4e86\uff0c3\u4e2aprint\u7684\u5185\u5bb9\u90fd\u662f \u5f88\u91cd\u590d \u7684\uff0c\u4f46\u662fide\u5e76\u6ca1\u6709\u63d0\u793a\u4f60\uff0c\u4f46\u5176\u5b9e\u8fd9\u51e0\u5757\u5185\u5bb9\u662f\u5b8c\u5168\u53ef\u4ee5\u5c01\u88c5\u8d77\u6765\u7684\u3002 \u8fd9\u5927\u6982\u5c31\u662f\u987a\u624b\u4e3a\u4e4b\uff0c\u6162\u6162\u5c31\u5f62\u6210\u4e86 \u5c4e\u5c71\u4ee3\u7801 \u5427~ \u6240\u4ee5\u6838\u5fc3\u65b9\u6cd5\u662f asyncio.iscoroutinefunction , \u4f60\u5b66\u4f1a\u4e86\u5417\uff1f \u4eca\u5929\u7684\u5185\u5bb9\u5c31\u4ecb\u7ecd\u5230\u8fd9\u91cc\u4e86\uff0c\u5927\u5bb6\u6ca1\u70b9\u5173\u6ce8\u7684 \u70b9\u4e2a\u5173\u6ce8 \uff0c\u70b9\u4e86\u5173\u6ce8\u7684 \u70b9\u4e2a\u8d5e \uff0c\u70b9\u4e86\u8d5e\u7684 \u70b9\u4e2a\u5728\u770b \uff0c\u70b9\u4e86\u5728\u770b\u7684 \u70b9\u4e2a\u8d5e\u8d4f \uff0c\u70b9\u4e86\u8d5e\u8d4f\u7684 \u70b9\u4e2a\u9000\u51fa \u3002","title":"65.\u5f02\u6b65\u65b9\u6cd5\u88c5\u9970\u5668"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2866%29%20%E6%95%B0%E6%8D%AE%E9%A9%B1%E5%8A%A8%E4%B9%8B%E5%9F%BA%E7%A1%80Model/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u5b8c\u6574\u7684 \u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0\u7cfb\u5217\u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u80fd\u591f\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u6d4b\u8bd5\u5f00\u53d1\u5751\u8d27 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \ud83d\udcd2 \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u8bb2\u4e86\u9002\u914d \u5f02\u6b65\u65b9\u6cd5 \u7684\u88c5\u9970\u5668\uff0c\u8fd9\u51e0\u8282\u6211\u4eec\u7ee7\u7eed\u6765\u6b7b\u78d5 \u7528\u4f8b\u903b\u8f91 \u90e8\u5206\u3002\u4e4b\u524d\u5df2\u7ecf\u5b8c\u5584\u4e86\u6570\u636e\u6784\u9020\u5668\u76f8\u5173\u7684\u529f\u80fd\uff0c\u4e0b\u9762\u6211\u4eec\u6765\u8fdb\u884c\u4e00\u7cfb\u5217\u7684\u6539\u9020\u6765\u652f\u6301 \u6570\u636e\u9a71\u52a8 \u3002 \u4eca\u5929\u5c31\u8bb2\u4e00\u4e0b\u57fa\u7840Model\u3002 \ud83d\udcd2 \u672c\u8282\u6982\u8ff0 \u53cb\u60c5\u63d0\u9192: \u6700\u8fd1\u51e0\u8282\u4f1a\u6d89\u53ca\u5230\u5927\u91cf\u6539\u52a8\uff0c\u53ef\u4ee5\u76f4\u63a5 \u62c9\u53d6\u4ee3\u7801 \u67e5\u770b\u5bf9\u5e94\u7684\u6539\u52a8\u3002 Github\u5730\u5740: https://github.com/wuranxu/pity \u5927\u6982\u7684\u6539\u52a8\u90e8\u5206\u662f\uff0c\u7528\u4f8b\u7684\u53c2\u6570\u4e0d\u518d\u662f\u5355\u4e00\u7684\uff0c\u5bf9\u4e8e \u540c\u4e00\u4e2a\u573a\u666f \u8fdb\u884c\u591a\u7ec4\u6570\u636e\u7684\u6d4b\u8bd5\u3002 \ud83d\udcd2 \u6784\u601d \u6211\u4eec\u7684case\u76ee\u524d\u90fd\u662f\u5199\u6b7b\u7684\u6570\u636e\uff0c\u4ee5\u6211\u4eec\u7684 \u67e5\u8be2\u5b58\u5728\u7528\u6237 \u63a5\u53e3\u4e3a\u4f8b\u5b50\uff0c\u6211\u4eec\u662f\u7f16\u5199\u4e86\u4e00\u4e2acase\uff0c\u7136\u540e\u5c06name\u5199\u5b9a\u5728url\u91cc\u9762: \u5982\u56fe\u6240\u793a \u5176\u5b9e\u8fd9\u4e2aname\u53ef\u4ee5\u6709\u5f88\u591a\u7ec4 \u6570\u636e \uff0c\u5982\u679c\u53ea\u662fname\u5728\u53d1\u751f\u53d8\u5316\uff0c\u5f97\u5199\u5f88\u591a\u6761 \u51e0\u4e4e\u4e00\u6837 \u7684case\uff0c\u90a3\u53ef\u8c13\u662f\u7ef5\u7f8a\u653e\u4e86\u5c71\u7f8a\u5c41\u3002 \u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u628a\u6570\u636e \u62bd\u79bb \u51fa\u6765\uff0c\u6709\u7528\u8fc7ddt\u7684\u53ef\u80fd\u90fd\u77e5\u9053\uff0cunittest+ddt\u5c31\u53ef\u4ee5\u5b9e\u73b0 \u6570\u636e\u9a71\u52a8 \uff0c\u5e76\u4e14\u5b83\u4f1a\u4e3a\u4f60\u751f\u6210N\u591a\u4e2a\u7528\u4f8b\u3002 \u6240\u4ee5\u6211\u4eec\u7684\u76ee\u6807\u5c31\u662f\u8981\u548c\u5b83\u8fbe\u6210\u4e00\u6837\u7684\u6548\u679c\u3002 \u8bf4\u4e86\u90a3\u4e48\u591a\u5e9f\u8bdd\uff0c\u6211\u5c31\u662f\u4e0d\u8bf4\u600e\u4e48\u505a\uff01\uff01\uff01\u5176\u5b9e\uff0c\u6211\u4eec\u7ef4\u62a4\u4e00\u4e2a \u6570\u636e\u8868 \uff0c\u91cc\u9762\u4e13\u95e8\u5b58\u653e \u6d4b\u8bd5\u6570\u636e \uff0c\u7136\u540e\u548ccase\u901a\u8fc7case_id\u8fdb\u884c\u5173\u8054\uff0c\u5728\u7528\u4f8b\u6267\u884c\u7684\u65f6\u5019\u53d6\u51facase\u7684\u6570\u636e\u4e0d\u5c31\u597d\u4e86\u5417\uff1f \u662f\u7684\uff0c\u5927\u6982\u7684\u6548\u679c\u5c31\u662f\u8fd9\u6837\uff0c\u4f46\u662f\u5b9e\u73b0\u8d77\u6765\u8fd8\u6709\u8bb8\u591a\u963b\u788d\uff0c\u540e\u9762\u6211\u4eec \u4e00\u4e00\u9053\u6765 \u3002 \ud83d\udcd2 \u8bbe\u8ba1\u6570\u636e\u8868 \u5982\u679c\u6309\u7167\u4ee5\u5f80\u7684\u5c3f\u6027\uff0c\u6211\u80af\u5b9a\u4f1a\u8bbe\u8ba1\u8fd9\u6837\u7684\u8868: # \u6ce8\u610f\u8fd9\u91cc\u90fd\u662f\u4f2a\u4ee3\u7801 class TestCaseData (BaseModel) : id = Column(INT) created_at = Column(DATETIME) updated_at = Column(DATETIME) deleted_at = Column(DATETIME) create_user = Column(INT) update_user = Column(INT) \u8fd9\u4e9b\u90fd\u662f\u9664\u4e86\u8868\u6838\u5fc3\u5b57\u6bb5\u4ee5\u5916\u7684\u4e0d\u5f97\u4e0d\u6dfb\u52a0\u7684\u57fa\u7840\u5b57\u6bb5\uff0c\u90a3\u6bcf\u6b21\u90fd\u5199\u8fd9\u4e48\u591a\u5b57\u6bb5\uff0c\u8bf4\u5b9e\u8bdd\u6211 \u6709\u70b9\u70e6 \u4e86\u3002 \u4f55\u4e0d\u5b9a\u4e49\u4e00\u4e2a\u57fa\u7840\u7684model\uff0c\u7136\u540e\u4e1a\u52a1model\u53ea\u4fdd\u7559\u6700\u6838\u5fc3\u7684\u5b57\u6bb5\u5462\uff1f\u6709\u4e86\u8fd9\u4e2a\u60f3\u6cd5\u4ee5\u540e\uff0c\u6211\u5c31 \u505c\u4e0d\u4e0b\u6765 \u4e86\uff0c\u4e8e\u662f\u6211\u82b1\u4e86\u4e9b\u65f6\u95f4\u5b8c\u6210\u8fd9\u4e2a\u4e8b\u60c5\u3002\u4e0b\u9762\u5c31\u662f \u5b9e\u8df5\u8fc7\u7a0b \u3002 \ud83d\udcd2 \u8bbe\u8ba1\u57fa\u7840Model \u6211\u4eec\u77e5\u9053 SqlAlchemy \u662f\u62e5\u6709BaseModel\u7c7b\u7684\uff0c\u6240\u6709\u7684 \u7c7b\u6a21\u578b \u90fd\u5f97\u7ee7\u627f\u4e4b\u3002 \u6240\u4ee5\u6211\u4eec\u7684\u57fa\u7840Model\u4e5f\u5f97\u7ee7\u627f\u5b83\u3002\u5728models\u76ee\u5f55\u4e0b\u5efa\u7acb\u6587\u4ef6 basic.py from datetime import datetime from sqlalchemy import INT, DATETIME, Column, BIGINT from app.models import Base class PityBase (Base) : id = Column(INT, primary_key= True ) created_at = Column(DATETIME, nullable= False ) updated_at = Column(DATETIME, nullable= False ) deleted_at = Column(BIGINT, nullable= False , default= 0 ) create_user = Column(INT, nullable= False ) update_user = Column(INT, nullable= False ) def __init__ (self, user, id= 0 ) : self.created_at = datetime.now() self.updated_at = datetime.now() self.create_user = user self.update_user = user self.id = id \u6ce8\u610f\u56e0\u4e3a \u8f6f\u5220\u9664 \u7684\u539f\u56e0\uff0c\u6211\u4eec\u628adeleted_at\u6539\u6210\u4e86BIGINT\uff0c\u800c\u975edatetime\u5bf9\u8c61\uff0c\u5982\u679c\u6709\u7591\u95ee\u53ef\u770b\u6211\u4e4b\u524d\u7684 \u8f6f\u5220\u9664\u76f8\u5173 \u6587\u7ae0\u3002 \u8fd9\u6837\u6211\u4eec\u5c31\u5b9a\u4e49\u597d\u4e86 PityBase \u7c7b\u3002\u63a5\u7740\u6211\u4eec\u6765\u8bf4\u4e0b\u6570\u636e\u8868\u7684\u8bbe\u8ba1\uff0c\u5176\u5b9e\u6211\u4eec\u7684\u6570\u636e\u8868\uff0c\u4f60\u662f\u4e0d\u786e\u5b9a\u7528\u6237\u9700\u8981 \u591a\u5c11\u5b57\u6bb5 \u7684\u3002\u672c\u8eab\u6211\u8ba4\u4e3a\u8fd9\u6837\u7684\u6570\u636e\u5f88\u9002\u5408\u653e\u5230mongo\u91cc\u9762\uff0c\u5b83\u652f\u6301\u4e0d\u540c\u7c7b\u578b\u7684\u6570\u636e\u653e\u5230\u4e00\u5f20\u8868\uff0c\u4e5f\u53ef\u4ee5\u4e0d\u5b9a\u4e49\u5b57\u6bb5\u3002 \u4f46\u65e2\u7136\u6211\u4eec\u7528\u7684\u662f Mysql \uff0c\u90a3\u6211\u4eec\u53ea\u80fd\u628a\u6211\u4eec\u7684\u6570\u636e\u5b57\u6bb5\u5199\u4e3a JSON\u6570\u636e \uff08\u5b57\u7b26\u4e32\uff09\uff0c\u901a\u8fc7\u5e8f\u5217\u5316/\u53cd\u5e8f\u5217\u5316\u7684\u65b9\u5f0f\u5b8c\u6210\u6211\u4eec\u7684\u9700\u6c42\u3002\uff08\u5c3d\u7ba1\u5e8f\u5217\u5316/\u53cd\u5e8f\u5217\u5f71\u54cd\u6027\u80fd\uff09 \ud83c\udf66 \u6d4b\u8bd5\u6570\u636e\u8868 \"\"\" \u6d4b\u8bd5\u6570\u636e\u8868, \u7528\u6765\u5b58\u50a8\u5404\u4e2a\u73af\u5883\u4e0b\u7684\u6d4b\u8bd5\u6570\u636e\uff0c\u7528\u4e8e\u6570\u636e\u9a71\u52a8 \"\"\" __author__ = \"miluo\" from sqlalchemy import Column, INT, String, UniqueConstraint, TEXT from app.models.basic import PityBase class PityTestcaseData (PityBase) : env = Column(INT, nullable= False ) case_id = Column(INT, nullable= False ) name = Column(String( 32 ), nullable= False ) json_data = Column(TEXT, nullable= False ) __table_args__ = ( UniqueConstraint( 'env' , 'case_id' , 'name' , 'deleted_at' ), ) __tablename__ = \"pity_testcase_data\" def __init__ (self, env, case_id, name, json_data, user, id= 0 ) : super().__init__(user, id) self.env = env self.case_id = case_id self.name = name self.json_data = json_data \u6211\u4eec\u5b58\u653e\u4e86env\uff0ccase_id\uff0cname\u548cjson_data\u8fd94\u4e2a\u5b57\u6bb5\uff0c\u5e76\u8bbe\u7f6e\u4e86 \u8054\u5408\u552f\u4e00\u7d22\u5f15 \uff0c\u9632\u6b62\u6570\u636e\u91cd\u590d\u3002 \u53ef\u80fd\u6709\u7684\u4eba\u4f1a\u597d\u5947\uff0c\u8fd9\u4e2aname\u662f\u5565\uff0c name \u5176\u5b9e\u662f\u6570\u636e\u7684\u4e00\u4e2a\u6807\u8bc6\uff0c\u4e5f\u5c31\u662f\u4e2a\u522b\u540d\u800c\u5df2\uff0c\u7528\u4e8e \u6807\u8bc6 \u4f60\u7684\u8fd9\u7ec4\u6570\u636e\u3002 \u91cc\u9762\u7684__init__\u65b9\u6cd5\uff0c\u8c03\u7528\u4e86\u7236\u7c7b\u7684__init__()\uff0c\u5b8c\u6210\u4e86\u6240\u6709\u5b57\u6bb5\u7684 \u8d4b\u503c \u5de5\u4f5c\u3002 \ud83d\udcd2 \u8fd9\u5c31\u5b8c\u4e8b\u4e86\u5417\uff1f \u5176\u5b9e\u6ca1\u6709\u90a3\u4e48\u7b80\u5355\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u5bf9PityModel(\u57fa\u7840Model)\u8fdb\u884c\u4e00\u4e2a\u6539\u52a8\uff0c\u6211\u4eec\u5f97\u52a0\u4e00\u4e2a__abstract__\u53d8\u91cf\uff0c\u5e76\u8bbe\u7f6e\u5b83\u4e3aTrue\uff0c\u8fd9\u6837\u5c31\u80fd \u6ee1\u8db3\u6211\u4eec\u7684\u8981\u6c42 \u4e86\u3002\u7ec6\u5fc3\u7684\u670b\u53cb\u53ef\u4ee5\u53bb\u6389__abstract__\u53d8\u91cf\u8bd5\u8bd5\uff0c\u4f60\u7684PityModel\u4f1a\u88ab\u8ba4\u4e3a\u662f\u4e00\u4e2a\u65b0\u7684\u6570\u636e\u8868\uff0c\u968f\u4e4b\u4f1a \u5f15\u6765\u62a5\u9519 \u3002 \u5927\u5bb6\u611f\u5174\u8da3\u53ef\u4ee5\u8bd5\u8bd5 \u4eca\u5929\u7684\u5185\u5bb9\u5c31\u5148\u8bf4\u5230\u8fd9\u91cc\uff0c\u4e0b\u4e00\u8282\u6211\u4eec\u8bb2TestcaseData\u7684\u76f8\u5173\u64cd\u4f5c\u4ee5\u53ca\u5176\u4ed6\u53d8\u5316\u3002\u4ee5\u540e\u6211\u4eec\u7684\u6570\u636e\u8868\uff0c\u5982\u6709\u65b0\u589e\uff0c\u90fd\u4f1a\u96c6\u6210\u81eaPityModel\u7c7b\uff0c\u4f1a \u7701\u4e0d\u5c11\u4e8b\u513f \u3002","title":"66.\u6570\u636e\u9a71\u52a8\u4e4b\u57fa\u7840Model"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2867%29%20%E7%8E%A9%E8%BD%AC%E6%95%B0%E6%8D%AE%E9%A9%B1%E5%8A%A8/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u5b8c\u6574\u7684 \u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0\u7cfb\u5217\u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u80fd\u591f\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u6d4b\u8bd5\u5f00\u53d1\u5751\u8d27 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \ud83c\udf66 \u4e0a\u8282\u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u7a0d\u5fae\u64a9\u4e86\u4e00\u4e0b \u6570\u636e\u9a71\u52a8 \uff0c\u5c31\u9a6c\u4e0a\u53bb\u5199\u57fa\u7840Model\u4e86\uff0c\u8fd9\u8282\u6211\u4eec\u5c31\u6765\u4ed4\u7ec6\u63a2\u8ba8\u4e0b\u6570\u636e\u9a71\u52a8\u7684 \u5b9e\u73b0\u60f3\u6cd5 \u3002 \u5148\u7b80\u5355\u4ecb\u7ecd\u4e00\u4e0b \u6570\u636e\u9a71\u52a8 \u7684\u6982\u5ff5\uff0c\u8fd9\u91cc\u7b14\u8005\u627e\u5230\u4e86\u7ef4\u57fa\u767e\u79d1\u5173\u4e8e\u6570\u636e\u9a71\u52a8\u7684\u5b9a\u4e49\u3002 \u7b80\u5355\u9610\u8ff0\u4e00\u4e0b\u5c31\u662f\u4e09\u4e2a\u7279\u70b9: \u5c06\u53d8\u5316\u7684\u4e1c\u897f\u548c\u6d4b\u8bd5\u903b\u8f91\u5206\u79bb \u4ec0\u4e48\u610f\u601d\u5462\uff1f\u6211\u4eec\u6bd4\u5982\u5728\u6d4b\u8bd5\u7528\u6237\u767b\u5f55\u7684\u63a5\u53e3\uff0c\u4f1a\u5236\u9020\u5404\u79cd\u5404\u6837\u7684\u8f93\u5165\u6761\u4ef6\uff0c\u8fd9\u4e9b\u4f53\u73b0\u5230\u6d4b\u8bd5\u6570\u636e\u4e0a\u7684\u53d8\u5316\u5c31\u662f\u7528\u6237\u540d/\u5bc6\u7801\u7684\u53d8\u5316\uff0c\u6211\u4eec\u9700\u8981\u628a\u6d4b\u8bd5\u903b\u8f91\uff08\u6821\u9a8c\u662f\u5426\u80fd\u591f\u767b\u5f55\u6210\u529f\uff09\u548c\u6d4b\u8bd5\u6570\u636e\uff08\u8bf8\u591a\u8d26\u53f7\u5bc6\u7801\uff09\u5206\u5f00\u3002 \u6839\u636e\u6d4b\u8bd5\u6570\u636e\u7684\u4e0d\u540c\u6267\u884c\u4e0d\u540c\u7684\u6d4b\u8bd5\u903b\u8f91 \u901a\u8fc7\u4e0d\u540c\u7684\u6570\u636e\uff0c\u53bb\u5b8c\u6210 \u591a\u7ec4\u6d4b\u8bd5\u6570\u636e \u7684\u6d4b\u8bd5\u3002 \u4ee5\u4e0a\u9762\u7684\u4f8b\u5b50\u6765\u770b\uff0c\u6211\u4eec\u62bd\u79bb \u7528\u6237\u767b\u5f55\u6570\u636e \u548c\u5177\u4f53\u7684\u8f93\u51fa\uff08\u767b\u5f55\u7ed3\u679c\uff09\u7684\u6821\u9a8c\uff0c\u6570\u636e\u8d8a\u591a\uff0c\u8fd9\u6837\u6d4b\u8bd5\u8986\u76d6\u7684\u573a\u666f\u5c31\u4f1a\u8d8a\u591a\uff0c\u5373 \u8986\u76d6\u7387 \u4f1a\u5f97\u5230\u63d0\u5347\u3002\u4f46\u5bf9\u6211\u4eec\u6765\u8bf4\uff0c\u4ec5\u4ec5\u53ea\u662f\u591a\u51d1\u4e00\u4e9b\u6570\u636e\u800c\u5df2\u3002 \ud83d\udcd2 Pity\u6253\u7b97\u600e\u4e48\u505a pity\u672c\u6765\u8fd8\u4e0d\u60f3\u505a\u8fd9\u5757\u529f\u80fd\uff0c\u4f46\u7531\u4e8e \u73af\u5883 \u5404\u65b9\u9762\u7684\u5173\u7cfb\uff0c\u5bfc\u81f4\u4e0d\u5f97\u4e0d\u63d0\u524d\u51c6\u5907\u597d\u5404\u4e2a\u73af\u5883\u7684\u6d4b\u8bd5\u6570\u636e\uff0c\u4e00\u6765\u4e8c\u53bb\u5c31\u4e0d\u5f97\u5df2\u800c\u4e3a\u4e4b\u4e86\u3002 \u4f46 pity \u5f15\u5165 \u6570\u636e\u9a71\u52a8 \u4e5f\u53ea\u662f\u4e00\u4e2a\u629b\u7816\u5f15\u7389\u7684\u8fc7\u7a0b\uff0c\u53ea\u662f\u652f\u6301\u7528\u4f8b\u591a\u6570\u636e\u5316\uff0c\u7528 \u76f8\u540c\u7684\u6d4b\u8bd5\u903b\u8f91 \u8fdb\u884c\u6d4b\u8bd5\u3002 \u6240\u4ee5\u7b80\u5355\u7684\u8bb2\uff0c\u7b14\u8005\u53ea\u6253\u7b97\u8ba9\u7528\u4f8b\u652f\u6301 \u591a\u7ec4\u6570\u636e \uff0c\u5e76\u6839\u636e\u591a\u7ec4\u6570\u636e\u53bb\u8fd0\u884c\u7528\u4f8b\u3002 \ud83c\udf66 \u7f16\u5199\u6d4b\u8bd5\u6570\u636e\u8868\u7684\u76f8\u5173\u63a5\u53e3 \ud83d\udcd2 \u7f16\u5199\u6d4b\u8bd5\u6570\u636e\u8868\u5355 app/models/schema/testcase_data.py \u8868\u5355\u63a5\u53d7case_id\uff0cname\uff0cjson_data\u7b49\u53c2\u6570\uff0c\u76ee\u524d\u6765\u770b\u7684\u8bdd\u6211\u4eec\u652f\u6301\u7684\u6570\u636e\u90fd\u662f\u4ee5 JSON \u4e3a\u4e3b\uff0c\u5982\u679c\u540e\u7eed\u6709\u6587\u4ef6\u7b49\u5185\u5bb9\uff0c\u6211\u4eec\u53ef\u4ee5\u63a5\u53d7 \u6587\u4ef6\u7684url \u5730\u5740\u8fdb\u884c\u6d4b\u8bd5\u3002\u5982\u679c\u662fform\u7684\u5185\u5bb9\uff0cjson\u4e5f\u53ef\u4ee5\u8f6c\u6362\u4e3aKEY-VALUE\u7684\u5f62\u5f0f\u3002 \u6240\u4ee5\u6838\u5fc3\u5c31\u662f: json_data \u548c name \uff0c\u8fd92\u5757\u5c5e\u4e8e\u4e00\u7ec4\u6d4b\u8bd5\u6570\u636e\uff0cname\u53ea\u662f\u8ba9\u4e0d\u540c\u7684\u6d4b\u8bd5\u6570\u636e\u6709\u4e00\u4e2a \u6807\u8bc6 \u3002 \ud83d\udcd2 \u7f16\u5199\u589e\u6539\u65b9\u6cd5 app/dao/test_case/TestcaseDataDao.py \u7f16\u5199\u65b0\u589e\u548c\u4fee\u6539\u65b9\u6cd5\uff0c\u903b\u8f91\u57fa\u672c\u4e00\u81f4\u3002 \u65b0\u589e\u64cd\u4f5c : \u67e5\u627e\u5bf9\u5e94\u7684\u6570\u636e\uff0c\u6709\u5219\u629b\u51fa\u6570\u636e\u5df2\u5b58\u5728\u7684\u5f02\u5e38(\u4e3a\u4e86\u907f\u514d\u91cd\u590d\u6570\u636e\uff0c\u53cc\u91cd\u9632\u62a4\uff0c\u4ee3\u7801\u5c42+\u6570\u636e\u5e93\u552f\u4e00\u7d22\u5f15) \u5982\u679c\u6ca1\u6709\u5219\u76f4\u63a5\u63d2\u5165 \u8fd4\u56de\u65b0\u63d2\u5165\u7684\u6570\u636e\uff0c\u907f\u514d\u4e8c\u6b21\u67e5\u8be2\u6570\u636e\u5217\u8868 \u4fee\u6539\u64cd\u4f5c : \u67e5\u627e\u5bf9\u5e94\u7684\u6570\u636e\uff0c\u65e0\u5219\u629b\u51fa \u6570\u636e\u4e0d\u5b58\u5728 \u7684\u5f02\u5e38(\u8fd9\u6837\u662f\u4e3a\u4e86\u9632\u6b62\u6570\u636e\u5df2\u7ecf\u88ab\u5220\u9664\uff0c\u800c\u7528\u6237\u4ecd\u7136\u5728\u4fee\u6539\u7684\u60c5\u51b5) \u5982\u679c\u6709\u8fd9\u6761\u6570\u636e\u5219\u66f4\u65b0\u4e4b \u8fd4\u56de\u4fee\u6539\u540e\u7684\u6570\u636e \ud83d\udcd2 \u7f16\u5199\u67e5\u8be2\u65b9\u6cd5 \u67e5\u8be2\u65b9\u6cd5\u6211\u4eec\u6253\u7b97\u7f16\u51992\u4e2a\u6838\u5fc3\u65b9\u6cd5: \u901a\u8fc7case_id\u67e5\u8be2\u6d4b\u8bd5\u6570\u636e \u8fd9\u4e2a\u65b9\u6cd5\u662f\u7ed9 \u9875\u9762\u67e5\u8be2 \u8fd9\u4e2acase\u5728\u4e0d\u540c\u7684\u73af\u5883\u4e0b\u7684\u6240\u6709\u6d4b\u8bd5\u6570\u636e\u7528\u7684\u3002 \u901a\u8fc7\u73af\u5883\u67e5\u8be2\u6d4b\u8bd5\u6570\u636e \u8fd9\u4e2a\u662f\u7ed9\u7528\u4f8b\u6267\u884c\u65f6\uff0c\u5feb\u901f\u62ff\u5230\u7528\u4f8b\u5bf9\u5e94\u73af\u5883\u4e0b\u7684\u6d4b\u8bd5\u6570\u636e\u7528\u7684\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u6211\u8fd9\u65f6\u5019\u5728\u6d4b\u8bd5\u4e00\u4e2a\u63a5\u53e3\uff0c\u5982\u679c\u4ee5\u6570\u636e\u9a71\u52a8\u7684\u65b9\u5f0f\uff0c\u6211\u5f97\u5feb\u901f\u627e\u5230\u8fd9\u4e2a\u63a5\u53e3\u5bf9\u5e94\u7684 csv\u6216\u8005json\u6587\u4ef6 \uff0c\u627e\u5230\u4e86\u4ee5\u540e\u8fd8\u662f\u4f1a\u8f6c\u6362\u4e3a Python\u6570\u7ec4 \uff0c\u6240\u4ee5\u6211\u4eec\u5927\u6982\u662f\u8fd9\u6837\u7684\u8fc7\u7a0b\u3002 \u53ef\u4ee5\u770b\u5230\uff0c\u4e8c\u8005\u7684\u533a\u522b\u53ea\u662f\u67e5\u8be2\u6761\u4ef6\u4e0d\u540c\uff0c\u524d\u8005\u672a\u4f20\u5165env\uff0c\u540e\u8005\u4f20\u5165\u4e86env \u524d\u8005\u8fd4\u56de\u4e86\u4e00\u4e2a\u4e0b\u56fe\u8fd9\u6837\u7684\u6d4b\u8bd5\u6570\u636e\uff0c\u540e\u8005\u8fd4\u56de\u7684\u662f\u5bf9\u5e94\u73af\u5883\u7684 \u6d4b\u8bd5\u6570\u636e \u5217\u8868\u3002 { \"fat\" : [{ \"data\" : \"\u6d4b\u8bd5\u6570\u636e1\" }]} \ud83d\udcd2 \u7f16\u5199\u5220\u9664\u65b9\u6cd5 \u5220\u9664\u65b9\u6cd5\u5f88\u7b80\u5355\uff0c\u6211\u4eec\u53ea\u9700\u8981\u628a\u6570\u636e\u7684deleted_at\u6539\u4e3a\u5f53\u524d\u65f6\u95f4\u6233\u5373\u53ef \ud83d\udcd2 \u7f16\u5199\u63a5\u53e3 \u8fd9\u8fb9\u53ea\u6709\u589e\u5220\u6539\u7684\u63a5\u53e3 \u67e5\u8be2\u63a5\u53e3\u6211\u4eec\u628a\u5b83\u653e\u5165 \u67e5\u8be2\u7528\u4f8b\u63a5\u53e3 \u91cc\u9762: \u56e0\u4e3a\u7528\u4f8b\u662f\u4e00\u4e2a\u6574\u4f53\uff0c\u6211\u4eec\u9700\u8981\u5bf9\u6574\u4f53\u8fdb\u884c\u6570\u636e\u8fd4\u56de\uff0c\u6545\u6ca1\u6709\u5f00\u653e\u4e13\u95e8\u7684\u67e5\u8be2\u63a5\u53e3\uff0c\u540e\u7eed\u6709\u9700\u8981\u6211\u4eec\u53ef\u4ee5\u518d\u653e\u5f00 \ud83c\udf66 \u524d\u7aef\u6539\u52a8 \u524d\u7aef\u7684\u6539\u52a8\u6bd4\u8f83\u7b80\u5355\uff0c\u5373\u5728\u7528\u4f8btab\u9875\u52a0\u5165 \u6570\u636e\u7ba1\u7406 \u529f\u80fd\uff0c\u5e76\u5728\u6700\u5de6\u4fa7\u52a0\u4e0a\u73af\u5883tab\uff08\u6839\u636e\u81ea\u5df1\u914d\u7f6e\u7684\u73af\u5883\uff09\uff0c\u53f3\u4fa7\u5219\u4e3a\u5bf9\u5e94\u7684 \u6d4b\u8bd5\u6570\u636e\u8868\u683c \u3002 \u5173\u4e8e\u6570\u636e\u9a71\u52a8\u7684\u589e\u5220\u6539\u67e5\u7f16\u5199\u5c31\u5230\u6b64\u7ed3\u675f\u4e86\uff0c\u7531\u4e8e\u6570\u636e\u9a71\u52a8\u6709\u4e00\u4e9b\u6539\u9020\uff0c\u6240\u4ee5\u4e0b\u671f\u6211\u4eec\u4f1a\u8bb2\u5982\u4f55\u9002\u914d \u6570\u636e\u9a71\u52a8 \u7684\u5f71\u54cd\u3002","title":"67.\u73a9\u8f6c\u6570\u636e\u9a71\u52a8"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2868%29%20%E8%A7%A3%E5%86%B3%E6%95%B0%E6%8D%AE%E9%A9%B1%E5%8A%A8%E5%B8%A6%E6%9D%A5%E7%9A%84%E9%BA%BB%E7%83%A6/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u5b8c\u6574\u7684 \u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0\u7cfb\u5217\u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u80fd\u591f\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u6d4b\u8bd5\u5f00\u53d1\u5751\u8d27 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \ud83c\udf66 \u56de\u987e \u4e0a\u8282\u5185\u5bb9\u6211\u4eec\u7f16\u5199\u597d\u4e86 \u6570\u636e\u9a71\u52a8\u76f8\u5173 \u7684\u63a5\u53e3\uff0c\u4f46\u5374\u6709 \u5f88\u591a\u56f0\u6270 \u968f\u4e4b\u800c\u6765\u3002\u63a5\u7740\u5c31\u6765\u8bf4\u8bf4\u6211\u4eec\u63d0\u51fa\u8fd9\u4e9b\u56f0\u6270\uff0c\u5e76\u89e3\u51b3\u4e4b\u3002 \ud83d\udcd2 \u95ee\u9898\u6c47\u603b \u7531\u4e8e \u6570\u636e\u9a71\u52a8 \u7684\u6539\u9020\uff0c\u53ef\u80fd\u4f1a\u5f15\u53d1\u4ee5\u4e0b\u51e0\u4e2a\u95ee\u9898: \u539f\u5148\u7684\u6267\u884c\u7528\u4f8b\u7684\u65b9\u5f0f\u9700\u8981\u53d8\u5316 \u6570\u636e\u9a71\u52a8\u4ee5\u540e\uff0c\u6211\u4eec\u6279\u91cf\u6267\u884ccase\u7684\u65f6\u5019\u9700\u8981\u5e26\u4e0a\u73af\u5883\u5b57\u6bb5\u4e86\uff0c\u5426\u5219 \u6570\u636e\u9a71\u52a8 \u6ca1\u6cd5\u4f7f\u7528\u3002 \u539f\u5148\u80fd\u591f\u76f4\u63a5\u8c03\u8bd5case\uff0c\u4e5f\u5c31\u662f\u5355\u6761case\u5728\u7ebf\u6267\u884c \u73b0\u5728\u7531\u4e8e\u73af\u5883\u7684\u5173\u7cfb+\u591a\u6570\u636e\u7684\u60c5\u51b5\uff0c\u6211\u4eec\u53ea\u80fd\u628a\u8fd9\u5757\u8fdb\u884c\u8c03\u6574\uff0c\u8ba9\u5355\u4e2acase\u7684\u8c03\u8bd5\u53d8\u4e3a \u5355\u6761\u6d4b\u8bd5\u6570\u636e \u7684\u8c03\u8bd5\u3002 \u53ef\u4ee5\u770b\u5230\u73b0\u5728\u6267\u884ccase\u7684\u65f6\u5019\u4f1a\u63d0\u793a\u6ca1\u6709env\u53c2\u6570\uff0c\u56e0\u4e3a\u6211\u4eec\u652f\u6301\u4e86\u6570\u636e\u9a71\u52a8\uff0c\u5fc5\u987b\u5e26\u4e0a\u6267\u884c\u73af\u5883 \u6267\u884c\u6d4b\u8bd5\u7528\u4f8b\u903b\u8f91\u7684\u53d8\u5316 \u4e4b\u524d\u6211\u4eec\u6267\u884c\u6d4b\u8bd5\u7528\u4f8b\u7684\u65f6\u5019\uff0c\u4e3e\u4e2a\u4f8b\u5b50: \u767b\u5f55\u63a5\u53e3 \uff0c\u6211\u4eec\u662f\u5728\u524d\u7f6e\u6761\u4ef6\u91cc\u9762\u5199\u597d\u4e86\u5177\u4f53\u7684\u767b\u5f55 \u7528\u6237\u540d \u548c \u5bc6\u7801 \u3002\u4f46\u5728 \u6570\u636e\u9a71\u52a8 \u7684\u60c5\u51b5\u4e0b\uff0c\u53c8\u4e0d\u4e00\u6837\u4e86\u3002 \u6211\u4eec\u5f97\u628a\u7528\u4f8b\u91cc\u9762\u53d8\u5316\u7684\u6570\u636e\u5168\u90e8 \u62bd\u79bb\u51fa\u6765 \uff0c\u5176\u5b9e\u8fd9\u4e48\u505a\u7684\u76ee\u7684\u662f\u4e3a\u4e86\u8ba9\u6570\u636e\u66f4\u7075\u6d3b\uff0c\u4e5f\u4e3a\u4e86\u4ee5\u540e\u80fd\u652f\u6301 \u6570\u636e\u5de5\u5382 \u3002 \u6240\u4ee5\u8fd9\u5c31\u4f1a\u5bfc\u81f4\u6211\u4eec\u6267\u884ccase\u7684\u6574\u5957\u903b\u8f91\u4f1a\u53d1\u751f \u5267\u70c8\u53d8\u5316 \uff0c\u8ba9\u4eba\u5934\u5927\uff01\uff01\uff01 \u65ad\u8a00\u903b\u8f91\u7684\u6539\u9020 \u7ec6\u5fc3\u7684\u670b\u53cb\u53ef\u80fd\u4f1a\u53d1\u73b0\uff0c\u65ad\u8a00\u90e8\u5206\u4e4b\u524d\u6ca1\u6709\u5f88\u597d\u5730\u652f\u6301 \u53d8\u91cf \uff0c\u4f46\u73b0\u5728\u4e0d\u4e00\u6837\uff0c\u6211\u4eec\u8981\u6839\u636e\u4e0d\u540c\u7684\u53c2\u6570\u5b8c\u6210\u4e0d\u540c\u7684\u65ad\u8a00\u64cd\u4f5c\uff0c\u6240\u4ee5\u6211\u4eec\u4e5f\u5f97\u652f\u6301\u3002 \ud83c\udf66 \u8fce\u63a5\u6311\u6218 \u867d\u7136\u8fd9\u4e9b\u6311\u6218\u6bd4\u8f83\u9ebb\u70e6\uff0c\u4f46\u597d\u5728 \u5927\u591a \u662f\u4f53\u529b\u6d3b\u513f\u3002\u56e0\u4e3a\u4ee5\u524d\u7684\u903b\u8f91\u548c\u73b0\u5728\u903b\u8f91\u7684 \u533a\u522b \u5f15\u53d1\uff0c\u53ea\u8981\u8010\u5fc3\uff0c\u5c31\u80fd\u9010\u4e00\u51fb\u7834\u3002\u800c\u4e14\u4e4b\u524d\u57cb\u4e0b\u7684\u5751\u6bd4\u5982 \u65ad\u8a00\u53d8\u91cf \u6ca1\u66ff\u6362\u7b49\u7b49\u90fd\u53ef\u4ee5\u968f\u4e4b\u89e3\u51b3\u3002 \ud83d\udcd2 \u6539\u9020\u62a5\u544a PityTestResult\u65b0\u589e\u5b57\u6bb5 \u4e4b\u524d\u6211\u4eec\u7f16\u5199\u62a5\u544a\u7684\u65f6\u5019\uff0c\u90fd\u662f\u4e00\u6761case\u4e00\u6761\u6570\u636e\uff0c\u90a3\u73b0\u5728\u6709\u4e86\u6570\u636e\u9a71\u52a8\uff0c\u6211\u4eec\u7684\u62a5\u544a\u5c31\u9700\u8981\u505a\u51fa\u4e00\u5b9a\u7684 \u6539\u53d8 \u3002 \u6570\u636e\u9a71\u52a8\u76842\u4e2a\u6838\u5fc3\u5b57\u6bb5\uff0c\u6570\u636e+\u6807\u8bc6 \u73b0\u5728\u6211\u4eec\u9700\u8981\u628a\u6570\u636e\u7684\u6807\u8bc6\u548c\u6570\u636e\u7684\u5185\u5bb9\u90fd \u5199\u5165\u62a5\u544a \uff0c\u8fd9\u6837\u7684\u8bdd\u5728\u67e5\u770b\u62a5\u544a\u7684\u65f6\u5019\u5c31\u80fd\u6e05\u695a\u5730\u770b\u5230\u6bcf\u6761\u6570\u636e\u7684\u6267\u884c\u7ed3\u679c\uff0c\u53ef\u4ee5 \u5bf9\u53f7\u5165\u5ea7 \u3002 PityTestResult\u521d\u59cb\u5316\u65b9\u6cd5\u65b0\u589e\u5b57\u6bb5 \u540c\u7406\uff0c\u63d2\u5165\u6d4b\u8bd5\u7ed3\u679c\u7684\u65f6\u5019\u4e5f\u8981\u8c03\u6574 \u67e5\u8be2\u62a5\u544a\u7684\u65f6\u5019\u4e5f\u8981\u76f8\u7ee7\u8c03\u6574 \u6309\u7167\u7528\u4f8bid+\u7528\u4f8b\u5f00\u59cb\u6267\u884c\u65f6\u95f4\u7684\u987a\u5e8f\u6392\u5217 \ud83d\udcd2 \u6539\u9020\u7528\u4f8b\u6267\u884c\u5668 \u6211\u4eec\u4e4b\u524d\u7684\u6267\u884c\u5668\u6709\u8bb8\u591a\u4e0d\u5b8c\u5584\u7684\u5730\u65b9\uff0c\u6bd4\u5982\u4e0d\u652f\u6301\u65ad\u8a00\u91cc\u9762\u7684\u6570\u636e\u53d8\u5316\uff0c\u518d\u8005\u53ea\u66ff\u6362\u4e86\u4e00\u6b21\u6570\u636e\uff0c\u800c\u73b0\u5728\u6211\u4eec\u8981\u505a\u7684\u662f\u4ec0\u4e48\u5462\uff1f \u6bcf\u5f53\u6709\u65b0\u7684\u53d8\u91cf\u751f\u6210\uff0c\u6211\u4eec\u90fd\u8981\u53bb\u5bfb\u627e\u53d8\u91cf\u53bb\u66ff\u6362\uff0c\u8fd9\u6837\u505a\u867d\u7136\u663e\u5f97\u5de5\u4f5c\u91cf\u5f88\u91cd\u590d\uff0c\u4f46\u662f\u5b8c\u6574\u5730\u4fdd\u8bc1\u4e86\u751f\u6210\u7684\u53d8\u91cf\u4e0d\u4f1a\u6f0f\u6389\u3002 \u7f16\u5199replace_args\u65b9\u6cd5 \u8981\u66ff\u6362\u7684\u5730\u65b9\u67094\u4e2a\uff0c\u7528\u4f8b\uff0c\u524d\u7f6e\u6761\u4ef6\uff0c\u540e\u7f6e\u6761\u4ef6\uff0c\u65ad\u8a00 \u56e0\u4e3a\u6ca1\u6cd5 \u5ea6\u91cf \u53d8\u91cf\u4ec0\u4e48\u65f6\u5019\u751f\u6210\uff0c\u6240\u4ee5\u8981\u505a\u7684\u5c31\u662f\u6bcf\u5f53\u6709\u65b0\u7684\u53d8\u91cf\u4ea7\u751f\u5c31 \u66ff\u6362\u53d8\u91cf \u3002 replace\u65b9\u6cd5 \u53ef\u4ee5\u770b\u5230\u4ed6\u4eec\u90fd\u8c03\u7528\u4e86\u6838\u5fc3\u65b9\u6cd5: replace_cls\uff0c\u4e5f\u5c31\u662f\u66ff\u6362\u4e00\u4e2a\u5bf9\u8c61\uff0c\u901a\u8fc7\u5c5e\u6027+\u503c\u7684\u5f62\u5f0f\u3002 \u6211\u4eec\u6765\u770b\u4e00\u4e0breplace_cls\u65b9\u6cd5 \u5256\u6790\u4e00\u4e0b: \u904d\u5386\u53c2\u6570\u5b57\u5178\uff0c\u63a5\u7740\u53bb\u6307\u5b9a\u7684\u5bf9\u8c61 \u5b57\u6bb5 \u91cc\u9762\u67e5\u8be2\u662f\u5426\u6709\u8fd9\u4e2a\u53d8\u91cf\uff0c\u4ec0\u4e48\u610f\u601d\u5462\uff1f\u5047\u8bbe\u6709\u8fd9\u6837\u4e00\u4e2a\u5bf9\u8c61: class Student : def __init__ (self, name, age) : self.name = name self.age = age \u5047\u8bbe\u6b64\u65f6\u5b66\u751f\u7684name\u548cage\u5206\u522b\u662f ${student_name} \u548c 18 \u3002 \u6211\u4eec\u8fd9\u8fb9\u6709\u4e2a\u53c2\u6570\u5b57\u5178\u4e3a: params = { \"student_name\" : \"miro\" } \u5f88\u663e\u7136\uff0c\u6211\u4eec\u8981\u505a\u7684\u6548\u679c\u5c31\u662f: \u904d\u5386params\uff0c\u6b64\u65f6key=student_name, value=miro \u6839\u636e\u6307\u5b9a\u7684\u5b57\u6bb5: name \u548c age \uff08\u6ce8\u610f\u662f\u4e2a\u5217\u8868\uff09 \u5148\u627ename\uff0c\u53d1\u73b0name\u7684\u503c\u662f ${student_name} \uff08\u6211\u4eecpity\u5185\u90e8\u7ea6\u5b9a\u7684\u53d8\u91cf\u5f62\u5f0f\uff09\uff0c\u548cstudent_name\u543b\u5408\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u628a${student_name} \u66ff\u6362\u4e3a miro \u8c03\u7528setattr\u65b9\u6cd5\uff0c\u628astudent_name\u66ff\u6362\u6210\u5b83\u5e94\u8be5\u53d8\u6210\u7684\u503c: miro \u7531\u4e8eage\u5b57\u6bb5\u7684\u503c\u662f18\uff0c\u5e76\u4e0d\u662f\u4e00\u4e2a\u53d8\u91cf\uff0c\u6240\u4ee5\u5faa\u73af\u7ed3\u675f \u5c31\u662f\u4e0a\u9762\u8fd9\u4e2a\u601d\u8def\uff0c\u4e0d\u77e5\u9053\u5927\u5bb6\u6709\u6ca1\u6709\u770b\u660e\u767d\u3002 replace_params \u8fd9\u5757\u662f\u53d8\u91cf\u66ff\u6362\u7684 \u7cbe\u9ad3 \u6240\u5728\uff0c\u4e5f\u662f\u6700\u96be\u5f04\u61c2\u7684\u5730\u65b9\u3002 \u8fd9\u91cc\u7684request_headers\u662f\u7279\u6b8a\u60c5\u51b5\uff0c\u505a\u7684\u7279\u6b8a\u5904\u7406 \u8fd9\u4e2a\u65b9\u6cd5\u5177\u4f53\u7684\u5904\u7406\u903b\u8f91\u5c31\u662f\u4eceJSON\u5b57\u7b26\u4e32\u4e2d\u627e\u5230\u5bf9\u5e94\u7684\u503c\uff0c\u5e76\u80fd\u652f\u6301\u5b57\u6bb5\u53d6\u503c\u3002 \u6bd4\u5982 a = '{\"human\": {\"age\": 1}}' \u8fd9\u4e2ajson\u5b57\u7b26\u4e32\uff0c\u5982\u679c\u6211\u4eec\u8981\u53d6\u5230age\uff0c\u6211\u4eec\u9700\u8981\u8fd9\u4e48\u5199 ${res.human.age} . \u8fd9\u4e2a\u65b9\u6cd5\u505a\u5230\u7684\u4e8b\u60c5\u5c31\u662f\uff0c\u4eceres\u83b7\u53d6human\uff0c\u63a5\u7740\u83b7\u53d6age\uff0c\u6700\u7ec8\u8fd4\u56de\u4e00\u4e2a\u5b57\u6bb5\uff0c\u7528\u4e8e\u66ff\u6362: new_data = {\"human.age\": 1} \u5b8c\u6210\u4e0a\u8ff0\u64cd\u4f5c\uff0c\u63a5\u7740\u5c31\u80fd\u591f\u4ece\u5b57\u7b26\u4e32\u4e2d\u62ff\u5230human.age\u7684\u503c\uff081\uff09\u4e86\uff0c\u4ece\u800c\u80fd\u591f\u5c06\u6240\u6709\u7528\u4f8b\u4ea7\u751f\u7684 \u53d8\u91cf \u5206\u914d\u5230\u5176\u4ed6case\u6216\u8005\u5176\u4ed6\u6570\u636e\u3002 \u8fd9\u5757\u4e4b\u6240\u4ee5 \u6709\u4e00\u4e9b\u6539\u52a8 \uff0c\u662f\u56e0\u4e3a\u6211\u4eec\u628aresponse\u91cc\u9762\u7684\u6240\u6709\u6570\u636e\u90fd\u6539\u6210\u4e86\u5b57\u7b26\u4e32\uff0c\u4ee5\u524d\u6bd4\u5982response\u53ef\u80fd\u662f \u5b57\u5178 \u3002 \ud83d\udcd2 \u6539\u9020\u6570\u636e\u6784\u9020\u5668 \u6570\u636e\u6784\u9020\u5668\uff0c\u52bf\u5fc5\u4f1a\u4ea7\u751f\u53d8\u91cf\uff0c\u4ea7\u751f\u53d8\u91cf\u5219\u8981\u8fdb\u884c\u4e00\u6b21\u66ff\u6362\u64cd\u4f5c\uff08\u54ea\u6015\u6ca1\u4ea7\u751f\u53d8\u91cf\uff09 \ud83d\udcd2 run\u65b9\u6cd5\u6539\u9020 async def run (self, env: int, case_id: int, params_pool: dict = None, request_param: dict = None, path= \"\u4e3bcase\" ) : \"\"\" \u5f00\u59cb\u6267\u884c\u6d4b\u8bd5\u7528\u4f8b \"\"\" response_info = dict() # \u521d\u59cb\u5316case\u5168\u5c40\u53d8\u91cf, \u53ea\u5b58\u5728\u4e8ecase\u751f\u547d\u5468\u671f \u6ce8\u610f \u5b83\u4e0e\u5168\u5c40\u53d8\u91cf\u4e0d\u662f\u4e00\u5957\u903b\u8f91 case_params = params_pool if case_params is None : case_params = dict() req_params = request_param if req_params is None : req_params = dict() try : case_info, err = await TestCaseDao.async_query_test_case(case_id) if err: return response_info, err response_info[ \"case_name\" ] = case_info.name method = case_info.request_method.upper() response_info[ \"request_method\" ] = method # Step1: \u66ff\u6362\u5168\u5c40\u53d8\u91cf await self.parse_gconfig(case_info, *Executor.fields) self.append( \"\u89e3\u6790\u5168\u5c40\u53d8\u91cf\" , True ) # Step2: \u83b7\u53d6\u6784\u9020\u6570\u636e constructors = await self.get_constructor(case_id) # Step3: \u83b7\u53d6\u65ad\u8a00 asserts, err = await TestCaseAssertsDao.async_list_test_case_asserts(case_id) if err: return response_info, err # Step4: \u66ff\u6362\u53c2\u6570 self.replace_args(req_params, case_info, constructors, asserts) # Step5: \u6267\u884c\u6784\u9020\u65b9\u6cd5 await self.execute_constructors(env, path, case_info, case_params, req_params, constructors, asserts) response_info[ \"url\" ] = case_info.url # Step6: \u83b7\u53d6\u540e\u7f6e\u64cd\u4f5c # TODO # Step7: \u6279\u91cf\u6539\u5199\u4e3b\u65b9\u6cd5\u53c2\u6570 await self.parse_params(case_info, case_params) if case_info.request_headers != \"\" : headers = json.loads(case_info.request_headers) else : headers = dict() if \"Content-Type\" not in headers: headers[ 'Content-Type' ] = \"application/json; charset=UTF-8\" if case_info.body != '' : body = case_info.body else : body = None # Step5: \u66ff\u6362\u8bf7\u6c42\u53c2\u6570 body = self.replace_body(request_param, body) # Step6: \u5b8c\u6210http\u8bf7\u6c42 if \"form\" not in headers[ 'Content-Type' ]: request_obj = AsyncRequest(case_info.url, headers=headers, data=body.encode() if body is not None else body) else : if body is not None : body = json.loads(body) request_obj = AsyncRequest(case_info.url, headers=headers, data=body) res = await request_obj.invoke(method) self.append( f\"http\u8bf7\u6c42\u8fc7\u7a0b\\n\\nRequest Method: {case_info.request_method} \\n\\n\" f\"Request Headers:\\n {headers} \\n\\nUrl: {case_info.url} \" f\"\\n\\nBody:\\n {body} \\n\\nResponse:\\n {res.get( 'response' , '\u672a\u83b7\u53d6\u5230\u8fd4\u56de\u503c' )} \" ) response_info.update(res) # \u6267\u884c\u5b8c\u6210\u8fdb\u884c\u65ad\u8a00 asserts, ans = self.my_assert(asserts, response_info) response_info[ \"asserts\" ] = asserts # \u65e5\u5fd7\u8f93\u51fa, \u5982\u679c\u4e0d\u662f\u5f00\u5934\u7528\u4f8b\u5219\u4e0d\u8bb0\u5f55 if self._main: response_info[ \"logs\" ] = self.logger.join() response_info[ \"status\" ] = ans return response_info, None except Exception as e: Executor.log.error( f\"\u6267\u884c\u7528\u4f8b\u5931\u8d25: {str(e)} \" ) self.append( f\"\u6267\u884c\u7528\u4f8b\u5931\u8d25: {str(e)} \" ) if self._main: response_info[ \"logs\" ] = self.logger.join() return response_info, f\"\u6267\u884c\u7528\u4f8b\u5931\u8d25: {str(e)} \" \u65b9\u6cd5\u6bd4\u8f83\u957f\uff0c\u6211\u5c31\u76f4\u63a5\u8d34\u4ee3\u7801\u4e86\u3002\u6539\u9020\u70b9\u4e3b\u8981\u6709\u4ee5\u4e0b\u51e0\u5904: \u65b0\u589eenv\u53c2\u6570 replace_args\u66ff\u6362\u6389replace_params \u6253\u5370\u5b8c\u6574\u7684http\u8bf7\u6c42 \u5728\u6267\u884c\u5f02\u5e38\u7684\u65f6\u5019\uff0c\u8fd4\u56de\u5c3d\u53ef\u80fd\u591a\u7684\u4fe1\u606f \ud83d\udcd2 \u6539\u9020\u6267\u884c\u65b9\u6cd5 \u5728\u6267\u884c\u4e4b\u524d\u5462\uff0c\u5148\u83b7\u53d6\u8fd9\u4e2acase\u5728\u5bf9\u5e94\u73af\u5883\u7684\u6d4b\u8bd5\u6570\u636e\uff0c\u7136\u540e\u5c06\u6570\u636e\u89e3\u6790\u4e3a json . \u63a5\u7740\u5c31\u662f\u7528\u5f02\u6b65\u7684\u65b9\u5f0f\uff0c\u6328\u4e2a\u513f\u6267\u884c\u3002 \u5176\u4ed6\u7684\u6bd4\u5982\u6279\u91cf\u6267\u884c\uff0c\u4e5f\u548c\u8fd9\u4e2a\u7ec6\u8282\u5dee\u4e0d\u591a\uff0c\u56e0\u4e3a\u7bc7\u5e45\u7684\u95ee\u9898\u5c31\u4e0d\u8bb2\u4e86\u3002 \u5927\u5bb6\u6709\u5174\u8da3\u53ef\u4ee5\u770b\u770brequest/http.py\u6587\u4ef6\u3002","title":"68.\u89e3\u51b3\u6570\u636e\u9a71\u52a8\u5e26\u6765\u7684\u9ebb\u70e6"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2869%29%20%E6%95%B0%E6%8D%AE%E6%9E%84%E9%80%A0%E5%99%A8%E6%94%AF%E6%8C%81sql%E8%AF%AD%E5%8F%A5/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684\u5b8c\u6574 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u6d4b\u8bd5\u5f00\u53d1\u5751\u8d27 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \ud83c\udf66 \u56de\u987e \u4e0a\u8282\u5185\u5bb9\u6211\u4eec\u7f16\u5199\u4e86\u975e\u5e38\u6076\u5fc3\u7684 \u6570\u636e\u9a71\u52a8 \u90e8\u5206\uff0c\u800c\u4e14\u6709\u4e9b\u4e1c\u897f\u7b14\u8005\u8fd8\u8bb2\u7684\u4e0d\u6e05\u4e0d\u695a\u7684\u3002\u63a5\u4e0b\u6765\u6211\u4eec\u5c31\u6765\u8ba9\u6570\u636e\u6784\u9020\u5668\u652f\u6301sql\u3002 \u5148\u770b\u770b\u4e4b\u524d\u7684\u6570\u636e\u6784\u9020\u5668: \u753b\u4e86\u8bb8\u591a\u997c\uff0c\u8981\u652f\u6301\u7684\u5927\u6982\u662f\u8fd9\u4e48\u591a \u6d4b\u8bd5\u7528\u4f8b sql redis http python\u65b9\u6cd5 \u76ee\u524d\u6211\u4eec\u8fd8\u53ea\u652f\u6301\u4e00\u79cd\u5462~\u6240\u4ee5\u6211\u4eec\u8981\u5c3d\u5feb\u652f\u6301\u8d77\u6765\uff0c\u4fdd\u8bc1\u9020\u6570\u7684 \u4e30\u5bcc\u6027 \u3002 \ud83d\udcd2 SQL\u6784\u9020\u5668 \u5176\u5b9esql\u6784\u9020\u5668\u6bd4\u8f83\u7b80\u5355\uff0c\u6211\u4eec\u4e4b\u524d\u7684\u6587\u7ae0\u4e5f\u5df2\u7ecf\u5199\u597d\u4e86sql\u6784\u9020\u5668\u7684\u6838\u5fc3\u65b9\u6cd5\uff0c\u8be6\u60c5\u53ef\u4ee5\u770b \u5728\u7ebf\u6267\u884csql \u7684\u6587\u7ae0\u3002 \u90a3\u6211\u4eec\u4eca\u5929\u53ea\u9700\u8981\u7a0d\u5fae\u6765\u70b9\u6539\u9020\u5373\u53ef\u3002 \u7f16\u5199\u83b7\u53d6sql\u914d\u7f6e\u7684\u65b9\u6cd5 \u4e4b\u524d\u6211\u4eec\u7f16\u5199\u7684\u83b7\u53d6sql\u914d\u7f6e\u7684\u65b9\u6cd5\uff0c\u90fd\u662f\u6839\u636eid\u6765\u83b7\u53d6\u7684\uff0c\u4f46\u56e0\u4e3a\u6211\u4eec\u5b58\u5728 \u591a\u73af\u5883 \u7684\u60c5\u51b5\u3002\u4e3e\u4e2a\u4f8b\u5b50: fat uat id 1 2 \u6570\u636e\u5e93\u540d blog blog \u8fd9\u6837\u7684\u6570\u636e\uff0c\u540d\u79f0\u90fd\u662fblog\uff0c\u4f46\u73af\u5883\u4e0d\u540c\u5bfc\u81f4\u4f1a\u6709 \u591a\u6761\u6570\u636e \u3002\u6211\u4eec\u7684\u7528\u4f8b\u8981\u652f\u6301 \u591a\u73af\u5883 \u8fd0\u884c, \u5982\u679c\u6307\u5b9a\u4e86id\u4e3a1\uff0c\u90a3\u4e48\u5c31\u4e0d\u80fd\u8bbf\u95ee\u5230uat\u4e0b\u7684blog\u4e86\u3002 \u6240\u4ee5\u6211\u4eec\u6253\u7b97\u7528\u73af\u5883+\u6570\u636e\u5e93\u540d\u786e\u5b9a\u4e00\u4e2a\u914d\u7f6e\uff0c\u8fd9\u6837\u5f53 env\u53d1\u751f\u53d8\u5316 \u7684\u65f6\u5019\uff0c\u6211\u4eec\u7684\u914d\u7f6e\u4e5f\u4f1a\u8ddf\u7740\u53d8\u5316\u3002 \u6240\u4ee5\u6211\u4eec\u7f16\u5199\u901a\u8fc7\u73af\u5883\u548c\u540d\u5b57\u67e5\u8be2\u6570\u636e\u5e93\u914d\u7f6e\u7684\u65b9\u6cd5 \u7f16\u5199\u6267\u884csql\u7684\u65b9\u6cd5 \u8fd9\u91cc\u548c\u5728\u7ebf\u6267\u884c\u6709\u6240\u4e0d\u540c\uff0c\u4e3b\u8981\u4f53\u73b0\u5728\u83b7\u53d6\u914d\u7f6e\u90a3\u5757\u3002\u5e76\u4e14\u628a\u67e5\u8be2\u7ed3\u679c\u5e8f\u5217\u5316\u4e3ajson\u5b57\u7b26\u4e32\uff0c\u65b9\u4fbf\u8fdb\u884c\u53d8\u91cf\u66ff\u6362\u3002 \u6539\u9020\u6267\u884c\u524d\u7f6e\u6761\u4ef6\u65b9\u6cd5 \u6267\u884c\u524d\u7f6e\u6761\u4ef6\u7684\u65f6\u5019\u4f1a\u5224\u65ad \u524d\u7f6e\u6761\u4ef6\u7c7b\u578b \uff0c\u5982\u679c\u73b0\u5728\u7c7b\u578b\u4e3a1\uff0c\u8bf4\u660e\u662fsql\u7c7b\u578b\u3002 \u6211\u4eec\u5148\u53cd\u5e8f\u5217\u5316\u6570\u636e\uff0c\u62ff\u5230\u5bf9\u5e94\u7684\u6570\u636e\u5e93\u540d\u79f0\u914d\u7f6e\u4fe1\u606f\u3002 \u6ce8\u610f\uff0c\u8fd9\u91cc\u7684\u53cd\u5e8f\u5217\u5316\u662f\u56e0\u4e3a\u6211\u4eec\u7684\u524d\u7f6e\u6761\u4ef6\u8868\u662f\u7528\u4e86\u4e00\u4e2aTEXT\u5b57\u6bb5\u5b58\u653e\u6240\u6709\u7c7b\u578b\u7684\u6570\u636e\uff0c\u7531\u4e8e\u7528\u4f8b\u548csql\u6570\u636e\u683c\u5f0f\u90fd\u4e0d\u4e00\u81f4\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u53cd\u5e8f\u5217\u5316\u4e3a\u5b57\u5178\u8fdb\u4e00\u6b65\u53d6\u503c\u3002 \u62ff\u5230database\uff08\u6570\u636e\u5e93\u540d\uff09\u548csql\uff08sql\u8bed\u53e5\uff09\uff0c\u63a5\u7740\u6267\u884csql\uff0c\u628a\u53d8\u91cf\u653e\u5165 \u53d8\u91cf\u6c60 \u3002 \ud83d\udcd2 \u524d\u7aef\u90e8\u5206 \u81f3\u6b64\uff0c\u6211\u4eec\u540e\u7aef\u7684\u6539\u52a8\u5c31\u5b8c\u6210\u4e86\u3002\u6765\u770b\u770b\u524d\u7aef\u7684\u53d8\u5316: \u6570\u636e\u7f16\u5199\u9875\u9762 \u5de6\u4fa7\u83dc\u5355\u53ef\u4ee5\u5207\u6362\u7f16\u8f91\u548c\u8c03\u8bd5\u6a21\u5f0f\uff0c\u8c03\u8bd5\u6a21\u5f0f\u5219\u662f\u5f15\u5165\u4e86\u5728\u7ebf\u6267\u884csql\u7684\u9875\u9762 \u53ef\u4ee5\u770b\u5230\u660e\u663e\u7684\u7c7b\u578b\u533a\u5206 \ud83d\udcd2 \u600e\u4e48\u4f7f\u7528\u5462 \u81ea\u4ece\u6539\u5199\u4e86 \u6570\u636e\u9a71\u52a8 \u4ee5\u540e\uff0c\u6211\u4eec\u8fd8\u6ca1\u6709\u8dd1\u8fc7\u4e00\u4e2a\u5b8c\u6574\u7684\u4f8b\u5b50\u3002\u63a5\u7740\u6211\u4eec\u6765\u770b\u770b: \u524d\u7f6e\u7528\u4f8b \u5148\u770b\u770b\u524d\u7f6e\u7528\u4f8b \u524d\u7f6e\u7528\u4f8b\u662f\u4e00\u4e2a\u767b\u5f55\u7684case\uff0c\u91cc\u9762\u7684username\u548cpassword\u90fd\u5df2\u7ecf\u62bd\u79bb\u51fa\u6765\uff0c\u8fd9\u4e2a\u503c\u8981\u600e\u4e48\u4f20\u7ed9\u5b83\u5462\uff1f\u8fd9\u4e2a\u4f9d\u8d56\u4e8e\u6211\u4eec \u6570\u636e\u9a71\u52a8 \u91cc\u9762\u7684\u6570\u636e\u3002 \u524d\u7f6eSQL\u8bed\u53e5 \u524d\u7f6esql\u91cc\u9762\u67e5\u8be2\u4e86\u6635\u79f0like name(\u8fd9\u4e2a\u662f\u4e2a\u53d8\u91cf)\u7684\u6570\u636e \u4e3a\u4ec0\u4e48\u8981\u505a\u8fd9\u6b65\uff0c\u662f\u4e3a\u4e86\u540e\u9762 \u65ad\u8a00 \u7684\u8003\u8651\u3002 \u4e3b\u4f53\u7528\u4f8b \u4e3b\u4f53\u7528\u4f8b\u7684\u903b\u8f91\u4e00\u76ee\u4e86\u7136: \u66ff\u6362\u5168\u5c40\u53d8\u91cf\uff0c\u628ablog_url\u53d8\u4e3a\u771f\u5b9e\u8bf7\u6c42\u5730\u5740 \u6267\u884c\u524d\u7f6e\u7528\u4f8b->\u767b\u5f55case\uff0c\u5e76\u628ausername\u548cpassword\u4f20\u5165 \u53d6\u5230\u524d\u7f6e\u7528\u4f8b\u7684SESSIONID \u6267\u884c\u6d4b\u8bd5SQL\uff0c\u53d6\u5230nickname like name\u7684\u7528\u6237\u4fe1\u606f \u8bf7\u6c42\u67e5\u8be2\u7528\u6237\u63a5\u53e3 \u65ad\u8a00\uff0c\u770b\u7ed3\u679c\u662f\u4e0d\u662f\u548c\u6570\u636e\u5e93\u67e5\u51fa\u6765\u7684\u6570\u91cf\u4e00\u81f4 \u65ad\u8a00\u90e8\u5206 \u65ad\u8a00\u91cc\u9762\u628asql_data\u7684count\uff08\u6570\u91cf\uff09\u53d6\u51fa\u6765\uff0c\u548cresponse\uff08\u63d0\u524d\u77e5\u9053\u8fd4\u56de\u4e00\u4e2ajson\u6570\u7ec4\uff09\u7684\u6570\u91cf\u8fdb\u884c \u957f\u5ea6\u5bf9\u6bd4 \u3002 \u603b\u7ed3\u4e00\u4e0b\u9700\u8981\u4f20\u5165\u7684\u53d8\u91cf username \u767b\u5f55\u7528\u6237\u540d password \u767b\u5f55\u5bc6\u7801 name \u67e5\u8be2\u7684\u7528\u6237 \u770b\u770b\u6570\u636e\u7ba1\u7406 \u53ef\u4ee5\u770b\u5230\u8fd9\u4e9b\u6570\u636e\u90fd\u5df2\u7ecf\u5728\u6570\u636e\u9a71\u52a8\u914d\u7f6e\u597d\u4e86 \u6267\u884c\u7528\u4f8b \u7531\u4e8e\u6267\u884c\u8fd9\u5757\u6211\u4eec\u8fd8\u6ca1\u5f7b\u5e95\u4fee\u590d\uff0c\u53ea\u4fee\u590d\u4e86\u6279\u91cf\u6267\u884c\u7684\uff0c\u6211\u4eec\u53bb\u6279\u91cf\u6267\u884c\u4e00\u4e0b\u3002 \u8fd9\u91cc\u6267\u884c\u7684\u662f\u6307\u5b9a\u7684fat\u73af\u5883\uff0c\u540e\u7eed\u4f1a\u63d0\u4f9b\u9009\u9879\u9009\u62e9\u6267\u884c\u4ec0\u4e48\u73af\u5883\u7684case \u770b\u4e0b\u62a5\u544a: \u90fd\u62a5\u9519\u4e86\uff0c\u770b\u770b\u65e5\u5fd7 \u770b\u770b\u65ad\u8a00\u4fe1\u606f \u770b\u4e86\u4e0b\uff0c\u65ad\u8a00\u91cc\u9762\u9884\u671f\u7ed3\u679c\u5e94\u8be5\u662f0\uff0c\u4f46\u5b9e\u9645\u7ed3\u679c\u67099\u6761\u3002 \u53ef\u4ee5\u770b\u5230\u8fd4\u56de\u4e86\u5f88\u591a\u6570\u636e\uff0c\u5176\u5b9e\u6211 \u67e5\u8be2\u7684 \u7684name\u662f\u4e00\u4e2a\u6211\u778e\u7f16\u7684\uff0c\u4f46\u8fd9\u4e2a\u63a5\u53e3\u8fd8\u662f\u8fd4\u56de\u4e869\u6761\u6570\u636e\uff0c\u4e5f\u5c31\u662f\u8bf4 \u6d4b\u8bd5\u5931\u8d25 \u4e86\u3002 \u6211\u4eec\u518d\u770b\u770b\u6570\u636e\u5e93\u7684\u6267\u884c\u8bb0\u5f55: \u53ef\u4ee5\u770b\u5230\u53d8\u91cf\u5df2\u7ecf \u7075\u6d3b\u8f6c\u53d8 \u4e86\u3002 \u518d\u770b\u770b\u8111\u56fe\u90e8\u5206: \u603b\u4f53\u6765\u8bf4\uff0c \u5b8c\u6574\u7684\u6d41\u7a0b \u5df2\u7ecf\u8d70\u5b8c\u4e86\u3002\u5728\u53c2\u6570\u66ff\u6362\u90e8\u5206\uff0c\u786e\u5b9e\u51fa\u73b0\u4e86\u4e00\u4e9b\u6027\u80fd\u635f\u8017\uff0c\u4f46\u6ca1\u6709\u5173\u7cfb\uff0c\u603b\u4f53\u6765\u8bf4\u8fd8\u662f\u4e0d\u7b97\u6162\u7684\u3002 \u4eca\u5929\u7684\u5185\u5bb9\u5c31\u5206\u4eab\u5230\u8fd9\u91cc\u4e86\uff0c\u4e0b\u4e00\u8282\u4ecb\u7ecd\u6211\u4eec\u521a\u624d\u6ca1\u6709\u63d0\u5230\u7684\u65ad\u8a00\u90e8\u5206: \u957f\u5ea6\u7b49\u4e8e \u3002","title":"69.\u6570\u636e\u6784\u9020\u5668\u652f\u6301sql\u8bed\u53e5"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%287%29%20%E6%94%B9%E9%80%A0%E6%B3%A8%E5%86%8C%E6%8E%A5%E5%8F%A3/","text":"\u5f15\u5165jwt\u6539\u9020\u6ce8\u518c\u63a5\u53e3 \u56de\u987e \u8fd8\u8bb0\u5f97\u6211\u4eec\u4e4b\u524d\u7f16\u5199\u4e86\u4e00\u4e2a register \u63a5\u53e3\u5417\uff1f\u53ef\u90a3\u53ea\u662f\u4e2a\u7a7a\u58f3\uff0c\u76f4\u63a5\u8fd4\u56de\u4e86 \u6ce8\u518c\u6210\u529f \u7684\u54cd\u5e94\u4f53\u3002 \u8fd9\u4e0d\u7981\u8ba9\u6211\u60f3\u8d77\u4ee5\u524d\u5728\u67d0\u5feb\u9012\u7f51\u7ad9\u4e0a\uff0c\u70b9\u51fb \u50ac\u5355 \u6309\u94ae\uff0c\u5bf9\u65b9\u76f4\u63a5\u5f39\u51fa \u50ac\u5355\u6210\u529f \u7684alert\u63d0\u793a\u3002\u4f46\u6211\u6253\u5f00\u4e86\u4ed6\u7684html\u4ee3\u7801\uff0c\u53d1\u73b0\u53ea\u8981\u70b9\u51fb\u8fd9\u4e2a\u6309\u94ae\u5c31\u4f1a\u5f39\u51fa\u63d0\u793a\uff0c\u6ca1\u6709\u4efb\u4f55\u540e\u7aef\u7684\u4ea4\u4e92\uff0c\u8fd9\u91cc\u6211\u5c31\u4e0d\u70b9\u540d\u8fd9\u4e2a\u97f5\u8fbe\u5feb\u9012\u4e86\u54c8\u3002\u53ea\u80fd\u8bf4\u771f\u7684\u5f88\u79c0~ \u77e5\u8bc6\u51c6\u5907 cookie\u548csession \u4f20\u7edf\u7684web\u8f6f\u4ef6\uff0c\u9700\u8981\u5b58\u50a8\u7528\u6237\u7684\u767b\u5f55\u4fe1\u606f\u3002cookie\u548csession\u662f\u6bd4\u8f83\u5e38\u89c1\u7684\u6a21\u5f0f\uff0c\u5f53\u7136\u4e5f\u662f\u6bd4\u8f83\u53e4\u8001\u7684\u6a21\u5f0f\u3002\u5176\u4e2dcookie\u4e3b\u8981\u4f9d\u8d56\u4e8e\u5ba2\u6237\u7aef\uff0c\u53ef\u4ee5\u7b80\u5355\u7684\u8bf4\u662f\u6d4f\u89c8\u5668\u3002\u53ef\u4ee5\u8bf4\u7528\u6237\u7684\u767b\u5f55\u4fe1\u606f\uff0c\u5b58\u50a8\u5728\u6d4f\u89c8\u5668\u7684localstorage\u4e2d\u3002\u800csession\uff0c\u987e\u540d\u601d\u4e49\uff0c\u5b83\u662f\u5c06\u7528\u6237\u5b58\u50a8\u4e8e\u670d\u52a1\u5668\u4e2d\u3002\u66f4\u597d\u7684\u89e3\u91ca\u8bf7\u81ea\u884c\u767e\u5ea6\u3002\u3002 token token\u4ece\u5e7f\u4e49\u8bf4\u7684\u8bdd\uff0c\u662f\u4ee4\u724c\u7684\u610f\u601d\u3002\u6211\u8fd9\u91cc\u662fjson web token(JWT)\u7684\u7b80\u5199\u3002\u7b80\u5355\u7684\u8bf4\uff0c\u5c31\u662f\u4e00\u79cd\u901a\u8fc7\u5b58\u50a8\u7528\u6237\u4fe1\u606f(\u4ee5base64\u7f16\u7801\u5b58\u50a8)\u7136\u540e\u9700\u8981\u7684\u65f6\u5019\u5c06\u4e4b\u89e3\u6790\u7684\u65b9\u6cd5\u3002\u8fd9\u6837\u5c31\u8fbe\u5230\u4f60\u8fd9\u4e2a\u7528\u6237\u6240\u6709\u4fe1\u606f\u90fd\u88ab\u5b58\u50a8\u4e3a\u4e00\u4e2a\u5b57\u7b26\u4e32\u800c\u4e14\u4e5f\u770b\u4e0d\u5230\u5177\u4f53\u5185\u5bb9\u7684\u76ee\u7684\u3002\u611f\u5174\u8da3\u7684\u540c\u5b66\u53ef\u4ee5\u53bb\u770b\u770b~~ Python\u4e2d\u7684JWT Python\u81ea\u5e26\u4e86jwt\uff0c\u73b0\u5728\u54b1\u4eec\u6765\u719f\u6089\u4e00\u4e0b\u76f8\u5173\u7684\u65b9\u6cd5\u3002 \u5148\u7ed9\u51fa\u6211\u5728 pity/middleware/Jwt.py \u4e2d\u7684\u5b9e\u73b0 import hashlib from datetime import timedelta, datetime import jwt from jwt.exceptions import ExpiredSignatureError EXPIRED_HOUR = 3 class UserToken (object) : key = 'pityToken' salt = 'pity' @staticmethod def get_token (data) : new_data = dict({ \"exp\" : datetime.utcnow() + timedelta(hours=EXPIRED_HOUR)}, **data) return jwt.encode(new_data, key=UserToken.key).decode() @staticmethod def parse_token (token) : try : return jwt.decode(token, key=UserToken.key) except ExpiredSignatureError: raise Exception( \"token\u5df2\u8fc7\u671f, \u8bf7\u91cd\u65b0\u767b\u5f55\" ) @staticmethod def add_salt (password) : m = hashlib.md5() m.update(password + UserToken.salt) return m.hexdigest() UserToken\u7c7b\u67093\u4e2a\u65b9\u6cd5\uff0c\u7b2c\u4e00\u4e2a\u65b9\u6cd5\u5462\uff0c\u5c31\u662f\u628a\u7528\u6237\u4fe1\u606f\u538b\u7f29\u6210\u4e00\u4e32\u5b57\u7b26\u4e32\uff0c\u5e76\u9644\u5e26 3\u5c0f\u65f6 \u7684\u8fc7\u671f\u65f6\u95f4\u3002 \u7b2c\u4e8c\u4e2a\u5c31\u662f\u89e3\u6790token\u4e3a\u4e4b\u524d\u7684\u7528\u6237\u4fe1\u606f\u3002 \u7b2c\u4e8c\u4e2a\u65b9\u6cd5add_salt\u662f\u4e3a\u4e86\u80fd\u591f\u7528md5\u7801\u53bb\u5b58\u50a8\u7528\u6237\u5bc6\u7801\uff0c\u4e00\u65e6\u6709\u90aa\u6076\u52bf\u529b\u62ff\u5230\u6570\u636e\u5e93\u5bc6\u7801\u7684\u8bdd\uff0c\u4e0d\u81f3\u4e8e\u4f1a\u66b4\u9732\u7528\u6237\u7684\u5bc6\u7801\uff0c add_salt \u5c31\u662f\u52a0\u76d0\u7684\u610f\u601d\uff0c\u5982\u679c\u4f60\u8981\u53cd\u7834\u89e3md5\u7801\uff0c\u563f\u563f\uff0c\u6211\u8fd9\u91cc\u7ed9\u4f60\u52a0\u4e86\u4e00\u5c42\u4f60\u60f3\u8c61\u4e0d\u5230\u7684\u4e1c\u897f\uff0c\u6240\u4ee5\u76f8\u5bf9\u6765\u8bf4\u8fd8\u662f\u6bd4\u8f83\u5b89\u5168\u7684\u5462\u3002 \u7f16\u5199\u6838\u5fc3\u65b9\u6cd5 \u4ed4\u7ec6\u60f3\u4e00\u4e0b\uff0c\u6211\u4eec\u7684\u7528\u6237\u5982\u679c\u9700\u8981\u6ce8\u518c\u7684\u8bdd\uff0c\u7b2c\u4e00\u6b65\u662f\u5148\u5224\u65ad\u8fd9\u4e2a\u8d26\u53f7\u662f\u5426\u5df2\u7ecf\u6ce8\u518c\u8fc7\u4e86\u3002\u597d\uff0c\u90a3\u6211\u4eec\u6765\u7f16\u5199\u7b2c\u4e00\u4e2a\u65b9\u6cd5: register_user \u3002 \u6211\u4eec\u65b0\u5efa dao/auth/UserDao.py from sqlalchemy import or_ from app.middleware.Jwt import UserToken from app.models import db from app.models.user import User from app.utils.logger import Log class UserDao (object) : log = Log( \"UserDao\" ) @staticmethod def register_user (username, name, password, email) : \"\"\" :param username: \u7528\u6237\u540d :param name: \u59d3\u540d :param password: \u5bc6\u7801 :param email: \u90ae\u7bb1 :return: \"\"\" try : users = User.query.filter(or_(User.username == username, User.email == email)).all() if users is not None : raise Exception( \"\u7528\u6237\u540d\u6216\u90ae\u7bb1\u5df2\u5b58\u5728\" ) # \u6ce8\u518c\u7684\u65f6\u5019\u7ed9\u5bc6\u7801\u52a0\u76d0 pwd = UserToken.add_salt(password) user = User(username, name, pwd, email) db.session.add(user) db.session.commit() except Exception as e: UserDao.log.error( f\"\u7528\u6237\u6ce8\u518c\u5931\u8d25: {str(e)} \" ) return str(e) return None \u6ce8\u610f\uff0cUser.query.filter\u8fd9\u884c\u4ee3\u7801\u7684\u610f\u601d\u662f\uff0c\u627e\u51fa\u6240\u6709username\u6216email\u5df2\u7ecf\u5b58\u5728\u7684\u7528\u6237\uff0c\u5982\u679c\u6709\uff0c\u5219\u629b\u51fa\u5f02\u5e38\uff0c\u6ca1\u6709\u5219\u76f4\u63a5\u901a\u8fc7orm\u63d2\u5165\u8fd9\u884c\u6570\u636e\u3002 \u5728orm\u7684\u4e16\u754c\u91cc\uff0c\u6211\u4eec\u5b9e\u4f8b\u5316\u7684user\u5bf9\u8c61\u5c31\u662f\u6570\u636e\u8868\u4e2d\u7684\u4e00\u884c\u6570\u636e\uff0c\u8fd9\u6837\u7406\u89e3\u4f1a\u5426\u66f4\u6e05\u6670\u4e00\u70b9\u5462\uff1f \u6539\u9020\u6ce8\u518c\u63a5\u53e3 \u53ef\u4ee5\u770b\u5230\u8fd9\u4e2a\u65b9\u6cd5\u5f88\u7a7a\u6d1e\uff0c\u6211\u4eec\u9700\u8981\u505a\u4ec0\u4e48\u5462\u3002 \u9996\u5148\u6211\u4eec\u662f\u4e0d\u662f\u5f97\u63a5\u6536\u4f20\u5165\u7684\u7528\u6237\u540d/\u5bc6\u7801/\u90ae\u7bb1\u7b49\u6ce8\u518c\u4fe1\u606f\uff0c\u5bf9\u53c2\u6570\u8fdb\u884c\u4e00\u4e9b\u5173\u952e\u6821\u9a8c\uff0c\u7136\u540e\u8c03\u7528\u521a\u624d\u7684\u6838\u5fc3\u65b9\u6cd5\u3002\u5982\u679c\u4e0d\u51fa\u9519\u7684\u8bdd\uff0c\u54b1\u4eec\u7684\u767b\u5f55\u65b9\u6cd5\u5c31\u5199\u597d\u4e86~ \u6821\u9a8c\u53c2\u6570 Flask\u901a\u8fc7 request.get_json() \u53ef\u4ee5\u76f4\u63a5\u83b7\u53d6\u5230\u4f20\u5165\u7684json\u6570\u636e\uff0c\u5e76\u8fd4\u56de\u4e00\u4e2adict\u5bf9\u8c61\u3002 PS: \u8fd9\u4e48\u5199\u6bd4\u8f83\u4e11\u964b\uff0c\u6682\u65f6\u5148 \u5fcd\u5fcd \uff0c\u540e\u7eed\u6211\u4eec\u518d\u8fdb\u884c\u6539\u9020\u3002 \u5f15\u5165\u6838\u5fc3\u65b9\u6cd5 \u53ea\u662f\u5bfc\u5165\u4e86UserDao\u6a21\u5757\u5e76\u8c03\u7528\u4e86register\u65b9\u6cd5\uff0c\u5982\u679cerr\u4e0d\u4e3a\u7a7a\uff0c\u5c31\u8fd4\u56decode=110\uff0c \u610f\u601d\u662f\u62a5\u8b66\u4e86(\u62a5\u9519\u4e86) \u8bf4\u660e\u4e00\u4e0b\uff0ccode=101\u662f\u53c2\u6570\u9519\u8bef\uff0c110\u662f\u5f02\u5e38\u9519\u8bef, 0\u662f\u6b63\u5e38\u8fd4\u56de\u3002 \u6ce8\u610f\uff0c\u8fd9\u4e0d\u662f\u4ec0\u4e48\u5b98\u65b9\u7684\u89c4\u5b9a\uff0c\u662f\u6211\u4e00\u65f6\u5174\u8d77\u54c8\u54c8\uff0c\u4ee5\u540e\u90fd\u4f1a\u6309\u7167\u8fd9\u4e2a\u7ea6\u5b9a\u6765\u3002 \u5b8c\u6574\u4ee3\u7801: \u7b80\u5355\u5730\u6d4b\u8bd5\u4e00\u4e0b \u542f\u52a8\u670d\u52a1 \u53ef\u4ee5\u770b\u5230\uff0c\u51fa\u73b0\u4e86\u5faa\u73af\u5f15\u7528\u7684\u95ee\u9898\uff0c\u539f\u6765\u6211\u4eec\u5728app/ init .py\u91cc\u9762\u5f15\u5165\u4e86controller\uff0c\u5728controller\u91cc\u9762\u53c8\u5f15\u5165\u4e86model\uff0c\u5728model\u91cc\u9762\u53c8\u5f15\u5165\u4e86app/ init .py\u91cc\u9762\u7684pity\u5bf9\u8c61\uff0c\u6240\u4ee5\u51fa\u73b0\u4e86\u5faa\u73af\u5f15\u7528\u3002 \u89e3\u51b3\u7684\u65b9\u6cd5\u5f88\u7b80\u5355\uff1a\u6211\u4eec\u628a\u6ce8\u518c\u84dd\u56fe\u8fd9\u79cd\u810f\u6d3b\u7d2f\u6d3b\u90fd\u653e\u5230run.py\uff0c\u4ed6\u662f\u6700\u5916\u5c42\uff0c\u6ca1\u6709\u4eba\u5f15\u5165run.py\u7684\u4e1c\u897f\u3002 \u6539\u52a8\u540e\u7684app/ init .py\uff1a from flask import Flask from config import Config pity = Flask(__name__) pity.config.from_object(Config) run.py: from datetime import datetime from app import pity from app.utils.logger import Log from app.controllers.auth.user import auth # \u6ce8\u518c\u84dd\u56fe pity.register_blueprint(auth) @pity.route('/') def hello_world () : log = Log( \"hello world\" ) log.info( \"\u6709\u4eba\u8bbf\u95ee\u4e86\u4f60\u7684\u7f51\u7ad9\u4e86\" ) now = datetime.now().strftime( \"%Y-%M-%d %H:%M:%S\" ) print(now) return now if __name__ == \"__main__\" : pity.run( \"0.0.0.0\" , threaded= True , port= \"7777\" ) \u6253\u5f00postman\u6d4b\u8bd5\u4e00\u4e0b: \u4e0d\u5bf9\u52b2\u7684\u4e8b\u60c5\u53c8\u53d1\u751f\u4e86\uff0c\u597d\u6c14\u5440\uff01\u4f46\u662f\u54b1\u4eec\u4e0d\u614c\uff0c\u4ed4\u7ec6\u770b\u4e00\u4e0b\u8fd9\u4e2a\u62a5\u9519\uff0c\u8bf4\u7684\u662f405http\u65b9\u6cd5\u4e0d\u5141\u8bb8\uff0c\u627e\u5230\u6211\u4eec\u5199\u7684\u63a5\u53e3: \u539f\u6765\u662f\u8fd9\u91cc\u51fa\u4e86\u95ee\u9898\uff0c\u6211\u4eec\u7a0d\u7a0d\u6539\u52a8\u4e00\u4e0b\uff0c\u5c06\u8bf7\u6c42\u65b9\u5f0f\u6539\u6210 post \u5373\u53ef\u3002 \u91cd\u542f\u670d\u52a1 try again \u5947\u602a\u4e86\uff0c\u660e\u660e\u6ca1\u6709\u6ce8\u518c\u8fc7\u8fd9\u4e2a\u7528\u6237\uff0c\u5374\u63d0\u793a\u4e86\u8fd9\u4e2a\uff0c\u9996\u5148\u6211\u4eec\u68c0\u67e5\u4e00\u4e0b\u6570\u636e\u5e93: \u53d1\u73b0\u6570\u636e\u5e93\u4e5f\u6ca1\u95ee\u9898\uff0c\u90a3\u4e48\u6211\u4eec\u4f7f\u51fa\u5927\u62db\uff0c \u65ad\u70b9\u7597\u6cd5 : \u6b64\u5904\u70b9\u4e00\u4e0b\u4f1a\u51fa\u73b0\u4e00\u4e2a\u7ea2\u8272\u5c0f\u5706\u5f62\uff0c\u518d\u6b21\u8bf7\u6c42: \u539f\u6765\u5982\u6b64\uff0c\u6211\u4eec\u7684\u5224\u65ad\u9664\u4e86\u95ee\u9898\uff0c\u8fd4\u56de\u7684\u662f\u4e2a\u7a7a\u6570\u7ec4\uff0c\u5f53\u7136\u4e0d\u662fNone\u4e86\uff0c\u6240\u4ee5\u54b1\u4eec\u9700\u8981\u4fee\u6539\u4e0b\u6821\u9a8c\u65b9\u5f0f: \u91cd\u542f\u540e\u7ee7\u7eed\u5c1d\u8bd5: \u8fd9\u4e2a\u6211\u770b\u51fa\u6765\u4e86\uff0c\u8fd9\u4e00\u5b9a\u662fmd5\u90a3\u5757\u51fa\u4e86\u95ee\u9898\uff0c\u4ed4\u7ec6\u627e\u4e0b\u539f\u56e0\u5427\u3002 (\u592a\u7279\u4e48\u81ea\u4fe1\u4e86\uff0c\u5bfc\u81f4\u524d\u9762\u7684\u56fe\u61d2\u5f97\u6539\uff0c\u53ea\u80fd\u8fb9\u5199\u8fb9\u4fee\u6539\u4e86\uff0c\u4ee5\u540e\u5c31\u4e0d\u4f1a\u8fd9\u6837\u76f4\u64ad\u5199\u4e86\uff0c\u5199\u597d\u4e86\u76f4\u63a5\u4e0a\u4ee3\u7801\u5373\u53ef\u3002) \u770b\u62a5\u9519\u7684\u610f\u601d\u662f\uff0cunicode\u5fc5\u987bhash\u6210bytes\uff0c\u591a\u5927\u70b9\u4e8b: \u76f4\u63a5\u5229\u7528api: \u91cd\u542f\u540e\u7ee7\u7eed\u5c1d\u8bd5: \u771f\u4e0d\u5bb9\u6613\uff0c\u54b1\u4eec\u68c0\u67e5\u4e0b\u6570\u636e\u5e93: \u6709\u4e86\uff0c\u6ce8\u610f\u5bc6\u7801\u4e5f\u4e0d\u662f\u660e\u6587\u54e6 \u68c0\u67e5\u4e0b\u91cd\u590d\u6ce8\u518c\u95ee\u9898(\u518d\u6b21\u8bf7\u6c42\u4e00\u6b21) \u65f6\u95f4\u4e0d\u65e9\u4e86\uff0c\u4eca\u5929\u7684\u5185\u5bb9\u5c31\u5230\u8fd9\u4e86\uff0c\u6253\u70ca\u4e86\u6253\u70ca\u4e86\uff0c\u75af\u72c2\u5199bug\uff01\uff01\uff01 \u5e7f\u544a\u65f6\u95f4 \u540e\u7aef\u4ee3\u7801\u5730\u5740: https://github.com/wuranxu/pity \u524d\u7aef\u4ee3\u7801\u5730\u5740: https://github.com/wuranxu/pityWeb \u6b22\u8fce\u5173\u6ce8\u516c\u4f17\u53f7 \u6d4b\u8bd5\u5f00\u53d1\u5165\u5751 \uff0c\u8fd8\u6709\u52a0\u7fa4\u4e00\u8d77\u8ba8\u8bba\u76f8\u5173\u95ee\u9898\u5440\uff01\u5982\u679c\u7fa4\u4e8c\u7ef4\u7801\u8fc7\u671f\u4e86\uff0c\u53ef\u4ee5\u52a0\u6211\u4e2a\u4eba\u5fae\u4fe1: wuranxu \u6211\u62c9\u4f60\u8fdb\u7fa4~ \u89c9\u5f97\u6709\u7528\u7684\u8bdd\u53ef\u4ee5\u5e2e\u5fd9\u70b9\u4e2aStar\u54e6QAQ","title":"7.\u6539\u9020\u6ce8\u518c\u63a5\u53e3"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2870%29%20%E4%B8%B0%E5%AF%8C%E6%96%AD%E8%A8%80%E7%B1%BB%E5%9E%8B/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684\u5b8c\u6574 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u6d4b\u8bd5\u5f00\u53d1\u5751\u8d27 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \ud83c\udf66 \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u652f\u6301\u4e86 SQL\u7c7b\u578b \u7684\u6784\u9020\u65b9\u6cd5\u3002 \u63a5\u4e0b\u6765\u6211\u4eec\u8981\u8bb2\u7684\u662f\u5982\u4f55 \u4e30\u5bcc \u6211\u4eec\u7684\u65ad\u8a00\u7c7b\u578b\u3002 \ud83d\udcd2 \u57fa\u7840\u65ad\u8a00 \u6211\u4eec\u4e4b\u524d\u7684\u65ad\u8a00\u90e8\u5206\u8fd8\u662f\u6bd4\u8f83\u6b8b\u7f3a\u7684\uff0c\u5c31\u597d\u50cf \u8f9f\u90aa\u5251\u8c31 \u4e00\u6837\u3002\u4eca\u5929\u6211\u4eec\u5c31\u6765\u5c3d\u91cf\u5b8c\u5584\u4e0b\u65ad\u8a00\u7684\u5185\u5bb9\u3002 \u5148\u770b\u770b\u4e4b\u524d\u7684\u65ad\u8a00\u7c7b\u578b: \u7b49\u4e8e \u4e0d\u7b49\u4e8e \u5c5e\u4e8e \u4f46\u8fd9\u4e9b\u5f80\u5f80\u8fd8\u4e0d\u591f\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u65b0\u589e\u4e00\u4e9b\u3002\u8fd8\u8bb0\u5f97\u6211\u4eec\u4e4b\u524d\u5199\u7684 \u5982\u4f55\u6bd4\u5bf92\u4e2aJSON\u5bf9\u8c61 \u5417\uff1f\u6211\u4eec\u4eca\u5929\u4e5f\u8981\u628a\u5b83\u8fd0\u7528\u5230\u5b9e\u6218\u91cc\u9762\u3002 \ud83d\udcd2 \u7f16\u5199utils/json_compare.py \u7531\u4e8e\u4e4b\u524d\u5df2\u7ecf\u8bb2\u8fc7json\u5bf9\u6bd4\u7684\u601d\u8def\uff0c\u6240\u4ee5\u8fd9\u8fb9\u8d34\u4e00\u4e0b\u6e90\u7801\uff0c\u5e76\u628aJsonCompare\u7c7b\u8fdb\u884c\u5355\u4f8b\u5305\u88c5\u3002 import json from app.utils.decorator import SingletonDecorator @SingletonDecorator class JsonCompare (object) : def compare (self, exp, act) : ans = [] self._compare(exp, act, ans, '' ) return ans def _compare (self, a, b, ans, path) : a = self._to_json(a) b = self._to_json(b) if type(a) != type(b): ans.append( f\" {path} \u7c7b\u578b\u4e0d\u4e00\u81f4, \u5206\u522b\u4e3a {type(a)} {type(b)} \" ) return if isinstance(a, dict): keys = [] for key in a.keys(): pt = path + \"/\" + key if key in b.keys(): self._compare(a[key], b[key], ans, pt) keys.append(key) else : ans.append( f\" {pt} \u5728\u5b9e\u9645\u7ed3\u679c\u4e2d\u4e0d\u5b58\u5728\" ) for key in b.keys(): if key not in keys: pt = path + \"/\" + key ans.append( f\" {pt} \u5728\u5b9e\u9645\u7ed3\u679c\u4e2d\u591a\u51fa\" ) elif isinstance(a, list): i = j = 0 while i < len(a): pt = path + \"/\" + str(i) if j >= len(b): ans.append( f\" {pt} \u5728\u5b9e\u9645\u7ed3\u679c\u4e2d\u4e0d\u5b58\u5728\" ) i += 1 j += 1 continue self._compare(a[i], b[j], ans, pt) i += 1 j += 1 while j < len(b): pt = path + \"/\" + str(j) ans.append( f\" {pt} \u5728\u9884\u671f\u7ed3\u679c\u4e2d\u4e0d\u5b58\u5728\" ) j += 1 else : if a != b: ans.append( f\" {path} \u6570\u636e\u4e0d\u4e00\u81f4: {a} \" f\"!= {b} \" if path != \"\" else f\"\u6570\u636e\u4e0d\u4e00\u81f4: {a} != {b} \" ) def _color (self, text, _type= 0 ) : if _type == 0 : # \u8bf4\u660e\u662f\u7eff\u8272 return \"\"\"<span style=\"color: #13CE66\">{}</span>\"\"\" .format(text) return \"\"\"<span style=\"color: #FF4949\">{}</span>\"\"\" .format(text) def _weight (self, text) : return \"\"\"<span style=\"font-weight: 700\">{}</span>\"\"\" .format(text) def _to_json (self, string) : try : float(string) return string except : try : if isinstance(string, str): return json.loads(string) return string except : return string \ud83d\udcd2 \u6539\u5199\u65ad\u8a00\u65b9\u5f0f \u770b\u770b\u4e4b\u524d\u7684\u65ad\u8a00\u65b9\u5f0f: \u65b9\u5f0f\u6709\u70b9\u5c11\uff0c\u9700\u8981\u8865\u5145 \u56e0\u4e3a\u6211\u4eec\u4e5f\u4e0d\u53ef\u80fd\u8865\u5145\u5f88\u591a\u5185\u5bb9\uff0c\u6240\u4ee5\u6211\u4eec\u53ea\u6dfb\u52a0\u4e00\u4e9b \u5e38\u89c1\u7684 \u3002 \u6211\u4eec\u65b0\u589e\u4e00\u4e9b\uff0c \u5305\u542b/\u4e0d\u5305\u542b/\u5305\u542b\u4e8e/\u4e0d\u5305\u542b\u4e8e/\u957f\u5ea6\u7b49\u4e8e/\u957f\u5ea6\u5927\u4e8e/\u957f\u5ea6\u5c0f\u4e8e/JSON\u7b49\u4e8e \u8fd9\u6837\u7684\u6821\u9a8c\u65b9\u5f0f\u3002\u5e76\u4e14\u7528 emoji \u533a\u5206\u4e86\u662f\u5426\u6210\u529f\u3002 \u6765\u770b\u770b\u6548\u679c\u5427~ \u8fd9\u6837\u5c31 \u7a0d\u5fae\u4e30\u5bcc \u4e86\u54b1\u4eec\u7684\u65ad\u8a00\u624b\u6bb5\uff0c\u4f46\u6211\u4eec\u8fd8\u6709\u4e00\u4e9bJSON\u5305\u542b\u7b49\uff0c\u4ee5\u53ca \u6587\u672c\u6bd4\u5bf9\u76f8\u4f3c\u5ea6 \u65ad\u8a00\u7684\u65b9\u5f0f\u8fd8\u6ca1\u6d3e\u4e0a\u7528\u573a\uff0c\u4e4b\u540e\u6709\u673a\u4f1a\u518d\u7ed9\u5927\u5bb6\u5c55\u793a\u3002 \u4eca\u5929\u7684\u5185\u5bb9\u5c31\u5206\u4eab\u5230\u8fd9\u513f\u4e86\uff0c\u6709\u5174\u8da3\u7684\u670b\u53cb\u4eec\u53ef\u4ee5\u4e00\u8d77\u52a8\u624b\u5199\u8d77\u6765\u5440\uff01~ (\u672c\u671f\u5185\u5bb9\u6bd4\u8f83\u5c11\uff0c\u4e0b\u671f\u5e26\u6765\u91cd\u78c5\u7684 Python\u7684\u5b9a\u65f6\u4efb\u52a1\u7cfb\u5217 ) \u5728\u7ebf\u4f53\u9a8c\u5730\u5740: http://test.pity.fun \u524d\u7aef\u4ee3\u7801\u4ed3\u5e93: https://github.com/wuranxu/pityWeb \u540e\u7aef\u4ee3\u7801\u4ed3\u5e93: https://github.com/wuranxu/pity","title":"70.\u4e30\u5bcc\u65ad\u8a00\u7c7b\u578b"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2871%29%20Python%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E6%96%B9%E6%A1%88/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684\u5b8c\u6574 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u6d4b\u8bd5\u5f00\u53d1\u5751\u8d27 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \ud83c\udf66 \u5b9a\u65f6\u4efb\u52a1 \u5b9a\u65f6\u4efb\u52a1\uff0c\u987e\u540d\u601d\u4e49: \u5b9a\u65f6\u6267\u884c\u7684\u4efb\u52a1\uff0c\u53ef\u4ee5\u662f\u4e00\u6bb5bash\u547d\u4ee4\uff0c\u4e5f\u53ef\u4ee5\u662f\u4e00\u4e2a\u811a\u672c\u6587\u4ef6\u3002\u901a\u5e38\u7528\u4e8e\u6211\u4eec\u9700\u8981\u5728\u7279\u5b9a\u65f6\u523b\u505a\u4e8b\u60c5\u3002 \u4e3e\u4e2a\u4f8b\u5b50: \u6bcf\u665a8\u70b9\u6267\u884c\u5168\u4e1a\u52a1\u573a\u666f \u63a5\u53e3\u81ea\u52a8\u5316\u56de\u5f52\u6d4b\u8bd5 \uff0c\u53c8\u6216\u8005\u6bcf\u969420\u5206\u949f\u53bb\u4f60\u5bb6QQ\u519c\u573a\u5077\u83dc\uff01 \ud83c\udf66 Python\u7684\u5b9a\u65f6\u4efb\u52a1 \u5982\u679c\u662f\u5927\u4e2d\u578b\u516c\u53f8\uff0c\u4e00\u5b9a\u6709\u5bf9\u5e94\u7684 \u5e73\u53f0 \u8ba9\u5927\u5bb6\u63a5\u5165\u3002\u4e00\u822c\u8fd9\u6837\u7684\u5e73\u53f0\u7684\u540d\u5b57\u6216\u8005\u63cf\u8ff0\u90fd\u662f: \u5206\u5e03\u5f0f\u4efb\u52a1\u8c03\u5ea6\u5e73\u53f0 \u8fd9\u6837\u7684\u3002\u518d\u4e0d\u6d4e\u8fd8\u6709jenkins\u6ee1\u8db3\u6211\u4eec\u7684\u9700\u6c42~ \u60f3\u8d77\u535a\u4e3b\u4ee5\u524d\"\u5c0f\u65f6\u5019\"\uff08\u521a\u5de5\u4f5c\u7684\u65f6\u5019\uff09\uff0c\u516c\u53f8\u65e2\u6ca1\u6709\u7528 jenkins \uff0c\u4e5f\u6ca1\u6709\u8fd9\u6837\u7684\u5927\u5e73\u53f0\u53ef\u4ee5\u63a5\u5165\u3002\u6211\u662f\u600e\u4e48\u505a\u5b9a\u65f6\u4efb\u52a1\u7684\u5462\uff1f \u6765\u770b\u4e00\u6bb5\u4ee3\u7801: import time from datetime import datetime def func () : # \u8fd9\u4e2a\u662f\u5b9a\u65f6\u4efb\u52a1\u8981\u6267\u884c\u7684ui/\u63a5\u53e3\u81ea\u52a8\u5316\u65b9\u6cd5 pass def main () : while True : # \u83b7\u53d6\u5f53\u524d\u65f6\u95f4 now = datetime.now() if now.hour == 20 and now.minute == 0 : # \u5f53\u65f6\u95f4\u5230\u8fbe\u665a\u4e0a8\u70b90\u5206\uff0c\u6211\u4eec\u5c31\u5f00\u59cb\u8dd1\u81ea\u52a8\u5316\u4efb\u52a1\u5566 print( \"\u4efb\u52a1\u5f00\u59cb\u6267\u884c\" ) func() time.sleep( 60 ) if __name__ == \"__main__\" : main() \u4e0d\u77e5\u9053\u73b0\u5728\u662f\u5426\u8fd8\u6709\u4eba\u4f9d\u7136\u7528\u7740\u8fd9\u6837\u7684\u65b9\u5f0f \u5b9a\u65f6\u6267\u884c \u81ea\u52a8\u5316\u6d4b\u8bd5\uff0c\u65e2\u7136\u90fd2021\u5e74\u4e86\uff0c\u90a3\u54b1\u4eec\u8fd8\u662f\u5148\u8fdb\u70b9\u5427\u3002\u90a3\u4e48\u5b9a\u65f6\u4efb\u52a1\u5728Python\u4e2d\u8981\u600e\u4e48\u505a\u5462\uff1f\u63a5\u7740\u770b\u3002 \ud83d\udcd2 \u51e0\u79cd\u5e38\u89c1\u7684\u65b9\u6848 schedule \u5982\u679c\u4f60\u53ea\u662f \u4e0a\u9762\u63d0\u5230 \u7684 \u7b80\u5355 \u8bc9\u6c42\uff0c\u90a3\u6211\u5efa\u8bae\u76f4\u63a5\u4f7f\u7528 schedule \u5e93\u3002\u8fd9\u4e2a\u5e93\u6211\u4e2a\u4eba\u611f\u89c9\u662f \u5c0f\u5b66\u751f \u7248\u672c\u7684\u5347\u7ea7\u7248\uff0c\u5bf9\u4e8e\u6211\u90a3\u79cd\u5c40\u9650\u7684sleep\u4efb\u52a1\u505a\u4e86\u4e00\u4e9b\u6269\u5c55: \u652f\u6301\u4e86\u6309\u5468\u671f\u6267\u884c\u4efb\u52a1 \u6267\u884c\u65f6\u95f4\u9605\u8bfb\u8d77\u6765\u66f4\u4eba\u6027\u5316 \u8fd8\u652f\u6301\u661f\u671fX\u6267\u884c \u5b89\u88c5scheduler pip install schedule \u5b98\u7f51\u7ed9\u51fa\u7684\u4f8b\u5b50 import schedule import time # \u5b9a\u4e49\u4e00\u4e2a\u6267\u884c\u65b9\u6cd5 def job () : print( \"I'm working...\" ) # \u6bcf10\u5206\u949f\u6267\u884c\u4e00\u6b21job schedule.every( 10 ).minutes.do(job) # \u6bcf\u5c0f\u65f6\u6267\u884c\u4e00\u6b21job schedule.every().hour.do(job) # \u6bcf\u592910:30\u6267\u884cjob schedule.every().day.at( \"10:30\" ).do(job) # \u6bcf\u4e2a\u661f\u671f\u4e00\u6267\u884c\u4e00\u6b21 schedule.every().monday.do(job) # \u6bcf\u4e2a\u661f\u671f\u4e09\u768413:15\u6267\u884c\u4e00\u6b21 schedule.every().wednesday.at( \"13:15\" ).do(job) # \u5728\u6bcf\u5206\u949f\u768417\u79d2\u6267\u884c\u4e00\u6b21 schedule.every().minute.at( \":17\" ).do(job) while True : # \u8fdb\u5165schedule\u5faa\u73af schedule.run_pending() time.sleep( 1 ) \u53ef\u4ee5\u770b\u51fa\uff0capi\u5341\u5206\u7b80\u5355\uff0c\u8bed\u4e49\u4e5f\u5f88 \u6e05\u6670 \u3002\u57fa\u672c\u53ef\u4ee5\u6ee1\u8db3\u6211\u4eec\u7684\u9700\u6c42\u4e86~\u5982\u679c\u6211\u4eec\u53ea\u662f\u8981\u5b9a\u65f6\u53bb\u505a\u67d0\u4e9b\u4e8b\u60c5\u7684\u8bdd\uff0c\u6211\u60f3\u8fd9\u4e2a\u5e93\u975e\u5e38human\u3002 Jenkins \u8fd9\u4e2a\u5de5\u5177\u76f8\u6bd4\u5927\u5bb6\u90fd\u6709\u6240\u4e86\u89e3\u5427~jenkins\u662f\u4e00\u4e2a\u6bd4\u8f83\u5f3a\u5927\u7684\u8f6f\u4ef6\u4e86\uff0c\u5b83\u53ef\u4ee5\u6253\u901agit/svn\uff0c\u4e5f\u652f\u6301\u5b9a\u65f6\u4efb\u52a1\u7b49\u3002\u6709\u7740\u4e30\u5bcc\u7684\u63d2\u4ef6\uff0c\u6bd4\u5982 \u90ae\u4ef6 \uff0c\u662f\u4e00\u5957\u5b8c\u6574\u7684CI/CD\u89e3\u51b3\u65b9\u6848\u3002\u5bf9\u4e8e\u4efb\u52a1\u7684\u6267\u884c\u7ed3\u679c\u7684\u8bb0\u5f55\uff0c\u4e5f\u662f\u53ef\u8ffd\u6eaf\u7684\u3002\u4f30\u8ba1\u552f\u4e00\u7684\u7f3a\u70b9\u5c31\u662f\uff0c\u5f15\u5165\u4e86 \u989d\u5916\u7684\u7cfb\u7edf \u3002\u53ef\u80fd\u672c\u8eab\u6211\u53ea\u662f\u4e00\u4e2a\u81ea\u52a8\u5316\u6d4b\u8bd5\u6846\u67b6\uff0c\u73b0\u5728\u5374\u8981\u642d\u5efa\u4e00\u5957jenkins\u3002 \u5982\u679c\u5927\u5bb6\u6709\u4ee3\u7801\u6539\u52a8->\u6267\u884c\u5b9a\u65f6\u4efb\u52a1\u7c7b\u4f3c\u7684\u9700\u6c42\uff0c\u53c8\u9700\u8981\u5b8c\u5584\u7684\u6743\u9650\u63a7\u5236\u7cfb\u7edf\u7684\u8bdd\uff0c\u90a3jenkins\u4f1a\u662f\u4f60\u7684\u4e0d\u4e8c\u9009\u62e9\u3002 Celery \u6211\u5bf9\u8fd9\u5bb6\u4f19\u4e86\u89e3\u7684 \u4e0d\u592a\u591a \uff0c\u4f46python+celery\u4eff\u4f5b\u6210\u4e86\u4e00\u4e2a \u56fa\u5b9a\u642d\u914d \u3002\u4e0d\u77e5\u9053\u6211\u7406\u89e3\u7684\u5bf9\u4e0d\u5bf9: celery\u662f\u4e00\u4e2a\u4efb\u52a1\u961f\u5217\uff0c\u4f60\u53ef\u4ee5\u5236\u5b9a\u597d\u4efb\u52a1\u6267\u884c\u7684\u89c4\u5219\uff0c\u653e\u5165\u961f\u5217\u4e2d\uff0c\u4f1a\u6709\u4e13\u95e8\u7684\u6d88\u8d39\u7aef\u6765\u5e2e\u4f60\u6267\u884c\u8fd9\u4e9b\u4efb\u52a1\u3002 \u8bf4\u5230\u8fd9\u91cc\u5c31\u4e0d\u5f97\u4e0d\u63d0\u5230 \u6301\u4e45\u5316 \u4e86~ \ud83d\udcd2 \u9898\u5916\u8bdd\u4e4b\u6301\u4e45\u5316 \u4ec0\u4e48\u662f\u6301\u4e45\u5316\u5462\uff1f\u901a\u4fd7\u7684\u8bb2\uff0c\u5c31\u662f\u77ac\u65f6\u6570\u636e\uff08\u6bd4\u5982\u5185\u5b58\u4e2d\u7684\u6570\u636e\uff0c\u662f\u4e0d\u80fd\u6c38\u4e45\u4fdd\u5b58\u7684\uff09\u6301\u4e45\u5316\u4e3a\u6301\u4e45\u6570\u636e\uff08\u6bd4\u5982\u6301\u4e45\u5316\u81f3\u6570\u636e\u5e93\u4e2d\uff0c\u80fd\u591f\u957f\u4e45\u4fdd\u5b58\uff09 \u6211\u4eec\u53ef\u4ee5\u628a \u6570\u636e \u653e\u5230\u6587\u4ef6\u91cc\uff0c\u4e5f\u53ef\u4ee5\u653e\u5230\u6570\u636e\u5e93\uff08\u5b9e\u9645\u4e0a\u4e5f\u662f\u78c1\u76d8\u91cc\uff09\u8fdb\u884c\u6301\u4e45\u6027\u4fdd\u5b58\u3002 \u8fd9\u6837\u505a\u7684\u76ee\u7684: \u6570\u636e\u53ef\u4ee5\u5b58\u50a8\uff0c\u4e0b\u6b21\u4e5f\u8fd8\u80fd\u62ff\u5230\u8fd9\u4e9b\u6570\u636e\u3002 \u8fd9\u91cc\u9762\u7684\u5185\u5bb9\u592a\u591a\u4e86\uff0c\u6253\u7b97\u540e\u9762\u518d\u5f00\u4e00\u8282\u6765\u8bb2\u3002 \u6211\u4eec\u5728Python\u91cc\u9762\u7684\u53d8\u91cf\u554a\uff0c\u8fd9\u4e9b\u6570\u636e\u90fd\u662f\u5b58\u653e\u5728 \u5185\u5b58 \u5f53\u4e2d\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u521a\u624d\u7684schedule\u662f\u4e0d\u652f\u6301 \u6301\u4e45\u5316 \u7684\u3002\uff08\u4e5f\u53ef\u80fd\u662f\u6211\u6ca1\u7814\u7a76\u5230\uff09 \u90a3jenkins\u652f\u6301\u5417\uff1f\u4ed6\u662f\u652f\u6301\u7684\uff0c\u4f60\u60f3\uff0c\u4f60\u5efa\u7acb\u4e00\u4e2a\u9879\u76ee\uff0c\u91cc\u9762\u6709\u4e00\u4e9bjob\u7684\u914d\u7f6e\uff0c\u4ec0\u4e48\u65f6\u5019\u6267\u884c\uff0c\u6267\u884c\u4e86\u5e72\u561b\uff0c\u6700\u540e\u4fdd\u5b58\u3002 \u4e0a\u8ff0\u5c31\u662f\u4e00\u4e2a\u6301\u4e45\u5316\u7684\u8fc7\u7a0b\u3002 \u4f60\u4fdd\u5b58\u4e86\u6570\u636e\u4ee5\u540e\uff0c\u4e0b\u6b21\u80fd\u591f\u83b7\u53d6\u5230\u8fd9\u4e2a\u9879\u76ee\u7684\u4efb\u52a1\u4fe1\u606f\uff0c\u4e5f\u5c31\u662f\u8bf4\u4f60\u54ea\u6015\u91cd\u542f\u4e86jenkins\uff0c \u4efb\u52a1\u4f9d\u7136\u5b58\u5728 \u3002 \u8bf4\u660e \u4efb\u52a1 \u672c\u8eab\u4f5c\u4e3a\u4e86\u4e00\u6761\u6570\u636e\uff0c\u6301\u4e45\u5730\u4fdd\u5b58\u4e86\u8d77\u6765\u3002 ApScheduler \"APScheduler\u662f\u4e00\u4e2aPython\u5e93\uff0c\u53ef\u8ba9\u60a8\u5b89\u6392\u7a0d\u540e\u8981\u6267\u884c\u7684Python\u4ee3\u7801\uff0c\u53ea\u9700\u4e00\u6b21\u6216\u5b9a\u671f\u6267\u884c\u3002\u60a8\u53ef\u4ee5\u6839\u636e\u60a8\u6dfb\u52a0\u65b0\u7684\u4f5c\u4e1a\u6216\u5220\u9664\u65e7\u7684\u65e7\u4f5c\u4e1a\u3002\u5982\u679c\u60a8\u5728\u6570\u636e\u5e93\u4e2d\u5b58\u50a8\u5de5\u4f5c\uff0c\u4ed6\u4eec\u8fd8\u5c06\u5b58\u6d3b\u8c03\u5ea6\u7a0b\u5e8f\u91cd\u65b0\u542f\u52a8\u5e76\u4fdd\u6301\u72b6\u6001\u3002 \u91cd\u65b0\u542f\u52a8 \u8c03\u5ea6\u7a0b\u5e8f\u65f6\uff0c\u5b83\u5c06\u8fd0\u884c\u5b83\u5728\u8131\u673a1\u65f6\u5e94\u8be5\u8fd0\u884c\u7684\u6240\u6709\u4f5c\u4e1a\u3002\" \u8fd9\u662f\u6458\u81eaApScheduler\u5b98\u7f51\u7684\u4ecb\u7ecd\uff0c\u603b\u4f53\u6765\u8bf4\u5b83\u652f\u6301\u5bf9\u4efb\u52a1\u7684\u589e\u5220\u6539\u67e5(\u6301\u4e45\u5316)\uff0c\u4e5f\u80fd\u5f88\u597d\u5730\u652f\u6491 \u5b9a\u65f6\u4efb\u52a1 \u7684\u6267\u884c\u3002\u5b83\u76f8\u5bf9\u6765\u8bf4\u6bd4\u8f83\u8f7b\u91cf\uff0c\u4e0d\u50cfcelery\u90a3\u4e48\u590d\u6742\uff0c\u4e5f\u4e0d\u50cfschedule\u90a3\u4e48\u7b80\u964b\u3002\u7531\u4e8e\u6211\u4eec\u4e0d\u6253\u7b97\u5f15\u5165 jenkins \uff0c\u6240\u4ee5\u603b\u4f53\u6765\u8bf4\uff0cApScheduler\u7b97\u5f97\u4e0a\u662f\u54b1\u4eec\u6267\u884c\u5b9a\u65f6\u4efb\u52a1\u7684\u4e0d\u4e8c\u4e4b\u9009\u4e86\u3002 \u7531\u4e8e\u7bc7\u5e45\u7684\u539f\u56e0\uff0c\u4eca\u5929\u7684\u5185\u5bb9\u5c31\u4ecb\u7ecd\u5230\u8fd9\u5566~ \u4e0b\u4e00\u8282\u6211\u4eec\u5c31\u8be6\u7ec6\u4ecb\u7ecdApScheduler\u5728pity\u4e2d\u7684\u8fd0\u7528\u53ed \u3002","title":"71.Python\u5b9a\u65f6\u4efb\u52a1\u65b9\u6848"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2872%29%20%E4%BA%86%E8%A7%A3ApScheduler%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684\u5b8c\u6574 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u6d4b\u8bd5\u5f00\u53d1\u5751\u8d27 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \ud83d\udcd2 \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u8c03\u7814\u4e86\u4e00\u4e0b\u5e02\u9762\u4e0a\u7684 \u5b9a\u65f6\u4efb\u52a1 \u65b9\u6848\uff0c\u6700\u7ec8\u786e\u5b9a\u4e3a APScheduler \uff0c\u4f46\u636e\u8bf4\u5728 uvicorn \u4e0b\u8fd8\u6709\u4e00\u4e9b\u5751\u3002 \u6ca1\u5173\u7cfb\uff0c\u7b14\u8005\u4e5f\u662f\u5728\u6478\u7d22\u9636\u6bb5\u3002\u5982\u679c\u6709\u9047\u5230\u95ee\u9898\uff0c\u89e3\u51b3\u4e86\u4e5f\u53ef\u4ee5\u7ed9\u5927\u5bb6\u53c2\u8003\u3002 \u8fd9\u7bc7\u4e3b\u8981\u7ed9\u5927\u5bb6\u4ecb\u7ecd\u4e00\u4e0bAPScheduler\u7684\u57fa\u672c\u4fe1\u606f\u548c\u4f7f\u7528\u65b9\u6cd5\u3002 \ud83d\udcd2 \u56db\u4e2a\u540d\u8bcd \u5b98\u7f51\u8bb2\u7684\u5f88\u8be6\u7ec6 \u89e6\u53d1\u5668: \u5b9a\u65f6\u4efb\u52a1\u4ec0\u4e48\u65f6\u5019\u89e6\u53d1 \u5de5\u4f5c\u5546\u5e97: \u5b9a\u65f6\u4efb\u52a1\u5b58\u5728\u54ea\u91cc\uff0c\u5185\u5b58\uff1fMySQL?Redis? \u6267\u884c\u5668: \u6267\u884c\u4efb\u52a1\u7684\u7a0b\u5e8f \u8c03\u5ea6\u7a0b\u5e8f: \u4e0d\u540c\u4efb\u52a1\u4e4b\u95f4\u7684\u8c03\u5ea6\u7ba1\u7406\u7a0b\u5e8f\uff0c\u8fd8\u5305\u62ec\u4efb\u52a1\u7684\u6dfb\u52a0\u548c\u4fee\u6539\u7b49 \ud83d\udcd2 \u5b58\u50a8\u4ecb\u8d28 \u5728 \u4e0a\u4e00\u8282 \u6211\u4eec\u63d0\u5230\u4e86\u5b9a\u65f6\u4efb\u52a1\u6301\u4e45\u5316\u3002 \u90a3\u4e48\u5728APScheduler\u4e2d\u652f\u6301\u54ea\u4e9b \u5b58\u50a8\u4ecb\u8d28 \u5462\uff1f\u770b\u4e00\u5f20\u56fe: \u56fe\u4e2d\u5f88\u8be6\u7ec6 \u53ef\u4ee5\u770b\u5230\uff0c\u5b83\u652f\u6301\u591a\u79cd\u4ecb\u8d28\uff0c\u5305\u62ec\u6211\u4eec\u6700\u4e0d\u613f\u610f\u7528\u7684 memory(\u5185\u5b58) \u3002\u56e0\u4e3a\u5982\u679c\u670d\u52a1\u91cd\u542f\uff0c\u6570\u636e\u5c31\u90fd\u6ca1\u4e86\uff0c\u6240\u4ee5\u6211\u4eec\u4e0d\u8003\u8651\u4f7f\u7528\u8fd9\u4e2a\u3002 SQLAlchemy \u8fd9\u662f\u6211\u4eec\u5e38\u7528\u7684\u65b9\u6cd5\uff0c\u901a\u8fc7\u5b83\u53ef\u4ee5\u5199\u5165\u5230mysql\uff0c\u5728\u4e0d\u5f15\u5165\u5176\u4ed6\u7ec4\u4ef6\u7684\u60c5\u51b5\u4e0b\u5b8c\u5168\u53ef\u4ee5\u8003\u8651\u3002 MongoDB NoSQL\u7684\u4e00\u79cd\uff0c\u6bd4\u8f83\u65b9\u4fbf\uff0c\u6211\u4eec \u79c9\u7740\u4e0d\u989d\u5916\u589e\u52a0\u7ec4\u4ef6 \u7684\u4fe1\u5ff5\uff0c\u6682\u4e0d\u8003\u8651\u3002 Redis redis\u540e\u7eed\u6211\u4eec\u81ea\u8eab\u670d\u52a1\u4e5f\u9700\u8981\u7528\u5230\uff0c\u4f46\u628a\u5b83\u4f5c\u4e3a\u4e00\u4e2a\"\u6570\u636e\u5e93\"\u6765\u4f7f\u7528\uff0c\u8fd8\u5f97\u8003\u8651redis\u5907\u4efd\u7b49\u60c5\u51b5\uff0c\u5f53\u7136\u4f18\u70b9\u5c31\u662f\u4f1a\u6bd4mysql\u66f4\u5feb\u3002 \u81f3\u4e8e\u5176\u4ed6\u7684zk\uff0crethinkdb\uff0c\u7531\u4e8e\u6211\u4eec\u6682\u65f6\u4e5f\u4e0d\u4f1a\u5f15\u7528\uff0c\u6240\u4ee5\u4e0d\u5206\u6790\u4e86\u3002 \u7efc\u5408\u800c\u8a00\uff0c\u8fd8\u662f\u7528SQLAlchemy \u4ee3\u4ef7\u6700\u5c0f \uff0c\u6210\u672c\u6700\u4f4e\u3002 \ud83d\udcd2 \u8fd0\u884c\u6a21\u5f0f \u5728\u8fd0\u884cdemo\u7684\u8fc7\u7a0b\u4e2d\uff0c\u53d1\u73b0APScheduler\u5f88\u5f3a\u5927\uff0c\u53ef\u4ee5\u652f\u6301\u5404\u79cd\u5e76\u53d1\u6a21\u5f0f\u3002 \u91c7\u7528\u8c37\u6b4c\u7ffb\u8bd1 \u7ffb\u8bd1\u4e86\u4e00\u4e0b\uff0c\u73b0\u5728\u7684\u7ffb\u8bd1\u8f6f\u4ef6\u90fd\u5f88\u597d\u7528\u4e86 \u7531\u4e8e\u6211\u4eec\u662f\u5f02\u6b65Asycio\uff0c\u6240\u4ee5\u6211\u4eec\u9009\u62e9\u7b2c\u4e09\u79cd\u6267\u884c\u5668\u3002\u5176\u4ed6\u7684\u5305\u62ec Gevent \u7b49\u4e5f\u662fFlask/Django\u7b49\u6846\u67b6\u7684\u597d\u9009\u62e9\u3002 \ud83d\udcd2 \u4e86\u89e3\u57fa\u672cAPI \u914d\u7f6escheduler from apscheduler.jobstores.sqlalchemy import SQLAlchemyJobStore from apscheduler.schedulers.asyncio import AsyncIOScheduler # \u9009\u62e9job\u5b58\u50a8\u4ecb\u8d28\u4e3asqlalchemy job_store = { 'default' : SQLAlchemyJobStore(url=Config.SQLALCHEMY_DATABASE_URI) } # \u9009\u62e9\u8c03\u5ea6\u7a0b\u5e8f\u4e3aAsyncIOScheduler scheduler = AsyncIOScheduler() # \u914d\u7f6e\u597d\u5bf9\u5e94\u7684\u7a0b\u5e8f scheduler.configure(jobstores=job_store) # \u542f\u52a8 scheduler.start() \u6dfb\u52a0job # \u628a\u65b9\u6cd5: myfunc\u6dfb\u52a0\u5230\u5b9a\u65f6\u4efb\u52a1\uff0c\u6bcf2\u5206\u949f\u6267\u884c\u4e00\u6b21 scheduler.add_job(myfunc, 'interval' , minutes= 2 , id= 'my_job_id' ) \ud83d\udcd2 \u4e0epity\u7ed3\u5408 \u5728FastApi\u4e2d\uff0c\u6709\u4e2astartup\u7684\u94a9\u5b50\u65b9\u6cd5\uff0c\u610f\u5473\u7740\u5f53\u670d\u52a1\u542f\u52a8\u7684\u65f6\u5019\u4f1a\u81ea\u52a8\u6267\u884c\u8be5\u65b9\u6cd5\u3002\u6211\u4eec\u6765\u770b\u770b\u600e\u4e48\u7528\u7684: @pity.on_event\u610f\u601d\u662f\u76d1\u542c \u4e8b\u4ef6 \uff0c\u540e\u9762\u7684\u53c2\u6570: \"startup\"\u4ee3\u8868pity\u670d\u52a1\u542f\u52a8\u3002 \u4e5f\u5c31\u662f\u8bf4\uff0c\u5f53pity\u542f\u52a8\u7684\u65f6\u5019\uff0c\u5219 \u521d\u59cb\u5316 Scheduler\u3002 \u8fd9\u91cc\u6211\u5c01\u88c5\u4e86\u4e00\u4e2aScheduler\u7c7b\uff0c\u540e\u9762\u4f1a\u7ed9\u5927\u5bb6\u4ecb\u7ecd\u91cc\u9762\u7684\u5177\u4f53\u65b9\u6cd5\u3002 \u4e0b\u4e00\u8282\u6211\u4eec\u7f16\u5199 \u6d4b\u8bd5\u8ba1\u5212 \u76f8\u5173\u63a5\u53e3\uff0c\u5e76\u4e0eAPScheduler\u7ed3\u5408\u8d77\u6765\uff0c\u5b8c\u6210\u4e00\u6574\u5957\u5b9a\u65f6\u4efb\u52a1\u529f\u80fd\u3002","title":"72.\u4e86\u89e3ApScheduler\u57fa\u672c\u7528\u6cd5"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2873%29%20%E8%AE%BE%E8%AE%A1%E6%B5%8B%E8%AF%95%E8%AE%A1%E5%88%92%E5%8A%9F%E8%83%BD/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684\u5b8c\u6574 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u6d4b\u8bd5\u5f00\u53d1\u5751\u8d27 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \ud83d\udcd2 \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u7b80\u5355\u4ecb\u7ecd\u4e86\u4e0bAPScheduler\uff0c\u8fd9\u4e00\u8282\u6211\u4eec\u6765\u7f16\u5199 \u6d4b\u8bd5\u8ba1\u5212 \u76f8\u5173\u5185\u5bb9\u3002 \ud83d\udcd2 \u8bbe\u8ba1\u6d4b\u8bd5\u8ba1\u5212\u8868 \u6d4b\u8bd5\u8ba1\u5212\uff0c\u5176\u5b9e\u4e5f\u53ef\u4ee5\u53eb \u6d4b\u8bd5\u96c6\u5408 \uff0c\u5b83\u662f\u6211\u4eec\u4e00\u7ec4\u7528\u4f8b\u7684\u96c6\u5408\u3002\u5e76\u4e14\u6709\u7740\u5bf9\u5e94\u7684\u7279\u5f81: \u5b9a\u65f6\u6267\u884c \u6267\u884c\u5b8c\u6bd5\u540e\u901a\u77e5\u65b9\u5f0f \u901a\u8fc7\u7387\u4f4e\u4e8e\u591a\u5c11\u53d1\u9001\u90ae\u4ef6/\u9489\u9489\u7b49\u901a\u77e5 \u4f18\u5148\u7ea7 \u6db5\u76d6\u591a\u5c11case case\u5931\u8d25\u91cd\u8bd5\u95f4\u9694 \u7b49\u7b49 \u8fd9\u91cc\u53ef\u80fd\u6bd4\u8f83 \u602a \u7684\u5c31\u662f\u628a\u6d4b\u8bd5\u8ba1\u5212+\u6d4b\u8bd5\u96c6\u5408\u7ed9\u8026\u5408\u5230\u4e00\u8d77\u4e86\u3002 \u57fa\u4e8e\u4e0a\u9762\u7684\u601d\u8def\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u6765\u8bbe\u8ba1\u6d4b\u8bd5\u8ba1\u5212\u8868\u4e86, \u5177\u4f53\u5b57\u6bb5\u7684\u542b\u4e49\u53ef\u4ee5\u53c2\u7167\u6ce8\u91ca\u3002 \uff08\u6570\u636e\u8868\u7684\u8bbe\u8ba1\u4e0d\u4e00\u5b9a\u5b8c\u7f8e\uff0c\u540e\u7eed\u4e00\u822c\u4f1a\u6839\u636e\u4e1a\u52a1\u9700\u6c42\u6269\u5c55\uff09 from sqlalchemy import Column, String, TEXT, UniqueConstraint, BOOLEAN, SMALLINT, INT from sqlalchemy.dialects.mysql import TINYTEXT from app.models.basic import PityBase class PityTestPlan (PityBase) : project_id = Column(INT, nullable= False ) # \u6d4b\u8bd5\u8ba1\u5212\u6267\u884c\u73af\u5883, \u53ef\u4ee5\u591a\u9009 env = Column(String( 64 ), nullable= False ) # \u6d4b\u8bd5\u8ba1\u5212\u540d\u79f0 name = Column(String( 32 ), nullable= False ) # \u6d4b\u8bd5\u8ba1\u5212\u4f18\u5148\u7ea7 priority = Column(String( 3 ), nullable= False ) # cron\u8868\u8fbe\u5f0f cron = Column(String( 12 ), nullable= False ) # \u7528\u4f8b\u5217\u8868 case_list = Column(TEXT, nullable= False ) # \u5e76\u884c/\u4e32\u884c(\u662f\u5426\u987a\u5e8f\u6267\u884c) ordered = Column(BOOLEAN, default= False ) # \u901a\u8fc7\u7387\u4f4e\u4e8e\u8fd9\u4e2a\u6570\u4f1a\u81ea\u52a8\u53d1\u901a\u77e5 pass_rate = Column(SMALLINT, default= 80 ) # \u901a\u77e5\u7528\u6237\uff0c\u76ee\u524d\u53ea\u6709\u90ae\u7bb1\uff0c\u540e\u7eed\u7528\u6237\u8868\u53ef\u80fd\u8981\u5b8c\u5584\u624b\u673a\u53f7\u5b57\u6bb5\uff0c\u4e3a\u4e86\u901a\u77e5 receiver = Column(TEXT) # \u901a\u77e5\u65b9\u5f0f 0: \u90ae\u4ef6 1: \u9489\u9489 2: \u4f01\u4e1a\u5fae\u4fe1 3: \u98de\u4e66 \u652f\u6301\u591a\u9009 msg_type = Column(TINYTEXT) # \u5355\u6b21case\u5931\u8d25\u91cd\u8bd5\u95f4\u9694\uff0c\u9ed8\u8ba42\u5206\u949f retry_minutes = Column(SMALLINT, default= 2 ) # \u6d4b\u8bd5\u8ba1\u5212\u662f\u5426\u6b63\u5728\u6267\u884c\u4e2d state = Column(SMALLINT, default= 0 , comment= \"0: \u672a\u5f00\u59cb 1: \u8fd0\u884c\u4e2d\" ) __table_args__ = ( UniqueConstraint( 'project_id' , 'name' , 'deleted_at' ), ) __tablename__ = \"pity_test_plan\" def __init__ (self, project_id, env, case_list, name, priority, cron, ordered, pass_rate, receiver, msg_type, retry_minutes, user, state= 0 , id=None) : super().__init__(user, id) self.env = \",\" .join(map(str, env)) self.case_list = \",\" .join(map(str, case_list)) self.name = name self.project_id = project_id self.priority = priority self.ordered = ordered self.cron = cron self.pass_rate = pass_rate self.receiver = \",\" .join(map(str, receiver)) self.msg_type = \",\" .join(map(str, msg_type)) self.retry_minutes = retry_minutes self.state = state \u8fd9\u91cc\u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0c \u6211\u4eec\u5b9a\u4e49\u7684FORM\u6570\u636e\uff0c\u73af\u5883\u5217\u8868env\u3001\u63a5\u6536\u4ebareceiver\u3001\u7528\u4f8b\u5217\u8868case_list\u90fd\u662f\u6570\u7ec4\uff0c\u6211\u4eec\u9700\u8981\u8fdb\u884c\u4e00\u6ce2\u8f6c\u6362 \u3002 \ud83d\udcd2 \u7f16\u5199CRUD\u65b9\u6cd5 \u62bd\u79bb\u5f02\u6b65\u5206\u9875\u65b9\u6cd5\u548cwhere\u65b9\u6cd5 DatabaseHelper \u5728DatabaseHelper\u7c7b\u4e2d\u6dfb\u52a0pagination\u65b9\u6cd5\uff0c\u63a5\u53d7page\u548csize\uff0csession\u548csql\u53c2\u6570\uff0c\u5148\u8bfb\u51fasql\u5339\u914d\u5230\u7684\u603b\u6570\uff0c\u5982\u679c\u4e3a0\u5219\u76f4\u63a5return\uff0c\u5426\u5219\u901a\u8fc7offset\u548climit\u83b7\u53d6\u5230\u5bf9\u5e94 \u5206\u9875 \u7684\u6570\u636e\u3002 where\u65b9\u6cd5\u662f\u7528\u4e8e \u6539\u8fdb \u6211\u4eec\u5e73\u65f6\u7684\u591a\u6761\u4ef6\u67e5\u8be2\uff0c\u7c7b\u4f3c\u8fd9\u79cd: \u7f16\u5199\u65b0\u589e\u6d4b\u8bd5\u8ba1\u5212\u65b9\u6cd5 \u53ef\u4ee5\u770b\u5230\u6539\u9020\u4e4b\u540e\uff0c\u6211\u4eec\u53ea\u9700\u8981\u8c03\u7528where\u65b9\u6cd5\uff0c\u4e0d\u9700\u8981\u5199 if name != \"\": \u8fd9\u6837\u7684\u8bed\u53e5\u4e86\u3002 \u56e0\u4e3a\u6211\u4eec\u4e0d\u5141\u8bb8\u540c\u4e00\u4e2a\u9879\u76ee\u91cc\u9762\u51fa\u73b0\u540c\u540d\u7684\u6d4b\u8bd5\u8ba1\u5212\uff0c\u6240\u4ee5\u6761\u4ef6\u662f\u9879\u76eeid+name\u4e0d\u80fd\u91cd\u590d\u3002 \u7f16\u5199\u589e\u6539\u5220\u65b9\u6cd5 from sqlalchemy import select from app.models import async_session, DatabaseHelper from app.models.schema.test_plan import PityTestPlanForm from app.models.test_plan import PityTestPlan from app.utils.logger import Log class PityTestPlanDao (object) : log = Log( \"PityTestPlanDao\" ) @staticmethod async def list_test_plan (page: int, size: int, project_id: int = None, name: str = '' ) : try : async with async_session() as session: conditions = [PityTestPlan.deleted_at == 0 ] DatabaseHelper.where(project_id, PityTestPlan.project_id == project_id, conditions) \\ .where(name, PityTestPlan.name.like( f\"% {name} %\" ), conditions) sql = select(PityTestPlan).where(conditions) result, total = await DatabaseHelper.pagination(page, size, session, sql) return result, total except Exception as e: PityTestPlanDao.log.error( f\"\u83b7\u53d6\u6d4b\u8bd5\u8ba1\u5212\u5931\u8d25: {str(e)} \" ) raise Exception( f\"\u83b7\u53d6\u6d4b\u8bd5\u8ba1\u5212\u5931\u8d25: {str(e)} \" ) @staticmethod async def insert_test_plan (plan: PityTestPlanForm, user: int) : try : async with async_session() as session: async with session.begin(): query = await session.execute(select(PityTestPlan).where(PityTestPlan.project_id == plan.project_id, PityTestPlan.name == plan.name, PityTestPlan.deleted_at == 0 )) if query.scalars().first() is not None : raise Exception( \"\u6d4b\u8bd5\u8ba1\u5212\u5df2\u5b58\u5728\" ) plan = PityTestPlan(**plan.dict(), user=user) await session.add(plan) except Exception as e: PityTestPlanDao.log.error( f\"\u65b0\u589e\u6d4b\u8bd5\u8ba1\u5212\u5931\u8d25: {str(e)} \" ) raise Exception( f\"\u6dfb\u52a0\u5931\u8d25: {str(e)} \" ) @staticmethod async def update_test_plan (plan: PityTestPlanForm, user: int) : try : async with async_session() as session: async with session.begin(): query = await session.execute( select(PityTestPlan).where(PityTestPlan.id == plan.id, PityTestPlan.deleted_at == 0 )) data = query.scalars().first() if data is None : raise Exception( \"\u6d4b\u8bd5\u8ba1\u5212\u4e0d\u5b58\u5728\" ) DatabaseHelper.update_model(data, plan, user) except Exception as e: PityTestPlanDao.log.error( f\"\u7f16\u8f91\u6d4b\u8bd5\u8ba1\u5212\u5931\u8d25: {str(e)} \" ) raise Exception( f\"\u7f16\u8f91\u5931\u8d25: {str(e)} \" ) @staticmethod async def delete_test_plan (id: int, user: int) : try : async with async_session() as session: async with session.begin(): query = await session.execute( select(PityTestPlan).where(PityTestPlan.id == plan.id, PityTestPlan.deleted_at == 0 )) data = query.scalars().first() if data is None : raise Exception( \"\u6d4b\u8bd5\u8ba1\u5212\u4e0d\u5b58\u5728\" ) DatabaseHelper.delete_model(data, user) except Exception as e: PityTestPlanDao.log.error( f\"\u5220\u9664\u6d4b\u8bd5\u8ba1\u5212\u5931\u8d25: {str(e)} \" ) raise Exception( f\"\u5220\u9664\u5931\u8d25: {str(e)} \" ) @staticmethod async def query_test_plan (id: int) -> PityTestPlan: try : async with async_session() as session: sql = select(PityTestPlan).where(PityTestPlan.deleted_at == 0 , PityTestPlan.id == id) data = await session.execute(sql) return data.scalars().first() except Exception as e: PityTestPlanDao.log.error( f\"\u83b7\u53d6\u6d4b\u8bd5\u8ba1\u5212\u5931\u8d25: {str(e)} \" ) raise Exception( f\"\u83b7\u53d6\u6d4b\u8bd5\u8ba1\u5212\u5931\u8d25: {str(e)} \" ) \u57fa\u672c\u601d\u8def\u5dee\u4e0d\u591a\uff0c\u8001CRUD\u4e86\uff01\u8fd9\u91cc\u5c31\u4e0d\u591a\u8bf4\u4e86\uff0c\u5bf9sqlalchemy\u7684async\u5185\u5bb9\u4e0d\u4e86\u89e3\u7684\u53ef\u4ee5\u53bb\u5b98\u7f51\u770b\u770bdemo\u3002 \u8fd9\u4e2aquery\u65b9\u6cd5\uff0c\u662f\u7ed9\u5b9a\u65f6\u4efb\u52a1\u67e5\u8be2 \u6d4b\u8bd5\u8ba1\u5212 \u6570\u636e\u4f7f\u7528\u3002 \u7531\u4e8e\u505a\u4e86\u8f6f\u5220\u9664\uff0c\u4f1a\u5bfc\u81f4\u7ecf\u5e38\u5fd8\u8bb0\u5e26\u4e0adeleted_at==0\u7684\u6761\u4ef6 \u3002 \ud83d\udcd2 \u7f16\u5199\u76f8\u5173\u63a5\u53e3\uff08app/routers/testcase/testplan.py\uff09 from fastapi import Depends from app.dao.test_case.TestPlan import PityTestPlanDao from app.handler.fatcory import PityResponse from app.models.schema.test_plan import PityTestPlanForm from app.routers import Permission from app.routers.testcase.testcase import router from config import Config @router.get(\"/plan/list\") async def list_test_plan (page: int, size: int, project_id: int = None, name: str = \"\" , user_info=Depends (Permission () ) ) : try : data, total = await PityTestPlanDao.list_test_plan(page, size, project_id, name) return PityResponse.success_with_size(PityResponse.model_to_list(data), total=total) except Exception as e: return PityResponse.failed(str(e)) @router.get(\"/plan/insert\") async def insert_test_plan (form: PityTestPlanForm, user_info=Depends (Permission (Config.MANAGER) ) ) : try : await PityTestPlanDao.insert_test_plan(form, user_info[ 'id' ]) return PityResponse.success() except Exception as e: return PityResponse.failed(str(e)) @router.get(\"/plan/update\") async def update_test_plan (form: PityTestPlanForm, user_info=Depends (Permission (Config.MANAGER) ) ) : try : await PityTestPlanDao.update_test_plan(form, user_info[ 'id' ]) return PityResponse.success() except Exception as e: return PityResponse.failed(str(e)) @router.get(\"/plan/delete\") async def delete_test_plan (id: int, user_info=Depends (Permission (Config.MANAGER) ) ) : try : await PityTestPlanDao.delete_test_plan(id, user_info[ 'id' ]) return PityResponse.success() except Exception as e: return PityResponse.failed(str(e)) \u8fd9\u8fb9\u6211\u4eec\u628a\u6d4b\u8bd5\u8ba1\u5212\u7684\u589e\u5220\u6539\u6743\u9650\u8d4b\u4e88MANAGER\uff0c\u4f46\u5176\u5b9e\u6700\u597d\u662f\u80fd\u7ed9\u5bf9\u5e94\u7684\u9879\u76ee\u7ecf\u7406\uff0c\u4e0d\u8fc7\u90a3\u6837\u4f1a\u7a0d\u5fae\u590d\u6742\u70b9\u3002\u6211\u4eec\u6682\u65f6\u5148\u5077\u4e2a\u61d2\uff0c\u6216\u8bb8\u518d \u5b8c\u5584 \u3002 \u4eca\u5929\u7684\u5185\u5bb9\u5c31\u5206\u4eab\u5230\u8fd9\u91cc\uff0c\u4e0b\u8282\u4f1a\u4ecb\u7ecd\u6d4b\u8bd5\u8ba1\u5212\u5982\u4f55\u548cAPScheduler\u7ed3\u5408\u8d77\u6765\uff0c\u4e4b\u540e\u4fbf\u662f\u7f16\u5199\u6d4b\u8bd5\u8ba1\u5212\u7684\u524d\u7aef\u9875\u9762\u90e8\u5206\uff0c\u5b8c\u6210\u5b9a\u65f6\u4efb\u52a1\u529f\u80fd\u3002","title":"73.\u8bbe\u8ba1\u6d4b\u8bd5\u8ba1\u5212\u529f\u80fd"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2874%29%20%E6%B5%8B%E8%AF%95%E8%AE%A1%E5%88%92%E5%AE%9A%E6%97%B6%E6%89%A7%E8%A1%8C%E5%88%9D%E4%BD%93%E9%AA%8C/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684\u5b8c\u6574 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u6d4b\u8bd5\u5f00\u53d1\u5751\u8d27 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u8bbe\u8ba1\u597d\u4e86 \u6d4b\u8bd5\u8ba1\u5212 \u8868\u5e76\u7f16\u5199\u4e86CRUD\u63a5\u53e3\uff0c\u8fd8\u6ca1\u6765\u5f97\u53ca\u6d4b\u8bd5\uff0c\u6211\u4eec\u5c31\u8981\u9a6c\u4e0d\u505c\u8e44\u5730\u7f16\u5199\u5b9a\u65f6\u4efb\u52a1\u76f8\u5173\u5185\u5bb9\u4e86\u3002\u4eca\u5929\u6211\u4eec\u5c31\u6765\u7f16\u5199\u4e00\u4e2a\u5b8c\u5584\u7684demo\uff0c\u53ef\u4ee5\u5b9a\u671f\u6267\u884c \u6d4b\u8bd5\u8ba1\u5212 \u7684\u7528\u4f8b\uff0c\u5e76\u751f\u6210\u62a5\u544a\u3002 \u81f3\u4e8e\u540e\u9762\u7684\u901a\u77e5\uff0c\u8981\u7b49\u5230\u4ee5\u540e\u5b8c\u5584\u4e86\u3002 \u8c03\u6574Executor\u7c7b\u91cc\u9762\u7684\u90e8\u5206\u65b9\u6cd5 \u4e4b\u524d\u6211\u4eec\u867d\u7136\u652f\u6301\u4e86 \u591a\u6761case \u5f02\u6b65\u8fd0\u884c\u5e76\u5199\u5165\u6d4b\u8bd5\u62a5\u544a\uff0c\u4f46\u4e3a\u4e86\u652f\u6301 \u6d4b\u8bd5\u8ba1\u5212 \uff0c\u6211\u4eec\u8fd8\u9700\u8981\u8fdb\u884c\u4e00\u4e9b\u8c03\u6574\u3002 \u4fee\u6539run_multiple\u65b9\u6cd5 \u6211\u4eec\u7684 \u6838\u5fc3 \u8fd8\u662f\u8fd9\u4e2a\u65b9\u6cd5\uff0c\u56e0\u4e3a\u91cc\u9762\u5df2\u7ecf\u5305\u88c5\u597d\u4e86\u8fd0\u884c\u591a\u6761case\u7684\u65b9\u6cd5\u3002\u4f46\u6211\u4eec\u8981\u505a\u4e00\u4e9b\u6539\u52a8: \u9996\u5148\u6211\u4eec\u8981\u8c03\u6574\u5b83\u7684\u53c2\u6570\uff0c\u56e0\u4e3a\u6211\u4eec\u8fd0\u884ccase\u7684\u6a21\u5f0f\uff0c\u6709\u5f88\u591a\u79cd\uff0c\u6309\u7167\u4e4b\u524d\u5b9a\u4e49\u7684mode\u5b57\u6bb5: \u8fd9\u6837\uff0c\u5f53\u6211\u4eec\u8c03\u7528run_mutiple\u65b9\u6cd5\u7684\u65f6\u5019\uff0c\u5c31\u53ef\u4ee5\u77e5\u9053case\u7684\u6a21\u5f0f\u662f\u4ec0\u4e48\u6a21\u5f0f\u4e86\uff0c\u7a76\u7adf\u662f\u96b6\u5c5e\u4e8e \u6d4b\u8bd5\u8ba1\u5212 \u5462\uff0c\u8fd8\u662f\u5c5e\u4e8e \u666e\u901a\u6267\u884c\u7684case \u3002\u6211\u4eec\u8c03\u6574\u4e00\u4e0b\uff0c\u6539\u6210\u56fe2\u7684\u6570\u636e\u3002 plan_id\u53ef\u4ee5\u4e3a\u7a7a\uff0c\u5982\u679c\u6709plan_id\u7684\u8bdd\uff0c\u53ef\u4ee5\u76f4\u63a5\u8df3\u8f6c\u5230 \u6d4b\u8bd5\u8ba1\u5212 \u76f8\u5173\u9875\u9762\u3002\u65b9\u4fbf\u7f16\u8f91\u6d4b\u8bd5\u8ba1\u5212\uff0c\u4e5f\u65b9\u4fbf\u6392\u67e5\u95ee\u9898\u3002 ordered\u8fd9\u4e2a\u65b9\u6cd5\u533a\u5206 \u540c\u6b65 \u8fd8\u662f \u5f02\u6b65 \uff0c\u56e0\u4e3a\u6211\u4eec\u5148\u524d\u7684run_multiple\u90fd\u662f\u9ed8\u8ba4\u5f02\u6b65\u7684\uff0c\u4f46\u6211\u4eec\u6d4b\u8bd5\u8ba1\u5212\u53c8\u65b0\u589e\u4e86 \u540c\u6b65\u6a21\u5f0f \uff0c\u6240\u4ee5\u9700\u8981\u5b9a\u4e49\u8fd9\u6837\u4e00\u4e2a \u53c2\u6570 \u3002 \u4fee\u6539ReportDao \u4e5f\u662f\u6dfb\u52a0\u8fd92\u4e2a\u53c2\u6570\uff0c\u900f\u4f20\u8fdb\u6765\u3002\u65b9\u4fbf\u62a5\u544a\u91cc\u9762\u8868\u660e\uff0c\u8fd9\u662f\u4ec0\u4e48\u6a21\u5f0f\u7684\u6267\u884c\uff0c\u4ee5\u53ca\u662f\u5426\u6709\u6d4b\u8bd5\u8ba1\u5212id\u3002 \u8c03\u6574\u6267\u884c\u903b\u8f91 \u6839\u636eordered\u5b57\u6bb5\u5224\u65ad\u662f\u5426\u662f \u540c\u6b65\u6267\u884c \uff0c\u5982\u679c\u4e0d\u662f\u5219\u548c\u4ee5\u524d\u4e00\u81f4\uff0c\u662f\u7684\u8bdd\u5219\u7528for\u7684\u65b9\u5f0f\u6267\u884c\uff0c \u4fdd\u8bc1\u7528\u4f8b\u6267\u884c\u7684\u987a\u5e8f\u6027 \u3002 \u65b0\u589erun_test_plan\u65b9\u6cd5 @staticmethod async def run_test_plan ( plan_id : int ): \"\"\" \u901a\u8fc7\u6d4b\u8bd5\u8ba1\u5212id\u6267\u884c\u6d4b\u8bd5\u8ba1\u5212 :param plan_id: :return: \"\"\" plan = await PityTestPlanDao . query_test_plan ( plan_id ) if plan is None : Executor . log . info ( f \"\u6d4b\u8bd5\u8ba1\u5212: [ { plan_id } ]\u4e0d\u5b58\u5728\" ) return # \u8bbe\u7f6e\u4e3arunning plan . state = 1 await PityTestPlanDao . update_test_plan ( plan , plan . update_user ) # if plan.disabled: # # \u8bf4\u660e\u6d4b\u8bd5\u8ba1\u5212\u5df2\u7981\u7528 # Executor.log.info(f\"\u6d4b\u8bd5\u8ba1\u5212: [{plan.name}]\u672a\u5f00\u542f\") # return env = list ( map ( int , plan . env . split ( \",\" ))) case_list = list ( map ( int , plan . case_list . split ( \",\" ))) await asyncio . gather ( * ( Executor . run_multiple ( 0 , int ( e ), case_list , mode = 1 , plan_id = plan . id , ordered = plan . ordered ) for e in env )) # TODO \u540e\u7eed\u901a\u77e5\u90e8\u5206 plan . state = 0 await PityTestPlanDao . update_test_plan ( plan , plan . update_user ) \u5148\u901a\u8fc7query\u65b9\u6cd5\u67e5\u5230\u6d4b\u8bd5\u8ba1\u5212\u6570\u636e\uff0c\u5982\u679cplan\u662fNone\uff0c\u8bf4\u660e\u6ca1\u6709\u8fd9\u4e2a\u6d4b\u8bd5\u8ba1\u5212\uff0c\u53ef\u80fd\u88ab \u5220\u6389 \u4e86\u3002 \u5426\u5219\u6211\u4eec\u8d70\u6267\u884c\u903b\u8f91: \u6839\u636eplan\u7684env\u5b57\u6bb5\u53d6\u51fa\u73af\u5883\uff0c\u5e76\u8f6c\u6362\u4e3a[1, 2]\u8fd9\u6837\u7684\u6570\u7ec4\u3002 \u8fd9\u91cc\u53ef\u80fd\u6709\u70b9\u7ed5\uff0c\u56e0\u4e3a\u6211\u4eec\u6570\u636e\u5e93\u5b58\u7684env\u548ccase_list\u90fd\u662f\u8fd9\u6837\u7684\u5f62\u5f0f: 1,2,3,4 \u901a\u8fc7\u9017\u53f7\u5206\u5f00\uff0c\u6211\u4eecsplit\u4ee5\u540e\uff0c\u4f1a\u5f97\u5230: [\"1\", \"2\", \"3\", \"4\"]\u8fd9\u6837\u7684\u6570\u7ec4\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u6279\u91cf\u8f6c\u4e3aint\u3002 \u6700\u540e\uff0c\u7531\u4e8e\u4e00\u822c\u73af\u5883\u4e4b\u95f4\u4f1a \u9694\u79bb \uff0c\u6240\u4ee5\u6211\u4eec\u7684ordered\u6839\u636e\u73af\u5883\u8d70\u5c31\u53ef\u4ee5\u4e86\uff0c\u591a\u73af\u5883\u6267\u884c\u6211\u4eec\u53ef\u4ee5\u6309\u7167\u5f02\u6b65\u5904\u7406\u3002 \u6240\u4ee5\u6700\u540e\u4e5f\u9009\u7528\u4e86gather\u3002 \u7f16\u5199Scheduler\u7c7b \u6211\u4eec\u5728utils\u76ee\u5f55\u4e0b\u65b0\u5efascheduler.py\u6587\u4ef6: from apscheduler.schedulers.asyncio import AsyncIOScheduler from apscheduler.triggers.cron import CronTrigger from app.utils.executor import Executor class Scheduler ( object ): scheduler : AsyncIOScheduler = None @staticmethod def init ( scheduler ): Scheduler . scheduler = scheduler @staticmethod def configure ( ** kwargs ): Scheduler . scheduler . configure ( ** kwargs ) @staticmethod def start (): Scheduler . scheduler . start () @staticmethod def add_test_plan ( plan_id , plan_name , cron ): return Scheduler . scheduler . add_job ( func = Executor . run_test_plan , args = ( plan_id ,), name = plan_name , id = str ( plan_id ), trigger = CronTrigger . from_crontab ( cron )) @staticmethod def edit (): pass @staticmethod def remove (): pass @staticmethod def list (): job_list = Scheduler . scheduler . get_jobs () return job_list \u8fd9\u91cc\u6211\u4eec\u5bf9scheduler\u8fdb\u884c\u4e86\u975e\u5e38\u7b80\u5355\u7684\u5c01\u88c5\uff0c\u7136\u540e\u5b9a\u4e49\u4e86add_test_plan\u65b9\u6cd5\u3002 \u8fd9\u4e2a\u65b9\u6cd5\u53ef\u4ee5\u6dfb\u52a0 Executor.run_test_plan \u5230\u5b9a\u65f6\u4efb\u52a1\uff0c\u4ed6\u63a5\u53d7id\uff0cname\u548ccron3\u4e2a\u53c2\u6570\uff0c\u8fd9\u4e2a\u6570\u636e\u6700\u7ec8\u4f1a\u843d\u5230 \u5b9a\u65f6\u4efb\u52a1\u8868 \u91cc\u9762\u53bb\u3002 \u5728\u6dfb\u52a0\u6d4b\u8bd5\u8ba1\u5212\u63a5\u53e3\u8c03\u7528add_test_plan\u65b9\u6cd5 \u6d4b\u8bd5\u4e00\u4e0b FastApi\u6df1\u5ea6\u7ed3\u5408\u4e86Swagger\uff0c\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u6253\u5f00: http://localhost:7777/docs\u4fbf\u53ef\u4ee5\u627e\u5230\u6211\u4eec\u7684\u6d4b\u8bd5\u65b9\u6cd5: \u7531\u4e8e\u6211\u5df2\u7ecf\u6dfb\u52a0\u8fc7\u4e86\uff0c\u5e76\u4e14\u662f\u6bcf\u5206\u949f\u4e00\u6b21\uff0c\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u542f\u52a8\u670d\u52a1\uff0c \u9759\u9759\u7b49\u5f85 \u5373\u53ef\u3002 \u90a3\u4eca\u5929\u7684\u7b80\u5355demo\u5c31\u5b8c\u6210\u5230\u8fd9\u91cc\uff0c\u4e0b\u4e00\u8282\u6211\u4eec\u5b8c\u5584\u5220\u6539\u67e5\u7684\u5185\u5bb9\u3002","title":"74.\u6d4b\u8bd5\u8ba1\u5212\u5b9a\u65f6\u6267\u884c\u521d\u4f53\u9a8c"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2874%29%20%E6%B5%8B%E8%AF%95%E8%AE%A1%E5%88%92%E5%AE%9A%E6%97%B6%E6%89%A7%E8%A1%8C%E5%88%9D%E4%BD%93%E9%AA%8C/#_1","text":"\u4e0a\u4e00\u8282\u6211\u4eec\u8bbe\u8ba1\u597d\u4e86 \u6d4b\u8bd5\u8ba1\u5212 \u8868\u5e76\u7f16\u5199\u4e86CRUD\u63a5\u53e3\uff0c\u8fd8\u6ca1\u6765\u5f97\u53ca\u6d4b\u8bd5\uff0c\u6211\u4eec\u5c31\u8981\u9a6c\u4e0d\u505c\u8e44\u5730\u7f16\u5199\u5b9a\u65f6\u4efb\u52a1\u76f8\u5173\u5185\u5bb9\u4e86\u3002\u4eca\u5929\u6211\u4eec\u5c31\u6765\u7f16\u5199\u4e00\u4e2a\u5b8c\u5584\u7684demo\uff0c\u53ef\u4ee5\u5b9a\u671f\u6267\u884c \u6d4b\u8bd5\u8ba1\u5212 \u7684\u7528\u4f8b\uff0c\u5e76\u751f\u6210\u62a5\u544a\u3002 \u81f3\u4e8e\u540e\u9762\u7684\u901a\u77e5\uff0c\u8981\u7b49\u5230\u4ee5\u540e\u5b8c\u5584\u4e86\u3002","title":"\u56de\u987e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2874%29%20%E6%B5%8B%E8%AF%95%E8%AE%A1%E5%88%92%E5%AE%9A%E6%97%B6%E6%89%A7%E8%A1%8C%E5%88%9D%E4%BD%93%E9%AA%8C/#executor","text":"\u4e4b\u524d\u6211\u4eec\u867d\u7136\u652f\u6301\u4e86 \u591a\u6761case \u5f02\u6b65\u8fd0\u884c\u5e76\u5199\u5165\u6d4b\u8bd5\u62a5\u544a\uff0c\u4f46\u4e3a\u4e86\u652f\u6301 \u6d4b\u8bd5\u8ba1\u5212 \uff0c\u6211\u4eec\u8fd8\u9700\u8981\u8fdb\u884c\u4e00\u4e9b\u8c03\u6574\u3002 \u4fee\u6539run_multiple\u65b9\u6cd5 \u6211\u4eec\u7684 \u6838\u5fc3 \u8fd8\u662f\u8fd9\u4e2a\u65b9\u6cd5\uff0c\u56e0\u4e3a\u91cc\u9762\u5df2\u7ecf\u5305\u88c5\u597d\u4e86\u8fd0\u884c\u591a\u6761case\u7684\u65b9\u6cd5\u3002\u4f46\u6211\u4eec\u8981\u505a\u4e00\u4e9b\u6539\u52a8: \u9996\u5148\u6211\u4eec\u8981\u8c03\u6574\u5b83\u7684\u53c2\u6570\uff0c\u56e0\u4e3a\u6211\u4eec\u8fd0\u884ccase\u7684\u6a21\u5f0f\uff0c\u6709\u5f88\u591a\u79cd\uff0c\u6309\u7167\u4e4b\u524d\u5b9a\u4e49\u7684mode\u5b57\u6bb5: \u8fd9\u6837\uff0c\u5f53\u6211\u4eec\u8c03\u7528run_mutiple\u65b9\u6cd5\u7684\u65f6\u5019\uff0c\u5c31\u53ef\u4ee5\u77e5\u9053case\u7684\u6a21\u5f0f\u662f\u4ec0\u4e48\u6a21\u5f0f\u4e86\uff0c\u7a76\u7adf\u662f\u96b6\u5c5e\u4e8e \u6d4b\u8bd5\u8ba1\u5212 \u5462\uff0c\u8fd8\u662f\u5c5e\u4e8e \u666e\u901a\u6267\u884c\u7684case \u3002\u6211\u4eec\u8c03\u6574\u4e00\u4e0b\uff0c\u6539\u6210\u56fe2\u7684\u6570\u636e\u3002 plan_id\u53ef\u4ee5\u4e3a\u7a7a\uff0c\u5982\u679c\u6709plan_id\u7684\u8bdd\uff0c\u53ef\u4ee5\u76f4\u63a5\u8df3\u8f6c\u5230 \u6d4b\u8bd5\u8ba1\u5212 \u76f8\u5173\u9875\u9762\u3002\u65b9\u4fbf\u7f16\u8f91\u6d4b\u8bd5\u8ba1\u5212\uff0c\u4e5f\u65b9\u4fbf\u6392\u67e5\u95ee\u9898\u3002 ordered\u8fd9\u4e2a\u65b9\u6cd5\u533a\u5206 \u540c\u6b65 \u8fd8\u662f \u5f02\u6b65 \uff0c\u56e0\u4e3a\u6211\u4eec\u5148\u524d\u7684run_multiple\u90fd\u662f\u9ed8\u8ba4\u5f02\u6b65\u7684\uff0c\u4f46\u6211\u4eec\u6d4b\u8bd5\u8ba1\u5212\u53c8\u65b0\u589e\u4e86 \u540c\u6b65\u6a21\u5f0f \uff0c\u6240\u4ee5\u9700\u8981\u5b9a\u4e49\u8fd9\u6837\u4e00\u4e2a \u53c2\u6570 \u3002 \u4fee\u6539ReportDao \u4e5f\u662f\u6dfb\u52a0\u8fd92\u4e2a\u53c2\u6570\uff0c\u900f\u4f20\u8fdb\u6765\u3002\u65b9\u4fbf\u62a5\u544a\u91cc\u9762\u8868\u660e\uff0c\u8fd9\u662f\u4ec0\u4e48\u6a21\u5f0f\u7684\u6267\u884c\uff0c\u4ee5\u53ca\u662f\u5426\u6709\u6d4b\u8bd5\u8ba1\u5212id\u3002 \u8c03\u6574\u6267\u884c\u903b\u8f91 \u6839\u636eordered\u5b57\u6bb5\u5224\u65ad\u662f\u5426\u662f \u540c\u6b65\u6267\u884c \uff0c\u5982\u679c\u4e0d\u662f\u5219\u548c\u4ee5\u524d\u4e00\u81f4\uff0c\u662f\u7684\u8bdd\u5219\u7528for\u7684\u65b9\u5f0f\u6267\u884c\uff0c \u4fdd\u8bc1\u7528\u4f8b\u6267\u884c\u7684\u987a\u5e8f\u6027 \u3002","title":"\u8c03\u6574Executor\u7c7b\u91cc\u9762\u7684\u90e8\u5206\u65b9\u6cd5"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2874%29%20%E6%B5%8B%E8%AF%95%E8%AE%A1%E5%88%92%E5%AE%9A%E6%97%B6%E6%89%A7%E8%A1%8C%E5%88%9D%E4%BD%93%E9%AA%8C/#run_test_plan","text":"@staticmethod async def run_test_plan ( plan_id : int ): \"\"\" \u901a\u8fc7\u6d4b\u8bd5\u8ba1\u5212id\u6267\u884c\u6d4b\u8bd5\u8ba1\u5212 :param plan_id: :return: \"\"\" plan = await PityTestPlanDao . query_test_plan ( plan_id ) if plan is None : Executor . log . info ( f \"\u6d4b\u8bd5\u8ba1\u5212: [ { plan_id } ]\u4e0d\u5b58\u5728\" ) return # \u8bbe\u7f6e\u4e3arunning plan . state = 1 await PityTestPlanDao . update_test_plan ( plan , plan . update_user ) # if plan.disabled: # # \u8bf4\u660e\u6d4b\u8bd5\u8ba1\u5212\u5df2\u7981\u7528 # Executor.log.info(f\"\u6d4b\u8bd5\u8ba1\u5212: [{plan.name}]\u672a\u5f00\u542f\") # return env = list ( map ( int , plan . env . split ( \",\" ))) case_list = list ( map ( int , plan . case_list . split ( \",\" ))) await asyncio . gather ( * ( Executor . run_multiple ( 0 , int ( e ), case_list , mode = 1 , plan_id = plan . id , ordered = plan . ordered ) for e in env )) # TODO \u540e\u7eed\u901a\u77e5\u90e8\u5206 plan . state = 0 await PityTestPlanDao . update_test_plan ( plan , plan . update_user ) \u5148\u901a\u8fc7query\u65b9\u6cd5\u67e5\u5230\u6d4b\u8bd5\u8ba1\u5212\u6570\u636e\uff0c\u5982\u679cplan\u662fNone\uff0c\u8bf4\u660e\u6ca1\u6709\u8fd9\u4e2a\u6d4b\u8bd5\u8ba1\u5212\uff0c\u53ef\u80fd\u88ab \u5220\u6389 \u4e86\u3002 \u5426\u5219\u6211\u4eec\u8d70\u6267\u884c\u903b\u8f91: \u6839\u636eplan\u7684env\u5b57\u6bb5\u53d6\u51fa\u73af\u5883\uff0c\u5e76\u8f6c\u6362\u4e3a[1, 2]\u8fd9\u6837\u7684\u6570\u7ec4\u3002 \u8fd9\u91cc\u53ef\u80fd\u6709\u70b9\u7ed5\uff0c\u56e0\u4e3a\u6211\u4eec\u6570\u636e\u5e93\u5b58\u7684env\u548ccase_list\u90fd\u662f\u8fd9\u6837\u7684\u5f62\u5f0f: 1,2,3,4 \u901a\u8fc7\u9017\u53f7\u5206\u5f00\uff0c\u6211\u4eecsplit\u4ee5\u540e\uff0c\u4f1a\u5f97\u5230: [\"1\", \"2\", \"3\", \"4\"]\u8fd9\u6837\u7684\u6570\u7ec4\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u6279\u91cf\u8f6c\u4e3aint\u3002 \u6700\u540e\uff0c\u7531\u4e8e\u4e00\u822c\u73af\u5883\u4e4b\u95f4\u4f1a \u9694\u79bb \uff0c\u6240\u4ee5\u6211\u4eec\u7684ordered\u6839\u636e\u73af\u5883\u8d70\u5c31\u53ef\u4ee5\u4e86\uff0c\u591a\u73af\u5883\u6267\u884c\u6211\u4eec\u53ef\u4ee5\u6309\u7167\u5f02\u6b65\u5904\u7406\u3002 \u6240\u4ee5\u6700\u540e\u4e5f\u9009\u7528\u4e86gather\u3002","title":"\u65b0\u589erun_test_plan\u65b9\u6cd5"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2874%29%20%E6%B5%8B%E8%AF%95%E8%AE%A1%E5%88%92%E5%AE%9A%E6%97%B6%E6%89%A7%E8%A1%8C%E5%88%9D%E4%BD%93%E9%AA%8C/#scheduler","text":"\u6211\u4eec\u5728utils\u76ee\u5f55\u4e0b\u65b0\u5efascheduler.py\u6587\u4ef6: from apscheduler.schedulers.asyncio import AsyncIOScheduler from apscheduler.triggers.cron import CronTrigger from app.utils.executor import Executor class Scheduler ( object ): scheduler : AsyncIOScheduler = None @staticmethod def init ( scheduler ): Scheduler . scheduler = scheduler @staticmethod def configure ( ** kwargs ): Scheduler . scheduler . configure ( ** kwargs ) @staticmethod def start (): Scheduler . scheduler . start () @staticmethod def add_test_plan ( plan_id , plan_name , cron ): return Scheduler . scheduler . add_job ( func = Executor . run_test_plan , args = ( plan_id ,), name = plan_name , id = str ( plan_id ), trigger = CronTrigger . from_crontab ( cron )) @staticmethod def edit (): pass @staticmethod def remove (): pass @staticmethod def list (): job_list = Scheduler . scheduler . get_jobs () return job_list \u8fd9\u91cc\u6211\u4eec\u5bf9scheduler\u8fdb\u884c\u4e86\u975e\u5e38\u7b80\u5355\u7684\u5c01\u88c5\uff0c\u7136\u540e\u5b9a\u4e49\u4e86add_test_plan\u65b9\u6cd5\u3002 \u8fd9\u4e2a\u65b9\u6cd5\u53ef\u4ee5\u6dfb\u52a0 Executor.run_test_plan \u5230\u5b9a\u65f6\u4efb\u52a1\uff0c\u4ed6\u63a5\u53d7id\uff0cname\u548ccron3\u4e2a\u53c2\u6570\uff0c\u8fd9\u4e2a\u6570\u636e\u6700\u7ec8\u4f1a\u843d\u5230 \u5b9a\u65f6\u4efb\u52a1\u8868 \u91cc\u9762\u53bb\u3002","title":"\u7f16\u5199Scheduler\u7c7b"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2874%29%20%E6%B5%8B%E8%AF%95%E8%AE%A1%E5%88%92%E5%AE%9A%E6%97%B6%E6%89%A7%E8%A1%8C%E5%88%9D%E4%BD%93%E9%AA%8C/#add_test_plan","text":"","title":"\u5728\u6dfb\u52a0\u6d4b\u8bd5\u8ba1\u5212\u63a5\u53e3\u8c03\u7528add_test_plan\u65b9\u6cd5"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2874%29%20%E6%B5%8B%E8%AF%95%E8%AE%A1%E5%88%92%E5%AE%9A%E6%97%B6%E6%89%A7%E8%A1%8C%E5%88%9D%E4%BD%93%E9%AA%8C/#_2","text":"FastApi\u6df1\u5ea6\u7ed3\u5408\u4e86Swagger\uff0c\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u6253\u5f00: http://localhost:7777/docs\u4fbf\u53ef\u4ee5\u627e\u5230\u6211\u4eec\u7684\u6d4b\u8bd5\u65b9\u6cd5: \u7531\u4e8e\u6211\u5df2\u7ecf\u6dfb\u52a0\u8fc7\u4e86\uff0c\u5e76\u4e14\u662f\u6bcf\u5206\u949f\u4e00\u6b21\uff0c\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u542f\u52a8\u670d\u52a1\uff0c \u9759\u9759\u7b49\u5f85 \u5373\u53ef\u3002 \u90a3\u4eca\u5929\u7684\u7b80\u5355demo\u5c31\u5b8c\u6210\u5230\u8fd9\u91cc\uff0c\u4e0b\u4e00\u8282\u6211\u4eec\u5b8c\u5584\u5220\u6539\u67e5\u7684\u5185\u5bb9\u3002","title":"\u6d4b\u8bd5\u4e00\u4e0b"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2875%29%20%E5%AE%8C%E5%96%84%E6%B5%8B%E8%AF%95%E8%AE%A1%E5%88%92%E7%9A%84%E5%88%A0%E6%94%B9%E6%9F%A5%E5%8A%9F%E8%83%BD/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684\u5b8c\u6574 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u6d4b\u8bd5\u5f00\u53d1\u5751\u8d27 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u5199\u597d\u4e86\u4e00\u4e2a \u6d4b\u8bd5\u8ba1\u5212 \u7684\u521d\u7ea7\u7248\u672c\uff0c\u5e76\u4e14\u80fd\u591f\u6dfb\u52a0\u8ba1\u5212\uff0c\u4e5f\u80fd\u5b9a\u65f6\u6267\u884c\u3002\u90a3\u4eca\u5929\u6211\u4eec\u5c31\u6765\u5b8c\u5584\u6d4b\u8bd5\u8ba1\u5212 \u5220\u6539\u67e5 \u4e0eAPScheduler\u76f8\u7ed3\u5408\u7684\u90e8\u5206\u3002 \u5b9a\u65f6\u4efb\u52a1\u548c\u6d4b\u8bd5\u8ba1\u5212\u7684\u8026\u5408 \u76ee\u524d\u6765\u770b\uff0c\u6d4b\u8bd5\u8ba1\u5212\u548c\u5b9a\u65f6\u4efb\u52a1\u6709\u7740\u9ad8\u5ea6\u7684\u8026\u5408\uff0c\u8003\u8651\u5230\u6211\u4eec \u5e76\u4e0d\u6253\u7b97\u505a\u4e00\u6b3e\u81ea\u7531\u5ea6\u9ad8\u7684\u5b9a\u65f6job\u7cfb\u7edf \uff0c\u6240\u4ee5\u6682\u65f6\u5c31\u5148\u6309\u8fd9\u4e2a\u601d\u8def\u8bbe\u8ba1\u3002\u6bd5\u7adf\u6211\u4eec\u662f\u4e00\u4e2a\u505a\u63a5\u53e3\u81ea\u52a8\u5316\u7684\u5e73\u53f0\uff0c\u800c\u4e0d\u662f\u7c7b\u4f3c jenkins \u4e00\u6837\uff0c\u6709\u5404\u7c7b\u4efb\u52a1\u7684\u5e73\u53f0\u3002\u5982\u679c\u540e\u7eed\u6709\u76f8\u5173\u7684\u9700\u6c42\uff0c\u6211\u4eec\u518d\u8003\u8651\u3002 \u6240\u4ee5\u73b0\u5728\u7684\u60c5\u51b5\u662f\uff0c\u5b9a\u65f6\u4efb\u52a1\u5217\u8868\u5b58\u653e\u4e86\u4e00\u6279 job\u6570\u636e \uff0c\u6d4b\u8bd5\u8ba1\u5212\u8868\u53c8\u5b58\u653e\u4e86\u4e0e\u4e4b\u5bf9\u5e94\u7684\u6d4b\u8bd5\u8ba1\u5212\u6570\u636e\u3002 \u67e5\u8be2\u5b9a\u65f6\u4efb\u52a1 \u6211\u4eec\u4e4b\u524d\u4e0d\u662f\u6dfb\u52a0\u8fc7\u4e00\u4e2a\u5b9a\u65f6\u4efb\u52a1\u5417\uff1f\u6211\u4eec\u5148\u6765\u770b\u770b\u7528APScheduler\u7684api\uff0c\u83b7\u53d6\u5230\u7684\u6570\u636e\u5185\u5bb9\u3002\u8fd9\u65f6\u5019\u5c31\u9700\u8981debug\u4e86~ Scheduler\u5bf9\u8c61\u662f\u6709\u4e2aget_job\u7684\u65b9\u6cd5\uff0c\u6211\u4eec\u4e4b\u524d\u7ed9job\u7684id\u5b9a\u4e49\u4e3a\u6d4b\u8bd5\u8ba1\u5212\u7684id\u3002 \u6240\u4ee5\u6211\u4eec\u73b0\u5728\u53ef\u4ee5\u7528\u6d4b\u8bd5\u8ba1\u5212\u7684id\u53bb\u67e5\u8be2\u5b9a\u65f6\u4efb\u52a1\u7684\u4e00\u4e9b\u4fe1\u606f\u3002 \u5728utils/scheduler.py\u65b0\u589elist_test_plan\u65b9\u6cd5: @staticmethod def list_test_plan ( data : List ): for d in data : job = Scheduler . scheduler . get_job ( str ( d . get ( 'id' ))) print ( job ) d [ \"next_run\" ] = job . next_run_time \u4f20\u5165\u7684data\u662f\u67e5\u8be2\u6d4b\u8bd5\u8ba1\u5212\u63a5\u53e3\u62ff\u5230\u7684 \u6d4b\u8bd5\u8ba1\u5212\u6570\u636e \u3002 \u8fc7\u7a0b\u5982\u4e0b: \u83b7\u53d6\u5230\u6d4b\u8bd5\u8ba1\u5212\u6570\u636e \u6839\u636e\u6d4b\u8bd5\u8ba1\u5212\u6570\u636e\u53bb\u83b7\u53d6\u5230\u5b9a\u65f6\u4efb\u52a1\u7684\u6570\u636e \u4e00\u5e76\u8fd4\u56de \u5176\u5b9e\u6211\u8fd9\u91cc\u5f31\u5316\u4e86\u5b9a\u65f6\u4efb\u52a1\u7684\u7279\u70b9\uff0c\u53cd\u800c\u628acron\u8fd9\u6837\u7684\u5b57\u6bb5\u5265\u79bb\u5230 \u6d4b\u8bd5\u8ba1\u5212 \u4e4b\u4e2d\u4e86\u3002\u6240\u4ee5\u8fd9\u4e2a\u5b9a\u65f6\u4efb\u52a1\u7ed9\u6211\u4eec\u7684\u4f5c\u7528\u5c31\u53ea\u67092\u4e2a: \u5b83\u662f\u4e0d\u662f\u5b58\u5728 \u5b83\u662f\u5426\u6b63\u5e38\u5de5\u4f5c\uff0c\u53ef\u4ee5\u901a\u8fc7next_run_at\u6765\u5224\u65ad \u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u5728\u67e5\u8be2\u63a5\u53e3\uff0c\u52a0\u4e0anext_run_at\u5c31\u53ef\u4ee5\u4e86\u3002 \u8fd9\u70b9\u5f88\u91cd\u8981\uff0c\u56e0\u4e3a\u6211\u4eec\u53ef\u80fd \u521b\u5efa\u6d4b\u8bd5\u8ba1\u5212\u6210\u529f \u4e86\uff0c\u4f46 \u521b\u5efa\u5b9a\u65f6\u4efb\u52a1\u5931\u8d25 \u4e86\u3002\u6240\u4ee5\u8fd9\u4e2a\u6570\u636e\u4e0d\u53ef\u5ffd\u7565\u3002 \u5f53\u6211\u4eec\u6ca1\u83b7\u53d6\u5230job\u7684\u65f6\u5019\uff0c\u628ajob\u7684state\u6539\u4e3a2\uff08\u5e76\u975e\u5728\u6570\u636e\u5e93\u6539\uff09\uff0c\u53ea\u662f\u5728\u9875\u9762\u4e0a\u663e\u793a\u8fd9\u4e2a\u6d4b\u8bd5\u8ba1\u5212\u4efb\u52a1\u672a\u6dfb\u52a0\u6210\u529f\uff01\uff01\uff01 \u7f16\u5199\u7f16\u8f91/\u5220\u9664\u5b9a\u65f6\u4efb\u52a1\u65b9\u6cd5 \u7531\u4e8eAPS\u672c\u8eab\u5c31\u63d0\u4f9b\u4e86\u826f\u597d\u7684api\uff0c\u6240\u4ee5\u6211\u4eec\u7b80\u6613\u5c01\u88c5\u4e00\u4e0b\u5373\u53ef\u3002 @staticmethod def edit_test_plan ( plan_id , plan_name , cron ): \"\"\" \u901a\u8fc7\u6d4b\u8bd5\u8ba1\u5212id\uff0c\u66f4\u65b0\u6d4b\u8bd5\u8ba1\u5212\u4efb\u52a1\u7684cron\uff0cname\u7b49\u6570\u636e :param plan_id: :param plan_name: :param cron: :return: \"\"\" Scheduler . scheduler . modify_job ( job_id = str ( plan_id ), trigger = CronTrigger . from_crontab ( cron ), name = plan_name ) @staticmethod def pause_resume_test_plan ( plan_id , status ): \"\"\" \u6682\u505c\u6216\u6062\u590d\u6d4b\u8bd5\u8ba1\u5212\uff0c\u4f1a\u5f71\u54cd\u5230next_run_at :param plan_id: :param status: :return: \"\"\" if status : Scheduler . scheduler . resume_job ( job_id = str ( plan_id )) else : Scheduler . scheduler . pause_job ( job_id = str ( plan_id )) @staticmethod def remove ( plan_id ): \"\"\" \u5220\u9664job\uff0c\u5f53\u5220\u9664\u6d4b\u8bd5\u8ba1\u5212\u65f6\uff0c\u8c03\u7528\u6b64\u65b9\u6cd5 :param plan_id: :return: \"\"\" Scheduler . scheduler . remove_job ( str ( plan_id )) \u8fd9\u8fb9\u5df2\u7ecf\u90fd\u5199\u597d\u4e86 \u6ce8\u91ca \uff0c\u81f3\u4e8e\u4e3a\u4ec0\u4e48\u6211\u4eec\u9700\u8981 pause\u548cresume\u65b9\u6cd5\u5462 \uff0c\u662f\u56e0\u4e3a\u6709\u65f6\u5019\u6211\u4eec\u53ef\u80fd\u4e0d\u592a\u60f3\u8dd1\u8fd9\u4e2a\u4efb\u52a1\uff0c\u6211\u4eec\u60f3\u5148\u6682\u505c\u4e00\u4e0b\uff0c\u6240\u4ee5\u6709\u8fd9\u4e2a\u60c5\u51b5\u53d1\u751f\u3002 \u4fee\u6539\u5bf9\u5e94\u7684\u63a5\u53e3 \u6211\u4eec\u6765\u6d4b\u8bd5\u4e0b\u6682\u505c\u529f\u80fd: \u6682\u505c\u4e4b\u524d\u83b7\u53d6\u6d4b\u8bd5\u8ba1\u5212\u5217\u8868 \u6682\u505c\u4e4b\u540e \u53ef\u4ee5\u770b\u5230\uff0c\u7531\u4e8enext_run_at\u4e3aNone\u4e86\uff0c\u6240\u4ee5\u6211\u4eec\u4e4b\u524d\u7684strftime\u5931\u6548\u4e86\u3002 \u6240\u4ee5\u6211\u4eec\u8981\u505a\u4e0b\u8c03\u6574: \u6240\u4ee5\u6211\u4eectestplan\u6709\u4e863\u4e2a\u72b6\u6001: 0\uff1a\u7b49\u5f85\u4e2d 1: \u6267\u884c\u4e2d 2: \u5b9a\u65f6\u4efb\u52a1\u672a\u6dfb\u52a0 3: \u5b9a\u65f6\u4efb\u52a1\u5df2\u6682\u505c \u6709\u4e86\u8fd9\u4e9b\u6570\u636e\uff0c\u6211\u4eec\u524d\u7aef\u5c31\u77e5\u9053\u8981\u600e\u4e48\u5c55\u793a\u6d4b\u8bd5\u8ba1\u5212\u7684\u5b9a\u65f6\u4efb\u52a1\u72b6\u6001\u4e86\u3002 \u4e0b\u4e00\u8282\u6211\u4eec\u5c31\u8981\u5f00\u59cb\u7f16\u5199 \u6d4b\u8bd5\u8ba1\u5212\u9875\u9762 \u7684\u524d\u7aef\u90e8\u5206\u4e86\u3002","title":"75.\u5b8c\u5584\u6d4b\u8bd5\u8ba1\u5212\u7684\u5220\u6539\u67e5\u529f\u80fd"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2875%29%20%E5%AE%8C%E5%96%84%E6%B5%8B%E8%AF%95%E8%AE%A1%E5%88%92%E7%9A%84%E5%88%A0%E6%94%B9%E6%9F%A5%E5%8A%9F%E8%83%BD/#_1","text":"\u4e0a\u4e00\u8282\u6211\u4eec\u5199\u597d\u4e86\u4e00\u4e2a \u6d4b\u8bd5\u8ba1\u5212 \u7684\u521d\u7ea7\u7248\u672c\uff0c\u5e76\u4e14\u80fd\u591f\u6dfb\u52a0\u8ba1\u5212\uff0c\u4e5f\u80fd\u5b9a\u65f6\u6267\u884c\u3002\u90a3\u4eca\u5929\u6211\u4eec\u5c31\u6765\u5b8c\u5584\u6d4b\u8bd5\u8ba1\u5212 \u5220\u6539\u67e5 \u4e0eAPScheduler\u76f8\u7ed3\u5408\u7684\u90e8\u5206\u3002","title":"\u56de\u987e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2875%29%20%E5%AE%8C%E5%96%84%E6%B5%8B%E8%AF%95%E8%AE%A1%E5%88%92%E7%9A%84%E5%88%A0%E6%94%B9%E6%9F%A5%E5%8A%9F%E8%83%BD/#_2","text":"\u76ee\u524d\u6765\u770b\uff0c\u6d4b\u8bd5\u8ba1\u5212\u548c\u5b9a\u65f6\u4efb\u52a1\u6709\u7740\u9ad8\u5ea6\u7684\u8026\u5408\uff0c\u8003\u8651\u5230\u6211\u4eec \u5e76\u4e0d\u6253\u7b97\u505a\u4e00\u6b3e\u81ea\u7531\u5ea6\u9ad8\u7684\u5b9a\u65f6job\u7cfb\u7edf \uff0c\u6240\u4ee5\u6682\u65f6\u5c31\u5148\u6309\u8fd9\u4e2a\u601d\u8def\u8bbe\u8ba1\u3002\u6bd5\u7adf\u6211\u4eec\u662f\u4e00\u4e2a\u505a\u63a5\u53e3\u81ea\u52a8\u5316\u7684\u5e73\u53f0\uff0c\u800c\u4e0d\u662f\u7c7b\u4f3c jenkins \u4e00\u6837\uff0c\u6709\u5404\u7c7b\u4efb\u52a1\u7684\u5e73\u53f0\u3002\u5982\u679c\u540e\u7eed\u6709\u76f8\u5173\u7684\u9700\u6c42\uff0c\u6211\u4eec\u518d\u8003\u8651\u3002 \u6240\u4ee5\u73b0\u5728\u7684\u60c5\u51b5\u662f\uff0c\u5b9a\u65f6\u4efb\u52a1\u5217\u8868\u5b58\u653e\u4e86\u4e00\u6279 job\u6570\u636e \uff0c\u6d4b\u8bd5\u8ba1\u5212\u8868\u53c8\u5b58\u653e\u4e86\u4e0e\u4e4b\u5bf9\u5e94\u7684\u6d4b\u8bd5\u8ba1\u5212\u6570\u636e\u3002","title":"\u5b9a\u65f6\u4efb\u52a1\u548c\u6d4b\u8bd5\u8ba1\u5212\u7684\u8026\u5408"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2875%29%20%E5%AE%8C%E5%96%84%E6%B5%8B%E8%AF%95%E8%AE%A1%E5%88%92%E7%9A%84%E5%88%A0%E6%94%B9%E6%9F%A5%E5%8A%9F%E8%83%BD/#_3","text":"\u6211\u4eec\u4e4b\u524d\u4e0d\u662f\u6dfb\u52a0\u8fc7\u4e00\u4e2a\u5b9a\u65f6\u4efb\u52a1\u5417\uff1f\u6211\u4eec\u5148\u6765\u770b\u770b\u7528APScheduler\u7684api\uff0c\u83b7\u53d6\u5230\u7684\u6570\u636e\u5185\u5bb9\u3002\u8fd9\u65f6\u5019\u5c31\u9700\u8981debug\u4e86~ Scheduler\u5bf9\u8c61\u662f\u6709\u4e2aget_job\u7684\u65b9\u6cd5\uff0c\u6211\u4eec\u4e4b\u524d\u7ed9job\u7684id\u5b9a\u4e49\u4e3a\u6d4b\u8bd5\u8ba1\u5212\u7684id\u3002 \u6240\u4ee5\u6211\u4eec\u73b0\u5728\u53ef\u4ee5\u7528\u6d4b\u8bd5\u8ba1\u5212\u7684id\u53bb\u67e5\u8be2\u5b9a\u65f6\u4efb\u52a1\u7684\u4e00\u4e9b\u4fe1\u606f\u3002 \u5728utils/scheduler.py\u65b0\u589elist_test_plan\u65b9\u6cd5: @staticmethod def list_test_plan ( data : List ): for d in data : job = Scheduler . scheduler . get_job ( str ( d . get ( 'id' ))) print ( job ) d [ \"next_run\" ] = job . next_run_time \u4f20\u5165\u7684data\u662f\u67e5\u8be2\u6d4b\u8bd5\u8ba1\u5212\u63a5\u53e3\u62ff\u5230\u7684 \u6d4b\u8bd5\u8ba1\u5212\u6570\u636e \u3002 \u8fc7\u7a0b\u5982\u4e0b: \u83b7\u53d6\u5230\u6d4b\u8bd5\u8ba1\u5212\u6570\u636e \u6839\u636e\u6d4b\u8bd5\u8ba1\u5212\u6570\u636e\u53bb\u83b7\u53d6\u5230\u5b9a\u65f6\u4efb\u52a1\u7684\u6570\u636e \u4e00\u5e76\u8fd4\u56de \u5176\u5b9e\u6211\u8fd9\u91cc\u5f31\u5316\u4e86\u5b9a\u65f6\u4efb\u52a1\u7684\u7279\u70b9\uff0c\u53cd\u800c\u628acron\u8fd9\u6837\u7684\u5b57\u6bb5\u5265\u79bb\u5230 \u6d4b\u8bd5\u8ba1\u5212 \u4e4b\u4e2d\u4e86\u3002\u6240\u4ee5\u8fd9\u4e2a\u5b9a\u65f6\u4efb\u52a1\u7ed9\u6211\u4eec\u7684\u4f5c\u7528\u5c31\u53ea\u67092\u4e2a: \u5b83\u662f\u4e0d\u662f\u5b58\u5728 \u5b83\u662f\u5426\u6b63\u5e38\u5de5\u4f5c\uff0c\u53ef\u4ee5\u901a\u8fc7next_run_at\u6765\u5224\u65ad \u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u5728\u67e5\u8be2\u63a5\u53e3\uff0c\u52a0\u4e0anext_run_at\u5c31\u53ef\u4ee5\u4e86\u3002 \u8fd9\u70b9\u5f88\u91cd\u8981\uff0c\u56e0\u4e3a\u6211\u4eec\u53ef\u80fd \u521b\u5efa\u6d4b\u8bd5\u8ba1\u5212\u6210\u529f \u4e86\uff0c\u4f46 \u521b\u5efa\u5b9a\u65f6\u4efb\u52a1\u5931\u8d25 \u4e86\u3002\u6240\u4ee5\u8fd9\u4e2a\u6570\u636e\u4e0d\u53ef\u5ffd\u7565\u3002 \u5f53\u6211\u4eec\u6ca1\u83b7\u53d6\u5230job\u7684\u65f6\u5019\uff0c\u628ajob\u7684state\u6539\u4e3a2\uff08\u5e76\u975e\u5728\u6570\u636e\u5e93\u6539\uff09\uff0c\u53ea\u662f\u5728\u9875\u9762\u4e0a\u663e\u793a\u8fd9\u4e2a\u6d4b\u8bd5\u8ba1\u5212\u4efb\u52a1\u672a\u6dfb\u52a0\u6210\u529f\uff01\uff01\uff01","title":"\u67e5\u8be2\u5b9a\u65f6\u4efb\u52a1"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2875%29%20%E5%AE%8C%E5%96%84%E6%B5%8B%E8%AF%95%E8%AE%A1%E5%88%92%E7%9A%84%E5%88%A0%E6%94%B9%E6%9F%A5%E5%8A%9F%E8%83%BD/#_4","text":"\u7531\u4e8eAPS\u672c\u8eab\u5c31\u63d0\u4f9b\u4e86\u826f\u597d\u7684api\uff0c\u6240\u4ee5\u6211\u4eec\u7b80\u6613\u5c01\u88c5\u4e00\u4e0b\u5373\u53ef\u3002 @staticmethod def edit_test_plan ( plan_id , plan_name , cron ): \"\"\" \u901a\u8fc7\u6d4b\u8bd5\u8ba1\u5212id\uff0c\u66f4\u65b0\u6d4b\u8bd5\u8ba1\u5212\u4efb\u52a1\u7684cron\uff0cname\u7b49\u6570\u636e :param plan_id: :param plan_name: :param cron: :return: \"\"\" Scheduler . scheduler . modify_job ( job_id = str ( plan_id ), trigger = CronTrigger . from_crontab ( cron ), name = plan_name ) @staticmethod def pause_resume_test_plan ( plan_id , status ): \"\"\" \u6682\u505c\u6216\u6062\u590d\u6d4b\u8bd5\u8ba1\u5212\uff0c\u4f1a\u5f71\u54cd\u5230next_run_at :param plan_id: :param status: :return: \"\"\" if status : Scheduler . scheduler . resume_job ( job_id = str ( plan_id )) else : Scheduler . scheduler . pause_job ( job_id = str ( plan_id )) @staticmethod def remove ( plan_id ): \"\"\" \u5220\u9664job\uff0c\u5f53\u5220\u9664\u6d4b\u8bd5\u8ba1\u5212\u65f6\uff0c\u8c03\u7528\u6b64\u65b9\u6cd5 :param plan_id: :return: \"\"\" Scheduler . scheduler . remove_job ( str ( plan_id )) \u8fd9\u8fb9\u5df2\u7ecf\u90fd\u5199\u597d\u4e86 \u6ce8\u91ca \uff0c\u81f3\u4e8e\u4e3a\u4ec0\u4e48\u6211\u4eec\u9700\u8981 pause\u548cresume\u65b9\u6cd5\u5462 \uff0c\u662f\u56e0\u4e3a\u6709\u65f6\u5019\u6211\u4eec\u53ef\u80fd\u4e0d\u592a\u60f3\u8dd1\u8fd9\u4e2a\u4efb\u52a1\uff0c\u6211\u4eec\u60f3\u5148\u6682\u505c\u4e00\u4e0b\uff0c\u6240\u4ee5\u6709\u8fd9\u4e2a\u60c5\u51b5\u53d1\u751f\u3002","title":"\u7f16\u5199\u7f16\u8f91/\u5220\u9664\u5b9a\u65f6\u4efb\u52a1\u65b9\u6cd5"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2875%29%20%E5%AE%8C%E5%96%84%E6%B5%8B%E8%AF%95%E8%AE%A1%E5%88%92%E7%9A%84%E5%88%A0%E6%94%B9%E6%9F%A5%E5%8A%9F%E8%83%BD/#_5","text":"\u6211\u4eec\u6765\u6d4b\u8bd5\u4e0b\u6682\u505c\u529f\u80fd: \u6682\u505c\u4e4b\u524d\u83b7\u53d6\u6d4b\u8bd5\u8ba1\u5212\u5217\u8868 \u6682\u505c\u4e4b\u540e \u53ef\u4ee5\u770b\u5230\uff0c\u7531\u4e8enext_run_at\u4e3aNone\u4e86\uff0c\u6240\u4ee5\u6211\u4eec\u4e4b\u524d\u7684strftime\u5931\u6548\u4e86\u3002 \u6240\u4ee5\u6211\u4eec\u8981\u505a\u4e0b\u8c03\u6574: \u6240\u4ee5\u6211\u4eectestplan\u6709\u4e863\u4e2a\u72b6\u6001: 0\uff1a\u7b49\u5f85\u4e2d 1: \u6267\u884c\u4e2d 2: \u5b9a\u65f6\u4efb\u52a1\u672a\u6dfb\u52a0 3: \u5b9a\u65f6\u4efb\u52a1\u5df2\u6682\u505c \u6709\u4e86\u8fd9\u4e9b\u6570\u636e\uff0c\u6211\u4eec\u524d\u7aef\u5c31\u77e5\u9053\u8981\u600e\u4e48\u5c55\u793a\u6d4b\u8bd5\u8ba1\u5212\u7684\u5b9a\u65f6\u4efb\u52a1\u72b6\u6001\u4e86\u3002 \u4e0b\u4e00\u8282\u6211\u4eec\u5c31\u8981\u5f00\u59cb\u7f16\u5199 \u6d4b\u8bd5\u8ba1\u5212\u9875\u9762 \u7684\u524d\u7aef\u90e8\u5206\u4e86\u3002","title":"\u4fee\u6539\u5bf9\u5e94\u7684\u63a5\u53e3"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2876%29%20%E7%BC%96%E5%86%99%E6%B5%8B%E8%AF%95%E8%AE%A1%E5%88%92%E5%89%8D%E7%AB%AF%E9%83%A8%E5%88%86/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684\u5b8c\u6574 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u6d4b\u8bd5\u5f00\u53d1\u5751\u8d27 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u7f16\u5199\u4e86 \u6d4b\u8bd5\u8ba1\u5212 \u4e0e APScheduler \u76f8\u7ed3\u5408\u7684\u65b9\u6cd5\uff0c\u5b9a\u65f6\u4efb\u52a1\u4e5f\u80fd\u591f\u6b63\u5e38 \u8dd1\u8d77\u6765\u4e86 \u3002 \u8fd9\u4e00\u8282\u6211\u4eec\u5c31\u7b80\u5355\u804a\u804a\u524d\u7aef\u600e\u4e48\u53bb\u505a\uff0c\u6700\u8fd1\u5929\u6c14\u53d8\u51b7\u4e86\uff0c\u535a\u4e3b\u4e5f\u611f\u5192\u4e86\u3002\u81ea\u5df1\u5199\u7684\u8fc7\u7a0b\u4e2d\u53d1\u73b0\u8bb8\u591a\u9519\u8bef\uff0c\u5982\u679c\u6709\u51fa\u9519\u7684\u5730\u65b9\u5e0c\u671b\u5927\u5bb6\u5e2e\u5fd9\u6307\u51fa\u4e0b =\u3002= \u5148\u8c08\u8bbe\u8ba1 \u5982\u679c\u50cf\u4ee5\u5f80\u7684\u6a21\u5f0f\uff0c\u653e\u4e00\u4e2a \u8868\u683c \uff0c\u91cc\u9762\u5c55\u793a\u6bcf\u4e2a\u6d4b\u8bd5\u8ba1\u5212\u7684\u76f8\u5173\u4fe1\u606f\u3002 \u6dfb\u52a0\u548c\u5220\u9664\u5462\uff0c\u5c31\u653e\u5230modal\u5bf9\u8bdd\u6846\u91cc\u9762\u3002\u8868\u5355\u7684\u5185\u5bb9\u7528\u6237\u586b\u5199\u5c31\u597d\u4e86\uff0c\u90a3\u8fd9\u4e2acurd\u7684\u9875\u9762\u5c31\u53ef\u4ee5\u5f88\u5feb \u5b8c\u6210 \u3002 \u4f46\u60f3\u4e00\u4e0b\uff0c\u6211\u4eec\u7684\u6d4b\u8bd5\u8ba1\u5212\u662f\u4e00\u4e2a\u6bd4\u8f83 \u590d\u6742 \u7684\u6570\u636e\u3002\u5728\u6211\u7684\u60f3\u6cd5\u4e2d\uff0c\u4ed6\u5e94\u8be5\u5177\u5907\u8fd9\u4e9b\u6761\u4ef6: \u591a\u6761\u4ef6\u641c\u7d22 \u53ef\u4ee5\u6839\u636e\u9879\u76ee\uff0c\u6d4b\u8bd5\u8ba1\u5212\u540d\u79f0\uff0c\u4f18\u5148\u7ea7\uff0c\u521b\u5efa\u4eba\u7b49\u6761\u4ef6\u8fdb\u884c\u641c\u7d22\u3002\u540e\u7eed\u8fd8\u53ef\u80fd\u6839\u636e\u521b\u5efa\u65f6\u95f4\u641c\u7d22\u5565\u7684\u3002 \u6b65\u9aa4\u6e05\u6670 \u6211\u60f3\u628a\u8fd9\u5757\u5206\u4e3a3\u5757: \u57fa\u672c\u4fe1\u606f \u7528\u4f8b\u6570\u636e \u901a\u77e5\u914d\u7f6e \u987a\u7740\u8fd9\u4e2a\u60f3\u6cd5\uff0c\u6240\u4ee5\u6211\u627e\u5230\u4e86antd\u7684steps(\u6b65\u9aa4\u6761)\uff0c\u8ba9\u7528\u6237\u5f55\u5165\u6570\u636e\u7684\u65f6\u5019\u4e5f\u6709\u4e00\u5b9a\u7684\u6761\u7406\uff0c\u63d0\u5347\u4f53\u9a8c\u3002 \u7f16\u5199TestPlan.jsx\u7ec4\u4ef6 import {PageContainer} from \"@ant-design/pro-layout\"; import {connect} from 'umi'; import {Badge, Button, Card, Col, Divider, Form, Input, Row, Select, Table, Tag, Tooltip} from \"antd\"; import React, {useEffect} from \"react\"; import {CONFIG} from \"@/consts/config\"; import {PlusOutlined} from \"@ant-design/icons\"; import TestPlanForm from \"@/components/TestCase/TestPlanForm\"; const {Option} = Select; const TestPlan = ({testplan, dispatch, loading, gconfig, user, project}) => { const {planData} = testplan; const {userList, userMap} = user; const {projectsMap, projects} = project; // const {envList} = gconfig; const getStatus = record => { if (record.state === 2) { return <Tooltip title=\"\u5b9a\u65f6\u4efb\u52a1\u53ef\u80fd\u6dfb\u52a0\u5931\u8d25, \u8bf7\u5c1d\u8bd5\u91cd\u65b0\u6dfb\u52a0\"><Badge status=\"error\" text=\"\u51fa\u9519\"/></Tooltip> } if (record.state === 3) { return <Tooltip title=\"\u4efb\u52a1\u5df2\u6682\u505c\"><Badge status=\"warning\" text=\"\u5df2\u6682\u505c\"/></Tooltip> } if (record.state === 1) { return <Tooltip title=\"\u4efb\u52a1\u6b63\u5728\u6267\u884c\u4e2d\"><Badge status=\"processing\" text=\"\u6267\u884c\u4e2d\"/></Tooltip> } return <Tooltip title={`\u4e0b\u6b21\u8fd0\u884c\u65f6\u95f4: ${record.next_run}`}> <Badge status=\"success\" text=\"\u7b49\u5f85\u4e2d\"/> </Tooltip> } const columns = [ { title: '\u9879\u76ee', key: 'project_id', dataIndex: 'project_id', render: projectId => <a href={`/#/apiTest/project/${projectId}`} target=\"_blank\" rel=\"noreferrer\">{projectsMap[projectId] || 'loading'}</a> }, { title: '\u6d4b\u8bd5\u8ba1\u5212', key: 'name', dataIndex: 'name' }, { title: '\u4f18\u5148\u7ea7', key: 'priority', dataIndex: 'priority', render: priority => <Tag color={CONFIG.CASE_TAG[priority]}>{priority}</Tag> }, { title: 'cron\u8868\u8fbe\u5f0f', key: 'cron', dataIndex: 'cron', }, { title: '\u987a\u5e8f\u6267\u884c', key: 'ordered', dataIndex: 'ordered', render: bool => bool ? <Tag color=\"blue\">\u662f</Tag> : <Tag>\u5426</Tag> }, { title: '\u7528\u4f8b\u6570\u91cf', key: 'case_list', dataIndex: 'case_list', render: caseList => caseList.split(\",\").length, }, { title: '\u72b6\u6001', key: 'next_run', dataIndex: 'next_run', render: (_, record) => getStatus(record) }, { title: '\u521b\u5efa\u4eba', key: 'create_user', dataIndex: 'create_user', render: create_user => userMap[create_user] !== undefined ? userMap[create_user].name : '\u52a0\u8f7d\u4e2d...' }, { title: '\u64cd\u4f5c', key: 'ops', render: () => <> <a>\u7f16\u8f91</a> <Divider type=\"vertical\"/> <a>\u5220\u9664</a> </> }, ] // form\u67e5\u8be2\u6761\u4ef6 const [form] = Form.useForm(); const spin = loading.effects['testplan/listTestPlan'] || loading.effects['project/listProject'] const fetchTestPlan = () => { const values = form.getFieldsValue(); dispatch({ type: 'testplan/listTestPlan', payload: { page: 1, size: 10, ...values, } }) } const fetchProjectList = () => { dispatch({ type: 'project/listProject', }) } const fetchUsers = () => { if (userList.length === 0) { dispatch({ type: 'user/fetchUserList', }) } } const fetchEnvList = () => { dispatch({ type: 'gconfig/fetchEnvList', payload: { page: 1, size: 1000, exactly: true // \u5168\u90e8\u83b7\u53d6 } }) } const onSave = data => { dispatch({ type: 'testplan/save', payload: data }) } useEffect(() => { fetchEnvList() fetchUsers() fetchProjectList() fetchTestPlan() }, []) return ( <PageContainer title={false}> <Card> <TestPlanForm/> <Form form={form} {...CONFIG.LAYOUT} onValuesChange={() => { fetchTestPlan(); }}> <Row gutter={[12, 12]}> <Col span={6}> <Form.Item label=\"\u9879\u76ee\" name=\"project_id\"> <Select allowClear showSearch placeholder=\"\u9009\u62e9\u9879\u76ee\"> {projects.map(item => <Option value={item.id} key={item.id}>{item.name}</Option>)} </Select> </Form.Item> </Col> <Col span={6}> <Form.Item label=\"\u540d\u79f0\" name=\"name\"> <Input placeholder=\"\u8f93\u5165\u6d4b\u8bd5\u8ba1\u5212\u540d\u79f0\"/> </Form.Item> </Col> <Col span={6}> <Form.Item label=\"\u4f18\u5148\u7ea7\" name=\"priority\"> <Select placeholder=\"\u9009\u62e9\u4f18\u5148\u7ea7\" allowClear> {CONFIG.PRIORITY.map(v => <Option key={v} value={v}>{v}</Option>)} </Select> </Form.Item> </Col> <Col span={6}> <Form.Item label=\"\u521b\u5efa\u4eba\" name=\"state\"> <Select placeholder=\"\u9009\u62e9\u521b\u5efa\u4eba\" showSearch allowClear> {userList.map(item => <Option key={item.id} value={item.id}>{item.name}</Option>)} </Select> </Form.Item> </Col> </Row> </Form> <Row style={{marginBottom: 12}}> <Button type=\"primary\" onClick={() => { onSave({visible: true, title: '\u65b0\u589e\u6d4b\u8bd5\u8ba1\u5212'}) }}><PlusOutlined/> \u6dfb\u52a0\u8ba1\u5212</Button> </Row> <Table columns={columns} dataSource={planData} rowKey={row => row.id} loading={spin}/> </Card> </PageContainer> ) } export default connect(({testplan, project, user, loading, gconfig}) => ({ testplan, project, loading, user, gconfig, }))(TestPlan); \u8bb2\u89e3\u4e00\u4e0b\u4ee3\u7801\uff0c\u6838\u5fc3\u8fd8\u662f\u901a\u8fc7dva\u7684model-service\u8fd9\u79cd \u7c7bredux \u7ba1\u7406\u72b6\u6001\u3002 \u7ed3\u5408\u6700\u65b0\u7684useEffect\uff0c\u83b7\u53d6\u5230\u6d4b\u8bd5\u8ba1\u5212\u4fe1\u606f\u3002 \u628a\u641c\u7d22\u9009\u9879\u653e\u5230\u8868\u5355\u4e2d\uff0c\u5e76\u7ed9form\u8bbe\u7f6eonValuesChange\u65b9\u6cd5\uff0c\u5f53\u6570\u636e\u6709\u53d8\u52a8\u7684\u65f6\u5019\u81ea\u52a8\u91cd\u65b0\u67e5\u8be2 \u6d4b\u8bd5\u8ba1\u5212 \u3002\u8fd9\u6837\u907f\u514d\u4e86 \u4eba\u8089\u518d\u70b9\u51fb\u4e00\u6b21 \u641c\u7d22\u6309\u94ae \u3002 \u6548\u679c\u56fe\u5982\u4e0b: \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u8fd9\u91cc\u5c55\u793a\u4e86\u5927\u90e8\u5206\u6570\u636e\uff0c\u5982\u679c\u60f3\u770b\u66f4\u591a\u5185\u5bb9\uff0c\u9700\u8981\u70b9\u51fb \u7f16\u8f91 \u6309\u94ae\u67e5\u770b\u4e86\u3002 \u7f16\u5199\u521b\u5efa\u6d4b\u8bd5\u8ba1\u5212\u8868\u5355\u7ec4\u4ef6 \u8be5\u7ec4\u4ef6\u8fd8\u662f\u4e00\u4e2aModal\uff0c\u6309\u7167\u6211\u4eec\u521a\u624d\u8bf4\u76843\u4e2a\u5b57\u6bb5\u53bb\u5206\u914d\u5bf9\u5e94\u7684\u677f\u5757\uff0c\u5927\u6982\u6837\u5f0f\u5982\u4e0b: \u7531\u4e8e\u6d4b\u8bd5\u7528\u4f8b\u7684\u9009\u62e9\uff0c\u8fd8\u6ca1\u6709\u786e\u5b9a\uff0c\u6240\u4ee5\u6682\u65f6\u8fd8\u9700\u8981\u6162\u6162\u8bbe\u8ba1\u3002\u4e2a\u4eba\u611f\u89c9\u81ea\u5df1\u524d\u7aef\u90e8\u5206\u5199\u8d77\u6765\u8fd8\u662f\u504f\u6162\uff0c\u524d\u9762\u8fd8\u6709\u597d\u591a\u5751\u6ca1\u6709\u586b\u3002 \u4eca\u5929\u7684\u5185\u5bb9\u5c31\u5148\u4ecb\u7ecd\u5230\u8fd9\u91cc\u5427\uff0c\u4e0b\u4e00\u8282\u6211\u4eec\u6f14\u793a\u4e0b\u505a\u597d\u7684 \u6d4b\u8bd5\u8ba1\u5212\u9875\u9762 \u4ee5\u53ca\u89e3\u51b3\u591aworkers\u4e0b\u7684APScheduler\u5355\u4e2a\u4efb\u52a1\u91cd\u590d\u6267\u884c\u7684\u95ee\u9898\u3002 \u5728\u7ebf\u4f53\u9a8c\u5730\u5740: http://test.pity.fun","title":"76.\u7f16\u5199\u6d4b\u8bd5\u8ba1\u5212\u524d\u7aef\u90e8\u5206"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2876%29%20%E7%BC%96%E5%86%99%E6%B5%8B%E8%AF%95%E8%AE%A1%E5%88%92%E5%89%8D%E7%AB%AF%E9%83%A8%E5%88%86/#_1","text":"\u4e0a\u4e00\u8282\u6211\u4eec\u7f16\u5199\u4e86 \u6d4b\u8bd5\u8ba1\u5212 \u4e0e APScheduler \u76f8\u7ed3\u5408\u7684\u65b9\u6cd5\uff0c\u5b9a\u65f6\u4efb\u52a1\u4e5f\u80fd\u591f\u6b63\u5e38 \u8dd1\u8d77\u6765\u4e86 \u3002 \u8fd9\u4e00\u8282\u6211\u4eec\u5c31\u7b80\u5355\u804a\u804a\u524d\u7aef\u600e\u4e48\u53bb\u505a\uff0c\u6700\u8fd1\u5929\u6c14\u53d8\u51b7\u4e86\uff0c\u535a\u4e3b\u4e5f\u611f\u5192\u4e86\u3002\u81ea\u5df1\u5199\u7684\u8fc7\u7a0b\u4e2d\u53d1\u73b0\u8bb8\u591a\u9519\u8bef\uff0c\u5982\u679c\u6709\u51fa\u9519\u7684\u5730\u65b9\u5e0c\u671b\u5927\u5bb6\u5e2e\u5fd9\u6307\u51fa\u4e0b =\u3002=","title":"\u56de\u987e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2876%29%20%E7%BC%96%E5%86%99%E6%B5%8B%E8%AF%95%E8%AE%A1%E5%88%92%E5%89%8D%E7%AB%AF%E9%83%A8%E5%88%86/#_2","text":"\u5982\u679c\u50cf\u4ee5\u5f80\u7684\u6a21\u5f0f\uff0c\u653e\u4e00\u4e2a \u8868\u683c \uff0c\u91cc\u9762\u5c55\u793a\u6bcf\u4e2a\u6d4b\u8bd5\u8ba1\u5212\u7684\u76f8\u5173\u4fe1\u606f\u3002 \u6dfb\u52a0\u548c\u5220\u9664\u5462\uff0c\u5c31\u653e\u5230modal\u5bf9\u8bdd\u6846\u91cc\u9762\u3002\u8868\u5355\u7684\u5185\u5bb9\u7528\u6237\u586b\u5199\u5c31\u597d\u4e86\uff0c\u90a3\u8fd9\u4e2acurd\u7684\u9875\u9762\u5c31\u53ef\u4ee5\u5f88\u5feb \u5b8c\u6210 \u3002 \u4f46\u60f3\u4e00\u4e0b\uff0c\u6211\u4eec\u7684\u6d4b\u8bd5\u8ba1\u5212\u662f\u4e00\u4e2a\u6bd4\u8f83 \u590d\u6742 \u7684\u6570\u636e\u3002\u5728\u6211\u7684\u60f3\u6cd5\u4e2d\uff0c\u4ed6\u5e94\u8be5\u5177\u5907\u8fd9\u4e9b\u6761\u4ef6: \u591a\u6761\u4ef6\u641c\u7d22 \u53ef\u4ee5\u6839\u636e\u9879\u76ee\uff0c\u6d4b\u8bd5\u8ba1\u5212\u540d\u79f0\uff0c\u4f18\u5148\u7ea7\uff0c\u521b\u5efa\u4eba\u7b49\u6761\u4ef6\u8fdb\u884c\u641c\u7d22\u3002\u540e\u7eed\u8fd8\u53ef\u80fd\u6839\u636e\u521b\u5efa\u65f6\u95f4\u641c\u7d22\u5565\u7684\u3002 \u6b65\u9aa4\u6e05\u6670 \u6211\u60f3\u628a\u8fd9\u5757\u5206\u4e3a3\u5757: \u57fa\u672c\u4fe1\u606f \u7528\u4f8b\u6570\u636e \u901a\u77e5\u914d\u7f6e \u987a\u7740\u8fd9\u4e2a\u60f3\u6cd5\uff0c\u6240\u4ee5\u6211\u627e\u5230\u4e86antd\u7684steps(\u6b65\u9aa4\u6761)\uff0c\u8ba9\u7528\u6237\u5f55\u5165\u6570\u636e\u7684\u65f6\u5019\u4e5f\u6709\u4e00\u5b9a\u7684\u6761\u7406\uff0c\u63d0\u5347\u4f53\u9a8c\u3002","title":"\u5148\u8c08\u8bbe\u8ba1"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2876%29%20%E7%BC%96%E5%86%99%E6%B5%8B%E8%AF%95%E8%AE%A1%E5%88%92%E5%89%8D%E7%AB%AF%E9%83%A8%E5%88%86/#testplanjsx","text":"import {PageContainer} from \"@ant-design/pro-layout\"; import {connect} from 'umi'; import {Badge, Button, Card, Col, Divider, Form, Input, Row, Select, Table, Tag, Tooltip} from \"antd\"; import React, {useEffect} from \"react\"; import {CONFIG} from \"@/consts/config\"; import {PlusOutlined} from \"@ant-design/icons\"; import TestPlanForm from \"@/components/TestCase/TestPlanForm\"; const {Option} = Select; const TestPlan = ({testplan, dispatch, loading, gconfig, user, project}) => { const {planData} = testplan; const {userList, userMap} = user; const {projectsMap, projects} = project; // const {envList} = gconfig; const getStatus = record => { if (record.state === 2) { return <Tooltip title=\"\u5b9a\u65f6\u4efb\u52a1\u53ef\u80fd\u6dfb\u52a0\u5931\u8d25, \u8bf7\u5c1d\u8bd5\u91cd\u65b0\u6dfb\u52a0\"><Badge status=\"error\" text=\"\u51fa\u9519\"/></Tooltip> } if (record.state === 3) { return <Tooltip title=\"\u4efb\u52a1\u5df2\u6682\u505c\"><Badge status=\"warning\" text=\"\u5df2\u6682\u505c\"/></Tooltip> } if (record.state === 1) { return <Tooltip title=\"\u4efb\u52a1\u6b63\u5728\u6267\u884c\u4e2d\"><Badge status=\"processing\" text=\"\u6267\u884c\u4e2d\"/></Tooltip> } return <Tooltip title={`\u4e0b\u6b21\u8fd0\u884c\u65f6\u95f4: ${record.next_run}`}> <Badge status=\"success\" text=\"\u7b49\u5f85\u4e2d\"/> </Tooltip> } const columns = [ { title: '\u9879\u76ee', key: 'project_id', dataIndex: 'project_id', render: projectId => <a href={`/#/apiTest/project/${projectId}`} target=\"_blank\" rel=\"noreferrer\">{projectsMap[projectId] || 'loading'}</a> }, { title: '\u6d4b\u8bd5\u8ba1\u5212', key: 'name', dataIndex: 'name' }, { title: '\u4f18\u5148\u7ea7', key: 'priority', dataIndex: 'priority', render: priority => <Tag color={CONFIG.CASE_TAG[priority]}>{priority}</Tag> }, { title: 'cron\u8868\u8fbe\u5f0f', key: 'cron', dataIndex: 'cron', }, { title: '\u987a\u5e8f\u6267\u884c', key: 'ordered', dataIndex: 'ordered', render: bool => bool ? <Tag color=\"blue\">\u662f</Tag> : <Tag>\u5426</Tag> }, { title: '\u7528\u4f8b\u6570\u91cf', key: 'case_list', dataIndex: 'case_list', render: caseList => caseList.split(\",\").length, }, { title: '\u72b6\u6001', key: 'next_run', dataIndex: 'next_run', render: (_, record) => getStatus(record) }, { title: '\u521b\u5efa\u4eba', key: 'create_user', dataIndex: 'create_user', render: create_user => userMap[create_user] !== undefined ? userMap[create_user].name : '\u52a0\u8f7d\u4e2d...' }, { title: '\u64cd\u4f5c', key: 'ops', render: () => <> <a>\u7f16\u8f91</a> <Divider type=\"vertical\"/> <a>\u5220\u9664</a> </> }, ] // form\u67e5\u8be2\u6761\u4ef6 const [form] = Form.useForm(); const spin = loading.effects['testplan/listTestPlan'] || loading.effects['project/listProject'] const fetchTestPlan = () => { const values = form.getFieldsValue(); dispatch({ type: 'testplan/listTestPlan', payload: { page: 1, size: 10, ...values, } }) } const fetchProjectList = () => { dispatch({ type: 'project/listProject', }) } const fetchUsers = () => { if (userList.length === 0) { dispatch({ type: 'user/fetchUserList', }) } } const fetchEnvList = () => { dispatch({ type: 'gconfig/fetchEnvList', payload: { page: 1, size: 1000, exactly: true // \u5168\u90e8\u83b7\u53d6 } }) } const onSave = data => { dispatch({ type: 'testplan/save', payload: data }) } useEffect(() => { fetchEnvList() fetchUsers() fetchProjectList() fetchTestPlan() }, []) return ( <PageContainer title={false}> <Card> <TestPlanForm/> <Form form={form} {...CONFIG.LAYOUT} onValuesChange={() => { fetchTestPlan(); }}> <Row gutter={[12, 12]}> <Col span={6}> <Form.Item label=\"\u9879\u76ee\" name=\"project_id\"> <Select allowClear showSearch placeholder=\"\u9009\u62e9\u9879\u76ee\"> {projects.map(item => <Option value={item.id} key={item.id}>{item.name}</Option>)} </Select> </Form.Item> </Col> <Col span={6}> <Form.Item label=\"\u540d\u79f0\" name=\"name\"> <Input placeholder=\"\u8f93\u5165\u6d4b\u8bd5\u8ba1\u5212\u540d\u79f0\"/> </Form.Item> </Col> <Col span={6}> <Form.Item label=\"\u4f18\u5148\u7ea7\" name=\"priority\"> <Select placeholder=\"\u9009\u62e9\u4f18\u5148\u7ea7\" allowClear> {CONFIG.PRIORITY.map(v => <Option key={v} value={v}>{v}</Option>)} </Select> </Form.Item> </Col> <Col span={6}> <Form.Item label=\"\u521b\u5efa\u4eba\" name=\"state\"> <Select placeholder=\"\u9009\u62e9\u521b\u5efa\u4eba\" showSearch allowClear> {userList.map(item => <Option key={item.id} value={item.id}>{item.name}</Option>)} </Select> </Form.Item> </Col> </Row> </Form> <Row style={{marginBottom: 12}}> <Button type=\"primary\" onClick={() => { onSave({visible: true, title: '\u65b0\u589e\u6d4b\u8bd5\u8ba1\u5212'}) }}><PlusOutlined/> \u6dfb\u52a0\u8ba1\u5212</Button> </Row> <Table columns={columns} dataSource={planData} rowKey={row => row.id} loading={spin}/> </Card> </PageContainer> ) } export default connect(({testplan, project, user, loading, gconfig}) => ({ testplan, project, loading, user, gconfig, }))(TestPlan); \u8bb2\u89e3\u4e00\u4e0b\u4ee3\u7801\uff0c\u6838\u5fc3\u8fd8\u662f\u901a\u8fc7dva\u7684model-service\u8fd9\u79cd \u7c7bredux \u7ba1\u7406\u72b6\u6001\u3002 \u7ed3\u5408\u6700\u65b0\u7684useEffect\uff0c\u83b7\u53d6\u5230\u6d4b\u8bd5\u8ba1\u5212\u4fe1\u606f\u3002 \u628a\u641c\u7d22\u9009\u9879\u653e\u5230\u8868\u5355\u4e2d\uff0c\u5e76\u7ed9form\u8bbe\u7f6eonValuesChange\u65b9\u6cd5\uff0c\u5f53\u6570\u636e\u6709\u53d8\u52a8\u7684\u65f6\u5019\u81ea\u52a8\u91cd\u65b0\u67e5\u8be2 \u6d4b\u8bd5\u8ba1\u5212 \u3002\u8fd9\u6837\u907f\u514d\u4e86 \u4eba\u8089\u518d\u70b9\u51fb\u4e00\u6b21 \u641c\u7d22\u6309\u94ae \u3002 \u6548\u679c\u56fe\u5982\u4e0b: \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u8fd9\u91cc\u5c55\u793a\u4e86\u5927\u90e8\u5206\u6570\u636e\uff0c\u5982\u679c\u60f3\u770b\u66f4\u591a\u5185\u5bb9\uff0c\u9700\u8981\u70b9\u51fb \u7f16\u8f91 \u6309\u94ae\u67e5\u770b\u4e86\u3002","title":"\u7f16\u5199TestPlan.jsx\u7ec4\u4ef6"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2876%29%20%E7%BC%96%E5%86%99%E6%B5%8B%E8%AF%95%E8%AE%A1%E5%88%92%E5%89%8D%E7%AB%AF%E9%83%A8%E5%88%86/#_3","text":"\u8be5\u7ec4\u4ef6\u8fd8\u662f\u4e00\u4e2aModal\uff0c\u6309\u7167\u6211\u4eec\u521a\u624d\u8bf4\u76843\u4e2a\u5b57\u6bb5\u53bb\u5206\u914d\u5bf9\u5e94\u7684\u677f\u5757\uff0c\u5927\u6982\u6837\u5f0f\u5982\u4e0b: \u7531\u4e8e\u6d4b\u8bd5\u7528\u4f8b\u7684\u9009\u62e9\uff0c\u8fd8\u6ca1\u6709\u786e\u5b9a\uff0c\u6240\u4ee5\u6682\u65f6\u8fd8\u9700\u8981\u6162\u6162\u8bbe\u8ba1\u3002\u4e2a\u4eba\u611f\u89c9\u81ea\u5df1\u524d\u7aef\u90e8\u5206\u5199\u8d77\u6765\u8fd8\u662f\u504f\u6162\uff0c\u524d\u9762\u8fd8\u6709\u597d\u591a\u5751\u6ca1\u6709\u586b\u3002 \u4eca\u5929\u7684\u5185\u5bb9\u5c31\u5148\u4ecb\u7ecd\u5230\u8fd9\u91cc\u5427\uff0c\u4e0b\u4e00\u8282\u6211\u4eec\u6f14\u793a\u4e0b\u505a\u597d\u7684 \u6d4b\u8bd5\u8ba1\u5212\u9875\u9762 \u4ee5\u53ca\u89e3\u51b3\u591aworkers\u4e0b\u7684APScheduler\u5355\u4e2a\u4efb\u52a1\u91cd\u590d\u6267\u884c\u7684\u95ee\u9898\u3002 \u5728\u7ebf\u4f53\u9a8c\u5730\u5740: http://test.pity.fun","title":"\u7f16\u5199\u521b\u5efa\u6d4b\u8bd5\u8ba1\u5212\u8868\u5355\u7ec4\u4ef6"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2877%29%20%E5%AE%8C%E5%96%84%E6%B5%8B%E8%AF%95%E8%AE%A1%E5%88%92%E9%A1%B5%E9%9D%A2/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684\u5b8c\u6574 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u6d4b\u8bd5\u5f00\u53d1\u5751\u8d27 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u7c97\u7565\u4ecb\u7ecd\u4e86\u4e0b\u600e\u4e48\u8bbe\u8ba1 \u524d\u7aef \u9875\u9762\u3002\u65f6\u9694\u4e00\u65e5\uff0c\u535a\u4e3b\u5df2\u7ecf\u628a\u4ee3\u7801\u7801\u597d\u4e86\u3002 \u4e0d\u5f97\u4e0d\u8bf4\uff0c\u524d\u7aef\u4ee3\u7801\u8fd8\u662f\u975e\u5e38\u975e\u5e38\u96be\u5199\u7684\uff0c\u611f\u89c9\u540c\u6837\u662fcrud\uff0c\u5374\u6bd4\u540e\u7aef \u590d\u6742\u8bb8\u591a \u3002\u8fd9\u4e00\u8282\u6211\u4eec\u7ee7\u7eed\u8865\u5145\u8fd9\u5757\u5185\u5bb9\u3002 \u606d\u559cEDG\u83b7\u53d6S11\u51a0\u519b\uff0c EDG \u725b\u76ae\uff01\u8e6d\u4e2a\u70ed\u5ea6~ \u7ec6\u8282 \u7ec6\u8282\u90e8\u5206\u5927\u5bb6\u53ef\u4ee5\u53c2\u770b\u5177\u4f53\u7684 \u4ee3\u7801\u903b\u8f91 \uff0c\u6211\u8fd9\u8fb9\u7a0d\u5fae\u4ecb\u7ecd\u4e0b\u9875\u9762\u7684\u8c03\u6574\u3002 \u6570\u636e\u6784\u9020\u5668\uff08\u524d\u7f6e\u6761\u4ef6\uff09 \u8fd9\u5757\u91c7\u7528\u4e86 Antd pro Components \uff0c\u4e5f\u5c31\u662f\u4e13\u4e1a\u7ea7\u7684Card\u7ec4\u4ef6\u3002\u770b\u8d77\u6765\u786e\u5b9e\u6bd4\u6211\u81ea\u5df1\u5199\u7684\u597d\u4e0a100\u4e2a\u6863\u6b21: \u524d\u540e\u5bf9\u6bd4: \u6539\u9020\u524d \u914d\u8272\u4e5f\u4e0d\u77e5\u9053\u600e\u4e48\u914d\uff0c\u6211\u4e00\u76f4\u89c9\u5f97\u524d\u7aef\u5f88\u96be\uff0ccss\u662f\u95e8\u5b66\u95ee\u3002 \u6539\u9020\u540e \u6765\u770b\u770bProCard\u7684\u4ee3\u7801: \u5b89\u88c5ProCard npm install --save @ant-design/pro-card \u4f7f\u7528 \u53ef\u4ee5\u770b\u5230api\u6bd4\u8f83\u7b80\u5355\uff0cavatar\u5c31\u662f\u5361\u7247\u7684\u56fe\u6807\uff0ctitle\u662f\u6807\u9898\uff0cdescription\u662f\u63cf\u8ff0\u3002\u5f88\u4e60\u60ef\u7684antd\u98ce\u683c\u3002 \u7528\u4f8b\u5217\u8868\u90e8\u5206 \u6211\u4eec\u90fd\u77e5\u9053\u6d4b\u8bd5\u8ba1\u5212\u5c31\u662f\u4e3a\u4e86\u7ec4\u88c5 \u6d4b\u8bd5\u7528\u4f8b \u7684\uff0c\u6240\u4ee5\u6211\u4eec\u8fd9\u8fb9\u7ed9\u51fa\u4e86\u4e00\u7ec4\u6570\u636e\uff0c\u53ef\u4ee5\u901a\u8fc7\u9879\u76ee\u83b7\u53d6\u5230\u8be5\u9879\u76ee\u4e0b\u7684 \u6d4b\u8bd5\u7528\u4f8b \u6811\u3002 \u9009\u4e2d\u4ee5\u540e\uff0c\u4e0b\u65b9\u4f1a\u51fa\u73b0\u4e00\u4e2a\u53ef\u62d6\u62fd\u7684case\u5217\u8868\uff0c\u5982\u679c\u5bf9\u4e8e\u987a\u5e8f\u6709\u4e25\u683c\u8981\u6c42\u7684\uff0c\u53ef\u4ee5\u62d6\u52a8\u5217\u8868\uff0c\u6539\u53d8case\u7684\u6267\u884c\u987a\u5e8f\u3002 \u4e0e\u4e4b\u5bf9\u5e94\u7684\uff0c\u9700\u8981\u901a\u8fc7\u9879\u76ee\u83b7\u53d6\u5230case\u6570\u636e: \u4e5f\u53ef\u4ee5\u901a\u8fc7\u76ee\u5f55\u6765\u9009\u62e9case\u3002 \u540e\u7aef\u6539\u52a8\u5982\u4e0b: \u56e0\u4e3a\u6211\u4eec\u662f\u6709\u901a\u8fc7\u9879\u76ee\u83b7\u53d6case\u76ee\u5f55\u7684\u65b9\u6cd5\u7684\uff0c\u73b0\u5728\u7f3a\u7684\u5c31\u662f\u662f\u5426\u8981\u7ee7\u7eed\u83b7\u53d6\u76ee\u5f55\u4e0b\u7684case\u3002 \u6240\u4ee5\u5b9a\u4e49\u4e86\u4e00\u4e2acase_node\u7684\u53c2\u6570\uff08\u53c2\u6570\u662f\u4e00\u4e2a\u65b9\u6cd5\uff0c\u83b7\u53d6\u5b50\u8282\u70b9\u7684\u65b9\u6cd5\uff09\u3002 \u5982\u679c\u6709\u8be5\u65b9\u6cd5\uff0c\u5219\u8c03\u7528\u4e4b\u83b7\u53d6\u5bf9\u5e94\u7684\u8282\u70b9\u3002 \u7531\u4e8eselect\u6570\u636e\u6bd4\u8f83\u5947\u602a\uff0c\u6211\u4eec\u7684\u6570\u636e\u5e93\u5b58\u7684 case_list \u53c8\u662fid\uff0c\u6240\u4ee5\u6211\u4eec\u60f3\u77e5\u9053case\u540d\u5b57\u5e76\u4e0d\u662f\u5f88\u5bb9\u6613\u3002 \u4e8e\u662f\u8fd9\u91cc\u5e26\u51fa\u9879\u76ee\u6811\u7684\u540c\u4e8b\uff0c\u5e26\u51fa\u4e86case_id => case_name\u7684\u6620\u5c04\u5173\u7cfb: case_map\u3002 \u8fd9\u6837\u505a\u80af\u5b9a\u4f1a\u6709\u95ee\u9898\uff0c\u7279\u522b\u662f\u6570\u636e\u91cf\u591a\u7684\u60c5\u51b5\u4e0b\u3002\u4f46\u4e00\u4e2aproject\u4e0b\u7684case\u6709\u8fd9\u4e48\u5927\u89c4\u6a21\u7684\u65f6\u5019\uff0c\u4e5f\u53ef\u4ee5 \u91cd\u6784 \u4e86\u3002 \u6700\u540e\uff0c\u7f16\u5199\u8be5\u63a5\u53e3: \u524d\u7aef\u901a\u77e5\u90e8\u5206 \u901a\u77e5\u90e8\u5206\u5f88\u7b80\u5355\uff0c\u4e5f\u662f\u5e38\u89c4\u8868\u5355\uff0c\u7ed9\u5b83\u4eec\u52a0\u4e0a\u56fe\u6807\u4f1a\u66f4\u53cb\u597d: \u901a\u77e5\u5177\u4f53\u7684\u903b\u8f91\u8fd8\u6ca1\u6709\u505a\uff0c\u8fd9\u6d89\u53ca\u5230\u4eba\u5458\u7684\u624b\u673a\u53f7\uff0c\u90ae\u7bb1\u7b49\u3002\u80af\u5b9a\u662f\u9700\u8981\u4e00\u4e2a\u7528\u6237\u7ba1\u7406\u9875\u9762\uff0c\u7528\u6237\u4e5f\u9700\u8981\u66f4\u65b0\u8d44\u6599\u7684\u9875\u9762\u3002 APScheduler\u7684\u5751 \u4e0d\u5f97\u4e0d\u8bf4\uff0c\u8fd9\u4e2a\u5e93\u8fd8\u771f\u7684\u662f\u6709\u4e00\u4e9b\u95ee\u9898\u3002\u867d\u7136\u770b\u8d77\u6765\u662f\u6bd4\u8f83\u7f8e\u597d\uff0c\u4f46\u73b0\u5b9e\u7ed9\u4eba\u5f53\u5934\u4e00\u68d2\u3002 \u8e29\u5751 \u5f53\u7f16\u8f91\u6d4b\u8bd5\u8ba1\u5212\u7684\u65f6\u5019\uff0c\u4f7f\u7528scheduler.modify_job\uff0c\u5c31\u7b97\u4f60\u6539\u53d8\u4e86trigger\uff0c\u4e5f\u4e0d\u4f1a\u4f7fcron\u8868\u8fbe\u5f0f\u66f4\u65b0\u3002 \u6700\u540e\u6765\u5f20\u7a33\u5b9a\u8fd0\u884c\u6d4b\u8bd5\u8ba1\u5212\u7684\u56fe: \u6700\u65b0\u7684\u4ee3\u7801\uff0c\u6211\u5df2\u7ecf\u90e8\u7f72\u4e86\u3002 http://test.pity.fun \u6b22\u8fce\u5927\u5bb6\u63d0\u5404\u79cd\u5efa\u8bae\u548c\u610f\u89c1\u3002","title":"77.\u5b8c\u5584\u6d4b\u8bd5\u8ba1\u5212\u9875\u9762"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2877%29%20%E5%AE%8C%E5%96%84%E6%B5%8B%E8%AF%95%E8%AE%A1%E5%88%92%E9%A1%B5%E9%9D%A2/#_1","text":"\u4e0a\u4e00\u8282\u6211\u4eec\u7c97\u7565\u4ecb\u7ecd\u4e86\u4e0b\u600e\u4e48\u8bbe\u8ba1 \u524d\u7aef \u9875\u9762\u3002\u65f6\u9694\u4e00\u65e5\uff0c\u535a\u4e3b\u5df2\u7ecf\u628a\u4ee3\u7801\u7801\u597d\u4e86\u3002 \u4e0d\u5f97\u4e0d\u8bf4\uff0c\u524d\u7aef\u4ee3\u7801\u8fd8\u662f\u975e\u5e38\u975e\u5e38\u96be\u5199\u7684\uff0c\u611f\u89c9\u540c\u6837\u662fcrud\uff0c\u5374\u6bd4\u540e\u7aef \u590d\u6742\u8bb8\u591a \u3002\u8fd9\u4e00\u8282\u6211\u4eec\u7ee7\u7eed\u8865\u5145\u8fd9\u5757\u5185\u5bb9\u3002 \u606d\u559cEDG\u83b7\u53d6S11\u51a0\u519b\uff0c EDG \u725b\u76ae\uff01\u8e6d\u4e2a\u70ed\u5ea6~","title":"\u56de\u987e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2877%29%20%E5%AE%8C%E5%96%84%E6%B5%8B%E8%AF%95%E8%AE%A1%E5%88%92%E9%A1%B5%E9%9D%A2/#_2","text":"\u7ec6\u8282\u90e8\u5206\u5927\u5bb6\u53ef\u4ee5\u53c2\u770b\u5177\u4f53\u7684 \u4ee3\u7801\u903b\u8f91 \uff0c\u6211\u8fd9\u8fb9\u7a0d\u5fae\u4ecb\u7ecd\u4e0b\u9875\u9762\u7684\u8c03\u6574\u3002","title":"\u7ec6\u8282"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2877%29%20%E5%AE%8C%E5%96%84%E6%B5%8B%E8%AF%95%E8%AE%A1%E5%88%92%E9%A1%B5%E9%9D%A2/#_3","text":"\u8fd9\u5757\u91c7\u7528\u4e86 Antd pro Components \uff0c\u4e5f\u5c31\u662f\u4e13\u4e1a\u7ea7\u7684Card\u7ec4\u4ef6\u3002\u770b\u8d77\u6765\u786e\u5b9e\u6bd4\u6211\u81ea\u5df1\u5199\u7684\u597d\u4e0a100\u4e2a\u6863\u6b21: \u524d\u540e\u5bf9\u6bd4: \u6539\u9020\u524d \u914d\u8272\u4e5f\u4e0d\u77e5\u9053\u600e\u4e48\u914d\uff0c\u6211\u4e00\u76f4\u89c9\u5f97\u524d\u7aef\u5f88\u96be\uff0ccss\u662f\u95e8\u5b66\u95ee\u3002 \u6539\u9020\u540e \u6765\u770b\u770bProCard\u7684\u4ee3\u7801: \u5b89\u88c5ProCard npm install --save @ant-design/pro-card \u4f7f\u7528 \u53ef\u4ee5\u770b\u5230api\u6bd4\u8f83\u7b80\u5355\uff0cavatar\u5c31\u662f\u5361\u7247\u7684\u56fe\u6807\uff0ctitle\u662f\u6807\u9898\uff0cdescription\u662f\u63cf\u8ff0\u3002\u5f88\u4e60\u60ef\u7684antd\u98ce\u683c\u3002","title":"\u6570\u636e\u6784\u9020\u5668\uff08\u524d\u7f6e\u6761\u4ef6\uff09"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2877%29%20%E5%AE%8C%E5%96%84%E6%B5%8B%E8%AF%95%E8%AE%A1%E5%88%92%E9%A1%B5%E9%9D%A2/#_4","text":"\u6211\u4eec\u90fd\u77e5\u9053\u6d4b\u8bd5\u8ba1\u5212\u5c31\u662f\u4e3a\u4e86\u7ec4\u88c5 \u6d4b\u8bd5\u7528\u4f8b \u7684\uff0c\u6240\u4ee5\u6211\u4eec\u8fd9\u8fb9\u7ed9\u51fa\u4e86\u4e00\u7ec4\u6570\u636e\uff0c\u53ef\u4ee5\u901a\u8fc7\u9879\u76ee\u83b7\u53d6\u5230\u8be5\u9879\u76ee\u4e0b\u7684 \u6d4b\u8bd5\u7528\u4f8b \u6811\u3002 \u9009\u4e2d\u4ee5\u540e\uff0c\u4e0b\u65b9\u4f1a\u51fa\u73b0\u4e00\u4e2a\u53ef\u62d6\u62fd\u7684case\u5217\u8868\uff0c\u5982\u679c\u5bf9\u4e8e\u987a\u5e8f\u6709\u4e25\u683c\u8981\u6c42\u7684\uff0c\u53ef\u4ee5\u62d6\u52a8\u5217\u8868\uff0c\u6539\u53d8case\u7684\u6267\u884c\u987a\u5e8f\u3002 \u4e0e\u4e4b\u5bf9\u5e94\u7684\uff0c\u9700\u8981\u901a\u8fc7\u9879\u76ee\u83b7\u53d6\u5230case\u6570\u636e: \u4e5f\u53ef\u4ee5\u901a\u8fc7\u76ee\u5f55\u6765\u9009\u62e9case\u3002 \u540e\u7aef\u6539\u52a8\u5982\u4e0b: \u56e0\u4e3a\u6211\u4eec\u662f\u6709\u901a\u8fc7\u9879\u76ee\u83b7\u53d6case\u76ee\u5f55\u7684\u65b9\u6cd5\u7684\uff0c\u73b0\u5728\u7f3a\u7684\u5c31\u662f\u662f\u5426\u8981\u7ee7\u7eed\u83b7\u53d6\u76ee\u5f55\u4e0b\u7684case\u3002 \u6240\u4ee5\u5b9a\u4e49\u4e86\u4e00\u4e2acase_node\u7684\u53c2\u6570\uff08\u53c2\u6570\u662f\u4e00\u4e2a\u65b9\u6cd5\uff0c\u83b7\u53d6\u5b50\u8282\u70b9\u7684\u65b9\u6cd5\uff09\u3002 \u5982\u679c\u6709\u8be5\u65b9\u6cd5\uff0c\u5219\u8c03\u7528\u4e4b\u83b7\u53d6\u5bf9\u5e94\u7684\u8282\u70b9\u3002 \u7531\u4e8eselect\u6570\u636e\u6bd4\u8f83\u5947\u602a\uff0c\u6211\u4eec\u7684\u6570\u636e\u5e93\u5b58\u7684 case_list \u53c8\u662fid\uff0c\u6240\u4ee5\u6211\u4eec\u60f3\u77e5\u9053case\u540d\u5b57\u5e76\u4e0d\u662f\u5f88\u5bb9\u6613\u3002 \u4e8e\u662f\u8fd9\u91cc\u5e26\u51fa\u9879\u76ee\u6811\u7684\u540c\u4e8b\uff0c\u5e26\u51fa\u4e86case_id => case_name\u7684\u6620\u5c04\u5173\u7cfb: case_map\u3002 \u8fd9\u6837\u505a\u80af\u5b9a\u4f1a\u6709\u95ee\u9898\uff0c\u7279\u522b\u662f\u6570\u636e\u91cf\u591a\u7684\u60c5\u51b5\u4e0b\u3002\u4f46\u4e00\u4e2aproject\u4e0b\u7684case\u6709\u8fd9\u4e48\u5927\u89c4\u6a21\u7684\u65f6\u5019\uff0c\u4e5f\u53ef\u4ee5 \u91cd\u6784 \u4e86\u3002 \u6700\u540e\uff0c\u7f16\u5199\u8be5\u63a5\u53e3:","title":"\u7528\u4f8b\u5217\u8868\u90e8\u5206"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2877%29%20%E5%AE%8C%E5%96%84%E6%B5%8B%E8%AF%95%E8%AE%A1%E5%88%92%E9%A1%B5%E9%9D%A2/#_5","text":"\u901a\u77e5\u90e8\u5206\u5f88\u7b80\u5355\uff0c\u4e5f\u662f\u5e38\u89c4\u8868\u5355\uff0c\u7ed9\u5b83\u4eec\u52a0\u4e0a\u56fe\u6807\u4f1a\u66f4\u53cb\u597d: \u901a\u77e5\u5177\u4f53\u7684\u903b\u8f91\u8fd8\u6ca1\u6709\u505a\uff0c\u8fd9\u6d89\u53ca\u5230\u4eba\u5458\u7684\u624b\u673a\u53f7\uff0c\u90ae\u7bb1\u7b49\u3002\u80af\u5b9a\u662f\u9700\u8981\u4e00\u4e2a\u7528\u6237\u7ba1\u7406\u9875\u9762\uff0c\u7528\u6237\u4e5f\u9700\u8981\u66f4\u65b0\u8d44\u6599\u7684\u9875\u9762\u3002","title":"\u524d\u7aef\u901a\u77e5\u90e8\u5206"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2877%29%20%E5%AE%8C%E5%96%84%E6%B5%8B%E8%AF%95%E8%AE%A1%E5%88%92%E9%A1%B5%E9%9D%A2/#apscheduler","text":"\u4e0d\u5f97\u4e0d\u8bf4\uff0c\u8fd9\u4e2a\u5e93\u8fd8\u771f\u7684\u662f\u6709\u4e00\u4e9b\u95ee\u9898\u3002\u867d\u7136\u770b\u8d77\u6765\u662f\u6bd4\u8f83\u7f8e\u597d\uff0c\u4f46\u73b0\u5b9e\u7ed9\u4eba\u5f53\u5934\u4e00\u68d2\u3002 \u8e29\u5751 \u5f53\u7f16\u8f91\u6d4b\u8bd5\u8ba1\u5212\u7684\u65f6\u5019\uff0c\u4f7f\u7528scheduler.modify_job\uff0c\u5c31\u7b97\u4f60\u6539\u53d8\u4e86trigger\uff0c\u4e5f\u4e0d\u4f1a\u4f7fcron\u8868\u8fbe\u5f0f\u66f4\u65b0\u3002 \u6700\u540e\u6765\u5f20\u7a33\u5b9a\u8fd0\u884c\u6d4b\u8bd5\u8ba1\u5212\u7684\u56fe: \u6700\u65b0\u7684\u4ee3\u7801\uff0c\u6211\u5df2\u7ecf\u90e8\u7f72\u4e86\u3002 http://test.pity.fun \u6b22\u8fce\u5927\u5bb6\u63d0\u5404\u79cd\u5efa\u8bae\u548c\u610f\u89c1\u3002","title":"APScheduler\u7684\u5751"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2878%29%20%E7%BC%96%E5%86%99Redis%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86%E5%8A%9F%E8%83%BD%28%E4%B8%8A%29/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684\u5b8c\u6574 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u6d4b\u8bd5\u5f00\u53d1\u5751\u8d27 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \ud83d\udcd2 \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u7f16\u5199\u4e86 \u6d4b\u8bd5\u8ba1\u5212 \u76f8\u5173\u529f\u80fd\u3002\u7531\u4e8e\u6211\u4eec\u7684\u6570\u636e\u6784\u9020\u5668(\u524d\u7f6e\u6761\u4ef6)\u8fd8\u6709\u4e00\u4e9b\u4e0d\u5b8c\u5584\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u8fd9\u6bb5\u65f6\u95f4\u8981\u5f00\u59cb\u5b8c\u5584redis\u76f8\u5173\u5185\u5bb9\u3002 \u5982\u679c\u628aredis\u770b\u505a\u6570\u636e\u5e93\u7684\u8bdd\uff0c\u6211\u4eec\u4e5f\u662f\u9700\u8981\u7f16\u5199\u5bf9\u5e94\u7684 \u8fde\u63a5\u914d\u7f6e \u9875\u9762\u7684\uff0c\u7f16\u5199\u5b8c\u4ee5\u540e\u6211\u4eec\u9700\u8981\u63a5\u5165 \u524d\u7f6e\u6761\u4ef6 \uff0c\u4e5f\u5f97\u80fd\u591f\u5728\u9875\u9762\u4e0a\u5728\u7ebf\u6267\u884credis\u547d\u4ee4\u3002\u8fd9\u4e9b\u90fd\u4f1a\u662f\u63a5\u4e0b\u6765\u51e0\u5929\u7684\u4efb\u52a1\u3002 \ud83d\udcd2 \u6210\u679c\u56fe \ud83d\udcd2 \u8bbe\u8ba1Redis\u914d\u7f6e\u8868 redis\u548cmysql\u6bd4\u8f83\u7c7b\u4f3c\uff0c\u6709\u4e00\u4e9b\u5171\u901a\u7684\u90e8\u5206: host port username password database \u5728redis\u4e2d\u662f\u4e00\u7247\u4e00\u7247\u7684db\uff0c\u4e00\u822c\u662f0-15\u3002\u800cMysql\u5219\u662f\u4e00\u4e2a\u5177\u4f53\u7684\u5e93\u3002 \u9664\u6b64\u4e4b\u5916\uff0c\u4e8c\u8005\u533a\u522b\u5f88\u5c0f\u3002\u4e3b\u8981\u63d0\u73b0\u5728: redis\u5206\u4e3a\u96c6\u7fa4\u548c\u5355\u4f8b\u6a21\u5f0f\uff0c\u96c6\u7fa4\u662f\u53ef\u4ee5\u4e0d\u8f93\u5165\u7528\u6237\u5bc6\u7801\u7684 \u4e00\u822credis\u7684\u8fde\u63a5\u4e32\u4f1a\u628ahost\u548cport\u5408\u5230\u4e00\u8d77\uff0c\u4fbf\u4e8e\u6211\u4eec\u8fdb\u884c\u96c6\u7fa4\u7ba1\u7406 \u6240\u4ee5\u603b\u7ed3\u8d77\u6765\u5c31\u662f\uff0c\u6211\u4eec\u57fa\u672c\u53ef\u4ee5\u7167\u642cMySQL\u914d\u7f6e\u8868\u3002 from sqlalchemy import Column, INT, String, Boolean, UniqueConstraint from app.models.basic import PityBase class PityRedis (PityBase) : __tablename__ = \"pity_redis_info\" __table_args__ = ( UniqueConstraint( 'env' , 'name' , 'deleted_at' ), ) env = Column(INT, nullable= False ) # \u5bf9\u5e94\u73af\u5883id name = Column(String( 24 ), nullable= False ) # redis\u63cf\u8ff0\u540d\u79f0 addr = Column(String( 128 ), nullable= False ) username = Column(String( 36 ), nullable= False ) password = Column(String( 64 ), nullable= False ) db = Column(INT, nullable= False ) # \u662f\u5426\u662f\u96c6\u7fa4\uff0c\u9ed8\u8ba4\u4e3afalse\uff0c\u96c6\u7fa4\u53ef\u4e0d\u8f93\u5165\u7528\u6237\u5bc6\u7801 cluster = Column(Boolean, default= False , nullable= False ) def __init__ (self, env, name, addr, username, password, db, cluster, user) : super().__init__(user) self.env = env self.name = name self.addr = addr self.password = password self.username = username self.db = db self.cluster = cluster \u53ef\u4ee5\u770b\u5230\uff0c\u4ed6\u51e0\u4e4e\u548cMySQL\u5dee\u4e0d\u591a\u3002\u90a3\u6211\u4eec\u6765\u6309\u7167\u7ba1\u7406\u7f16\u5199 \u589e\u5220\u6539\u67e5 \u63a5\u53e3\u3002 \ud83d\udcd2 \u7f16\u5199Dao\u5c42 \u5176\u5b9e\u6309\u7167 \u60ef\u4f8b \uff0c\u6211\u4f30\u8ba1\u53c8\u4ece\u4e4b\u524d\u7684DbConfigDao.py\u590d\u5236\u51fa\u4ee3\u7801\u7136\u540e\u6539\u4e00\u6539\u4e86\u3002 \u4f46\u8fd9\u6b21\u6211\u4e0d\u6253\u7b97\u8fd9\u4e48\u505a\u4e86\uff0c\u56e0\u4e3a\u5176\u5b9e\u6bcf\u6b21\u5199\u7684 \u589e\u5220\u6539\u67e5 \u4ee3\u7801\u867d\u7136\u4e0d\u5b8c\u5168\u4e00\u6837\uff0c\u4f46\u90fd\u5f88\u50cf\u554a\uff01\uff01\uff01 \u6240\u4ee5\u5982\u679c\u80fd\u6709\u4e2a\u529e\u6cd5\u53ef\u4ee5\u7701\u7565\u8fd9\u4e9b\u64cd\u4f5c\uff0c\u90a3\u4e48\u4e00\u4e2a\u540e\u7aef\u63a5\u53e3\u5c31\u5f88\u5feb\u80fd\u591f\u5199\u51fa\u6765\u4e86~ \u5bf9\u4e8e\u6211\u4eec\u8fd9\u6837\u7b80\u6613\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0\uff0c\u662f\u4e8b\u534a\u529f\u500d\u7684\u3002 \u5176\u5b9e\u601d\u8def\u6765\u6e90\u4e8e Mybatis Plus \uff0c\u8fd9\u4e2a\u6846\u67b6\u7684\u597d\u5904\u5c31\u662f\u5c01\u88c5\u4e86selectList\uff0cselectById\u7b49\u5e38\u7528api\uff0c\u5bfc\u81f4\u54e5\u4eec\u90fd\u4e0d\u9700\u8981\u7f16\u5199\u5177\u4f53\u7684select\u65b9\u6cd5\uff0c\u76f4\u63a5\u4f20\u5165 \u67e5\u8be2\u6761\u4ef6 \u5c31\u53ef\u4ee5\u4e86\u3002 update\u66f4\u662f\u79bb\u8c31\uff0c\u4f20\u5165\u4e00\u4e2a\u65b0\u5bf9\u8c61\u5373\u53ef\u3002 \u6240\u4ee5\u53ef\u4ee5\u770b\u5230\u5177\u4f53\u7684mapper\u90fd\u662f\u7ee7\u627fBaseMapper\uff0c\u5c31\u53ef\u4ee5\u5b8c\u6210\u5bf9\u5e94\u7684\u64cd\u4f5c\u3002 \u53ef\u80fd\u5927\u5bb6\u6ca1\u6709\u5177\u4f53\u7684\u6982\u5ff5\uff0c\u6211\u5148\u7ed9\u5927\u5bb6\u5c55\u793a\u4e0b\u534a\u6210\u54c1: \u53ef\u4ee5\u770b\u5230\u7c7b\u91cc\u9762\u90fd\u6ca1\u6709\u4efb\u4f55\u65b9\u6cd5 \ud83d\udcd2 \u4f7f\u7528\u65b9\u5f0f \u53ef\u4ee5\u770b\u5230\uff0c\u9700\u8981\u7cbe\u786e\u67e5\u627e\u5c31\u76f4\u63a5\u4f20\u5165\uff0c\u9700\u8981\u6a21\u7cca\u67e5\u8be2\u7684\u5219\u52a0\u4e0alike\u3002 \u770b\u8d77\u6765\u662f\u975e\u5e38\u7f8e\u597d\uff0c\u6709\u5174\u8da3\u7684\u670b\u53cb\u53ef\u4ee5\u6d4b\u8bd5\u4e00\u4e0b\u3002 \u4eca\u5929\u7684\u5185\u5bb9\u5230\u8fd9\u5c31\u7ed3\u675f\u4e86\uff0c\u4e0b\u4e00\u8282\u6211\u4eec \u7ee7\u7eed\u5b8c\u5584 \u8fd9\u4e2aMapper\u57fa\u7c7b\u4e2d\u7684\u65b9\u6cd5\uff0c\u5e76\u5b9e\u73b0\u4e00\u4e2a\u5b8c\u6574\u7684demo\u7b80\u5316\u5f00\u53d1\u3002 \u601d\u8def\u867d\u7136\u662f\u539f\u521b\uff0c\u4f46\u96be\u514d\u548c\u5176\u4ed6\u4eba\u78b0\u5230\u4e00\u8d77\uff0c\u5176\u5b9e\u5927\u5bb6\u505a\u7684\u6d4b\u8bd5\u5e73\u53f0\u601d\u8def\u5927\u4f53\u90fd\u662f\u4e00\u81f4\u7684\uff0c\u6240\u4ee5\u5982\u679c\u9047\u5230\u9ad8\u5ea6\u76f8\u4f3c\u7684\uff0c\u771f\u7684\u8fd8\u662f\u7eaf\u5c5e\u5de7\u5408\u3002","title":"78.\u7f16\u5199Redis\u914d\u7f6e\u7ba1\u7406\u529f\u80fd(\u4e0a)"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2879%29%20%E7%BC%96%E5%86%99Redis%E9%85%8D%E7%BD%AE%E5%8A%9F%E8%83%BD%28%E4%B8%8B%29/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684\u5b8c\u6574 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u6d4b\u8bd5\u5f00\u53d1\u5751\u8d27 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \ud83d\udcd2 \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u63d0\u51fa\u4e86 \u4f18\u5316Dao\u903b\u8f91 \u7684\u60f3\u6cd5\uff0c\u90a3\u4eca\u5929\u5c31\u8bd5\u7740\u6765\u5151\u73b0\u4e4b\uff0c\u5e76\u8fd0\u7528\u5230Redis\u914d\u7f6e\u7ba1\u7406\u7684\u5f00\u53d1\u4e2d\u53bb\u3002 \ud83d\udcd2 \u521d\u6b65\u6784\u601dlist\u65b9\u6cd5 \u6211\u4eec\u5728dao/ init .py\u65b0\u5efa\u7c7b: Mapper\uff0c\u4ee5\u540e\u6240\u6709\u7684dao\u7c7b\u90fd\u7ee7\u627f\u81ea\u5b83\u3002 \u60f3\u60f3list\u9700\u8981\u4ec0\u4e48\uff0c\u4e00\u822c\u9700\u8981, \u5b57\u6bb5 \uff0c \u53c2\u6570 \uff0c \u662flike\u8fd8\u662f\u7b49\u4e8e \u8fd93\u4e2a\u91cd\u8981\u7684\u4fe1\u606f\u3002 \u660e\u767d\u8fd9\u4e2a\u4ee5\u540e\uff0c\u6211\u4eec\u7684\u4f2a\u4ee3\u7801\u5c31\u597d\u7f16\u5199\u4e86: # 1. \u83b7\u53d6session async with async_session() as session: condition = [model.deleted_at == 0 ] # 2. \u6839\u636e\u53c2\u6570\u91cc\u7684\u5b57\u6bb5\uff0c\u5b57\u6bb5\u503c\u6784\u9020\u67e5\u8be2\u6761\u4ef6 DatabaseHelper.where(\u5b57\u6bb5\uff0c\u5b57\u6bb5\u503c\uff0ccondition) # 3. \u67e5\u8be2\u51fa\u7ed3\u679c\uff0c\u540e\u7eed\u4e0e\u539f\u6765\u7684\u65b9\u5f0f\u4e00\u81f4\uff0c\u5c31\u4e0d\u5199\u4e86 \u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u8fb9\u9664\u4e86\u9700\u8981\u4e0a\u9762\u76843\u4e2a\u4fe1\u606f\u4ee5\u5916\uff0c\u8fd8\u9700\u8981try\u53bb\u5199\u5165\u65e5\u5fd7\uff0c\u4e5f\u5c31\u662f\u8bf4\u9700\u8981\u6211\u4eec\u5e73\u65f6\u7ecf\u5e38\u521b\u5efa\u7684log\u6210\u5458\u53d8\u91cf\uff0c\u8fd8\u9700\u8981 model \u8fd9\u4e2a\u7c7b\uff0c\u5426\u5219\u4f60\u4e0d\u77e5\u9053\u6539\u7684\u662f\u4ec0\u4e48\u8868\u3002 \ud83d\udcd2 \u601d\u8003 \u6211\u4eec\u5e73\u65f6\u7684\u53c2\u6570\uff0c\u90fd\u662fkey-value\u7684\u5f62\u5f0f\uff0c\u4e00\u65e6value\u4e0d\u4e3a\u7a7a\uff0c\u90a3\u4e48\u8bf4\u660e\u6211\u4eec\u8981\u6839\u636e\u8fd9\u4e2a\u6761\u4ef6\u6765\u67e5\u8be2\u3002 \u800cmodel\u548clog\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u7c7b\u7684\u88c5\u9970\u5668\uff0c\u7531\u5b50\u7c7b\u4f20\u9012\u7ed9\u7236\u7c7b\uff08\u8fd9\u91cc\u4f1a\u7528\u5230setattr\u548cgetattr\uff09 class Mapper (object) : log = None model = None @classmethod async def list_data (cls, **kwargs) : try : async with async_session() as session: # \u6784\u9020\u67e5\u8be2\u6761\u4ef6\uff0c\u9ed8\u8ba4\u662f\u6570\u636e\u672a\u88ab\u5220\u9664 condition = [getattr(cls.model, \"deleted_at\" ) == 0 ] # \u904d\u5386\u53c2\u6570\uff0c\u5f53\u53c2\u6570\u4e0d\u4e3aNone\u7684\u65f6\u5019\u4f20\u9012 for k, v in kwargs.items(): # \u5224\u65ad\u662f\u5426\u662flike\u7684\u60c5\u51b5 TODO: \u8fd9\u91cc\u6ca1\u652f\u6301in\u67e5\u8be2 like = v is not None and len(v) > 2 and v.startswith( \"%\" ) and v.endswith( \"%\" ) # \u5982\u679c\u662flike\u6a21\u5f0f\uff0c\u5219\u4f7f\u7528Model.\u5b57\u6bb5.like \u5426\u5219\u7528 Model.\u5b57\u6bb5 \u7b49\u4e8e DatabaseHelper.where(v, getattr(cls.model, k).like(v) if like else getattr(cls.model, k) == v, condition) result = await session.execute(select(cls.model).where(*condition)) return result.scalars().all() except Exception as e: # \u8fd9\u8fb9\u8c03\u7528cls\u672c\u8eab\u7684log\u53c2\u6570\uff0c\u5199\u5165\u65e5\u5fd7+\u629b\u51fa\u5f02\u5e38 cls.log.error( f\"\u83b7\u53d6 {cls.model} \u5217\u8868\u5931\u8d25, error: {e} \" ) raise Exception( f\"\u83b7\u53d6\u6570\u636e\u5931\u8d25\" ) \u6ce8\u91ca\u5199\u7684\u6bd4\u8f83\u8be6\u7ec6\uff0c\u7531\u4e8e\u73b0\u5728\u5b57\u6bb5\u662f\u4e2a\u53d8\u91cf\uff0c\u6240\u4ee5\u6211\u4eec\u4e0d\u80fd\u7528 model.\u5b57\u6bb5 \u6765\u53d6\u503c\uff0c\u6240\u4ee5\u53d6\u800c\u4ee3\u4e4b\u7684\u662f getattr(model, \u5b57\u6bb5) \u3002\u4e0d\u719f\u6089\u7684\u670b\u53cb\u53ef\u4ee5\u53bb\u641c\u7d22\u4e0b getattr \u3002 \u8fd9\u6837\uff0c\u4e00\u4e2a\u7c97\u7565\u7684list\u65b9\u6cd5\u5c31\u5199\u597d\u4e86\uff0c\u4f46\u662f\u8fd9\u4e2a\u662f\u4e0d\u5e26\u5206\u9875\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u8fd8\u9700\u8981\u8865\u5145\u4e00\u4e2a\u5206\u9875\u7684\u6a21\u5f0f\uff0c\u5176\u5b9e\u4e5f\u5f88\u7b80\u5355\u3002 @classmethod async def list_data_with_pagination (cls, page, size, **kwargs) : try : async with async_session() as session: condition = [getattr(cls.model, \"deleted_at\" ) == 0 ] for k, v in kwargs.items(): like = v is not None and len(v) > 2 and v.startswith( \"%\" ) and v.endswith( \"%\" ) sql = DatabaseHelper.where(v, getattr(cls.model, k).like(v) if like else getattr(cls.model, k) == v, condition) return await DatabaseHelper.pagination(page, size, session, sql) except Exception as e: cls.log.error( f\"\u83b7\u53d6 {cls.model} \u5217\u8868\u5931\u8d25, error: {e} \" ) raise Exception( f\"\u83b7\u53d6\u6570\u636e\u5931\u8d25\" ) \u57fa\u672c\u4e0a\u957f\u7684\u5dee\u4e0d\u591a\uff0c\u53ea\u662f\u6700\u540e\u8fd4\u56de\u90a3\u91cc\uff0c\u8c03\u7528\u4e86pagination\u76f8\u5173\u65b9\u6cd5\u3002 \ud83d\udcd2 \u770b\u770bdao\u88c5\u9970\u5668 \u8fd9\u4e5f\u662f\u4e3a\u4ec0\u4e48\u8981\u7528classmethod\u800c\u4e0d\u662fstaticmethod\u7684\u539f\u56e0 \u6211\u4eec\u5f88\u574f\uff0c\u628a\u8fd9\u4e2a\u88c5\u9970\u5668\u5957\u5230\u5b50\u7c7b\u4e0a\uff0c\u5e76\u628amodel\u548clog\u4f20\u7ed9\u7236\u7c7b\u3002\u6bd5\u7adf\u65b9\u6cd5\u90fd\u662f\u5728\u8c03\u7528\u7236\u7c7b\u7684\u65b9\u6cd5\uff0c\u7236\u7c7b\u65e0\u6cd5\u76f4\u63a5\u62ff\u5230 \u5b50\u7c7b\u7684\u6570\u636e \u3002 \u7528\u7684\u8bdd\uff0c\u5c31\u662f\u628amodel\u548clog\u4f20\u5165dao\u53c2\u6570 \u8fd9\u6837\u5c31\u907f\u514d\u4e86\u5728\u8c03\u7528 list \u65b9\u6cd5\u7684\u65f6\u5019\uff0c\u8fd8\u9700\u8981\u4f20\u5165model\u548clog\u7684\u5c34\u5c2c\u60c5\u51b5\u3002 \ud83d\udcd2 \u5b8c\u5584\u5176\u4ed6\u65b9\u6cd5 list\u641e\u5b9a\u4ee5\u540e\uff0c\u5176\u4ed6\u7684\u8fd8\u4f1a\u8fdc\u5417\uff1f\u4f46\u8fd8\u771f\u7684\u597d\u50cf\u8fd8\u6709\u70b9\u95ee\u9898\uff0c\u56e0\u4e3a\u6211\u4eec\u4e00\u822c\u4f1a\u6709\u4e00\u4e9b\u91cd\u540d\u5224\u65ad\uff0c\u4f46\u6ca1\u5173\u7cfb\uff0c\u6211\u4eec\u53ef\u4ee5\u7f16\u5199\u4e00\u4e2aquery\u65b9\u6cd5\u3002 @classmethod def query_wrapper (cls, **kwargs) : condition = [getattr(cls.model, \"deleted_at\" ) == 0 ] # \u904d\u5386\u53c2\u6570\uff0c\u5f53\u53c2\u6570\u4e0d\u4e3aNone\u7684\u65f6\u5019\u4f20\u9012 for k, v in kwargs.items(): # \u5224\u65ad\u662f\u5426\u662flike\u7684\u60c5\u51b5 TODO: \u8fd9\u91cc\u6ca1\u652f\u6301in\u67e5\u8be2 like = v is not None and len(v) > 2 and v.startswith( \"%\" ) and v.endswith( \"%\" ) # \u5982\u679c\u662flike\u6a21\u5f0f\uff0c\u5219\u4f7f\u7528Model.\u5b57\u6bb5.like \u5426\u5219\u7528 Model.\u5b57\u6bb5 \u7b49\u4e8e DatabaseHelper.where(v, getattr(cls.model, k).like(v) if like else getattr(cls.model, k) == v, condition) return select(cls.model).where(*condition) @classmethod async def query_record (cls, **kwargs) : try : async with async_session() as session: sql = cls.query_wrapper(**kwargs) result = await session.execute(sql) return result.scalars().first() except Exception as e: cls.log.error( f\"\u67e5\u8be2 {cls.model} \u5931\u8d25, error: {e} \" ) raise Exception( f\"\u67e5\u8be2\u6570\u636e\u5931\u8d25\" ) \u7531\u4e8e\u67e5\u8be2\u65b9\u6cd5\u592a\u8fc7\u4e8e\u901a\u7528\uff0c\u6240\u4ee5\u62bd\u6210\u4e86query_wrapper\u65b9\u6cd5\u3002 \u6b63\u5e38\u7f16\u5199insert\u63a5\u53e3 @classmethod async def insert_record (cls, model) : try : async with async_session() as session: async with session.begin(): session.add(model) await session.flush() session.expunge(model) return model except Exception as e: cls.log.error( f\"\u6dfb\u52a0 {cls.model} \u8bb0\u5f55\u5931\u8d25, error: {e} \" ) raise Exception( f\"\u6dfb\u52a0\u8bb0\u5f55\u5931\u8d25\" ) \u8fd9\u8fb9\u8fd4\u56de\u4e86model\uff0c\u5982\u679c\u4e0d\u9700\u8981\u4e5f\u53ef\u4ee5\u4e0d\u7528\uff0c\u4f46\u54b1\u8fd8\u662f\u7ed9\u8fd4\u56de\u3002 insert\u63a5\u53e3\u5c42 \u548c\u4ee5\u524d\u4e00\u6837\uff0c\u5148\u67e5\uff0c\u5982\u679c\u6ca1\u6709\u518d\u5173\u6389\u3002 \u4f46\u8fd9\u6837\u4f1a\u4ea7\u751f2\u4e2asession\uff0c\u5f00->\u5173->\u5f00->\u5173 \u4f46\u4e5f\u89e3\u8026\u4e86\u67e5\u8be2\u548c\u63d2\u51652\u4e2a\u64cd\u4f5c\u3002 \u7f16\u5199\u5220\u9664\u548c\u4fee\u6539\u65b9\u6cd5 @classmethod async def update_record_by_id (cls, user, model, not_null=False) : try : async with async_session() as session: async with session.begin(): query = cls.query_wrapper(id=model.id) result = await session.execute(query) original = result.scalars().first() if original is None : raise Exception( \"\u8bb0\u5f55\u4e0d\u5b58\u5728\" ) DatabaseHelper.update_model(original, model, user, not_null) await session.flush() session.expunge(original) return original except Exception as e: cls.log.error( f\"\u66f4\u65b0 {cls.model} \u8bb0\u5f55\u5931\u8d25, error: {e} \" ) raise Exception( f\"\u66f4\u65b0\u8bb0\u5f55\u5931\u8d25\" ) @classmethod async def delete_record_by_id (cls, user, id) : \"\"\" \u903b\u8f91\u5220\u9664 :param user: :param id: :return: \"\"\" try : async with async_session() as session: async with session.begin(): query = cls.query_wrapper(id=id) result = await session.execute(query) original = result.scalars().first() if original is None : raise Exception( \"\u8bb0\u5f55\u4e0d\u5b58\u5728\" ) DatabaseHelper.delete_model(original, user) except Exception as e: cls.log.error( f\"\u5220\u9664 {cls.model} \u8bb0\u5f55\u5931\u8d25, error: {e} \" ) raise Exception( f\"\u5220\u9664\u8bb0\u5f55\u5931\u8d25\" ) @classmethod async def delete_by_id (cls, id) : \"\"\" \u7269\u7406\u5220\u9664 :param id: :return: \"\"\" try : async with async_session() as session: async with session.begin(): query = cls.query_wrapper(id=id) result = await session.execute(query) original = result.scalars().first() if original is None : raise Exception( \"\u8bb0\u5f55\u4e0d\u5b58\u5728\" ) session.delete(original) except Exception as e: cls.log.error( f\"\u903b\u8f91\u5220\u9664 {cls.model} \u8bb0\u5f55\u5931\u8d25, error: {e} \" ) raise Exception( f\"\u5220\u9664\u8bb0\u5f55\u5931\u8d25\" ) \u5220\u9664\u8fd9\u8fb9\u652f\u6301\u4e86\u7269\u7406\u5220\u9664\u548c\u903b\u8f91\u5220\u9664\uff0c\u5f53\u7136\u6211\u4eec\u4e00\u822c\u662f\u7528 \u8f6f\u5220\u9664 \u3002 \ud83d\udcd2 \u5b8c\u5584\u5176\u4ed6\u63a5\u53e3 \u53ef\u4ee5\u770b\u5230\u5220\u9664\u548c\u4fee\u6539\u548c\u4ee5\u524d\u662f\u5dee\u4e0d\u591a\u7684(\u4e5f\u662f\u5185\u90e8\u8fdb\u884c\u6570\u636e\u662f\u5426\u5b58\u5728\u5224\u65ad)\uff0c\u8fd9\u4e9b\u6b65\u9aa4\u505a\u5b8c\u3002redis\u7684\u7ba1\u7406\u5de5\u4f5c\u5c31\u53ef\u4ee5\u987a\u5229\u8fdb\u884c\u4e86\uff0c\u63a5\u7740\u6211\u4eec\u9700\u8981\u4e3a\u4e4b\u7f16\u5199\u9875\u9762\u54af\uff01 \u7531\u4e8e\u662f\u5f88\u57fa\u7840\u7684\u8868\u683c\u9875\u9762\uff0c\u6240\u4ee5\u6211\u4eec \u4e0d\u8d58\u8ff0 \u3002\u4e0b\u4e00\u8282\u6211\u4eec\u4f1a\u5229\u7528\u914d\u7f6e\u7684redis\u8fde\u63a5\u7f16\u5199redisManager\uff0c\u7ba1\u7406\u6211\u4eec\u7684 \u8fde\u63a5\u6570\u636e \uff0c\u4e3a\u4e4b\u540e\u5728\u7ebf\u6267\u884credis\u4ee5\u53ca\u5c06\u5b83\u4f5c\u4e3a\u524d\u7f6e\u6761\u4ef6\u6253\u4e0b\u57fa\u7840\u3002","title":"79.\u7f16\u5199Redis\u914d\u7f6e\u529f\u80fd(\u4e0b)"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%288%29%20%E4%B8%8E%E5%89%8D%E7%AB%AF%E8%81%94%E8%B0%83%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%8E%A5%E5%8F%A3%28part%201%29/","text":"\u4e0e\u524d\u7aef\u8054\u8c03\u6ce8\u518c/\u767b\u5f55\u63a5\u53e3(part 1) \u524d\u65b9\u9ad8\u80fd \u54b1\u4eec\u4eca\u5929\u8bb2\u7684\u5185\u5bb9\uff0c\u53ef\u80fd\u548c \u524d\u7aef \u5173\u8054\u6bd4\u8f83\u5927\uff0c\u5982\u679c\u6ca1\u6709\u7ecf\u9a8c\u7684\u540c\u5b66\uff0c\u6216\u8005\u8bf4\u53ea\u60f3\u4e13\u6ce8\u540e\u7aef\u7684\u540c\u5b66\uff0c\u4f60\u4eec\u76f4\u63a5copy\u524d\u7aef\u7684\u4ee3\u7801\u5373\u53ef\u3002 \u79c9\u7740\u6bc1\u4eba\u4e0d\u5026\u7684\u601d\u60f3\uff0c\u7b14\u8005\u6253\u7b97\u7ec6\u8bb2\u4e00\u90e8\u5206\u524d\u7aef\u7684\u5185\u5bb9\uff0c\u6bd5\u7adf\u8fd8\u6709\u4e00\u90e8\u5206\u8bfb\u8005\u662f \u524d\u540e\u517c\u4fee \u7684\u3002 \u5982\u679c\u4f60\u4eec\u4e5f\u60f3React\u76f8\u5173\u77e5\u8bc6\uff0c\u5728\u6211\u8fd9\u91cc\u53ef\u80fd\u4e0d\u80fd\u7cfb\u7edf\u5730\u5b66\u5230\uff0c\u4f46\u662f\u5728 \u6d4b\u8bd5\u5e73\u53f0(\u5e8f) \u4e2d\u4e5f\u4ecb\u7ecd\u4e86\u76f8\u5173\u7684\u524d\u7aef\u5b66\u4e60\u5efa\u8bae\u548c\u5730\u5740\uff0c\u5e0c\u671b\u5927\u5bb6\u6076\u8865\u4e00\u4e0b\uff0c\u6bd5\u7adf\u8fd9\u65b9\u9762\u4e5f\u4e0d\u7b97\u96be\u3002 \u7f16\u5199\u767b\u5f55\u63a5\u53e3 \u4e0e\u6ce8\u518c\u63a5\u53e3\u7c7b\u4f3c\uff0c\u751a\u81f3\u66f4\u52a0\u7b80\u5355\uff0c\u5148\u7406\u4e00\u4e0b\u601d\u8def: \u7528\u6237\u901a\u8fc7 \u9875\u9762 (\u8fd9\u91cc\u6682\u65f6\u8fd8\u6ca1\u6709)\u8f93\u5165 \u7528\u6237\u540d \u548c \u5bc6\u7801 \uff0c\u70b9\u51fb\u767b\u5f55\u6309\u94ae\u8fdb\u884c\u767b\u5f55\uff0c\u5982\u679c\u6210\u529f\u7684\u8bdd\u5219\u5c06\u7528\u6237\u4fe1\u606f\u653e\u5165\u8fd4\u56de\u5373\u53ef\u3002\u5982\u679c\u7528\u6237\u540d\u6216\u8005\u5bc6\u7801\u4e0d\u6b63\u786e\uff0c\u5219\u7ed9\u51fa\u63d0\u793a\uff0c\u62d2\u7edd\u8ba9\u7528\u6237\u767b\u5f55\uff01 Talk is cheap, show me the code! from datetime import datetime from sqlalchemy import or_ from app.middleware.Jwt import UserToken from app.models import db from app.models.user import User from app.utils.logger import Log class UserDao (object) : log = Log( \"UserDao\" ) @staticmethod def register_user (username, name, password, email) : \"\"\" :param username: \u7528\u6237\u540d :param name: \u59d3\u540d :param password: \u5bc6\u7801 :param email: \u90ae\u7bb1 :return: \"\"\" try : users = User.query.filter(or_(User.username == username, User.email == email)).all() if users: raise Exception( \"\u7528\u6237\u540d\u6216\u90ae\u7bb1\u5df2\u5b58\u5728\" ) # \u6ce8\u518c\u7684\u65f6\u5019\u7ed9\u5bc6\u7801\u52a0\u76d0 pwd = UserToken.add_salt(password) user = User(username, name, pwd, email) db.session.add(user) db.session.commit() except Exception as e: UserDao.log.error( f\"\u7528\u6237\u6ce8\u518c\u5931\u8d25: {str(e)} \" ) return str(e) return None @staticmethod def login (username, password) : try : pwd = UserToken.add_salt(password) # \u67e5\u8be2\u7528\u6237\u540d/\u5bc6\u7801\u5339\u914d\u4e14\u6ca1\u6709\u88ab\u5220\u9664\u7684\u7528\u6237 user = User.query.filter_by(username=username, password=pwd, deleted_at= None ).first() if user is None : return None , \"\u7528\u6237\u540d\u6216\u5bc6\u7801\u9519\u8bef\" # \u66f4\u65b0\u7528\u6237\u7684\u6700\u540e\u767b\u5f55\u65f6\u95f4 user.last_login_at = datetime.now() db.session.commit() return user, None except Exception as e: UserDao.log.error( f\"\u7528\u6237 {username} \u767b\u5f55\u5931\u8d25: {str(e)} \" ) return None , str(e) \u7b80\u5355\u89e3\u91ca\u4e00\u4e0b\uff0c\u6211\u4eec\u8fd9\u8fb9\u65b0\u5efa\u4e86\u4e00\u4e2alogin\u7684\u65b9\u6cd5\uff0c\u63a5\u53d7\u53c2\u6570\u662f username \u548c password \uff0c\u63a5\u7740\u6211\u4eec\u901a\u8fc7orm\u7b5b\u9009\u51fa\u7b2c\u4e00\u6761username\u4e0epassword\u5339\u914d\u4e14\u6ca1\u6709\u88ab\u5220\u9664\u7684\u7528\u6237\u3002 \u6ce8\u610f: \u5982\u679c\u8fd9\u91cc\u6ca1\u6709\u8fd9\u4e2a\u7528\u6237\u7684\u8bdd\uff0cuser\u53d8\u91cf\u4f1a\u662fNone\uff0c\u6240\u4ee5\u6211\u91c7\u7528\u4e86\u5224\u65adNone\u7684\u65b9\u5f0f \u6700\u540e\u6211\u4eec\u628a\u8be5\u7528\u6237\u7684 \u6700\u540e\u767b\u5f55\u65f6\u95f4 \u6539\u6210\u4e86\u5f53\u524d\u65f6\u95f4\u3002\u7136\u540e\u63d0\u4ea4\u5230\u4e86orm\u7684session\uff0c\u8fd9\u53e5\u8bdd\u7b49\u540c\u4e8e\u6267\u884csql\u3002 \u601d\u8003 \u6211\u4eec\u5728\u4e0a\u4e00\u4e2a\u63a5\u53e3\u91cc\u9762\uff0c\u6ce8\u518c\u5b8c\u7528\u6237\u4ee5\u540e\u54c8\uff0c\u662f \u6ca1\u6709\u8fd4\u56deUser\u5b9e\u4f8b\u4fe1\u606f \u7684\uff0c\u4f46\u662f\u8fd9\u4e2a\u63a5\u53e3\u4e0d\u540c\uff0c\u7528\u6237\u767b\u5f55\u4ee5\u540e\uff0c\u9700\u8981\u62ff\u5230\u7528\u6237\u7684\u4fe1\u606f\u4ee5\u53catoken\u7ed9\u524d\u7aef\u5904\u7406\u3002 \u4f46\u662f\u6211\u4eec\u7684\u7528\u6237\u5b9e\u4f8b\u5e76\u4e0d\u662f\u4e00\u4e2a JSON \u5bf9\u8c61\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u4e3a\u5b83\u505a\u4e00\u4e9b\u5904\u7406\u3002 \u63a5\u7740\u6211\u4eec\u7f16\u5199pity/handler/factory.py\uff0c\u76ee\u7684\u662f\u4e3a\u4e86\u8f6c\u6362orm\u5bf9\u8c61\u4e3a dict \u3002 from datetime import datetime class ResponseFactory (object) : @staticmethod def model_to_dict (obj, *ignore: str) : data = dict() for c in obj.__table__.columns: if c.name in ignore: # \u5982\u679c\u5b57\u6bb5\u5ffd\u7565, \u5219\u4e0d\u8fdb\u884c\u8f6c\u6362 continue val = getattr(obj, c.name) if isinstance(val, datetime): data[c.name] = val.strftime( \"%Y-%m-%d %H:%M:%S\" ) else : data[c.name] = val return data @staticmethod def model_to_list (data: list, *ignore: str) : return [ResponseFactory.model_to_dict(x, *ignore) for x in data] \u89e3\u91ca\u4e00\u4e0b2\u4e2a\u65b9\u6cd5\uff0c\u7b2c\u4e00\u4e2a\u662f\u5c06User\u6b64\u7c7b\u5b9e\u4f8b\u8f6c\u6362\u4e3adict\u3002\u7531\u4e8eorm\u5b9e\u4f8b\u90fd\u7ee7\u627f\u4e86 db.Model \u7c7b\uff0c\u6240\u4ee5\u4ed6\u4eec\u90fd\u6709__table__\u5c5e\u6027\uff0c\u4e5f\u5c31\u6709\u4e86\u76f8\u5173\u5b57\u6bb5\u7684\u4fe1\u606f\u3002 ignore\u53c2\u6570\u662f\u4e00\u4e2a\u53ef\u53d8\u5b57\u7b26\u4e32\u53c2\u6570\uff0c\u5f53\u6211\u4eec\u9047\u5230\u9700\u8981\u5ffd\u7565\u6389\u7684\u5b57\u6bb5\u65f6\uff0c\u53ef\u4ee5\u6d3e\u4e0a\u7528\u573a\u3002 \u8fd9\u91cc\u53ef\u4ee5\u770b\u5230\u7b14\u8005\u9488\u5bf9datetime\u7c7b\u5bf9\u8c61\u505a\u4e86\u7279\u6b8a\u5904\u7406\uff0c\u8fd9\u662f\u56e0\u4e3aJSON\u4e2d\u6ca1\u6709\u5bf9\u5e94\u7684datetime\u683c\u5f0f\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u5bf9\u4ed6\u4e5f\u8fdb\u884c\u8f6c\u6362\u3002 \u5269\u4e0b\u7684\u5b57\u6bb5\uff0c\u76f4\u63a5\u901a\u8fc7set key value\u7684\u65b9\u5f0f\u8d4b\u503c\u7ed9 data \u5b57\u5178\u5373\u53ef\u3002 model_to_list \u4e5f\u6bd4\u8f83\u7b80\u5355\uff0c\u5c5e\u4e8e\u4e00\u4e2a\u5217\u8868\u751f\u6210\u5f0f\uff0c\u5bf9\u6bcf\u6761orm\u5b9e\u4f8b\u90fd\u8fdb\u884c\u4e86\u8f6c\u6362\uff0c\u6700\u7ec8\u8fd4\u56de\u4e00\u4e2a list(orm object) \u7f16\u5199route\u65b9\u6cd5 \u6700\u540e\u6211\u4eec\u5c31\u9700\u8981\u7f16\u5199\u8def\u7531\u65b9\u6cd5\u4e86\uff0c\u5728pity/controller/auth/user.py\u65b0\u589e\u5982\u4e0b\u65b9\u6cd5: @auth.route(\"/login\", methods=['POST']) def login () : data = request.get_json() username, password = data.get( \"username\" ), data.get( \"password\" ) if not username or not password: return jsonify(dict(code= 101 , msg= \"\u7528\u6237\u540d\u6216\u5bc6\u7801\u4e0d\u80fd\u4e3a\u7a7a\" )) user, err = UserDao.login(username, password) if err is not None : return jsonify(dict(code= 110 , msg=err)) user = ResponseFactory.model_to_dict(user, \"password\" ) token = UserToken.get_token(user) if err is not None : return jsonify(dict(code= 110 , msg=err)) return jsonify(dict(code= 0 , msg= \"\u767b\u5f55\u6210\u529f\" , data=dict(token=token, user=user))) \u8fd9\u8fb9\u8fd8\u662f\u5148\u5224\u65ad\u4e86username\u548cpassword\u662f\u5426\u4e3a\u7a7a\u7684\u60c5\u51b5\uff0c\u5176\u6b21\u8c03\u7528\u4e86 UserDao \u7684 login \u65b9\u6cd5\uff0c\u8fd4\u56deuser\u548cerr\u4fe1\u606f\u3002 \u8fd9\u91cc\u8fd8\u6709\u4e00\u4e2a\u7ec6\u8282\u5c31\u662f\uff0c\u6211\u628a\u7528\u6237\u7684password\u7ed9\u9690\u85cf\u4e86 user = ResponseFactory.model_to_dict(user, \"password\")` \u63a5\u7740\u901a\u8fc7UserToken.get_token\u6210\u529f\u5c06\u5bf9\u8c61\u8f6c\u6362\u6210token\uff0c\u62ff\u5230token\u540e\u8fd4\u56de\u4e86\u8fd9\u6837\u7684\u5bf9\u8c61: { \"code\" : 0 , \"data\" : { \"user\" : {}, \"token\" : \"\" } } \u9a8c\u8bc1 \u4f9d\u65e7\u662f\u719f\u6089\u7684postman\u51fa\u573a\u65f6\u95f4\uff0c\u7b80\u5355\u5730\u6d4b\u8bd5\u4e00\u4e0b: \u5bc6\u7801\u9519\u8bef\u7684\u60c5\u5f62 \u5bc6\u7801\u6b63\u786e\u7684\u8fd4\u56de \u53ef\u4ee5\u770b\u5230\uff0c\u6700\u540e\u767b\u5f55\u65f6\u95f4\u4e5f\u6b63\u5e38\u663e\u793a\u4e86\uff0ctoken\u4e5f\u751f\u6210\u4e86\uff0cpassword\u4e5f\u6ca1\u6709\u66b4\u9732\u3002\u60f3\u8d77\u6296\u97f3\u4e0a\u7684\u4e00\u4e9b\u6587\u6848: \u5a5a\u671f\u5df2\u5b9a\uff0c\u7236\u6bcd\u6ee1\u610f\uff0c\u5bf9\u6211\u4f53\u8d34..... \u6709\u4e00\u79cd\u672a\u6765\u53ef\u671f\u7684\u611f\u89c9\u3002 \u6c42\u9976 \u4eca\u5929\u597d\u50cf \u5e72\u8d27 \u6bd4\u8f83\u591a\uff0c\u770b\u6765\u6ca1\u6709\u8db3\u591f\u7684\u65f6\u95f4\u7559\u7ed9\u524d\u7aef\u8054\u8c03\u4e86\uff0c\u4f1a\u5728\u4e0b\u4e00\u8282\u8865\u5145\u8d77\u6765\u5427\uff0c\u81f3\u4e8e\u540d\u5b57\u5c31\u4e5f\u4e0d\u6539\u4e86\u5427\u3002 \u540e\u7aef\u4ee3\u7801\u5730\u5740: https://github.com/wuranxu/pity \u524d\u7aef\u4ee3\u7801\u5730\u5740: https://github.com/wuranxu/pityWeb \u89c9\u5f97\u6709\u7528\u7684\u8bdd\u53ef\u4ee5\u5e2e\u5fd9\u70b9\u4e2aStar\u54e6QAQ","title":"8.\u4e0e\u524d\u7aef\u8054\u8c03\u6ce8\u518c/\u767b\u5f55\u63a5\u53e3(part 1)"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2880%29%20%E5%B0%81%E8%A3%85Redis%E5%AE%A2%E6%88%B7%E7%AB%AF/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684\u5b8c\u6574 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u6d4b\u8bd5\u5f00\u53d1\u5751\u8d27 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \ud83d\udcd2 \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u7f16\u5199\u4e86Redis\u7684\u76f8\u5173\u914d\u7f6e\u7f16\u8f91\u9875\u9762\uff0c\u535a\u4e3b\u8fd9\u91cc\u4e5f\u8d81\u70ed\u6253\u94c1\uff0c\u628a \u524d\u7aef\u9875\u9762 \u5b8c\u5584\u4e86\u3002\uff08\u53ef\u80fd\u4f1a\u6709\u4e00\u70b9\u70b9\u5c0f\u95ee\u9898\uff0c\u4f46\u5e94\u8be5\u4e3b\u6d41\u7a0b\u90fd\u6b63\u5e38\uff09 \u5176\u5b9e\u548c\u5176\u4ed6\u914d\u7f6e\u7ba1\u7406\u9875\u9762\u5dee\u4e0d\u591a\uff0c\u524d\u7aef\u4f18\u5316\u4e86\u4e00\u4e0b \u9762\u5305\u5c51 \uff0c\u9876\u90e8\u7684\u83dc\u5355\u4e5f\u653e\u56de\u5230\u5de6\u4fa7\u4e86\u3002\u770b\u770bmac\u4e0b\u7684\u6548\u679c: \u8fd9\u91cc\u6211\u7ed9\u81ea\u5df1\u672c\u5730\u90e8\u7f72\u4e86\u4e2a\u5355\u5b9e\u4f8b\u7684redis \u641c\u7d22\u9009\u9879\u6539\u52a8\u4e86\u4e00\u4e9b\uff0c\u6240\u89c1\u5373\u6240\u5f97\uff0c\u5982\u679c\u641c\u7d22\u9879\u53d1\u751f\u53d8\u5316\uff0c\u90a3\u4e48\u5185\u5bb9\u4e5f\u4f1a\u968f\u4e4b\u5207\u6362 \ud83d\udcd2 \u5173\u4e8eRedis\u5ba2\u6237\u7aef\u7684\u9009\u7528 \u5176\u5b9e\u5728\u8fd9\u4e2a\u95ee\u9898\u4e0a\u6211\u662f\u6bd4\u8f83 \u7ea0\u7ed3 \u7684\uff0credis\u6709star\u5f88\u591a\u7684py\u5ba2\u6237\u7aef\uff0c\u4e5f\u6709\u4e0e\u4e4b\u5bf9\u5e94\u7684\u96c6\u7fa4\u7248\u672c\u3002\u4f46\u4ed6\u4eec\u5e76\u4e0d\u652f\u6301 asyncio \u3002 \u800c\u652f\u6301asyncio\u7684aioredis\uff0c\u672c\u8eab\u662f\u4e2a\u5f88\u597d\u7684\u9009\u62e9\uff0c\u4f46\u4eba\u5bb6\u6ca1\u6709\u652f\u6301redis\u96c6\u7fa4\u7684\u8ba1\u5212\u3002orz \u6240\u4ee5\u4eca\u5929\u60f3\u7684\u662f\u8981\u4e0d\u5c31\u7528\u4e2a\u540c\u6b65\u7684redis-cluster-py\u5e93\u7b97\u4e86\uff0c\u4e0d\u8fc7\u5728\u6211\u7ffb\u4e86github\u4e00\u6bb5\u65f6\u95f4\uff0c\u53d1\u73b0\u4e86\u4e2a\u53ebaredis\u7684\u5f02\u6b65\u5e93\u3002\u5927\u6982\u7785\u4e86\u4e0b\uff0c\u4ed6\u57fa\u672c\u4e0a\u662f\u4fdd\u6301\u4e86\u548credis-cluster-py\u63a5\u8fd1\u7684api\uff0c\u53ef\u80fd\u4e5f\u662f\u4e3a\u4e86 \u5438\u5f15\u7528\u6237 \u3002 \u6240\u4ee5\u54b1\u4eec\u5c31\u5148\u8bd5\u9a8c\u4e00\u4e0b\uff0c\u5c0f\u767d\u9f20\u561b\uff0c\u603b\u5f97\u6709\u4eba\u6765\u505a\u3002 \ud83d\udcd2 \u5b89\u88c5aredis \u770b\u5b98\u7f51\u662f\u8981\u5b89\u88c5 aredis[hiredis] \uff0c\u4f46\u6211\u597d\u50cf\u4e0d\u9002\u5408\u8fd9\u6837\u65b9\u5f0f\uff0c\u4e8e\u662f\u6211\u5206\u5f00\u88c5: pip3 install aredis hiredis \ud83d\udcd2 \u7f16\u5199RedisManager \u5176\u5b9e\u8fd9\u91cc\u8fd8\u662f\u548c MySQL \u6bd4\u8f83\u63a5\u8fd1\u7684\uff0c\u4e5f\u662f\u901a\u8fc7\u4e00\u4e2a\u5b57\u5178\u5b58\u653e\u5404\u4e2aredis\u7684\u8fde\u63a5\u914d\u7f6e\u3002 \u4e0d\u8fc7\u7531\u4e8eRedis\u7684\u96c6\u7fa4\u548c\u5355\u5b9e\u4f8b\u8fd8\u6709\u4e00\u70b9\u533a\u522b\uff08\u597d\u5728\u6211\u4eec\u7f16\u5199\u914d\u7f6e\u7684\u65f6\u5019\u5c31\u51c6\u5907\u597d\u4e86\uff09\uff0c\u6240\u4ee5\u6211\u4eec\u6700\u597d\u662f\u9488\u5bf9\u5355\u5b9e\u4f8b\u548c\u96c6\u7fa4\u5206\u522b\u7f16\u51992\u4e2amap\u5b58\u653e\u4ed6\u4eec\u7684client\uff0c\u5f53\u71361\u4e2a\u4e5f\u662fok\u7684\u3002 \u6574\u4f53\u6d41\u7a0b: \u4ece\u5b57\u5178\u83b7\u53d6\u5ba2\u6237\u7aef\uff0c\u5982\u679c\u6ca1\u6709\u5219\u65b0\u5f00\u4e00\u4e2a\u5ba2\u6237\u7aef\uff0c\u5e76\u653e\u5165\u7f13\u5b58\uff0c\u6709\u5219\u8fd4\u56de\u3002 \u53ef\u80fd\u5b58\u5728\u7684\u95ee\u9898 \u4ee3\u7801\u4e0d\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\uff0c\u9700\u8981\u89c2\u5bdf\u662f\u5426\u9700\u8981\u52a0\u9501 \u7f13\u5b58\u4e0d\u50cfLRU\u4f1a\u964d\u9891\uff0c\u4e5f\u4e0d\u80fd\u81ea\u52a8\u8fc7\u671f \u5bf9\u6211\u6765\u8bf4\u7b2c\u4e00\u4e2a\u80af\u5b9a\u662f\u4e2a\u5927\u95ee\u9898\uff0c\u5982\u679c\u51fa\u73b0\u4e86\u5c31\u5fc5\u987b\u5f97\u89e3\u51b3\u3002\u81f3\u4e8e\u7b2c\u4e8c\u4e2a\u95ee\u9898\uff0c\u7531\u4e8eredis\u914d\u7f6e\u5f88\u5c11\u53d8\u52a8\uff0c\u800c\u4e14\u6211\u4eec\u672c\u8eab\u662f\u8fde\u63a5\u6c60\u7684\u5f62\u5f0f\uff0c\u6240\u4ee5\u5f71\u54cd\u4e0d\u7b97\u5927\u3002 \u8bdd\u4e0d\u591a\u8bf4\uff0c\u73b0\u5728\u6211\u4eec\u5c31\u6765\u7f16\u5199\u5427: \"\"\" redis\u5ba2\u6237\u7aef\uff0c\u57fa\u4e8earedis(\u652f\u6301\u96c6\u7fa4\uff0caioredis\u4e0d\u652f\u6301\u96c6\u7fa4) \"\"\" from aredis import StrictRedisCluster, ClusterConnectionPool, ConnectionPool, StrictRedis from app.excpetions.RedisException import RedisException class PityRedisManager (object) : \"\"\"\u975e\u7ebf\u7a0b\u5b89\u5168\uff0c\u53ef\u80fd\u5b58\u5728\u95ee\u9898 \"\"\" _cluster_pool = dict() _pool = dict() @staticmethod def get_cluster_client (redis_id: int, addr: str) : \"\"\" \u83b7\u53d6redis\u96c6\u7fa4\u5ba2\u6237\u7aef :param redis_id: :param addr: :return: \"\"\" cluster = PityRedisManager._cluster_pool.get(redis_id) if cluster is not None : return cluster client = PityRedisManager.get_cluster(addr) PityRedisManager._cluster_pool[redis_id] = client return client @staticmethod def get_single_node_client (redis_id: int, addr: str, password: str, db: str) : \"\"\" \u83b7\u53d6redis\u5355\u5b9e\u4f8b\u5ba2\u6237\u7aef :param redis_id: :param addr: :param password: :param db: :return: \"\"\" node = PityRedisManager._cluster_pool.get(redis_id) if node is not None : return node host, port = addr.split( \":\" ) pool = ConnectionPool(host=host, port=port, db=db, max_connections= 100 , password=password, decode_responses= True ) client = StrictRedis(connection_pool=pool) PityRedisManager._pool[redis_id] = PityRedisManager.get_cluster(addr) return client @staticmethod def refresh_redis_client (redis_id: int, addr: str, password: str, db: str) : \"\"\" \u5237\u65b0redis\u5ba2\u6237\u7aef :param redis_id: :param addr: :param password: :param db: :return: \"\"\" host, port = addr.split( \":\" ) pool = ConnectionPool(host=host, port=port, db=db, max_connections= 100 , password=password, decode_responses= True ) client = StrictRedis(connection_pool=pool, decode_responses= True ) PityRedisManager._pool[redis_id] = client @staticmethod def refresh_redis_cluster (redis_id: int, addr: str) : PityRedisManager._cluster_pool[redis_id] = PityRedisManager.get_cluster(addr) @staticmethod def get_cluster (addr: str) : \"\"\" \u83b7\u53d6\u96c6\u7fa4\u8fde\u63a5\u6c60 :param addr: :return: \"\"\" try : nodes = addr.split( ',' ) startup_nodes = [{ \"host\" : n.split( \":\" )[ 0 ], \"port\" : n.split( \":\" )[ 1 ]} for n in nodes] pool = ClusterConnectionPool(startup_nodes=startup_nodes, max_connections= 100 , decode_responses= True ) client = StrictRedisCluster(connection_pool=pool, decode_responses= True ) return client except Exception as e: raise RedisException( f\"\u83b7\u53d6Redis\u8fde\u63a5\u5931\u8d25, {e} \" ) \u6211\u4eec\u4ee5\u6570\u636e\u5e93\u7684\u552f\u4e00id\u4e3akey\uff0c\u7f13\u5b58redis\u7684 \u8fde\u63a5\u6c60 \u3002 \u7531\u4e8e\u8fde\u63a5\u6c60\u4f1a\u81ea\u52a8\u5f00\u542f/\u5173\u95ed\u8fde\u63a5\uff0c\u6240\u4ee5\u6211\u4eec\u4e0d\u9700\u8981\u624b\u52a8\u5173\u95ed\u5ba2\u6237\u7aef\uff0c\u975e\u5e38\u65b9\u4fbf\u3002 \u4ed4\u7ec6\u770b\u770bredis\u6267\u884ccommand\u7684\u65b9\u6cd5\uff0c\u91cc\u9762\u4f1a\u5f00\u8f9f\u8fde\u63a5\uff0c\u6700\u7ec8\u5173\u95ed\u8fde\u63a5\uff0c\u8fd9\u5c31\u662f\u8fde\u63a5\u6c60\u7684\u597d\u5904\uff0c\u8fde\u63a5\u4e0d\u4f1a\u8fc7\u671f\uff0c\u56e0\u4e3a\u6bcf\u6b21\u90fd\u662f\u65b0\u83b7\u53d6\u7684 \u53ef\u4ee5\u660e\u663e\u770b\u5230\u6211\u4eec\u5206\u522b\u7528\u4e86ClusterConnectionPool\u548cConnectionPool\uff0c\u5206\u522b\u5bf9\u5e94\u96c6\u7fa4\u548c\u5b9e\u4f8b\u3002\u53c2\u6570\u57fa\u672c\u4e0a\u7b97\u662f\u4e00\u81f4\u3002 \u81f3\u4e8erefresh\uff0c\u662f\u7ed9\u6539\u52a8redis\u4ee5\u540e\u505a\u7684 \u5237\u65b0\u8fde\u63a5 \u7684\u5de5\u4f5c\u3002 \u4ee5\u4e0a\u5c31\u662fRedisManager\u7684\u5185\u5bb9\uff0c\u5230\u8fd9\u53ea\u662f\u80fd\u591f\u83b7\u53d6Redis\u5ba2\u6237\u7aef\u4e86\u3002 \ud83d\udcd2 \u5c1d\u8bd5\u4e00\u4e0b \u6709\u6761\u4ef6\u7684\u540c\u5b66\u53ef\u4ee5\u672c\u6b21\u5b89\u88c5redis: $ wget https://download.redis.io/releases/redis-6.2.6.tar.gz $ tar xzf redis-6.2.6.tar.gz $ cd redis-6.2.6 $ make make\u4e86\u4ee5\u540e\uff0c\u4fee\u6539redis-6.2.6\u76ee\u5f55\u4e0b\u7684redis.conf, \u63a5\u7740\u53d6\u6d88\u8fd9\u4e00\u884c\u7684\u6ce8\u91ca: \u4f7f\u7528\u5bc6\u7801\u6a21\u5f0f\uff08redis\u6700\u597d\u662f\u52a0\u5bc6\u7801\uff0c\u7aef\u53e3\u53f7\u4e5f\u5c3d\u91cf\u4e0d\u8981\u7528\u539f\u751f\u76846379\uff0c\u672c\u5b9d\u5b9d\u6709\u53f0\u673a\u5668\u88ab\u4eba\u901a\u8fc7redis\u690d\u5165\u4e86\u6316\u77ff\u7a0b\u5e8f\uff0c \u82e6\u4e0d\u582a\u8a00 \uff09 \u5728redis-6.2.6\u76ee\u5f55\u4e0b\u542f\u52a8 src/redis-server redis.conf \u8fd9\u6837\u672c\u5730redis\u7684\u5b9e\u4f8b\u5c31\u542f\u52a8\u4e86~ \ud83d\udcd2 \u7f16\u5199\u4e2a\u5728\u7ebf\u6d4b\u8bd5redis\u7684\u63a5\u53e3 \u5148\u901a\u8fc7id\u62ff\u5230redis\u7684\u914d\u7f6e\u4fe1\u606f \u7136\u540e\u901a\u8fc7manager\u62ff\u5230\u8fde\u63a5\u6c60 \u5bf9redis\u53d1\u52a8\u547d\u4ee4 \u6211\u4eec\u5728http://localhost:7777/docs\u6253\u5f00swagger\u8c03\u8bd5: \u8bfb\u53d6faker \u8bbe\u7f6efaker\u4e3as12 \u518d\u6b21\u53d6faker \u53ef\u4ee5\u770b\u5230redis\u7684\u76f8\u5173\u64cd\u4f5c\u5df2\u7ecf\u662f\u53ef\u4ee5\u7528\u4e86\uff0c\u90a3\u6211\u4eec\u4eca\u5929\u7684\u5185\u5bb9\u5c31\u5230\u8fd9\u4e86\uff0c\u6109\u5feb\u7684\u5468\u672b\u603b\u662f\u8fa3\u4e48 \u77ed\u6682 \u3002 \u4e0b\u4e00\u8282\u6211\u4eec\u5c31\u5f97\u7f16\u5199\u5728\u7ebf\u6267\u884cRedis\u7684\u547d\u4ee4\u53ca\u76f8\u5173\u9875\u9762\u4e86\uff01","title":"80.\u5c01\u88c5Redis\u5ba2\u6237\u7aef"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2881%29%20%E7%BC%96%E5%86%99%E5%9C%A8%E7%BA%BF%E6%89%A7%E8%A1%8CRedis%E5%8A%9F%E8%83%BD/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684\u5b8c\u6574 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u6d4b\u8bd5\u5f00\u53d1\u5751\u8d27 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \ud83d\udcd2 \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec \u725b\u5200\u5c0f\u8bd5 \uff0c\u7f16\u5199\u4e86redisManager\uff0c\u5e76\u4e14\u6210\u529f\u6267\u884c\u4e86redis\u547d\u4ee4\u3002 \u90a3\u8fd9\u4e00\u8282\uff0c\u5c31\u8ba9\u6211\u4eec\u6765\u6298\u817e\u4e0b\u5728\u7ebf\u6267\u884cRedis\u547d\u4ee4\u3002 \u7531\u4e8e\u67d0\u4e9b\u7279\u5b9a\u7684\u539f\u56e0\uff0c\u5728\u4f7f\u7528aredis\u7684\u65f6\u5019\u6709\u4e86\u4e00\u4e9b\u4e0d\u597d\u7684\u4f53\u9a8c\uff0c\u4e3b\u8981\u662f\u4ee5\u4e0b\u51e0\u4e2a\u65b9\u9762, \u6240\u4ee5\u6211\u6253\u7b97\u5f03\u5751\u4e86\u3002 get\u548cset\u64cd\u4f5c\u6ca1\u6709\u652f\u6301\u4e2d\u6587\uff0c\u975e\u5e38\u96be\u53d7 \u5bf9\u4e8e\u62a5\u9519\u4fe1\u606f\u4e0d\u662f\u90a3\u4e48\u53cb\u597d\uff0c\u56e0\u4e3a\u6211\u8fd9\u8fb9\u51fa\u73b0\u4e86\u4e00\u4e2a\u8fde\u63a5\u51fa\u9519\u7684\u95ee\u9898\uff0c\u53d1\u73b0\u5bf9\u65b9\u7684error\u662fConnectionError\uff0c\u91cc\u9762\u6beb\u65e0\u5185\u5bb9 \u4e4b\u524d\u4e5f\u8bf4\u4e86\uff0c\u8fc1\u79fb\u6210\u672c\u5de8\u4f4e\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5b8c\u7f8e\u5207\u56de\u7528\u6237\u6700\u591a\u7684\u540c\u6b65\u5e93\uff08\u5982\u679c\u8e29\u5751\u4e5f\u6709\u4eba\u4e00\u8d77\u60f3\u529e\u6cd5\uff09 \ud83d\udcd2 \u5b89\u88c5redis\u548credis-py-cluster pip3 install redis redis-py-cluster \ud83d\udcd2 \u6539\u5199Manager\u7c7b \u5176\u5b9e\u8981\u6539\u53d8\u7684\u5e76\u4e0d\u591a\uff0c\u770b\u4e0bgit\u7684\u6539\u52a8\u5c31\u77e5\u9053\u4e86: \u4fee\u6539\u5f15\u5165\u8def\u5f84 \u4fee\u590d\u4e4b\u524d\u7684bug \u4e4b\u524d\u7684\u83b7\u53d6\u5355\u5b9e\u4f8b\u4ece\u96c6\u7fa4\u4e2d\u62ff\u6570\u636e\u4e86\uff0c\u5927\u9519\u7279\u9519\u4e86 \u6539\u5199cluster \u6362\u4e2a\u540d\u5b57\u800c\u5df2\uff0c\u4eceStrictCluster\u6539\u4e3aCluster \ud83d\udcd2 \u5b8c\u5584\u5728\u7ebf\u6267\u884c\u547d\u4ee4\u7684\u65b9\u6cd5 \u505a\u4e00\u4e2a\u5224\u65ad\uff0c\u5982\u679c\u662fcluster\u5219\u83b7\u53d6\u96c6\u7fa4\u5ba2\u6237\u7aef\uff0c\u5426\u5219\u83b7\u53d6\u5b9e\u4f8b\u5ba2\u6237\u7aef \u8fd9\u6837\u6211\u4eec\u7684\u540e\u7aef\u63a5\u53e3\u5c31\u7f16\u5199\u5b8c\u6bd5\u4e86\uff0c\u56e0\u4e3a\u6211\u4eec\u60f3\u505a\u7684\u662f\u7c7b\u4f3credis-cli\u7684\u529f\u80fd\u3002 \u5bfb\u627e\u524d\u7aef\u7ec4\u4ef6 \u6211\u4eec\u9700\u8981\u4e00\u4e2aweb\u7248\u672c\u7684\u7ec8\u7aef\uff0c\u6240\u4ee5\u6211\u5728github\u5bfb\u627e\u4e86\u5f88\u4e45\uff0c\u627e\u5230\u4e86\u8fd9\u6837\u4e00\u6b3e\u8d28\u91cf\u8fd8\u4e0d\u9519\u7684: \u5230\u65f6\u5019\u6211\u4eec\u7684\u9875\u9762\u4e0a\uff0c\u5c31\u8ba9\u7528\u6237\u8f93\u5165\u8fd9\u4e2a\u4e86 \u6700\u7ec8\u6548\u679c \u6700\u7ec8\u663e\u793a\u6548\u679c \u8fd8\u662f\u6bd4\u8f83\u4e11\uff0c\u5de6\u4fa7\u662f\u73b0\u6709\u7684redis\u8fde\u63a5\u914d\u7f6e\uff0c\u53f3\u4fa7\u662f\u7c7b\u4f3credis-cli\u7684\u5ba2\u6237\u7aef\u9875\u9762\u3002 \u5728\u53f3\u4fa7\u6267\u884c\u8bed\u53e5\u4ee5\u540e\uff0c\u5c31\u4f1a\u8c03\u7528\u6211\u4eec\u521a\u624d\u7f16\u5199\u7684 redis\u5728\u7ebf\u6267\u884c\u63a5\u53e3 \u3002 \u51d1\u5408\u80fd\u7528\u5c31\u884c\u3002\u7ed9\u5927\u5bb6\u770b\u770b\u4f7f\u7528gif: \u76ee\u524d\u53ea\u652f\u6301\u57fa\u7840\u7684\u64cd\u4f5c\uff0c\u5305\u62ec\u5e38\u89c1\u7684: get set hget hset hgetall \u7b49\u7b49 \ud83d\udcd2 \u81ea\u52a8\u66f4\u65b0Redis \u6bcf\u5f53\u914d\u7f6e\u6709\u53d8\u66f4\u7684\u65f6\u5019\uff0c\u6211\u4eec\u90fd\u9700\u8981 \u53d8\u66f4RedisManager\u4e2d\u7684\u6570\u636e \uff0c\u6240\u4ee5\u6211\u4eec\u4e4b\u524d\u4e3a\u4e4b\u7f16\u5199\u4e86Refresh\u65b9\u6cd5\u3002 \u6211\u4eec\u4fee\u6539update/delete\u65b9\u6cd5: \u5220\u9664client\u4e5f\u7f16\u5199\u4e86\u4e00\u4e2a\u65b9\u6cd5 \u8fd9\u91cc\u7684background_tasks\u662f\u6765\u81eafastapi\u7684\u540e\u53f0\u4efb\u52a1\uff0c\u5982\u679c\u5927\u5bb6\u4e86\u89e3go\u7684\u8bdd\uff0c\u8fd9\u91cc\u5c31\u7b49\u4e8e: func test () { // \u4e1a\u52a1\u903b\u8f91 result := xxx go RedisManager. delete () return result } \u5176\u5b9e\u5c31\u662f\u4e00\u4e2a\u540e\u53f0\u4efb\u52a1\uff0c\u54b1\u4eec\u7684\u4e3b\u4f53\u65b9\u6cd5\u53ef\u4ee5\u76f4\u63a5return\u4e86\u3002 \u5220\u9664\u5ba2\u6237\u7aef\u7684\u65b9\u6cd5\uff0c\u5982\u679c\u662f\u96c6\u7fa4\u5219pop\u96c6\u7fa4\u5b57\u5178 \u4eca\u5929\u7684\u5185\u5bb9\u5c31\u5230\u8fd9\u4e86\uff0c\u4e0b\u671f\u6211\u4eec\u89e3\u51b3APScheduler \u91cd\u590d\u6267\u884c \u7684\u95ee\u9898\u3002","title":"81.\u7f16\u5199\u5728\u7ebf\u6267\u884cRedis\u529f\u80fd"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2882%29%20%E8%A7%A3%E5%86%B3APScheduler%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8C%E7%9A%84%E9%97%AE%E9%A2%98/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684\u5b8c\u6574 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u6d4b\u8bd5\u5f00\u53d1\u5751\u8d27 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \ud83d\udcd2 \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u7f16\u5199\u4e86\u5728\u7ebf\u6267\u884cRedis\u547d\u4ee4\u7684\u529f\u80fd\uff0c\u9875\u9762\u4e5f\u52c9\u5f3a\u80fd\u7528\u4e86\u3002\u5bf9\u4e8e\u524d\u7f6e\u6761\u4ef6\u8fd9\u5757\u6765\u8bf4\uff0c\u5c31\u597d\u50cf\u6c99\u9c81\u541e\u4e8617\u53f7\uff0c\u5df2\u7ecf\u7b97\u534a\u4e2a \u5b8c\u5168\u4f53 \u4e86\u3002 \u6211\u4eec\u8d81\u70ed\u6253\u94c1\uff0c\u89e3\u51b3\u4e00\u4e0b\u56e0\u4e3a\u90e8\u7f72\u591a\u673a\u5668\u5f15\u53d1\u7684Apscheduler\u91cd\u590d\u6267\u884c\u7684\u95ee\u9898\u3002 \ud83d\udcd2 APScheduler\u5e26\u6765\u7684\u95ee\u9898 APScheduler\u5176\u5b9e\u672c\u8d28\u4e0a\u8fd8\u662f\u4e00\u4e2a \u5b9a\u65f6\u4efb\u52a1\u7ec4\u4ef6 \uff0c\u5b83\u5e76\u6ca1\u6709celery\u90a3\u4e48\u5f3a\u5927\u590d\u6742\u7684\u7cfb\u7edf\u3002\u9488\u5bf9\u591a\u53f0\u673a\u5668\uff0c\u6216\u8005uvicorn(gunicorn)\u7684\u591a\u4e2aworker\uff0c\u5b83\u662f\u4f1a \u91cd\u590d\u6267\u884c \u7684\u3002 \u8fd9\u91cc\u611f\u8c22\u4e00\u4e0b\u5c0f\u53f3\u541b\uff0c\u4ed6\u544a\u8bc9\u6211\u524d\u9762\u6709\u5927\u5751\u3002 \u50cf\u6211\u4eec\u5e73\u65f6\u90a3\u4e48\u542f\u52a8: if __name__ == \"__main__\" : uvicorn.run(app= 'main:pity' , host= '0.0.0.0' , port= 7777 ) \u8fd9\u6837 \u5176\u5b9e\u53ea\u5f00\u4e861\u4e2aworker \uff0c\u4f60\u60f3\u5440\uff0c1\u4e2a\u5de5\u4eba\u6267\u884c\u5b9a\u65f6\u4efb\u52a1\uff0c\u5f53\u7136\u4e0d\u5b58\u5728\u7ade\u4e89\u7684\u95ee\u9898\uff0c\u4f46\u591a\u4e2a\u5de5\u4eba\u4e00\u8d77\u6267\u884c\uff0c\u4f60\u5c31\u5b58\u5728 \u4fe1\u606f\u4e0d\u5bf9\u79f0 \u7684\u95ee\u9898\u3002 \u5de5\u4ebaA\u5230\u70b9\u4e86\uff0c\u8981\u5e72\u6d3b\u4e86\uff0c\u4ed6\u4e0d\u77e5\u9053B\u4e5f\u51c6\u5907\u5e72\u540c\u6837\u7684\u6d3b\u513f\uff0c\u6240\u4ee5\u4efb\u52a1\u91cd\u590d\u6267\u884c\u7684\u95ee\u9898\uff0c\u5c31\u51fa\u73b0\u4e86\u3002 \ud83d\udcd2 \u89e3\u51b3\u95ee\u9898\u7684\u65b9\u5411 \u6211\u53ea\u542f\u52a81\u4e2aworker \u6709\u70b9\u50bb\uff0c\u800c\u4e14\u6027\u80fd\u4e0d\u597d\u4f7f\uff0c\u591a\u53f0\u673a\u5668\u90e8\u7f72\u4f9d\u7136\u6709\u95ee\u9898\u3002 \u63a8\u8350\u6307\u6570: 0\u9897\u661f \u521d\u59cb\u5316sceduler\u7684\u65f6\u5019\uff0c\u5229\u7528socket\u5360\u636e\u4e00\u4e2a\u56fa\u5b9a\u7684\u7aef\u53e3\u6bd4\u59822333 \u7aef\u53e3\u53f7\u53ea\u80fd\u88ab1\u4e2aworker\u5360\u9886\uff0c\u5176\u4ed6worker\u62ff\u4e0d\u5230\uff0c\u4e5f\u5c31\u8d77\u4e0d\u6765\u4e86\u3002\u4f46\u8fd8\u662f\u4e0d\u80fd\u652f\u6301\u591a\u8282\u70b9\u90e8\u7f72\uff0c\u5b9e\u9645\u4e0a\u53ea\u67091\u4e2aworker\u4f7f\u7528\uff0c\u6d6a\u8d39\u4e861\u4e2a \u7aef\u53e3 \u3002 \u63a8\u8350\u6307\u6570: \u2b50\u2b50\u2b50 \u5206\u5e03\u5f0f\u9501 \u4e0d\u591f\u8f7b\u91cf\uff0c\u9700\u8981\u5f15\u5165\u7b2c\u4e09\u65b9\u7ec4\u4ef6\u5982: Redis/Zookeeper/ Etcd \u3002\u4f46\u80fd\u5f88\u597d\u89e3\u51b3\u591aworker\u548c\u591a\u8282\u70b9\u7684\u95ee\u9898\u3002 \u63a8\u8350\u6307\u6570: \u2b50\u2b50\u2b50 \u529e\u6cd5\u5f88\u591a\uff0c\u4f46\u662f\u597d\u7528\u7684 \u771f\u4e0d\u591a \u3002\u7531\u4e8e\u6211\u4eec\u672c\u8eab\u5c31\u9700\u8981\u5f15\u5165Redis\uff0c\u8fd8\u662f\u79c9\u7740\u4e0d\u6ee5\u7528\u4e2d\u95f4\u4ef6\u7684\u539f\u5219\uff0c\u6240\u4ee5\u6211\u4eec\u6253\u7b97\u7528Redis\u7684\u5206\u5e03\u5f0f\u9501\u3002 \u800c\u5173\u4e8eredis\u5206\u5e03\u5f0f\u9501\uff0c\u6709\u5f88\u591a\u4ecb\u7ecd\u3002\u6211\u4eec\u7528\u725b\u4eba\u4eec\u5c01\u88c5\u597d\u7684RedLock\u6765\u5e2e\u6211\u4eec\u89e3\u51b3\u540c\u65f6\u6267\u884c\u95ee\u9898\u3002 \ud83d\udcd2 Redlock \u6bd4\u8d77\u81ea\u5df1setnx+\u7528lua\u811a\u672c\u4fdd\u969c\u5206\u5e03\u5f0f\u9501\u6267\u884c\uff0c\u5b98\u65b9\u540e\u9762\u7ed9\u51fa\u4e86redlock\u7684\u89e3\u51b3\u65b9\u6848\u3002\u66f4\u591a\u8fd9\u4e9b\u7ec6\u8282\u53ef\u4ee5\u81ea\u884c\u641c\u7d22 Redlock \u3002 \u6211\u4eec\u8fd9\u8fb9\u91c7\u7528\u7b2c\u4e09\u65b9\u7684\u5e93: Redlock\u6765\u7b80\u5316\u6211\u4eec\u7684\u5f00\u53d1\u3002 \u5b83\u7684api\u6bd4\u8f83\u7b80\u5355 \u57fa\u672c\u4e0a\u7528with\u83b7\u53d6lock\uff0c\u4f20\u5165redis\u8282\u70b9\u4fe1\u606f\u5373\u53ef\uff0c\u63a5\u7740\u6211\u4eec\u5c31\u53ef\u4ee5\u7f16\u5199\u76f8\u5173\u4ee3\u7801\u4e86\u3002 \u6211\u4eec\u8fd8\u662f\u7528\u88c5\u9970\u5668\u7684\u65b9\u6cd5\uff0c\u5728\u60f3\u8981\u52a0\u9501\u7684\u65b9\u6cd5\u5f15\u5165\u6b64\u88c5\u9970\u5668\u3002key\u662f\u81ea\u5df1\u5b9a\u4e49\u7684\u6267\u884ckey\uff0c\u7528\u4e8e\u786e\u5b9a\u9501\u7684\u552f\u4e00\u6027\u3002 \u5206\u5e03\u5f0f\u9501\u7684\u539f\u7406\u5c31\u662f\u591a\u53f0\u8bbe\u5907\u540c\u65f6\u53bb\u8bd5\u56fe\u521b\u5efakey\uff0c\u5148\u521b\u5efa\u6210\u529f\u7684\u5c31\u6267\u884c\u5bf9\u5e94\u7684\u64cd\u4f5c\u3002\u6240\u4ee5\u5bf9\u4e8e\u6240\u6709\u8282\u70b9\u6765\u8bf4\uff0ckey\u5fc5\u987b\u90fd\u7edf\u4e00\u8d77\u6765\uff0c\u5e76\u4e14\u4e0d\u80fd\u548c\u5176\u4ed6\u5206\u5e03\u5f0f\u9501\u7684key\u51b2\u7a81\u3002 import functools import os from redlock import RedLock, RedLockError from config import Config def lock (key) : def decorator (func) : @functools.wraps(func) async def wrapper (*args, **kwargs) : try : # \u8bd5\u56fe\u83b7\u53d6\u5206\u5e03\u5f0f\u9501\uff0c\u5982\u679c\u6ca1\u6709\u83b7\u53d6\u5230\u5219\u4f1a\u629b\u51faRedLockError\uff0c\u6240\u4ee5\u6211\u4eec\u8fd9\u91cc\u6355\u83b7\u5b83 with RedLock( f\"distributed_lock: {func.__name__} : {key} : {str(args)} \" , connection_details=Config.RedisCluster, ): return await func(*args, **kwargs) except RedLockError: print( f\"\u8fdb\u7a0b: {os.getpid()} \u83b7\u53d6\u4efb\u52a1\u5931\u8d25, \u4e0d\u7528\u62c5\u5fc3\uff0c\u8fd8\u6709\u5176\u4ed6\u54e5\u4eec\u7ed9\u4f60\u6267\u884c\u4e86\" ) return wrapper return decorator \u5173\u4e8e\u552f\u4e00key\u7684\u786e\u8ba4\uff0c\u6211\u8fd9\u8fb9\u9996\u5148\u52a0\u4e0a\u4e86 distributed_lock \u7684\u524d\u7f00\uff0c\u662f\u56e0\u4e3a\u65b9\u4fbf\u533a\u5206\u5176\u4ed6key\uff0c\u63a5\u7740\u901a\u8fc7\u51fd\u6570\u540d\u79f0+\u552f\u4e00key\u786e\u8ba4\u5206\u5e03\u5f0fkey\uff0c\u4f46\u7531\u4e8e\u6709\u7684\u65b9\u6cd5\u662f\u5e26 \u53c2\u6570 \u7684\uff0c\u6240\u4ee5\u6211\u9009\u62e9\u518d\u52a0\u4e00\u4e2aargs\uff0c\u6765\u652f\u6301\u90a3\u4e9b \u540c\u65b9\u6cd5\u4e0d\u540c\u53c2\u6570\u7684\u4efb\u52a1 \u3002 \ud83d\udcd2 \u8fd0\u7528\u5230pity\u4e4b\u4e2d \u5728\u88c5\u9970\u5668\u6587\u4ef6\u4e2d\u6dfb\u52a0lock\u88c5\u9970\u5668 \u6211\u4eec\u53ea\u9700\u8981\u5728run_test_plan\u65b9\u6cd5\u52a0\u4e0alock\u8fd9\u4e2a\u88c5\u9970\u5668\u5373\u53ef\uff0c\u603b\u4f53\u6765\u8bf4\u8fd8\u662f \u975e\u5e38\u65b9\u4fbf \u7684\u3002 \u5982\u679c\u9700\u8981\u6d4b\u8bd5\u7684\u8bdd\uff0c\u5927\u5bb6\u53ef\u4ee5\u7528\u4ee5\u4e0b\u547d\u4ee4\u542f\u52a8pity: uvicorn main:pity --host=0.0.0.0 --port=7777 --workers=4 \u53ef\u4ee5\u770b\u5230\uff0c\u65e5\u5fd7\u90fd\u8f93\u51fa\u4e864\u4efd\uff0c\u56e0\u4e3a\u67094\u4e2aworker\u3002\u7528\u8fd9\u4e2a\u6a21\u5f0f\u542f\u52a8 PITY \u7684\u8bdd\uff0c\u53ef\u4ee5\u770b\u5230\u5bf9\u5e94\u7684\u6548\u679c\u3002 \u5173\u4e8eRedlock\uff0c\u8fd9\u8282\u5c31\u4ecb\u7ecd\u5230\u8fd9\u91cc\u4e86\u3002\u4e0b\u4e00\u8282\u6211\u4eec\u8981\u5728\u524d\u7f6e\u6761\u4ef6\u4e2d\u652f\u6301Redis\u8bed\u53e5\uff0c\u656c\u8bf7\u671f\u5f85\u5427\u3002","title":"82.\u89e3\u51b3APScheduler\u91cd\u590d\u6267\u884c\u7684\u95ee\u9898"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2883%29%20%E5%89%8D%E7%BD%AE%E6%9D%A1%E4%BB%B6%E6%94%AF%E6%8C%81Redis%E8%AF%AD%E5%8F%A5/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684\u5b8c\u6574 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u6d4b\u8bd5\u5f00\u53d1\u5751\u8d27 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \ud83d\udcd2 \u56de\u987e \u4e0a\u8282\u6211\u4eec\u6253\u4e86\u4e2a\u91ce\uff0c\u89e3\u51b3\u4e86\u4e00\u4e0b APScheduler \u7684\u91cd\u590d\u6267\u884c\u95ee\u9898\u3002\u5728\u66f4\u4e0a\u4e00\u8282\uff0c\u6211\u4eec\u7f16\u5199\u597d\u4e86Redis\u7684\u5728\u7ebf\u6267\u884c\u529f\u80fd\u3002 \u90a3\u8fd9\u4e00\u8282\u6211\u4eec\u5c31\u5f97\u628a\u5b83\u8fd0\u7528\u5230 \u524d\u7f6e\u6761\u4ef6 \u91cc\u9762\u6765\u4e86\u3002 \ud83d\udcd2 \u6210\u679c\u5c55\u793a \u7531\u4e8e\u535a\u4e3b\u90fd\u662f\u5148\u7f16\u7801\uff0c\u518d\u5199\u6587\u3002\u6240\u4ee5\u662f\u80fd\u5c55\u793a\u6210\u679c\u7684\uff0c\u4eca\u65e5\u4efd\u53d8\u5316\u5982\u4e0b: \u652f\u6301\u4e86\u524d\u7f6e\u6761\u4ef6\uff08REDIS\u7c7b\u578b\uff09 \u7a0d\u5fae\u6539\u52a8\u4e86\u4e0b\u9875\u9762, \u611f\u89c9\u6709\u4e9b\u82b1\u91cc\u80e1\u54e8\u4e86 \u70b9\u51fb\u5de6\u8fb9\u64ad\u653e\u6309\u94ae\u53ef\u4ee5\u5728\u7ebf\u6267\u884credis\u547d\u4ee4 \ud83d\udcd2 \u601d\u8def \u524d\u7f6e\u6761\u4ef6\u8981\u60f3\u652f\u6301Redis\uff0c\u601d\u8def\u5176\u5b9e\u5f88\u7b80\u5355\uff0c\u6a21\u5f0f\u4e5f\u548c SQL \u5dee\u4e0d\u591a\u3002\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u7167\u642cSQL\u7684\u4ee3\u7801\u3002 \u4e4b\u524d\u6211\u4eec\u7684Executor\u90fd\u653e\u5728utils\u5305\u4e0b\u9762\uff0c\u5176\u5b9e \u5f88\u4e0d\u53cb\u597d \u3002\u4e3a\u4e86\u663e\u793a\u4e13\u4e1a\u6027\uff0c\u6211\u51b3\u5fc3\u628aExecutor\u4eceutils\u62bd\u79bb\u51fa\u6765\uff0c\u653e\u5230\u65b0\u76ee\u5f55 core \u4e0b\u9762\u3002 \u8fd9\u4e2acore\u76ee\u5f55\u6253\u7b97\u653e\u4e00\u4e9b\u7528\u4f8b\u6267\u884c\u7684\u6838\u5fc3\u65b9\u6cd5\uff0c\u54b1\u4eec\u62ed\u76ee\u4ee5\u5f85\u3002 \ud83d\udcd2 \u5982\u4f55\u4fee\u6539\u6587\u4ef6\u800c\u4e0d\u5f71\u54cd\u5176\u4ed6\u6570\u636e \u8fd9\u4e2a\u5c31\u9700\u8981\u4f1f\u5927\u7684Pycharm\u4e86\uff0c\u6211\u4eec\u5176\u5b9e\u65b0\u5efa\u4e00\u4e2acore\u76ee\u5f55\u4ee5\u540e\uff0c\u76f4\u63a5\u628aexecutor.py\u79fb\u52a8\u5230core\u76ee\u5f55\u5373\u53ef\u3002 \u901a\u8fc7pycharm\u79fb\u52a8\u6587\u4ef6\uff0c\u4ed6\u4e0d\u4ec5\u4ec5\u53ea\u662f\u79fb\u52a8\u6587\u4ef6\u90a3\u4e48\u7b80\u5355\uff0c\u5b83\u8fd8\u4f1a\u5e2e\u4f60\u5904\u7406\u8fd9\u4e2a\u6587\u4ef6\u5f15\u5165\u4e86\u54ea\u4e9b\u5305\uff0c\u5982\u679c\u8def\u5f84\u53d1\u751f\u53d8\u5316\u4e86\uff0c\u4ed6\u4e5f\u4f1a\u81ea\u52a8\u5e2e\u5fd9\u66f4\u65b0\uff0c\u5982\u679c\u6709\u5176\u4ed6\u6587\u4ef6\u5f15\u7528\u4e86executor.py\uff0c\u5b83\u4e5f\u4f1a\u987a\u9053\u5e2e\u52a9\u66f4\u65b0\u3002 \u6709\u5982\u6b64\u5f3a\u5927\u7684ide\u4f5c\u4e3a\u652f\u6491\uff0c\u6240\u4ee5\u6211\u73a9\u8d77\u6765\u4e5f\u662f \u968f\u5fc3\u6240\u6b32 \u3002 \ud83d\udcd2 \u62c6\u5206Executor \u968f\u7740case\u6267\u884c\u7684\u903b\u8f91\u8d8a\u6765\u8d8a\u591a\uff0c\u6211\u4eec\u7684executor.py\u6709\u70b9hold\u4e0d\u4f4f\uff0c\u5012\u4e0d\u662f\u8bf4\u4e00\u4e2apy\u6587\u4ef6\u4e0d\u80fd\u653e1000\u884c\u4ee3\u7801\uff0c\u53ea\u662f\u6211\u4eec\u6ca1\u6709\u5fc5\u8981\u8ba9\u5b83\u90a3\u4e48 \u81c3\u80bf \u3002 \u6211\u4eec\u6700\u80fd\u62c6\u9664\u7684\u5c31\u662f\u6267\u884c\u6784\u9020\u65b9\u6cd5\u7684\u51fd\u6570\u4e86\uff0c\u9996\u5148\u6211\u4eec\u7684\u6784\u9020\u65b9\u6cd5\u6709\u56fa\u5b9a\u7684\u51e0\u79cd\uff0c\u5148\u770b\u770b\u53ea\u652f\u6301sql\u548c\u7528\u4f8b\u7684\u65f6\u5019\uff0c\u6211\u4eec\u662f\u600e\u4e48\u5199\u7684: async def execute_constructor (self, env, index, path, params, req_params, constructor: Constructor) : if not constructor.enable: self.append( f\"\u5f53\u524d\u8def\u5f84: {path} , \u6784\u9020\u65b9\u6cd5: {constructor.name} \u5df2\u5173\u95ed, \u4e0d\u7ee7\u7eed\u6267\u884c\" ) return if constructor.type == 0 : try : data = json.loads(constructor.constructor_json) case_id = data.get( \"case_id\" ) testcase, _ = await TestCaseDao.async_query_test_case(case_id) self.append( f\"\u5f53\u524d\u8def\u5f84: {path} , \u7b2c {index + 1 } \u6761\u6784\u9020\u65b9\u6cd5\" ) # \u8bf4\u660e\u662fcase executor = Executor(self.logger) new_param = data.get( \"params\" ) if new_param: temp = json.loads(new_param) req_params.update(temp) result, err = await executor.run(env, case_id, params, req_params, f\" {path} -> {testcase.name} \" ) if err: raise Exception(err) if not result[ \"status\" ]: raise Exception( f\"\u65ad\u8a00\u5931\u8d25, \u65ad\u8a00\u6570\u636e: {result.get( 'asserts' , 'unknown' )} \" ) params[constructor.value] = result # await self.parse_params(testcase, params) except Exception as e: raise Exception( f\" {path} -> {constructor.name} \u7b2c {index + 1 } \u4e2a\u6784\u9020\u65b9\u6cd5\u6267\u884c\u5931\u8d25: {e} \" ) elif constructor.type == 1 : # \u8bf4\u660e\u662fsql\u8bed\u53e5 try : self.append( f\"\u5f53\u524d\u8def\u5f84: {path} , \u7b2c {index + 1 } \u6761\u6784\u9020\u65b9\u6cd5\" ) data = json.loads(constructor.constructor_json) database = data.get( \"database\" ) sql = data.get( \"sql\" ) self.append( f\"\u5f53\u524d\u6784\u9020\u65b9\u6cd5\u7c7b\u578b\u4e3asql, \u6570\u636e\u5e93\u540d: {database} \\nsql: {sql} \\n\" ) sql_data = await DbConfigDao.execute_sql(env, database, sql) params[constructor.value] = sql_data self.append( f\"\u5f53\u524d\u6784\u9020\u65b9\u6cd5\u8fd4\u56de\u53d8\u91cf: {constructor.value} \\n\u8fd4\u56de\u503c:\\n {sql_data} \\n\" ) except Exception as e: raise Exception( f\" {path} -> {constructor.name} \u7b2c {index + 1 } \u4e2a\u6784\u9020\u65b9\u6cd5\u6267\u884c\u5931\u8d25: {e} \" ) \u53ef\u4ee5\u770b\u5230\uff0c\u624d2\u79cd\u65b9\u6cd5\uff0c\u5c31\u5df2\u7ecf\u5f88 \u81c3\u80bf \u4e86\u3002\u5176\u5b9e\u66f4\u53ef\u8bfb\u4e00\u70b9\u7684\u5199\u6cd5\uff0c\u9700\u8981\u628a\u51e0\u79cd\u6784\u9020\u65b9\u6cd5\u62c6\u5f00\uff0c\u62c6\u5f00\u540e\u5206\u522b\u6709\u4e00\u4e2arun\u65b9\u6cd5\uff0c\u8fd9\u6837\u6211\u4eec\u53ea\u9700\u8981\u5224\u65ad\u7c7b\u578b\u662f\u5565\uff0c\u6267\u884c\u5bf9\u5e94\u7684run\u65b9\u6cd5\u5373\u53ef\u3002 \ud83d\udcd2 \u65b0\u5efaabstract\u57fa\u7c7b from abc import ABC from app.models.constructor import Constructor class ConstructorAbstract (ABC) : @staticmethod def run (executor, env, index, path, params, req_params, constructor: Constructor, **kwargs) : pass \u57fa\u7c7b\u65b9\u6cd5\u7c7b\u4f3cJava\u7684abstract\u7c7b\uff0c\u5b9a\u4e49\u4e00\u4e2a\u7c7b\uff0c\u4e0d\u5b9e\u73b0\u91cc\u9762\u7684\u65b9\u6cd5\u5219\u65e0\u6cd5 \u5b9e\u4f8b\u5316 \u3002 sql\u5b9e\u73b0 \u548c\u4ee5\u524d\u7c7b\u4f3c\uff0c\u53ea\u662f\u628a\u4ee3\u7801\u62f7\u8d1d\u4e86\u8fc7\u6765\uff0c\u653e\u5230\u4e86\u65b0\u7c7b\u4e0b\u9762 testcase\u5b9e\u73b0 \u6d4b\u8bd5\u7528\u4f8b\u8fd9\u513f\u6709\u4e9b\u590d\u6742\u7684\u53d8\u52a8: \u4e00\u822c\u6765\u8bf4\uff0c\u6211\u4eec\u662fcase\u8c03\u7528\u524d\u7f6e\u6761\u4ef6\u7684run\u65b9\u6cd5\uff0c\u4f46\u7531\u4e8e\u6d4b\u8bd5\u7528\u4f8b\u9700\u8981\u518d\u6b21\u8c03\u7528executor\uff0c\u6240\u4ee5\u5bfc\u81f4\u4e86\u4ec0\u4e48\u5462\uff1f executor\u5f15\u7528testcase\u5f15\u7528executor\uff0c\u4e5f\u5c31\u662f\u5f15\u7528\u5faa\u73af\uff0c\u8fd9\u5728python\u91cc\u9762\u662f\u7981\u6b62\u7684\uff0c\u6bd5\u7adf\u4f60 \u5957\u5a03 \u4e86\uff01 \u6240\u4ee5\u8fd9\u91cc\u91c7\u53d6\u7684\u571f\u65b9\u6cd5\u662f\u628a\u6211\u7684Executor\u7c7b\u5f53\u53c2\u6570\u4f20\u9012\u8fdb\u6765 =\u3002=\uff08\u591f\u571f\uff09 redis\u5b9e\u73b0 \u5176\u5b9e\u6267\u884credis\u7684\u65f6\u5019\u6211\u4eec\u5df2\u7ecf\u7f16\u5199\u8fc7\u7c7b\u4f3c\u7684\u65b9\u6cd5\u4e86\uff0c\u4f46\u56e0\u4e3a\u4e4b\u524d\u662f\u6839\u636eid\u6267\u884credis\uff0c\u73b0\u5728\u8981\u6539\u6539\uff0c\u9700\u8981\u6839\u636ename\u6267\u884c\u3002 \u6839\u636ename\u6267\u884c\u6709\u4e9b\u8feb\u4e0d\u5f97\u5df2\uff0c\u4e3b\u8981\u662f\u56e0\u4e3a\u6211\u4eeccase\u7f16\u5199\u662f\u9002\u914d\u591a\u5957\u73af\u5883\uff0c\u5982\u679c\u4f20\u5165id\u7684\u8bdd\uff0c\u90a3\u4e48redis\u5bf9\u5e94\u7684\u90fd\u662f\u56fa\u5b9a\u73af\u5883\u7684\u914d\u7f6e\uff0c\u65e0\u6cd5\u9002\u914d\u591a\u73af\u5883\u3002 \u548csql\u4e00\u6837\uff0c\u6211\u4eec\u91c7\u53d6 env+name\u786e\u5b9aredis\u8fde\u63a5\uff08name\u4e0d\u53d8\uff0cenv\u5207\u6362\u7684\u65f6\u5019\uff0credis\u8fde\u63a5\u4e5f\u53d8\u6210\u52a8\u6001\u4e86\uff09 redis\u6267\u884c\u547d\u4ee4\u8fd8\u9700\u6539\u52a8\u4e00\u4e0b\u5509: \u8fd9\u91cc\u4f20\u5165\u7684\u53c2\u6570\u4e0d\u53ea\u662fid\u4e86\uff0c\u5f53\u4f60\u4f20\u5165id=xx\u7684\u65f6\u5019\u5219\u6839\u636eid\u67e5\u8be2\uff0c\u4f20\u5165name=xxx\u7684\u65f6\u5019\u5c31\u6839\u636ename\u67e5\u8be2\uff0c\u517c\u5bb9\u4e86 \u5728\u7ebf\u6267\u884credis\u7684\u63a5\u53e3 \u3002 \ud83d\udcd2 executor\u6536\u5c3e \u65b0\u7684\u6267\u884c\u6784\u9020\u65b9\u6cd5\u7684\u51fd\u6570\u5f88\u8f7b\u4fbf\uff0c\u867d\u7136\u4e5f\u6709if else\uff0c\u4f46\u6bd4\u4e4b\u524d\u4e00\u5768\u597d\u591a\u4e86\uff09 \ud83d\udcd2 \u6700\u7ec8\u6548\u679c \u770b\u8d77\u6765\u4e00\u76ee\u4e86\u7136\uff0c\u5176\u5b9e\u6709\u70b9\u50cfinterface\u548cimpl\u3002 \u4eca\u5929\u7684\u5185\u5bb9\u5c31\u5230\u8fd9\u91cc\u5566~\u4e0b\u4e00\u6ce2\u505a\u5565\u8fd8\u6ca1\u60f3\u597d\uff0c\u53ef\u80fd\u4f1a\u5b8c\u5584\u540e\u7f6e\u6761\u4ef6\u6216\u8005\u5728\u7ebf\u6267\u884ccase\u4e5f\u6216\u8005\u4e03\u725b\u4e91oss\u5427\u3002\u524d\u8def\u6f2b\u6f2b\uff0c\u90fd\u5df2\u7ecf83\u8282\u4e86\u3002 \u5728\u7ebf\u4f53\u9a8c: http://test.pity.fun \u559c\u6b22\u7684\u8bdd\u53ef\u4ee5\u7ed9pity\u70b9\u4e2astar\u54e6\uff0c\u4f60\u4eec\u7684star\u662f\u6211\u7684\u52a8\u529b= =","title":"83.\u524d\u7f6e\u6761\u4ef6\u652f\u6301Redis\u8bed\u53e5"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2884%29%20%E6%94%AF%E6%8C%81%E5%A4%8D%E5%88%B6%E5%85%B6%E4%BB%96%E5%89%8D%E7%BD%AE%E6%9D%A1%E4%BB%B6/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684\u5b8c\u6574 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \ud83d\udcd2 \u56de\u987e \u524d\u6587\u6211\u4eec\u652f\u6301\u4e86Redis\u8fd9\u79cd \u524d\u7f6e\u6761\u4ef6 \uff0c\u4f46\u5176\u5b9e\u6709\u4e2a\u7279\u522b\u4e0d\u53cb\u597d\u7684\u5730\u65b9: \u5982\u679c\u524d\u7f6e\u6761\u4ef6\u6bd4\u8f83\u63a5\u8fd1\uff0c\u6211\u751a\u81f3\u4e8e\u4e0d\u80fd\u590d\u5236\u5b83\u4eec\u3002 \u5982\u679c\u80fd\u50cf\u524d\u7f6ecase\u4e00\u6837\uff0c\u9009\u62e9\u4e00\u4e2a\u53bb\u5feb\u901f \u590d\u5236 \uff0c\u6240\u4ee5\u8bf4\u8fd9\u6837\u662f\u5341\u5206\u4e0d\u53cb\u597d\u7684\u3002 \u90a3\u8fd9\u4e00\u8282\u6211\u4eec\u5c31\u6765\u5b9e\u73b0\u5b83\u3002 \ud83d\udcd2 \u6548\u679c\u56fe \u8001\u89c4\u77e9\uff0c\u5148\u653e\u4e0a\u6548\u679c\u56fe: \u4e0d\u540c\u7684\u524d\u7f6e\u6761\u4ef6\u6570\u636e\u4f1a\u7b5b\u9009\u51fa\u4e0d\u540c\u7c7b\u578b\u7684\u6570\u636e \ud83d\udcd2 \u601d\u8def \u5176\u5b9e\u8981\u652f\u6301\u8fd9\u4e2a\u64cd\u4f5c\uff0c\u5bf9\u4e8e\u540e\u7aef\u6765\u8bf4\u8fd8\u662f\u6bd4\u8f83\u7b80\u5355\u7684\u3002 \u597d\u5728\u6211\u4eec\u7684\u540e\u7aef\u7684Constructor\u6709\u4e2atype\u5b57\u6bb5\uff0c\u7528\u4e8e\u533a\u5206\u524d\u7f6e\u6761\u4ef6\u7684\u7c7b\u578b\u3002\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u5b89\u6392\u4e00\u4e2a \u67e5\u8be2\u63a5\u53e3 : \u6839\u636e\u7c7b\u578b\u67e5\u627e\u51fa\u524d\u7f6e\u6761\u4ef6\u7684\u660e\u7ec6\uff0c\u7136\u540e\u9009\u62e9\u540e\uff0c\u524d\u7aef\u7528\u8868\u5355\u7684\u65b9\u5f0f\u5e26\u5165\u8fdb\u6765\uff0c\u5373\u53ef\u590d\u5236\u6574\u4e2a\u524d\u7f6e\u6761\u4ef6\u3002 \ud83d\udcd2 \u540e\u7aef\u5148\u884c \u7f16\u5199\u67e5\u8be2\u63a5\u53e3\uff0c\u5c55\u793a\u5b83\u5c5e\u4e8e\u54ea\u4e00\u4e2acase\uff0c\u5e76\u4e14\u7ed9\u51fa\u524d\u7f6e\u6761\u4ef6\u7684\u7ec6\u8282\u3002 \u524d\u7aef\u5462\uff0c\u5219\u662f\u5df2\u7ecf\u786e\u5b9a\u597d\u4e86 TreeSelect \u7ec4\u4ef6\uff0c\u6240\u4ee5\u540e\u7aef\u91c7\u75282\u5c42\u7684\u6570\u636e\u683c\u5f0f: [ { \"title\" : \"\u7528\u4f8b\" , \"key\" : \"caseid\" , \"children\" : [ { \"title\" : \"\u6570\u636e\u6784\u9020\u5668A\" , \"key\" : \"constructor_id\" } ]} ] \u90a3\u6211\u4eec\u5c31 \u9020\u8d77\u6765 \u5427~ \u7f16\u5199\u601d\u8def \u6211\u4e0d\u6253\u7b97\u7528join(\u4ece\u4e00\u5f00\u59cb\u6211\u5c31\u8d2f\u5f7b\u4e86\u81ea\u5df1\u8fd9\u4e2a\u601d\u60f3\uff0c\u6211\u66f4\u559c\u6b22\u75282\u6b21\u67e5\u8be2\uff0c\u81ea\u5df1\u62fc\u63a5\u6570\u636e\u7684\u65b9\u5f0f\uff0c\u5176\u5b9e\u662fjoin\u7528\u7684\u4e0d\u597d) \u6211\u4eec\u4f18\u5148\u67e5\u51fa\u5bf9\u5e94\u7c7b\u578b\u7684 \u524d\u7f6e\u6761\u4ef6 \uff0c\u63a5\u7740\u5c31\u80fd\u62ff\u5230\u6240\u6709case_id\u4e86\uff0c\u518d\u7528case_id\u53bb\u67e5\u51facase\u7684\u4fe1\u606f\uff0c\u5c82\u4e0d\u7f8e\u54c9\uff1f \u53ea\u662f\u96be\u70b9\u5728\u4e8e\u600e\u4e48\u7ec4\u6210\u8fd9\u4e2a\u6811\uff0c\u4f46\u5176\u5b9e\u8fd9\u4e2a\u6811\u53ea\u67092\u5c42\uff0c\u6211\u4eec\u8981\u505a\u7684\u5c31\u662f\u5148\u7ec4\u88c5children\uff0c\u6700\u540e\u62fcparent\u3002 \u8fd9\u91cc\u6211\u4eec\u5c31\u8981\u7528\u5230 defaultdict \u4e86\u3002 \u67e5\u51fa\u7b26\u5408\u6761\u4ef6\u7684\u524d\u7f6e\u6761\u4ef6\uff0c\u5e76\u6839\u636ecase_id\u4e3akey\uff0c\u524d\u7f6e\u6761\u4ef6\u4e3avalue\u7684\u65b9\u5f0f\uff0c\u5b58\u653e\u5230defaultdict \u6839\u636edefaultdict\u7684keys\u67e5\u51facase_id\u5bf9\u5e94\u7684case\u540d\u79f0\uff0c\u904d\u5386\u4e4b\uff0c\u62fc\u51d1parent\uff0c\u5e76\u628adefaultdict\u91cc\u9762\u7684value\u653e\u5230children\u5b57\u6bb5\u3002 \u6765\u770b\u770b\u4ee3\u7801: @staticmethod async def get_case_and_constructor (constructor_type: int) : # \u6700\u7ec8\u8fd4\u56de\u7ed3\u679c\u6811 ans = list() async with async_session() as session: # \u6b64\u5904\u5b58\u653ecase_id => \u524d\u7f6e\u6761\u4ef6\u7684\u6620\u5c04 constructors = defaultdict(list) # \u6839\u636e\u4f20\u5165\u7684\u524d\u7f6e\u6761\u4ef6\u7c7b\u578b\uff0c\u627e\u51fa\u6240\u6709\u524d\u7f6e\u6761\u4ef6, \u7c7b\u578b\u4e00\u81f4\uff0c\u5171\u4eab\u5f00\u5173\u6253\u5f00\uff0c\u5e76\u672a\u88ab\u5220\u9664 query = await session.execute( select(Constructor).where( Constructor.type == constructor_type, Constructor.public == True , Constructor.deleted_at == None )) # \u5e76\u628a\u8fd9\u4e9b\u524d\u7f6e\u6761\u4ef6\u653e\u5230constructors\u91cc\u9762 for q in query.scalars().all(): constructors[q.case_id].append({ \"title\" : q.name, \"key\" : f\" {q.id} \" , \"isLeaf\" : True , # \u8fd9\u91cc\u662f\u4e3a\u4e86\u62ff\u5230\u5177\u4f53\u7684\u4ee3\u7801\uff0c\u56e0\u4e3a\u6811\u4e00\u822c\u53ea\u6709name\u548cid\uff0c\u6211\u4eec\u8fd9\u8fd8\u9700\u8981\u5176\u4ed6\u6570\u636e \"constructor_json\" : q.constructor_json, }) # \u4e8c\u6b21\u67e5\u8be2\uff0c\u67e5\u51fa\u6709\u524d\u7f6e\u6761\u4ef6\u7684case query = await session.execute( select(TestCase).where(TestCase.id.in_(constructors.keys()), TestCase.deleted_at == None )) # \u6784\u9020\u6811\uff0c\u8981\u77e5\u9053children\u5df2\u7ecf\u6784\u5efa\u597d\u4e86\uff0c\u5c31\u5728constructors\u91cc\u9762 for q in query.scalars().all(): # \u628a\u7528\u4f8bid\u653e\u5165cs_list\uff0c\u8fd9\u91cc\u5c31\u4e0d\u7528\u539f\u751fjoin\u4e86 ans.append({ \"title\" : q.name, \"key\" : f\"case_ {q.id} \" , \"disabled\" : True , \"children\" : constructors[q.id] }) return ans \u6ce8\u91ca\u5199\u7684\u975e\u5e38\u8be6\u7ec6\uff0c\u6bcf\u4e00\u6b65\u90fd\u4ea4\u4ee3\u7684 \u5f88\u6e05\u695a \u3002 \u63a5\u7740\u662f\u63a5\u53e3\u90e8\u5206\uff0c\u5c31\u4e0d\u9700\u8981\u591a\u8bf4\u4e86: # \u83b7\u53d6\u6240\u6709\u6570\u636e\u6784\u9020\u5668 @router.get(\"/constructor/list\") async def list_case_and_constructor (constructor_type: int) : try : ans = await ConstructorDao.get_case_and_constructor(constructor_type) return PityResponse.success(ans) except Exception as e: return PityResponse.failed(str(e)) \ud83d\udcd2 \u524d\u7aef\u9002\u914d \u5176\u5b9e\u524d\u7aef\u9002\u914d\u5f88\u7b80\u5355\uff0c\u52a0\u4e00\u4e2a\u7ec4\u4ef6\uff0c\u5e76\u4e14\u5728\u7ec4\u4ef6\u9009\u4e2d\u503c\u7684\u65f6\u5019\u66f4\u65b0\u8868\u5355\u7684\u503c\u5c31\u53ef\u4ee5\u4e86\u3002 oh shit~~ \u5199\u5230\u8fd9\u91cc\u6211\u624d\u53d1\u73b0\u6211\u5c45\u7136\u5199\u8fc7\u7c7b\u4f3c\u7684\u4ee3\u7801\uff0c\u96be\u53d7= = \u7528\u7684\u65b9\u6cd5\u8fd8\u662f\u5982\u51fa\u4e00\u8f99 \u679c\u7136\u4eba\u4f1a\u5728\u540c\u4e00\u4e2a\u5730\u65b9\u5012\u4e0b\uff0c\u4e0d\u8fc7\u6211\u89c9\u5f97\u4e4b\u524d\u5199\u7684\uff0c\u6ca1\u6709\u5bf9\u524d\u7f6e\u6761\u4ef6\u8fdb\u884c\u5206\u7c7b\uff0c\u6240\u4ee5\u6211\u5f97\u6539\u9020\u6539\u9020\uff0c\u6216\u8005\u8bf4\u8fd9\u6b21\u5199\u7684\u5f53\u505av2\u63a5\u53e3\u4f7f\u7528\u3002 \u4e0d\u5f97\u4e0d\u8bf4\uff0c\u524d\u7aef\u7684\u6539\u52a8\u6bd4\u60f3\u8c61\u4e2d\u8fd8 \u5927\u4e00\u70b9 \u3002\u4ed4\u7ec6\u6bd4\u5bf9\u4e86\u8fd9\u4e2a\u63a5\u53e3\uff0c\u53d1\u73b0\u5b83\u7684\u903b\u8f91\u662f: \u627e\u5230\u5bf9\u5e94\u7684\u524d\u7f6e\u6761\u4ef6id \u67e5\u8be2\u524d\u7f6e\u6761\u4ef6\u7684\u6570\u636e\uff0c\u8fdb\u884c\u66ff\u6362 \u4f46\u4e4b\u524d\u7684\u63a5\u53e3\u53ea\u9488\u5bf9case\u7c7b\u578b\uff0c\u6240\u4ee5\u5f88\u9e21\u808b\u3002 \u6211\u4eec\u76ee\u524d\u628a\u5b83\u505a\u4e86\u4e00\u4e2a\u8239\u65b0\u7248\u672c\u6765\u9002\u914d\u6211\u4eec\u6240\u6709\u7684\u7c7b\u578b: import {Col, Row, TreeSelect} from \"antd\" ; import {connect} from 'umi' ; import {useEffect} from \"react\" ; const CopyTreeSelect = ( {construct, dispatch} ) => { const {constructorData, searchConstructor, constructorType} = construct; const save = ( data ) => { dispatch({ type : 'construct/save' , payload : data, }) } const getConstructorData = () => { dispatch({ type : 'construct/getConstructorTree' , payload : { constructor_type : constructorType } }) } useEffect( () => { getConstructorData(); }, [constructorType]) return ( < Row style = {{marginTop: 24 , marginBottom: 24 }}> < Col span = {3}/ > < Col span = {18} > < Row > < Col span = {4}/ > < Col span = {20} > < TreeSelect allowClear showSearch style = {{width: ' 100 %'}} value = {searchConstructor} filterTreeNode = {(inputValue, treeNode ) => { return treeNode.title.toLowerCase().indexOf(inputValue.toLowerCase()) > -1 }} dropdownStyle={{maxHeight: 600, overflow: 'auto'}} treeData={constructorData} placeholder=\"\u901a\u8fc7\u641c\u7d22\u6784\u9020\u6761\u4ef6\uff0c\u53ef\u4ee5\u5feb\u901f\u590d\u5236\u53c2\u6570\u54e6\uff01\" treeDefaultExpandAll onChange={(e) => { save({searchConstructor: e}) if (e !== undefined) { dispatch({ type: 'construct/getConstructorData', payload: {id: e.split(\"_\")[1]} }) } else { dispatch({ type: 'construct/save', payload: {testCaseConstructorData: {type: constructorType, public: true, enable: true}}, }) } }} /> </ Col > </ Row > </ Col > < Col span = {3}/ > </ Row > ) } export default connect( ( {loading, construct} ) => ({loading, construct}))(CopyTreeSelect); \u628a\u8fd9\u4e2a\u7ec4\u4ef6\u5355\u72ec\u62bd\u51fa\uff0c\u6210\u4e3a\u4e00\u4e2a copy\u7ec4\u4ef6 \u3002\u5e76\u5728\u524d\u7f6e\u6761\u4ef6\u7c7b\u578b\u53d8\u5316\u7684\u65f6\u5019\uff0c\u81ea\u52a8\u66f4\u6362 \u6570\u636e\u6e90 \u3002 \u9875\u9762\u4e0a\u518d\u8fdb\u884c\u4e00\u4e9b\u5fae\u8c03\uff0c\u5c31ok\u4e86\u3002\u8bf4\u5b9e\u8bdd\u8fd9\u5757\u6709\u70b9\u81c3\u80bf\uff0c\u7531\u4e8e\u6211\u81ea\u5df1\u90fd\u770b\u4e0d\u4e0b\u53bb\uff0c\u6240\u4ee5\u6211\u5148\u653e\u8fc7\u81ea\u5df1\uff0c\u4e5f\u653e\u8fc7\u5927\u5bb6\u3002 \u4e0b\u4e00\u8282\u6211\u4eec\u5c0f\u8bd5\u725b\u5200\uff0c\u7f16\u5199\u4e00\u4e2a\u7b80\u5355\u7684 \u6d4b\u8bd5\u62a5\u544a\u90ae\u4ef6\u901a\u77e5 \u529f\u80fd\u3002\uff08\u5176\u5b9e\u8bf4\u7b80\u5355\u4e5f\u4e0d\u7b80\u5355\uff0c\u5982\u679c\u8981\u8bbe\u8ba1\u5230\u6837\u5f0f\uff0c\u8fd8 \u633a\u9ebb\u70e6 \uff09","title":"84.\u652f\u6301\u590d\u5236\u5176\u4ed6\u524d\u7f6e\u6761\u4ef6"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2885%29%20%E6%8A%8Aredis%E8%BF%90%E7%94%A8%E5%88%B0%E5%AE%9E%E6%88%98%E4%B8%AD/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684\u5b8c\u6574 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \ud83d\udcd2 \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u8ba9\u652f\u6301\u4e86 \u524d\u7f6e\u6761\u4ef6 \u590d\u5236\u529f\u80fd\u3002\u8fd9\u4e00\u8282\u672c\u6765\u6253\u7b97\u7ed9\u5927\u5bb6\u8bb2\u8bb2\u90ae\u4ef6\u7684\u53d1\u9001\u3002 \u4f46\u5728\u6b64\u4e4b\u524d\uff0c\u6211\u60f3\u4e86\u4e00\u4e2a\u5f88 \u4e25\u91cd \u7684\u95ee\u9898\u3002 \ud83d\udcd2 \u914d\u7f6e \u6211\u4eec\u7684\u6d4b\u8bd5\u5e73\u53f0\uff0c\u540e\u7eed\u4f1a\u63a5\u5165yapi\uff0c\u63a5\u5165\u5176\u4ed6\u7cfb\u7edf\u3002\u52bf\u5fc5\u4f1a\u6709\u4e00\u4e2a\u5730\u65b9\u53bb\u7ef4\u62a4\u8fd9\u4e9b\u6570\u636e\u3002 \u5305\u62ec\u53d1\u4ef6\u4eba\u90ae\u7bb1\uff0c\u5bc6\u7801\u7b49\u7b49\u6570\u636e\u3002 \u4f46\u8fd9\u4e9b\u6570\u636e\u53c8\u901a\u5e38\u662f\u5168\u5c40\u5171\u4eab\uff0c\u5982\u679c\u653e\u5230db\u7684\u8bdd\uff0c\u5f88\u9e21\u808b\uff0c\u56e0\u4e3a\u6570\u636e\u53ea\u67091\u6761\uff0c\u5982\u679c\u653e\u5230redis\uff0c\u6709\u53ef\u80fd\u6570\u636e\u4f1a\u4e22\u3002 \u535a\u4e3b\u4e5f\u4e0d\u77e5\u9053\u653e\u54ea\u91cc\u6bd4\u8f83\u597d\uff0c\u6700\u540e\u51b3\u5b9a\u653e\u5230\u4e00\u4e2aconfiguration.json\u7684\u914d\u7f6e\u6587\u4ef6\u91cc\u9762\u4e86\u3002 \u4f46\u662f\u9891\u7e41\u8bfb\u53d6\u6587\u4ef6\uff0c\u603b\u5f52\u662f\u4e0d\u597d\u7684\u3002\u800c\u4e14\u6211\u4eec\u7ebf\u4e0a\u4f1a\u6709\u8bb8\u591a\u4e2aworker\uff0c\u8fd8\u53ef\u80fd\u4f1a\u6709 \u51b2\u7a81 \u3002 \u60f3\u5230\u6211\u4eec\u4e4b\u524d\u62ff\u634f\u8fc7\u7684redis\uff0c\u8fd9\u4e0d\u6b63\u662f\u5b83\u7684\u7528\u6b66\u4e4b\u5730\u5417\uff1f \ud83d\udcd2 \u7f16\u5199\u901a\u7528cache\u65b9\u6cd5 \u5728\u6b64\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u601d\u8003\u4e00\u4e0b \u4e3a\u5565\u8981\u5199\u8fd9\u6837\u7684\u901a\u7528\u7f13\u5b58\u529e\u6cd5 : \u6211\u4eec\u83b7\u53d6\u6570\u636e\uff0c\u67092\u90e8\u5206\uff0c\u5206\u522b\u4e3aget\u548cset\u3002\u7ed3\u5408\u7f13\u5b58\u6765\u770b\uff0c\u6211\u4eec\u53ef\u4ee5\u5199\u51fa\u8fd9\u6837\u7684\u4f2a\u4ee3\u7801: def get_cache () : data = redis.get(key) if data is not None : return data data = get_data() redis.set(key, data) return data \u5c31\u662f\u8fd9\u4e48\u7b80\u5355\u7684\u7528\u6cd5\uff0c\u5982\u679ckey\u83b7\u53d6\u5230\u4e86\uff0c\u6211\u4eec\u76f4\u63a5return\uff0c\u5982\u679c\u6ca1\u83b7\u53d6\u5230\uff0c\u6211\u4eec\u66f4\u65b0\u6570\u636e\uff0c\u5e76\u628a\u6570\u636e\u5199\u5165redis\uff0c\u6700\u540e\u8fd4\u56dedata\u3002 \u90a3\u6211\u4eec\u4fee\u6539\u6570\u636e\u7684\u65f6\u5019\u600e\u4e48\u505a\u5462\uff1f def update_cache () : update(data) redis.delete(key) \u5148\u66f4\u65b0\u6570\u636e\u6e90 \u5220\u9664\u7f13\u5b58\u6570\u636e\uff0c\u8fd9\u6837\u4e0b\u53bb\u83b7\u53d6\u7f13\u5b58\u7684\u65f6\u5019\u5c31\u4f1a \u91cd\u65b0\u83b7\u53d6\u6570\u636e \u5e76\u5199\u5165\u7f13\u5b58 \u4f46\u5927\u5bb6\u6709\u6ca1\u6709\u89c9\u5f97\u8fd9\u4e2a\u8fc7\u7a0b\u5f88\u7e41\u7410\uff0c\u800c\u4e14\u5c5e\u4e8e get\u548cset\u4e4b\u5916 \u7684\u64cd\u4f5c\uff0c\u6bcf\u6bcf\u6709\u8fd9\u79cd\u64cd\u4f5c\u7684\u65f6\u5019\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u628a\u5b83 \u88c5\u9970\u5668 \u5316\u3002 \ud83d\udcd2 \u7f16\u5199cache\u88c5\u9970\u5668 \u8fde\u63a5\u672c\u5730redis\u7684\u65b9\u6cd5 \u9996\u5148\u6211\u4eec\u5728config.py\u914d\u7f6e\u597dredis\u7684\u8fde\u63a5\u4fe1\u606f\uff0c\u63a5\u7740\u7f16\u5199client\u5ba2\u6237\u7aef\uff0c\u56e0\u4e3a\u5b83\u672c\u8eab\u662f\u8fde\u63a5\u6c60\u6a21\u5f0f\uff0c\u6240\u4ee5\u6211\u4eec\u4e00\u76f4\u7528\u8fd9\u4e2a \u5ba2\u6237\u7aef \u90fd\u6ca1\u95ee\u9898\u3002\uff08\u6240\u4ee5\u6211\u8fd9\u91cc\u628a\u5b83\u8bbe\u7f6e\u4e3a\u4e86property\uff09 \u7f16\u5199RedisHelper helper\u7c7b\u542b\u67092\u4e2a\u88c5\u9970\u5668\uff0ccache\u8d1f\u8d23\u8bfb\u53d6(get)\uff0cup_cache\u8d1f\u8d23\u66f4\u65b0(set)\u3002 class RedisHelper (object) : pity_prefix = \"pity\" pity_redis_client = PityRedisManager().client @staticmethod def get_key (key: str) : return f\" {RedisHelper.pity_prefix} : {key} \" @staticmethod def cache (key: str, expired_time= 3 * 60 ) : \"\"\" \u81ea\u52a8\u7f13\u5b58\u88c5\u9970\u5668 :param key: \u88ab\u7f13\u5b58\u7684key :param expired_time: \u9ed8\u8ba4key\u8fc7\u671f\u65f6\u95f4 :return: \"\"\" def decorator (func) : @functools.wraps(func) def wrapper (*args, **kwargs) : redis_key = RedisHelper.get_key(key) data = RedisHelper.pity_redis_client.get(redis_key) # \u7f13\u5b58\u5df2\u5b58\u5728 if data is not None : return json.loads(data) # \u83b7\u53d6\u6700\u65b0\u6570\u636e new_data = func(*args, **kwargs) info = json.dumps(new_data) RedisHelper.pity_redis_client.set(redis_key, info, ex=expired_time) return new_data return wrapper return decorator @staticmethod def up_cache (key: str) : \"\"\" redis\u7f13\u5b58key\uff0c\u5957\u4e86\u6b64\u65b9\u6cd5\uff0c\u4f1a\u81ea\u52a8\u6267\u884c\u66f4\u65b0\u6570\u636e\u64cd\u4f5c\u540e\u5220\u9664\u7f13\u5b58 :param key: :return: \"\"\" def decorator (func) : @functools.wraps(func) def wrapper (*args, **kwargs) : redis_key = RedisHelper.get_key(key) # \u83b7\u53d6\u6700\u65b0\u6570\u636e new_data = func(*args, **kwargs) # \u66f4\u65b0\u6570\u636e\uff0c\u5220\u9664\u7f13\u5b58 RedisHelper.pity_redis_client.delete(redis_key) return new_data return wrapper return decorator \u8fd9\u91cc\u6211\u4eec\u57fa\u672c\u4e0a\u6309\u7167\u4e4b\u524d\u8bf4\u7684 \u903b\u8f91 \u6765\u505a\u7684\uff0c\u4ee5\u540e\u6211\u4eec\u53d6\u6570\u636e\u7684\u65b9\u6cd5\uff0c\u53ea\u9700\u8981\u5728\u65b9\u6cd5\u524d\u9762+\u4e0acache\u88c5\u9970\u5668\uff0c\u5373\u53ef\u81ea\u52a8\u8ddfredis\u6253\u901a\u3002\uff08\u6709\u7f13\u5b58\u5219\u53d6\u7f13\u5b58\u6570\u636e\uff0c\u65e0\u5219\u53d6\u771f\u5b9e\u6570\u636e\uff09 \ud83d\udcd2 \u7f16\u5199\u914d\u7f6e\u6587\u4ef6\u83b7\u53d6\u65b9\u6cd5 \u6211\u4eec\u7f16\u5199configuration.json\u5230\u6839\u76ee\u5f55: \u8fd9\u91cc\u653e\u90ae\u4ef6\u4fe1\u606f\uff0c\u8fd8\u6709\u672a\u6765\u8981\u89c4\u5212\u7684yapi\u4fe1\u606f import json import os from app.middleware.RedisManager import RedisHelper from config import Config class SystemConfiguration (object) : \"\"\" \u7cfb\u7edf\u914d\u7f6e \"\"\" @staticmethod @RedisHelper.cache(\"configuration\", 24 * 3600) def get_config () : try : filepath = os.path.join(Config.ROOT, \"configuration.json\" ) if not os.path.exists(filepath): raise Exception( \"\u6ca1\u627e\u5230\u914d\u7f6e\u6587\u4ef6\uff0c\u8bf7\u68c0\u67e5configuration\u6587\u4ef6\u662f\u5426\u5df2\u7ecf\u88ab\u5220\u9664\" ) with open(filepath, mode= \"r\" , encoding= 'utf-8' ) as f: return json.load(f) except Exception as e: raise Exception( f\"\u83b7\u53d6\u7cfb\u7edf\u8bbe\u7f6e\u5931\u8d25, {e} \" ) @staticmethod @RedisHelper.up_cache(\"configuration\") def update_config (config) : try : filepath = os.path.join(Config.ROOT, \"configuration.json\" ) if not os.path.exists(filepath): raise Exception( \"\u6ca1\u627e\u5230\u914d\u7f6e\u6587\u4ef6\uff0c\u8bf7\u68c0\u67e5configuration\u6587\u4ef6\u662f\u5426\u5df2\u7ecf\u88ab\u5220\u9664\" ) with open(filepath, mode= \"r\" , encoding= 'utf-8' ) as f: json.dump(config, f) except Exception as e: raise Exception( f\"\u66f4\u65b0\u7cfb\u7edf\u8bbe\u7f6e\u5931\u8d25, {e} \" ) \u7531\u4e8e\u914d\u7f6e\u6587\u4ef6\u4e00\u822c\u5f88\u5c11\u66f4\u65b0\uff0c\u6240\u4ee5\u6211\u4eec\u628akey\u7684\u8fc7\u671f\u65f6\u95f4\u8bbe\u4e3a\u4e861\u5929\uff08\u5176\u5b9e\u53ef\u4ee5\u66f4\u4e45\u4e00\u70b9\uff09\u3002 \u8fd9\u6837\uff0c\u6211\u4eec\u8c03\u7528get_config\u5c31\u53ef\u4ee5\u62ff\u5230\u7cfb\u7edf\u8bbe\u7f6e\u5566\uff0c\u91cc\u9762\u6709\u54b1\u4eec\u5f88\u91cd\u8981\u7684\u53d1\u4ef6\u4eba\u4fe1\u606f\u3002 \ud83d\udcd2 \u6d4b\u8bd5\u4e00\u4e0b \u542f\u52a8\u7a0b\u5e8f\u4ee5\u540e\uff0c\u6211\u4eec\u53bb\u67e5\u8be2redis\u4e2d\u5173\u4e8econfiguration\u7684key\uff0c\u5c31\u7528\u54b1\u4eec\u81ea\u5df1\u5199\u7684\u5ba2\u6237\u7aef: \u518d\u6d4b\u8bd5\u4e0b\u8fc7\u671f\u65f6\u95f4: \u4eca\u5929\u7684\u5185\u5bb9\u5c31\u5230\u8fd9\u91cc\uff0c\u4e0b\u8282\u6b63\u5f0f\u5f00\u542f\u53d1\u90ae\u4ef6(\u62a5\u544a\u901a\u77e5)\u4e4b\u65c5\u3002","title":"85.\u628aredis\u8fd0\u7528\u5230\u5b9e\u6218\u4e2d"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2886%29%20%E5%8F%91%E9%80%81%E7%AC%AC%E4%B8%80%E5%B0%81%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A%E9%82%AE%E4%BB%B6/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \ud83d\udcd2 \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u5229\u7528redis\uff0c\u505a\u4e86\u4e00\u4e2a \u7f13\u5b58\u5668 \u3002\u4f46\u5176\u5b9e\u5b83\u662f\u5b58\u5728\u4e00\u5b9a\u7684\u95ee\u9898\u7684\uff0c\u63a5\u7740\u6211\u4f1a\u8bb2\u3002 \u4e0b\u9762\u6211\u4eec\u5c31\u5b9e\u73b0\u4e00\u53d1\u6700\u7b80\u5355\u7684\u90ae\u4ef6\u901a\u77e5\u529f\u80fd\u3002 \ud83d\udcd2 \u7ed3\u679c\u5c55\u793a \u54ed\u4e86\uff0c\u4e3a\u4e86\u770b\u5230\u6548\u679c\uff0c\u6211\u5c45\u7136\u81ea\u5df1\u8f70\u70b8\u81ea\u5df1 \ud83d\udcd2 \u7533\u8bf7\u90ae\u7bb1 \u6211\u7684\u90ae\u7bb1\u5f88\u5b9d\u8d35\uff0c\u5927\u5bb6\u522b\u7528\u3002\u53ef\u4ee5\u7533\u8bf7126\u6216\u8005163\u7684\u90ae\u7bb1\uff0c\u7136\u540e\u5f00\u542fPOP3/SMTP\u534f\u8bae\u5373\u53ef\u3002 \u4e00\u822c\u5728\u90ae\u7bb1->\u8bbe\u7f6e\u91cc\u9762\uff0c\u770b\u5230POP3/SMTP\u70b9\u8fdb\u53bb\u4f1a\u6709\u6307\u5f15\u3002 \u56e0\u4e3a \u76f4\u63a5\u7528\u5bc6\u7801\u662f\u4e0d\u53ef\u4ee5\u7684 \u3002 \ud83d\udcd2 \u7f16\u5199Notification\u901a\u77e5\u7c7b \u8fd9\u4e2a\u901a\u77e5\u7c7b\u5176\u5b9e\u662f\u4e2a\u865a\u5047\u7684\u7c7b\uff0c\u4e5f\u662f\u4e2a \u62bd\u8c61\u7c7b \u3002\u56e0\u4e3a\u901a\u77e5\u7684\u65b9\u5f0f\u6709\u5f88\u591a\u79cd\uff0c\u5305\u62ec\u90ae\u4ef6\u3001\u77ed\u4fe1\u3001\u9489\u9489\u3001\u4f01\u4e1a\u5fae\u4fe1\u3001\u98de\u4e66\u7b49\u7b49\u3002\u6240\u4ee5\u6211\u4eec\u5c31\u7ed9\u4ed6\u4e00\u4e2a\u7a7a\u58f3\uff0c\u800c\u5230\u5177\u4f53\u7684\u90ae\u4ef6\u5565\u7684\u65f6\u5019\u518d\u5b9e\u73b0 \u5177\u4f53\u7684\u65b9\u6cd5 \u3002 \u5b83\u957f\u8fd9\u6837 \u7edf\u4e00\u63a5\u53d7subject\uff08\u4e3b\u9898/\u6807\u9898\uff09\uff0ccontent\uff08\u5185\u5bb9\uff09\uff0cattachment(\u9644\u4ef6\uff0c\u90ae\u4ef6\u7528\u7684\u591a)\uff0c\u63a5\u6536\u4eba\u3002 \ud83d\udcd2 \u7f16\u5199\u901a\u8fc7userId\u6279\u91cf\u83b7\u53d6\u90ae\u7bb1\u7684\u65b9\u6cd5 \u7531\u4e8e\u6211\u4eec\u5728\u6d4b\u8bd5\u8ba1\u5212\u7684receiver\u5b57\u6bb5\u91cc\u9762\u5b58\u50a8\u7684 \u90fd\u662f\u7528\u6237id \uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u6765\u6b21\u8f6c\u6362: \u6240\u4ee5\u6211\u4eec\u5728UserDao\u65b0\u589e\u8fd9\u6837\u4e00\u4e2a\u65b9\u6cd5 \u6709\u6ca1\u6709\u53d1\u73b0\u4e00\u4e2a\u95ee\u9898\uff0c\u5f53\u8fd9\u4e2auser\u4e0d\u56fa\u5b9a\uff08\u6d4b\u8bd5\u8ba1\u5212\u7684\u63a5\u6536\u4eba\u80af\u5b9a\u4e0d\u4f1a\u4e00\u76f4\u56fa\u5b9a\uff09\uff0c\u5982\u679c\u6211\u4eec\u7ed9\u4ed6\u5957\u4e0acache\u7684\u65b9\u6cd5\uff0c\u4e5f\u5c31\u662f\u8981\u7ed9\u4ed6\u4e00\u4e2a\u6b7bkey\uff0c\u90a3\u4e48\u5176\u4ed6\u6d4b\u8bd5\u8ba1\u5212 \u6267\u884c \u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u53d6\u5230\u6b7bkey\u7684\u6570\u636e\uff0c\u8fd9\u5c31\u4e0d\u5408\u7406\u4e86\uff01\uff01\uff01 \u6240\u4ee5\u6211\u4eec\u4e4b\u524d\u7f16\u5199\u7684cache\u9488\u5bf9\u56fa\u5b9a\u53c2\u6570\u7684\u597d\u4f7f\uff0c\u8fd9\u79cd\u53ef\u53d8\u53c2\u6570\uff08\u53c2\u6570\u53d8\u4e86\uff0c\u7ed3\u679c\u4e5f\u53d8\u4e86\uff09\u7684\u5c31\u4e0d\u597d\u4f7f\u4e86\uff0c\u56e0\u4e3a\u4f60\u7684key\u8981\u8ddf\u7740\u5b83\u8d70\u3002 \u8fd9\u5c31\u662f\u6211\u4e0a\u9762\u8bf4\u5230\u7684\u7f3a\u70b9 \ud83d\udcd2 \u7f16\u5199Email\u7c7b import yagmail from app.core.configuration import SystemConfiguration from app.core.msg.notification import Notification class Email (Notification) : @staticmethod def get_mail_client () : configuration = SystemConfiguration.get_config() data = configuration.get( \"email\" ) return yagmail.SMTP(user=data.get( \"sender\" ), password=data.get( \"password\" ), host=data.get( \"host\" )) @staticmethod def send_msg (subject, content, attachment=None, *receiver) : client = Email.get_mail_client() client.send(receiver, subject=subject, contents=content, attachments=attachment) \u5148\u4ece\u914d\u7f6e\u91cc\u9762\u62ff\u5230\u6570\u636e\uff0c\u63a5\u7740\u8c03\u7528 yagmail \u5e93\uff0c\u83b7\u53d6mail\u5ba2\u6237\u7aef\uff0c\u6700\u540e\u6839\u636e\u4f20\u5165\u7684\u4e3b\u9898\u3001\u90ae\u4ef6\u5185\u5bb9\u7b49\u4fe1\u606f\u53d1\u9001\u90ae\u4ef6\u3002 \ud83d\udcd2 \u8865\u5168\u6d4b\u8bd5\u8ba1\u5212\u901a\u77e5\u90e8\u5206 \u5148\u83b7\u53d6\u6d88\u606f\u7c7b\u578b\uff0c\u5982\u679c\u6709\u90ae\u4ef6\u7c7b\u578b\uff0c\u6211\u4eec\u5c31\u83b7\u53d6\u7528\u6237\u90ae\u7bb1\u3002\u7136\u540e\u8c03\u7528send_msg\u65b9\u6cd5\u3002 \u4f46\u8fd9\u8fb9\u6709\u4e2a\u5f88\u4e25\u91cd\u7684\u95ee\u9898\uff0c\u6211\u4eec\u53ea\u80fd\u62ff\u5230 \u6d4b\u8bd5\u8ba1\u5212 \u7684\u4fe1\u606f\uff0c\u6ca1\u6709\u62ff\u5230\u6d4b\u8bd5\u62a5\u544a\u7684\u8be6\u7ec6\u6570\u636e\u3002 \u8fd9\u6837\u62a5\u544a\u8fde\u5bf9\u9519\u90fd\u4e0d\u77e5\u9053\uff0c\u6211\u4eec\u5148\u5199\u6b7b\u4e00\u4e2a \u6807\u9898 \u548c\u5185\u5bb9\u3002 \u63a5\u7740\u8fd0\u884c\u6d4b\u8bd5\u8ba1\u5212\uff0c\u6700\u7ec8\u6548\u679c\u5c31\u5982\u540c\u6587\u7ae0\u5f00\u5934\u54af\u3002\u4e8e\u662f\u6211\u8d76\u7d27\u5220\u6389\u4e86\u8fd9\u4e2a\u8be5\u6b7b\u7684\u6d4b\u8bd5\u8ba1\u5212\u3002 \u6240\u4ee5\u540e\u9762\u6211\u4eec\u8fd8\u662f\u5f97 \u597d\u597d\u5b8c\u5584\u90ae\u4ef6\u7684\u5185\u5bb9\u5440 \uff0c\u8fd9\u5757\u5185\u5bb9\u5de5\u4f5c\u91cf\u6bd4\u8f83\u5927\uff0c\u6211\u4eec\u53ef\u80fd\u4e0d\u4f1a\u505a\u5230\u5b8c\u5584\uff0c\u80fd\u653e\u4e00\u4e2a\u6d4b\u8bd5\u7ed3\u679c+\u6d4b\u8bd5\u62a5\u544a\u94fe\u63a5\u53ef\u80fd\u662f\u6211\u4eec\u9700\u8981\u6ce8\u610f\u7684\u65b9\u5411\u3002 \u81f3\u4e8e\u4e0b\u4e00\u8282\u6211\u4eec\u6765\u597d\u597d\u7f8e\u5316\u4e00\u4e0b\u8fd9\u4e2a \u6d4b\u8bd5\u90ae\u4ef6 \uff0c\u656c\u8bf7\u671f\u5f85~","title":"86.\u53d1\u9001\u7b2c\u4e00\u5c01\u6d4b\u8bd5\u62a5\u544a\u90ae\u4ef6"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2887%29%20%E6%90%9E%E4%B8%AA%E7%B2%BE%E7%BE%8E%E7%9A%84%E9%82%AE%E4%BB%B6%E6%A8%A1%E6%9D%BF/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \ud83d\udcd2 \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u521d\u6b65\u53d1\u9001\u4e86\u6d4b\u8bd5\u90ae\u4ef6\uff0c\u7531\u4e8e\u5b9a\u65f6\u4efb\u52a1\u7684\u5b58\u5728\uff0c\u5bfc\u81f4\u6211\u7684\u90ae\u7bb1\u8fd8\u4e00\u76f4\u6709\u6536\u5230\u6bcf\u5929\u6d4b\u8bd5\u8ba1\u5212\u7684 \u6267\u884c\u8bb0\u5f55 \u3002 image.png \u4f46\u5b83\u603b\u5f52\u662f\u4e00\u4e2a\u534a\u6210\u54c1\uff0c\u53ea\u6709\u7a7a\u8361\u8361\u7684\u6587\u5b57\u4fe1\u606f\uff0c\u6240\u4ee5\u6211\u4eec\u8fd8\u662f\u5f97\u9002\u5f53\u5bf9\u4ed6\u7f8e\u5316\u4e00\u4e0b\u3002 \ud83d\udcd2 \u6210\u679c\u5c55\u793a \u529f\u592b\u4e0d\u8d1f\u6709\u5fc3\u4eba\uff0c\u5fd9\u788c\u4e861\u4e2a\u591a\u5c0f\u65f6\u7684 \u7c73\u5e08\u5085 \u7ec8\u4e8e\u641e\u51fa\u4e86\u50cf\u6837\u70b9\u7684\u90ae\u4ef6\u62a5\u544a: \u600e\u4e48\u6837\uff0c\u6548\u679c\u8fd8\u51d1\u5408\u5427 \u5f53\u7136\uff0c\u8fd9\u91cc\u53ea\u6709\u6837\u5f0f\u54c8\uff0c(\u56e0\u4e3a\u6570\u636e\u6211\u6682\u65f6\u662f\u5199\u6b7b\u7684)\u3002 \ud83d\udcd2 \u5f00\u59cb\u7814\u7a76\uff08\u5377\u738b\u6a21\u5f0f\uff09 \u5176\u5b9e\u6709\u65f6\u5019\u6211\u4e00\u76f4\u5728\u60f3\uff0c\u5982\u679c\u6ca1\u6709 antd \u548c element-ui \uff0c\u90a3\u6211\u5199\u7684\u4e1c\u897f\u8be5\u591a\u4e48 \u4e11\u964b \u3002 \u8fd9\u5176\u5b9e\u4e5f\u8bf4\u660e\u4e86\uff0c\u672c\u4eba\u524d\u7aef\u529f\u5e95\u771f\u7684\u662f\u592a\u4e0d\u624e\u5b9e\u4e86\uff0c\u4e5f\u53ea\u6709\u7528\u8fd9\u6837\u7684\u7ec4\u4ef6\u624d\u80fd \u62ef\u6551\u81ea\u5df1 \u4e86\u3002 \u597d\u4e86\uff0c\u8ba4\u6e05\u73b0\u5b9e\u4ee5\u540e\uff0c\u6211\u4e0d\u6253\u7b97\u81ea\u5df1\u624b\u64b8css\u6837\u5f0f\u4e86\u3002\u4e8e\u662f\u6211\u5f00\u59cb\u627e\u6709\u6ca1\u6709\u5565\u597d\u770b\u7684 \u90ae\u4ef6\u6a21\u677f \uff0c\u4f60\u522b\u8bf4\uff0c\u8fd8\u771f\u7ed9\u6211\u627e\u5230\u4e86\u3002 \u770b\u4e86\u4e00\u4e0b\uff0c\u662f \u67d0\u9e45\u4e91 \u7684\u90ae\u4ef6\u6a21\u677f\uff0c\u770b\u8d77\u6765\u8fd8\u662f\u5f88\u597d\u770b\u7684\u3002\u4f5c\u8005\u7ed9\u51fa\u4e86\u5bf9\u5e94\u7684\u6e90\u7801: emmm\uff0c\u6e90\u7801\u8d34\u4e86\u4ee5\u540e\u6548\u679c\u4e0d\u597d\uff0c\u6709\u9700\u8981\u7684\u53ef\u4ee5\u79c1\u4fe1\u6211\u3002 \u60f3\u8d77\u6765\u6211\u8fd8\u6ca1\u89e3\u91ca\u4e3a\u4ec0\u4e48\u8981\u624b\u64b8css\uff0c\u56e0\u4e3a\u5728\u90ae\u4ef6\u91cc\uff0c\u867d\u7136\u652f\u6301\u4f60\u4f7f\u7528 html \u4f5c\u4e3a\u6b63\u6587\uff0c\u4f46\u662f\u5b83\u6709\u4e00\u4e9b \u9650\u5236 \u3002 \u65e0\u6cd5\u4f7f\u7528js \u6240\u4ee5\u70b9\u51fb\u4e8b\u4ef6\u6211\u4eec\u7528\u94fe\u63a5\u6765\u5b8c\u6210 \u53ea\u5bf9\u884c\u5185\u6837\u5f0f\u80fd\u53cb\u597d\u652f\u6301 \u8fd92\u70b9\u5c31\u5f88\u8ba9\u4eba\u96be\u53d7\u4e86\uff0c\u6240\u4ee5\u6211\u8fd9\u8fb9\u5c31\u6253\u7b97\u501f\u9274\u4ed6\u4eba\u7684\u4ee3\u7801\uff0c\u5728\u4ed6\u4eec\u57fa\u7840\u4e0a \u4fee\u6539 \u3002 \ud83d\udcd2 \u63a5\u4e0b\u6765\u5e72\u561b \u62ff\u5230\u8fd9\u5757\u4ee3\u7801\u4ee5\u540e\uff0c\u9996\u5148\u6211\u60f3\u7684\u662f\u628a\u5b83\u6539\u6210jinja2\u7684\u6a21\u677f\u4ee3\u7801\uff0c\u9884\u7f6e\u5bf9\u5e94\u7684\u8bdd\u672f\uff0c\u5728\u9700\u8981\u52a8\u6001\u5c55\u793a\u7684\u5730\u65b9\u7528 \uff5b\uff5b\u53d8\u91cf\uff5d\uff5d \u8fdb\u884c\u66ff\u6362\u3002\u76f8\u4fe1\u5927\u5bb6\u5199\u8fc7\u65e7\u65f6\u4ee3\uff0c\u524d\u540e\u7aef\u4e00\u4f53web\u7cfb\u7edf\u7684\u65f6\u5019\u90fd\u7528\u8fc7template\uff0c\u4e5f\u5c31\u5bf9\u8fd9\u79cd\u65b9\u5f0f\uff08\u6a21\u677f\u5f15\u64ce\uff09\u5f88\u719f\u6089\u3002 \u6211\u4eec\u901a\u8fc7jinja2\u751f\u6210html\uff0c\u53d1\u9001html\u90ae\u4ef6\u5230\u5bf9\u5e94\u7684\u63a5\u6536\u4eba\u5c31\u597d\u4e86\u3002 \u4f46html\u91cc\u9762\u6837\u5f0f\u867d\u7136\u6b63\u5e38\uff0c\u5230\u4e86\u90ae\u4ef6\u53c8\u4f1a\u600e\u4e48\u6837\u5462\uff1f\u6211\u4eec\u8bd5\u8bd5\u770b \ud83d\udcd2 \u8c03\u6574\u6837\u5f0f \u5230\u8fd9\u4e2a\u5730\u6b65\u5c31\u5dee\u4e0d\u591a\u4e86 \u53ef\u4ee5\u770b\u5230\u91cc\u9762\u6709\u5f88\u591a\u53d8\u91cf\uff0c\u5230\u65f6\u5019\u90fd\u4f1a\u901a\u8fc7 jinja2 \u4f20\u9012\u8fdb\u53bb\u3002 \u7136\u540e\u6211\u4e3a\u4e86\u6d4b\u8bd5\u6548\u679c\uff0c\u5148\u5199\u6b7b\u4e86\u6570\u636e: \ud83d\udcd2 \u7528yagmail\u6d4b\u8bd5 \u7531\u4e8eyagmail\u5f88\u6613\u7528\uff0c\u6240\u4ee5\u6211\u4eec\u4e4b\u524d\u90fd\u662f\u7528\u5b83\u6765\u53d1\u9001\u90ae\u4ef6\u3002\u90a3\u4e48\u5b83\u53d1html\u90ae\u4ef6\u6548\u679c\u4f1a\u548b\u6837\u5462? \u8fd9\u662f\u771f\u5b9e\u7684\u6548\u679c\uff0c\u53ef\u4ee5\u770b\u5230\uff0c\u60e8\u4e0d\u5fcd\u7779 \u4f46\u8fd9\u600e\u4e48\u80fd\u6467\u6bc1\u6211\u7684\u6597\u5fd7\u5462\uff1f \u4e8e\u662f\u6211\u51b3\u5b9a\u8bd5\u8bd5\u6700\u539f\u59cb\u7684 smtplib \uff0c\u8bf4\u5b9e\u8bdd\uff0c\u73b0\u5728\u4e0d\u67e5\u8d44\u6599\u6211\u5b8c\u5168\u4e0d\u4f1a\u7528\u7684\u4e00\u4e2a\u5e93: \u53d1\u73b0\u6837\u5f0f\u6ca1\u95ee\u9898\uff0c\u4f46\u8981\u70b9\u51fb \u663e\u793a\u56fe\u7247 \u624d\u80fd\u5c55\u793a\u56fe\u7247\uff0c\u8fd9\u4e2a\u663e\u7136\u5728\u53ef\u4ee5\u63a5\u53d7\u7684\u8303\u56f4\uff0c\u56e0\u4e3a\u6211\u770b\u963f\u91cc\u4e91\u7684\u56fe\u7247\u4e5f\u88ab\u5c4f\u853d\u4e86\u3002zzz \u6240\u4ee5\u6211\u4eec\u8fd8\u662f\u91c7\u7528 smtplib \u6765\u53d1\u90ae\u4ef6\u5427~~~ \u6700\u540e\u9644\u4e0a\u7c97\u7565\u7248\u7684\u53d1\u90ae\u4ef6\u4ee3\u7801\uff0c\u5907\u4e2a\u4efd\u3002 import smtplib from email.mime.text import MIMEText from email.header import Header sender = 'xxx@126.com' password= \"\u5ba2\u6237\u7aeftoken\" receivers = [ 'xxxx@qq.com' ] # \u63a5\u6536\u90ae\u4ef6\uff0c\u53ef\u8bbe\u7f6e\u4e3a\u4f60\u7684QQ\u90ae\u7bb1\u6216\u8005\u5176\u4ed6\u90ae\u7bb1 mail_msg = \"\"\"html\u4ee3\u7801\"\"\" message = MIMEText(mail_msg, 'html' , 'utf-8' ) message[ 'From' ] = 'wuranxu1993@126.com' message[ 'To' ] = Header( \"\u6d4b\u8bd5\" , 'utf-8' ) subject = 'Python SMTP \u90ae\u4ef6\u6d4b\u8bd5' message[ 'Subject' ] = Header(subject, 'utf-8' ) try : smtp = smtplib.SMTP() smtp.connect( 'smtp.126.com' ) # \u6211\u4eec\u7528set_debuglevel(1)\u5c31\u53ef\u4ee5\u6253\u5370\u51fa\u548cSMTP\u670d\u52a1\u5668\u4ea4\u4e92\u7684\u6240\u6709\u4fe1\u606f\u3002 # smtp.set_debuglevel(1) smtp.login(sender, password) smtp.sendmail(sender, receivers, message.as_string()) except Exception as e: print(e) \u4e0b\u4e00\u8282\u54b1\u4eec\u76f4\u63a5\u5b8c\u6210 \u90ae\u4ef6\u901a\u77e5 \u8fd9\u5757\u5185\u5bb9\uff0c\u656c\u8bf7\u671f\u5f85\u3002","title":"87.\u641e\u4e2a\u7cbe\u7f8e\u7684\u90ae\u4ef6\u6a21\u677f"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2888%29%20%E5%BD%BB%E5%BA%95%E5%AE%8C%E6%88%90%E9%82%AE%E4%BB%B6%E9%80%9A%E7%9F%A5%E5%8A%9F%E8%83%BD/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \ud83d\udcd2 \u56de\u987e \u4e66\u63a5\u4e0a\u56de\uff0c\u6211\u4eec\u627e\u51c6\u4e86\u4e00\u6b3e \u770b\u4f3c\u4e0d\u9519 \u7684\u90ae\u4ef6\u6a21\u677f\uff0c\u4f46\u7531\u4e8e\u6570\u636e\u90fd\u662f\u6b7b\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u83b7\u53d6\u6d4b\u8bd5\u62a5\u544a\u4ea7\u751f\u7684\u6570\u636e\uff0c\u5e76\u6e32\u67d3 HTML\u6a21\u677f \u3002 \u8fd9\u8282\u6211\u4eec\u5c31\u6765\u5f7b\u5f7b\u5e95\u5e95\u5b8c\u5584\u8fd9\u5757\u529f\u80fd\u3002 \ud83d\udcd2 \u6548\u679c\u56fe \u8fd9\u6b21\u6570\u636e\u5df2\u7ecf\u771f\u5b9e\uff0c\u800c\u4e14\u6709\u5b9a\u65f6\u4efb\u52a1\u76f4\u63a5\u8dd1\u4e86\u53d1\u9001\u51fa\u6765\uff0c \u76f8\u5f53\u9760\u8c31 \uff01 \ud83d\udcd2 \u7f16\u5199\u90ae\u4ef6\u6a21\u5757 \u7531\u4e8e\u4e4b\u524dyagmail\u4e0d\u662f\u592a\u597d\u7528\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u6539\u5199 send_msg \u65b9\u6cd5\uff0c\u7531\u4e8e\u6bd4\u8f83\u7b80\u5355\uff0c\u6211\u5c31\u76f4\u63a5\u4e0a\u4ee3\u7801\u4e86\u3002 \u4e0d\u8fc7\u5728\u6b64\u4e4b\u524d\u5462\uff0c\u6211\u4eec\u9700\u8981\u5148\u53bb\u914d\u7f6e\u6587\u4ef6\u91cc\u9762\u52a0\u4e0a\u4e00\u4e2a\u5b57\u6bb5: \u5176\u5b9esmtplib\u63d0\u4f9b\u4e86From\u7684\u9009\u9879\uff0c\u6211\u672c\u6765\u60f3\u53eb Pity\u81ea\u52a8\u5316\u6d4b\u8bd5\u5e73\u53f0 \uff0c\u4f46\u662f\u90a3\u6837\u7684\u8bdd\u90ae\u4ef6\u6b7b\u6d3b\u53d1\u4e0d\u51fa\u53bb\uff0c\u9042\u653e\u5f03\u3002 @staticmethod def send_msg (subject, content, attachment=None, *receiver) : configuration = SystemConfiguration.get_config() data = configuration.get( \"email\" ) sender = data.get( \"sender\" ) to = data.get( \"to\" ) message = MIMEText(content, 'html' , 'utf-8' ) message[ 'From' ] = sender message[ 'To' ] = Header(to, 'utf-8' ) message[ 'Subject' ] = Header(subject, 'utf-8' ) try : smtp = smtplib.SMTP() smtp.connect(data.get( \"host\" )) # \u6211\u4eec\u7528set_debuglevel(1)\u5c31\u53ef\u4ee5\u6253\u5370\u51fa\u548cSMTP\u670d\u52a1\u5668\u4ea4\u4e92\u7684\u6240\u6709\u4fe1\u606f\u3002 smtp.set_debuglevel( 1 ) smtp.login(sender, data.get( \"password\" )) smtp.sendmail(sender, list(receiver), message.as_string()) except Exception as e: raise Exception( f\"\u53d1\u9001\u6d4b\u8bd5\u62a5\u544a\u90ae\u4ef6\u5931\u8d25: {e} \" ) \u65b0\u7684send_msg\u65b9\u6cd5\u5f88\u7b80\u5355\uff0c\u5728\u4fdd\u6301\u53c2\u6570\u4e00\u81f4\u7684\u60c5\u51b5\u4e0b\uff0c\u4ee3\u7801\u91cf\u6bd4yagmail\u591a\u4e86\u5f88\u591a\u3002 \u5927\u6982\u601d\u8def\u5c31\u662f\u5148\u5c01\u88c5MIMETEXT\uff0c\u5e76\u8bbe\u7f6e\u4e3ahtml\u6a21\u5f0f\uff0c\u63a5\u7740\u628a \u6536\u4ef6\u4eba \u3001 \u53d1\u4ef6\u4eba \u3001 \u4e3b\u9898 \u4ee5\u53ca \u5185\u5bb9 \u7b49\u6570\u636e\u90fd\u653e\u5165\u5176\u4e2d\uff0c\u6700\u540e\u901a\u8fc7sendmail\u53d1\u9001\u90ae\u4ef6\u3002 \ud83d\udcd2 \u6539\u9020run_test_plan\u65b9\u6cd5 \u6dfb\u52a0\u6267\u884c\u4eba\u53c2\u6570 \u76ee\u524d\u6211\u4eec\u7684\u6d4b\u8bd5\u8ba1\u5212\u8fd8\u4e0d\u652f\u6301 \u624b\u52a8\u6267\u884c \uff0c\u4e00\u65b9\u9762\u4e3a\u4e86\u9002\u914d\u624b\u52a8\u6267\u884c\uff0c\u4e00\u65b9\u9762\u4e3a\u4e86\u5728\u90ae\u4ef6\u4f53\u73b0\u6267\u884c\u4eba\u4fe1\u606f\uff0c\u6240\u4ee5\u6211\u4eec\u5728run_test_plan\u52a0\u4e0a\u6267\u884c\u4eba\u8fd9\u4e2a\u53c2\u6570: \u6267\u884c\u4eba\u9ed8\u8ba4\u662f0\uff0c\u4e5f\u5c31\u662fCPU\uff08\u5c0f\u65f6\u5019\u6253\u5c0f\u9738\u738b\u7684\u65f6\u5019\u7684\u611f\u89c9\uff09 \u6539\u5199run_multiple\u65b9\u6cd5 run_multiple\u8fd9\u4e2a\u65b9\u6cd5\u662f\u6211\u4eec\u6d4b\u8bd5\u8ba1\u5212\u6267\u884c\u7684\u6838\u5fc3\u65b9\u6cd5\uff0c\u7531\u4e8e\u6211\u4eec\u6d4b\u8bd5\u8ba1\u5212\u662f\u652f\u6301 \u591a\u73af\u5883 \u7684\uff0c\u5e76\u4e14\u4e00\u4e2a\u6d4b\u8bd5\u73af\u5883\u5bf9\u5e94\u4e00\u4efd\u6d4b\u8bd5\u62a5\u544a\u3002 \u6211\u4eec\u5728\u6267\u884c\u5b8c\u4e00\u4e2a\u6d4b\u8bd5\u8ba1\u5212\u53ef\u80fd\u51fa\u73b0\u591a\u4e2a\u62a5\u544a\u94fe\u63a5\uff0c\u6bcf\u4e2a\u73af\u5883\u4e5f\u6709\u81ea\u5df1\u7684\u901a\u8fc7\u7387\u8fd9\u4e9b\u6570\u636e\u3002 \u6240\u4ee5\u6211\u4eec\u9700\u8981\u8bb0\u5f55\u4e00\u4e2amap\uff0c\u91cc\u9762\u5b58\u653eenv => \u6d4b\u8bd5\u7ed3\u679c\u7684\u6620\u5c04\uff0c\u6700\u7ec8\u8fd4\u56de\u3002 \u7531\u4e8e\u6211\u4eec\u662f\u5f02\u6b65\u6267\u884c\uff0c\u6240\u4ee5\u6211\u4eec\u5728\u5916\u90e8\u8bbe\u5b9a\u4e00\u4e2amap\uff0c\u5f53\u505a\u53c2\u6570\u4f20\u9012\u8fdb\u53bb\uff0c\u7531\u4e8e \u5f15\u7528\u4f20\u9012 \u7684\u539f\u7406\uff0c\u51fd\u6570\u6267\u884c\u5b8c\u6bd5\uff0c\u6211\u4eec\u7684map\u4e5f\u66f4\u65b0\u597d\u4e86\u3002 \u987a\u7406\u6210\u7ae0\u7684\uff0crun_multiple\u65b9\u6cd5\u91cc\u9762\u4e5f\u9700\u8981\u6539\u9020\uff0c\u5b83\u5e94\u8be5\u63a5\u6536\u65b0\u7684map\u53c2\u6570\uff0c\u4f46\u4e3a\u4e86\u4e0d\u5f71\u54cd\u539f\u5148\u7684\u529f\u80fd\uff0c\u6240\u4ee5\u5b83\u53ef\u4f20\u53ef\u4e0d\u4f20\u3002 \u4e0b\u9762\u662f\u83b7\u53d6\u6267\u884c\u4eba\u59d3\u540d\u7684\u64cd\u4f5c: \u63a5\u7740\u662frun_multiple\u5728\u8fd4\u56de\u4e4b\u524d\u7684\u6539\u9020: \ud83d\udcd2 \u751f\u6210\u771f\u5b9ehtml \u4e0a\u8ff0\u64cd\u4f5c\u90fd\u662f\u4e3a\u4e86 \u83b7\u53d6\u6d4b\u8bd5\u62a5\u544a\u9700\u8981\u7684\u6570\u636e \uff0c\u83b7\u53d6\u4e86\u4e4b\u540e\u6211\u4eec\u8fd8\u5f97\u5229\u7528 jinja2 \u6e32\u67d3html\u3002 \u8fd9\u91cc\u6211\u653e\u4e0a\u539f\u751fhtml: <!DOCTYPE html > < html > < head > < title > \u6d4b\u8bd5\u62a5\u544a </ title > </ head > < body > < div > < includetail > < div align = \"center\" > < div class = \"open_email\" style = \"margin-left: 8px; margin-top: 8px; margin-bottom: 8px; margin-right: 8px;\" > < div > < br > < span class = \"genEmailContent\" > < div id = \"cTMail-Wrap\" style = \"word-break: break-all;box-sizing:border-box;text-align:center;min-width:320px; max-width:660px; border:1px solid #f6f6f6; background-color:#f7f8fa; margin:auto; padding:20px 0 30px; font-family:'helvetica neue',PingFangSC-Light,arial,'hiragino sans gb','microsoft yahei ui','microsoft yahei',simsun,sans-serif\" > < div class = \"main-content\" style = \"\" > < table style = \"width:100%;font-weight:300;margin-bottom:10px;border-collapse:collapse\" > < tbody > < tr style = \"font-weight:300\" > < td style = \"width:3%;max-width:30px;\" > </ td > < td style = \"max-width:600px;\" > < div id = \"cTMail-logo\" style = \"width:92px; height:25px;\" > < a href = \"\" > < img border = \"0\" src = \"https://static.pity.fun/picture/2021-11-24/1637761462006-image.png\" style = \"width:36px; height:36px;display:block\" > </ a > </ div > < p style = \"height:2px;background-color: #00a4ff;border: 0;font-size:0;padding:0;width:100%;margin-top:20px;\" > </ p > < div id = \"cTMail-inner\" style = \"background-color:#fff; padding:23px 0 20px;box-shadow: 0px 1px 1px 0px rgba(122, 55, 55, 0.2);text-align:left;\" > < table style = \"width:100%;font-weight:300;margin-bottom:10px;border-collapse:collapse;text-align:left;\" > < tbody > < tr style = \"font-weight:300\" > < td style = \"width:3.2%;max-width:30px;\" > </ td > < td style = \"max-width:480px;text-align:left;\" > < h1 id = \"cTMail-title\" style = \"font-size: 20px; line-height: 36px; margin: 0px 0px 22px;\" > \u3010 < strong > {{ env }} </ strong > \u3011\u6d4b\u8bd5\u8ba1\u5212 \u3010 < strong > {{ plan_name }} </ strong > \u3011\u6267\u884c\u7ed3\u679c: < strong > {{plan_result}} </ strong > </ h1 > < p id = \"cTMail-userName\" style = \"font-size:14px;color:#333; line-height:24px; margin:0;\" > \u5c0a\u656c\u7684pity\u7528\u6237\uff0c\u60a8\u597d\uff01 </ p > < p class = \"cTMail-content\" style = \"line-height: 24px; margin: 6px 0px 0px; overflow-wrap: break-word; word-break: break-all;\" > < span style = \"color: rgb(51, 51, 51); font-size: 14px;\" > \u672c\u6b21\u6d4b\u8bd5\u8ba1\u5212\u5171\u6267\u884c\u7528\u4f8b < strong > {{ total }} </ strong > \u6761\u3002 </ span > </ p > < p class = \"cTMail-content\" style = \"line-height: 24px; margin: 6px 0px 0px; overflow-wrap: break-word; word-break: break-all;\" > < span style = \"color: rgb(51, 51, 51); font-size: 14px;\" > \u7531 < strong > {{ executor }} </ strong > \u4e8e{{ start_time }}\u5f00\u59cb\u6267\u884c\uff0c\u5171\u8017\u65f6{{cost}}\u79d2\u3002 </ span > </ p > < p class = \"cTMail-content\" style = \"line-height: 24px; margin: 6px 0px 0px; overflow-wrap: break-word; word-break: break-all;\" > < span style = \"color: rgb(51, 51, 51); font-size: 14px;\" > \u6210\u529f\u6570\u91cf < strong style = \"color: #67C23A\" > {{ success }} </ strong > </ span > </ p > < p class = \"cTMail-content\" style = \"line-height: 24px; margin: 6px 0px 0px; overflow-wrap: break-word; word-break: break-all;\" > < span style = \"color: rgb(51, 51, 51); font-size: 14px;\" > \u5931\u8d25\u6570\u91cf < strong style = \"color: #F56C6C\" > {{ failed }} </ strong > </ span > </ p > < p class = \"cTMail-content\" style = \"line-height: 24px; margin: 6px 0px 0px; overflow-wrap: break-word; word-break: break-all;\" > < span style = \"color: rgb(51, 51, 51); font-size: 14px;\" > \u51fa\u9519\u6570\u91cf < strong style = \"color: #E6A23C\" > {{ error }} </ strong > </ span > </ p > < p class = \"cTMail-content\" style = \"line-height: 24px; margin: 6px 0px 0px; overflow-wrap: break-word; word-break: break-all;\" > < span style = \"color: rgb(51, 51, 51); font-size: 14px;\" > \u8df3\u8fc7\u6570\u91cf < strong style = \"color: #409EFF\" > {{ skip }} </ strong > </ span > </ p > < p class = \"cTMail-content\" style = \"line-height: 24px; margin: 6px 0px 0px; overflow-wrap: break-word; word-break: break-all;\" > < span style = \"color: rgb(51, 51, 51); font-size: 14px;\" > \u67e5\u770b\u8be6\u7ec6\u6d4b\u8bd5\u62a5\u544a\uff0c\u53ef\u70b9\u51fb\u4e0b\u65b9\u94fe\u63a5\u3002 < span style = \"font-weight: bold;\" > \u5982\u6709\u6253\u6270\uff0c\u8bf7\u60a8\u8c05\u89e3\u3002 </ span > </ span > </ p > < p class = \"cTMail-content\" style = \"font-size: 14px; color: rgb(51, 51, 51); line-height: 24px; margin: 6px 0px 0px; word-wrap: break-word; word-break: break-all;\" > < a id = \"cTMail-btn\" href = \"{{report_url}}\" title = \"\" style = \"font-size: 16px; line-height: 45px; display: block; background-color: rgb(0, 164, 255); color: rgb(255, 255, 255); text-align: center; text-decoration: none; margin-top: 20px; border-radius: 3px;\" > \u70b9\u51fb\u6b64\u5904\u67e5\u770b\u5b8c\u6574\u62a5\u544a </ a > </ p > < p class = \"cTMail-content\" style = \"line-height: 24px; margin: 6px 0px 0px; overflow-wrap: break-word; word-break: break-all;\" > < span style = \"color: rgb(51, 51, 51); font-size: 14px;\" > < br > \u65e0\u6cd5\u6b63\u5e38\u663e\u793a\uff1f\u8bf7\u590d\u5236\u4ee5\u4e0b\u94fe\u63a5\u81f3\u6d4f\u89c8\u5668\u6253\u5f00\uff1a < br > < a href = \"{{report_url}}\" title = \"\" style = \"color: rgb(0, 164, 255); text-decoration: none; word-break: break-all; overflow-wrap: normal; font-size: 14px;\" > \u8fd9\u91cc\u662f\u6d4b\u8bd5\u62a5\u544a\u94fe\u63a5 </ a > </ span > </ p > </ td > < td style = \"width:3.2%;max-width:30px;\" > </ td > </ tr > </ tbody > </ table > </ div > < div id = \"cTMail-copy\" style = \"text-align:center; font-size:12px; line-height:18px; color:#999\" > < table style = \"width:100%;font-weight:300;margin-bottom:10px;border-collapse:collapse\" > < tbody > < tr style = \"font-weight:300\" > < td style = \"width:3.2%;max-width:30px;\" > </ td > < td style = \"max-width:540px;\" > < p style = \"text-align:center; margin:20px auto 14px auto;font-size:12px;color:#999;\" > \u6b64\u90ae\u4ef6\u7531pity\u81ea\u52a8\u53d1\u51fa\uff0c\u8bf7\u52ff\u56de\u590d\u3002 </ p > < p id = \"cTMail-rights\" style = \"max-width: 100%; margin:auto;font-size:12px;color:#999;text-align:center;line-height:22px;\" > < img border = \"0\" src = \"https://static.pity.fun/picture/2021-8-7/1628267097936-qrcode_for_gh_554fe7a74955_258.jpg\" style = \"width:84px; height:84px; margin:0 auto;\" > < br > \u5173\u6ce8\u6d4b\u8bd5\u5f00\u53d1\u5751\u8d27\uff0c\u4e86\u89e3pity\u66f4\u591a\u5185\u5bb9 < br > </ p > </ td > < td style = \"width:3.2%;max-width:30px;\" > </ td > </ tr > </ tbody > </ table > </ div > </ td > < td style = \"width:3%;max-width:30px;\" > </ td > </ tr > </ tbody > </ table > </ div > </ div > </ span > </ div > </ div > </ div > </ includetail > </ div > </ body > </ html > \u4e0a\u8ff0\u4ee3\u7801\u5728 pity/templates/report.html \u6587\u4ef6\u5185\u3002 \u63a5\u7740\u7f16\u5199\u6e32\u67d3html\u7684\u65b9\u6cd5: \u5176\u4e2dkwargs\u662f\u4f20\u9012\u5bf9\u5e94\u7684\u53c2\u6570\u7ed9html\u3002 \u4e4b\u524d\u4e5f\u8bf4\u8fc7\u4e00\u4e2a\u90ae\u4ef6\u5bf9\u5e94\u4e00\u4e2a\u5730\u5740\uff0c\u6240\u4ee5send_msg\u8c03\u7528\u7684\u5730\u65b9\u4e5f\u5f97\u8ddf\u7740\u4fee\u6539\u3002 \u8fd9\u6837\u5c31\u662f\u4e00\u4e2a\u73af\u5883\u5bf9\u5e94\u4e00\u5c01\u90ae\u4ef6 \u81f3\u6b64\uff0c\u6211\u4eec\u7684\u90ae\u4ef6\u63a8\u9001\u529f\u80fd\u5c31\u5168\u90e8\u5b8c\u6210\u4e86\u3002 \u94fe\u63a5\u80fd\u6b63\u5e38\u70b9\u51fb\uff0c\u8fd8\u8981\u5565\u81ea\u884c\u8f66 \u4eca\u5929\u7684\u5185\u5bb9\u5c31\u5230\u8fd9\u91cc\u4e86\uff0c\u54b1\u4eec\u4e0b\u671f\u89c1\u3002","title":"88.\u5f7b\u5e95\u5b8c\u6210\u90ae\u4ef6\u901a\u77e5\u529f\u80fd"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2889%29%20%E7%BC%96%E5%86%99%E6%89%A7%E8%A1%8C%E6%B5%8B%E8%AF%95%E8%AE%A1%E5%88%92%E5%8A%9F%E8%83%BD/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \ud83d\udcd2 \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u628a\u90ae\u4ef6\u90a3\u5757\u7684\u901a\u77e5\u505a\u597d\u4e86\uff0c\u7b97\u662f\u5230\u4e86 \u5206\u6c34\u5cad \u3002\u76ee\u524d\u6765\u770b\u7684\u8bdd\uff0c\u6211\u4eec\u7684\u4efb\u52a1\u4ece \u65b0\u589e \u5230 \u6784\u5efa \u5230 \u901a\u77e5 \uff0c\u5df2\u7ecf\u6709\u4e86\u4e00\u4e2a \u76f8\u5bf9 \u5b8c\u5584\u7684\u7ed3\u5c40\u3002 \ud83d\udcd2 \u65b0\u7684\u5f81\u7a0b \u8003\u8651\u5230\u660e\u5e74\u53ef\u80fd\u8981\u5f53\u5976\u7238\u4e86\uff0c\u63a5\u4e0b\u6765\u4e5f\u6ca1\u5f88\u591a\u7a7a\u95f2\u65f6\u95f4\u6765\u5377\u4e86\u3002 \u6240\u4ee5\u5728\u6b64\u4e4b\u524d\uff0c\u6253\u7b97\u5148\u7acb\u4e9b\u529f\u80fd\u9879\uff0c\u6309\u7167\u559c\u597d\u5728\u8fd9\u51e0\u4e2a\u6708\u5185 \u6162\u6162\u5b9e\u73b0 \u3002 \u7528\u4f8b\u64cd\u4f5c\u65e5\u5fd7\u529f\u80fd \u2b50\u2b50\u2b50\u2b50 \u4e3b\u8981\u8bb0\u5f55\u7528\u4f8b\u76f8\u5173\u53d8\u52a8\uff0c\u5305\u62ec\u65b0\u589e\u3001\u66f4\u65b0\u3001\u5220\u9664\u7b49\u8bb0\u5f55\u3002 \u5b8c\u5584\u540e\u7f6e\u6761\u4ef6 \u2b50\u2b50\u2b50\u2b50\u2b50 \u540e\u7f6e\u6761\u4ef6\u6211\u4eec\u8fd8\u6ca1\u6709\u505a\u5462\uff0c\u8fd9\u5757\u662f\u4e2a\u6bd4\u8f83\u91cd\u8981\u7684\u95ee\u9898\u3002 \u91cd\u6784\u7528\u4f8b\u65b0\u589e/\u7f16\u5199\u9875\u9762 \u2b50\u2b50\u2b50 \u6253\u901ahttprunner \u2b50\u2b50\u2b50\u2b50 \u8fd9\u91cc\u7684\u6253\u901a\u662f\u53ef\u4ee5\u5bfc\u5165httprunner\u7684yaml\u6570\u636e\uff0c\u5bfc\u51fa\u7684\u8bdd\u6682\u5b9a \u652f\u6301\u7f16\u5199python\u811a\u672c\u4f5c\u4e3a\u524d\u7f6e\u6761\u4ef6 \u2b50\u2b50\u2b50\u2b50\u2b50 \u5b8c\u6210\u6570\u636e\u5de5\u5382\u529f\u80fd \u2b50\u2b50\u2b50\u2b50 \u7edf\u8ba1\u9875 \u2b50\u2b50\u2b50\u2b50 \u8fd9\u5757\u529f\u80fd\u8fd8\u662f\u6bd4\u8f83\u91cd\u8981\u7684\uff0c\u7528\u4f8b\u7684 \u6570\u636e \uff0c\u6267\u884c\u7684\u6570\u636e\uff0c\u81ea\u52a8\u5316\u7387\u7b49\u7b49\u3002 \u5de5\u4f5c\u53f0 \u2b50\u2b50\u2b50 \u5de5\u4f5c\u53f0\u505a\u7684\u597d\u7684\u8bdd\uff0c\u53ef\u4ee5\u5feb\u901f\u5b8c\u6210\u5f88\u591a\u4e8b\u60c5\u3002 \u8ddfyapi\u6253\u901a \u2b50\u2b50\u2b50\u2b50\u2b50 \u4f5c\u4e3a\u4e00\u4e2a\u63a5\u53e3\u81ea\u52a8\u5316\u6d4b\u8bd5\u5e73\u53f0\uff0c\u5e72\u5565\u90fd\u4e0d\u80fd\u8131\u79bb\u63a5\u53e3\u3002\u4e00\u822c\u7684\u516c\u53f8\u90fd\u6709\u7528\u5230yapi\uff0c\u5982\u679c\u6ca1\u6709\u7684\u8bdd\uff0crap2\u6216\u8005swagger\u6587\u4ef6\u90fd\u9700\u8981\u8fdb\u884c\u652f\u6301\u3002 \u7528\u4f8b\u8bc4\u4ef7\u7cfb\u7edf \u2b50\u2b50\u2b50\u2b50 \u4e3a\u4e86\u63d0\u9ad8\u7528\u4f8b\u7684\u7f16\u5199\u8d28\u91cf\uff0c\u9700\u8981\u8fd9\u5957\u7cfb\u7edf\u3002 oss\u7cfb\u7edf \u2b50\u2b50\u2b50\u2b50 \u9700\u8981\u652f\u6301\u4e3b\u6d41\u7684\u963f\u91cc\u4e91sdk\uff0c\u4e03\u725b\u4e91sdk\uff0c\u817e\u8baf\u4e91sdk\u3002\u76ee\u7684\u662f\u80fd\u591f\u652f\u6301\u6587\u4ef6\u4e0a\u4f20\u7c7b\u578b\u7684case\u3002 \u5176\u4ed6\u901a\u4fe1\u534f\u8bae\u63a5\u53e3\u6d4b\u8bd5grpc\u3001dubbo\u7b49\u2b50\u2b50\u2b50\u2b50 \u8fd9\u4e2a\u4e5f\u5f88\u91cd\u8981\uff0c\u5982\u679c\u53ea\u652f\u6301http\uff0c\u76f8\u5bf9\u6bd4\u8f83\u9e21\u808b\u3002 \u7528\u6237\u7ba1\u7406\u529f\u80fd \u2b50\u2b50\u2b50\u2b50 \u5176\u5b9e\u6bd4\u8f83\u9e21\u808b\uff0c\u53ef\u4ee5\u505a\u7b80\u5355\u70b9\uff0c\u53ef\u4ee5 \u7981\u7528\u7528\u6237 \u8fd9\u6837\u7684\u5c31\u53ef\u4ee5\u4e86\u3002\u56e0\u4e3a\u516c\u53f8\u4e00\u822c\u90fd\u662f\u5185\u7f51\u7cfb\u7edf\uff0c\u5982\u679c\u79bb\u804c\u4e86\u4eba\u4e5f\u767b\u5f55\u4e0d\u8fdb\u6765\u4e86\u3002 \u6253\u901aCI \u7531\u4e8e\u5404\u4e2a\u516c\u53f8\u7684\u53d1\u5e03\u7cfb\u7edf\u6784\u6210\u90fd\u4e0d\u4e00\u6837\uff0c\u5982\u679c\u6709\u8fd9\u65b9\u9762\u9700\u6c42\uff0c\u6211\u4eec\u53ef\u4ee5\u63d0\u4f9bopenapi\u51fa\u53bb\uff0c\u8ba9\u4ed6\u4eec\u53ef\u4ee5\u6839\u636e app_id \u6216\u8005 git\u5730\u5740 \u6765\u6267\u884c\u6211\u4eec\u5236\u5b9a\u7684case\u3002 \u5728\u7ebf\u6267\u884c\u6d4b\u8bd5\u8ba1\u5212 \u2b50\u2b50\u2b50\u2b50\u2b50 \u5728\u7ebf\u8c03\u8bd5\u7528\u4f8b \u2b50\u2b50\u2b50\u2b50\u2b50 \u7528\u6237\u4e2a\u4eba\u8d44\u6599\u8bbe\u7f6e \u2b50\u2b50 \u4ee5\u4e0a\u8fd8\u53ea\u662f \u90e8\u5206\u5185\u5bb9 \uff0c\u8981\u505a\u5b8c\u5584\u8fd8\u662f\u9700\u8981 \u82b1\u8d39\u4e00\u4e9b\u65f6\u95f4 \u3002\u4f46\u597d\u5728\u8fd8\u6709\u5f88\u957f\u65f6\u95f4\uff0c\u6211\u4eec \u6162\u6162\u5b8c\u5584 \u5427\u3002 \ud83d\udcd2 \u6267\u884c\u6d4b\u8bd5\u8ba1\u5212 \u5148\u770b\u770b\u539f\u5148\u7684 \u6267\u884c\u6d4b\u8bd5\u8ba1\u5212 \u529f\u80fd: \u53ef\u4ee5\u770b\u5230\u6838\u5fc3\u65b9\u6cd5\u5df2\u7ecf\u6709\u4e86\uff0c\u6211\u4eec\u53ea\u9700\u8981\u4e3a\u4e4b\u7f16\u5199\u63a5\u53e3\u5373\u53ef\u3002 @router.get( \"/plan/execute\" ) async def run_test_plan ( id : int , user_info=Depends( Permission( Config.MEMBER ) ) ): try : await Executor.run_test_plan( id , user_info[ 'id' ]) return PityResponse.success() except Exception as e: return PityResponse.failed( str (e)) \u5728app/routers/testcase/testplan.py\u52a0\u4e0a\u5982\u4e0a\u65b9\u6cd5\uff0c\u6ce8\u610f\u8fd9\u91cc\u6743\u9650\u6211\u4eec\u7a0d\u4f5c\u4e86\u4e00\u4e9b\u66ff\u6362: GUEST\u6362\u6210\u4e86MEMBER\uff0c\u8bed\u4e49\u4e0a\u66f4\u4e3a \u8d34\u5207 \u3002 \ud83d\udcd2 \u4fee\u6539\u524d\u7aef \u6211\u4eec\u5728\u8fd9\u4e2d\u95f4\u8981\u52a0\u4e00\u4e2a \u6267\u884c \u6309\u94ae\uff0c\u5e76\u4e14\u6267\u884c\u5b8c\u6bd5\u540e\u5f39\u51fa\u5bf9\u8bdd\u6846\u95ee\u5bf9\u65b9\u9700\u4e0d\u9700\u8981\u8df3\u8f6c\u5230 \u62a5\u544a\u94fe\u63a5 \u3002 src/pages/ApiTest/TestPlan.jsx\u65b0\u589eonExecute\u65b9\u6cd5 \u6d4b\u8bd5\u62a5\u544a\u6267\u884c\u5b8c\u6210\u540e\uff0c\u662f\u5426\u8df3\u8f6c\u5230\u62a5\u544a\u9875\u9762\u3002 Table\u64cd\u4f5c\u5b57\u6bb5\u65b0\u589e \u8fd0\u884c \u6309\u94ae src/models/testplan.js\u65b0\u589eexecuteTestPlan\u65b9\u6cd5 src/services/testplan.js\u65b0\u589eexecuteTestPlan\u65b9\u6cd5 \ud83d\udcd2 \u770b\u770b\u6548\u679c \u6267\u884c\u4e0b\uff0c\u7136\u540e\u7b49\u5f85\u540e\u8df3\u8f6c\u5230 \u62a5\u544a\u94fe\u63a5 \u3002 \u53ef\u4ee5\u770b\u5230\u90ae\u4ef6\u91cc\u7684\u6267\u884c\u4eba\u4e5f\u8fdb\u884c\u4e86 \u4fee\u6539 \u3002 \ud83d\udcd2 \u4fee\u6539\u62a5\u544a\u9875\u9762 \u62a5\u544a\u9875\u9762\u76ee\u524d\u662f\u6ca1\u6709 \u6d4b\u8bd5\u8ba1\u5212 \u6807\u8bc6\u7684\uff0c\u6211\u4eec\u9700\u8981\u7ed9\u5b83\u6765\u4e2a\u63d0\u793a\u3002 \u9875\u9762\u6709\u70b9\u4e0d\u591f\u653e\uff0c\u6211\u4eec\u4fee\u6539\u4e0b Table\u7ec4\u4ef6 \u3002 \u7531\u4e8e\u672c\u8eab\u6709mode\u5c5e\u6027\uff0c\u6240\u4ee5\u6211\u4eec\u6839\u636e\u8fd9\u4e2a\u6765\u5224\u65ad\u7c7b\u578b\u5c31\u597d\uff0c\u5176\u5b9e\u8fd9\u4e2a\u6709\u4e2a\u7f3a\u70b9\uff0c\u867d\u7136\u662f\u6d4b\u8bd5\u8ba1\u5212\uff0c\u4f46\u662f \u6ca1\u663e\u793a\u6d4b\u8bd5\u8ba1\u5212\u7684\u540d\u79f0 \u3002 \u90a3\u8fd9\u4e2a\u95ee\u9898\u5c31\u7559\u5230\u4e0b\u4e00\u8282\u89e3\u51b3\u4e86~ \u4e0b\u4e00\u8282\u6211\u4eec\u7f16\u5199\u963f\u91cc\u4e91sdk\u548c\u4e03\u725b\u4e91sdk\uff0c\u5b8c\u6210oss crud\u529f\u80fd\u3002","title":"89.\u7f16\u5199\u6267\u884c\u6d4b\u8bd5\u8ba1\u5212\u529f\u80fd"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%289%29%20%E4%B8%8E%E5%89%8D%E7%AB%AF%E8%81%94%E8%B0%83%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%8E%A5%E5%8F%A3%28part%202%29/","text":"\u4e0e\u524d\u7aef\u8054\u8c03\u6ce8\u518c/\u767b\u5f55\u63a5\u53e3(part 2) \u56de\u987e \u4e0a\u7bc7\u6211\u4eec\u8bf4\u5565\u6765\u7740\uff0c\u5662\u5bf9\u8bf4\u8981\u8ddf \u524d\u7aef\u8054\u8c03 \u6765\u7740\u3002\u8fd9\u671f\u5462\uff0c\u54b1\u4eec\u5c31\u5f00\u59cb\u7740\u624b\u5199\u8fd9\u5757\u5185\u5bb9\u3002 \u8fd9\u91cc\u5982\u679c\u524d\u7aef\u4e0d\u592a\u64c5\u957f\u7684\u5462\uff0c\u4ee3\u7801\u4f60\u5c31\u522b\u4ed4\u7ec6\u770b\u4e86\uff0c\u56e0\u4e3a\u4f60\u80af\u5b9a\u4e5f\u4e0d\u592a\u7406\u89e3(\u867d\u7136\u6211\u8fd8\u662f\u4f1a\u8bb2\u8bb2)\u3002 \u4f60\u53ea\u9700\u8981\u642c\u4e2a\u5c0f\u677f\u51f3\uff0c\u770b\u770b\u5177\u4f53\u89e3\u51b3\u4e86\u54ea\u4e9b\u95ee\u9898\u5c31\u884c\uff0c\u4e0d\u9700\u8981\u60f3\u7740\u600e\u4e48\u53bb\u5199\u524d\u7aef\u4ee3\u7801\uff0c\u76f4\u63a5copy\u4e00\u4e0b\u5c31\u5b8c\u4e8b\u4e86\uff01\uff08\u597d\u5bb6\u4f19\uff0c\u6211\u76f4\u547c\u597d\u5bb6\u4f19\uff01\uff09 \u524d\u7aefIDE\u914d\u7f6e \u8fd9\u91cc\u6211\u63a8\u8350 Webstorm \uff0c\u81f3\u4e8evscode\u672c\u4eba\u786e\u5b9e\u4e0d\u592a\u611f\u5192\uff0c\u867d\u7136\u4f1a\u8f7b\u91cf\u7ea7\u4e00\u70b9\u3002(\u6211\u5c31\u662f\u559c\u6b22jetbrains\u5168\u5bb6\u6876) \u5982\u679c\u6ca1\u6709\u7684\u8bdd\uff0c\u53ef\u4ee5\u7528Pycharm\u4e0b\u8f7dWebstorm\u63d2\u4ef6\u8fdb\u884c\u5f00\u53d1\u3002 \u5efa\u7acb\u914d\u7f6e\u6587\u4ef6 \u9996\u5148\u6211\u4eec\u7b2c\u4e00\u6b65\u5148\u5efa\u7acb\u914d\u7f6e\u6587\u4ef6: pityWeb\\src\\consts\\config.js export const CONFIG = { URL : 'http://localhost:7777' , ROLE : { 0 : 'user' , 1 : 'admin' , 2 : 'superAdmin' } } \u5b58\u50a8\u6211\u4eec\u7684\u540e\u7aef\u5730\u5740\u548c\u7528\u6237\u89d2\u8272\u4fe1\u606f\u3002 \u67e5\u770bAntd pro\u7684\u767b\u5f55model(pityWeb\\src\\models\\login.js) \u53ef\u4ee5\u770b\u5230\u9ed8\u8ba4\u91c7\u7528\u7684fakeAccountLogin\u65b9\u6cd5(\u8fd9\u91cc\u88ab\u6211\u6ce8\u91ca\u6389\u4e86)\uff0c\u6211\u4eec\u627e\u5230\u4ed6: \u6539\u9020\u767b\u5f55\u63a5\u53e3(pityWeb\\src\\services\\login.js) \u4ee3\u7801\u5f88\u7b80\u5355\uff0c\u7531\u4e8eantd pro\u7ed9\u6211\u4eec\u5c01\u88c5\u597d\u4e86 \u57fa\u672c\u7684Request\u65b9\u6cd5 \uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u6309\u90e8\u5c31\u73ed\uff0c\u4f9d\u846b\u82a6\u753b\u74e2\u5199\u51fa\u8bf7\u6c42 auth/login \u7684\u7a0b\u5e8f\uff0c\u5b8c\u6574\u4ee3\u7801: import { CONFIG } from '@/consts/config' ; export async function login ( params ) { return request( ` ${CONFIG.URL} /auth/login` , { method : 'POST' , data : params }) } \u4fee\u6539\u7528\u6237\u7684\u767b\u5f55\u72b6\u6001 \u4ed4\u7ec6\u770bmodel\u4e2d\u7684login\u65b9\u6cd5\uff0c\u5b83\u505a\u4e862\u6b65: \u767b\u5f55\uff08mock\uff09 \u5c06\u767b\u5f55\u6210\u529f/\u5931\u8d25\u7684\u4fe1\u606f\u4f20\u5165changeLoginStatus\u65b9\u6cd5 \u6211\u4eec\u770b\u770b changeLoginStatus \u65b9\u6cd5\u505a\u4e86\u4ec0\u4e48: \u5148\u8bbe\u7f6e\u7528\u6237\u7684\u6743\u9650\uff0c\u8fd9\u91cc\u6211\u628aROLE\u5df2\u7ecf\u5e26\u5165\u8fdb\u6765 \u8bbe\u7f6e\u5f53\u524d\u72b6\u6001: ok\u4ee3\u8868\u767b\u5f55\u6210\u529f error\u4ee3\u8868\u672a\u6210\u529f\uff0c\u7531\u4e8e\u54b1\u4eec\u7528\u7684\u4e0d\u662fstatus\u72b6\u6001\u5224\u65ad\u7528\u6237\u662f\u5426\u767b\u5f55\u6210\u529f\uff0c\u6240\u4ee5\u9700\u8981\u4fee\u6539\u4e3a\u4e09\u5143\u8868\u8fbe\u5f0f: payload.code === 0 ? 'ok': 'error' \u4e0a\u8ff0\u5177\u4f53\u8fd4\u56de\u4fe1\u606f\u53ef\u4ee5\u4ece\u4e0b\u56fe\u4e2d\u770b\u5230 \u8fd9\u91cc\u4ee3\u7801\u6211\u4eec\u8fdb\u884c\u76f8\u5e94\u8c03\u6574: changeLoginStatus(state, { payload }) { // setAuthority(payload.currentAuthority); setAuthority(CONFIG.ROLE[payload.user.role]); return { ...state, status : payload.code === 0 ? 'ok' : 'error' , type : payload.type }; }, \u6ce8\u610f\u8fd9\u91cc\u4e5f\u4ecemock\u66ff\u6362\u6210\u4e86\u771f\u5b9e\u63a5\u53e3 \u5c1d\u8bd5\u4e00\u4e0b \u63d0\u793a\u7f51\u7edc\u9519\u8bef \u522b\u614c\uff0c\u6211\u4eecF12\uff08\u6216\u8005\u53f3\u952e\u6253\u5f00\u5f00\u53d1\u8005\u5de5\u5177\uff09\u53ef\u4ee5\u770b\u5230: \u6ca1\u9519\uff0c\u6211\u4eec\u9047\u5230\u4e86 \u8de8\u57df\u95ee\u9898 \u3002 \u8de8\u57df\u95ee\u9898\u5177\u4f53\u53ef\u4ee5\u53bb\u767e\u5ea6\u4e00\u4e0b\uff0c\u8fd9\u91cc\u7b80\u5355\u4ecb\u7ecd\u4e00\u4e0b\uff0c\u662f\u8bf4\u6d4f\u89c8\u5668\u51fa\u4e8e\u5b89\u5168\u8003\u8651\uff0c\u5bf9\u4e8e\u524d\u540e\u7aef\u57df\u540d\u4e0d\u4e00\u81f4\u7684\u60c5\u51b5\u4e0b\uff0c\u4f1a\u9ed8\u8ba4\u8fdb\u884c\u62e6\u622a\uff0c\u963b\u6b62\u4f60\u4eec\u8fdb\u884c\u4ea4\u4e92\u3002\u8fd9\u591a\u89c1\u4e8e \u524d\u540e\u7aef\u5206\u79bb\u7684\u9879\u76ee \u4e2d\u51fa\u73b0\u3002 \u53ef\u4ee5\u4ece\u524d\u7aef\u4e5f\u53ef\u4ee5\u4ece\u540e\u7aef\u7684\u89d2\u5ea6\u6765\u5904\u7406\uff0c\u6211\u4eec\u4e3a\u4e86\u65b9\u4fbf\uff0c\u76f4\u63a5\u6539\u9020\u6211\u4eec\u7684 Flask \u3002 \u4f7fFlask\u652f\u6301\u8de8\u57df \u6211\u4eec\u9700\u8981\u5148\u5b89\u88c5\u4e00\u4e2a\u5305: pip3 install flask-cors \u7136\u540e\u8fdb\u884c\u5982\u4e0b\u6539\u9020: pity/app/__init__.py \u6ce8\u610f\u8fd9\u4e2a\u662f\u540e\u7aef\u7684\u9879\u76ee\u54c8\uff0c\u4e0d\u8981\u641e\u9519\u4e86\uff0c\u524d\u540e\u7aef\u5206\u79bb\u5c31\u662f\u524d\u7aef\u4e5f\u641e\u540e\u7aef\u4e5f\u641e\uff0c\u9700\u8981\u5207\u6362\u3002 from flask import Flask from flask_cors import CORS from config import Config pity = Flask(__name__) CORS(pity, supports_credentials= True ) pity.config.from_object(Config) \u8d34\u5fc3\u7684\u6211\u8fd8\u662f\u8d34\u51fa\u4e86\u6e90\u4ee3\u7801\u3002 \u518d\u6b21\u5c1d\u8bd5 \u91cd\u542f\u4e0b\u540e\u7aef\u670d\u52a1\u54e6\u8bb0\u5f97 \u8f93\u5165\u9519\u8bef\u7684\u7528\u6237\u540d\u5bc6\u7801\uff0c\u53ef\u4ee5\u770b\u5230\u767b\u5f55\u6309\u94ae\u8f6c\u4e86\u4e00\u5708\u53c8\u56de\u5230\u4e86\u539f\u70b9\u3002\u4f46\u662f\u767b\u5f55\u63a5\u53e3\u53c8\u662f\u6b63\u5e38\u54cd\u5e94\u7684: \u4ed4\u7ec6\u67e5\u770b\u767b\u5f55\u5757\u7684\u4ee3\u7801\uff0c\u539f\u6765\u662f \u6ca1\u6709\u8f93\u51fa\u9519\u8bef\u4fe1\u606f \u3002\u6211\u4eec\u7ee7\u7eed\u8fdb\u884c\u6539\u9020: \u52a0\u4e2aelse\u5373\u53ef message.error\u53ef\u4ee5\u5f39\u51fa\u9519\u8bef\u4fe1\u606f: \u7528\u6237\u540d\u6216\u5bc6\u7801\u9519\u8bef \u76ee\u7684\u8fbe\u5230\u4e86\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u6765\u8bd5\u8bd5\u6b63\u786e\u7684\u7528\u6237\u540d\u548c\u5bc6\u7801: \u53ef\u4ee5\u770b\u5230\u63d0\u793a\u6210\u529f\u540e\u53c8\u62a5\u9519\u4e86 \u6211\u4eec\u53bb\u627e\u5230api/currentUser\u63a5\u53e3\u7684\u8c03\u7528\u5730\u65b9: \u53ef\u4ee5\u770b\u5230\u662f\u8fd9\u4e2a\u65b9\u6cd5\u5728\u4f5c\u795f\uff0c\u56e0\u4e3aantd pro\u4f1amock\u4e00\u4e2a\u7528\u6237\uff0c\u5b83\u6709\u59d3\u540d\u7b49\u4fe1\u606f\uff0c\u4f46\u8fd9\u4e9b\u6211\u4eec\u9700\u8981\u771f\u5b9e\u7684\uff0c\u6240\u4ee5\u9700\u8981\u7ed9\u4ed6\u8fdb\u884c\u4e00\u6b21\u6539\u9020: \u6539\u9020\u83b7\u53d6\u5f53\u524d\u7528\u6237\u4fe1\u606f \u8fd8\u8bb0\u5f97\u6211\u4eec\u7684\u767b\u5f55\u63a5\u53e3\u8fd4\u56de\u7684\u6570\u636e\u5417\uff1f\u6211\u4eec\u6bcf\u6b21\u767b\u5f55\u540e\uff0c\u628a\u5b83\u5199\u5165\u6d4f\u89c8\u5668\u7f13\u5b58\u4e2d\uff0c\u8fd9\u6837\u5f53\u7528\u6237\u767b\u5f55\u4ee5\u540e\uff0c\u6211\u4eec\u4ece\u6d4f\u89c8\u5668\u7f13\u5b58\u53d6\u51fa\u7528\u6237\u4fe1\u606f\u5373\u53ef\u3002 \u5148\u5c06\u7528\u6237\u4fe1\u606f\u548ctoken\u8bbe\u7f6e\u5230\u7f13\u5b58 localStorage\u53ef\u4ee5\u64cd\u4f5c\u6d4f\u89c8\u5668\u7f13\u5b58\uff0c\u4f46\u662f\u53ea\u63a5\u53d7string\u548cstring\u7684\u952e\u503c\u5bf9\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u628auser\u5bf9\u8c61\u5e8f\u5217\u5316\u4e3astring\u3002 \u4ece\u7f13\u5b58\u4e2d\u53d6\u51fa\u6570\u636e \u8bb0\u5f97\u6570\u636e\u9700\u8981\u53cd\u5e8f\u5217\u5316 \u4fee\u6539\u767b\u5f55\u5224\u65ad\u6761\u4ef6\uff0c\u8fd9\u4e2a\u5751\u627e\u4e86\u6211\u5f88\u4e45\uff0c\u56e0\u4e3a\u54b1\u4eec\u7684\u5b57\u6bb5\u662fid\u4e0d\u662fuserId\uff0c\u6240\u4ee5\u6211\u521a\u624d\u5361\u5728\u4e00\u76f4\u767b\u5f55\u4e86\u81ea\u52a8\u88ab\u9000\u51fa: \u4fdd\u5b58\u540e\u518d\u6b21\u5c1d\u8bd5 \u4e00\u6b21\u70b9\u4eae \u597d\u4e86\uff0c\u4eca\u5929\u7684\u5185\u5bb9\u5c31\u5230\u8fd9\u4e86\u3002\u524d\u7aef\u4ee3\u7801\u5df2\u4e0a\u4f20~ \u540e\u7aef\u4ee3\u7801\u5730\u5740: https://github.com/wuranxu/pity \u524d\u7aef\u4ee3\u7801\u5730\u5740: https://github.com/wuranxu/pityWeb \u89c9\u5f97\u6709\u7528\u7684\u8bdd\u53ef\u4ee5\u5e2e\u5fd9\u70b9\u4e2aStar\u54e6QAQ","title":"9.\u4e0e\u524d\u7aef\u8054\u8c03\u6ce8\u518c/\u767b\u5f55\u63a5\u53e3(part 2)"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2890%29%20%E7%BC%96%E5%86%99oss%E5%AE%A2%E6%88%B7%E7%AB%AF/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \ud83d\udcd2 \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u7f16\u5199\u4e86 \u5728\u7ebf\u6267\u884c\u6d4b\u8bd5\u8ba1\u5212 \u529f\u80fd\uff0c\u5e76\u7a0d\u5fae\u6539\u4e86\u4e0b\u62a5\u544a\u9875\u9762\u3002\u90a3\u5176\u5b9e\u6211\u4eec\u4e4b\u524d\u7684\u5185\u5bb9\u90fd\u662f\u6709\u5f88\u591a \u5751 \u5728\u91cc\u9762\u7684\u3002 \u6bd4\u5982http\u8bf7\u6c42\u53ea\u652f\u6301\u4e86json\u548cform\uff0c\u6ca1\u6709\u652f\u6301 \u6587\u4ef6\u4e0a\u4f20 \u7684\u8bf7\u6c42\uff0c\u751a\u81f3\u6709\u4e00\u4e9bcrud\u7684\u529f\u80fd\u90fd\u6ca1\u6709\u592a\u5b8c\u5584\u3002 \u4e0d\u8fc7\u4e0d\u8981\u7d27\uff0c\u6211\u7684\u60f3\u6cd5\u8fd8\u662f\u5148 \u521b\u9020 \uff0c\u518d\u5b8c\u5584\u3002\u5f53\u7136\u4e5f\u4e0d\u662f\u76f2\u76ee\u521b\u9020\uff0c\u4e5f\u5f97\u63d0\u524d\u9884\u5224\u597d\u540e\u9762\u7684\u8d70\u5411\u3002 \ud83d\udcd2 \u4e3a\u4ec0\u4e48\u8981\u7528oss pity\u91cc\u9762oss\u6253\u7b97\u7528\u57282\u4e2a\u5730\u65b9\uff0c\u7b2c\u4e00\u4e2a\u5c31\u662f\u4e00\u4e9b\u9759\u6001\u8d44\u6e90\u56fe\u7247\u3002\u6bd4\u65b9\u8bf4 \u9879\u76ee\u56fe\u7247 \uff0c \u7528\u6237\u5934\u50cf \u3002 \u53e6\u4e00\u4e2a\u5730\u65b9\u5c31\u662f\u4e0a\u6587\u8bf4\u7684\uff0c\u6d4b\u8bd5\u6587\u4ef6\u4e0a\u4f20\u63a5\u53e3\u7684\u65f6\u5019\uff0c\u6211\u4eec\u9700\u8981 \u6d4b\u8bd5\u6587\u4ef6 \u3002\u8fd9\u4e9b\u6587\u4ef6\u600e\u4e48\u6765\uff0c\u600e\u4e48\u7ba1\u7406\uff1f\u90fd\u5f97\u501f\u52a9oss\u6765\u5b8c\u6210\u3002 \u76ee\u524d\u4ee5\u6211\u719f\u6089\u7684oss\u4e3a\u4f8b\uff0c\u6253\u7b97\u652f\u6301\u4ee5\u4e0b\u51e0\u79cdoss: \u963f\u91cc\u4e91oss \u2714 \u817e\u8baf\u4e91cos (\u65e0\u8d26\u53f7) \ud83d\udc8a \u4e03\u725b\u4e91(\u514d\u8d39\uff0c\u6211\u80fd\u7ed9\u5c55\u793ademo) gitee(\u514d\u8d39) \u5176\u4e2d\u963f\u91cc\u4e91\u548c\u817e\u8baf\u4e91\u7531\u4e8e\u90fd\u662f \u4ed8\u8d39\u4ea7\u54c1 \uff0c\u535a\u4e3b\u8fd8\u662f\u4e70\u4e0d\u8d77\u7684\u3002\u6240\u4ee5\u53ef\u80fd\u9700\u8981\u6709\u5bf9\u5e94\u7684\u6d4b\u8bd5\u8d26\u53f7\uff0c\u5728\u6b64\u611f\u8c22\u5c0f\u53f3(Mini-Right)\u7684\u5e2e\u52a9\uff0c\u7ed9\u4e86\u6211\u4e00\u4e2a\u963f\u91cc\u4e91\u7684\u6d4b\u8bd5\u8d26\u53f7\uff0c\u4fdd\u8bc1\u4e86crud\u80fd\u6b63\u5e38\u8fdb\u884c\u3002 \u5982\u679c\u9700\u8981\u6211\u5b9e\u73b0\u5176\u4ed6oss\u5ba2\u6237\u7aef\uff0c\u8bf7\u5e26\u4e0a\u5bf9\u5e94\u7684\u6d4b\u8bd5\u8d26\u53f7\u79c1\u4fe1\u6211\u54c8\u3002 \u6d4b\u8bd5\u7f51\u7ad9\u7684\u6570\u636e\u4f30\u8ba1\u4f1a\u7528 gitee \u6216\u8005 \u4e03\u725b\u4e91 \u3002 \ud83d\udcd2 \u8bf4\u660e \u5173\u4e8e\u6587\u4ef6\u7ba1\u7406\u8fd9\u5757\uff0c\u7531\u4e8e\u65f6\u95f4\u5173\u7cfb\uff0c\u6211 \u6682\u65f6\u4e0d\u4f1a \u843d\u4e00\u5f20\u8868\u4e0eoss\u6570\u636e\u8fdb\u884c\u5173\u8054\uff0c\u4e3b\u8981\u76ee\u7684\u662f\u4e3a\u4e86 \u8282\u7701\u65f6\u95f4 \u3002 \u8868\u5173\u8054\u53ef\u4ee5\u4f5c\u4e3a\u4e8c\u671f\u5de5\u7a0b\u3002 \ud83d\udcd2 \u7f16\u5199oss\u57fa\u7c7b \u65b0\u5efa app.middleware.oss.oss_file.py \u7531\u4e8e\u54b1\u4eec\u652f\u6301\u591a\u79cdoss\u5ba2\u6237\u7aef\uff0c\u6240\u4ee5\u5305\u88c5\u597d\u4e00\u4e2a\u62bd\u8c61\u7c7b\uff08\u7c7b\u4f3cgo\u7684interface\uff09\u7b49\u7740\u5404\u4e2a oss\u5ba2\u6237\u7aef \u53bb\u5b9e\u73b0\u4e4b\u3002 from abc import ABC, abstractmethod from typing import ByteString class OssFile ( ABC ): @abstractmethod def create_file ( self, filepath: str , content: ByteString ): pass @abstractmethod def update_file ( self, filepath: str , content: ByteString ): pass @abstractmethod def delete_file ( self, filepath: str ): pass @abstractmethod def list_file ( self ): pass @abstractmethod def download_file ( self, filepath ): pass \u62bd\u8c61\u7c7b\u6ca1\u6709\u5177\u4f53\u7684\u5b9e\u73b0\uff0c\u53ea\u6709\u65b9\u6cd5\u7684\u5b9a\u4e49\uff0c\u76ee\u7684\u662f\u4e3a\u4e86 \u9650\u5236\u5b50\u7c7b\u7684\u65b9\u6cd5\uff0c\u5373\u5fc5\u987b\u5b9e\u73b0\u57fa\u7c7b\u4e2d\u5b9a\u4e49\u7684\u65b9\u6cd5\u3002 \u603b\u7ed3\u4e86\u4e00\u4e0b\uff0c\u5fc5\u987b\u6709 \u589e\u5220\u6539\u67e5\u4e0b\u8f7d 5\u79cd\u65b9\u6cd5\u3002 \ud83d\udcd2 \u7f16\u5199AliyunOss\u5b9e\u73b0 \u65b0\u5efa app.middleware.oss.aliyun.py from typing import ByteString import oss2 from app.middleware.oss.files import OssFile class AliyunOss ( OssFile ): def __init__ ( self, access_key_id: str , access_key_secret: str , endpoint: str , bucket: str ): auth = oss2.Auth(access_key_id=access_key_id, access_key_secret=access_key_secret) # auth = oss2.AnonymousAuth() self.bucket = oss2.Bucket(auth, endpoint, bucket) def create_file ( self, filepath: str , content: ByteString ): self.bucket.put_object(filepath, content) def update_file ( self, filepath: str , content: ByteString ): self.bucket.put_object(filepath, content) def delete_file ( self, filepath: str ): self.bucket.delete_object(filepath) def list_file ( self ): ans = [] for obj in oss2.ObjectIteratorV2(self.bucket): ans.append( dict (key=obj.key, last_modified=obj.last_modified, size=obj.size, owner=obj.owner)) return ans def download_file ( self, filepath ): if not self.bucket.object_exists(filepath): raise Exception( f\"oss\u6587\u4ef6: {filepath} \u4e0d\u5b58\u5728\" ) return self.bucket.get_object(filepath) AliyunOss \u7ee7\u627f \u4e86OssFile\uff0c\u6784\u9020\u65b9\u6cd5\u83b7\u53d6\u963f\u91cc\u4e91\u7684\u8eab\u4efd\u4fe1\u606f\uff0c\u5e76\u9a8c\u8bc1\u3002\u6700\u540e\u8bfb\u53d6bucket\uff0c\u8fd9bucket\u6211\u7406\u89e3\u7684\u662f\u4e00\u5757 \u533a\u57df \uff0c\u4f60\u7684\u6587\u4ef6\u90fd\u5b58\u50a8\u5728\u8fd9\u5757\u533a\u57df\u91cc\u9762\uff0c\u6211\u4eec\u5c31\u53eb\u4ed6F\u76d8\u5427\u3002 \u5176\u4ed6\u7684\u65b9\u6cd5\u5f88\u7b80\u5355\uff0c\u57fa\u672c\u4e0a\u662f\u8c03\u7528\u5bf9\u5e94\u7684api\uff0c\u53bb\u505acrud\u64cd\u4f5c\u3002oss\u6ca1\u6709 \u6587\u4ef6\u5939 \u7684\u6982\u5ff5\uff0c\u90fd\u662f\u7edf\u4e00\u7528\u8def\u5f84\u6765\u5b58\u50a8\u6587\u4ef6\u5730\u5740\u7684\uff0c\u6bd4\u5982: woody/github.txt \u8fd9\u4e2a\u6587\u4ef6\u8def\u5f84\u53ef\u4ee5\u7406\u89e3\u4e3a\uff0cwoody\u76ee\u5f55\u4e0b\u7684 github.txt \u6587\u4ef6\u3002 \ud83d\udcd2 \u7f16\u5199\u83b7\u53d6\u5ba2\u6237\u7aef\u65b9\u6cd5 app.middleware.oss._\\_init__.py from app.core.configuration import SystemConfiguration from app.middleware.oss.aliyun import AliyunOss from app.middleware.oss.files import OssFile class OssClient ( object ): _client = None @classmethod def get_oss_client ( cls ) -> OssFile: \"\"\" \u901a\u8fc7oss\u914d\u7f6e\u62ff\u5230oss\u5ba2\u6237\u7aef :return: \"\"\" if OssClient._client is None : cfg = SystemConfiguration.get_config() oss_config = cfg.get( \"oss\" ) access_key_id = oss_config.get( \"access_key_id\" ) access_key_secret = oss_config.get( \"access_key_secret\" ) bucket = oss_config.get( \"bucket\" ) endpoint = oss_config.get( \"endpoint\" ) if oss_config is None : raise Exception( \"\u670d\u52a1\u5668\u672a\u914d\u7f6eoss\u4fe1\u606f, \u8bf7\u5728configuration.json\u4e2d\u6dfb\u52a0\" ) if oss_config.get( \"type\" ).lower() == \"aliyun\" : return AliyunOss(access_key_id, access_key_secret, endpoint, bucket) raise Exception( \"\u4e0d\u652f\u6301\u7684oss\u7c7b\u578b\" ) return OssClient._client \u6211\u4eec\u5728configuration.json\u914d\u7f6eoss\u4fe1\u606f\uff0c\u63a5\u7740\u6bcf\u6b21\u90fd\u4eceOssClient\u83b7\u53d6\u5ba2\u6237\u7aef\u5373\u53ef\u3002 \ud83d\udcd2 \u7f16\u5199\u540e\u7aef\u63a5\u53e3 from fastapi import APIRouter, File, UploadFile from app.handler.fatcory import PityResponse from app.middleware.oss import OssClient router = APIRouter(prefix= \"/oss\" ) @router.post( \"/upload\" ) async def create_oss_file ( filepath: str , file: UploadFile = File( ... ) ): try : file_content = await file.read() # \u83b7\u53d6oss\u5ba2\u6237\u7aef client = OssClient.get_oss_client() client.create_file(filepath, file_content) return PityResponse.success() except Exception as e: return PityResponse.failed( f\"\u4e0a\u4f20\u5931\u8d25: {e} \" ) @router.get( \"/list\" ) async def list_oss_file (): try : client = OssClient.get_oss_client() files = client.list_file() return PityResponse.success(files) except Exception as e: return PityResponse.failed( f\"\u83b7\u53d6\u5931\u8d25: {e} \" ) @router.get( \"/delete\" ) async def delete_oss_file ( filepath: str ): try : client = OssClient.get_oss_client() client.delete_file(filepath) return PityResponse.success() except Exception as e: return PityResponse.failed( f\"\u5220\u9664\u5931\u8d25: {e} \" ) @router.post( \"/update\" ) async def update_oss_file ( filepath: str , file: UploadFile = File( ... ) ): \"\"\" \u66f4\u65b0oss\u6587\u4ef6\uff0c\u8def\u5f84\u4e0d\u80fd\u53d8\u5316 :param filepath: :param file: :return: \"\"\" try : client = OssClient.get_oss_client() file_content = await file.read() client.update_file(filepath, file_content) return PityResponse.success() except Exception as e: return PityResponse.failed( f\"\u5220\u9664\u5931\u8d25: {e} \" ) \u65b9\u6cd5\u5f88\u7b80\u5355\uff0c\u6587\u4ef6\u8def\u5f84\u5728url\u53c2\u6570\u91cc\u8fb9\uff0c\u6587\u4ef6\u7684\u8bdd\uff0c\u5229\u7528fastapi\u91cc\u9762\u7684File\u548cUploadFile\u7686\u53ef\u83b7\u53d6\u5230\u4e0a\u4f20\u7684\u6587\u4ef6\u3002 \u6ce8\u610f\uff0c\u5fc5\u987b\u5148\u5b89\u88c5python-multipart\u5e93\u914d\u5408\u6587\u4ef6\u4e0a\u4f20 \ud83d\udcd2 \u6d4b\u8bd5\u4e00\u4e0b \u6210\u529f\u8bfb\u53d6\u5230\u4e86oss\u7684\u6587\u4ef6\u4fe1\u606f\uff0c\u4f46\u4e0b\u8f7d\u63a5\u53e3 \u597d\u50cf\u5fd8\u8bb0\u4e0b\u8f7d\u6587\u4ef6\u76f8\u5173\u5185\u5bb9\u4e86\uff0c\u90a3\u4e48\u53c2\u8003\u6211\u7684 \u4e0a\u4e00\u7bc7FsatApi\u4e0b\u8f7d\u6587\u4ef6\u7684\u6587\u7ae0 \u5427\u3002 FastApi\u4e0b\u8f7d\u6587\u4ef6 \u6216\u8005\u76f4\u63a5\u53bbgithub\u67e5\u770b\u6e90\u7801~ \u4eca\u5929\u7684\u5185\u5bb9\u5c31\u4ecb\u7ecd\u5230\u8fd9\u91cc\u4e86\uff0c\u4e0b\u4e00\u8282\u5377oss\u7684\u7528\u9014\u3002","title":"90.\u7f16\u5199oss\u5ba2\u6237\u7aef"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2891%29%20%E7%BC%96%E5%86%99oss%E7%AE%A1%E7%90%86%E9%A1%B5%E9%9D%A2/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u7f16\u5199\u597d\u4e86 oss \u76f8\u5173\u7684crud\u63a5\u53e3\uff0c\u90a3\u8fd9\u4e00\u8282\u6211\u4eec\u5c31\u5f97\u4e3aoss\u6570\u636e\u7684\u7ba1\u7406\u7f16\u5199\u4e00\u4e2a\u65b0\u7684\u9875\u9762\u4e86\u3002 \u5373\u5c06\u505a\u7684\u662f\u4e00\u4e2a\u6781\u5ea6\u7cbe\u7b80\u7684 \u6587\u4ef6\u7ba1\u7406\u9875\u9762 \u3002 \u6548\u679c\u56fe \u56e0\u4e3a\u6211\u6bcf\u6b21\u90fd\u662f\u5199\u5b8c\u4e00\u6bb5\u4ee3\u7801\uff0c\u7136\u540e\u7f16\u5199\u5bf9\u5e94\u6559\u7a0b\uff0c\u6240\u4ee5\u6548\u679c\u56fe\u8fd9\u79cd\u4e1c\u897f\u81ea\u7136\u662f\u4e0d\u5728\u8bdd\u4e0b: \u56fe\u7247\u53ef\u4ee5\u70b9\u51fb\u4e0b\u8f7d\uff0c\u4e5f\u53ef\u4ee5 \u5220\u9664 \u3002 \u7f16\u5199oss\u4e0b\u8f7d\u63a5\u53e3 \u5728\u6b64\u4e4b\u524d\u8fd8\u662f\u5148\u641e\u5b9a\u4e0b\u4e4b\u524d\u7684 \u4f5c\u4e1a \u3002 \u7f16\u5199\u968f\u673a\u83b7\u53d6\u6587\u4ef6\u540d\u7684\u65b9\u6cd5 \u6839\u636e\u4f20\u5165\u7684\u6587\u4ef6\u540d\uff0c\u914d\u5408pity\u7684\u6253\u4e71\u987a\u5e8f+\u5f53\u524d\u65f6\u95f4\u6233\uff0c\u57fa\u672c\u53ef\u4ee5 \u4fdd\u8bc1\u767e\u5206\u4e4b90 \u7684\u6587\u4ef6\u540d\u51b2\u7a81\u95ee\u9898\u3002 \u5b9e\u73b0\u963f\u91cc\u4e91\u7684\u4e0b\u8f7d\u6587\u4ef6\u65b9\u6cd5 \u8c03\u7528get_object_to_file\u5373\u53ef\uff0c\u5e76\u8fd4\u56de\u65b0\u7684\u6587\u4ef6\u8def\u5f84\u3002 \u5c01\u88c5\u4e0b\u8f7d\u6587\u4ef6\u7684\u65b9\u6cd5 \u7f16\u5199\u4e0b\u8f7d\u6587\u4ef6\u63a5\u53e3 @router . get ( \"/download\" ) async def download_oss_file ( filepath : str ): \"\"\" \u66f4\u65b0oss\u6587\u4ef6\uff0c\u8def\u5f84\u4e0d\u80fd\u53d8\u5316 :param filepath: :return: \"\"\" try : client = OssClient . get_oss_client () # \u5207\u5272\u83b7\u53d6\u6587\u4ef6\u540d filename = filepath . split ( \"/\" )[ - 1 ] path = client . download_file ( filepath , filename ) return PityResponse . file ( path , filename ) except Exception as e : return PityResponse . failed ( f \"\u4e0b\u8f7d\u5931\u8d25: { e } \" ) \u6ce8\u610f: \u7531\u4e8eoss\u91cc\u9762\u7684 \u6587\u4ef6\u540d \u90fd\u662f\u5e26\u8def\u5f84\u7684\uff08\u76ee\u5f55\uff09\uff0c\u6240\u4ee5\u6211\u4eecsplit\u4e00\u4e0b\u53d6\u51fa \u6587\u4ef6\u540d \u3002 \u770b\u770b\u4e0b\u8f7d\u7684\u6548\u679c \u524d\u7aef\u9875\u9762\u90e8\u5206 \u524d\u7aef\u9875\u9762\u8868\u683c\u90a3\u5757\u81ea\u7136\u662f \u4f20\u7edf\u624b\u827a \uff0c\u4e0d\u9700\u8981\u591a\u8bf4\u4e86\u3002 \u503c\u5f97\u6ce8\u610f\u7684\u662f\u4e0b\u9762\u8fd9\u51e0\u4e2a\u5730\u65b9: \u4e0a\u4f20\u6587\u4ef6\u8868\u5355 \u4e0a\u4f20\u6587\u4ef6\u8868\u5355\u91cc\u9762\u6709\u4e2aUpload\u7ec4\u4ef6\uff0c\u8fd9\u4e2a\u6bd4\u8f83\u7279\u6b8a\uff0c\u6211\u4eec\u9700\u8981\u624b\u52a8\u4e0a\u4f20\uff0c\u6211\u4e5f\u8e29\u4e86\u5f88\u4e45\u7684\u5751\u3002 \u8fd9\u91cc\u9644\u4e0a\u6e90\u7801: \u8fd9\u4e9b\u51e0\u4e4e\u90fd\u662f\u6839\u636eantd\u5b98\u7f51\u7684\u4f8b\u5b50\u6765\u7684\uff0c\u5176\u4e2dForm.Item\u5957\u4e862\u5c42\uff0cdemo\u5c31\u662f\u8fd9\u4e48\u5199\u7684\uff0c\u6211\u8bd5\u4e86\u4e0b\u53bb\u6389\u4e00\u4e2a\u8fd8\u4e0d\u884c\u3002 valuePropName\u56fa\u5b9a\u8981\u662f fileList \u3002 \u4e0a\u4f20\u6587\u4ef6\u7684http\u8bf7\u6c42 \u7531\u4e8e\u524d\u7aef\u672a\u4f7f\u7528axios\u8fd9\u6837\u7684http\u8bf7\u6c42\u5e93\uff0c\u800c\u662fumi-request\uff08\u81ea\u5df1\u5c01\u88c5\u7684\uff09\u3002 \u6240\u4ee5\u8fd9\u8fb9\u8fd8\u662f\u8bf4\u660e\u4e00\u4e0b\u600e\u4e48\u4f7f\u7528: \u8fd9\u662f\u6587\u4ef6\u4e0a\u4f20\u7684\u65b9\u6cd5\uff0c\u7b2c\u4e00\u662f\u8981\u5236\u9020 FormData \u5bf9\u8c61\uff0c\u5e76\u628a\u6587\u4ef6\u6570\u636eappend\u8fdb\u53bb\u3002 \u7b2c\u4e8c\u4e2a\u5173\u952e\u5c31\u662frequestType\u8981\u6307\u5b9a\u4e3a form \uff0c\u8fd92\u70b9\u6211\u6478\u7d22\u4e86\u633a\u4e45\u3002 \u4e0b\u8f7d\u6587\u4ef6 \u7528window.open\u6216\u8005a\u6807\u7b7e\u94fe\u63a5\u5230\u6211\u4eec\u7684download\u63a5\u53e3\u63a5\u53e3: window.open( ${CONFIG.URL}/oss/download?filepath=${record.key} ) \u5168\u90e8\u4ee3\u7801 import { PageContainer } from \"@ant-design/pro-layout\" ; import { Button , Card , Col , Divider , Form , Input , Modal , Row , Table , Upload } from \"antd\" ; import { InboxOutlined , PlusOutlined } from \"@ant-design/icons\" ; import { CONFIG } from \"@/consts/config\" ; import { useEffect , useState } from \"react\" ; import { connect } from 'umi' ; import moment from \"moment\" ; const Oss = ({ loading , dispatch , gconfig }) => { const [ form ] = Form . useForm (); const { ossFileList , searchOssFileList } = gconfig ; const [ visible , setVisible ] = useState ( false ); const [ value , setValue ] = useState ( '' ); const onDeleteFile = key => { dispatch ({ type : 'gconfig/removeOssFile' , payload : { filepath : key } }) } const listFile = () => { dispatch ({ type : 'gconfig/listOssFile' , }) } const columns = [ { title : '\u6587\u4ef6\u8def\u5f84' , key : 'key' , dataIndex : 'key' , render : key => < a href = { ` ${ CONFIG . URL } /oss/download?filepath= ${ key } ` } target = \"_blank\" > { key } < /a> }, { title : '\u5927\u5c0f' , key : 'size' , dataIndex : 'size' , render : size => ` ${ Math . round ( size / 1024 ) } kb` }, { title : '\u66f4\u65b0\u65f6\u95f4' , key : 'last_modified' , dataIndex : 'last_modified' , render : lastModified => moment ( lastModified * 1000 ). subtract ( moment (). utcOffset () / 60 - 8 , 'hours' ). format ( 'YYYY-MM-DD HH:mm:ss' ) }, { title : '\u64cd\u4f5c' , key : 'ops' , render : ( record ) => <> < a onClick = {() => { window . open ( ` ${ CONFIG . URL } /oss/download?filepath= ${ record . key } ` ) }} > \u4e0b\u8f7d < /a> < Divider type = \"vertical\" /> < a onClick = {() => { onDeleteFile ( record . key ); }} > \u5220\u9664 < /a> < /> }, ] const normFile = ( e ) => { if ( Array . isArray ( e )) { return e ; } return e && e . fileList ; }; const onUpload = async () => { const values = await form . validateFields (); const res = dispatch ({ type : 'gconfig/uploadFile' , payload : values , }) if ( res ) { setVisible ( false ) setValue ( '' ) listFile (); } } useEffect (() => { if ( value === '' ) { dispatch ({ type : 'gconfig/save' , payload : { searchOssFileList : ossFileList } }) } else { dispatch ({ type : 'gconfig/save' , payload : { searchOssFileList : ossFileList . filter ( v => v . key . toLowerCase (). indexOf ( value . toLowerCase ()) > - 1 )} }) } }, [ value ]) useEffect (() => { listFile (); }, []) return ( < PageContainer title = \"OSS\u6587\u4ef6\u7ba1\u7406\" breadcrumb = { false } > < Card > < Modal width = { 600 } title = \"\u4e0a\u4f20\u6587\u4ef6\" visible = { visible } onCancel = {() => setVisible ( false )} onOk = { onUpload } > < Form form = { form } {... CONFIG . LAYOUT } > < Form . Item label = \"\u6587\u4ef6\u8def\u5f84\" name = \"filepath\" rules = {[{ required : true , message : '\u8bf7\u8f93\u5165\u6587\u4ef6\u8981\u5b58\u50a8\u7684\u8def\u5f84, \u76ee\u5f55\u7528/\u9694\u5f00' }]} > < Input placeholder = \"\u8bf7\u8f93\u5165\u6587\u4ef6\u8981\u5b58\u50a8\u7684\u8def\u5f84, \u76ee\u5f55\u7528/\u9694\u5f00\" /> < /Form.Item> < Form . Item label = \"\u6587\u4ef6\" required > < Form . Item name = \"files\" valuePropName = \"fileList\" getValueFromEvent = { normFile } noStyle rules = {[{ required : true , message : '\u8bf7\u81f3\u5c11\u4e0a\u4f20\u4e00\u4e2a\u6587\u4ef6' }]} > < Upload . Dragger name = \"files\" maxCount = { 1 } > < p className = \"ant-upload-drag-icon\" > < InboxOutlined /> < /p> < p className = \"ant-upload-text\" > \u70b9\u51fb\u6216\u62d6\u62fd\u6587\u4ef6\u5230\u6b64\u533a\u57df\u4e0a\u4f20 \ud83c\udf89 < /p> < /Upload.Dragger> < /Form.Item> < /Form.Item> < /Form> < /Modal> < Row gutter = {[ 8 , 8 ]} style = {{ marginBottom : 12 }} > < Col span = { 6 } > < Button type = \"primary\" onClick = {() => setVisible ( true )} >< PlusOutlined /> \u6dfb\u52a0\u6587\u4ef6 < /Button> < /Col> < Col span = { 12 } /> < Col span = { 6 } > < Input placeholder = \"\u8f93\u5165\u8981\u67e5\u627e\u7684\u6587\u4ef6\u540d\" value = { value } onChange = { e => { setValue ( e . target . value ); }} /> < /Col> < /Row> < Table rowKey = { record => record . key } dataSource = { searchOssFileList } columns = { columns } loading = { loading . effects [ 'gconfig/listOssFile' ]} /> < /Card> < /PageContainer> ) } export default connect (({ loading , gconfig }) => ({ loading , gconfig }))( Oss ); \u4eca\u5929\u7684\u5185\u5bb9\u5c31\u4ecb\u7ecd\u5230\u8fd9\u91cc\uff0c\u5982\u4eca\u6211\u4eec\u5df2\u7ecf\u53ef\u4ee5\u901a\u8fc7oss\u53bb\u7ba1\u7406\u6211\u4eec\u7684\u6587\u4ef6\u4e86\uff0c\u90a3\u6211\u4eec\u8981\u600e\u4e48\u8fd0\u7528\u5462\uff1f \u4e0b\u4e00\u8282\u7ed9\u5927\u5bb6\u4ecb\u7ecd\uff0chttp\u8bf7\u6c42\u652f\u6301 \u6587\u4ef6\u4e0a\u4f20 \u529f\u80fd\u3002","title":"91.\u7f16\u5199oss\u7ba1\u7406\u9875\u9762"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2891%29%20%E7%BC%96%E5%86%99oss%E7%AE%A1%E7%90%86%E9%A1%B5%E9%9D%A2/#_1","text":"\u4e0a\u4e00\u8282\u6211\u4eec\u7f16\u5199\u597d\u4e86 oss \u76f8\u5173\u7684crud\u63a5\u53e3\uff0c\u90a3\u8fd9\u4e00\u8282\u6211\u4eec\u5c31\u5f97\u4e3aoss\u6570\u636e\u7684\u7ba1\u7406\u7f16\u5199\u4e00\u4e2a\u65b0\u7684\u9875\u9762\u4e86\u3002 \u5373\u5c06\u505a\u7684\u662f\u4e00\u4e2a\u6781\u5ea6\u7cbe\u7b80\u7684 \u6587\u4ef6\u7ba1\u7406\u9875\u9762 \u3002","title":"\u56de\u987e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2891%29%20%E7%BC%96%E5%86%99oss%E7%AE%A1%E7%90%86%E9%A1%B5%E9%9D%A2/#_2","text":"\u56e0\u4e3a\u6211\u6bcf\u6b21\u90fd\u662f\u5199\u5b8c\u4e00\u6bb5\u4ee3\u7801\uff0c\u7136\u540e\u7f16\u5199\u5bf9\u5e94\u6559\u7a0b\uff0c\u6240\u4ee5\u6548\u679c\u56fe\u8fd9\u79cd\u4e1c\u897f\u81ea\u7136\u662f\u4e0d\u5728\u8bdd\u4e0b: \u56fe\u7247\u53ef\u4ee5\u70b9\u51fb\u4e0b\u8f7d\uff0c\u4e5f\u53ef\u4ee5 \u5220\u9664 \u3002","title":"\u6548\u679c\u56fe"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2891%29%20%E7%BC%96%E5%86%99oss%E7%AE%A1%E7%90%86%E9%A1%B5%E9%9D%A2/#oss","text":"\u5728\u6b64\u4e4b\u524d\u8fd8\u662f\u5148\u641e\u5b9a\u4e0b\u4e4b\u524d\u7684 \u4f5c\u4e1a \u3002 \u7f16\u5199\u968f\u673a\u83b7\u53d6\u6587\u4ef6\u540d\u7684\u65b9\u6cd5 \u6839\u636e\u4f20\u5165\u7684\u6587\u4ef6\u540d\uff0c\u914d\u5408pity\u7684\u6253\u4e71\u987a\u5e8f+\u5f53\u524d\u65f6\u95f4\u6233\uff0c\u57fa\u672c\u53ef\u4ee5 \u4fdd\u8bc1\u767e\u5206\u4e4b90 \u7684\u6587\u4ef6\u540d\u51b2\u7a81\u95ee\u9898\u3002 \u5b9e\u73b0\u963f\u91cc\u4e91\u7684\u4e0b\u8f7d\u6587\u4ef6\u65b9\u6cd5 \u8c03\u7528get_object_to_file\u5373\u53ef\uff0c\u5e76\u8fd4\u56de\u65b0\u7684\u6587\u4ef6\u8def\u5f84\u3002 \u5c01\u88c5\u4e0b\u8f7d\u6587\u4ef6\u7684\u65b9\u6cd5 \u7f16\u5199\u4e0b\u8f7d\u6587\u4ef6\u63a5\u53e3 @router . get ( \"/download\" ) async def download_oss_file ( filepath : str ): \"\"\" \u66f4\u65b0oss\u6587\u4ef6\uff0c\u8def\u5f84\u4e0d\u80fd\u53d8\u5316 :param filepath: :return: \"\"\" try : client = OssClient . get_oss_client () # \u5207\u5272\u83b7\u53d6\u6587\u4ef6\u540d filename = filepath . split ( \"/\" )[ - 1 ] path = client . download_file ( filepath , filename ) return PityResponse . file ( path , filename ) except Exception as e : return PityResponse . failed ( f \"\u4e0b\u8f7d\u5931\u8d25: { e } \" ) \u6ce8\u610f: \u7531\u4e8eoss\u91cc\u9762\u7684 \u6587\u4ef6\u540d \u90fd\u662f\u5e26\u8def\u5f84\u7684\uff08\u76ee\u5f55\uff09\uff0c\u6240\u4ee5\u6211\u4eecsplit\u4e00\u4e0b\u53d6\u51fa \u6587\u4ef6\u540d \u3002","title":"\u7f16\u5199oss\u4e0b\u8f7d\u63a5\u53e3"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2891%29%20%E7%BC%96%E5%86%99oss%E7%AE%A1%E7%90%86%E9%A1%B5%E9%9D%A2/#_3","text":"","title":"\u770b\u770b\u4e0b\u8f7d\u7684\u6548\u679c"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2891%29%20%E7%BC%96%E5%86%99oss%E7%AE%A1%E7%90%86%E9%A1%B5%E9%9D%A2/#_4","text":"\u524d\u7aef\u9875\u9762\u8868\u683c\u90a3\u5757\u81ea\u7136\u662f \u4f20\u7edf\u624b\u827a \uff0c\u4e0d\u9700\u8981\u591a\u8bf4\u4e86\u3002 \u503c\u5f97\u6ce8\u610f\u7684\u662f\u4e0b\u9762\u8fd9\u51e0\u4e2a\u5730\u65b9: \u4e0a\u4f20\u6587\u4ef6\u8868\u5355 \u4e0a\u4f20\u6587\u4ef6\u8868\u5355\u91cc\u9762\u6709\u4e2aUpload\u7ec4\u4ef6\uff0c\u8fd9\u4e2a\u6bd4\u8f83\u7279\u6b8a\uff0c\u6211\u4eec\u9700\u8981\u624b\u52a8\u4e0a\u4f20\uff0c\u6211\u4e5f\u8e29\u4e86\u5f88\u4e45\u7684\u5751\u3002 \u8fd9\u91cc\u9644\u4e0a\u6e90\u7801: \u8fd9\u4e9b\u51e0\u4e4e\u90fd\u662f\u6839\u636eantd\u5b98\u7f51\u7684\u4f8b\u5b50\u6765\u7684\uff0c\u5176\u4e2dForm.Item\u5957\u4e862\u5c42\uff0cdemo\u5c31\u662f\u8fd9\u4e48\u5199\u7684\uff0c\u6211\u8bd5\u4e86\u4e0b\u53bb\u6389\u4e00\u4e2a\u8fd8\u4e0d\u884c\u3002 valuePropName\u56fa\u5b9a\u8981\u662f fileList \u3002 \u4e0a\u4f20\u6587\u4ef6\u7684http\u8bf7\u6c42 \u7531\u4e8e\u524d\u7aef\u672a\u4f7f\u7528axios\u8fd9\u6837\u7684http\u8bf7\u6c42\u5e93\uff0c\u800c\u662fumi-request\uff08\u81ea\u5df1\u5c01\u88c5\u7684\uff09\u3002 \u6240\u4ee5\u8fd9\u8fb9\u8fd8\u662f\u8bf4\u660e\u4e00\u4e0b\u600e\u4e48\u4f7f\u7528: \u8fd9\u662f\u6587\u4ef6\u4e0a\u4f20\u7684\u65b9\u6cd5\uff0c\u7b2c\u4e00\u662f\u8981\u5236\u9020 FormData \u5bf9\u8c61\uff0c\u5e76\u628a\u6587\u4ef6\u6570\u636eappend\u8fdb\u53bb\u3002 \u7b2c\u4e8c\u4e2a\u5173\u952e\u5c31\u662frequestType\u8981\u6307\u5b9a\u4e3a form \uff0c\u8fd92\u70b9\u6211\u6478\u7d22\u4e86\u633a\u4e45\u3002 \u4e0b\u8f7d\u6587\u4ef6 \u7528window.open\u6216\u8005a\u6807\u7b7e\u94fe\u63a5\u5230\u6211\u4eec\u7684download\u63a5\u53e3\u63a5\u53e3: window.open( ${CONFIG.URL}/oss/download?filepath=${record.key} ) \u5168\u90e8\u4ee3\u7801 import { PageContainer } from \"@ant-design/pro-layout\" ; import { Button , Card , Col , Divider , Form , Input , Modal , Row , Table , Upload } from \"antd\" ; import { InboxOutlined , PlusOutlined } from \"@ant-design/icons\" ; import { CONFIG } from \"@/consts/config\" ; import { useEffect , useState } from \"react\" ; import { connect } from 'umi' ; import moment from \"moment\" ; const Oss = ({ loading , dispatch , gconfig }) => { const [ form ] = Form . useForm (); const { ossFileList , searchOssFileList } = gconfig ; const [ visible , setVisible ] = useState ( false ); const [ value , setValue ] = useState ( '' ); const onDeleteFile = key => { dispatch ({ type : 'gconfig/removeOssFile' , payload : { filepath : key } }) } const listFile = () => { dispatch ({ type : 'gconfig/listOssFile' , }) } const columns = [ { title : '\u6587\u4ef6\u8def\u5f84' , key : 'key' , dataIndex : 'key' , render : key => < a href = { ` ${ CONFIG . URL } /oss/download?filepath= ${ key } ` } target = \"_blank\" > { key } < /a> }, { title : '\u5927\u5c0f' , key : 'size' , dataIndex : 'size' , render : size => ` ${ Math . round ( size / 1024 ) } kb` }, { title : '\u66f4\u65b0\u65f6\u95f4' , key : 'last_modified' , dataIndex : 'last_modified' , render : lastModified => moment ( lastModified * 1000 ). subtract ( moment (). utcOffset () / 60 - 8 , 'hours' ). format ( 'YYYY-MM-DD HH:mm:ss' ) }, { title : '\u64cd\u4f5c' , key : 'ops' , render : ( record ) => <> < a onClick = {() => { window . open ( ` ${ CONFIG . URL } /oss/download?filepath= ${ record . key } ` ) }} > \u4e0b\u8f7d < /a> < Divider type = \"vertical\" /> < a onClick = {() => { onDeleteFile ( record . key ); }} > \u5220\u9664 < /a> < /> }, ] const normFile = ( e ) => { if ( Array . isArray ( e )) { return e ; } return e && e . fileList ; }; const onUpload = async () => { const values = await form . validateFields (); const res = dispatch ({ type : 'gconfig/uploadFile' , payload : values , }) if ( res ) { setVisible ( false ) setValue ( '' ) listFile (); } } useEffect (() => { if ( value === '' ) { dispatch ({ type : 'gconfig/save' , payload : { searchOssFileList : ossFileList } }) } else { dispatch ({ type : 'gconfig/save' , payload : { searchOssFileList : ossFileList . filter ( v => v . key . toLowerCase (). indexOf ( value . toLowerCase ()) > - 1 )} }) } }, [ value ]) useEffect (() => { listFile (); }, []) return ( < PageContainer title = \"OSS\u6587\u4ef6\u7ba1\u7406\" breadcrumb = { false } > < Card > < Modal width = { 600 } title = \"\u4e0a\u4f20\u6587\u4ef6\" visible = { visible } onCancel = {() => setVisible ( false )} onOk = { onUpload } > < Form form = { form } {... CONFIG . LAYOUT } > < Form . Item label = \"\u6587\u4ef6\u8def\u5f84\" name = \"filepath\" rules = {[{ required : true , message : '\u8bf7\u8f93\u5165\u6587\u4ef6\u8981\u5b58\u50a8\u7684\u8def\u5f84, \u76ee\u5f55\u7528/\u9694\u5f00' }]} > < Input placeholder = \"\u8bf7\u8f93\u5165\u6587\u4ef6\u8981\u5b58\u50a8\u7684\u8def\u5f84, \u76ee\u5f55\u7528/\u9694\u5f00\" /> < /Form.Item> < Form . Item label = \"\u6587\u4ef6\" required > < Form . Item name = \"files\" valuePropName = \"fileList\" getValueFromEvent = { normFile } noStyle rules = {[{ required : true , message : '\u8bf7\u81f3\u5c11\u4e0a\u4f20\u4e00\u4e2a\u6587\u4ef6' }]} > < Upload . Dragger name = \"files\" maxCount = { 1 } > < p className = \"ant-upload-drag-icon\" > < InboxOutlined /> < /p> < p className = \"ant-upload-text\" > \u70b9\u51fb\u6216\u62d6\u62fd\u6587\u4ef6\u5230\u6b64\u533a\u57df\u4e0a\u4f20 \ud83c\udf89 < /p> < /Upload.Dragger> < /Form.Item> < /Form.Item> < /Form> < /Modal> < Row gutter = {[ 8 , 8 ]} style = {{ marginBottom : 12 }} > < Col span = { 6 } > < Button type = \"primary\" onClick = {() => setVisible ( true )} >< PlusOutlined /> \u6dfb\u52a0\u6587\u4ef6 < /Button> < /Col> < Col span = { 12 } /> < Col span = { 6 } > < Input placeholder = \"\u8f93\u5165\u8981\u67e5\u627e\u7684\u6587\u4ef6\u540d\" value = { value } onChange = { e => { setValue ( e . target . value ); }} /> < /Col> < /Row> < Table rowKey = { record => record . key } dataSource = { searchOssFileList } columns = { columns } loading = { loading . effects [ 'gconfig/listOssFile' ]} /> < /Card> < /PageContainer> ) } export default connect (({ loading , gconfig }) => ({ loading , gconfig }))( Oss ); \u4eca\u5929\u7684\u5185\u5bb9\u5c31\u4ecb\u7ecd\u5230\u8fd9\u91cc\uff0c\u5982\u4eca\u6211\u4eec\u5df2\u7ecf\u53ef\u4ee5\u901a\u8fc7oss\u53bb\u7ba1\u7406\u6211\u4eec\u7684\u6587\u4ef6\u4e86\uff0c\u90a3\u6211\u4eec\u8981\u600e\u4e48\u8fd0\u7528\u5462\uff1f \u4e0b\u4e00\u8282\u7ed9\u5927\u5bb6\u4ecb\u7ecd\uff0chttp\u8bf7\u6c42\u652f\u6301 \u6587\u4ef6\u4e0a\u4f20 \u529f\u80fd\u3002","title":"\u524d\u7aef\u9875\u9762\u90e8\u5206"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2892%29%20%E8%AE%A9http%E8%AF%B7%E6%B1%82%E6%94%AF%E6%8C%81%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \u56de\u987e \u4e0a\u4e00\u8282\u5462\uff0c\u6211\u4eec\u7f16\u5199\u4e86oss\u7684\u5ba2\u6237\u7aef\u8fd9\u5757 \u5185\u5bb9 \u3002\u4f46\u5176\u5b9e\u6211\u4eec\u662f\u6709\u76ee\u7684\u7684\uff0c\u6211\u4eec\u77e5\u9053\uff0c\u6211\u4eec\u6709\u65f6\u5019\u6d4b\u8bd5\u4e00\u4e9b\u63a5\u53e3\uff0c\u6bd4\u65b9\u8bf4: \u6279\u91cf\u5bfc\u5165\u5546\u54c1 \uff0c\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u662f\u8981\u7ed9\u63a5\u53e3\u53d1\u9001\u4e00\u4e2a\u6587\u4ef6\uff08excel\u6216\u8005csv\uff09\u3002 \u90a3\u600e\u4e48\u4fdd\u7ba1\u6211\u4eec\u7684\u6d4b\u8bd5\u6570\u636e\u5462\uff0c\u90a3\u5c31\u8be5oss\u53d1\u6325\u5b83\u7684\u4f5c\u7528\u4e86\u3002\u4ee5\u5f80\u6211\u4eec\u505a\u6d4b\u8bd5\uff0c\u90fd\u4f1a\u653e\u4e00\u4e2a\u76ee\u5f55\u4fdd\u5b58\u6d4b\u8bd5\u6570\u636e\uff0c\u73b0\u5728\u53ea\u4e0d\u8fc7\u662f\u628a\u6570\u636e\u653e\u5230\u4e86oss\u4e4b\u4e2d\uff0c\u5176\u5b9e\u9053\u7406\u90fd\u4e00\u6837\u3002 \u4eca\u5929\u6211\u4eec\u5c31\u6765\u5b9e\u73b0http\u8bf7\u6c42\u652f\u6301oss\u6587\u4ef6\u4e0a\u4f20\u3002\u5728\u6b64\u4e4b\u524d\u6211\u4eec\u5148\u5f97\u4fee\u590d\u51e0\u4e2abug\uff08\u8fd8\u633a\u591a\u7684\uff0c\u4f46\u53ea\u5217\u4e00\u4e2a\u5178\u578b\uff09 bug\u8b66\u793a \u6ca1\u6709\u65ad\u8a00\u6570\u636e\u7684\u65f6\u5019\u62a5\u9519 \u9700\u89812\u4e2a\u8fd4\u56de\u503c\uff0c\u4f46\u662f\u54b1\u5728\u6ca1\u6709\u65ad\u8a00\u7684\u65f6\u5019\u53ea\u7ed9\u4e86\u4e00\u4e2a\uff0c\u5c5e\u5b9e\u9a6c\u864e\u3002 \u6548\u679c\u56fe \u601d\u8def \u6211\u4eec\u4e4b\u524d\u4e3a\u4e86\u56fe\u65b9\u4fbf\uff0c\u5728\u6709 body \u7684http\u8bf7\u6c42\u91cc\u9762\uff0c\u5f3a\u884c\u8ba9http\u8bf7\u6c42\u4e8c\u9009\u4e00: \u8981\u4e48json \u8981\u4e48form\u8868\u5355 \u9488\u5bf9\u8fd9\u6837\u6587\u4ef6\u7684\u5f62\u5f0f\uff0c\u5c31\u6ca1\u6cd5\u4e8c\u9009\u4e00\u4e86\uff0c\u6240\u4ee5\u6211\u4eec\u5fc5\u987b\u8981\u5b58\u50a8\u4e00\u4e2a\u5b57\u6bb5: body_type\uff0c\u8fd9\u4e2a\u5b57\u6bb5\u7528\u6765\u544a\u8bc9\u6211\u4eecbody\u662f\u4ec0\u4e48\u7c7b\u578b\u7684\uff0c\u4e5f\u5c31\u5bf9\u5e94\u8fd9\u91cc\u7684\u6570\u636e: 0\u4ee3\u8868none, 2\u4ee3\u8868form-data 1\u4ee3\u8868raw\uff08json\uff09 3\u4ee3\u8868x-www-form-urlencoded, \u540e\u7eed\u7684\u4f9d\u6b21\u6392\u5217\u3002 \u6240\u4ee5\u6211\u4eec\u8981\u53bb\u7528\u4f8b\u52a0\u4e2abody_type\uff0c\u5e76\u4e14\u9ed8\u8ba4\u4e3a1\uff08\u56e0\u4e3a\u76ee\u524d\u6211\u4eec\u7684\u63a5\u53e3\u7c7b\u578b\u5927\u90e8\u5206json\u7684\uff09. \u63a5\u7740\u6211\u4eec\u5728http\u8bf7\u6c42\u7684\u65f6\u5019\uff0c\u6839\u636e\u4e0d\u540c\u7684\u6570\u636e\u7c7b\u578b\u8fd4\u56de\u4e0d\u540c\u7684body\u5373\u53ef\u3002 \u65b0\u589e\u5b57\u6bb5body_type \u4fee\u6539app/models/test_case.py\uff0c\u65b0\u589ebody_type\u5b57\u6bb5\uff0c\u4fee\u6539\u5904\u6211\u5df2\u7ecf\u7ea2\u6846\u6807\u6ce8\u3002 \u8c03\u6574pydantic \u4e4b\u524d\u6211\u4eec\u7684schema\u6570\u636e\u90fd\u5b58\u653e\u5728router\u4e0b\u9762\uff0c\u540e\u6765\u5b58\u5728\u4e00\u4e9b\u5faa\u73af\u5f15\u5165\u95ee\u9898\u3002\u6240\u4ee5\u6211\u628a\u8bf7\u6c42\u5165\u53c2\u8fd9\u4e9b\u6570\u636e\u90fd\u653e\u5230\u4e86models\u4e0b\u9762\uff0c\u7279\u6b64\u8bf4\u660e\u4e00\u4e0b\u3002 \u6dfb\u52a0\u914d\u7f6e \u4ee5\u5f80\u554a\uff0c\u6211\u4eec\u5f88\u559c\u6b22\u51991\uff0c2\uff0c3\uff0c4: if case_type == 1 : \u8fd9\u79cd\u4ee3\u7801\uff0c\u4f46\u5176\u5b9e\u8fd9\u79cd\u4e1c\u897f\u5b8c\u5168\u53ef\u4ee5\u653e\u5230config\u91cc\u9762\uff0c\u8fd9\u6837\u7684\u8bdd\u6211\u4eec\u5982\u679c\u8981\u53d8\u6362\u5bf9\u5e94\u7684\u89c4\u5219\uff0c\u5c31\u5f88\u65b9\u4fbf\uff0c\u800c\u4e14\u770b1\uff0c2\uff0c3\uff0c4\u8fd8\u4e0d\u597d\u56de\u5fc6\u8fd9\u662f\u4ec0\u4e48\u7c7b\u578b\u3002 \u4eca\u6b21\uff0c\u6211\u4e00\u5b9a\u8981\u6362\u3002 \u5728class Config\u4e0b\u9762\u65b0\u589e\u5b50\u7c7b: class BodyType\uff1a \u6539\u9020Http\u8bf7\u6c42\u5ba2\u6237\u7aef \u7531\u4e8e\u6211\u4eec\u53d1json\u4e5f\u597d\uff0cform\u4e5f\u597d\uff0c\u6539\u53d8\u7684\u4e00\u822c\u662f\u8fd9\u4e2a\u65b9\u6cd5: \u7c7b\u4f3c\u8fd9\u6837\u7684\uff0c\u5982\u4eca\u6211\u4eec\u591a\u4e86\u4e00\u4e2a\u65b0\u7684\u53c2\u6570\uff0c\u6211\u6253\u7b97\u5c01\u88c5\u4e00\u4e2a\u65b0\u7684\u65b9\u6cd5\uff0c\u56e0\u4e3a\u8fd9\u5757http\u5728\u7ebf\u8bf7\u6c42\u9700\u8981\u7528\u5230\uff0c\u800ccase\u7684\u6267\u884c\u4e5f\u5f97\u7528\u5230\u3002 \u8bdd\u4e0d\u591a\u8bf4\uff0c\u6211\u4eec\u76f4\u63a5\u4e0a\u4ee3\u7801: \u8fd9\u8fb9\u666e\u901aform\u7684\u8bdd\uff0cdata\u63a5\u6536\u7684\u662f\u4e00\u4e2adict\uff0cjson\u7684\u8bdd\u91c7\u7528json\u53bb\u63a5\u6536\u6570\u636e\uff0c\u800c\u6587\u4ef6\u8fd9\u79cd\uff0c\u5219\u91c7\u7528FormData: \u7531\u4e8e\u6211\u4eec\u5b58\u50a8body\u91cc\u9762\u5e26\u6709oss\u7684\u6587\u4ef6\u4fe1\u606f\uff0c\u6211\u4eec\u9700\u8981\u5148\u89e3\u6790\u4e00\u4e0b\u6570\u636e\uff0c\u4e5f\u5c31\u662f\u5148\u53cd\u5e8f\u5217\u5316\uff0c\u63a5\u7740\u53d6\u5bf9\u5e94\u7684\u6587\u4ef6\u6216\u8005\u6587\u672c\uff0c\u7ec4\u6210FormData\u3002 \u8fd0\u884ccase\u76f8\u5173\u6539\u52a8 \u4e4b\u524d\u6211\u4eec\u6709\u4e3ajson\u7c7b\u578b\u8bf7\u6c42\u6dfb\u52a0header\u7684\u64cd\u4f5c\uff0c\u5982\u4eca\u90fd\u653e\u5230http client\u91cc\u9762\u53bb\u505a\u4e86\uff0c\u6240\u4ee5\u8fd9\u8fb9\u53ef\u4ee5\u7a0d\u5fae\u7b80\u5316\u4e0b\u3002 replace_body\u6539\u52a8 \u8fd9\u91cc\u9700\u8981\u7a0d\u5fae\u6539\u52a8\u4e0b\uff0c\u53ea\u6709json\u7c7b\u578b\u7684\u65f6\u5019\u624d\u66ff\u6362body\u7684\u6570\u636e\uff0c\u56e0\u4e3a\u76ee\u524d\u8fd9\u4e2a\u66ff\u6362\u53ea\u652f\u6301\u5b57\u5178\u7c7b\u578b\u3002 \u524d\u7aef\u90e8\u5206 \u524d\u7aef\u90e8\u5206\u6211\u5199\u7684\u592a\u70c2\u4e86\uff0c\u6709\u5174\u8da3\u53bb\u770b\u4e0b\u6e90\u7801\u5427\uff08\u6211\u81ea\u5df1\u90fd\u770b\u4e0d\u4e0b\u53bb\uff09\uff0c\u6d3b\u751f\u751f\u7684\u5c4e\u5c71\uff0c\u771f\u7684\u3002 \u4e0d\u8fc7\u6211\u8fd8\u662f\u5404\u79cd\u571f\u65b9\u6cd5\u7ed9\u89e3\u51b3\u4e86\uff0chttp\u90a3\u5757\u6211\u6253\u7b97\u5c31\u5230\u6b64\u4e3a\u6b62\u4e86\u3002 \u6211\u52a0\u4e86\u4e00\u4e2a\u53ef\u7f16\u8f91\u8868\u683c\u7684\u7ec4\u4ef6\uff0c\u8fd9\u4e2a\u4e0e\u4e4b\u524d\u7684\u6709\u4e0d\u540c\uff0c\u56e0\u4e3a\u8fd9\u4e2a\u7ec4\u4ef6\u9700\u8981\u6839\u636e\u9009\u62e9\u7684\u662fFILE\u8fd8\u662fTEXT\u6765\u51b3\u5b9aVALUE\u5355\u5143\u683c\u7684\u8f93\u5165\u63a7\u4ef6: \u8fd9\u91cc\u5207\u6362\u4e3a TEXT \u540e\uff0c\u53f3\u4fa7\u7684\u9009\u62e9\u6846\u4f1a\u53d8\u6210\u8f93\u5165\u6846\u3002 \u53ef\u4ee5\u770b\u5230\uff0c\u6211\u4eec\u8c03\u7528\u81ea\u5df1\u7684http\u4e0a\u4f20\u6587\u4ef6\u65b9\u6cd5(upload)\uff0c\u5b8c\u6210\u4e86\u6587\u4ef6\u4e0a\u4f20\u7684\u6d4b\u8bd5\u529f\u80fd\uff08\u5982\u679c\u80fd\u91cd\u6765\uff0c\u6211\u80af\u5b9a\u4e0d\u809d\u8fd9\u4e2a\uff0c\u592a\u7d2f\u4e86\uff0cbug\u5c0f\u738b\u5b50\u3002\uff09","title":"92.\u8ba9http\u8bf7\u6c42\u652f\u6301\u6587\u4ef6\u4e0a\u4f20"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2892%29%20%E8%AE%A9http%E8%AF%B7%E6%B1%82%E6%94%AF%E6%8C%81%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/#_1","text":"\u4e0a\u4e00\u8282\u5462\uff0c\u6211\u4eec\u7f16\u5199\u4e86oss\u7684\u5ba2\u6237\u7aef\u8fd9\u5757 \u5185\u5bb9 \u3002\u4f46\u5176\u5b9e\u6211\u4eec\u662f\u6709\u76ee\u7684\u7684\uff0c\u6211\u4eec\u77e5\u9053\uff0c\u6211\u4eec\u6709\u65f6\u5019\u6d4b\u8bd5\u4e00\u4e9b\u63a5\u53e3\uff0c\u6bd4\u65b9\u8bf4: \u6279\u91cf\u5bfc\u5165\u5546\u54c1 \uff0c\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u662f\u8981\u7ed9\u63a5\u53e3\u53d1\u9001\u4e00\u4e2a\u6587\u4ef6\uff08excel\u6216\u8005csv\uff09\u3002 \u90a3\u600e\u4e48\u4fdd\u7ba1\u6211\u4eec\u7684\u6d4b\u8bd5\u6570\u636e\u5462\uff0c\u90a3\u5c31\u8be5oss\u53d1\u6325\u5b83\u7684\u4f5c\u7528\u4e86\u3002\u4ee5\u5f80\u6211\u4eec\u505a\u6d4b\u8bd5\uff0c\u90fd\u4f1a\u653e\u4e00\u4e2a\u76ee\u5f55\u4fdd\u5b58\u6d4b\u8bd5\u6570\u636e\uff0c\u73b0\u5728\u53ea\u4e0d\u8fc7\u662f\u628a\u6570\u636e\u653e\u5230\u4e86oss\u4e4b\u4e2d\uff0c\u5176\u5b9e\u9053\u7406\u90fd\u4e00\u6837\u3002 \u4eca\u5929\u6211\u4eec\u5c31\u6765\u5b9e\u73b0http\u8bf7\u6c42\u652f\u6301oss\u6587\u4ef6\u4e0a\u4f20\u3002\u5728\u6b64\u4e4b\u524d\u6211\u4eec\u5148\u5f97\u4fee\u590d\u51e0\u4e2abug\uff08\u8fd8\u633a\u591a\u7684\uff0c\u4f46\u53ea\u5217\u4e00\u4e2a\u5178\u578b\uff09","title":"\u56de\u987e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2892%29%20%E8%AE%A9http%E8%AF%B7%E6%B1%82%E6%94%AF%E6%8C%81%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/#bug","text":"\u6ca1\u6709\u65ad\u8a00\u6570\u636e\u7684\u65f6\u5019\u62a5\u9519 \u9700\u89812\u4e2a\u8fd4\u56de\u503c\uff0c\u4f46\u662f\u54b1\u5728\u6ca1\u6709\u65ad\u8a00\u7684\u65f6\u5019\u53ea\u7ed9\u4e86\u4e00\u4e2a\uff0c\u5c5e\u5b9e\u9a6c\u864e\u3002","title":"bug\u8b66\u793a"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2892%29%20%E8%AE%A9http%E8%AF%B7%E6%B1%82%E6%94%AF%E6%8C%81%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/#_2","text":"","title":"\u6548\u679c\u56fe"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2892%29%20%E8%AE%A9http%E8%AF%B7%E6%B1%82%E6%94%AF%E6%8C%81%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/#_3","text":"\u6211\u4eec\u4e4b\u524d\u4e3a\u4e86\u56fe\u65b9\u4fbf\uff0c\u5728\u6709 body \u7684http\u8bf7\u6c42\u91cc\u9762\uff0c\u5f3a\u884c\u8ba9http\u8bf7\u6c42\u4e8c\u9009\u4e00: \u8981\u4e48json \u8981\u4e48form\u8868\u5355 \u9488\u5bf9\u8fd9\u6837\u6587\u4ef6\u7684\u5f62\u5f0f\uff0c\u5c31\u6ca1\u6cd5\u4e8c\u9009\u4e00\u4e86\uff0c\u6240\u4ee5\u6211\u4eec\u5fc5\u987b\u8981\u5b58\u50a8\u4e00\u4e2a\u5b57\u6bb5: body_type\uff0c\u8fd9\u4e2a\u5b57\u6bb5\u7528\u6765\u544a\u8bc9\u6211\u4eecbody\u662f\u4ec0\u4e48\u7c7b\u578b\u7684\uff0c\u4e5f\u5c31\u5bf9\u5e94\u8fd9\u91cc\u7684\u6570\u636e: 0\u4ee3\u8868none, 2\u4ee3\u8868form-data 1\u4ee3\u8868raw\uff08json\uff09 3\u4ee3\u8868x-www-form-urlencoded, \u540e\u7eed\u7684\u4f9d\u6b21\u6392\u5217\u3002 \u6240\u4ee5\u6211\u4eec\u8981\u53bb\u7528\u4f8b\u52a0\u4e2abody_type\uff0c\u5e76\u4e14\u9ed8\u8ba4\u4e3a1\uff08\u56e0\u4e3a\u76ee\u524d\u6211\u4eec\u7684\u63a5\u53e3\u7c7b\u578b\u5927\u90e8\u5206json\u7684\uff09. \u63a5\u7740\u6211\u4eec\u5728http\u8bf7\u6c42\u7684\u65f6\u5019\uff0c\u6839\u636e\u4e0d\u540c\u7684\u6570\u636e\u7c7b\u578b\u8fd4\u56de\u4e0d\u540c\u7684body\u5373\u53ef\u3002","title":"\u601d\u8def"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2892%29%20%E8%AE%A9http%E8%AF%B7%E6%B1%82%E6%94%AF%E6%8C%81%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/#body_type","text":"\u4fee\u6539app/models/test_case.py\uff0c\u65b0\u589ebody_type\u5b57\u6bb5\uff0c\u4fee\u6539\u5904\u6211\u5df2\u7ecf\u7ea2\u6846\u6807\u6ce8\u3002","title":"\u65b0\u589e\u5b57\u6bb5body_type"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2892%29%20%E8%AE%A9http%E8%AF%B7%E6%B1%82%E6%94%AF%E6%8C%81%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/#pydantic","text":"\u4e4b\u524d\u6211\u4eec\u7684schema\u6570\u636e\u90fd\u5b58\u653e\u5728router\u4e0b\u9762\uff0c\u540e\u6765\u5b58\u5728\u4e00\u4e9b\u5faa\u73af\u5f15\u5165\u95ee\u9898\u3002\u6240\u4ee5\u6211\u628a\u8bf7\u6c42\u5165\u53c2\u8fd9\u4e9b\u6570\u636e\u90fd\u653e\u5230\u4e86models\u4e0b\u9762\uff0c\u7279\u6b64\u8bf4\u660e\u4e00\u4e0b\u3002","title":"\u8c03\u6574pydantic"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2892%29%20%E8%AE%A9http%E8%AF%B7%E6%B1%82%E6%94%AF%E6%8C%81%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/#_4","text":"\u4ee5\u5f80\u554a\uff0c\u6211\u4eec\u5f88\u559c\u6b22\u51991\uff0c2\uff0c3\uff0c4: if case_type == 1 : \u8fd9\u79cd\u4ee3\u7801\uff0c\u4f46\u5176\u5b9e\u8fd9\u79cd\u4e1c\u897f\u5b8c\u5168\u53ef\u4ee5\u653e\u5230config\u91cc\u9762\uff0c\u8fd9\u6837\u7684\u8bdd\u6211\u4eec\u5982\u679c\u8981\u53d8\u6362\u5bf9\u5e94\u7684\u89c4\u5219\uff0c\u5c31\u5f88\u65b9\u4fbf\uff0c\u800c\u4e14\u770b1\uff0c2\uff0c3\uff0c4\u8fd8\u4e0d\u597d\u56de\u5fc6\u8fd9\u662f\u4ec0\u4e48\u7c7b\u578b\u3002 \u4eca\u6b21\uff0c\u6211\u4e00\u5b9a\u8981\u6362\u3002 \u5728class Config\u4e0b\u9762\u65b0\u589e\u5b50\u7c7b: class BodyType\uff1a","title":"\u6dfb\u52a0\u914d\u7f6e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2892%29%20%E8%AE%A9http%E8%AF%B7%E6%B1%82%E6%94%AF%E6%8C%81%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/#http","text":"\u7531\u4e8e\u6211\u4eec\u53d1json\u4e5f\u597d\uff0cform\u4e5f\u597d\uff0c\u6539\u53d8\u7684\u4e00\u822c\u662f\u8fd9\u4e2a\u65b9\u6cd5: \u7c7b\u4f3c\u8fd9\u6837\u7684\uff0c\u5982\u4eca\u6211\u4eec\u591a\u4e86\u4e00\u4e2a\u65b0\u7684\u53c2\u6570\uff0c\u6211\u6253\u7b97\u5c01\u88c5\u4e00\u4e2a\u65b0\u7684\u65b9\u6cd5\uff0c\u56e0\u4e3a\u8fd9\u5757http\u5728\u7ebf\u8bf7\u6c42\u9700\u8981\u7528\u5230\uff0c\u800ccase\u7684\u6267\u884c\u4e5f\u5f97\u7528\u5230\u3002 \u8bdd\u4e0d\u591a\u8bf4\uff0c\u6211\u4eec\u76f4\u63a5\u4e0a\u4ee3\u7801: \u8fd9\u8fb9\u666e\u901aform\u7684\u8bdd\uff0cdata\u63a5\u6536\u7684\u662f\u4e00\u4e2adict\uff0cjson\u7684\u8bdd\u91c7\u7528json\u53bb\u63a5\u6536\u6570\u636e\uff0c\u800c\u6587\u4ef6\u8fd9\u79cd\uff0c\u5219\u91c7\u7528FormData: \u7531\u4e8e\u6211\u4eec\u5b58\u50a8body\u91cc\u9762\u5e26\u6709oss\u7684\u6587\u4ef6\u4fe1\u606f\uff0c\u6211\u4eec\u9700\u8981\u5148\u89e3\u6790\u4e00\u4e0b\u6570\u636e\uff0c\u4e5f\u5c31\u662f\u5148\u53cd\u5e8f\u5217\u5316\uff0c\u63a5\u7740\u53d6\u5bf9\u5e94\u7684\u6587\u4ef6\u6216\u8005\u6587\u672c\uff0c\u7ec4\u6210FormData\u3002 \u8fd0\u884ccase\u76f8\u5173\u6539\u52a8 \u4e4b\u524d\u6211\u4eec\u6709\u4e3ajson\u7c7b\u578b\u8bf7\u6c42\u6dfb\u52a0header\u7684\u64cd\u4f5c\uff0c\u5982\u4eca\u90fd\u653e\u5230http client\u91cc\u9762\u53bb\u505a\u4e86\uff0c\u6240\u4ee5\u8fd9\u8fb9\u53ef\u4ee5\u7a0d\u5fae\u7b80\u5316\u4e0b\u3002 replace_body\u6539\u52a8 \u8fd9\u91cc\u9700\u8981\u7a0d\u5fae\u6539\u52a8\u4e0b\uff0c\u53ea\u6709json\u7c7b\u578b\u7684\u65f6\u5019\u624d\u66ff\u6362body\u7684\u6570\u636e\uff0c\u56e0\u4e3a\u76ee\u524d\u8fd9\u4e2a\u66ff\u6362\u53ea\u652f\u6301\u5b57\u5178\u7c7b\u578b\u3002","title":"\u6539\u9020Http\u8bf7\u6c42\u5ba2\u6237\u7aef"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2892%29%20%E8%AE%A9http%E8%AF%B7%E6%B1%82%E6%94%AF%E6%8C%81%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/#_5","text":"\u524d\u7aef\u90e8\u5206\u6211\u5199\u7684\u592a\u70c2\u4e86\uff0c\u6709\u5174\u8da3\u53bb\u770b\u4e0b\u6e90\u7801\u5427\uff08\u6211\u81ea\u5df1\u90fd\u770b\u4e0d\u4e0b\u53bb\uff09\uff0c\u6d3b\u751f\u751f\u7684\u5c4e\u5c71\uff0c\u771f\u7684\u3002 \u4e0d\u8fc7\u6211\u8fd8\u662f\u5404\u79cd\u571f\u65b9\u6cd5\u7ed9\u89e3\u51b3\u4e86\uff0chttp\u90a3\u5757\u6211\u6253\u7b97\u5c31\u5230\u6b64\u4e3a\u6b62\u4e86\u3002 \u6211\u52a0\u4e86\u4e00\u4e2a\u53ef\u7f16\u8f91\u8868\u683c\u7684\u7ec4\u4ef6\uff0c\u8fd9\u4e2a\u4e0e\u4e4b\u524d\u7684\u6709\u4e0d\u540c\uff0c\u56e0\u4e3a\u8fd9\u4e2a\u7ec4\u4ef6\u9700\u8981\u6839\u636e\u9009\u62e9\u7684\u662fFILE\u8fd8\u662fTEXT\u6765\u51b3\u5b9aVALUE\u5355\u5143\u683c\u7684\u8f93\u5165\u63a7\u4ef6: \u8fd9\u91cc\u5207\u6362\u4e3a TEXT \u540e\uff0c\u53f3\u4fa7\u7684\u9009\u62e9\u6846\u4f1a\u53d8\u6210\u8f93\u5165\u6846\u3002 \u53ef\u4ee5\u770b\u5230\uff0c\u6211\u4eec\u8c03\u7528\u81ea\u5df1\u7684http\u4e0a\u4f20\u6587\u4ef6\u65b9\u6cd5(upload)\uff0c\u5b8c\u6210\u4e86\u6587\u4ef6\u4e0a\u4f20\u7684\u6d4b\u8bd5\u529f\u80fd\uff08\u5982\u679c\u80fd\u91cd\u6765\uff0c\u6211\u80af\u5b9a\u4e0d\u809d\u8fd9\u4e2a\uff0c\u592a\u7d2f\u4e86\uff0cbug\u5c0f\u738b\u5b50\u3002\uff09","title":"\u524d\u7aef\u90e8\u5206"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2893%29%20%E5%85%8D%E8%B4%B9%E7%9A%84gitee%E5%BD%93oss%E7%9C%9F%E7%9A%84%E9%A6%99%E5%90%97/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u628aoss\u8fd0\u7528\u5230\u4e86 \u5b9e\u6218\u4e4b\u4e2d \uff0c\u5e76\u4e14\u5b8c\u6210\u4e86http\u8bf7\u6c42\u652f\u6301\u6587\u4ef6\u4e0a\u4f20\u7684\u9700\u6c42\u3002\u7531\u4e8e\u4e0b\u4e00\u8282\u7684\u5185\u5bb9\u6211\u8fd8\u6ca1\u6709\u60f3\u597d\uff0c\u60f3\u7740\u5148\u628a\u514d\u8d39\u7684 gitee oss\u641e\u5b9a\u518d\u8bf4\u3002 \u4f46\u5728\u7f16\u5199\u4ee3\u7801\u7684\u8fc7\u7a0b\u4e2d\u53d1\u73b0\u8bb8\u591a\u95ee\u9898\u6216\u8005\u8bf4 \u5751 \uff0c\u8ba9\u6211\u6709\u4e9b\u6000\u7591\u8fd9\u5757\u662f\u4e0d\u662f\u8be5\u6536\u624b\u4e86\u3002 \u4e86\u89e3gitee api gitee\u8fd9\u6837\u76f8\u5bf9\u6bd4\u8f83\u5927\u7684\u5e73\u53f0\uff0c\u4e00\u822c\u90fd\u4f1a\u5bf9\u5916\u63d0\u4f9bapi\u64cd\u4f5c\u5bf9\u5e94\u7684\u4ed3\u5e93\u6570\u636e\u3002 \u4ed6\u4eec\u7684\u6587\u6863\u5730\u5740: https://gitee.com/api/v5/swagger#/getV5ReposOwnerRepoStargazers?ex=no \u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c\u5b83\u7684api\u751a\u81f3\u90fd\u5df2\u7ecf\u662f\u7b2c\u4e94\u4e2a\u7248\u672c\u4e86\uff08v5\u4ee3\u8868\u7684\u662fapi\u7684\u7248\u672c\uff09\u3002 \u6240\u6709\u7684api\u90fd\u53ef\u4ee5\u4ece\u8fd9\u4e2a\u7f51\u7ad9\u67e5\u8be2\u5230\uff0c\u8bdd\u4e0d\u591a\u8bf4\uff0c\u6211\u4eec\u8d76\u7d27\u627e\u627e\u81ea\u5df1\u60f3\u8981\u7684api: \u67e5\u8be2\u4ed3\u5e93\u7684\u6587\u4ef6 \uff0c \u4e0b\u8f7d\u6587\u4ef6 , \u65b0\u589e\u6587\u4ef6 , \u5220\u9664\u6587\u4ef6 \u3002 \u627e\u4e86\u4e00\u5708\u5374\u53d1\u73b0\uff0c gitee\u6ca1\u6709\u63d0\u4f9b\u7c7b\u4f3cos.walk\u6216\u8005\u80fd\u591f\u83b7\u53d6\u5230\u6240\u6709\u76ee\u5f55/\u6587\u4ef6\u7684api\uff0c\u53ea\u6709\u4e0b\u9762\u8fd9\u79cd: \u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u6211\u4eec\u662f \u6df1\u5c42\u6b21\u76ee\u5f55 \uff0c\u53ef\u80fd\u8981 \u4e0d\u65ad\u904d\u5386 \u4e0b\u53bb\u3002 \u4f46\u5982\u679c\u6211\u4eec\u9650\u5236\u4e0b\u7528\u6237\u4f7f\u7528\u7684\u65f6\u5019\uff0c\u4e0d\u5d4c\u5957\u90a3\u4e48\u591a\u76ee\u5f55\uff0c\u5e94\u8be5\u4e5f \u8fd8\u80fd\u51d1\u5408\u7528 \uff0c\u6bd5\u7adf\u6ca1\u6709\u4ec0\u4e48\u6bd4\u514d\u8d39\u66f4\u9999\u4e86\u3002 \u7f16\u5199\u5ba2\u6237\u7aef\u83b7\u53d6\u90e8\u5206 \u7814\u7a76\u4e0bgitee\u914d\u7f6e\u548caliyun\u7684\u4e0d\u540c \u5728gitee\u91cc\u9762\uff0c\u53ea\u75283\u4e2a\u6570\u636e\u5c31\u80fd\u786e\u5b9a\u4e00\u4e2a\u9879\u76ee: access_token(\u7528\u6765\u5224\u65ad\u4f60\u662f\u54ea\u4e2a\u7528\u6237) repo(\u4ed3\u5e93) owner(\u7528\u6237) \u6240\u4ee5\u6211\u4eec\u628aendpoint\u8fd9\u4e2a\u7f6e\u7a7a\uff0c\u6bd5\u7adf\u7528\u4e0d\u5230\uff0c\u5176\u4ed6\u7684\u4e00\u6b21\u4e3a access_token , owner \u548c repo \u3002 \u6539\u5199oss\u83b7\u53d6\u5ba2\u6237\u7aef\u7684\u65b9\u6cd5 \u5982\u679c\u7c7b\u578b\u662fGITEE\uff0c\u5219\u8fd4\u56deGiteeOss\uff0c\u5f53\u7136\u6b64\u65f6GiteeOss\u91cc\u9762\u5177\u4f53\u7684\u65b9\u6cd5\u8fd8\u6ca1\u6709\u5b9e\u73b0\u3002 \u6ce8\u610f\u8fd9\u91cc\u6211\u5728Config\u91cc\u5934\u52a0\u5165\u4e86GITEE\u548cALIYUN\u53d8\u91cf\uff0c\u5982\u679c\u62a5\u627e\u4e0d\u5230\u53d8\u91cf\u7684\u9519\uff0c\u662f\u56e0\u4e3a\u6211\u5c01\u88c5\u4e86\u4e00\u4e0b\uff0c\u5e0c\u671b\u5927\u5bb6\u80fd\u591f\u81ea\u5df1\u53d1\u73b0\u3002 \u7531\u4e8e\u6559\u7a0b\u4e0d\u662f\u7eaf\u65b0\u624b\u6559\u7a0b\uff0c\u5728 \u53d1\u73b0\u6211\u7559\u7684\u5751 \u6216\u8005 \u4ee3\u7801\u6084\u6084\u6539\u52a8 \u7684\u65f6\u5019\uff0c\u4e5f\u662f\u5927\u5bb6\u8fdb\u6b65\u7684\u65f6\u5019\uff0c\u56e0\u4e3a\u4e0d\u9700\u8981\u4f5c\u4e1a\uff0c\u5929\u7136\u7ed9\u4f60\u7559\u4e86\u4f5c\u4e1a\u3002\uff08\u673a\u667a\u7684\u6211\uff09 \u5b9e\u73b0GiteeOss\u4e2d\u7684\u65b9\u6cd5 \u521d\u59cb\u5316\u65b9\u6cd5 \u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0c\u6211\u8bbe\u7f6e\u4e86\u4e2abase_path\uff0c\u662f\u4e3a\u4e86\u80fd\u591f\u628apity\u641e\u7684oss\u6587\u4ef6\u5168\u90e8\u653e\u5165pity\u6587\u4ef6\u5939\u3002\u5176\u4ed6\u7684\u5c31\u662fgitee\u7684\u57fa\u7840api\u5730\u5740\u3002 \u521b\u5efa\u6587\u4ef6 @aioify async def create_file ( self , filepath : str , content : bytes ): gitee_url = self . _base_url . format ( self . user , self . repo , self . _base_path , filepath ) data = base64 . b64encode ( content ) . decode () json_data = { \"access_token\" : self . token , \"message\" : \"pity create file\" , \"content\" : data } r = requests . post ( url = gitee_url , json = json_data ) if r . status_code == 400 : raise Exception ( \"\u6587\u4ef6\u91cd\u590d\uff0c\u8bf7\u5148\u5220\u9664\u65e7\u6587\u4ef6\" ) if r . status_code != 201 : raise Exception ( \"\u4e0a\u4f20\u6587\u4ef6\u5230gitee\u5931\u8d25\" ) \u6ce8\u610f\u8fd9\u91cc\u6709\u4e2a aioify \u88c5\u9970\u5668\uff0c\u8fd9\u9700\u8981\u989d\u5916\u5b89\u88c5aioify\u5305\uff0c\u7136\u540e\u8fd9\u4e2a\u65b9\u6cd5\u5c31\u80fd\u88ab \u5f02\u6b65\u6267\u884c \uff0c\u8fd8\u662f\u633a\u597d\u7528\u7684\u3002 \u5176\u5b9e\u6ca1\u6709\u5f88\u590d\u6742\u7684\u5185\u5bb9\uff0c\u5c31\u662f\u8c03\u7528gitee api\u7684\u63a5\u53e3\uff0c\u53bb\u4e0a\u4f20\u6587\u4ef6\uff0c\u5982\u679chttp\u72b6\u6001\u7801\u662f400\u8bf4\u660e\u6587\u4ef6\u91cd\u590d\uff0c201\u8bf4\u660e\u6210\u529f\uff08\u867d\u7136\u6211\u4e5f\u5f88 \u7eb3\u95f7 \u4e3a\u4ec0\u4e48\u4e0d\u662f 200 \uff09\u3002 \u5220\u9664\u6587\u4ef6 @aioify async def delete_file ( self , filepath : str ): filepath , sha = filepath . split ( \"$\" ) gitee_url = self . _base_url . format ( self . user , self . repo , self . _base_path , filepath ) r = requests . delete ( gitee_url , params = dict ( access_token = self . token , message = \"delete file\" , sha = sha )) if r . status_code != 200 : raise Exception ( \"\u522a\u9664\u6587\u4ef6\u5931\u8d25\" ) \u83b7\u53d6\u6587\u4ef6\u5217\u8868 @aioify async def list_file ( self ): ans = list () await self . query_file_by_path ( \"\" , ans ) return ans @aioify async def query_file_by_path ( self , filepath : str , ans : List [ dict ]): gitee_url = self . _base_url . format ( self . user , self . repo , self . _base_path , filepath ) r = requests . get ( gitee_url , params = dict ( access_token = self . token )) file_list = r . json () for f in file_list : if f . get ( \"type\" ) == \"file\" : ans . append ( dict ( key = f . get ( 'path' )[ 5 :], download_url = f . get ( \"download_url\" ), size = 0 , sha = f . get ( \"sha\" ), last_modified = None , type = 'gitee' )) continue await self . query_file_by_path ( f \" { filepath } / { f . get ( 'name' ) } \" , ans ) \u8fd9\u8fb9\u9996\u5148\u83b7\u53d6 \u6839\u76ee\u5f55 \u4e0b\u7684\u6240\u6709\u6587\u4ef6\uff0c\u63a5\u7740\u5224\u65ad\u6587\u4ef6\u5217\u8868\uff0c\u5982\u679c\u662f\u76ee\u5f55\u5219\u7ee7\u7eed\u83b7\u53d6\u8be5\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\uff0c\u5426\u5219\u628a\u6587\u4ef6\u6570\u636e\u653e\u5165 ans \uff0c\u6700\u7ec8\u8fd4\u56deans\u5373\u53ef\u3002 \u8981\u6ce8\u610f\u7684\u662f\uff0cgitee\u7684\u6587\u4ef6\u4e0b\u8f7d\u9700\u8981\u7528\u5230 sha \u5b57\u6bb5\uff0c\u800c\u4e14gitee\u4e0d\u652f\u6301\u67e5\u770b \u6700\u540e\u7f16\u8f91\u65f6\u95f4 \u548c \u6587\u4ef6\u5927\u5c0f \uff0c\u8fd92\u70b9\u4e5f\u662f\u9e21\u808b\u7684\u70b9\u3002 \u4e0b\u8f7d\u6587\u4ef6 \u5927\u5bb6\u53ef\u4ee5\u770b\u770b\u8c03\u7528\u4e0b\u8f7d\u76ee\u5f55\u540e\uff0c\u8fd4\u56de\u7684data\u6570\u636e\u3002\u6211\u8fd9\u91cc\u7b80\u5355\u8bb2\u4e0b\uff0c\u4ed6\u5176\u5b9e\u662f\u4e00\u4e2ajson\uff0c\u5e76\u4e0d\u662f\u6587\u4ef6\u6d41\u3002 { \"content\" : \"\u6587\u4ef6base64\u7f16\u7801\u7684byte\u5b57\u7b26\u4e32\" , \"size\" : \"\u6587\u4ef6\u5927\u5c0f\" } \u6240\u4ee5\u6211\u4eec\u53d6\u51fa\u6765\u6570\u636e\u540e\u8981\u7ee7\u7eed\u7528base64decode\uff0c\u6700\u540e\u5199\u5165\u6211\u4eec\u751f\u6210\u7684\u4e34\u65f6\u6587\u4ef6\uff0c\u901a\u8fc7fastapi\u7684FileResponse\u63d0\u4f9b\u4e0b\u8f7d\u529f\u80fd\u3002 \u603b\u7ed3 gitee\u6700\u5927\u7279\u70b9\u5c31\u662f\u514d\u8d39\uff0c\u4f5c\u4e3aoss\u5b9e\u5728\u662f\u4e0d\u65b9\u4fbf\uff0c\u4f5c\u4e3a\u56fe\u5e8a\u5012\u662f\u4e0d\u9519\uff0c\u76ee\u524d\u4e5f\u6ca1\u6709 \u9632\u76d7\u94fe \u8fd9\u4e00\u8bf4\u3002 \u83b7\u53d6\u6587\u4ef6\u4e0d\u65b9\u4fbf \u4e0d\u80fd\u83b7\u53d6\u6587\u4ef6\u5927\u5c0f\uff0c\u9664\u975e\u4f60\u4e0b\u8f7d\u6587\u4ef6 \u6ca1\u6709\u66f4\u65b0\u65f6\u95f4 \u6240\u4ee5\u6700\u540e\u54b1\u4eecoss\u7684\u7ba1\u7406\u9875\u9762\u957f\u8fd9\u6837: \u4f46\u5176\u5b9e\u662f\u6211\u4eec\u5077\u61d2\uff0c\u5982\u679c\u5728\u6587\u4ef6\u4e0a\u4f20\u7684\u65f6\u5019\u6211\u4eec \u8bb0\u5f55\u4e00\u4efd\u6587\u4ef6\u76f8\u5173\u6570\u636e \u5230\u672c\u5730\uff0c\u90a3\u8fd9\u4e9b\u90fd\u4e0d\u662f\u95ee\u9898\u3002\u90a3\u5e94\u8be5\u8fd8\u662f\u9999\u7684\u5427\uff01\uff08\u4f46\u53c8\u53ef\u80fd\u5b58\u5728\u6570\u636e\u4e0d\u540c\u6b65\u95ee\u9898\uff09 \u600e\u4e48\u8bf4\u5462\uff0c\u4e00\u5f00\u59cb\u662f\u61d2\uff0c\u770b\u6765\u8fd8\u662f\u4ed8\u51fa\u4ee3\u4ef7\u4e86~\u8fd9\u4e2a\u5751\u5148\u653e\u7740\uff0c\u4ee5\u540e\u518d\u586b\u5427~","title":"93.\u514d\u8d39\u7684gitee\u5f53oss\u771f\u7684\u9999\u5417"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2893%29%20%E5%85%8D%E8%B4%B9%E7%9A%84gitee%E5%BD%93oss%E7%9C%9F%E7%9A%84%E9%A6%99%E5%90%97/#_1","text":"\u4e0a\u4e00\u8282\u6211\u4eec\u628aoss\u8fd0\u7528\u5230\u4e86 \u5b9e\u6218\u4e4b\u4e2d \uff0c\u5e76\u4e14\u5b8c\u6210\u4e86http\u8bf7\u6c42\u652f\u6301\u6587\u4ef6\u4e0a\u4f20\u7684\u9700\u6c42\u3002\u7531\u4e8e\u4e0b\u4e00\u8282\u7684\u5185\u5bb9\u6211\u8fd8\u6ca1\u6709\u60f3\u597d\uff0c\u60f3\u7740\u5148\u628a\u514d\u8d39\u7684 gitee oss\u641e\u5b9a\u518d\u8bf4\u3002 \u4f46\u5728\u7f16\u5199\u4ee3\u7801\u7684\u8fc7\u7a0b\u4e2d\u53d1\u73b0\u8bb8\u591a\u95ee\u9898\u6216\u8005\u8bf4 \u5751 \uff0c\u8ba9\u6211\u6709\u4e9b\u6000\u7591\u8fd9\u5757\u662f\u4e0d\u662f\u8be5\u6536\u624b\u4e86\u3002","title":"\u56de\u987e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2893%29%20%E5%85%8D%E8%B4%B9%E7%9A%84gitee%E5%BD%93oss%E7%9C%9F%E7%9A%84%E9%A6%99%E5%90%97/#gitee-api","text":"gitee\u8fd9\u6837\u76f8\u5bf9\u6bd4\u8f83\u5927\u7684\u5e73\u53f0\uff0c\u4e00\u822c\u90fd\u4f1a\u5bf9\u5916\u63d0\u4f9bapi\u64cd\u4f5c\u5bf9\u5e94\u7684\u4ed3\u5e93\u6570\u636e\u3002 \u4ed6\u4eec\u7684\u6587\u6863\u5730\u5740: https://gitee.com/api/v5/swagger#/getV5ReposOwnerRepoStargazers?ex=no \u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c\u5b83\u7684api\u751a\u81f3\u90fd\u5df2\u7ecf\u662f\u7b2c\u4e94\u4e2a\u7248\u672c\u4e86\uff08v5\u4ee3\u8868\u7684\u662fapi\u7684\u7248\u672c\uff09\u3002 \u6240\u6709\u7684api\u90fd\u53ef\u4ee5\u4ece\u8fd9\u4e2a\u7f51\u7ad9\u67e5\u8be2\u5230\uff0c\u8bdd\u4e0d\u591a\u8bf4\uff0c\u6211\u4eec\u8d76\u7d27\u627e\u627e\u81ea\u5df1\u60f3\u8981\u7684api: \u67e5\u8be2\u4ed3\u5e93\u7684\u6587\u4ef6 \uff0c \u4e0b\u8f7d\u6587\u4ef6 , \u65b0\u589e\u6587\u4ef6 , \u5220\u9664\u6587\u4ef6 \u3002 \u627e\u4e86\u4e00\u5708\u5374\u53d1\u73b0\uff0c gitee\u6ca1\u6709\u63d0\u4f9b\u7c7b\u4f3cos.walk\u6216\u8005\u80fd\u591f\u83b7\u53d6\u5230\u6240\u6709\u76ee\u5f55/\u6587\u4ef6\u7684api\uff0c\u53ea\u6709\u4e0b\u9762\u8fd9\u79cd: \u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u6211\u4eec\u662f \u6df1\u5c42\u6b21\u76ee\u5f55 \uff0c\u53ef\u80fd\u8981 \u4e0d\u65ad\u904d\u5386 \u4e0b\u53bb\u3002 \u4f46\u5982\u679c\u6211\u4eec\u9650\u5236\u4e0b\u7528\u6237\u4f7f\u7528\u7684\u65f6\u5019\uff0c\u4e0d\u5d4c\u5957\u90a3\u4e48\u591a\u76ee\u5f55\uff0c\u5e94\u8be5\u4e5f \u8fd8\u80fd\u51d1\u5408\u7528 \uff0c\u6bd5\u7adf\u6ca1\u6709\u4ec0\u4e48\u6bd4\u514d\u8d39\u66f4\u9999\u4e86\u3002","title":"\u4e86\u89e3gitee api"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2893%29%20%E5%85%8D%E8%B4%B9%E7%9A%84gitee%E5%BD%93oss%E7%9C%9F%E7%9A%84%E9%A6%99%E5%90%97/#_2","text":"\u7814\u7a76\u4e0bgitee\u914d\u7f6e\u548caliyun\u7684\u4e0d\u540c \u5728gitee\u91cc\u9762\uff0c\u53ea\u75283\u4e2a\u6570\u636e\u5c31\u80fd\u786e\u5b9a\u4e00\u4e2a\u9879\u76ee: access_token(\u7528\u6765\u5224\u65ad\u4f60\u662f\u54ea\u4e2a\u7528\u6237) repo(\u4ed3\u5e93) owner(\u7528\u6237) \u6240\u4ee5\u6211\u4eec\u628aendpoint\u8fd9\u4e2a\u7f6e\u7a7a\uff0c\u6bd5\u7adf\u7528\u4e0d\u5230\uff0c\u5176\u4ed6\u7684\u4e00\u6b21\u4e3a access_token , owner \u548c repo \u3002 \u6539\u5199oss\u83b7\u53d6\u5ba2\u6237\u7aef\u7684\u65b9\u6cd5 \u5982\u679c\u7c7b\u578b\u662fGITEE\uff0c\u5219\u8fd4\u56deGiteeOss\uff0c\u5f53\u7136\u6b64\u65f6GiteeOss\u91cc\u9762\u5177\u4f53\u7684\u65b9\u6cd5\u8fd8\u6ca1\u6709\u5b9e\u73b0\u3002 \u6ce8\u610f\u8fd9\u91cc\u6211\u5728Config\u91cc\u5934\u52a0\u5165\u4e86GITEE\u548cALIYUN\u53d8\u91cf\uff0c\u5982\u679c\u62a5\u627e\u4e0d\u5230\u53d8\u91cf\u7684\u9519\uff0c\u662f\u56e0\u4e3a\u6211\u5c01\u88c5\u4e86\u4e00\u4e0b\uff0c\u5e0c\u671b\u5927\u5bb6\u80fd\u591f\u81ea\u5df1\u53d1\u73b0\u3002 \u7531\u4e8e\u6559\u7a0b\u4e0d\u662f\u7eaf\u65b0\u624b\u6559\u7a0b\uff0c\u5728 \u53d1\u73b0\u6211\u7559\u7684\u5751 \u6216\u8005 \u4ee3\u7801\u6084\u6084\u6539\u52a8 \u7684\u65f6\u5019\uff0c\u4e5f\u662f\u5927\u5bb6\u8fdb\u6b65\u7684\u65f6\u5019\uff0c\u56e0\u4e3a\u4e0d\u9700\u8981\u4f5c\u4e1a\uff0c\u5929\u7136\u7ed9\u4f60\u7559\u4e86\u4f5c\u4e1a\u3002\uff08\u673a\u667a\u7684\u6211\uff09","title":"\u7f16\u5199\u5ba2\u6237\u7aef\u83b7\u53d6\u90e8\u5206"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2893%29%20%E5%85%8D%E8%B4%B9%E7%9A%84gitee%E5%BD%93oss%E7%9C%9F%E7%9A%84%E9%A6%99%E5%90%97/#giteeoss","text":"\u521d\u59cb\u5316\u65b9\u6cd5 \u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0c\u6211\u8bbe\u7f6e\u4e86\u4e2abase_path\uff0c\u662f\u4e3a\u4e86\u80fd\u591f\u628apity\u641e\u7684oss\u6587\u4ef6\u5168\u90e8\u653e\u5165pity\u6587\u4ef6\u5939\u3002\u5176\u4ed6\u7684\u5c31\u662fgitee\u7684\u57fa\u7840api\u5730\u5740\u3002 \u521b\u5efa\u6587\u4ef6 @aioify async def create_file ( self , filepath : str , content : bytes ): gitee_url = self . _base_url . format ( self . user , self . repo , self . _base_path , filepath ) data = base64 . b64encode ( content ) . decode () json_data = { \"access_token\" : self . token , \"message\" : \"pity create file\" , \"content\" : data } r = requests . post ( url = gitee_url , json = json_data ) if r . status_code == 400 : raise Exception ( \"\u6587\u4ef6\u91cd\u590d\uff0c\u8bf7\u5148\u5220\u9664\u65e7\u6587\u4ef6\" ) if r . status_code != 201 : raise Exception ( \"\u4e0a\u4f20\u6587\u4ef6\u5230gitee\u5931\u8d25\" ) \u6ce8\u610f\u8fd9\u91cc\u6709\u4e2a aioify \u88c5\u9970\u5668\uff0c\u8fd9\u9700\u8981\u989d\u5916\u5b89\u88c5aioify\u5305\uff0c\u7136\u540e\u8fd9\u4e2a\u65b9\u6cd5\u5c31\u80fd\u88ab \u5f02\u6b65\u6267\u884c \uff0c\u8fd8\u662f\u633a\u597d\u7528\u7684\u3002 \u5176\u5b9e\u6ca1\u6709\u5f88\u590d\u6742\u7684\u5185\u5bb9\uff0c\u5c31\u662f\u8c03\u7528gitee api\u7684\u63a5\u53e3\uff0c\u53bb\u4e0a\u4f20\u6587\u4ef6\uff0c\u5982\u679chttp\u72b6\u6001\u7801\u662f400\u8bf4\u660e\u6587\u4ef6\u91cd\u590d\uff0c201\u8bf4\u660e\u6210\u529f\uff08\u867d\u7136\u6211\u4e5f\u5f88 \u7eb3\u95f7 \u4e3a\u4ec0\u4e48\u4e0d\u662f 200 \uff09\u3002 \u5220\u9664\u6587\u4ef6 @aioify async def delete_file ( self , filepath : str ): filepath , sha = filepath . split ( \"$\" ) gitee_url = self . _base_url . format ( self . user , self . repo , self . _base_path , filepath ) r = requests . delete ( gitee_url , params = dict ( access_token = self . token , message = \"delete file\" , sha = sha )) if r . status_code != 200 : raise Exception ( \"\u522a\u9664\u6587\u4ef6\u5931\u8d25\" ) \u83b7\u53d6\u6587\u4ef6\u5217\u8868 @aioify async def list_file ( self ): ans = list () await self . query_file_by_path ( \"\" , ans ) return ans @aioify async def query_file_by_path ( self , filepath : str , ans : List [ dict ]): gitee_url = self . _base_url . format ( self . user , self . repo , self . _base_path , filepath ) r = requests . get ( gitee_url , params = dict ( access_token = self . token )) file_list = r . json () for f in file_list : if f . get ( \"type\" ) == \"file\" : ans . append ( dict ( key = f . get ( 'path' )[ 5 :], download_url = f . get ( \"download_url\" ), size = 0 , sha = f . get ( \"sha\" ), last_modified = None , type = 'gitee' )) continue await self . query_file_by_path ( f \" { filepath } / { f . get ( 'name' ) } \" , ans ) \u8fd9\u8fb9\u9996\u5148\u83b7\u53d6 \u6839\u76ee\u5f55 \u4e0b\u7684\u6240\u6709\u6587\u4ef6\uff0c\u63a5\u7740\u5224\u65ad\u6587\u4ef6\u5217\u8868\uff0c\u5982\u679c\u662f\u76ee\u5f55\u5219\u7ee7\u7eed\u83b7\u53d6\u8be5\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\uff0c\u5426\u5219\u628a\u6587\u4ef6\u6570\u636e\u653e\u5165 ans \uff0c\u6700\u7ec8\u8fd4\u56deans\u5373\u53ef\u3002 \u8981\u6ce8\u610f\u7684\u662f\uff0cgitee\u7684\u6587\u4ef6\u4e0b\u8f7d\u9700\u8981\u7528\u5230 sha \u5b57\u6bb5\uff0c\u800c\u4e14gitee\u4e0d\u652f\u6301\u67e5\u770b \u6700\u540e\u7f16\u8f91\u65f6\u95f4 \u548c \u6587\u4ef6\u5927\u5c0f \uff0c\u8fd92\u70b9\u4e5f\u662f\u9e21\u808b\u7684\u70b9\u3002 \u4e0b\u8f7d\u6587\u4ef6 \u5927\u5bb6\u53ef\u4ee5\u770b\u770b\u8c03\u7528\u4e0b\u8f7d\u76ee\u5f55\u540e\uff0c\u8fd4\u56de\u7684data\u6570\u636e\u3002\u6211\u8fd9\u91cc\u7b80\u5355\u8bb2\u4e0b\uff0c\u4ed6\u5176\u5b9e\u662f\u4e00\u4e2ajson\uff0c\u5e76\u4e0d\u662f\u6587\u4ef6\u6d41\u3002 { \"content\" : \"\u6587\u4ef6base64\u7f16\u7801\u7684byte\u5b57\u7b26\u4e32\" , \"size\" : \"\u6587\u4ef6\u5927\u5c0f\" } \u6240\u4ee5\u6211\u4eec\u53d6\u51fa\u6765\u6570\u636e\u540e\u8981\u7ee7\u7eed\u7528base64decode\uff0c\u6700\u540e\u5199\u5165\u6211\u4eec\u751f\u6210\u7684\u4e34\u65f6\u6587\u4ef6\uff0c\u901a\u8fc7fastapi\u7684FileResponse\u63d0\u4f9b\u4e0b\u8f7d\u529f\u80fd\u3002","title":"\u5b9e\u73b0GiteeOss\u4e2d\u7684\u65b9\u6cd5"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2893%29%20%E5%85%8D%E8%B4%B9%E7%9A%84gitee%E5%BD%93oss%E7%9C%9F%E7%9A%84%E9%A6%99%E5%90%97/#_3","text":"gitee\u6700\u5927\u7279\u70b9\u5c31\u662f\u514d\u8d39\uff0c\u4f5c\u4e3aoss\u5b9e\u5728\u662f\u4e0d\u65b9\u4fbf\uff0c\u4f5c\u4e3a\u56fe\u5e8a\u5012\u662f\u4e0d\u9519\uff0c\u76ee\u524d\u4e5f\u6ca1\u6709 \u9632\u76d7\u94fe \u8fd9\u4e00\u8bf4\u3002 \u83b7\u53d6\u6587\u4ef6\u4e0d\u65b9\u4fbf \u4e0d\u80fd\u83b7\u53d6\u6587\u4ef6\u5927\u5c0f\uff0c\u9664\u975e\u4f60\u4e0b\u8f7d\u6587\u4ef6 \u6ca1\u6709\u66f4\u65b0\u65f6\u95f4 \u6240\u4ee5\u6700\u540e\u54b1\u4eecoss\u7684\u7ba1\u7406\u9875\u9762\u957f\u8fd9\u6837: \u4f46\u5176\u5b9e\u662f\u6211\u4eec\u5077\u61d2\uff0c\u5982\u679c\u5728\u6587\u4ef6\u4e0a\u4f20\u7684\u65f6\u5019\u6211\u4eec \u8bb0\u5f55\u4e00\u4efd\u6587\u4ef6\u76f8\u5173\u6570\u636e \u5230\u672c\u5730\uff0c\u90a3\u8fd9\u4e9b\u90fd\u4e0d\u662f\u95ee\u9898\u3002\u90a3\u5e94\u8be5\u8fd8\u662f\u9999\u7684\u5427\uff01\uff08\u4f46\u53c8\u53ef\u80fd\u5b58\u5728\u6570\u636e\u4e0d\u540c\u6b65\u95ee\u9898\uff09 \u600e\u4e48\u8bf4\u5462\uff0c\u4e00\u5f00\u59cb\u662f\u61d2\uff0c\u770b\u6765\u8fd8\u662f\u4ed8\u51fa\u4ee3\u4ef7\u4e86~\u8fd9\u4e2a\u5751\u5148\u653e\u7740\uff0c\u4ee5\u540e\u518d\u586b\u5427~","title":"\u603b\u7ed3"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2894%29%20%E5%89%8D%E7%BD%AE%E6%9D%A1%E4%BB%B6%E8%AF%A5%E6%80%8E%E4%B9%88%E6%94%AF%E6%8C%81Python%E5%91%A2/","text":"\u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u72e0\u72e0 \u64cd\u7ec3 \u4e86\u4e00\u756aoss\uff0c\u4f46\u6211\u4eec\u7684\u4efb\u52a1\u8fd8\u5f88\u957f\u4e45\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u7ee7\u7eed\u6253\u78e8\u6211\u4eec\u7684\u529f\u80fd\u3002 \u90a3\u4eca\u5929\u5c31\u8ba9\u6211\u4eec\u6765\u601d\u8003\u4e0b\uff0c\u5982\u4f55\u5728 \u524d\u7f6e\u6761\u4ef6 \u652f\u6301python\u811a\u672c\uff0c\u591a\u7684\u4e0d\u8bf4\uff0c\u6211\u4eec\u4e5f\u6682\u65f6\u4e0d\u8003\u8651\u5176\u4ed6\u8bed\u8a00\uff0c\u56e0\u4e3a\u5149\u8003\u8651\u652f\u6301python\uff0c\u5df2\u7ecf\u591f\u545b\u5566\u3002 \u672c\u6587\u65e8\u5728\u63a2\u8ba8\u4e00\u4e9b\u601d\u8def\u7684\u53ef\u884c\u6027\uff0c\u4e0d\u4f1a\u5b9e\u9645\u7740\u624b\u7f16\u5199\u3002 \u7a76\u7adf\u7f3a\u4ec0\u4e48 \u56e0\u4e3a\u6211\u4eec\u53ea\u8003\u8651Python\u811a\u672c\uff0c\u6240\u4ee5\u6211\u4eec\u5fc5\u987b \u8ba4\u771f\u8003\u8651 \u6211\u4eec\u7684\u9700\u6c42\u3002 \u80fd\u591f\u901a\u8fc7python\u811a\u672c\u6784\u5efa\u6570\u636e \u6211\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u6211\u53ef\u4ee5\u7528python\u811a\u672c\u5b9e\u73b0\u4e00\u4e9b\u5f88\u590d\u6742\u7684\u529f\u80fd\uff0c\u800c\u8fd9\u4e9b\u529f\u80fd\u5728\u5f53\u524d\u6761\u4ef6\u4e0b\u90fd\u4e0d\u5927\u53ef\u80fd\u652f\u6301\u3002\u6bd4\u65b9\u8bf4\uff0c\u6211\u60f3\u83b7\u53d6\u5f53\u524d\u6708\u7684\u7b2c\u4e00\u5929\u7684\u65e5\u671f\uff0c\u53c8\u6216\u8005\u6211\u60f3\u505a\u4e00\u4e9b\u52a0\u89e3\u5bc6/base64\u7684\u8fd0\u7b97\uff0c\u5c3d\u7ba1 pity \u53ef\u4ee5\u9ed8\u8ba4\u5e2e\u52a9\u5b9e\u73b0\u8fd9\u4e9b\u529f\u80fd\uff0c\u4f46\u603b\u4f1a\u6709\u610f\u60f3\u4e0d\u5230\u7684\u573a\u666f\u51fa\u73b0\u3002\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e9b\u56f0\u96be\uff0c\u6211\u4eec\u53ef\u4ee5\u9002\u5f53\u7f16\u5199\u811a\u672c\u5b8c\u6210\u8fd9\u4e9b\u5de5\u4f5c\u3002 \u80fd\u591f\u652f\u6301\u53c2\u6570 \u8fd9\u91cc\u7684\u53c2\u6570\u6307\u7684\u662f pity \u5185\u7f6e\u7684\u53c2\u6570${\u53c2\u6570} \u80fd\u591f\u83b7\u53d6\u5230 \u8fd4\u56de\u503c \u8fd9\u4e2a\u9700\u6c42\u5927\u5bb6\u90fd\u80fd\u7406\u89e3\uff0c\u6709\u65f6\u5019\u6211\u662f\u60f3\u89e6\u53d1\u4e00\u4e2a\u529f\u80fd\uff0c\u6bd4\u5982\u7ed9\u67d0\u4e9b\u4eba\u53d1\u90ae\u4ef6\uff0c\u6211\u4e0d\u9700\u8981\u77e5\u9053\u8fc7\u7a0b\uff0c\u6211\u53ea\u8981\u5b8c\u6210\u8fd9\u4e2a\u529f\u80fd\u5373\u53ef\u3002\u800c\u6709\u65f6\u5019\u5462\uff0c\u6211\u9700\u8981\u7684\u662f\u6267\u884c\u8fc7\u7a0b\uff0c\u5e76\u5f97\u5230 \u786e\u5207\u7684\u7ed3\u679c \u3002\u6240\u4ee5\u8fd9\u4e2a\u529f\u80fd\u662f\u5fc5\u4e0d\u53ef\u5c11\u7684\u3002 \u601d\u7d22\u65b9\u6848 \u8981\u60f3\u5728python web\u4e2d\u6267\u884c\u52a8\u6001\u7684python\u811a\u672c\uff0c\u6211\u4eec\u53ef\u4ee5\u600e\u4e48\u505a\u5462\uff1f exec exec\u662f\u4e00\u4e2a\u80fd\u591f \u6267\u884c\u7ed9\u5b9apython\u4ee3\u7801 \u7684\u7cfb\u7edf\u65b9\u6cd5\uff0c\u53ef\u80fd\u4e5f\u4e0d\u662f\u5f88\u88ab\u63a8\u8350\u3002\u5b83\u63a5\u53d7\u7684\u53c2\u6570\u662f python\u4ee3\u7801 \uff0c\u4e3e\u4e2a\u4f8b\u5b50: # \u6267\u884c\u539f\u751fpython\u811a\u672cprint\u4e86\u4e00\u6761\u8bed\u53e5 exec ( print ( \"\u4f60\u5728\u809d\u4ec0\u4e48\" )) \u63a5\u7740\u6211\u4eec\u8bd5\u8bd5\u5728exec\u4e2d\u5b9a\u4e49\u4e00\u4e2a\u65b9\u6cd5main\uff0c\u5e76\u8bd5\u8bd5\u80fd\u4e0d\u80fd\u8c03\u7528\u3002 \u53ef\u4ee5\u770b\u5230\u662f\u80fd\u7684\uff0c\u8fd9\u4e2a\u6211\u53ea\u80fd\u8bf4 \u80a5\u80a0\u725b\u6279 \uff01\u56e0\u4e3a\u6211\u4e5f\u57fa\u672c\u662f\u6ca1\u7528\u8fc7\uff0c\u53ea\u662f\u77e5\u9053\uff0c\u4eca\u5929\u4e5f\u662f\u548c\u5927\u5bb6\u4e00\u8d77\u5c1d\u8bd5\u4e0b\u3002 \u81f3\u4e8e\u4e3a\u4ec0\u4e48\u4e0d\u88ab\u63a8\u8350\uff0c\u53ef\u80fd\u662f\u56e0\u4e3a\u5371\u9669\u6027\u8fc7\u9ad8\uff0c\u6bd5\u7adf\u4f60\u4f20\u5165\u7684\u5565\u4eba\u5bb6\u90fd\u80fd\u7ed9\u4f60\u6267\u884c\u6389\u3002 \u4e0d\u8fc7\u597d\u5728exec\u7684\u6570\u636e\u53ef\u4ee5\u62ff\u5230\u65b9\u6cd5\u6267\u884c\u7684\u8fd4\u56de\u503c\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7 \u5b57\u7b26\u4e32\u66ff\u6362 \u7684\u65b9\u5f0f\u83b7\u5f97\u5bf9\u5e94\u7684\u8fd4\u56de\u503c\u3002 \u81ea\u5efapython\u9879\u76ee \u7531\u4e8e\u4ee3\u7801\u90fd\u662fpython\uff0c\u6211\u4eec\u5b8c\u5168\u53ef\u4ee5\u7528git\u7ef4\u62a4\u4e00\u5957python\u5de5\u5177\u5e93\u3002\u63a5\u7740\u901a\u8fc7 \u52a8\u6001\u5bfc\u5165 \u6765\u6267\u884c\u5bf9\u5e94\u7684\u65b9\u6cd5\uff0c\u8fd9\u6837\u505a\u7684\u597d\u5904\u662f\u66f4\u7075\u6d3b\uff0c\u4f46\u4e5f\u4f34\u968f\u7740\u66f4\u9ad8\u7684\u6210\u672c\u3002 \u6211\u4eec\u5f97\u53bb\u66f4\u65b0\u4ee3\u7801\uff08\u5305\u62ec\u76d1\u542cgit push\u94a9\u5b50\uff0c\u6216\u8005\u5b9a\u65f6\u62c9\u53d6\u4ee5\u53ca\u624b\u52a8\u66f4\u65b0\uff09\uff0c\u8fd8\u5f97\u63d0\u4f9b\u4e00\u4e2a\u7f16\u8f91\u9875\u9762\uff0c\u53ef\u4ee5\u8ba9\u7528\u6237\u66f4\u6539\u5bf9\u5e94\u7684\u4ee3\u7801\u3002 \u4f46\u6700\u70e6\u4eba\u7684\u8fd8\u662f\u6709\u6269\u5c55\u5305\u7684\u65f6\u5019\uff0c\u6211\u4eec\u7684web\u9879\u76ee\u751a\u81f3\u90fd\u9700\u8981\u53bb \u5b89\u88c5\u6269\u5c55\u5305 \u3002 \u8bf4\u8d77\u539f\u7406\u5012\u4e0d\u96be\uff0c\u7b80\u5355\u7684\u8bf4\u5c31\u662f\u5185\u5d4c\u4e86\u4e00\u4e2apython\u6587\u4ef6\u76ee\u5f55\uff0c\u901a\u8fc7import\u5bfc\u5165\u5bf9\u5e94\u7684\u65b9\u6cd5\u5e76\u6267\u884c\u3002 http\u7684\u65b9\u5f0f(\u4e0d\u63a8\u8350) \u65b0\u542f\u52a8\u4e00\u4e2a\u670d\u52a1\uff0c\u91cc\u9762\u63d0\u4f9b\u4e86\u4e00\u4e2aapi\uff0c\u901a\u8fc7\u4f20\u5165method\uff0cparam\u7b49\u4fe1\u606f\uff0c\u5b9e\u73b0\u8c03\u7528\u65b9\u6cd5\u5e76 \u62ff\u5230\u8fd4\u56de\u503c \u7684\u6548\u679c\u3002 \u7f3a\u70b9\u5c31\u662f\u4ee3\u4ef7\u6bd4\u8f83\u5927\uff0c\u8d77\u4e86\u65b0\u670d\u52a1\uff0c\u5982\u679c\u670d\u52a1\u6302\u6389\u5f71\u54cd\u8f83\u5927\u3002\u4f18\u70b9\u662f\u80fd\u591f\u8de8\u8bed\u8a00\uff0c\u4f46\u662f\u8fd8\u662f\u504f \u91cd \u4e86\u3002 mq \u6709http\u5c31\u53ef\u4ee5\u6709mq\u7684\u65b9\u5f0f\uff0c\u901a\u8fc7\u751f\u4ea7\u8005\u548c\u6d88\u8d39\u8005\u53bb\u89e3\u8026A\u7cfb\u7edf\u4f9d\u8d56B\u7cfb\u7edf\u7684\u903b\u8f91\uff0c\u7528\u6d88\u606f\u961f\u5217\u6765\u5904\u7406\u76f8\u5173\u903b\u8f91\uff0c\u53ef\u4ee5\u7528rabbitmq\u5b8c\u6210\u8fd9\u6837\u7684\u5de5\u4f5c\u3002 grpc \u867d\u7136grpc\u5f88\u5f3a\u5927\uff0c\u4f46\u662f\u4e0d\u63a8\u8350\uff0c\u867d\u7136\u8de8\u8bed\u8a00\u662f\u4e2a\u975e\u5e38\u8bf1\u4eba\u7684 \u7279\u6027 \uff0c\u4f46\u662f\u5bf9\u4e8e\u65b0\u4eba\u4e0d\u592a\u53cb\u597d\uff0c\u6709\u4e00\u5b9a\u7684\u5b66\u4e60\u6210\u672c\uff0c\u5e95\u5c42\u867d\u7136\u6539\u7528rpc\u8c03\u7528\uff0c\u5e8f\u5217\u5316\u5347\u7ea7\u4e3aprotobuf\u4f1a\u66f4\u9ad8\u6548\uff0c\u4f46\u5b66\u4e60\u6210\u672c\u9ad8\uff0c\u5b98\u65b9\u4e5f\u6ca1\u6709\u597d\u7684\u8d1f\u8f7d\u5747\u8861/\u670d\u52a1\u6ce8\u518c\u53d1\u73b0\u65b9\u6848\uff0c\u5bf9\u4e8e\u4e0d\u540c\u8bed\u8a00\u751a\u81f3\u8981\u5b9e\u73b0\u4e0d\u540c\u7684\u4e00\u5957\u903b\u8f91\uff0c\u5f00\u53d1\u6210\u672c\u4e5f\u4e0d\u4f4e\u3002 \u603b\u7ed3 \u4e0a\u9762\u5927\u6982\u5217\u4e3e\u4e865\u79cd\u65b9\u5f0f\uff0c\u6211\u4e2a\u4eba\u6bd4\u8f83\u76f8\u5bf9\u63a8\u8350\u7684\u8fd8\u662fexec\uff0c\u5185\u7f6epython\u5305\u548cmq\u7684\u5f62\u5f0f\u3002 \u65b9\u6848 \u591a\u8bed\u8a00 \u6210\u672c \u7a33\u5b9a\u6027 \u989d\u5916\u7ec4\u4ef6 exec \u5426 \u4f4e \u9ad8 \u5426 import \u5426 \u4e2d \u9ad8 \u5426 http \u662f \u9ad8 \u4f4e \u5426 mq \u662f \u9ad8 \u4e2d \u662f grpc \u662f \u975e\u5e38\u9ad8 \u4e2d \u662f mq\u7684\u7f3a\u70b9\u5c31\u662f\u9700\u8981\u5b9e\u73b0\u4e0d\u540c\u8bed\u8a00\u7684\u6d88\u8d39\u8005\u4ee5\u53ca\u9700\u8981\u5f15\u5165\u989d\u5916\u7684\u7ec4\u4ef6\u3002\u7531\u4e8e\u6211\u4eec\u6682\u65f6\u53ea\u652f\u6301python\uff0c\u6240\u4ee5\u6211\u4eec\u4f18\u5148\u9009\u62e9\u7b2c\u4e00\u79cdexec\u7684\u65b9\u5f0f\uff0c\u81f3\u4e8e\u7b2c\u4e8c\u79cd\uff0c\u6211\u662f\u6709\u8ba1\u5212\u4e5f\u4e00\u5e76\u52a0\u5165\u7684\u3002 \u672c\u8282\u5185\u5bb9\u5c31\u4ecb\u7ecd\u5230\u8fd9\u91cc\uff0c\u6b22\u8fce\u5927\u5bb6\u7ed9\u51fa\u5176\u4ed6\u60f3\u6cd5\u6216\u8005\u5efa\u8bae\uff0c\u4e5f\u53ef\u4ee5\u4e00\u8d77\u8ba8\u8bba\u3002 \u540e\u7aef\u4ee3\u7801\u4ed3\u5e93: http://github.com/wuranxu/pity \u524d\u7aef\u4ee3\u7801\u4ed3\u5e93: http://github.com/wuranxu/pityWeb","title":"94.\u524d\u7f6e\u6761\u4ef6\u8be5\u600e\u4e48\u652f\u6301Python\u5462"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2894%29%20%E5%89%8D%E7%BD%AE%E6%9D%A1%E4%BB%B6%E8%AF%A5%E6%80%8E%E4%B9%88%E6%94%AF%E6%8C%81Python%E5%91%A2/#_1","text":"\u4e0a\u4e00\u8282\u6211\u4eec\u72e0\u72e0 \u64cd\u7ec3 \u4e86\u4e00\u756aoss\uff0c\u4f46\u6211\u4eec\u7684\u4efb\u52a1\u8fd8\u5f88\u957f\u4e45\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u7ee7\u7eed\u6253\u78e8\u6211\u4eec\u7684\u529f\u80fd\u3002 \u90a3\u4eca\u5929\u5c31\u8ba9\u6211\u4eec\u6765\u601d\u8003\u4e0b\uff0c\u5982\u4f55\u5728 \u524d\u7f6e\u6761\u4ef6 \u652f\u6301python\u811a\u672c\uff0c\u591a\u7684\u4e0d\u8bf4\uff0c\u6211\u4eec\u4e5f\u6682\u65f6\u4e0d\u8003\u8651\u5176\u4ed6\u8bed\u8a00\uff0c\u56e0\u4e3a\u5149\u8003\u8651\u652f\u6301python\uff0c\u5df2\u7ecf\u591f\u545b\u5566\u3002 \u672c\u6587\u65e8\u5728\u63a2\u8ba8\u4e00\u4e9b\u601d\u8def\u7684\u53ef\u884c\u6027\uff0c\u4e0d\u4f1a\u5b9e\u9645\u7740\u624b\u7f16\u5199\u3002","title":"\u56de\u987e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2894%29%20%E5%89%8D%E7%BD%AE%E6%9D%A1%E4%BB%B6%E8%AF%A5%E6%80%8E%E4%B9%88%E6%94%AF%E6%8C%81Python%E5%91%A2/#_2","text":"\u56e0\u4e3a\u6211\u4eec\u53ea\u8003\u8651Python\u811a\u672c\uff0c\u6240\u4ee5\u6211\u4eec\u5fc5\u987b \u8ba4\u771f\u8003\u8651 \u6211\u4eec\u7684\u9700\u6c42\u3002 \u80fd\u591f\u901a\u8fc7python\u811a\u672c\u6784\u5efa\u6570\u636e \u6211\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u6211\u53ef\u4ee5\u7528python\u811a\u672c\u5b9e\u73b0\u4e00\u4e9b\u5f88\u590d\u6742\u7684\u529f\u80fd\uff0c\u800c\u8fd9\u4e9b\u529f\u80fd\u5728\u5f53\u524d\u6761\u4ef6\u4e0b\u90fd\u4e0d\u5927\u53ef\u80fd\u652f\u6301\u3002\u6bd4\u65b9\u8bf4\uff0c\u6211\u60f3\u83b7\u53d6\u5f53\u524d\u6708\u7684\u7b2c\u4e00\u5929\u7684\u65e5\u671f\uff0c\u53c8\u6216\u8005\u6211\u60f3\u505a\u4e00\u4e9b\u52a0\u89e3\u5bc6/base64\u7684\u8fd0\u7b97\uff0c\u5c3d\u7ba1 pity \u53ef\u4ee5\u9ed8\u8ba4\u5e2e\u52a9\u5b9e\u73b0\u8fd9\u4e9b\u529f\u80fd\uff0c\u4f46\u603b\u4f1a\u6709\u610f\u60f3\u4e0d\u5230\u7684\u573a\u666f\u51fa\u73b0\u3002\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e9b\u56f0\u96be\uff0c\u6211\u4eec\u53ef\u4ee5\u9002\u5f53\u7f16\u5199\u811a\u672c\u5b8c\u6210\u8fd9\u4e9b\u5de5\u4f5c\u3002 \u80fd\u591f\u652f\u6301\u53c2\u6570 \u8fd9\u91cc\u7684\u53c2\u6570\u6307\u7684\u662f pity \u5185\u7f6e\u7684\u53c2\u6570${\u53c2\u6570} \u80fd\u591f\u83b7\u53d6\u5230 \u8fd4\u56de\u503c \u8fd9\u4e2a\u9700\u6c42\u5927\u5bb6\u90fd\u80fd\u7406\u89e3\uff0c\u6709\u65f6\u5019\u6211\u662f\u60f3\u89e6\u53d1\u4e00\u4e2a\u529f\u80fd\uff0c\u6bd4\u5982\u7ed9\u67d0\u4e9b\u4eba\u53d1\u90ae\u4ef6\uff0c\u6211\u4e0d\u9700\u8981\u77e5\u9053\u8fc7\u7a0b\uff0c\u6211\u53ea\u8981\u5b8c\u6210\u8fd9\u4e2a\u529f\u80fd\u5373\u53ef\u3002\u800c\u6709\u65f6\u5019\u5462\uff0c\u6211\u9700\u8981\u7684\u662f\u6267\u884c\u8fc7\u7a0b\uff0c\u5e76\u5f97\u5230 \u786e\u5207\u7684\u7ed3\u679c \u3002\u6240\u4ee5\u8fd9\u4e2a\u529f\u80fd\u662f\u5fc5\u4e0d\u53ef\u5c11\u7684\u3002","title":"\u7a76\u7adf\u7f3a\u4ec0\u4e48"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2894%29%20%E5%89%8D%E7%BD%AE%E6%9D%A1%E4%BB%B6%E8%AF%A5%E6%80%8E%E4%B9%88%E6%94%AF%E6%8C%81Python%E5%91%A2/#_3","text":"\u8981\u60f3\u5728python web\u4e2d\u6267\u884c\u52a8\u6001\u7684python\u811a\u672c\uff0c\u6211\u4eec\u53ef\u4ee5\u600e\u4e48\u505a\u5462\uff1f","title":"\u601d\u7d22\u65b9\u6848"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2894%29%20%E5%89%8D%E7%BD%AE%E6%9D%A1%E4%BB%B6%E8%AF%A5%E6%80%8E%E4%B9%88%E6%94%AF%E6%8C%81Python%E5%91%A2/#exec","text":"exec\u662f\u4e00\u4e2a\u80fd\u591f \u6267\u884c\u7ed9\u5b9apython\u4ee3\u7801 \u7684\u7cfb\u7edf\u65b9\u6cd5\uff0c\u53ef\u80fd\u4e5f\u4e0d\u662f\u5f88\u88ab\u63a8\u8350\u3002\u5b83\u63a5\u53d7\u7684\u53c2\u6570\u662f python\u4ee3\u7801 \uff0c\u4e3e\u4e2a\u4f8b\u5b50: # \u6267\u884c\u539f\u751fpython\u811a\u672cprint\u4e86\u4e00\u6761\u8bed\u53e5 exec ( print ( \"\u4f60\u5728\u809d\u4ec0\u4e48\" )) \u63a5\u7740\u6211\u4eec\u8bd5\u8bd5\u5728exec\u4e2d\u5b9a\u4e49\u4e00\u4e2a\u65b9\u6cd5main\uff0c\u5e76\u8bd5\u8bd5\u80fd\u4e0d\u80fd\u8c03\u7528\u3002 \u53ef\u4ee5\u770b\u5230\u662f\u80fd\u7684\uff0c\u8fd9\u4e2a\u6211\u53ea\u80fd\u8bf4 \u80a5\u80a0\u725b\u6279 \uff01\u56e0\u4e3a\u6211\u4e5f\u57fa\u672c\u662f\u6ca1\u7528\u8fc7\uff0c\u53ea\u662f\u77e5\u9053\uff0c\u4eca\u5929\u4e5f\u662f\u548c\u5927\u5bb6\u4e00\u8d77\u5c1d\u8bd5\u4e0b\u3002 \u81f3\u4e8e\u4e3a\u4ec0\u4e48\u4e0d\u88ab\u63a8\u8350\uff0c\u53ef\u80fd\u662f\u56e0\u4e3a\u5371\u9669\u6027\u8fc7\u9ad8\uff0c\u6bd5\u7adf\u4f60\u4f20\u5165\u7684\u5565\u4eba\u5bb6\u90fd\u80fd\u7ed9\u4f60\u6267\u884c\u6389\u3002 \u4e0d\u8fc7\u597d\u5728exec\u7684\u6570\u636e\u53ef\u4ee5\u62ff\u5230\u65b9\u6cd5\u6267\u884c\u7684\u8fd4\u56de\u503c\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7 \u5b57\u7b26\u4e32\u66ff\u6362 \u7684\u65b9\u5f0f\u83b7\u5f97\u5bf9\u5e94\u7684\u8fd4\u56de\u503c\u3002","title":"exec"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2894%29%20%E5%89%8D%E7%BD%AE%E6%9D%A1%E4%BB%B6%E8%AF%A5%E6%80%8E%E4%B9%88%E6%94%AF%E6%8C%81Python%E5%91%A2/#python","text":"\u7531\u4e8e\u4ee3\u7801\u90fd\u662fpython\uff0c\u6211\u4eec\u5b8c\u5168\u53ef\u4ee5\u7528git\u7ef4\u62a4\u4e00\u5957python\u5de5\u5177\u5e93\u3002\u63a5\u7740\u901a\u8fc7 \u52a8\u6001\u5bfc\u5165 \u6765\u6267\u884c\u5bf9\u5e94\u7684\u65b9\u6cd5\uff0c\u8fd9\u6837\u505a\u7684\u597d\u5904\u662f\u66f4\u7075\u6d3b\uff0c\u4f46\u4e5f\u4f34\u968f\u7740\u66f4\u9ad8\u7684\u6210\u672c\u3002 \u6211\u4eec\u5f97\u53bb\u66f4\u65b0\u4ee3\u7801\uff08\u5305\u62ec\u76d1\u542cgit push\u94a9\u5b50\uff0c\u6216\u8005\u5b9a\u65f6\u62c9\u53d6\u4ee5\u53ca\u624b\u52a8\u66f4\u65b0\uff09\uff0c\u8fd8\u5f97\u63d0\u4f9b\u4e00\u4e2a\u7f16\u8f91\u9875\u9762\uff0c\u53ef\u4ee5\u8ba9\u7528\u6237\u66f4\u6539\u5bf9\u5e94\u7684\u4ee3\u7801\u3002 \u4f46\u6700\u70e6\u4eba\u7684\u8fd8\u662f\u6709\u6269\u5c55\u5305\u7684\u65f6\u5019\uff0c\u6211\u4eec\u7684web\u9879\u76ee\u751a\u81f3\u90fd\u9700\u8981\u53bb \u5b89\u88c5\u6269\u5c55\u5305 \u3002 \u8bf4\u8d77\u539f\u7406\u5012\u4e0d\u96be\uff0c\u7b80\u5355\u7684\u8bf4\u5c31\u662f\u5185\u5d4c\u4e86\u4e00\u4e2apython\u6587\u4ef6\u76ee\u5f55\uff0c\u901a\u8fc7import\u5bfc\u5165\u5bf9\u5e94\u7684\u65b9\u6cd5\u5e76\u6267\u884c\u3002","title":"\u81ea\u5efapython\u9879\u76ee"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2894%29%20%E5%89%8D%E7%BD%AE%E6%9D%A1%E4%BB%B6%E8%AF%A5%E6%80%8E%E4%B9%88%E6%94%AF%E6%8C%81Python%E5%91%A2/#http","text":"\u65b0\u542f\u52a8\u4e00\u4e2a\u670d\u52a1\uff0c\u91cc\u9762\u63d0\u4f9b\u4e86\u4e00\u4e2aapi\uff0c\u901a\u8fc7\u4f20\u5165method\uff0cparam\u7b49\u4fe1\u606f\uff0c\u5b9e\u73b0\u8c03\u7528\u65b9\u6cd5\u5e76 \u62ff\u5230\u8fd4\u56de\u503c \u7684\u6548\u679c\u3002 \u7f3a\u70b9\u5c31\u662f\u4ee3\u4ef7\u6bd4\u8f83\u5927\uff0c\u8d77\u4e86\u65b0\u670d\u52a1\uff0c\u5982\u679c\u670d\u52a1\u6302\u6389\u5f71\u54cd\u8f83\u5927\u3002\u4f18\u70b9\u662f\u80fd\u591f\u8de8\u8bed\u8a00\uff0c\u4f46\u662f\u8fd8\u662f\u504f \u91cd \u4e86\u3002","title":"http\u7684\u65b9\u5f0f(\u4e0d\u63a8\u8350)"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2894%29%20%E5%89%8D%E7%BD%AE%E6%9D%A1%E4%BB%B6%E8%AF%A5%E6%80%8E%E4%B9%88%E6%94%AF%E6%8C%81Python%E5%91%A2/#mq","text":"\u6709http\u5c31\u53ef\u4ee5\u6709mq\u7684\u65b9\u5f0f\uff0c\u901a\u8fc7\u751f\u4ea7\u8005\u548c\u6d88\u8d39\u8005\u53bb\u89e3\u8026A\u7cfb\u7edf\u4f9d\u8d56B\u7cfb\u7edf\u7684\u903b\u8f91\uff0c\u7528\u6d88\u606f\u961f\u5217\u6765\u5904\u7406\u76f8\u5173\u903b\u8f91\uff0c\u53ef\u4ee5\u7528rabbitmq\u5b8c\u6210\u8fd9\u6837\u7684\u5de5\u4f5c\u3002","title":"mq"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2894%29%20%E5%89%8D%E7%BD%AE%E6%9D%A1%E4%BB%B6%E8%AF%A5%E6%80%8E%E4%B9%88%E6%94%AF%E6%8C%81Python%E5%91%A2/#grpc","text":"\u867d\u7136grpc\u5f88\u5f3a\u5927\uff0c\u4f46\u662f\u4e0d\u63a8\u8350\uff0c\u867d\u7136\u8de8\u8bed\u8a00\u662f\u4e2a\u975e\u5e38\u8bf1\u4eba\u7684 \u7279\u6027 \uff0c\u4f46\u662f\u5bf9\u4e8e\u65b0\u4eba\u4e0d\u592a\u53cb\u597d\uff0c\u6709\u4e00\u5b9a\u7684\u5b66\u4e60\u6210\u672c\uff0c\u5e95\u5c42\u867d\u7136\u6539\u7528rpc\u8c03\u7528\uff0c\u5e8f\u5217\u5316\u5347\u7ea7\u4e3aprotobuf\u4f1a\u66f4\u9ad8\u6548\uff0c\u4f46\u5b66\u4e60\u6210\u672c\u9ad8\uff0c\u5b98\u65b9\u4e5f\u6ca1\u6709\u597d\u7684\u8d1f\u8f7d\u5747\u8861/\u670d\u52a1\u6ce8\u518c\u53d1\u73b0\u65b9\u6848\uff0c\u5bf9\u4e8e\u4e0d\u540c\u8bed\u8a00\u751a\u81f3\u8981\u5b9e\u73b0\u4e0d\u540c\u7684\u4e00\u5957\u903b\u8f91\uff0c\u5f00\u53d1\u6210\u672c\u4e5f\u4e0d\u4f4e\u3002","title":"grpc"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2894%29%20%E5%89%8D%E7%BD%AE%E6%9D%A1%E4%BB%B6%E8%AF%A5%E6%80%8E%E4%B9%88%E6%94%AF%E6%8C%81Python%E5%91%A2/#_4","text":"\u4e0a\u9762\u5927\u6982\u5217\u4e3e\u4e865\u79cd\u65b9\u5f0f\uff0c\u6211\u4e2a\u4eba\u6bd4\u8f83\u76f8\u5bf9\u63a8\u8350\u7684\u8fd8\u662fexec\uff0c\u5185\u7f6epython\u5305\u548cmq\u7684\u5f62\u5f0f\u3002 \u65b9\u6848 \u591a\u8bed\u8a00 \u6210\u672c \u7a33\u5b9a\u6027 \u989d\u5916\u7ec4\u4ef6 exec \u5426 \u4f4e \u9ad8 \u5426 import \u5426 \u4e2d \u9ad8 \u5426 http \u662f \u9ad8 \u4f4e \u5426 mq \u662f \u9ad8 \u4e2d \u662f grpc \u662f \u975e\u5e38\u9ad8 \u4e2d \u662f mq\u7684\u7f3a\u70b9\u5c31\u662f\u9700\u8981\u5b9e\u73b0\u4e0d\u540c\u8bed\u8a00\u7684\u6d88\u8d39\u8005\u4ee5\u53ca\u9700\u8981\u5f15\u5165\u989d\u5916\u7684\u7ec4\u4ef6\u3002\u7531\u4e8e\u6211\u4eec\u6682\u65f6\u53ea\u652f\u6301python\uff0c\u6240\u4ee5\u6211\u4eec\u4f18\u5148\u9009\u62e9\u7b2c\u4e00\u79cdexec\u7684\u65b9\u5f0f\uff0c\u81f3\u4e8e\u7b2c\u4e8c\u79cd\uff0c\u6211\u662f\u6709\u8ba1\u5212\u4e5f\u4e00\u5e76\u52a0\u5165\u7684\u3002 \u672c\u8282\u5185\u5bb9\u5c31\u4ecb\u7ecd\u5230\u8fd9\u91cc\uff0c\u6b22\u8fce\u5927\u5bb6\u7ed9\u51fa\u5176\u4ed6\u60f3\u6cd5\u6216\u8005\u5efa\u8bae\uff0c\u4e5f\u53ef\u4ee5\u4e00\u8d77\u8ba8\u8bba\u3002 \u540e\u7aef\u4ee3\u7801\u4ed3\u5e93: http://github.com/wuranxu/pity \u524d\u7aef\u4ee3\u7801\u4ed3\u5e93: http://github.com/wuranxu/pityWeb","title":"\u603b\u7ed3"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2895%29%20%E5%89%8D%E7%BD%AE%E6%9D%A1%E4%BB%B6%E6%94%AF%E6%8C%81%E7%AE%80%E5%8D%95%E7%9A%84python%E8%84%9A%E6%9C%AC/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u6784\u601d\u4e86\u4e00\u4e0b\u600e\u4e48\u53bb\u652f\u6301Python\u811a\u672c\uff0c\u5728\u548c@joker\u8ba8\u8bba\u4ee5\u540e\uff0c\u8003\u8651\u5230python\u811a\u672c\u4e0d\u4f1a\u592a\u590d\u6742\uff0c\u6240\u4ee5\u6211\u4eec\u8fd9\u4e00\u8282\u6211\u4eec\u5c31\u5148\u5b9e\u73b0 exec \u7684\u7248\u672c\u3002 exec\u521d\u4f53\u9a8c exec\u662f\u4e00\u4e2a\u6bd4\u8f83\u5389\u5bb3\u7684 \u5185\u7f6e\u5e93 \uff0c\u5b83\u4e3a\u60f3\u8981\u6267\u884cpython\u4ee3\u7801\u7684\u7528\u6237\u63d0\u4f9b\u4e86\u4fbf\u5229\uff0c\u4e0e\u4e4b\u5bf9\u5e94\u7684\u8fd8\u6709execfile\u7248\u672c\uff0c\u8fd9\u4e2a\u662f\u6587\u4ef6\u7248\u672c\u7684exec\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u4ed6\u63a5\u53d7\u7684\u53c2\u6570\u4ece\u4e00\u6bb5\u4ee3\u7801\u53d8\u6210\u4e86\u4e00\u4e2a\u6307\u5b9a\u7684 \u6587\u4ef6 \u3002 \u4e0a\u4e00\u8282\u6211\u4eec\u4f3c\u4e4e\u4ecb\u7ecd\u4e86exec\u7684\u666e\u901a\u7528\u6cd5\uff0c\u90a3\u4eca\u5929\u6211\u4eec\u5c31\u8bb2\u8bb2\u600e\u4e48\u901a\u8fc7exec\u62ff\u5230\u5bf9\u5e94\u7684\u6267\u884c\u7ed3\u679c\uff0c\u6bd5\u7adf\u5bf9\u4e8e\u6267\u884c\u7ed3\u679c\u6211\u4eec\u662f\u4f1a\u6e34\u671b\u80fd\u62ff\u5230\u7684\u3002 \u5b9e\u73b0\u7b2c\u4e00\u4e2apython\u65b9\u6cd5: \u83b7\u53d6\u672c\u6708\u7b2c\u4e00\u5929\u7684\u65e5\u671f from datetime import datetime def get_first_day_of_month (): # \u628aday\u6307\u5b9a\u4e3a01\uff0c\u80af\u5b9a\u5c31\u662f\u7b2c\u4e00\u5929\u5566 return datetime . today () . strftime ( \"%Y-%m-01\" ) python\u4ee3\u7801\u662f\u5982\u6b64\u7f16\u5199\u7684\uff0c\u90a3exec\u91cc\u9762\u6211\u4eec\u600e\u4e48\u62ff\u5230\u8fd9\u4e2a\u65b9\u6cd5\u7684\u7ed3\u679c\u5462\uff1f \u9996\u5148\u5462\uff0cexec\u662f\u6ca1\u7528\u8fd4\u56de\u503c\u7684\u3002\u6211\u4eec\u53ea\u80fd\u901a\u8fc7\uff0c\u5728exec\u6267\u884c\u7684\u4ee3\u7801\u5757\u91cc\u9762\u5b9a\u4e49\u53d8\u91cf\u53bb\u63a5\u6536\u8fd4\u56de\u503c\u3002 from datetime import datetime return_value = datetime . today () . strftime ( \"%Y-%m-01\" ) \u90a3\u4e48\u5728\u6211\u4eec\u7684 \u540e\u53f0\u4ee3\u7801 \u91cc\u9762\uff0c\u5c31\u53ef\u4ee5\u62ff\u5230return_value\u4f5c\u4e3a\u53d8\u91cf\u3002 \u4f46\u6211\u5b9e\u9645\u5728fastapi\u7684\u65b9\u6cd5\u91cc\u9762\uff0c\u53d1\u73b0\u662f\u4e0d\u751f\u6548\u7684\u3002\u4f1a\u62a5return_value not defined\uff0c\u4f46\u662f\u5355\u4e2a\u6267\u884c\u6587\u4ef6\u786e\u5b9e\u662f\u53ef\u4ee5\u3002 \u4e8e\u662f\u6211\u91c7\u7528\u4e86\u65b0\u7684\u65b9\u6cd5\uff0c\u5b9a\u4e49\u4e00\u4e2adict\uff0c\u4f20\u7ed9exec\uff0c\u8fd9\u6837exec\u91cc\u9762\u7528\u5230\u7684\u53d8\u91cf\u7b49\u4fe1\u606f\uff0c\u90fd\u4f1a\u8fd4\u56de\u5230dict\u91cc\u9762\u3002 command = \"\"\" from datetime import datetime return_value = datetime.today().strftime(\"%Y-%m-01\") \"\"\" loc = dict () exec ( command , loc ) print ( loc [ 'return_value' ]) \u7f16\u5199\u5728\u7ebf\u6267\u884cexec\u63a5\u53e3 \u5176\u5b9e\u672c\u8eab\u662f\u4e0d\u60f3\u63d0\u4f9b\u8fd9\u4e2a\u63a5\u53e3\u7684\uff0c\u56e0\u4e3a\u5927\u90e8\u5206\u811a\u672c\u90fd\u53ef\u4ee5\u5728\u672c\u5730\u6d4b\u8bd5\u540e\u4f20\u4e0a\u6765\uff0c\u4f46\u60f3\u4e86\u4e0b\uff0c\u6709\u5c31\u6709\u5427\uff0c\u5bf9\u4e8eos.remove\u8fd9\u6837\u5371\u9669\u7684\u8bed\u53e5\u8fd8\u662f\u5f97\u7981\u6b62\u6389\u3002 \u4e0d\u8fc7\u7531\u4e8e\u662f\u6f14\u793a\uff0c\u6211\u5c31\u4e0d\u7981\u6b62\u4e86\u3002 \u5148\u770b\u4e00\u5f20\u6548\u679c\u56fe\uff0c\u6267\u884c\u5b8c\u6210\u540e\u4f1a\u6709\u6570\u636e\u8fd4\u56de\u3002\u4f46\u4e00\u5b9a\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5982\u679c\u60f3\u62ff\u5230\u8fd4\u56de\u503c\uff0c\u5fc5\u987b\u8981\u6709: current_time = xxx \uff0c\u5e76\u4e14\u628a\u8fd4\u56de\u503c\u8bbe\u7f6e\u4e3acurrent_time\u3002 \u4e3a\u4ec0\u4e48\u5462\uff1f\u56e0\u4e3aexec\u672c\u8eab\u662f\u62ff\u4e0d\u5230\u8fd4\u56de\u503c\u7684\uff0c\u5982\u679c\u4f60\u53bbexec\u8bed\u53e5\u91cc\u9762\u5b9a\u4e49\u4e00\u4e2a\u53d8\u91cf: current_time2 = \"234\" \u8fd9\u6837\u5c31\u80fd\u5728loc\u91cc\u9762\u53d6\u5230\u8fd4\u56de\u503c\u4e86\uff0c\u6240\u4ee5\u5982\u679c\u8981\u6c42\u6709\u8fd4\u56de\u503c\uff0c\u5219\u5fc5\u987b\u5199\u4e0a\u4e0a\u8ff0\u7684python\u8bed\u53e5\u3002 \u6211\u4eec\u5c31\u662f\u901a\u8fc7exec\u6267\u884c\u4ee3\u7801\uff0c\u5b9a\u4e49\u53d8\u91cf\u4e3a\u8fd4\u56de\u503c\uff0c\u63a5\u7740\u53d6\u51fa\u8be5\u53d8\u91cf\u7684\u65b9\u5f0f\u5b9e\u73b0\u6574\u4e2a\u8fc7\u7a0b\u7684\u3002 \u6765\u770b\u4e0b\u4ee3\u7801\u600e\u4e48\u5199: \u548c\u4e0a\u6587\u63d0\u5230\u7684\u4e00\u6837\uff0c\u5982\u679c\u6ca1\u6709\u8fd4\u56de\u503c\u7684\u8bdd\uff0c\u76f4\u63a5\u5c31\u662fNone\u4e86\u3002 \u7f16\u5199python\u6570\u636e\u6784\u9020\u5668 \u548credis\u64cd\u4f5c\u5f88\u76f8\u4f3c\uff0c\u5b9e\u73b0run\u65b9\u6cd5\uff0c\u4e5f\u662f\u8bb0\u5f55\u6570\u636e\u5e76\u62ff\u5230\u8fd4\u56de\u503c\u3002 \u6539\u5199\u83b7\u53d6\u6570\u636e\u6784\u9020\u5668\u7684\u65b9\u6cd5 \u65b0\u589ePython\u7c7b\u578b\uff0c\u6ce8\u610f\u8fd9\u91cc\u6211\u628a\u8fd9\u4e9b\u6570\u5b57\uff0c0-3\u90fd\u653e\u5230\u4e86Config\u7c7b\u91cc\u9762\u3002 \u63d0\u9192\u4e00\u4e0b\u5404\u4f4d\uff0c\u6bd4\u5982\u6211\u8fd9\u91cc\u7684\u65b9\u6cd5\u6ca1\u6709\u7ed9\u51fa\u5bf9\u5e94\u7684\u6587\u4ef6\u8def\u5f84\uff0c\u5927\u5bb6\u53ef\u4ee5\u5168\u5c40\u641c\u7d22\uff0c\u627e\u5230\u4e4b\u3002 \u5bf9\u5e94Config.py\u4e5f\u589e\u52a0\u4e86\u8fd9\u6837\u7684\u5b50\u7c7b\u3002 \u524d\u7aef\u90e8\u5206\u7684\u6539\u52a8 \u9875\u9762\u57fa\u672c\u662f\u6cbf\u7528\u7684Redis\u7684\u90e8\u5206\uff0c\u5728\u5916\u90e8\u4e5f\u7a0d\u5fae\u6539\u9020\u4e86\u4e00\u4e0b: \u6539\u7528\u5f00\u5173\u7684\u5f62\u5f0f\uff0c\u770b\u8d77\u6765\u66f4\u76f4\u89c2\u3002 \u4eca\u5929\u7684\u5185\u5bb9\u5c31\u4ecb\u7ecd\u5230\u8fd9\u91cc\u4e86\uff0c\u6b22\u8fce\u5927\u5bb6\u79ef\u6781\u63d0\u51fa\u5efa\u8bae\uff0c\u4e00\u8d77\u6253\u9020\u4e00\u6b3e\u5f00\u6e90\u5de5\u5177\u3002","title":"95.\u524d\u7f6e\u6761\u4ef6\u652f\u6301\u7b80\u5355\u7684python\u811a\u672c"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2895%29%20%E5%89%8D%E7%BD%AE%E6%9D%A1%E4%BB%B6%E6%94%AF%E6%8C%81%E7%AE%80%E5%8D%95%E7%9A%84python%E8%84%9A%E6%9C%AC/#_1","text":"\u4e0a\u4e00\u8282\u6211\u4eec\u6784\u601d\u4e86\u4e00\u4e0b\u600e\u4e48\u53bb\u652f\u6301Python\u811a\u672c\uff0c\u5728\u548c@joker\u8ba8\u8bba\u4ee5\u540e\uff0c\u8003\u8651\u5230python\u811a\u672c\u4e0d\u4f1a\u592a\u590d\u6742\uff0c\u6240\u4ee5\u6211\u4eec\u8fd9\u4e00\u8282\u6211\u4eec\u5c31\u5148\u5b9e\u73b0 exec \u7684\u7248\u672c\u3002","title":"\u56de\u987e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2895%29%20%E5%89%8D%E7%BD%AE%E6%9D%A1%E4%BB%B6%E6%94%AF%E6%8C%81%E7%AE%80%E5%8D%95%E7%9A%84python%E8%84%9A%E6%9C%AC/#exec","text":"exec\u662f\u4e00\u4e2a\u6bd4\u8f83\u5389\u5bb3\u7684 \u5185\u7f6e\u5e93 \uff0c\u5b83\u4e3a\u60f3\u8981\u6267\u884cpython\u4ee3\u7801\u7684\u7528\u6237\u63d0\u4f9b\u4e86\u4fbf\u5229\uff0c\u4e0e\u4e4b\u5bf9\u5e94\u7684\u8fd8\u6709execfile\u7248\u672c\uff0c\u8fd9\u4e2a\u662f\u6587\u4ef6\u7248\u672c\u7684exec\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u4ed6\u63a5\u53d7\u7684\u53c2\u6570\u4ece\u4e00\u6bb5\u4ee3\u7801\u53d8\u6210\u4e86\u4e00\u4e2a\u6307\u5b9a\u7684 \u6587\u4ef6 \u3002 \u4e0a\u4e00\u8282\u6211\u4eec\u4f3c\u4e4e\u4ecb\u7ecd\u4e86exec\u7684\u666e\u901a\u7528\u6cd5\uff0c\u90a3\u4eca\u5929\u6211\u4eec\u5c31\u8bb2\u8bb2\u600e\u4e48\u901a\u8fc7exec\u62ff\u5230\u5bf9\u5e94\u7684\u6267\u884c\u7ed3\u679c\uff0c\u6bd5\u7adf\u5bf9\u4e8e\u6267\u884c\u7ed3\u679c\u6211\u4eec\u662f\u4f1a\u6e34\u671b\u80fd\u62ff\u5230\u7684\u3002 \u5b9e\u73b0\u7b2c\u4e00\u4e2apython\u65b9\u6cd5: \u83b7\u53d6\u672c\u6708\u7b2c\u4e00\u5929\u7684\u65e5\u671f from datetime import datetime def get_first_day_of_month (): # \u628aday\u6307\u5b9a\u4e3a01\uff0c\u80af\u5b9a\u5c31\u662f\u7b2c\u4e00\u5929\u5566 return datetime . today () . strftime ( \"%Y-%m-01\" ) python\u4ee3\u7801\u662f\u5982\u6b64\u7f16\u5199\u7684\uff0c\u90a3exec\u91cc\u9762\u6211\u4eec\u600e\u4e48\u62ff\u5230\u8fd9\u4e2a\u65b9\u6cd5\u7684\u7ed3\u679c\u5462\uff1f \u9996\u5148\u5462\uff0cexec\u662f\u6ca1\u7528\u8fd4\u56de\u503c\u7684\u3002\u6211\u4eec\u53ea\u80fd\u901a\u8fc7\uff0c\u5728exec\u6267\u884c\u7684\u4ee3\u7801\u5757\u91cc\u9762\u5b9a\u4e49\u53d8\u91cf\u53bb\u63a5\u6536\u8fd4\u56de\u503c\u3002 from datetime import datetime return_value = datetime . today () . strftime ( \"%Y-%m-01\" ) \u90a3\u4e48\u5728\u6211\u4eec\u7684 \u540e\u53f0\u4ee3\u7801 \u91cc\u9762\uff0c\u5c31\u53ef\u4ee5\u62ff\u5230return_value\u4f5c\u4e3a\u53d8\u91cf\u3002 \u4f46\u6211\u5b9e\u9645\u5728fastapi\u7684\u65b9\u6cd5\u91cc\u9762\uff0c\u53d1\u73b0\u662f\u4e0d\u751f\u6548\u7684\u3002\u4f1a\u62a5return_value not defined\uff0c\u4f46\u662f\u5355\u4e2a\u6267\u884c\u6587\u4ef6\u786e\u5b9e\u662f\u53ef\u4ee5\u3002 \u4e8e\u662f\u6211\u91c7\u7528\u4e86\u65b0\u7684\u65b9\u6cd5\uff0c\u5b9a\u4e49\u4e00\u4e2adict\uff0c\u4f20\u7ed9exec\uff0c\u8fd9\u6837exec\u91cc\u9762\u7528\u5230\u7684\u53d8\u91cf\u7b49\u4fe1\u606f\uff0c\u90fd\u4f1a\u8fd4\u56de\u5230dict\u91cc\u9762\u3002 command = \"\"\" from datetime import datetime return_value = datetime.today().strftime(\"%Y-%m-01\") \"\"\" loc = dict () exec ( command , loc ) print ( loc [ 'return_value' ])","title":"exec\u521d\u4f53\u9a8c"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2895%29%20%E5%89%8D%E7%BD%AE%E6%9D%A1%E4%BB%B6%E6%94%AF%E6%8C%81%E7%AE%80%E5%8D%95%E7%9A%84python%E8%84%9A%E6%9C%AC/#exec_1","text":"\u5176\u5b9e\u672c\u8eab\u662f\u4e0d\u60f3\u63d0\u4f9b\u8fd9\u4e2a\u63a5\u53e3\u7684\uff0c\u56e0\u4e3a\u5927\u90e8\u5206\u811a\u672c\u90fd\u53ef\u4ee5\u5728\u672c\u5730\u6d4b\u8bd5\u540e\u4f20\u4e0a\u6765\uff0c\u4f46\u60f3\u4e86\u4e0b\uff0c\u6709\u5c31\u6709\u5427\uff0c\u5bf9\u4e8eos.remove\u8fd9\u6837\u5371\u9669\u7684\u8bed\u53e5\u8fd8\u662f\u5f97\u7981\u6b62\u6389\u3002 \u4e0d\u8fc7\u7531\u4e8e\u662f\u6f14\u793a\uff0c\u6211\u5c31\u4e0d\u7981\u6b62\u4e86\u3002 \u5148\u770b\u4e00\u5f20\u6548\u679c\u56fe\uff0c\u6267\u884c\u5b8c\u6210\u540e\u4f1a\u6709\u6570\u636e\u8fd4\u56de\u3002\u4f46\u4e00\u5b9a\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5982\u679c\u60f3\u62ff\u5230\u8fd4\u56de\u503c\uff0c\u5fc5\u987b\u8981\u6709: current_time = xxx \uff0c\u5e76\u4e14\u628a\u8fd4\u56de\u503c\u8bbe\u7f6e\u4e3acurrent_time\u3002 \u4e3a\u4ec0\u4e48\u5462\uff1f\u56e0\u4e3aexec\u672c\u8eab\u662f\u62ff\u4e0d\u5230\u8fd4\u56de\u503c\u7684\uff0c\u5982\u679c\u4f60\u53bbexec\u8bed\u53e5\u91cc\u9762\u5b9a\u4e49\u4e00\u4e2a\u53d8\u91cf: current_time2 = \"234\" \u8fd9\u6837\u5c31\u80fd\u5728loc\u91cc\u9762\u53d6\u5230\u8fd4\u56de\u503c\u4e86\uff0c\u6240\u4ee5\u5982\u679c\u8981\u6c42\u6709\u8fd4\u56de\u503c\uff0c\u5219\u5fc5\u987b\u5199\u4e0a\u4e0a\u8ff0\u7684python\u8bed\u53e5\u3002 \u6211\u4eec\u5c31\u662f\u901a\u8fc7exec\u6267\u884c\u4ee3\u7801\uff0c\u5b9a\u4e49\u53d8\u91cf\u4e3a\u8fd4\u56de\u503c\uff0c\u63a5\u7740\u53d6\u51fa\u8be5\u53d8\u91cf\u7684\u65b9\u5f0f\u5b9e\u73b0\u6574\u4e2a\u8fc7\u7a0b\u7684\u3002 \u6765\u770b\u4e0b\u4ee3\u7801\u600e\u4e48\u5199: \u548c\u4e0a\u6587\u63d0\u5230\u7684\u4e00\u6837\uff0c\u5982\u679c\u6ca1\u6709\u8fd4\u56de\u503c\u7684\u8bdd\uff0c\u76f4\u63a5\u5c31\u662fNone\u4e86\u3002","title":"\u7f16\u5199\u5728\u7ebf\u6267\u884cexec\u63a5\u53e3"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2895%29%20%E5%89%8D%E7%BD%AE%E6%9D%A1%E4%BB%B6%E6%94%AF%E6%8C%81%E7%AE%80%E5%8D%95%E7%9A%84python%E8%84%9A%E6%9C%AC/#python","text":"\u548credis\u64cd\u4f5c\u5f88\u76f8\u4f3c\uff0c\u5b9e\u73b0run\u65b9\u6cd5\uff0c\u4e5f\u662f\u8bb0\u5f55\u6570\u636e\u5e76\u62ff\u5230\u8fd4\u56de\u503c\u3002","title":"\u7f16\u5199python\u6570\u636e\u6784\u9020\u5668"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2895%29%20%E5%89%8D%E7%BD%AE%E6%9D%A1%E4%BB%B6%E6%94%AF%E6%8C%81%E7%AE%80%E5%8D%95%E7%9A%84python%E8%84%9A%E6%9C%AC/#_2","text":"\u65b0\u589ePython\u7c7b\u578b\uff0c\u6ce8\u610f\u8fd9\u91cc\u6211\u628a\u8fd9\u4e9b\u6570\u5b57\uff0c0-3\u90fd\u653e\u5230\u4e86Config\u7c7b\u91cc\u9762\u3002 \u63d0\u9192\u4e00\u4e0b\u5404\u4f4d\uff0c\u6bd4\u5982\u6211\u8fd9\u91cc\u7684\u65b9\u6cd5\u6ca1\u6709\u7ed9\u51fa\u5bf9\u5e94\u7684\u6587\u4ef6\u8def\u5f84\uff0c\u5927\u5bb6\u53ef\u4ee5\u5168\u5c40\u641c\u7d22\uff0c\u627e\u5230\u4e4b\u3002 \u5bf9\u5e94Config.py\u4e5f\u589e\u52a0\u4e86\u8fd9\u6837\u7684\u5b50\u7c7b\u3002","title":"\u6539\u5199\u83b7\u53d6\u6570\u636e\u6784\u9020\u5668\u7684\u65b9\u6cd5"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2895%29%20%E5%89%8D%E7%BD%AE%E6%9D%A1%E4%BB%B6%E6%94%AF%E6%8C%81%E7%AE%80%E5%8D%95%E7%9A%84python%E8%84%9A%E6%9C%AC/#_3","text":"\u9875\u9762\u57fa\u672c\u662f\u6cbf\u7528\u7684Redis\u7684\u90e8\u5206\uff0c\u5728\u5916\u90e8\u4e5f\u7a0d\u5fae\u6539\u9020\u4e86\u4e00\u4e0b: \u6539\u7528\u5f00\u5173\u7684\u5f62\u5f0f\uff0c\u770b\u8d77\u6765\u66f4\u76f4\u89c2\u3002 \u4eca\u5929\u7684\u5185\u5bb9\u5c31\u4ecb\u7ecd\u5230\u8fd9\u91cc\u4e86\uff0c\u6b22\u8fce\u5927\u5bb6\u79ef\u6781\u63d0\u51fa\u5efa\u8bae\uff0c\u4e00\u8d77\u6253\u9020\u4e00\u6b3e\u5f00\u6e90\u5de5\u5177\u3002","title":"\u524d\u7aef\u90e8\u5206\u7684\u6539\u52a8"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2896%29%20%E5%A6%82%E4%BD%95%E5%81%9C%E6%AD%A2%E6%B5%8B%E8%AF%95%E4%BB%BB%E5%8A%A1%E6%89%A7%E8%A1%8C/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u7684\u524d\u7f6e\u6761\u4ef6\u652f\u6301\u4e86 python\u811a\u672c \u7c7b\u578b\uff0c\u8ba9\u6211\u4eec\u80fd\u591f\u66f4\u7075\u6d3b\u5904\u7406\u6570\u636e\u4e86\u3002 \u4eca\u5929\u6211\u4eec\u5c31\u73a9\u70b9\u597d\u73a9\u7684\uff0c\u548c\u5927\u5bb6\u4e00\u8d77\u63a2\u8ba8\uff1a \u600e\u4e48\u505c\u6b62\u4e00\u6bb5python\u4ee3\u7801 \u3002\u4e4b\u540e\u6211\u4eec\u5c06\u4f1a\u8fd0\u7528\u5230pity\u4e4b\u4e2d\u3002 \u77e5\u8bc6\u8981\u70b9 \u672c\u6587\u9700\u8981\u5927\u5bb6\u5bf9 asyncio \u76f8\u5173\u77e5\u8bc6\u6709\u4e00\u4e9b\u4e86\u89e3\uff0c\u81f3\u4e8e\u539f\u7406\u65b9\u9762\uff0c\u5927\u5bb6\u53ef\u4ee5\u81ea\u884c\u67e5\u9605\uff0c\u56e0\u4e3a\u6211\u4e5f\u6ca1\u7ec6\u770b\u3002 \u4e3a\u4ec0\u4e48\u8981\u505a\u8fd9\u4e2a\uff1f \u9488\u5bf9 \u6d4b\u8bd5\u4efb\u52a1 \u6267\u884c\u975e\u5e38\u4e45\u7684\u65f6\u5019\uff0c\u770b\u8d77\u6765\u4f1a\u662f\u963b\u585e\u7684\u60c5\u51b5\uff0c\u4e3e\u4e2a\u4f8b\u5b50: \u67d0\u4e2apython\u811a\u672c\u91cc\u9762\u5199\u4e86time.sleep(1000)\uff0c\u5bfc\u81f4\u4f60\u7684case\u4e00\u76f4\u597d\u50cf\u6ca1\u6709\u6267\u884c\u5b8c\u6210\uff0c\u90a3\u6211\u4eec\u60f3\u7ed3\u675f\u5b83\uff0c\u8be5\u548b\u6574\u5462\uff1f \u4eca\u5929\u535a\u4e3b\u8981\u804a\u7684\u5c31\u662f\u8fd9\u65b9\u9762\u7684\u5185\u5bb9\u3002 \u5148\u770b\u770b\"\u96be\u9898\" \u6211\u4eec\u6765\u5199\u4e00\u4e2a\u7b80\u5355\u7684demo\u3002 \u6211\u4eec\u5148\u5b9a\u4e49\u4e00\u4e2a\u5f02\u6b65\u65e0\u9650\u5faa\u73af\u7684\u65b9\u6cd5\uff0c\u8ba9\u5b83\u6bcf\u9694\u4e00\u79d2\u5c31\u6253\u5370\u4e00\u884c\u5185\u5bb9 import asyncio async def run (): while True : print ( \"still alive\" ) await asyncio . sleep ( 1 ) \u8bd5\u60f3\u4e00\u4e0b\uff0c\u5982\u679c\u8fd9\u4e2a\u65b9\u6cd5\u5f00\u542f\u4e86\uff0c\u4e0d\u7ed3\u675f\u5b83\uff0c \u5b83\u662f\u4e0d\u662f\u4f1a\u4e00\u76f4\u6253\u5370\u4e0b\u53bb \uff1f\u6ca1\u9519\uff0c\u6211\u4eec\u5148\u8bd5\u8bd5\u76f4\u63a5\u8fd0\u884c\u4e4b: \u5f88\u663e\u7136\uff0c\u5b83\u662f\u7edd\u5bf9\u4e0d\u4f1a\u505c\u6b62\u7684\uff0c\u9664\u975e\u4f60\u5173\u95ed\u8fd9\u4e2apy\u7a0b\u5e8f\u3002 \u6211\u4eec\u628a\u5b83 \u60f3\u8c61\u6210 \u540c\u6b65\u65b9\u6cd5\uff0c\u662f\u4e0d\u662f\u4e5f\u4f1a\u9047\u5230\u8fd9\u4e2a\u56f0\u96be: import time def run (): time . sleep ( 10000 ) if __name__ == \"__main__\" : run () print ( \"done\" ) \u53ef\u4ee5\u53d1\u73b0run\u4e00\u65e6\u5f00\u59cb\uff0c\u5b83\u5c31 \u963b\u585e \u4e86\u6574\u4e2a\u7a0b\u5e8f\uff0c\u4e0b\u9762\u7684done\u5fc5\u987b\u8981\u7b49run\u7ed3\u675f\u4e86\u624d\u80fd\u6253\u5370\u51fa\u6765\u3002 \u600e\u4e48\u505c\u6b62run \u6211\u4eec\u90fd\u77e5\u9053\uff0c\u5728python3.4\u4ee5\u540e\u65b0\u589e\u4e86\u5f02\u6b65\u7f16\u7a0b\u76f8\u5173\u7684\u6982\u5ff5\uff0c\u6700\u521d\u662f\u7531@coroutine\u8fd9\u6837\u7684\u88c5\u9970\u5668\u653e\u5230\u65b9\u6cd5\u4e0a\uff0c\u628a\u65b9\u6cd5\u6807\u6ce8\u4e3a \u5f02\u6b65\u65b9\u6cd5 \uff0c\u540e\u9762\u76f4\u63a5\u4ece\u8bed\u8a00\u5c42\u9762\u652f\u6301\u4e86\u5f02\u6b65\u65b9\u6cd5\u5b9a\u4e49(async)\uff0c\u90a3\u5176\u5b9e\u91cc\u9762\u8fd8\u6709\u5f88\u591a\u6211\u4eec\u4e0d\u592a\u5e38\u7528\u7684\u90e8\u5206\uff0c\u6bd4\u5982\u4eca\u5929\u8981\u8bf4\u7684create_task\u3002 \u6211\u4eec\u6539\u5199\u4e0b\u65b9\u6cd5 import asyncio async def run (): while True : print ( \"still alive\" ) await asyncio . sleep ( 1 ) async def main (): await asyncio . create_task ( run ()) if __name__ == \"__main__\" : asyncio . run ( main ()) \u8fd9\u6b21\u6211\u4eec\u5305\u4e86\u4e00\u5c42\u65b9\u6cd5\uff0c\u5229\u7528 asyncio.create_task \u6765\u521b\u5efa\u5f02\u6b65\u4efb\u52a1\uff0ccreate_task\u63a5\u6536\u4e00\u4e2acoroutine\u5e76\u6267\u884c\u3002 \u6267\u884c\u4e4b\u540e\uff0c\u53ef\u4ee5\u53d1\u73b0\u8fd9\u4e2a\u548c\u4e0a\u9762\u7684\u60c5\u51b5\uff0c\u4efb\u52a1\u4e5f\u4f1a\u4e00\u76f4\u8fdb\u884c\u4e0b\u53bb\u3002 \u6211\u4eec\u7ee7\u7eed\u4e0b\u4e00\u6b65\u6539\u9020: \u6211\u4eec\u53bb\u6389 await \uff0c\u53ef\u4ee5\u770b\u5230run\u65b9\u6cd5\u786e\u5b9e\u6267\u884c\u4e86\uff0c\u4f46\u662fstill alive\u53ea\u6253\u5370\u4e86\u4e00\u6b21\u5c31\u7ed3\u675f\u4e86\u3002 \u6211\u5bf9\u5b83\u7684\u7406\u89e3\u662f\uff0c\u867d\u7136create_task\u521b\u5efa\u4e86\u4e00\u4e2a \u5f02\u6b65\u4efb\u52a1 \uff0c\u4f46\u6ca1\u8bf4\u8981await\uff0c\u4e5f\u5c31\u662f\u8bf4\u6ca1\u6709\u8bf4\u8981\u7b49\u5b83\u7ed3\u675f\u3002 \u60f3\u8c61\u4e00\u4e0b\u8fd9\u4e9b\u5f02\u6b65\u4efb\u52a1\u90fd\u7531\u4e00\u4e2a\u4e8b\u4ef6\u5faa\u73af\u63a7\u5236\uff0c\u5f53\u4f60\u6267\u884cmain(main\u672c\u8eab\u4e5f\u662f\u4e00\u4e2a\u5f02\u6b65\u4efb\u52a1)\u7684\u65f6\u5019\uff0casyncio.run\u9ed8\u8ba4\u662f\u8981\u6267\u884c\u5230 main\u65b9\u6cd5 \u6267\u884c\u5b8c\u6bd5\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u73b0\u5728\u4e8b\u4ef6\u5faa\u73af\u7b49\u5f85main\u65b9\u6cd5\u6267\u884c\u5b8c\u6bd5\uff0cmain\u65b9\u6cd5\u91cc\u9762\u53c8\u521b\u5efa\u4e86\u4e00\u4e2a\u5f02\u6b65\u4efb\u52a1\uff0c\u4f46\u6ca1\u6709\u5f3a\u8c03\u9700\u8981\u8be5\u4efb\u52a1\u5b8c\u6210\uff0c\u521b\u5efa\u5b8c\u6bd5\u540e\uff0c\u7531\u4e8emain\u4efb\u52a1\u5df2\u7ecf\u5b8c\u6210\u4e86\uff0c\u5c31\u5bfc\u81f4\u6574\u4e2a\u4e8b\u4ef6\u7ed3\u675f\u4e86\u3002 \u68b3\u7406\u4e00\u4e0b: \u6709await \u7ebf\u7a0b\u5f00\u542f -> \u6267\u884cmain -> main\u91cc\u9762\u521b\u5efa\u5f02\u6b65\u4efb\u52a1run -> \u7b49\u5f85\u5f02\u6b65\u4efb\u52a1run\uff08\u4e00\u76f4\u7b49\u4e00\u76f4\u7b49\uff09 \u7531\u4e8e\u4e3b\u7ebf\u7a0b\u6ca1\u6709\u7ed3\u675f\uff0c\u6240\u4ee5\u6574\u4e2apython\u7a0b\u5e8f\u4e00\u76f4\u5728\u7b49\u5f85\u5f02\u6b65\u4efb\u52a1\u6267\u884c\u5b8c\u6bd5\uff0c\u6bd5\u7adf\u5b83\u662f\u6b7b\u5faa\u73af\uff0c\u6240\u4ee5\u4f1a\u4e00\u76f4\u7b49\u4e0b\u53bb\u3002 \u65e0await \u7ebf\u7a0b\u5f00\u542f -> \u6267\u884cmain -> main\u91cc\u9762\u521b\u5efa\u5f02\u6b65\u4efb\u52a1run -> \u4e0d\u7b49\u5f85\u5f02\u6b65\u4efb\u52a1run -> main\u65b9\u6cd5\u7ed3\u675f -> \u7ebf\u7a0b\u7ed3\u675f -> \u7a0b\u5e8f\u9000\u51fa \u4ee5\u4e0a\u90fd\u662f\u4e2a\u4eba\u7ed3\u5408go\u7684goroutine\u7ed9\u51fa\u7684\u7406\u89e3\u3002\u80af\u5b9a\u4f1a\u6709\u4e00\u4e9b\u5dee\u522b\u7684\u5730\u65b9\u3002 \u518d\u6b21\u6539\u9020 \u5176\u5b9ecreate_task\u4f1a\u8fd4\u56de\u4e00\u4e2atask\u5bf9\u8c61\uff0c\u91cc\u9762\u6709done\u548ccancel\u65b9\u6cd5\uff0c\u4e5f\u5c31\u662f\u8bf4\u54b1\u4eec\u53ef\u4ee5\u53d6\u6d88\u4ed6\u4e5f\u53ef\u4ee5\u5b8c\u6210\u4ed6\u3002 import asyncio async def run (): while True : print ( \"still alive\" ) await asyncio . sleep ( 1 ) async def main (): task = asyncio . create_task ( run ()) await asyncio . sleep ( 2 ) # 2\u79d2\u540e\uff0c\u5c31\u505c\u6389\u8fd9\u4e2a\u4efb\u52a1 task . cancel () print ( \"task\u4efb\u52a1\u7ed3\u675f\u4e86\uff0cmain\u4e5f\u5373\u5c06\u5b8c\u6210\uff0c\u6574\u4e2a\u7a0b\u5e8f\u5373\u5c06\u9000\u51fa\" ) if __name__ == \"__main__\" : asyncio . run ( main ()) \u4e00\u65e6\u8c03\u7528\u4e86create_task\uff0c\u90a3\u4e48 \u4efb\u52a1\u5c31\u5df2\u7ecf\u5f00\u59cb\u4e86 \uff0c\u63a5\u7740\u6211\u4eec\u7528await\u8ba9main\u7b49\u5f852\u79d2\uff0c\u518d\u8c03\u7528 task.cancel \u65b9\u6cd5\u5c31\u53ef\u4ee5\u53d6\u6d88\u8fd9\u4e2atask\uff0c\u8fd9\u6837\u6240\u6709\u4e8b\u4ef6\u90fd\u7ed3\u675f\uff0c\u7a0b\u5e8f\u4e5f\u4f1a\u9000\u51fa\u4e86\u3002 \u770b\u770bgif: \u8fd9\u65f6\u5019\u6709\u7684\u540c\u5b66\u53ef\u80fd\u4f1a\u95ee\u4e86\uff0cawait2\u79d2\u4ee5\u540e\uff0c\u4e0d\u7ba1\u4f60\u662f\u5426\u8c03\u7528cancel\uff0c\u56e0\u4e3a\u6ca1\u6709await task\uff0c\u6240\u4ee5\u7a0b\u5e8f\u7167\u6837\u4f1a\u9000\u51fa\u554a\uff0c \u6ca1\u6cd5\u8bc1\u660etask\u771f\u7684\u88abcancel\u4e86 \u3002 \u4ed4\u7ec6\u60f3\u60f3\uff0c\u786e\u5b9e\u8bf4\u7684\u6709\u9053\u7406\u3002\u90a3\u6211\u4eec\u518d\u6765\u6539\u9020\u4e0b: \u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u4e2atask\u6b7b\u4e4b\u524d\u8fd8\u505a\u4e86 \u5782\u6b7b\u6323\u624e \uff01\uff01\uff01 \u52a0\u4e0aawait \u53ef\u4ee5\u770b\u5230\u52a0\u4e0aawait\u4e4b\u540e\uff0c\u5b83\u8fd8\u662f\u4e0d\u4f1a \u505c\u6b62 \u3002 \u90a3\u6211\u4eec\u52a0\u4e0acancel\u8bd5\u8bd5: \u5f88\u9057\u61be\uff0c\u62a5\u9519\u4e86~~~\u4e0d\u8fc7\u6ca1\u5173\u7cfb\uff0c\u6211\u4eec\u7ee7\u7eed\u6539\u4e0b\u3002\u53ea\u9700\u8981\u52a0\u4e0a\u5f02\u5e38\u5904\u7406\uff0c\u5c31\u53ef\u4ee5\u5b8c\u7f8e\u5b9e\u73b02\u79d2\u540e \u81ea\u52a8\u53d6\u6d88\u4efb\u52a1 \u4e86\u3002 \u4f46\u8fd9\u4e2a\u4f8b\u5b50\u4f9d\u7136\u4e0d\u662f\u5f88\u5e05\uff0c\u5982\u679c\u53ea\u662f\u60f3 \u63a7\u5236 \u5f02\u6b65\u4efb\u52a1\u7684\u6267\u884c\u65f6\u95f4\uff0c\u90a3\u6211\u4eec\u53ef\u4ee5\u7528wait_for\uff1a import asyncio async def run (): while True : print ( \"still alive\" ) await asyncio . sleep ( 1 ) async def main (): try : await asyncio . wait_for ( run (), 2 ) except asyncio . TimeoutError : print ( \"run\u65b9\u6cd5\u8d85\u8fc72\u79d2\u4ecd\u672a\u6267\u884c\u5b8c\u6210\" ) if __name__ == \"__main__\" : asyncio . run ( main ()) \u8fd9\u68372\u79d2\u540e\uff0c\u4efb\u52a1\u8fd8\u6ca1\u7ed3\u675f\u4e5f\u4e0d\u4f1a\u7ee7\u7eed\u6267\u884c\u4e86\u3002 \u53bb\u6389\u6b7b\u5faa\u73af\u4ee5\u540e\uff0c\u4efb\u52a1\u4f1a\u57282\u79d2\u5185\u5b8c\u6210\uff08\u56e0\u4e3a\u53ea\u7b49\u5f851\u79d2\uff09\uff0c\u8fd9\u65f6\u5019\u5c31\u53ef\u4ee5\u770b\u5230 timeout\u5f02\u5e38\u4e0d\u4f1a\u88ab\u89e6\u53d1 \u3002 emmmm, \u4eca\u5929\u7684\u5185\u5bb9\u5c31\u4ecb\u7ecd\u5230\u8fd9\u4e86\uff0c\u5f02\u6b65\u8fd8\u6709\u633a\u591a\u73a9\u6cd5\u7684\uff0c\u6211\u4e5f\u4e0d\u662f\u5f88\u6e05\u695a\uff0c\u5927\u5bb6\u53ef\u4ee5\u4e92\u76f8 \u4ea4\u6d41\u4ea4\u6d41 ~~~","title":"96.\u5982\u4f55\u505c\u6b62\u6d4b\u8bd5\u4efb\u52a1\u6267\u884c"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2896%29%20%E5%A6%82%E4%BD%95%E5%81%9C%E6%AD%A2%E6%B5%8B%E8%AF%95%E4%BB%BB%E5%8A%A1%E6%89%A7%E8%A1%8C/#_1","text":"\u4e0a\u4e00\u8282\u6211\u4eec\u7684\u524d\u7f6e\u6761\u4ef6\u652f\u6301\u4e86 python\u811a\u672c \u7c7b\u578b\uff0c\u8ba9\u6211\u4eec\u80fd\u591f\u66f4\u7075\u6d3b\u5904\u7406\u6570\u636e\u4e86\u3002 \u4eca\u5929\u6211\u4eec\u5c31\u73a9\u70b9\u597d\u73a9\u7684\uff0c\u548c\u5927\u5bb6\u4e00\u8d77\u63a2\u8ba8\uff1a \u600e\u4e48\u505c\u6b62\u4e00\u6bb5python\u4ee3\u7801 \u3002\u4e4b\u540e\u6211\u4eec\u5c06\u4f1a\u8fd0\u7528\u5230pity\u4e4b\u4e2d\u3002","title":"\u56de\u987e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2896%29%20%E5%A6%82%E4%BD%95%E5%81%9C%E6%AD%A2%E6%B5%8B%E8%AF%95%E4%BB%BB%E5%8A%A1%E6%89%A7%E8%A1%8C/#_2","text":"\u672c\u6587\u9700\u8981\u5927\u5bb6\u5bf9 asyncio \u76f8\u5173\u77e5\u8bc6\u6709\u4e00\u4e9b\u4e86\u89e3\uff0c\u81f3\u4e8e\u539f\u7406\u65b9\u9762\uff0c\u5927\u5bb6\u53ef\u4ee5\u81ea\u884c\u67e5\u9605\uff0c\u56e0\u4e3a\u6211\u4e5f\u6ca1\u7ec6\u770b\u3002","title":"\u77e5\u8bc6\u8981\u70b9"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2896%29%20%E5%A6%82%E4%BD%95%E5%81%9C%E6%AD%A2%E6%B5%8B%E8%AF%95%E4%BB%BB%E5%8A%A1%E6%89%A7%E8%A1%8C/#_3","text":"\u9488\u5bf9 \u6d4b\u8bd5\u4efb\u52a1 \u6267\u884c\u975e\u5e38\u4e45\u7684\u65f6\u5019\uff0c\u770b\u8d77\u6765\u4f1a\u662f\u963b\u585e\u7684\u60c5\u51b5\uff0c\u4e3e\u4e2a\u4f8b\u5b50: \u67d0\u4e2apython\u811a\u672c\u91cc\u9762\u5199\u4e86time.sleep(1000)\uff0c\u5bfc\u81f4\u4f60\u7684case\u4e00\u76f4\u597d\u50cf\u6ca1\u6709\u6267\u884c\u5b8c\u6210\uff0c\u90a3\u6211\u4eec\u60f3\u7ed3\u675f\u5b83\uff0c\u8be5\u548b\u6574\u5462\uff1f \u4eca\u5929\u535a\u4e3b\u8981\u804a\u7684\u5c31\u662f\u8fd9\u65b9\u9762\u7684\u5185\u5bb9\u3002","title":"\u4e3a\u4ec0\u4e48\u8981\u505a\u8fd9\u4e2a\uff1f"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2896%29%20%E5%A6%82%E4%BD%95%E5%81%9C%E6%AD%A2%E6%B5%8B%E8%AF%95%E4%BB%BB%E5%8A%A1%E6%89%A7%E8%A1%8C/#_4","text":"\u6211\u4eec\u6765\u5199\u4e00\u4e2a\u7b80\u5355\u7684demo\u3002 \u6211\u4eec\u5148\u5b9a\u4e49\u4e00\u4e2a\u5f02\u6b65\u65e0\u9650\u5faa\u73af\u7684\u65b9\u6cd5\uff0c\u8ba9\u5b83\u6bcf\u9694\u4e00\u79d2\u5c31\u6253\u5370\u4e00\u884c\u5185\u5bb9 import asyncio async def run (): while True : print ( \"still alive\" ) await asyncio . sleep ( 1 ) \u8bd5\u60f3\u4e00\u4e0b\uff0c\u5982\u679c\u8fd9\u4e2a\u65b9\u6cd5\u5f00\u542f\u4e86\uff0c\u4e0d\u7ed3\u675f\u5b83\uff0c \u5b83\u662f\u4e0d\u662f\u4f1a\u4e00\u76f4\u6253\u5370\u4e0b\u53bb \uff1f\u6ca1\u9519\uff0c\u6211\u4eec\u5148\u8bd5\u8bd5\u76f4\u63a5\u8fd0\u884c\u4e4b: \u5f88\u663e\u7136\uff0c\u5b83\u662f\u7edd\u5bf9\u4e0d\u4f1a\u505c\u6b62\u7684\uff0c\u9664\u975e\u4f60\u5173\u95ed\u8fd9\u4e2apy\u7a0b\u5e8f\u3002 \u6211\u4eec\u628a\u5b83 \u60f3\u8c61\u6210 \u540c\u6b65\u65b9\u6cd5\uff0c\u662f\u4e0d\u662f\u4e5f\u4f1a\u9047\u5230\u8fd9\u4e2a\u56f0\u96be: import time def run (): time . sleep ( 10000 ) if __name__ == \"__main__\" : run () print ( \"done\" ) \u53ef\u4ee5\u53d1\u73b0run\u4e00\u65e6\u5f00\u59cb\uff0c\u5b83\u5c31 \u963b\u585e \u4e86\u6574\u4e2a\u7a0b\u5e8f\uff0c\u4e0b\u9762\u7684done\u5fc5\u987b\u8981\u7b49run\u7ed3\u675f\u4e86\u624d\u80fd\u6253\u5370\u51fa\u6765\u3002","title":"\u5148\u770b\u770b\"\u96be\u9898\""},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2896%29%20%E5%A6%82%E4%BD%95%E5%81%9C%E6%AD%A2%E6%B5%8B%E8%AF%95%E4%BB%BB%E5%8A%A1%E6%89%A7%E8%A1%8C/#run","text":"\u6211\u4eec\u90fd\u77e5\u9053\uff0c\u5728python3.4\u4ee5\u540e\u65b0\u589e\u4e86\u5f02\u6b65\u7f16\u7a0b\u76f8\u5173\u7684\u6982\u5ff5\uff0c\u6700\u521d\u662f\u7531@coroutine\u8fd9\u6837\u7684\u88c5\u9970\u5668\u653e\u5230\u65b9\u6cd5\u4e0a\uff0c\u628a\u65b9\u6cd5\u6807\u6ce8\u4e3a \u5f02\u6b65\u65b9\u6cd5 \uff0c\u540e\u9762\u76f4\u63a5\u4ece\u8bed\u8a00\u5c42\u9762\u652f\u6301\u4e86\u5f02\u6b65\u65b9\u6cd5\u5b9a\u4e49(async)\uff0c\u90a3\u5176\u5b9e\u91cc\u9762\u8fd8\u6709\u5f88\u591a\u6211\u4eec\u4e0d\u592a\u5e38\u7528\u7684\u90e8\u5206\uff0c\u6bd4\u5982\u4eca\u5929\u8981\u8bf4\u7684create_task\u3002 \u6211\u4eec\u6539\u5199\u4e0b\u65b9\u6cd5 import asyncio async def run (): while True : print ( \"still alive\" ) await asyncio . sleep ( 1 ) async def main (): await asyncio . create_task ( run ()) if __name__ == \"__main__\" : asyncio . run ( main ()) \u8fd9\u6b21\u6211\u4eec\u5305\u4e86\u4e00\u5c42\u65b9\u6cd5\uff0c\u5229\u7528 asyncio.create_task \u6765\u521b\u5efa\u5f02\u6b65\u4efb\u52a1\uff0ccreate_task\u63a5\u6536\u4e00\u4e2acoroutine\u5e76\u6267\u884c\u3002 \u6267\u884c\u4e4b\u540e\uff0c\u53ef\u4ee5\u53d1\u73b0\u8fd9\u4e2a\u548c\u4e0a\u9762\u7684\u60c5\u51b5\uff0c\u4efb\u52a1\u4e5f\u4f1a\u4e00\u76f4\u8fdb\u884c\u4e0b\u53bb\u3002 \u6211\u4eec\u7ee7\u7eed\u4e0b\u4e00\u6b65\u6539\u9020: \u6211\u4eec\u53bb\u6389 await \uff0c\u53ef\u4ee5\u770b\u5230run\u65b9\u6cd5\u786e\u5b9e\u6267\u884c\u4e86\uff0c\u4f46\u662fstill alive\u53ea\u6253\u5370\u4e86\u4e00\u6b21\u5c31\u7ed3\u675f\u4e86\u3002 \u6211\u5bf9\u5b83\u7684\u7406\u89e3\u662f\uff0c\u867d\u7136create_task\u521b\u5efa\u4e86\u4e00\u4e2a \u5f02\u6b65\u4efb\u52a1 \uff0c\u4f46\u6ca1\u8bf4\u8981await\uff0c\u4e5f\u5c31\u662f\u8bf4\u6ca1\u6709\u8bf4\u8981\u7b49\u5b83\u7ed3\u675f\u3002 \u60f3\u8c61\u4e00\u4e0b\u8fd9\u4e9b\u5f02\u6b65\u4efb\u52a1\u90fd\u7531\u4e00\u4e2a\u4e8b\u4ef6\u5faa\u73af\u63a7\u5236\uff0c\u5f53\u4f60\u6267\u884cmain(main\u672c\u8eab\u4e5f\u662f\u4e00\u4e2a\u5f02\u6b65\u4efb\u52a1)\u7684\u65f6\u5019\uff0casyncio.run\u9ed8\u8ba4\u662f\u8981\u6267\u884c\u5230 main\u65b9\u6cd5 \u6267\u884c\u5b8c\u6bd5\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u73b0\u5728\u4e8b\u4ef6\u5faa\u73af\u7b49\u5f85main\u65b9\u6cd5\u6267\u884c\u5b8c\u6bd5\uff0cmain\u65b9\u6cd5\u91cc\u9762\u53c8\u521b\u5efa\u4e86\u4e00\u4e2a\u5f02\u6b65\u4efb\u52a1\uff0c\u4f46\u6ca1\u6709\u5f3a\u8c03\u9700\u8981\u8be5\u4efb\u52a1\u5b8c\u6210\uff0c\u521b\u5efa\u5b8c\u6bd5\u540e\uff0c\u7531\u4e8emain\u4efb\u52a1\u5df2\u7ecf\u5b8c\u6210\u4e86\uff0c\u5c31\u5bfc\u81f4\u6574\u4e2a\u4e8b\u4ef6\u7ed3\u675f\u4e86\u3002 \u68b3\u7406\u4e00\u4e0b: \u6709await \u7ebf\u7a0b\u5f00\u542f -> \u6267\u884cmain -> main\u91cc\u9762\u521b\u5efa\u5f02\u6b65\u4efb\u52a1run -> \u7b49\u5f85\u5f02\u6b65\u4efb\u52a1run\uff08\u4e00\u76f4\u7b49\u4e00\u76f4\u7b49\uff09 \u7531\u4e8e\u4e3b\u7ebf\u7a0b\u6ca1\u6709\u7ed3\u675f\uff0c\u6240\u4ee5\u6574\u4e2apython\u7a0b\u5e8f\u4e00\u76f4\u5728\u7b49\u5f85\u5f02\u6b65\u4efb\u52a1\u6267\u884c\u5b8c\u6bd5\uff0c\u6bd5\u7adf\u5b83\u662f\u6b7b\u5faa\u73af\uff0c\u6240\u4ee5\u4f1a\u4e00\u76f4\u7b49\u4e0b\u53bb\u3002 \u65e0await \u7ebf\u7a0b\u5f00\u542f -> \u6267\u884cmain -> main\u91cc\u9762\u521b\u5efa\u5f02\u6b65\u4efb\u52a1run -> \u4e0d\u7b49\u5f85\u5f02\u6b65\u4efb\u52a1run -> main\u65b9\u6cd5\u7ed3\u675f -> \u7ebf\u7a0b\u7ed3\u675f -> \u7a0b\u5e8f\u9000\u51fa \u4ee5\u4e0a\u90fd\u662f\u4e2a\u4eba\u7ed3\u5408go\u7684goroutine\u7ed9\u51fa\u7684\u7406\u89e3\u3002\u80af\u5b9a\u4f1a\u6709\u4e00\u4e9b\u5dee\u522b\u7684\u5730\u65b9\u3002 \u518d\u6b21\u6539\u9020 \u5176\u5b9ecreate_task\u4f1a\u8fd4\u56de\u4e00\u4e2atask\u5bf9\u8c61\uff0c\u91cc\u9762\u6709done\u548ccancel\u65b9\u6cd5\uff0c\u4e5f\u5c31\u662f\u8bf4\u54b1\u4eec\u53ef\u4ee5\u53d6\u6d88\u4ed6\u4e5f\u53ef\u4ee5\u5b8c\u6210\u4ed6\u3002 import asyncio async def run (): while True : print ( \"still alive\" ) await asyncio . sleep ( 1 ) async def main (): task = asyncio . create_task ( run ()) await asyncio . sleep ( 2 ) # 2\u79d2\u540e\uff0c\u5c31\u505c\u6389\u8fd9\u4e2a\u4efb\u52a1 task . cancel () print ( \"task\u4efb\u52a1\u7ed3\u675f\u4e86\uff0cmain\u4e5f\u5373\u5c06\u5b8c\u6210\uff0c\u6574\u4e2a\u7a0b\u5e8f\u5373\u5c06\u9000\u51fa\" ) if __name__ == \"__main__\" : asyncio . run ( main ()) \u4e00\u65e6\u8c03\u7528\u4e86create_task\uff0c\u90a3\u4e48 \u4efb\u52a1\u5c31\u5df2\u7ecf\u5f00\u59cb\u4e86 \uff0c\u63a5\u7740\u6211\u4eec\u7528await\u8ba9main\u7b49\u5f852\u79d2\uff0c\u518d\u8c03\u7528 task.cancel \u65b9\u6cd5\u5c31\u53ef\u4ee5\u53d6\u6d88\u8fd9\u4e2atask\uff0c\u8fd9\u6837\u6240\u6709\u4e8b\u4ef6\u90fd\u7ed3\u675f\uff0c\u7a0b\u5e8f\u4e5f\u4f1a\u9000\u51fa\u4e86\u3002 \u770b\u770bgif: \u8fd9\u65f6\u5019\u6709\u7684\u540c\u5b66\u53ef\u80fd\u4f1a\u95ee\u4e86\uff0cawait2\u79d2\u4ee5\u540e\uff0c\u4e0d\u7ba1\u4f60\u662f\u5426\u8c03\u7528cancel\uff0c\u56e0\u4e3a\u6ca1\u6709await task\uff0c\u6240\u4ee5\u7a0b\u5e8f\u7167\u6837\u4f1a\u9000\u51fa\u554a\uff0c \u6ca1\u6cd5\u8bc1\u660etask\u771f\u7684\u88abcancel\u4e86 \u3002 \u4ed4\u7ec6\u60f3\u60f3\uff0c\u786e\u5b9e\u8bf4\u7684\u6709\u9053\u7406\u3002\u90a3\u6211\u4eec\u518d\u6765\u6539\u9020\u4e0b: \u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u4e2atask\u6b7b\u4e4b\u524d\u8fd8\u505a\u4e86 \u5782\u6b7b\u6323\u624e \uff01\uff01\uff01 \u52a0\u4e0aawait \u53ef\u4ee5\u770b\u5230\u52a0\u4e0aawait\u4e4b\u540e\uff0c\u5b83\u8fd8\u662f\u4e0d\u4f1a \u505c\u6b62 \u3002 \u90a3\u6211\u4eec\u52a0\u4e0acancel\u8bd5\u8bd5: \u5f88\u9057\u61be\uff0c\u62a5\u9519\u4e86~~~\u4e0d\u8fc7\u6ca1\u5173\u7cfb\uff0c\u6211\u4eec\u7ee7\u7eed\u6539\u4e0b\u3002\u53ea\u9700\u8981\u52a0\u4e0a\u5f02\u5e38\u5904\u7406\uff0c\u5c31\u53ef\u4ee5\u5b8c\u7f8e\u5b9e\u73b02\u79d2\u540e \u81ea\u52a8\u53d6\u6d88\u4efb\u52a1 \u4e86\u3002 \u4f46\u8fd9\u4e2a\u4f8b\u5b50\u4f9d\u7136\u4e0d\u662f\u5f88\u5e05\uff0c\u5982\u679c\u53ea\u662f\u60f3 \u63a7\u5236 \u5f02\u6b65\u4efb\u52a1\u7684\u6267\u884c\u65f6\u95f4\uff0c\u90a3\u6211\u4eec\u53ef\u4ee5\u7528wait_for\uff1a import asyncio async def run (): while True : print ( \"still alive\" ) await asyncio . sleep ( 1 ) async def main (): try : await asyncio . wait_for ( run (), 2 ) except asyncio . TimeoutError : print ( \"run\u65b9\u6cd5\u8d85\u8fc72\u79d2\u4ecd\u672a\u6267\u884c\u5b8c\u6210\" ) if __name__ == \"__main__\" : asyncio . run ( main ()) \u8fd9\u68372\u79d2\u540e\uff0c\u4efb\u52a1\u8fd8\u6ca1\u7ed3\u675f\u4e5f\u4e0d\u4f1a\u7ee7\u7eed\u6267\u884c\u4e86\u3002 \u53bb\u6389\u6b7b\u5faa\u73af\u4ee5\u540e\uff0c\u4efb\u52a1\u4f1a\u57282\u79d2\u5185\u5b8c\u6210\uff08\u56e0\u4e3a\u53ea\u7b49\u5f851\u79d2\uff09\uff0c\u8fd9\u65f6\u5019\u5c31\u53ef\u4ee5\u770b\u5230 timeout\u5f02\u5e38\u4e0d\u4f1a\u88ab\u89e6\u53d1 \u3002 emmmm, \u4eca\u5929\u7684\u5185\u5bb9\u5c31\u4ecb\u7ecd\u5230\u8fd9\u4e86\uff0c\u5f02\u6b65\u8fd8\u6709\u633a\u591a\u73a9\u6cd5\u7684\uff0c\u6211\u4e5f\u4e0d\u662f\u5f88\u6e05\u695a\uff0c\u5927\u5bb6\u53ef\u4ee5\u4e92\u76f8 \u4ea4\u6d41\u4ea4\u6d41 ~~~","title":"\u600e\u4e48\u505c\u6b62run"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2897%29%20%E5%AE%8C%E5%96%84%E6%89%A7%E8%A1%8Ccase%E9%83%A8%E5%88%86/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u8ba8\u8bba\u4e86 \u600e\u4e48\u7ed3\u675f\u4e00\u4e2a\u5f02\u6b65\u4efb\u52a1 \uff0c\u6211\u4eec\u8fd8\u6ca1\u6709\u5b8c\u5168\u8fd0\u7528\u5230\u9879\u76ee\u4e4b\u4e2d\u3002\u4e0d\u8fc7\u6ca1\u5173\u7cfb\uff0c\u6211\u4eec\u8fd8\u6709\u66f4\u7d27\u8981\u7684\u4e8b\u60c5\u8981\u505a: \u7531\u4e8e\u4e4b\u524d\u5b8c\u6210\u4e86\u6570\u636e\u9a71\u52a8\uff0c\u5bfc\u81f4\u6211\u4eec\u6267\u884ccase\u7684\u65f6\u5019\u9700\u8981\u5e26\u4e0a\u73af\u5883\u6570\u636e\u4e86\uff0c\u6240\u4ee5\u4e4b\u524d\u7684\u5728\u7ebf\u6267\u884ccase\u529f\u80fd\u5df2\u7ecf\u4e0d\u80fd\u7ee7\u7eed\u7528\u4e86\u3002 \u4f1a\u51fa\u73b0\u4e0a\u8ff0\u95ee\u9898\uff0c\u6211\u4eec\u9700\u8981\u6539\u9020\u4e0b\u524d\u540e\u7aef\u3002 \u5148\u770b\u770b\u7597\u6548 \u6267\u884c\u5355\u4e2acase\u7684\u65f6\u5019\u5fc5\u987b\u9009\u62e9\u73af\u5883\u3002 \u591a\u9009\u7684\u65f6\u5019\u4e5f\u4f1a\u51fa\u73b0\u73af\u5883\u3002 \u6267\u884c2\u6761\u6570\u636e\u540e\uff0c\u4f1a\u51fa\u73b0\u7b80\u5355\u7684\u6d4b\u8bd5\u62a5\u544a\u3002 \u6539\u9020\u540e\u7aef \u6211\u4eec\u662f\u652f\u6301\u6279\u91cfcase\u548c\u5355\u4e2acase\u6267\u884c\u7684\uff0c\u7531\u4e8e\u5386\u53f2\u539f\u56e0\u6211\u4eec\u5c01\u88c5\u4e862\u4e2a\u63a5\u53e3: /request/run /request/run/multiple \u6211\u4eec\u770b\u4e0b\u5bf9\u5e94\u7684\u65b9\u6cd5: \u7531\u4e8e\u6279\u91cf\u6267\u884c\uff0c\u4f1a\u751f\u6210\u4e00\u4e2a\u6d4b\u8bd5\u62a5\u544a\uff0c\u5728\u6d4b\u8bd5\u8ba1\u5212\u90e8\u5206\u6211\u4eec\u5df2\u7ecf\u652f\u6301\u4e86\u73af\u5883\uff0c\u6240\u4ee5\u6211\u4eec\u628a\u524d\u7aef\u53c2\u6570\u4f20\u5165\u5373\u53ef\u3002 run\u65b9\u6cd5\uff0c\u7531\u4e8e\u6211\u4eec\u652f\u6301\u4e86 \u6570\u636e\u9a71\u52a8 \uff0c\u6240\u4ee5\u4e00\u4e2acase\u4f1a\u6709\u591a\u6761\u6570\u636e\u7684\u7ed3\u679c\u3002\u8fd9\u628aerr\u7684\u5224\u65ad\u9700\u8981\u53bb\u6389\uff0c\u56e0\u4e3a\u9519\u8bef\u4fe1\u606f\u5df2\u7ecf\u5728 result \u91cc\u9762\u4e86\uff0c\u4e0d\u80fd\u56e0\u4e3a\u6709\u4e00\u6761\u6570\u636e\u51fa\u9519\u5c31\u505c\u6b62\u5176\u4ed6\u6570\u636e\u3002 \u6700\u540e\u6211\u4eec\u9700\u8981\u628a\u6d4b\u8bd5\u6570\u636e\u548c \u6d4b\u8bd5\u7ed3\u679c \u5bf9\u5e94\u8d77\u6765\uff0c\u6240\u4ee5\u6211\u4eec\u5efa\u7acb\u4e86\u4e00\u4e2aans\u7684\u5b57\u5178\uff0c\u7528\u4e8e\u5b58\u653e \u6d4b\u8bd5\u6570\u636e \u548c\u6d4b\u8bd5\u7ed3\u679c\u7684\u6620\u5c04\u3002 \u6539\u9020\u524d\u7aef \u9700\u8981\u6539\u53d8TestResult\u7ec4\u4ef6 \u5f53\u4f20\u5165map\u7684\u65f6\u5019\uff08\u8bf4\u660e\u662f\u5355\u6761case\u591a\u6761\u6570\u636e\uff0c\u6e32\u67d3\u51faN\u4e2atab\uff09 \u6539\u53d8\u6267\u884c\u548c\u6267\u884c\u7528\u4f8b\u6309\u94ae \u4f7f\u5f97\u6309\u94ae\u53d8\u4e3a\u4e0b\u62c9\u83dc\u5355\u7c7b\u578b\uff0c\u5e76\u628aenv\u53c2\u6570\u5e26\u5165\u3002 \u9875\u9762\u91cc\u9762\u7684\u6267\u884c\u6309\u94ae\u4e5f\u9700\u8981\u4fee\u6539 \u8fd9\u6837\u6211\u4eec\u5c31\u628a\u5bf9\u5e94\u7684\u6267\u884c\u529f\u80fd\u7ed9\u505a\u597d\u4e86\uff0c\u5927\u5bb6\u5c31\u53ef\u4ee5\u5728 \u7f16\u8f91case \u9875\u9762\u8fdb\u884c\u6d4b\u8bd5\u4e86\u3002 \u4eca\u5929\u7684\u5185\u5bb9\u5c31\u4ecb\u7ecd\u5230\u4e86\u8fd9\u91cc\uff0c\u54b1\u4eec\u4e0b\u671f\u518d\u89c1\u3002","title":"97.\u5b8c\u5584\u6267\u884ccase\u90e8\u5206"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2897%29%20%E5%AE%8C%E5%96%84%E6%89%A7%E8%A1%8Ccase%E9%83%A8%E5%88%86/#_1","text":"\u4e0a\u4e00\u8282\u6211\u4eec\u8ba8\u8bba\u4e86 \u600e\u4e48\u7ed3\u675f\u4e00\u4e2a\u5f02\u6b65\u4efb\u52a1 \uff0c\u6211\u4eec\u8fd8\u6ca1\u6709\u5b8c\u5168\u8fd0\u7528\u5230\u9879\u76ee\u4e4b\u4e2d\u3002\u4e0d\u8fc7\u6ca1\u5173\u7cfb\uff0c\u6211\u4eec\u8fd8\u6709\u66f4\u7d27\u8981\u7684\u4e8b\u60c5\u8981\u505a: \u7531\u4e8e\u4e4b\u524d\u5b8c\u6210\u4e86\u6570\u636e\u9a71\u52a8\uff0c\u5bfc\u81f4\u6211\u4eec\u6267\u884ccase\u7684\u65f6\u5019\u9700\u8981\u5e26\u4e0a\u73af\u5883\u6570\u636e\u4e86\uff0c\u6240\u4ee5\u4e4b\u524d\u7684\u5728\u7ebf\u6267\u884ccase\u529f\u80fd\u5df2\u7ecf\u4e0d\u80fd\u7ee7\u7eed\u7528\u4e86\u3002 \u4f1a\u51fa\u73b0\u4e0a\u8ff0\u95ee\u9898\uff0c\u6211\u4eec\u9700\u8981\u6539\u9020\u4e0b\u524d\u540e\u7aef\u3002","title":"\u56de\u987e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2897%29%20%E5%AE%8C%E5%96%84%E6%89%A7%E8%A1%8Ccase%E9%83%A8%E5%88%86/#_2","text":"\u6267\u884c\u5355\u4e2acase\u7684\u65f6\u5019\u5fc5\u987b\u9009\u62e9\u73af\u5883\u3002 \u591a\u9009\u7684\u65f6\u5019\u4e5f\u4f1a\u51fa\u73b0\u73af\u5883\u3002 \u6267\u884c2\u6761\u6570\u636e\u540e\uff0c\u4f1a\u51fa\u73b0\u7b80\u5355\u7684\u6d4b\u8bd5\u62a5\u544a\u3002","title":"\u5148\u770b\u770b\u7597\u6548"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2897%29%20%E5%AE%8C%E5%96%84%E6%89%A7%E8%A1%8Ccase%E9%83%A8%E5%88%86/#_3","text":"\u6211\u4eec\u662f\u652f\u6301\u6279\u91cfcase\u548c\u5355\u4e2acase\u6267\u884c\u7684\uff0c\u7531\u4e8e\u5386\u53f2\u539f\u56e0\u6211\u4eec\u5c01\u88c5\u4e862\u4e2a\u63a5\u53e3: /request/run /request/run/multiple \u6211\u4eec\u770b\u4e0b\u5bf9\u5e94\u7684\u65b9\u6cd5: \u7531\u4e8e\u6279\u91cf\u6267\u884c\uff0c\u4f1a\u751f\u6210\u4e00\u4e2a\u6d4b\u8bd5\u62a5\u544a\uff0c\u5728\u6d4b\u8bd5\u8ba1\u5212\u90e8\u5206\u6211\u4eec\u5df2\u7ecf\u652f\u6301\u4e86\u73af\u5883\uff0c\u6240\u4ee5\u6211\u4eec\u628a\u524d\u7aef\u53c2\u6570\u4f20\u5165\u5373\u53ef\u3002 run\u65b9\u6cd5\uff0c\u7531\u4e8e\u6211\u4eec\u652f\u6301\u4e86 \u6570\u636e\u9a71\u52a8 \uff0c\u6240\u4ee5\u4e00\u4e2acase\u4f1a\u6709\u591a\u6761\u6570\u636e\u7684\u7ed3\u679c\u3002\u8fd9\u628aerr\u7684\u5224\u65ad\u9700\u8981\u53bb\u6389\uff0c\u56e0\u4e3a\u9519\u8bef\u4fe1\u606f\u5df2\u7ecf\u5728 result \u91cc\u9762\u4e86\uff0c\u4e0d\u80fd\u56e0\u4e3a\u6709\u4e00\u6761\u6570\u636e\u51fa\u9519\u5c31\u505c\u6b62\u5176\u4ed6\u6570\u636e\u3002 \u6700\u540e\u6211\u4eec\u9700\u8981\u628a\u6d4b\u8bd5\u6570\u636e\u548c \u6d4b\u8bd5\u7ed3\u679c \u5bf9\u5e94\u8d77\u6765\uff0c\u6240\u4ee5\u6211\u4eec\u5efa\u7acb\u4e86\u4e00\u4e2aans\u7684\u5b57\u5178\uff0c\u7528\u4e8e\u5b58\u653e \u6d4b\u8bd5\u6570\u636e \u548c\u6d4b\u8bd5\u7ed3\u679c\u7684\u6620\u5c04\u3002","title":"\u6539\u9020\u540e\u7aef"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2897%29%20%E5%AE%8C%E5%96%84%E6%89%A7%E8%A1%8Ccase%E9%83%A8%E5%88%86/#_4","text":"\u9700\u8981\u6539\u53d8TestResult\u7ec4\u4ef6 \u5f53\u4f20\u5165map\u7684\u65f6\u5019\uff08\u8bf4\u660e\u662f\u5355\u6761case\u591a\u6761\u6570\u636e\uff0c\u6e32\u67d3\u51faN\u4e2atab\uff09 \u6539\u53d8\u6267\u884c\u548c\u6267\u884c\u7528\u4f8b\u6309\u94ae \u4f7f\u5f97\u6309\u94ae\u53d8\u4e3a\u4e0b\u62c9\u83dc\u5355\u7c7b\u578b\uff0c\u5e76\u628aenv\u53c2\u6570\u5e26\u5165\u3002 \u9875\u9762\u91cc\u9762\u7684\u6267\u884c\u6309\u94ae\u4e5f\u9700\u8981\u4fee\u6539 \u8fd9\u6837\u6211\u4eec\u5c31\u628a\u5bf9\u5e94\u7684\u6267\u884c\u529f\u80fd\u7ed9\u505a\u597d\u4e86\uff0c\u5927\u5bb6\u5c31\u53ef\u4ee5\u5728 \u7f16\u8f91case \u9875\u9762\u8fdb\u884c\u6d4b\u8bd5\u4e86\u3002 \u4eca\u5929\u7684\u5185\u5bb9\u5c31\u4ecb\u7ecd\u5230\u4e86\u8fd9\u91cc\uff0c\u54b1\u4eec\u4e0b\u671f\u518d\u89c1\u3002","title":"\u6539\u9020\u524d\u7aef"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2898%29%20%E5%AE%8C%E5%96%84%E5%90%8E%E7%BD%AE%E6%9D%A1%E4%BB%B6%E5%8A%9F%E8%83%BD/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u5b8c\u5584\u4e86 \u6839\u636e\u73af\u5883\u6267\u884ccase \u529f\u80fd\uff0c\u4e5f\u5dee\u4e0d\u591a\u662f\u6709\u4e86\u5728\u7ebf\u8c03\u8bd5\u7684\u529f\u80fd\u3002\u968f\u7740\u6211\u4eec\u7684\u7cfb\u7edf\u529f\u80fd\u9646\u7eed\u5b8c\u5584\uff0c\u90a3\u6570\u636e\u6e05\u7406\u5668(\u540e\u7f6e\u6761\u4ef6)\u8fd9\u4e2a\u6211\u4eec\u4e00\u76f4 \u6ca1\u89e3\u51b3 \u7684\u4e00\u4e2a\u70b9\uff0c\u5c31\u4e0d\u5f97\u4e0d\u641e\u5b9a\u4e4b\u4e86\u3002 \u7531\u4e8e\u524d\u7f6e\u6761\u4ef6/\u540e\u7f6e\u6761\u4ef6\u5dee\u5f02\u5f88\u5c0f\uff0c\u5e76\u4e14\u6a21\u5f0f\u4e5f\u90fd\u63a5\u8fd1\uff0c\u6240\u4ee5\u4e3a\u4e86\u907f\u514d\u91cd\u590d\u5f00\u53d1\uff0c\u6211\u51b3\u5b9a\u6539\u9020Constructor\u7c7b\uff0c\u5c06\u540e\u7f6e\u6761\u4ef6\u5e76\u5165\u4e4b\u3002 \u8bbe\u8ba1\u601d\u8def \u5728\u6b64\uff0c\u6211\u51b3\u5b9a\u4e0d\u73a9\u975e\u4e3b\u6d41\uff0c\u6062\u590d \u524d\u7f6e/\u540e\u7f6e\u6761\u4ef6 \u7684\u53eb\u6cd5\uff0c\u65b9\u4fbf\u5927\u5bb6\u7406\u89e3\u3002\u4f46\u5df2\u7ecf\u5b9a\u4e49\u597d\u7684\u7c7b: Constructor\u6211\u4e5f\u4e0d\u6539\u540d\u4e86\u3002 \u524d\u7f6e\u6761\u4ef6\u8868\u5982\u4f55\u652f\u6301\u540e\u7f6e\u6761\u4ef6: \u52a0\u4e2a\u6807\u5fd7\u4f4d \u6211\u4eec\u53ef\u4ee5\u4e3aconstructor\u8868\u5b9a\u4e49\u4e00\u4e2a suffix \u5b57\u6bb5\uff0c\u8fd9\u4e2a\u5b57\u6bb5\u662f\u4e2abool\u503c\uff0c\u9ed8\u8ba4\u4e3afalse\u3002 \u8fd9\u6837\u539f\u5148\u6709\u7684\u6570\u636e\uff0c\u5c31\u90fd\u662ffalse\uff0c\u4e5f\u5c31\u4ee3\u8868\u90fd\u662f\u524d\u7f6e\u6761\u4ef6\uff08\u80fd\u4e0d\u5f71\u54cd\u5230\u4e4b\u524dcase\uff09\u3002\u65b0\u52a0\u7684\u6761\u4ef6\uff0c\u6211\u4eec\u7528suffix\u533a\u5206\u5b83\u662f \u524d\u7f6e \u8fd8\u662f \u540e\u7f6e \u3002 \u8bf4\u5230 \u6570\u636e\u5e93\u7684\u53d8\u66f4 \uff0csqlalchemy\u6ca1\u6709\u63d0\u4f9b\u7279\u522b\u65b9\u4fbf\u7684\u65b9\u5f0f\u3002\u6211\u4e00\u822c\u662f\u7528datagrip\u53bb\u4fee\u6539: \u9009\u62e9\u8868\uff0c\u8fdb\u5165\u7f16\u8f91\u8868\u529f\u80fd \u65b0\u589e\u4e00\u4e2a\u5b57\u6bb5 \u70b9\u51fb+\u53f7\uff0c\u63a5\u7740\u7f16\u8f91\u5b57\u6bb5\u4fe1\u606f\u3002 \u7f16\u8f91\u5b57\u6bb5\u4fe1\u606f\u5e76\u9009\u62e9execute \u5176\u5b9e\u4e0b\u9762\u5df2\u7ecf\u7ed9\u51fa\u4e86\u5177\u4f53\u7684sql\uff0c\u76f4\u63a5\u6267\u884c\u4e5f\u4e00\u6837\u3002 alter table pity_constructor add suffix boolean default false not null ; \u5176\u4ed6\u7684\u5305\u62ec\u7d22\u5f15\u5565\u7684\uff0c\u90fd\u662f\u53ef\u4ee5\u8fd9\u6837\u7f16\u8f91\u7684\u3002\uff08\u5982\u679c\u5bf9\u5efa\u8868\uff0c\u52a0\u5b57\u6bb5\u7b49sql\u4e0d\u592a\u719f\u6089\u7684\uff0c\u53ef\u4ee5\u7528\u7528\u8fd9\u4e2a\u5de5\u5177\uff0cpycharm\u5c31\u96c6\u6210\u4e86datagrip\uff09 \u52a8\u624b\u5b9e\u6218 \u8bf4\u5b8c\u4e86\u6838\u5fc3\u601d\u8def\uff0c\u4f46\u5176\u5b9e\u4fee\u6539\u8fc7\u7a0b\u4e2d\u53d1\u73b0\u4e0d\u5c11\u53d8\u5316\uff0c\u53ef\u80fd\u8fd8\u6709\u4e00\u4e9b \u9057\u6f0f \u3002\u672c\u6b21\u4fee\u6539\u6211\u53ef\u80fd\u53ea\u5c55\u793a\u4e00\u90e8\u5206\uff0c\u66f4\u591a\u4fee\u6539\u8bf7\u53c2\u8003git\u672c\u6b21commit: https://github.com/wuranxu/pity/commit/743afc1c88c6e32d194800a5ef6861ed1bdf488e \u4fee\u6539model from sqlalchemy import Column , INT , String , BOOLEAN , UniqueConstraint , TEXT , select , desc from app.models.basic import PityBase class Constructor ( PityBase ): __tablename__ = 'pity_constructor' __table_args__ = ( UniqueConstraint ( 'case_id' , 'suffix' , 'name' , 'deleted_at' ), ) type = Column ( INT , default = 0 , comment = \"0: testcase 1: sql 2: redis 3: py\u811a\u672c 4: \u5176\u5b83\" ) name = Column ( String ( 64 ), comment = \"\u6570\u636e\u521d\u59cb\u5316\u63cf\u8ff0\" ) enable = Column ( BOOLEAN , default = True , nullable = False ) constructor_json = Column ( TEXT , nullable = False ) value = Column ( String ( 16 ), comment = \"\u8fd4\u56de\u503c\" ) case_id = Column ( INT , nullable = False , comment = \"\u6240\u5c5e\u7528\u4f8bid\" ) public = Column ( BOOLEAN , default = False , comment = \"\u662f\u5426\u5171\u4eab\" ) index = Column ( INT , comment = \"\u524d\u7f6e\u6761\u4ef6\u987a\u5e8f\" ) # 2021-12-18 \u662f\u5426\u662f\u540e\u7f6e\u6761\u4ef6 suffix = Column ( BOOLEAN , default = False , comment = \"\u662f\u5426\u662f\u540e\u7f6e\u6761\u4ef6\uff0c\u9ed8\u8ba4\u4e3a\u5426\" ) def __init__ ( self , type , name , enable , constructor_json , case_id , public , user , value = \"\" , suffix = False , id = None ): super () . __init__ ( user , id ) self . type = type self . name = name self . enable = enable self . constructor_json = constructor_json self . case_id = case_id self . public = public self . value = value self . suffix = suffix @staticmethod async def get_index ( session , case_id , suffix = False ): sql = select ( Constructor ) . where ( Constructor . deleted_at == 0 , Constructor . case_id == case_id , Constructor . suffix == suffix , ) . order_by ( desc ( Constructor . index )) data = await session . execute ( sql ) query = data . scalars () . first () # \u5982\u679c\u6ca1\u6709\u67e5\u51fa\u6765\u524d/\u540e\u7f6e\u6761\u4ef6\uff0c\u90a3\u4e48\u7ed9\u4ed60 if query is None : return 0 return query . index + 1 def __str__ ( self ): return f \"[ { '\u540e\u7f6e\u6761\u4ef6' if self . suffix else '\u524d\u7f6e\u6761\u4ef6' } : { self . name } ]( { self . id } ))\" \u4fee\u6539\u70b9\u5728\u4e8e: \u552f\u4e00\u7d22\u5f15\u65b0\u589esuffix\u5b57\u6bb5 \u65b0\u589esuffix\u5b57\u6bb5 \u8868\u7ee7\u627f\u81eaPityBase get_index\u4e2d\u5bf9\u5220\u9664\u7684\u5224\u65ad\u6539\u4e3adeleted_at == 0\u800c\u4e0d\u662fNone \u8fd9\u5176\u4e2d\u8fd8\u5f15\u53d1\u4e86\u4e00\u4e2a\u4e8b\u60c5\uff0c \u6570\u636e\u5e93\u4e2ddeleted_at\u5b57\u6bb5\u8981\u4ecedatetime\u7c7b\u578b\u6539\u4e3abigint \uff0c\u56e0\u4e3a\u5386\u53f2\u539f\u56e0\uff0c\u6211\u4eec\u7684deleted_at\u90fd\u662fdatetime\uff0c\u73b0\u5728\u6211\u4eec\u8981\u4e00\u5e76\u8c03\u6574\u3002 \u53ef\u56de\u987e\u7b2c66\u8282: \u6d4b\u8bd5\u5e73\u53f0\u7cfb\u5217(66) \u6570\u636e\u9a71\u52a8\u4e4b\u57fa\u7840Model https://mp.weixin.qq.com/s?__biz=MzIyMjUwOTk5Mw==&mid=2247485632&idx=2&sn=8f3f4e1f8098c3718ce7d9c4783476bb&chksm=e82d2606df5aaf10fc1426430f2dcb301f6923264ed2d2836c6aa5ecd8e8882b098aa39c1840&token=1149953909&lang=zh_CN#rd \u9700\u8981\u8c03\u6574\u7684\u5730\u65b9 \u53ef\u4ee5\u770b\u5230\u5f15\u7528\u7684\u5730\u65b9\u975e\u5e38\u4e4b\u591a\uff0c\u5927\u6982\u5c31\u4e0b\u9762\u51e0\u4e2a\u65b9\u5411\u3002 \u9047\u5230Constructor.deleted_at == None\u7684( \u5224\u65ad\u6761\u4ef6\u662f\u5426\u88ab\u5220\u9664 )\uff0c\u8981\u6539\u4e3a\u7b49\u4e8e0 \u5bf9\u5e94\u529f\u80fd: \u83b7\u53d6\u524d\u540e\u7f6e\u6761\u4ef6\uff0c\u5220\u9664\u524d\u540e\u7f6e\u6761\u4ef6\u7b49 \u6267\u884ccase\u7684\u65e5\u5fd7\uff0c\u8981\u80fd\u591f\u533a\u5206\u524d\u540e\u7f6e\u6761\u4ef6 \u5bf9\u5e94\u529f\u80fd: \u7528\u4f8b\u6267\u884c\u524d\u540e\u7f6e\u6761\u4ef6 \u63a5\u53d7ConstructorForm\u5b57\u6bb5\u8981\u52a0\u4e0asuffix\uff0c\u5e76\u4e14\u5fc5\u586b \u5bf9\u5e94\u529f\u80fd: \u65b0\u589e/\u7f16\u8f91\u524d\u540e\u7f6e\u6761\u4ef6 \u67e5\u8be2\u524d\u540e\u7f6e\u6761\u4ef6\u7684\u65f6\u5019\uff0c\u8981\u5e26\u4e0asuffix \u5bf9\u5e94\u529f\u80fd: \u524d\u540e\u7f6e\u6761\u4ef6\u7684\u590d\u5236 \u8fd9\u4e00\u6ce2\u6539\u52a8\u633a\u5927\uff0c\u4e5f\u53ef\u80fd\u51fa\u73b0\u4e00\u4e9b\u95ee\u9898\u3002\u5982\u679c\u6709\u95ee\u9898\u53ef\u4ee5\u53ca\u65f6\u7559\u8a00\u53cd\u9988\u3002 \u524d\u7aef\u6539\u52a8 \u524d\u7aef\u6539\u52a8\u76f8\u5bf9\u8f83\u5c0f\uff0c\u53ea\u662f\u5728\u5207\u6362tab\u7684\u65f6\u5019\u591a\u4e86\u4e00\u4e2asuffix\u5b57\u6bb5\u7684\u7ef4\u62a4: \u5207\u6362\u5230\u540e\u7f6e\u6761\u4ef6\uff0c\u628asuffix\u53d8\u4e3atrue\uff0c\u5207\u6362\u5230\u524d\u7f6e\u6761\u4ef6\u5219\u6539\u4e3afalse\u3002\u8fd9\u6837\u7f16\u8f91\u524d\u540e\u7f6e\u6761\u4ef6\u7684\u65f6\u5019\uff0c\u53ea\u9700\u8981\u8bfb\u53d6\u90a3\u4e2asuffix\u5b57\u6bb5\u5373\u53ef\u3002 \u5f53\u7136\u8fd8\u6709\u4e00\u70b9\u5fae\u8c03\uff0c\u8fd9\u91cc\u7531\u4e8e\u7bc7\u5e45\u95ee\u9898\u5c31\u4e0d\u5c55\u793a\u4e86\u3002\u53c2\u8003commit: https://github.com/wuranxu/pityWeb/commit/86af44531c500c7acb22f2fb7a386ab00598551c \u770b\u770b\u6700\u7ec8\u7684\u6548\u679c","title":"98.\u5b8c\u5584\u540e\u7f6e\u6761\u4ef6\u529f\u80fd"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2898%29%20%E5%AE%8C%E5%96%84%E5%90%8E%E7%BD%AE%E6%9D%A1%E4%BB%B6%E5%8A%9F%E8%83%BD/#_1","text":"\u4e0a\u4e00\u8282\u6211\u4eec\u5b8c\u5584\u4e86 \u6839\u636e\u73af\u5883\u6267\u884ccase \u529f\u80fd\uff0c\u4e5f\u5dee\u4e0d\u591a\u662f\u6709\u4e86\u5728\u7ebf\u8c03\u8bd5\u7684\u529f\u80fd\u3002\u968f\u7740\u6211\u4eec\u7684\u7cfb\u7edf\u529f\u80fd\u9646\u7eed\u5b8c\u5584\uff0c\u90a3\u6570\u636e\u6e05\u7406\u5668(\u540e\u7f6e\u6761\u4ef6)\u8fd9\u4e2a\u6211\u4eec\u4e00\u76f4 \u6ca1\u89e3\u51b3 \u7684\u4e00\u4e2a\u70b9\uff0c\u5c31\u4e0d\u5f97\u4e0d\u641e\u5b9a\u4e4b\u4e86\u3002 \u7531\u4e8e\u524d\u7f6e\u6761\u4ef6/\u540e\u7f6e\u6761\u4ef6\u5dee\u5f02\u5f88\u5c0f\uff0c\u5e76\u4e14\u6a21\u5f0f\u4e5f\u90fd\u63a5\u8fd1\uff0c\u6240\u4ee5\u4e3a\u4e86\u907f\u514d\u91cd\u590d\u5f00\u53d1\uff0c\u6211\u51b3\u5b9a\u6539\u9020Constructor\u7c7b\uff0c\u5c06\u540e\u7f6e\u6761\u4ef6\u5e76\u5165\u4e4b\u3002","title":"\u56de\u987e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2898%29%20%E5%AE%8C%E5%96%84%E5%90%8E%E7%BD%AE%E6%9D%A1%E4%BB%B6%E5%8A%9F%E8%83%BD/#_2","text":"\u5728\u6b64\uff0c\u6211\u51b3\u5b9a\u4e0d\u73a9\u975e\u4e3b\u6d41\uff0c\u6062\u590d \u524d\u7f6e/\u540e\u7f6e\u6761\u4ef6 \u7684\u53eb\u6cd5\uff0c\u65b9\u4fbf\u5927\u5bb6\u7406\u89e3\u3002\u4f46\u5df2\u7ecf\u5b9a\u4e49\u597d\u7684\u7c7b: Constructor\u6211\u4e5f\u4e0d\u6539\u540d\u4e86\u3002 \u524d\u7f6e\u6761\u4ef6\u8868\u5982\u4f55\u652f\u6301\u540e\u7f6e\u6761\u4ef6: \u52a0\u4e2a\u6807\u5fd7\u4f4d \u6211\u4eec\u53ef\u4ee5\u4e3aconstructor\u8868\u5b9a\u4e49\u4e00\u4e2a suffix \u5b57\u6bb5\uff0c\u8fd9\u4e2a\u5b57\u6bb5\u662f\u4e2abool\u503c\uff0c\u9ed8\u8ba4\u4e3afalse\u3002 \u8fd9\u6837\u539f\u5148\u6709\u7684\u6570\u636e\uff0c\u5c31\u90fd\u662ffalse\uff0c\u4e5f\u5c31\u4ee3\u8868\u90fd\u662f\u524d\u7f6e\u6761\u4ef6\uff08\u80fd\u4e0d\u5f71\u54cd\u5230\u4e4b\u524dcase\uff09\u3002\u65b0\u52a0\u7684\u6761\u4ef6\uff0c\u6211\u4eec\u7528suffix\u533a\u5206\u5b83\u662f \u524d\u7f6e \u8fd8\u662f \u540e\u7f6e \u3002 \u8bf4\u5230 \u6570\u636e\u5e93\u7684\u53d8\u66f4 \uff0csqlalchemy\u6ca1\u6709\u63d0\u4f9b\u7279\u522b\u65b9\u4fbf\u7684\u65b9\u5f0f\u3002\u6211\u4e00\u822c\u662f\u7528datagrip\u53bb\u4fee\u6539: \u9009\u62e9\u8868\uff0c\u8fdb\u5165\u7f16\u8f91\u8868\u529f\u80fd \u65b0\u589e\u4e00\u4e2a\u5b57\u6bb5 \u70b9\u51fb+\u53f7\uff0c\u63a5\u7740\u7f16\u8f91\u5b57\u6bb5\u4fe1\u606f\u3002 \u7f16\u8f91\u5b57\u6bb5\u4fe1\u606f\u5e76\u9009\u62e9execute \u5176\u5b9e\u4e0b\u9762\u5df2\u7ecf\u7ed9\u51fa\u4e86\u5177\u4f53\u7684sql\uff0c\u76f4\u63a5\u6267\u884c\u4e5f\u4e00\u6837\u3002 alter table pity_constructor add suffix boolean default false not null ; \u5176\u4ed6\u7684\u5305\u62ec\u7d22\u5f15\u5565\u7684\uff0c\u90fd\u662f\u53ef\u4ee5\u8fd9\u6837\u7f16\u8f91\u7684\u3002\uff08\u5982\u679c\u5bf9\u5efa\u8868\uff0c\u52a0\u5b57\u6bb5\u7b49sql\u4e0d\u592a\u719f\u6089\u7684\uff0c\u53ef\u4ee5\u7528\u7528\u8fd9\u4e2a\u5de5\u5177\uff0cpycharm\u5c31\u96c6\u6210\u4e86datagrip\uff09","title":"\u8bbe\u8ba1\u601d\u8def"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2898%29%20%E5%AE%8C%E5%96%84%E5%90%8E%E7%BD%AE%E6%9D%A1%E4%BB%B6%E5%8A%9F%E8%83%BD/#_3","text":"\u8bf4\u5b8c\u4e86\u6838\u5fc3\u601d\u8def\uff0c\u4f46\u5176\u5b9e\u4fee\u6539\u8fc7\u7a0b\u4e2d\u53d1\u73b0\u4e0d\u5c11\u53d8\u5316\uff0c\u53ef\u80fd\u8fd8\u6709\u4e00\u4e9b \u9057\u6f0f \u3002\u672c\u6b21\u4fee\u6539\u6211\u53ef\u80fd\u53ea\u5c55\u793a\u4e00\u90e8\u5206\uff0c\u66f4\u591a\u4fee\u6539\u8bf7\u53c2\u8003git\u672c\u6b21commit: https://github.com/wuranxu/pity/commit/743afc1c88c6e32d194800a5ef6861ed1bdf488e \u4fee\u6539model from sqlalchemy import Column , INT , String , BOOLEAN , UniqueConstraint , TEXT , select , desc from app.models.basic import PityBase class Constructor ( PityBase ): __tablename__ = 'pity_constructor' __table_args__ = ( UniqueConstraint ( 'case_id' , 'suffix' , 'name' , 'deleted_at' ), ) type = Column ( INT , default = 0 , comment = \"0: testcase 1: sql 2: redis 3: py\u811a\u672c 4: \u5176\u5b83\" ) name = Column ( String ( 64 ), comment = \"\u6570\u636e\u521d\u59cb\u5316\u63cf\u8ff0\" ) enable = Column ( BOOLEAN , default = True , nullable = False ) constructor_json = Column ( TEXT , nullable = False ) value = Column ( String ( 16 ), comment = \"\u8fd4\u56de\u503c\" ) case_id = Column ( INT , nullable = False , comment = \"\u6240\u5c5e\u7528\u4f8bid\" ) public = Column ( BOOLEAN , default = False , comment = \"\u662f\u5426\u5171\u4eab\" ) index = Column ( INT , comment = \"\u524d\u7f6e\u6761\u4ef6\u987a\u5e8f\" ) # 2021-12-18 \u662f\u5426\u662f\u540e\u7f6e\u6761\u4ef6 suffix = Column ( BOOLEAN , default = False , comment = \"\u662f\u5426\u662f\u540e\u7f6e\u6761\u4ef6\uff0c\u9ed8\u8ba4\u4e3a\u5426\" ) def __init__ ( self , type , name , enable , constructor_json , case_id , public , user , value = \"\" , suffix = False , id = None ): super () . __init__ ( user , id ) self . type = type self . name = name self . enable = enable self . constructor_json = constructor_json self . case_id = case_id self . public = public self . value = value self . suffix = suffix @staticmethod async def get_index ( session , case_id , suffix = False ): sql = select ( Constructor ) . where ( Constructor . deleted_at == 0 , Constructor . case_id == case_id , Constructor . suffix == suffix , ) . order_by ( desc ( Constructor . index )) data = await session . execute ( sql ) query = data . scalars () . first () # \u5982\u679c\u6ca1\u6709\u67e5\u51fa\u6765\u524d/\u540e\u7f6e\u6761\u4ef6\uff0c\u90a3\u4e48\u7ed9\u4ed60 if query is None : return 0 return query . index + 1 def __str__ ( self ): return f \"[ { '\u540e\u7f6e\u6761\u4ef6' if self . suffix else '\u524d\u7f6e\u6761\u4ef6' } : { self . name } ]( { self . id } ))\" \u4fee\u6539\u70b9\u5728\u4e8e: \u552f\u4e00\u7d22\u5f15\u65b0\u589esuffix\u5b57\u6bb5 \u65b0\u589esuffix\u5b57\u6bb5 \u8868\u7ee7\u627f\u81eaPityBase get_index\u4e2d\u5bf9\u5220\u9664\u7684\u5224\u65ad\u6539\u4e3adeleted_at == 0\u800c\u4e0d\u662fNone \u8fd9\u5176\u4e2d\u8fd8\u5f15\u53d1\u4e86\u4e00\u4e2a\u4e8b\u60c5\uff0c \u6570\u636e\u5e93\u4e2ddeleted_at\u5b57\u6bb5\u8981\u4ecedatetime\u7c7b\u578b\u6539\u4e3abigint \uff0c\u56e0\u4e3a\u5386\u53f2\u539f\u56e0\uff0c\u6211\u4eec\u7684deleted_at\u90fd\u662fdatetime\uff0c\u73b0\u5728\u6211\u4eec\u8981\u4e00\u5e76\u8c03\u6574\u3002 \u53ef\u56de\u987e\u7b2c66\u8282: \u6d4b\u8bd5\u5e73\u53f0\u7cfb\u5217(66) \u6570\u636e\u9a71\u52a8\u4e4b\u57fa\u7840Model https://mp.weixin.qq.com/s?__biz=MzIyMjUwOTk5Mw==&mid=2247485632&idx=2&sn=8f3f4e1f8098c3718ce7d9c4783476bb&chksm=e82d2606df5aaf10fc1426430f2dcb301f6923264ed2d2836c6aa5ecd8e8882b098aa39c1840&token=1149953909&lang=zh_CN#rd","title":"\u52a8\u624b\u5b9e\u6218"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2898%29%20%E5%AE%8C%E5%96%84%E5%90%8E%E7%BD%AE%E6%9D%A1%E4%BB%B6%E5%8A%9F%E8%83%BD/#_4","text":"\u53ef\u4ee5\u770b\u5230\u5f15\u7528\u7684\u5730\u65b9\u975e\u5e38\u4e4b\u591a\uff0c\u5927\u6982\u5c31\u4e0b\u9762\u51e0\u4e2a\u65b9\u5411\u3002 \u9047\u5230Constructor.deleted_at == None\u7684( \u5224\u65ad\u6761\u4ef6\u662f\u5426\u88ab\u5220\u9664 )\uff0c\u8981\u6539\u4e3a\u7b49\u4e8e0 \u5bf9\u5e94\u529f\u80fd: \u83b7\u53d6\u524d\u540e\u7f6e\u6761\u4ef6\uff0c\u5220\u9664\u524d\u540e\u7f6e\u6761\u4ef6\u7b49 \u6267\u884ccase\u7684\u65e5\u5fd7\uff0c\u8981\u80fd\u591f\u533a\u5206\u524d\u540e\u7f6e\u6761\u4ef6 \u5bf9\u5e94\u529f\u80fd: \u7528\u4f8b\u6267\u884c\u524d\u540e\u7f6e\u6761\u4ef6 \u63a5\u53d7ConstructorForm\u5b57\u6bb5\u8981\u52a0\u4e0asuffix\uff0c\u5e76\u4e14\u5fc5\u586b \u5bf9\u5e94\u529f\u80fd: \u65b0\u589e/\u7f16\u8f91\u524d\u540e\u7f6e\u6761\u4ef6 \u67e5\u8be2\u524d\u540e\u7f6e\u6761\u4ef6\u7684\u65f6\u5019\uff0c\u8981\u5e26\u4e0asuffix \u5bf9\u5e94\u529f\u80fd: \u524d\u540e\u7f6e\u6761\u4ef6\u7684\u590d\u5236 \u8fd9\u4e00\u6ce2\u6539\u52a8\u633a\u5927\uff0c\u4e5f\u53ef\u80fd\u51fa\u73b0\u4e00\u4e9b\u95ee\u9898\u3002\u5982\u679c\u6709\u95ee\u9898\u53ef\u4ee5\u53ca\u65f6\u7559\u8a00\u53cd\u9988\u3002","title":"\u9700\u8981\u8c03\u6574\u7684\u5730\u65b9"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2898%29%20%E5%AE%8C%E5%96%84%E5%90%8E%E7%BD%AE%E6%9D%A1%E4%BB%B6%E5%8A%9F%E8%83%BD/#_5","text":"\u524d\u7aef\u6539\u52a8\u76f8\u5bf9\u8f83\u5c0f\uff0c\u53ea\u662f\u5728\u5207\u6362tab\u7684\u65f6\u5019\u591a\u4e86\u4e00\u4e2asuffix\u5b57\u6bb5\u7684\u7ef4\u62a4: \u5207\u6362\u5230\u540e\u7f6e\u6761\u4ef6\uff0c\u628asuffix\u53d8\u4e3atrue\uff0c\u5207\u6362\u5230\u524d\u7f6e\u6761\u4ef6\u5219\u6539\u4e3afalse\u3002\u8fd9\u6837\u7f16\u8f91\u524d\u540e\u7f6e\u6761\u4ef6\u7684\u65f6\u5019\uff0c\u53ea\u9700\u8981\u8bfb\u53d6\u90a3\u4e2asuffix\u5b57\u6bb5\u5373\u53ef\u3002 \u5f53\u7136\u8fd8\u6709\u4e00\u70b9\u5fae\u8c03\uff0c\u8fd9\u91cc\u7531\u4e8e\u7bc7\u5e45\u95ee\u9898\u5c31\u4e0d\u5c55\u793a\u4e86\u3002\u53c2\u8003commit: https://github.com/wuranxu/pityWeb/commit/86af44531c500c7acb22f2fb7a386ab00598551c","title":"\u524d\u7aef\u6539\u52a8"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2898%29%20%E5%AE%8C%E5%96%84%E5%90%8E%E7%BD%AE%E6%9D%A1%E4%BB%B6%E5%8A%9F%E8%83%BD/#_6","text":"","title":"\u770b\u770b\u6700\u7ec8\u7684\u6548\u679c"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2899%29%20%E7%BB%99%E7%94%A8%E6%88%B7%E6%B7%BB%E5%8A%A0%E6%93%8D%E4%BD%9C%E6%97%A5%E5%BF%97/","text":"\u5927\u5bb6\u597d~\u6211\u662f \u7c73\u6d1b \uff01 \u6211\u6b63\u5728\u4ece0\u52301\u6253\u9020\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u6d4b\u8bd5\u5e73\u53f0, \u4e5f\u5728\u7f16\u5199\u4e00\u5957\u4e0e\u4e4b\u5bf9\u5e94\u7684 \u6559\u7a0b \uff0c\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u652f\u6301\u3002 \u6b22\u8fce\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \uff0c\u83b7\u53d6\u6700\u65b0\u6587\u7ae0\u6559\u7a0b! \u56de\u987e \u4e0a\u4e00\u8282\u6211\u4eec\u5b8c\u6210\u4e86 \u540e\u7f6e\u6761\u4ef6 \u529f\u80fd\u3002\u8fd9\u6837\u6574\u4e2a\u7528\u4f8b\u7684\u751f\u547d\u5468\u671f\uff0c\u9664\u4e86\u8ddf yapi \uff08\u6216\u5176\u4ed6\u63a5\u53e3\u6587\u6863\u5de5\u5177\uff09\u5173\u8054\u4ee5\u5916\uff0c\u7528\u4f8b\u7684\u903b\u8f91\u57fa\u672c\u4e0a\u7b97\u662f\u544a\u4e00\u6bb5\u843d\u4e86\u3002 \u8fd9\u4e00\u7bc7\u6211\u4eec\u6253\u7b97\u5c06\u76ee\u5149\u653e\u5728\u7528\u6237\u4e0a\uff0c\u63a5\u7740\u6211\u4eec\u9700\u8981\u505a\u7684\u662f\u4ee5\u4e0b\u51e0\u4ef6\u4e8b\uff0c\u4e5f\u4e0d\u662f\u8bf4\u5168\u90e8\u505a\u8fd9\u4e9b\uff0c\u53ea\u662f\u8fd8\u9700\u8981\u505a\u7684\u6709\u8fd9\u4e9b\u3002 \u5b8c\u6210 \u64cd\u4f5c\u65e5\u5fd7 \u529f\u80fd \u5b8c\u6210\u7528\u6237\u7ba1\u7406\u529f\u80fd \u5b8c\u6210\u4e2a\u4eba\u8bbe\u7f6e\u9875\u9762 \u5b8c\u6210\u5de5\u4f5c\u53f0\u529f\u80fd \u90a3\u8fd9\u8282\u6211\u4eec\u5c31\u5148\u5b8c\u6210 \u64cd\u4f5c\u65e5\u5fd7 \u76f8\u5173\u7684\u529f\u80fd\u3002 \u601d\u8003 \u64cd\u4f5c\u65e5\u5fd7\u8fd9\u73a9\u610f\uff0c\u548c\u4f20\u7edf\u610f\u4e49\u7684\u65e5\u5fd7\u8981\u5206\u5f00\u3002\u6211\u4eec\u8981\u8bf4\u7684\u64cd\u4f5c\u65e5\u5fd7\u662f \u66f4\u53ef\u8bfb\u7684 \u65e5\u5fd7\uff0c\u6bd4\u5982: 2021-12-19 22:15:00 \u7c73\u6d1b \u53d1\u8868 \u6587\u7ae0: \u4eca\u5929\u6392\u4f4d\u53c8\u5751\u4e86\u522b\u4eba \u3002 \u6211\u4eec\u9700\u8981\u7684\u662f \u4f55\u65f6\u4f55\u4eba\u505a\u4e86\u4f55\u4e8b \uff0c\u4e3b\u8981\u662f3\u4e2a\u8981\u7d20\u3002 \u65f6\u95f4 \u4eba\u7269 \u4e8b\u4ef6 \u5bf9\u4e8e\u8be6\u7ec6\u7684\u65e5\u5fd7\u6211\u4eec \u6682\u65f6 \u4e0d\u9700\u8981\u8bb0\u5f55\u90a3\u4e48\u6e05\u695a(\u53ef\u80fd\u53ea\u9700\u8981\u5230case\u7684\u7a0b\u5ea6)\u3002\u6ce8\u610f\u5230\uff0c\u8fd9\u91cc\u662f\u6682\u65f6\u3002 \u540e\u7eed\u5982\u679c\u6211\u4eec\u60f3\u77e5\u9053case\u7684\u5177\u4f53\u6539\u52a8\uff0c\u53c8\u6216\u8005\u8bf4 \u6211\u4eec\u60f3\u8ba2\u9605\u67d0\u4e2a\u670d\u52a1\u4e0b\u7684case \uff0c\u4e0d\u8bba\u589e\u5220\u6539\uff0c\u6211\u4eec\u90fd\u60f3\u77e5\u9053\uff0c\u90a3\u6211\u4eec\u5c31\u5f97\u52a0\u4e0a\u8fd9\u4e9b\u6570\u636e\u3002 \u8fd9\u529f\u80fd\u8bf4\u767d\u4e86\uff0c\u5c31\u662f\u4e2a\u5c0f\u578b\u76d1\u89c6\u5668\u3002 \u81f3\u4e8e\u601d\u8def\u7684\u8bdd\uff0c\u6211\u4eec\u7528\u4e2a\u88c5\u9970\u5668\uff0c\u5728\u65b9\u6cd5\u6267\u884c\u524d\u628a\u64cd\u4f5c\u8bb0\u5f55\u585e\u5230db\u5373\u53ef\uff0c\u6682\u65f6\u5148\u4e0d\u7528\u592a\u590d\u6742\u3002 \u8bbe\u8ba1\u8868 \u6211\u4eec\u628a\u8868\u5206\u4e3a\u4ee5\u4e0b\u51e0\u4e2a\u5b57\u6bb5, \u65b0\u5efaapp/models/operation_log.py from datetime import datetime from sqlalchemy import Column , INT , DATETIME , String , SMALLINT , TEXT from app.models import Base class PityOperationLog ( Base ): \"\"\" \u7528\u6237\u64cd\u4f5c\u8bb0\u5f55\u8868 \"\"\" __tablename__ = 'pity_operation_log' id = Column ( INT , primary_key = True ) # \u64cd\u4f5c\u4eba user_id = Column ( INT , index = True ) # \u64cd\u4f5c\u65f6\u95f4 operate_time = Column ( DATETIME ) # \u64cd\u4f5ctitle title = Column ( String ( 64 ), nullable = False ) # \u64cd\u4f5c\u63cf\u8ff0 description = Column ( TEXT , comment = \"\u64cd\u4f5c\u63cf\u8ff0\" ) # tag tag = Column ( String ( 24 ), comment = \"\u64cd\u4f5ctag\" ) # mode mode = Column ( SMALLINT , comment = \"\u64cd\u4f5c\u7c7b\u578b\" ) # key key = Column ( INT , nullable = True , comment = \"\u5173\u952eid\uff0c\u53ef\u80fd\u662f\u76ee\u5f55id\uff0ccase_id\u6216\u8005\u5176\u4ed6id\" ) def __init__ ( self , user_id , mode , title , tag , description , key = None ): self . user_id = user_id self . tag = tag self . mode = mode self . title = title self . key = key self . description = description self . operate_time = datetime . now () user_id: \u64cd\u4f5c\u4eba operate_time: \u64cd\u4f5c\u65f6\u95f4 title: \u64cd\u4f5c\u6807\u9898 description: \u6539\u52a8\u7ec6\u8282 tag: \u64cd\u4f5c\u6807\u7b7e mode: \u64cd\u4f5c\u6a21\u5f0f key: \u64cd\u4f5c\u5173\u952eid \u8fd9\u4e2akey\u5c5e\u4e8e\u9884\u7559\u5b57\u6bb5\uff0c\u662f\u4e3a\u4e86\u7ed9case\u64cd\u4f5c\u8bb0\u5f55\u505a\u7684\u9884\u7559\u3002\u5982\u679c\u67d0\u67d0\u67d0\u6539\u52a8\u4e86\u67d0\u4e2acase\u7684\u524d\u7f6e\u6761\u4ef6\uff0c\u5176\u5b9e\u6211\u4eec\u64cd\u4f5c\u8bb0\u5f55\u662f\u53ea\u6709 \u524d\u7f6e\u6761\u4ef6 \u7684\u6539\u52a8\u3002\u6240\u4ee5\u9047\u5230\u8fd9\u79cd\u60c5\u51b5\uff0c\u6211\u4eec\u5c31\u9700\u8981\u8bbe\u7f6ekey\u4e3a\u7528\u4f8bid\uff0c\u8fd9\u6837\u5f53\u6211\u60f3\u67e5\u8be2\u7528\u4f8b\u6539\u52a8\u7684\u65f6\u5019\uff0c\u5c31\u53ef\u4ee5\u67e5\u5230\u8fd9\u6761\u8bb0\u5f55\u4e86\u3002 \u5f53\u7136\uff0c\u8fd9\u6682\u65f6\u53ea\u662f\u6211\u7684\u4e00\u4e2a\u8bbe\u60f3\u3002 \u6539\u9020PityBase \u8fd8\u8bb0\u5f97\u4e4b\u524d\u6211\u4eec\u8bbe\u8ba1\u7684pity \u57fa\u7c7b \u5417\uff1f\u91cc\u9762\u5305\u542b\u4e86create_at\u7b49\u57fa\u672c\u5b57\u6bb5\uff0c\u5728\u4eca\u5929\uff0c\u6211\u4eec\u8fd8\u5f97\u989d\u5916\u7ed9\u5b83\u52a0\u4e00\u4e9b\u4e1c\u897f: \u8fd9\u8fb9\u6dfb\u52a0\u4e864\u4e2a\u5b57\u6bb5\uff0c\u4f46\u6ce8\u610f\u8fd9\u4e9b\u90fd\u4e0d\u662f\u6570\u636e\u8868\u7684\u771f\u5b9e\u5b57\u6bb5\uff0c\u53ea\u662f\u6211\u4eec\u7528\u6765\u83b7\u53d6\u64cd\u4f5c\u65e5\u5fd7\u9700\u8981\u76844\u4e2a\u5b57\u6bb5 fields \u9ed8\u8ba4\u5c55\u793a\u7684\u5b57\u6bb5\uff0c\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u4e00\u4e2a\u7528\u6237\u6709 \u59d3\u540d \uff0c \u5e74\u9f84 \u7b49\u5b57\u6bb5\uff0c\u6211\u4eec\u8981\u5c55\u793a\u54ea\u4e9b\u5b57\u6bb5\u7684\u6539\u52a8\u5462\uff1f \u660e\u663eid\uff0c \u521b\u5efa\u65f6\u95f4 \u8fd9\u4e9b\u6211\u4eec\u662f\u4e0d\u9700\u8981\u7684\u3002 \u6240\u4ee5\u8fd9\u4e2a\u5b57\u6bb5\u5c31\u7528\u6765\u89c4\u5b9a\u6211\u4eec\u5bf9 \u53d8\u66f4 \u7684\u5c55\u793a. tag \u4e4b\u524d\u8bf4\u4e86\uff0c\u8868\u5bf9\u5e94\u7684tag\uff0c\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5728pity\u91cc\u9762\u53ef\u4ee5\u662f \u6d4b\u8bd5\u7528\u4f8b \uff0c \u6d4b\u8bd5\u8ba1\u5212 \u7b49\u3002\u4ee5\u540e\u5982\u679c\u6211\u4eec\u60f3\u770b\u6240\u6709\u6d4b\u8bd5\u8ba1\u5212\u7684\u6539\u52a8\uff0c\u5c31\u53ef\u4ee5\u6839\u636etag\u6765\u7b5b\u9009\u3002 alias \u6211\u4eec\u7684\u64cd\u4f5c\u8bb0\u5f55\uff0c\u8bd5\u60f3\u4e00\u4e0b\uff0c\u5982\u679c\u7528\u8fd9\u6837\u7684\u65b9\u5f0f: [\u6570\u636e\u5e93\u914d\u7f6e] \u4e4c\u8fea\u5c14 \u7f16\u8f91\u4e86 \u6570\u636e\u5e93: \u672c\u5730\u6570\u636e\u5e93 name: ~~\u8001\u7684redis~~ -> \u65b0\u7684redis database: ~~user~~ -> pity_user \u770b\u4e0a\u53bb\u662f\u6ca1\u5565\u6bdb\u75c5\uff0c\u4f46\u662f\u5bf9\u7528\u6237\u6765\u8bf4 \u4e0d\u53cb\u597d \u554a!\u5982\u679c\u6211\u4eec\u80fd\u628a\u6570\u636e\u5e93\u7684name\u6362\u6210 \u540d\u79f0 \uff0cdatabase\u6362\u6210 \u6570\u636e\u5e93\u540d \u4f1a\u4e0d\u4f1a\u66f4\u597d\u4e9b? \u8fd9\u5c31\u662f\u522b\u540d\u7684\u76ee\u7684\u3002 __show__ \u8fd9\u4e2a\u53d8\u91cf\u662f\u7528\u6765 \u5c55\u793a \u4e4c\u8fea\u5c14 \u4fee\u6539\u4e86 xxxx\uff0c\u56e0\u4e3a\u6709\u65f6\u5019\u6211\u4eec\u53ef\u80fd\u4fee\u6539\u4e86XXX\u9879\u76eeXXX\u9879\u76ee\u89d2\u8272: \u4e4c\u8fea\u5c14\u6dfb\u52a0\u4e86\u9879\u76ee abc -> \u7528\u6237 \u674e\u5927\u5634 -> \u89d2\u8272 \u7ba1\u7406\u5458 \u8fd9\u91cc\u5c55\u793a\u5b57\u6bb5\u9700\u89813\u4e2a\uff0c\u5206\u522b\u662f\u9879\u76ee\uff0c\u7528\u6237\u548c\u89d2\u8272\u3002\u8fd9\u91cc\u6839\u636e__fields__\u8054\u52a8\uff0c\u53d6\u524d\u9762N\u4e2a\u5b57\u6bb5\u3002 \u65b0\u589ePityRelationField\u7c7b \u56e0\u4e3a\u6211\u4eec\u7684\u5b57\u6bb5\u540d\u53ef\u80fd\u662fxxx_id\uff0c\u9700\u8981\u5173\u8054\u5230\u522b\u7684\u5b57\u6bb5\uff0c\u8981\u4e0d\u5c31\u662f \u679a\u4e3e \u7c7b\uff0c\u6bd4\u5982type\u662f0\u4ee3\u8868\u7528\u4f8b\uff0c1\u4ee3\u8868sql\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u5efa\u7acb0->1\u4ee5\u53caxxx_id\u5230\u8868\u5b57\u6bb5\u7684\u6620\u5c04\u5173\u7cfb\u3002 \u8fd9\u4e48\u8bf4\u53ef\u80fd\u5f88\u62bd\u8c61\uff0c\u6211\u4eec\u4e3e\u4e2a\u5177\u4f53\u7684\u4f8b\u5b50: Redis\u8868\u6709\u4e2aenv\u5b57\u6bb5\uff0c\u4ed6\u6765\u81eaEnvironment\u8868\u7684id\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u628aenv\u6362\u6210Environment\u7684name\u5b57\u6bb5\uff08\u6bd4\u5982fat\uff09\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u80fd\u5f88\u597d\u5730\u8bc6\u522b\u51fa \u53d8\u52a8 \u7684\u6570\u636e\u3002 init_relation\u5219\u662f\u5efa\u7acb\u6b64\u7b49\u5173\u7cfb\uff0c\u5f85\u4f1a\u6211\u4eec\u4f1a\u8bf4\u660e\u3002 \u4fee\u6539\u914d\u7f6e\u6587\u4ef6config.py \u8bbe\u7f6e\u8fd9\u4e9b\u53d8\u91cf\u662f\u4e3a\u4e86\u80fd\u591f \u5f88\u597d\u5730 \u83b7\u53d6\u5bf9\u5e94\u7684\u503c\uff0c\u4e0d\u7136\u6211\u628a__fields__\u5199\u4e3a__field__\u5c31\u51fa\u5927\u95ee\u9898\u4e86\u3002 \u4fee\u6539crud/__init__.py \u4e0a\u9762\u662f\u52a8\u6001\u5bfc\u5165\u5305\uff08\u5efa\u6570\u636e\u8868\u7528\u7684\uff09\uff0c\u4e0b\u9762\u5219\u662f\u8bbe\u7f6e \u6620\u5c04\u5173\u7cfb \u3002 \u4ee5Redis\u4e3a\u4f8b\uff0c\u53ef\u4ee5\u770b\u5230Redis.env\u6620\u5c04\u5230\u4e86Environment.id\uff0c\u7b2c\u4e8c\u4e2a\u5b57\u6bb5\u5219\u662f\u66ff\u6362\u6210Environment.name\u3002 \u5176\u4ed6\u7ec6\u8282 \u5177\u4f53\u7684 \u7ec6\u8282 \u5f88\u591a\uff0c\u5f88\u96be\u4e00\u6b65\u4e00\u6b65\u5199\u6e05\u695a\uff0c\u5927\u5bb6\u53ef\u4ee5\u67e5\u770bcrud/__init__.py\u91cc\u7684 insert_log \u65b9\u6cd5\u3002 \u6574\u4f53\u601d\u8def\u5c31\u662f\u6839\u636e\u9884\u8bbe\u7684\u5b57\u6bb5\uff0c\u5b58\u653e\u5bf9\u5e94\u7684\u5b57\u6bb5\u6539\u52a8\uff0c\u5b57\u6bb5\u6709\u522b\u540d\u5219\u66ff\u6362\u5b57\u6bb5\u7684\u522b\u540d\uff0c\u6bd4\u5982name->\u59d3\u540d\uff0c\u6709\u5176\u4ed6\u8868\u7684\u6570\u636e\u5219\u66ff\u6362\u4e3a\u5176\u4ed6\u8868\u7684\u6570\u636e\u3002 \u5177\u4f53\u6548\u679c \u672c\u8282\u5185\u5bb9\u6bd4\u8f83\u591a\uff0c\u611f\u5174\u8da3\u7684\u670b\u53cb\u53ef\u4ee5\u50ac\u66f4\u6216\u8005\u81ea\u5df1\u67e5\u770b\u4ee3\u7801\u3002\u611f\u89c9\u7528\u6587\u5b57\u7684\u65b9\u5f0f\u5f88\u96be\u8bb2\u6e05\u695a\u3002 \u53c2\u8003\u94fe\u63a5: \u7f8e\u56e2\u5206\u4eab\u7684\u6587\u7ae0 https://juejin.cn/post/7009116644031070244 \u5bf9\u5e94git commit\u6539\u52a8: https://github.com/wuranxu/pity/commit/bf374ac4851ec24e1386b351549c15ebe26772df \u5176\u4ed6\u5b9e\u73b0 \u5982\u679c\u7b80\u5355\u8bb0\u5f55\u7684\u8bdd\uff0c\u4e0d\u7528\u8fd9\u4e48\u590d\u6742\uff0c\u5199\u51faxxx\u4fee\u6539\u4e86xxx\u5373\u53ef\u3002\u90a3\u4e2a\u53ef\u4ee5\u7528 \u88c5\u9970\u5668 \u5b8c\u6210\u3002\u6709\u5174\u8da3\u7684\u670b\u53cb\u53ef\u4ee5\u81ea\u5df1\u5b9e\u73b0\u3002 \u672c\u6587\u7531\u4e8e\u7bc7\u5e45\u95ee\u9898\uff0c\u5c31\u8bb2\u5230\u8fd9\u91cc\u4e86\uff0c\u6211\u53bb\u8865 \u6ce8\u91ca \u53bb\u4e86~\u4e0b\u4e00\u8282\u6211\u4eec\u628a\u4eca\u5929\u5199\u7684\u5b57\u6bb5\u6570\u636e\u5c55\u793a\u5728 \u4e2a\u4eba\u52a8\u6001\u9875\u9762 \u4e2d\u3002","title":"99.\u7ed9\u7528\u6237\u6dfb\u52a0\u64cd\u4f5c\u65e5\u5fd7"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2899%29%20%E7%BB%99%E7%94%A8%E6%88%B7%E6%B7%BB%E5%8A%A0%E6%93%8D%E4%BD%9C%E6%97%A5%E5%BF%97/#_1","text":"\u4e0a\u4e00\u8282\u6211\u4eec\u5b8c\u6210\u4e86 \u540e\u7f6e\u6761\u4ef6 \u529f\u80fd\u3002\u8fd9\u6837\u6574\u4e2a\u7528\u4f8b\u7684\u751f\u547d\u5468\u671f\uff0c\u9664\u4e86\u8ddf yapi \uff08\u6216\u5176\u4ed6\u63a5\u53e3\u6587\u6863\u5de5\u5177\uff09\u5173\u8054\u4ee5\u5916\uff0c\u7528\u4f8b\u7684\u903b\u8f91\u57fa\u672c\u4e0a\u7b97\u662f\u544a\u4e00\u6bb5\u843d\u4e86\u3002 \u8fd9\u4e00\u7bc7\u6211\u4eec\u6253\u7b97\u5c06\u76ee\u5149\u653e\u5728\u7528\u6237\u4e0a\uff0c\u63a5\u7740\u6211\u4eec\u9700\u8981\u505a\u7684\u662f\u4ee5\u4e0b\u51e0\u4ef6\u4e8b\uff0c\u4e5f\u4e0d\u662f\u8bf4\u5168\u90e8\u505a\u8fd9\u4e9b\uff0c\u53ea\u662f\u8fd8\u9700\u8981\u505a\u7684\u6709\u8fd9\u4e9b\u3002 \u5b8c\u6210 \u64cd\u4f5c\u65e5\u5fd7 \u529f\u80fd \u5b8c\u6210\u7528\u6237\u7ba1\u7406\u529f\u80fd \u5b8c\u6210\u4e2a\u4eba\u8bbe\u7f6e\u9875\u9762 \u5b8c\u6210\u5de5\u4f5c\u53f0\u529f\u80fd \u90a3\u8fd9\u8282\u6211\u4eec\u5c31\u5148\u5b8c\u6210 \u64cd\u4f5c\u65e5\u5fd7 \u76f8\u5173\u7684\u529f\u80fd\u3002","title":"\u56de\u987e"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2899%29%20%E7%BB%99%E7%94%A8%E6%88%B7%E6%B7%BB%E5%8A%A0%E6%93%8D%E4%BD%9C%E6%97%A5%E5%BF%97/#_2","text":"\u64cd\u4f5c\u65e5\u5fd7\u8fd9\u73a9\u610f\uff0c\u548c\u4f20\u7edf\u610f\u4e49\u7684\u65e5\u5fd7\u8981\u5206\u5f00\u3002\u6211\u4eec\u8981\u8bf4\u7684\u64cd\u4f5c\u65e5\u5fd7\u662f \u66f4\u53ef\u8bfb\u7684 \u65e5\u5fd7\uff0c\u6bd4\u5982: 2021-12-19 22:15:00 \u7c73\u6d1b \u53d1\u8868 \u6587\u7ae0: \u4eca\u5929\u6392\u4f4d\u53c8\u5751\u4e86\u522b\u4eba \u3002 \u6211\u4eec\u9700\u8981\u7684\u662f \u4f55\u65f6\u4f55\u4eba\u505a\u4e86\u4f55\u4e8b \uff0c\u4e3b\u8981\u662f3\u4e2a\u8981\u7d20\u3002 \u65f6\u95f4 \u4eba\u7269 \u4e8b\u4ef6 \u5bf9\u4e8e\u8be6\u7ec6\u7684\u65e5\u5fd7\u6211\u4eec \u6682\u65f6 \u4e0d\u9700\u8981\u8bb0\u5f55\u90a3\u4e48\u6e05\u695a(\u53ef\u80fd\u53ea\u9700\u8981\u5230case\u7684\u7a0b\u5ea6)\u3002\u6ce8\u610f\u5230\uff0c\u8fd9\u91cc\u662f\u6682\u65f6\u3002 \u540e\u7eed\u5982\u679c\u6211\u4eec\u60f3\u77e5\u9053case\u7684\u5177\u4f53\u6539\u52a8\uff0c\u53c8\u6216\u8005\u8bf4 \u6211\u4eec\u60f3\u8ba2\u9605\u67d0\u4e2a\u670d\u52a1\u4e0b\u7684case \uff0c\u4e0d\u8bba\u589e\u5220\u6539\uff0c\u6211\u4eec\u90fd\u60f3\u77e5\u9053\uff0c\u90a3\u6211\u4eec\u5c31\u5f97\u52a0\u4e0a\u8fd9\u4e9b\u6570\u636e\u3002 \u8fd9\u529f\u80fd\u8bf4\u767d\u4e86\uff0c\u5c31\u662f\u4e2a\u5c0f\u578b\u76d1\u89c6\u5668\u3002 \u81f3\u4e8e\u601d\u8def\u7684\u8bdd\uff0c\u6211\u4eec\u7528\u4e2a\u88c5\u9970\u5668\uff0c\u5728\u65b9\u6cd5\u6267\u884c\u524d\u628a\u64cd\u4f5c\u8bb0\u5f55\u585e\u5230db\u5373\u53ef\uff0c\u6682\u65f6\u5148\u4e0d\u7528\u592a\u590d\u6742\u3002","title":"\u601d\u8003"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2899%29%20%E7%BB%99%E7%94%A8%E6%88%B7%E6%B7%BB%E5%8A%A0%E6%93%8D%E4%BD%9C%E6%97%A5%E5%BF%97/#_3","text":"\u6211\u4eec\u628a\u8868\u5206\u4e3a\u4ee5\u4e0b\u51e0\u4e2a\u5b57\u6bb5, \u65b0\u5efaapp/models/operation_log.py from datetime import datetime from sqlalchemy import Column , INT , DATETIME , String , SMALLINT , TEXT from app.models import Base class PityOperationLog ( Base ): \"\"\" \u7528\u6237\u64cd\u4f5c\u8bb0\u5f55\u8868 \"\"\" __tablename__ = 'pity_operation_log' id = Column ( INT , primary_key = True ) # \u64cd\u4f5c\u4eba user_id = Column ( INT , index = True ) # \u64cd\u4f5c\u65f6\u95f4 operate_time = Column ( DATETIME ) # \u64cd\u4f5ctitle title = Column ( String ( 64 ), nullable = False ) # \u64cd\u4f5c\u63cf\u8ff0 description = Column ( TEXT , comment = \"\u64cd\u4f5c\u63cf\u8ff0\" ) # tag tag = Column ( String ( 24 ), comment = \"\u64cd\u4f5ctag\" ) # mode mode = Column ( SMALLINT , comment = \"\u64cd\u4f5c\u7c7b\u578b\" ) # key key = Column ( INT , nullable = True , comment = \"\u5173\u952eid\uff0c\u53ef\u80fd\u662f\u76ee\u5f55id\uff0ccase_id\u6216\u8005\u5176\u4ed6id\" ) def __init__ ( self , user_id , mode , title , tag , description , key = None ): self . user_id = user_id self . tag = tag self . mode = mode self . title = title self . key = key self . description = description self . operate_time = datetime . now () user_id: \u64cd\u4f5c\u4eba operate_time: \u64cd\u4f5c\u65f6\u95f4 title: \u64cd\u4f5c\u6807\u9898 description: \u6539\u52a8\u7ec6\u8282 tag: \u64cd\u4f5c\u6807\u7b7e mode: \u64cd\u4f5c\u6a21\u5f0f key: \u64cd\u4f5c\u5173\u952eid \u8fd9\u4e2akey\u5c5e\u4e8e\u9884\u7559\u5b57\u6bb5\uff0c\u662f\u4e3a\u4e86\u7ed9case\u64cd\u4f5c\u8bb0\u5f55\u505a\u7684\u9884\u7559\u3002\u5982\u679c\u67d0\u67d0\u67d0\u6539\u52a8\u4e86\u67d0\u4e2acase\u7684\u524d\u7f6e\u6761\u4ef6\uff0c\u5176\u5b9e\u6211\u4eec\u64cd\u4f5c\u8bb0\u5f55\u662f\u53ea\u6709 \u524d\u7f6e\u6761\u4ef6 \u7684\u6539\u52a8\u3002\u6240\u4ee5\u9047\u5230\u8fd9\u79cd\u60c5\u51b5\uff0c\u6211\u4eec\u5c31\u9700\u8981\u8bbe\u7f6ekey\u4e3a\u7528\u4f8bid\uff0c\u8fd9\u6837\u5f53\u6211\u60f3\u67e5\u8be2\u7528\u4f8b\u6539\u52a8\u7684\u65f6\u5019\uff0c\u5c31\u53ef\u4ee5\u67e5\u5230\u8fd9\u6761\u8bb0\u5f55\u4e86\u3002 \u5f53\u7136\uff0c\u8fd9\u6682\u65f6\u53ea\u662f\u6211\u7684\u4e00\u4e2a\u8bbe\u60f3\u3002","title":"\u8bbe\u8ba1\u8868"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2899%29%20%E7%BB%99%E7%94%A8%E6%88%B7%E6%B7%BB%E5%8A%A0%E6%93%8D%E4%BD%9C%E6%97%A5%E5%BF%97/#pitybase","text":"\u8fd8\u8bb0\u5f97\u4e4b\u524d\u6211\u4eec\u8bbe\u8ba1\u7684pity \u57fa\u7c7b \u5417\uff1f\u91cc\u9762\u5305\u542b\u4e86create_at\u7b49\u57fa\u672c\u5b57\u6bb5\uff0c\u5728\u4eca\u5929\uff0c\u6211\u4eec\u8fd8\u5f97\u989d\u5916\u7ed9\u5b83\u52a0\u4e00\u4e9b\u4e1c\u897f: \u8fd9\u8fb9\u6dfb\u52a0\u4e864\u4e2a\u5b57\u6bb5\uff0c\u4f46\u6ce8\u610f\u8fd9\u4e9b\u90fd\u4e0d\u662f\u6570\u636e\u8868\u7684\u771f\u5b9e\u5b57\u6bb5\uff0c\u53ea\u662f\u6211\u4eec\u7528\u6765\u83b7\u53d6\u64cd\u4f5c\u65e5\u5fd7\u9700\u8981\u76844\u4e2a\u5b57\u6bb5 fields \u9ed8\u8ba4\u5c55\u793a\u7684\u5b57\u6bb5\uff0c\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u4e00\u4e2a\u7528\u6237\u6709 \u59d3\u540d \uff0c \u5e74\u9f84 \u7b49\u5b57\u6bb5\uff0c\u6211\u4eec\u8981\u5c55\u793a\u54ea\u4e9b\u5b57\u6bb5\u7684\u6539\u52a8\u5462\uff1f \u660e\u663eid\uff0c \u521b\u5efa\u65f6\u95f4 \u8fd9\u4e9b\u6211\u4eec\u662f\u4e0d\u9700\u8981\u7684\u3002 \u6240\u4ee5\u8fd9\u4e2a\u5b57\u6bb5\u5c31\u7528\u6765\u89c4\u5b9a\u6211\u4eec\u5bf9 \u53d8\u66f4 \u7684\u5c55\u793a. tag \u4e4b\u524d\u8bf4\u4e86\uff0c\u8868\u5bf9\u5e94\u7684tag\uff0c\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5728pity\u91cc\u9762\u53ef\u4ee5\u662f \u6d4b\u8bd5\u7528\u4f8b \uff0c \u6d4b\u8bd5\u8ba1\u5212 \u7b49\u3002\u4ee5\u540e\u5982\u679c\u6211\u4eec\u60f3\u770b\u6240\u6709\u6d4b\u8bd5\u8ba1\u5212\u7684\u6539\u52a8\uff0c\u5c31\u53ef\u4ee5\u6839\u636etag\u6765\u7b5b\u9009\u3002 alias \u6211\u4eec\u7684\u64cd\u4f5c\u8bb0\u5f55\uff0c\u8bd5\u60f3\u4e00\u4e0b\uff0c\u5982\u679c\u7528\u8fd9\u6837\u7684\u65b9\u5f0f: [\u6570\u636e\u5e93\u914d\u7f6e] \u4e4c\u8fea\u5c14 \u7f16\u8f91\u4e86 \u6570\u636e\u5e93: \u672c\u5730\u6570\u636e\u5e93 name: ~~\u8001\u7684redis~~ -> \u65b0\u7684redis database: ~~user~~ -> pity_user \u770b\u4e0a\u53bb\u662f\u6ca1\u5565\u6bdb\u75c5\uff0c\u4f46\u662f\u5bf9\u7528\u6237\u6765\u8bf4 \u4e0d\u53cb\u597d \u554a!\u5982\u679c\u6211\u4eec\u80fd\u628a\u6570\u636e\u5e93\u7684name\u6362\u6210 \u540d\u79f0 \uff0cdatabase\u6362\u6210 \u6570\u636e\u5e93\u540d \u4f1a\u4e0d\u4f1a\u66f4\u597d\u4e9b? \u8fd9\u5c31\u662f\u522b\u540d\u7684\u76ee\u7684\u3002 __show__ \u8fd9\u4e2a\u53d8\u91cf\u662f\u7528\u6765 \u5c55\u793a \u4e4c\u8fea\u5c14 \u4fee\u6539\u4e86 xxxx\uff0c\u56e0\u4e3a\u6709\u65f6\u5019\u6211\u4eec\u53ef\u80fd\u4fee\u6539\u4e86XXX\u9879\u76eeXXX\u9879\u76ee\u89d2\u8272: \u4e4c\u8fea\u5c14\u6dfb\u52a0\u4e86\u9879\u76ee abc -> \u7528\u6237 \u674e\u5927\u5634 -> \u89d2\u8272 \u7ba1\u7406\u5458 \u8fd9\u91cc\u5c55\u793a\u5b57\u6bb5\u9700\u89813\u4e2a\uff0c\u5206\u522b\u662f\u9879\u76ee\uff0c\u7528\u6237\u548c\u89d2\u8272\u3002\u8fd9\u91cc\u6839\u636e__fields__\u8054\u52a8\uff0c\u53d6\u524d\u9762N\u4e2a\u5b57\u6bb5\u3002","title":"\u6539\u9020PityBase"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2899%29%20%E7%BB%99%E7%94%A8%E6%88%B7%E6%B7%BB%E5%8A%A0%E6%93%8D%E4%BD%9C%E6%97%A5%E5%BF%97/#pityrelationfield","text":"\u56e0\u4e3a\u6211\u4eec\u7684\u5b57\u6bb5\u540d\u53ef\u80fd\u662fxxx_id\uff0c\u9700\u8981\u5173\u8054\u5230\u522b\u7684\u5b57\u6bb5\uff0c\u8981\u4e0d\u5c31\u662f \u679a\u4e3e \u7c7b\uff0c\u6bd4\u5982type\u662f0\u4ee3\u8868\u7528\u4f8b\uff0c1\u4ee3\u8868sql\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u5efa\u7acb0->1\u4ee5\u53caxxx_id\u5230\u8868\u5b57\u6bb5\u7684\u6620\u5c04\u5173\u7cfb\u3002 \u8fd9\u4e48\u8bf4\u53ef\u80fd\u5f88\u62bd\u8c61\uff0c\u6211\u4eec\u4e3e\u4e2a\u5177\u4f53\u7684\u4f8b\u5b50: Redis\u8868\u6709\u4e2aenv\u5b57\u6bb5\uff0c\u4ed6\u6765\u81eaEnvironment\u8868\u7684id\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u628aenv\u6362\u6210Environment\u7684name\u5b57\u6bb5\uff08\u6bd4\u5982fat\uff09\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u80fd\u5f88\u597d\u5730\u8bc6\u522b\u51fa \u53d8\u52a8 \u7684\u6570\u636e\u3002 init_relation\u5219\u662f\u5efa\u7acb\u6b64\u7b49\u5173\u7cfb\uff0c\u5f85\u4f1a\u6211\u4eec\u4f1a\u8bf4\u660e\u3002","title":"\u65b0\u589ePityRelationField\u7c7b"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2899%29%20%E7%BB%99%E7%94%A8%E6%88%B7%E6%B7%BB%E5%8A%A0%E6%93%8D%E4%BD%9C%E6%97%A5%E5%BF%97/#configpy","text":"\u8bbe\u7f6e\u8fd9\u4e9b\u53d8\u91cf\u662f\u4e3a\u4e86\u80fd\u591f \u5f88\u597d\u5730 \u83b7\u53d6\u5bf9\u5e94\u7684\u503c\uff0c\u4e0d\u7136\u6211\u628a__fields__\u5199\u4e3a__field__\u5c31\u51fa\u5927\u95ee\u9898\u4e86\u3002","title":"\u4fee\u6539\u914d\u7f6e\u6587\u4ef6config.py"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2899%29%20%E7%BB%99%E7%94%A8%E6%88%B7%E6%B7%BB%E5%8A%A0%E6%93%8D%E4%BD%9C%E6%97%A5%E5%BF%97/#crud__init__py","text":"\u4e0a\u9762\u662f\u52a8\u6001\u5bfc\u5165\u5305\uff08\u5efa\u6570\u636e\u8868\u7528\u7684\uff09\uff0c\u4e0b\u9762\u5219\u662f\u8bbe\u7f6e \u6620\u5c04\u5173\u7cfb \u3002 \u4ee5Redis\u4e3a\u4f8b\uff0c\u53ef\u4ee5\u770b\u5230Redis.env\u6620\u5c04\u5230\u4e86Environment.id\uff0c\u7b2c\u4e8c\u4e2a\u5b57\u6bb5\u5219\u662f\u66ff\u6362\u6210Environment.name\u3002","title":"\u4fee\u6539crud/__init__.py"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2899%29%20%E7%BB%99%E7%94%A8%E6%88%B7%E6%B7%BB%E5%8A%A0%E6%93%8D%E4%BD%9C%E6%97%A5%E5%BF%97/#_4","text":"\u5177\u4f53\u7684 \u7ec6\u8282 \u5f88\u591a\uff0c\u5f88\u96be\u4e00\u6b65\u4e00\u6b65\u5199\u6e05\u695a\uff0c\u5927\u5bb6\u53ef\u4ee5\u67e5\u770bcrud/__init__.py\u91cc\u7684 insert_log \u65b9\u6cd5\u3002 \u6574\u4f53\u601d\u8def\u5c31\u662f\u6839\u636e\u9884\u8bbe\u7684\u5b57\u6bb5\uff0c\u5b58\u653e\u5bf9\u5e94\u7684\u5b57\u6bb5\u6539\u52a8\uff0c\u5b57\u6bb5\u6709\u522b\u540d\u5219\u66ff\u6362\u5b57\u6bb5\u7684\u522b\u540d\uff0c\u6bd4\u5982name->\u59d3\u540d\uff0c\u6709\u5176\u4ed6\u8868\u7684\u6570\u636e\u5219\u66ff\u6362\u4e3a\u5176\u4ed6\u8868\u7684\u6570\u636e\u3002","title":"\u5176\u4ed6\u7ec6\u8282"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2899%29%20%E7%BB%99%E7%94%A8%E6%88%B7%E6%B7%BB%E5%8A%A0%E6%93%8D%E4%BD%9C%E6%97%A5%E5%BF%97/#_5","text":"\u672c\u8282\u5185\u5bb9\u6bd4\u8f83\u591a\uff0c\u611f\u5174\u8da3\u7684\u670b\u53cb\u53ef\u4ee5\u50ac\u66f4\u6216\u8005\u81ea\u5df1\u67e5\u770b\u4ee3\u7801\u3002\u611f\u89c9\u7528\u6587\u5b57\u7684\u65b9\u5f0f\u5f88\u96be\u8bb2\u6e05\u695a\u3002 \u53c2\u8003\u94fe\u63a5: \u7f8e\u56e2\u5206\u4eab\u7684\u6587\u7ae0 https://juejin.cn/post/7009116644031070244 \u5bf9\u5e94git commit\u6539\u52a8: https://github.com/wuranxu/pity/commit/bf374ac4851ec24e1386b351549c15ebe26772df","title":"\u5177\u4f53\u6548\u679c"},{"location":"blog/%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E7%B3%BB%E5%88%97%2899%29%20%E7%BB%99%E7%94%A8%E6%88%B7%E6%B7%BB%E5%8A%A0%E6%93%8D%E4%BD%9C%E6%97%A5%E5%BF%97/#_6","text":"\u5982\u679c\u7b80\u5355\u8bb0\u5f55\u7684\u8bdd\uff0c\u4e0d\u7528\u8fd9\u4e48\u590d\u6742\uff0c\u5199\u51faxxx\u4fee\u6539\u4e86xxx\u5373\u53ef\u3002\u90a3\u4e2a\u53ef\u4ee5\u7528 \u88c5\u9970\u5668 \u5b8c\u6210\u3002\u6709\u5174\u8da3\u7684\u670b\u53cb\u53ef\u4ee5\u81ea\u5df1\u5b9e\u73b0\u3002 \u672c\u6587\u7531\u4e8e\u7bc7\u5e45\u95ee\u9898\uff0c\u5c31\u8bb2\u5230\u8fd9\u91cc\u4e86\uff0c\u6211\u53bb\u8865 \u6ce8\u91ca \u53bb\u4e86~\u4e0b\u4e00\u8282\u6211\u4eec\u628a\u4eca\u5929\u5199\u7684\u5b57\u6bb5\u6570\u636e\u5c55\u793a\u5728 \u4e2a\u4eba\u52a8\u6001\u9875\u9762 \u4e2d\u3002","title":"\u5176\u4ed6\u5b9e\u73b0"},{"location":"deploy/%E5%9C%A8%E7%BA%BF%E9%A2%84%E8%A7%88/","text":"\u5728\u7ebf\u4f53\u9a8c \u5728\u7ebf\u9884\u89c8 \u76ee\u524d\u6211\u7684 \u9879\u76ee \u6258\u7ba1\u5728\u81ea\u5df1\u7684\u4e91\u670d\u52a1\u5668\u4e0a\uff0c\u5b83\u5927\u698222\u5e7411\u6708\u4efd\u5230\u671f\uff0c\u6240\u4ee5\u5728\u6b64\u4e4b\u524d\u4f60\u4eec\u90fd\u80fd\u8f7b\u677e\u8bbf\u95ee\u5230\u4ed6\u3002\u5982\u679c\u6709\u4eba\u4f7f\u7528\u7684\u8bdd\uff0c\u6211\u4f1a\u5c3d\u91cf\u7ef4\u6301\u5b83\u7684\u8fd0\u8425\u3002 \u70b9\u51fb\u8fdb\u5165\u9884\u89c8\u5730\u5740 \u63d0\u793a \u7531\u4e8e\u670d\u52a1\u5668\u7684 \u914d\u7f6e \u548c \u5e26\u5bbd \u7b49\u539f\u56e0\uff0c\u4f1a\u5bfc\u81f4\u9875\u9762\u52a0\u8f7d\u4f1a\u8d39\u5f88\u957f\u65f6\u95f4\uff0c\u8bf7\u5927\u5bb6\u8010\u5fc3\u7b49\u5f85\u3002","title":"\u5728\u7ebf\u4f53\u9a8c"},{"location":"deploy/%E5%9C%A8%E7%BA%BF%E9%A2%84%E8%A7%88/#_1","text":"\u5728\u7ebf\u9884\u89c8 \u76ee\u524d\u6211\u7684 \u9879\u76ee \u6258\u7ba1\u5728\u81ea\u5df1\u7684\u4e91\u670d\u52a1\u5668\u4e0a\uff0c\u5b83\u5927\u698222\u5e7411\u6708\u4efd\u5230\u671f\uff0c\u6240\u4ee5\u5728\u6b64\u4e4b\u524d\u4f60\u4eec\u90fd\u80fd\u8f7b\u677e\u8bbf\u95ee\u5230\u4ed6\u3002\u5982\u679c\u6709\u4eba\u4f7f\u7528\u7684\u8bdd\uff0c\u6211\u4f1a\u5c3d\u91cf\u7ef4\u6301\u5b83\u7684\u8fd0\u8425\u3002 \u70b9\u51fb\u8fdb\u5165\u9884\u89c8\u5730\u5740 \u63d0\u793a \u7531\u4e8e\u670d\u52a1\u5668\u7684 \u914d\u7f6e \u548c \u5e26\u5bbd \u7b49\u539f\u56e0\uff0c\u4f1a\u5bfc\u81f4\u9875\u9762\u52a0\u8f7d\u4f1a\u8d39\u5f88\u957f\u65f6\u95f4\uff0c\u8bf7\u5927\u5bb6\u8010\u5fc3\u7b49\u5f85\u3002","title":"\u5728\u7ebf\u4f53\u9a8c"},{"location":"deploy/%E9%83%A8%E7%BD%B2/","text":"\u670d\u52a1\u5668\u90e8\u7f72 \u8981\u90e8\u7f72\u5230\u670d\u52a1\u5668\uff0c\u6211\u4eec\u9700\u8981\u6574\u5408\u524d\u540e\u7aef\u3002 \u57fa\u672c\u4ecb\u7ecd \u6211\u4eec\u5728\u672c\u5730\u5f00\u53d1\u7684\u65f6\u5019\uff0c\u524d\u7aef\u662f\u65b0\u8d77\u4e86\u4e00\u4e2a\u670d\u52a1\uff0c\u800c\u540e\u7aef\u4e5f\u6709\u4e00\u4e2a\u670d\u52a1\uff0c\u8fd9\u4e2a\u662f \u524d\u540e\u7aef\u5206\u79bb \uff0c\u4e3a\u4e86\u7b80\u5316\u5f00\u53d1\u3002 \u4f46\u662f\u5f53\u6211\u4eec\u5f00\u53d1\u5b8c\u6bd5\uff0c\u9700\u8981\u90e8\u7f72\u7684\u65f6\u5019\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u524d\u7aef\u9875\u9762 \u6253\u5305 \u4e3a\u9759\u6001\u8d44\u6e90\uff0c\u5d4c\u5165\u5230\u540e\u7aef\u670d\u52a1\u4e2d\u3002 \u540e\u7aef\u670d\u52a1\u4e3a\u6211\u4eec\u63d0\u4f9bhtml/js/css\u7684\u8bbf\u95ee\uff0c\u8fbe\u5230\u670d\u52a1\u4e00\u4f53\u5316\u7684\u76ee\u7684\uff0c\u4ece\u800c\u7b80\u5316 \u90e8\u7f72\u5de5\u4f5c \u3002 \u8fd9\u6837\u505a\u7684\u597d\u5904 \u90e8\u7f72\u5341\u5206\u65b9\u4fbf \u4e0d\u9700\u8981\u5f15\u5165\u989d\u5916\u7684\u7ec4\u4ef6\u5982 nginx \uff0c pm2 \u53bb\u542f\u52a8\u524d\u7aef\u670d\u52a1 \u6ca1\u6709\u8de8\u57df\u95ee\u9898 \u524d\u540e\u7aef\u4e0d\u5b58\u5728\u8de8\u673a\u5668\u8bbf\u95ee\u7684\u60c5\u51b5\uff0c\u964d\u4f4e\u4e86\u7f51\u7edc\u5f15\u8d77\u7684\u6545\u969c\u7387 \u8fd9\u6837\u505a\u7684\u574f\u5904 \u4e00\u65e6\u540e\u7aef\u5d29\u6e83\uff0c\u524d\u7aef\u9875\u9762\u65e0\u6cd5\u663e\u793a\uff0c\u5bf9\u4e8e \u6392\u67e5\u95ee\u9898 \u4e0d\u591f\u65b9\u4fbf \u90e8\u7f72\u4f9d\u8d56\u4e8e\u540e\u7aef\uff0c\u524d\u7aef\u65e0\u6cd5\u72ec\u7acb\u4e0a\u7ebf\uff0c\u9700\u8981\u7b49\u540e\u7aef\u5f00\u53d1\u4e00\u8d77\u53d1\u5e03 \u524d\u7aef\u72ec\u7acb\u5f00\u53d1\u540e\u8fd8\u9700\u63d0\u4ea4\u4ee3\u7801\u5230\u540e\u7aef\u9879\u76ee \u53d1\u5e03\u4f1a\u66f4\u52a0\u9891\u7e41\uff0c\u4ee5\u524d\u53ef\u80fd\u53ea\u9700\u8981\u53d1\u5e03\u524d\u7aef\u5373\u53ef\uff0c\u73b0\u5728\u9700\u8981\u5168\u90e8\u90fd\u53d1 \u4fee\u6539\u524d\u7aef\u914d\u7f6e\u5730\u5740 \u4fee\u6539pityWeb/src/consts/config.js\u4e2d\u7684URL\uff0c\u6539\u4e3a '' \uff0c\u8fd9\u6837\u6211\u4eec\u8bf7\u6c42\u7684\u540e\u7aef\u5730\u5740\u5c31\u9ed8\u8ba4\u4e0d\u5e26\u4e0ahost\u4e86\u3002 \u53ea\u6709\u8def\u7531\u5982: /api \u3002\u8fd9\u6837\u505a\u7684\u597d\u5904\u662f\u6211\u4eec\u53ef\u4ee5\u8f7b\u677e\u8c03\u6574\u540e\u7aef\u7684\u5730\u5740\uff0c\u800c \u524d\u7aef\u4ee3\u7801\u4e0d\u9700\u8981\u4efb\u4f55\u6539\u53d8 \u3002 \u6253\u5305\u524d\u7aef\u4ee3\u7801 \u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u6253\u5305\u6211\u4eec\u7684\u524d\u7aef\u4ee3\u7801: npm run build pityWeb\u76ee\u5f55\u4e0b\u4f1a\u51fa\u73b0 dist \u76ee\u5f55\uff0c\u6253\u5305\u597d\u4ee5\u540e\u6211\u4eec\u53bb\u66ff\u6362\u540e\u7aef\u9879\u76ee\u5bf9\u5e94\u7684\u9759\u6001\u6587\u4ef6: pityWeb/dist/* -> pity/statics/ \u628adist\u7684\u6240\u6709\u6587\u4ef6\u90fd\u653e\u5230pity/statics\u76ee\u5f55\u4e0b\u3002 \u6ce8\u610f \u6ce8\u610f\u8fd9\u91cc\u662fstatics\u800c\u4e0d\u662f static \u3002 \u73b0\u5728\uff0c\u6211\u4eec\u7684\u670d\u52a1\u5c31\u662f\u4e00\u4f53\u5316\u4e86\uff0c\u524d\u540e\u7aef\u4ee3\u7801\u5f62\u6210\u4e86\u4e00\u4e2a \u6574\u4f53 \u3002 \u7b80\u5355\u90e8\u7f72 \u5982\u679c\u4f60\u53ea\u60f3\u7b80\u5355\u5728\u670d\u52a1\u5668\u8fd0\u884c\u8fd9\u4e2a\u5e94\u7528\u7684\u8bdd\uff0c\u4f60\u53ef\u4ee5\u5c1d\u8bd5: nohup python main.py & \u8fd9\u6837\u4f60\u5c31\u80fd\u6b63\u5e38\u8fd0\u884c\u5e94\u7528\u4e86\uff0c\u4f46\u662f\u901a\u5e38\u6211\u4e0d\u63a8\u8350\u4f60\u8fd9\u4e48\u505a\u3002 \u8b66\u544a \u5982\u679c\u771f\u7684\u8981\u8fd0\u7528\u5230\u751f\u4ea7\u7ea7\u522b\uff0c\u90a3\u4e48\u5982\u6b64\u90e8\u7f72\u662f\u975e\u5e38 \u4e0d\u9760\u8c31 \u7684\u3002\u56e0\u4e3a\u4f60\u6ca1\u6cd5\u9884\u6599\u4f60\u7684\u4ee3\u7801\u7684\u5065\u7855\u6027\uff0c\u4e5f\u65e0\u6cd5\u4fdd\u8bc1\u6ca1\u6709\u610f\u5916\u53d1\u751f\uff0c\u6bd4\u5982\u8ba4\u4e3a\u5173\u95ed\u4e86\u4f60\u7684\u670d\u52a1\u3002\u6240\u4ee5\u4f60\u5f97\u614e\u91cd\u8003\u8651\u3002 \u90e8\u7f72\u5efa\u8bae \u5408\u7406\u7684\u90e8\u7f72\u65b9\u5f0f\u9700\u8981\u6709 \u5b95\u673a\u81ea\u52a8\u62c9\u8d77 \uff0c \u90e8\u7f72\u65b9\u4fbf \u7b49\u7279\u70b9\u3002\u63a8\u8350\u4ee5\u4e0b\u51e0\u79cd\u65b9\u5f0f: Supervisor supervisor\u53ef\u4ee5\u81ea\u52a8\u62c9\u8d77\u4f60\u7684\u5e94\u7528\uff0c\u4e5f\u53ef\u4ee5\u6839\u636e\u547d\u4ee4\u505c\u6b62/\u91cd\u542f\u4f60\u7684\u5e94\u7528\uff0c\u5177\u4f53\u7684\u53c2\u8003\u53ef\u4ee5\u81ea\u884c\u67e5\u9605\u8d44\u6599\u3002 univorn \u8fd9\u4e2a\u662f FastApi \u63a8\u8350\u7684\u90e8\u7f72\u65b9\u5f0f\uff0c\u8be6\u60c5\u53ef\u4ee5\u53c2\u8003: https://fastapi.tiangolo.com/deployment/manually/ Docker \u53c2\u8003\u6587\u6863: https://fastapi.tiangolo.com/deployment/docker/ \u8fd9\u6d89\u53ca\u5230dockerfile\u6587\u4ef6\u7684\u7f16\u5199\uff0c\u4e5f\u9700\u8981\u4f60\u5bf9docker\u6709\u4e00\u5b9a\u7684\u4e86\u89e3\u3002\u5982\u679c\u4f60\u4eec\u516c\u53f8\u6709\u5bf9\u5e94\u7684 \u53d1\u5e03\u7cfb\u7edf \u6216\u8005 \u6613\u7528\u7684pipeline \uff0c\u5efa\u8bae\u4f60\u4eec\u63a5\u5165\u3002","title":"\u7ebf\u4e0a\u90e8\u7f72"},{"location":"deploy/%E9%83%A8%E7%BD%B2/#_1","text":"\u8981\u90e8\u7f72\u5230\u670d\u52a1\u5668\uff0c\u6211\u4eec\u9700\u8981\u6574\u5408\u524d\u540e\u7aef\u3002","title":"\u670d\u52a1\u5668\u90e8\u7f72"},{"location":"deploy/%E9%83%A8%E7%BD%B2/#_2","text":"\u6211\u4eec\u5728\u672c\u5730\u5f00\u53d1\u7684\u65f6\u5019\uff0c\u524d\u7aef\u662f\u65b0\u8d77\u4e86\u4e00\u4e2a\u670d\u52a1\uff0c\u800c\u540e\u7aef\u4e5f\u6709\u4e00\u4e2a\u670d\u52a1\uff0c\u8fd9\u4e2a\u662f \u524d\u540e\u7aef\u5206\u79bb \uff0c\u4e3a\u4e86\u7b80\u5316\u5f00\u53d1\u3002 \u4f46\u662f\u5f53\u6211\u4eec\u5f00\u53d1\u5b8c\u6bd5\uff0c\u9700\u8981\u90e8\u7f72\u7684\u65f6\u5019\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u524d\u7aef\u9875\u9762 \u6253\u5305 \u4e3a\u9759\u6001\u8d44\u6e90\uff0c\u5d4c\u5165\u5230\u540e\u7aef\u670d\u52a1\u4e2d\u3002 \u540e\u7aef\u670d\u52a1\u4e3a\u6211\u4eec\u63d0\u4f9bhtml/js/css\u7684\u8bbf\u95ee\uff0c\u8fbe\u5230\u670d\u52a1\u4e00\u4f53\u5316\u7684\u76ee\u7684\uff0c\u4ece\u800c\u7b80\u5316 \u90e8\u7f72\u5de5\u4f5c \u3002 \u8fd9\u6837\u505a\u7684\u597d\u5904 \u90e8\u7f72\u5341\u5206\u65b9\u4fbf \u4e0d\u9700\u8981\u5f15\u5165\u989d\u5916\u7684\u7ec4\u4ef6\u5982 nginx \uff0c pm2 \u53bb\u542f\u52a8\u524d\u7aef\u670d\u52a1 \u6ca1\u6709\u8de8\u57df\u95ee\u9898 \u524d\u540e\u7aef\u4e0d\u5b58\u5728\u8de8\u673a\u5668\u8bbf\u95ee\u7684\u60c5\u51b5\uff0c\u964d\u4f4e\u4e86\u7f51\u7edc\u5f15\u8d77\u7684\u6545\u969c\u7387 \u8fd9\u6837\u505a\u7684\u574f\u5904 \u4e00\u65e6\u540e\u7aef\u5d29\u6e83\uff0c\u524d\u7aef\u9875\u9762\u65e0\u6cd5\u663e\u793a\uff0c\u5bf9\u4e8e \u6392\u67e5\u95ee\u9898 \u4e0d\u591f\u65b9\u4fbf \u90e8\u7f72\u4f9d\u8d56\u4e8e\u540e\u7aef\uff0c\u524d\u7aef\u65e0\u6cd5\u72ec\u7acb\u4e0a\u7ebf\uff0c\u9700\u8981\u7b49\u540e\u7aef\u5f00\u53d1\u4e00\u8d77\u53d1\u5e03 \u524d\u7aef\u72ec\u7acb\u5f00\u53d1\u540e\u8fd8\u9700\u63d0\u4ea4\u4ee3\u7801\u5230\u540e\u7aef\u9879\u76ee \u53d1\u5e03\u4f1a\u66f4\u52a0\u9891\u7e41\uff0c\u4ee5\u524d\u53ef\u80fd\u53ea\u9700\u8981\u53d1\u5e03\u524d\u7aef\u5373\u53ef\uff0c\u73b0\u5728\u9700\u8981\u5168\u90e8\u90fd\u53d1","title":"\u57fa\u672c\u4ecb\u7ecd"},{"location":"deploy/%E9%83%A8%E7%BD%B2/#_3","text":"\u4fee\u6539pityWeb/src/consts/config.js\u4e2d\u7684URL\uff0c\u6539\u4e3a '' \uff0c\u8fd9\u6837\u6211\u4eec\u8bf7\u6c42\u7684\u540e\u7aef\u5730\u5740\u5c31\u9ed8\u8ba4\u4e0d\u5e26\u4e0ahost\u4e86\u3002 \u53ea\u6709\u8def\u7531\u5982: /api \u3002\u8fd9\u6837\u505a\u7684\u597d\u5904\u662f\u6211\u4eec\u53ef\u4ee5\u8f7b\u677e\u8c03\u6574\u540e\u7aef\u7684\u5730\u5740\uff0c\u800c \u524d\u7aef\u4ee3\u7801\u4e0d\u9700\u8981\u4efb\u4f55\u6539\u53d8 \u3002","title":"\u4fee\u6539\u524d\u7aef\u914d\u7f6e\u5730\u5740"},{"location":"deploy/%E9%83%A8%E7%BD%B2/#_4","text":"\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u6253\u5305\u6211\u4eec\u7684\u524d\u7aef\u4ee3\u7801: npm run build pityWeb\u76ee\u5f55\u4e0b\u4f1a\u51fa\u73b0 dist \u76ee\u5f55\uff0c\u6253\u5305\u597d\u4ee5\u540e\u6211\u4eec\u53bb\u66ff\u6362\u540e\u7aef\u9879\u76ee\u5bf9\u5e94\u7684\u9759\u6001\u6587\u4ef6: pityWeb/dist/* -> pity/statics/ \u628adist\u7684\u6240\u6709\u6587\u4ef6\u90fd\u653e\u5230pity/statics\u76ee\u5f55\u4e0b\u3002 \u6ce8\u610f \u6ce8\u610f\u8fd9\u91cc\u662fstatics\u800c\u4e0d\u662f static \u3002 \u73b0\u5728\uff0c\u6211\u4eec\u7684\u670d\u52a1\u5c31\u662f\u4e00\u4f53\u5316\u4e86\uff0c\u524d\u540e\u7aef\u4ee3\u7801\u5f62\u6210\u4e86\u4e00\u4e2a \u6574\u4f53 \u3002","title":"\u6253\u5305\u524d\u7aef\u4ee3\u7801"},{"location":"deploy/%E9%83%A8%E7%BD%B2/#_5","text":"\u5982\u679c\u4f60\u53ea\u60f3\u7b80\u5355\u5728\u670d\u52a1\u5668\u8fd0\u884c\u8fd9\u4e2a\u5e94\u7528\u7684\u8bdd\uff0c\u4f60\u53ef\u4ee5\u5c1d\u8bd5: nohup python main.py & \u8fd9\u6837\u4f60\u5c31\u80fd\u6b63\u5e38\u8fd0\u884c\u5e94\u7528\u4e86\uff0c\u4f46\u662f\u901a\u5e38\u6211\u4e0d\u63a8\u8350\u4f60\u8fd9\u4e48\u505a\u3002 \u8b66\u544a \u5982\u679c\u771f\u7684\u8981\u8fd0\u7528\u5230\u751f\u4ea7\u7ea7\u522b\uff0c\u90a3\u4e48\u5982\u6b64\u90e8\u7f72\u662f\u975e\u5e38 \u4e0d\u9760\u8c31 \u7684\u3002\u56e0\u4e3a\u4f60\u6ca1\u6cd5\u9884\u6599\u4f60\u7684\u4ee3\u7801\u7684\u5065\u7855\u6027\uff0c\u4e5f\u65e0\u6cd5\u4fdd\u8bc1\u6ca1\u6709\u610f\u5916\u53d1\u751f\uff0c\u6bd4\u5982\u8ba4\u4e3a\u5173\u95ed\u4e86\u4f60\u7684\u670d\u52a1\u3002\u6240\u4ee5\u4f60\u5f97\u614e\u91cd\u8003\u8651\u3002","title":"\u7b80\u5355\u90e8\u7f72"},{"location":"deploy/%E9%83%A8%E7%BD%B2/#_6","text":"\u5408\u7406\u7684\u90e8\u7f72\u65b9\u5f0f\u9700\u8981\u6709 \u5b95\u673a\u81ea\u52a8\u62c9\u8d77 \uff0c \u90e8\u7f72\u65b9\u4fbf \u7b49\u7279\u70b9\u3002\u63a8\u8350\u4ee5\u4e0b\u51e0\u79cd\u65b9\u5f0f: Supervisor supervisor\u53ef\u4ee5\u81ea\u52a8\u62c9\u8d77\u4f60\u7684\u5e94\u7528\uff0c\u4e5f\u53ef\u4ee5\u6839\u636e\u547d\u4ee4\u505c\u6b62/\u91cd\u542f\u4f60\u7684\u5e94\u7528\uff0c\u5177\u4f53\u7684\u53c2\u8003\u53ef\u4ee5\u81ea\u884c\u67e5\u9605\u8d44\u6599\u3002 univorn \u8fd9\u4e2a\u662f FastApi \u63a8\u8350\u7684\u90e8\u7f72\u65b9\u5f0f\uff0c\u8be6\u60c5\u53ef\u4ee5\u53c2\u8003: https://fastapi.tiangolo.com/deployment/manually/ Docker \u53c2\u8003\u6587\u6863: https://fastapi.tiangolo.com/deployment/docker/ \u8fd9\u6d89\u53ca\u5230dockerfile\u6587\u4ef6\u7684\u7f16\u5199\uff0c\u4e5f\u9700\u8981\u4f60\u5bf9docker\u6709\u4e00\u5b9a\u7684\u4e86\u89e3\u3002\u5982\u679c\u4f60\u4eec\u516c\u53f8\u6709\u5bf9\u5e94\u7684 \u53d1\u5e03\u7cfb\u7edf \u6216\u8005 \u6613\u7528\u7684pipeline \uff0c\u5efa\u8bae\u4f60\u4eec\u63a5\u5165\u3002","title":"\u90e8\u7f72\u5efa\u8bae"},{"location":"friends/%E5%85%AC%E4%BC%97%E5%8F%B7/","text":"\u4f18\u79c0\u535a\u4e3b\u4eec \u4ed6\u4eec\u662f\u4e1a\u5185 \u9876\u5c16\u5927\u4f6c \uff0c\u4e5f\u548c\u6211\u4e00\u6837\u4e50\u4e8e\u5206\u4eab\u81ea\u5df1\u7684\u6280\u672f\u3002\u6211\u4eec\u5e73\u65f6\u4e5f\u4f1a\u79c1\u4e0b\u4ea4\u6d41\u6d4b\u8bd5\u76f8\u5173\u7684\u5fc3\u5f97\u3002\u5927\u5bb6\u4e5f\u53ef\u4ee5\u5173\u6ce8\u4e00\u4e0b\u4ed6\u4eec\u7684\u516c\u4f17\u53f7\u3002 \u6d4b\u8bd5\u5f00\u53d1\u5e72\u8d27 \u6211\u53bb\u70ed\u996d \uff0c\u548c\u6211\u8ba4\u8bc6\u5f88\u591a\u5e74\u7684\u8001\u53cb\uff0c\u5e26\u9886\u6211\u505a\u516c\u4f17\u53f7\u7684\u9886\u8def\u4eba\u3002\u5728\u516c\u4f17\u53f7\u66f4\u6587\u521d\u671f\u7ed9\u4e88\u4e86\u6211\u5de8\u5927\u7684\u6d41\u91cf\uff0c\u8ba9\u6211\u6709 \u66f4\u4e30\u5bcc \u7684\u52a8\u529b\u7ee7\u7eed\u5199\u4f5c\u3002\u4ed6\u672c\u4eba\u6280\u672f\u80fd\u529b\u76f8\u5f53\u51fa\u5f69\uff0c\u662f\u67d0\ud83e\udd84\u7684 \u6d4b\u5f00\u8d1f\u8d23\u4eba \u3002 \u6280\u672f\u6808: Django\uff0cPython, Vue\uff0cJavascript\uff0cBootstrap\u7b49\u7b49\uff0c\u6d4b\u8bd5\u7406\u8bba\u7279\u522b\u624e\u5b9e\u3002\u611f\u5174\u8da3\u7684\u53ef\u4ee5\u5173\u6ce8\u4e0b\u4ed6\u7684\u516c\u4f17\u53f7: \u6d4b\u8bd5\u5f00\u53d1\u5e72\u8d27 \uff0c\u4e00\u4e2a\u5e72\u8d27\u6ee1\u6ee1\u7684\u826f\u5fc3\u516c\u4f17\u53f7\u3002 \u7b54\u5e94\u6211\uff0c\u5173\u6ce8\u4ed6\u4ee5\u540e \u4e0d\u8981\u5fd8\u4e86\u6211 \u597d\u5417\uff01 \u6d4b\u8bd5\u5f00\u53d1\u6742\u8d27 \u8fd9\u662f\u4e00\u4e2a\u975e\u5e38\u7f8e\u817b\u800c\u4e14 \u6280\u672f\u975e\u5e38\u597d \u7684\u59b9\u5b50\uff0c\u5979\u7684\u516c\u4f17\u53f7\u548c\u540d\u5b57\u4e00\u6837\uff0c\u6bd4\u8f83\u6742\u3002\u5728\u5979\u8fd9\u513f\uff0c\u4f60\u53ef\u4ee5\u770b\u5230\u7cbe\u5f69\u7684\u6587\u7ae0\uff0c\u5982 selenium\u600e\u4e48\u64cd\u4f5c\u5df2\u7ecf\u6253\u5f00\u7684\u6d4f\u89c8\u5668 \uff0c\u4e5f\u53ef\u4ee5\u770b\u5230\u64b8\u732b\u65e5\u5e38\uff0c\u66f4\u53ef\u4ee5\u770b\u5230 \u771f\u4eba\u7206\u7167 \uff0c\u603b\u4e4b\u5c31\u662f \u53c8\u6709\u624d\u534e\u53c8\u6709\u7f8e\u8c8c \uff0c\u5173\u6ce8\u5979\uff0c\u6d4b\u5f00\u8def\u4e0a\u4e0d\u8ff7\u8def\uff01 \u6280\u672f\u6808: \u7279\u522b\u5168\u9762\uff0c\u57fa\u672c\u5565\u90fd\u4f1a\uff0c\u5173\u6ce8\u5c31\u5bf9\u4e86\u3002 \u6d4b\u8bd5\u5f00\u53d1\u6c34\u8d27 \u6c34\u8d27\u4e5f\u662f\u4eba\u5982\u5176\u540d\uff0c\u4f46\u662f\u5185\u5bb9\u53ef\u4e5f\u6709\u771f\u672c\u4e8b\u3002\u4f5c\u4e3a\u4e00\u4e2a\u4e92\u8054\u7f51\u884c\u4e1a \u6253\u62fc\u591a\u5e74 \u7684\u4eba\uff0c\u62e5\u6709 testerhome \u9876\u7ea7\u4eba\u8109\uff0c\u4e5f\u662f\u793e\u533a\u7684\u7f14\u9020\u8005\u4e4b\u4e00\u3002\u76ee\u524d\u6b63\u5728\u7814\u7a76\u6570\u636e\u5de5\u5382\uff0c\u5e73\u65f6\u4e5f\u7231\u5206\u4eab\u4e00\u4e9b\u751f\u6d3b\u59ff\u52bf\uff0c\u5927\u5bb6\u6709\u5174\u8da3\u53ef\u4ee5\u5173\u6ce8\u4ed6\uff01\u7231\u8dd1\u6b65\u7231\u5065\u8eab\u7684\u53ef\u4ee5\u5173\u6ce8\u4e0b\u4ed6\uff0c\u5e74\u9f84\u4e0e\u957f\u76f8\u4e0d\u7b26\u662f\u4ec0\u4e48\u4f53\u9a8c\uff0c\u5927\u6982\u8bf4\u7684\u5c31\u662f\u4ed6\u4e86\uff0c\u4e1a\u5185\u4eba\u79f0 \u699c\u4e00\u5927\u54e5 \uff0c\u4ece\u5367\u5ba4\u5230\u5395\u6240\u8981\u8d7010\u5206\u949f\u7684\u4eba\u3002 \u7c73\u6d1b\u7684\u6d4b\u5f00\u65e5\u8bb0 \u5bf9\uff0c\u8fd9\u4e2a\u5c31\u662f\u6211\u7684\u5c0f\u53f7\u5566\u3002\u56e0\u4e3a\u6709\u7559\u8a00\u529f\u80fd\uff0c\u6240\u4ee5\u4fdd\u7559\u4e86\u4ed6\uff01\u4e4b\u524d\u7c89\u4e1d\u6570\u91cf\u8fd8\u4e0d\u7b97\u5c11\uff0c\u8fc1\u79fb\u4f1a\u5bfc\u81f4\u7c89\u4e1d\u6d41\u5931\uff0c\u6240\u4ee5\u5e76\u6ca1\u6709\u600e\u4e48\u4f7f\u7528\u3002\u4e0d\u8fc7\u540e\u7eed\u5982\u679c\u6709\u66f4\u591a\u65b0\u7684\u60f3\u6cd5\uff0c\u4f1a\u5728\u8fd9\u4e2a\u4e0a\u9762\u53d1\u5e03\u5566~\u81f3\u4e8e\u4e3a\u4ec0\u4e48\u53eb \u6cb9\u8d27 \uff0c\u8fd8\u662f\u4e0d\u662f\u56e0\u4e3a: \u6211\u6652\u5e72\u4e86\u6c89\u9ed8\uff0c\u6094\u5f97\u5f88\u51b2\u52a8\uff01","title":"\u667a\u56ca\u56e2"},{"location":"friends/%E8%81%94%E7%B3%BB%E4%BD%9C%E8%80%85/","text":"\u8054\u7cfb\u4f5c\u8005 \u5982\u679c\u4f60\u89c9\u5f97\u4f5c\u8005\u5199\u7684\u4e0d\u9519\uff0c\u60f3\u548c\u4f5c\u8005\u6709\u8fdb\u4e00\u6b65\u7684\u4ea4\u6d41\uff0c\u6bd4\u5982 \u5de5\u4f5c\u673a\u4f1a \u6216\u8005\u5b66\u672f\u4e0a\u7684\u63a2\u8ba8\uff0c\u90a3\u5c31\u5feb\u8054\u7cfb\u6211\u5427\uff01 \u8054\u7cfb\u65b9\u5f0f \u5fae\u4fe1(\u63a8\u8350) \u6211\u7684\u5fae\u4fe1\u53f7\u662f: wuranxu \uff0c\u5f88\u5e38\u7528\uff0c\u53ef\u4ee5\u968f\u65f6\u52a0\u6211\u63a2\u8ba8\u3002\u5982\u679c\u6027\u683c\u6bd4\u8f83\u6d3b\u6cfc\u7684\uff0c\u53ef\u4ee5\u52a0\u5165\u6211\u4eec\u7684 \u6d4b\u8bd5\u5f00\u53d1\u7fa4 \uff0c\u548c\u7fa4\u53cb\u4eec\u4e00\u8d77\u8ba8\u8bba\u3002 \u52a0\u7fa4\u7684\u65b9\u5f0f\u662f \u52a0\u6211\u4e3a\u597d\u53cb \uff0c\u6211\u62c9\u4f60\u8fdb\u7fa4\u3002 QQ \u6211\u7684QQ\u53f7\u662f619434176\uff0c\u4f46\u662f \u8fd1\u5e74\u6765 \u5df2\u7ecf\u4e0d\u592a\u4f7f\u7528\u4e86\u3002 \u90ae\u7bb1 \u5982\u679c\u4f60\u66f4\u559c\u6b22\u7528 \u90ae\u7bb1 \u7684\u65b9\u5f0f\uff0c\u90a3\u4f60\u53ef\u4ee5\u7ed9\u6211\u53d1\u90ae\u4ef6\uff0c\u6211\u5e38\u7528\u7684\u90ae\u7bb1\u662fQQ\u90ae\u7bb1: 619434176@qq.com \uff0c\u6b22\u8fce\u7ed9\u6211\u5199\u4fe1\u3002 \u8d5e\u52a9 \u56e0\u4e3a pity \u662f\u7eaf\u5f00\u6e90\u7684\u9879\u76ee\uff0c\u5176\u5b9e\u662f\u6ca1\u6709 \u6536\u5165\u6765\u6e90 \u7684\uff0c\u53ea\u662f\u5728 \u4e1a\u4f59\u65f6\u95f4 \u5f00\u53d1\uff0c\u800c\u9879\u76ee\u89c4\u5212\u53c8\u6bd4\u8f83\u5927\u3002\u5982\u679c\u6709\u8001\u677f\u613f\u610f\u7684\u8bdd\uff0c\u53ef\u4ee5\u6253\u8d4f\u652f\u6301\u4e00\u4e0b\u3002\u4e0d\u7528\u592a\u5938\u5f20\uff0c\u80fd\u4e70\u4e2a \u53ef\u7231\u591a \u6211\u5c31\u5df2\u7ecf\u5f88\u6ee1\u8db3\u5566\uff01 \u5982\u679c\u5927\u5bb6\u89c9\u5f97\u770b\u7684\u6709\u6536\u76ca\uff0c\u60f3\u6253\u8d4f\u53c8 \u56ca\u4e2d\u7f9e\u6da9 \u7684\uff0c\u53ef\u4ee5\u5173\u6ce8\u6211\u7684 \u516c\u4f17\u53f7 : \u6d4b\u8bd5\u5f00\u53d1\u5751\u8d27 \uff0c\u53ea\u8981\u4f60\u968f\u4fbf\u70b9\u4e00\u4e0b\u6211\u4e00\u7bc7\u6587\u7ae0\u4e0b\u9762\u7684 \u5e7f\u544a \u5c31\u53ef\u4ee5 \u6253\u8d4f \u6211\u5566~","title":"\u8054\u7cfb\u4f5c\u8005"},{"location":"friends/%E8%81%94%E7%B3%BB%E4%BD%9C%E8%80%85/#_1","text":"\u56e0\u4e3a pity \u662f\u7eaf\u5f00\u6e90\u7684\u9879\u76ee\uff0c\u5176\u5b9e\u662f\u6ca1\u6709 \u6536\u5165\u6765\u6e90 \u7684\uff0c\u53ea\u662f\u5728 \u4e1a\u4f59\u65f6\u95f4 \u5f00\u53d1\uff0c\u800c\u9879\u76ee\u89c4\u5212\u53c8\u6bd4\u8f83\u5927\u3002\u5982\u679c\u6709\u8001\u677f\u613f\u610f\u7684\u8bdd\uff0c\u53ef\u4ee5\u6253\u8d4f\u652f\u6301\u4e00\u4e0b\u3002\u4e0d\u7528\u592a\u5938\u5f20\uff0c\u80fd\u4e70\u4e2a \u53ef\u7231\u591a \u6211\u5c31\u5df2\u7ecf\u5f88\u6ee1\u8db3\u5566\uff01 \u5982\u679c\u5927\u5bb6\u89c9\u5f97\u770b\u7684\u6709\u6536\u76ca\uff0c\u60f3\u6253\u8d4f\u53c8 \u56ca\u4e2d\u7f9e\u6da9 \u7684\uff0c\u53ef\u4ee5\u5173\u6ce8\u6211\u7684 \u516c\u4f17\u53f7 : \u6d4b\u8bd5\u5f00\u53d1\u5751\u8d27 \uff0c\u53ea\u8981\u4f60\u968f\u4fbf\u70b9\u4e00\u4e0b\u6211\u4e00\u7bc7\u6587\u7ae0\u4e0b\u9762\u7684 \u5e7f\u544a \u5c31\u53ef\u4ee5 \u6253\u8d4f \u6211\u5566~","title":"\u8d5e\u52a9"},{"location":"help/%E5%B8%AE%E5%8A%A9%E6%96%87%E6%A1%A3/","text":"\u522b\u7740\u6025\uff0c\u6b63\u5728\u706b\u70ed\u7f16\u5199\u4e2d...","title":"\u5e2e\u52a9\u6587\u6863"},{"location":"requirements/%E5%87%86%E5%A4%87%E6%9D%A1%E4%BB%B6/","text":"\u73af\u5883\u51c6\u5907 \u6211\u4eec\u6709\u4e00\u4e9b\u5fc5\u8981\u7684\u73af\u5883\u9700\u8981\u51c6\u5907\uff0c\u4ee5\u4e0b\u5217\u51fa\u4e86\u5fc5\u5907\u9879\u76ee\u7684\u6e05\u5355\uff0c\u76f8\u4fe1\u5927\u5bb6\u90fd\u53ef\u4ee5\u81ea\u884c\u5b89\u88c5\u6210\u529f\u3002 MySQL\u670d\u52a1\u5668\uff08\u672c\u5730\u8fdc\u7a0b\u7686\u53ef\uff0c\u6709\u8bfb\u5199/\u5efa\u8868\u7684\u6743\u9650\uff09 Python3.5+\u7248\u672c(\u4f7f\u7528\u4e86async/await\u7b49\u5f02\u6b65\u7279\u6027) Nodejs(14.x\u7248\u672c\u4ee5\u4e0a) \u83b7\u53d6\u540e\u7aef\u4ee3\u7801 \u8fdb\u5165 \u540e\u7aef\u9879\u76ee \u5730\u5740\uff0c\u901a\u8fc7clone\u6216\u8005\u4e0b\u8f7dzip\u7684\u65b9\u5f0f\u83b7\u53d6\u6700\u65b0\u4ee3\u7801\u3002 Tips: github\u7ecf\u5e38\u4f1a\u88ab \u5899 \uff0c\u5982\u679c\u65e0\u6cd5\u6253\u5f00\u9875\u9762\uff0c\u5efa\u8bae \u591a\u5237\u51e0\u6b21 \u3002 \u5b89\u88c5\u540e\u7aef\u4f9d\u8d56 \u4e0b\u8f7d\u597d \u9879\u76ee \u4ee5\u540e\uff0c\u6253\u5f00\u63a7\u5236\u53f0(cmd\u6216\u8005\u7ec8\u7aef)\uff0c\u5207\u6362\u5230pity\u6839\u76ee\u5f55\u3002 \u8fd0\u884cpip\u547d\u4ee4\u5b89\u88c5\u4f9d\u8d56: pip3 install -r requirements.txt \u5b89\u88c5\u8fc7\u7a0b\u5982\u679c\u975e\u5e38\u7f13\u6162\uff0c\u53ef\u4ee5\u4e34\u65f6\u5207\u6362\u5230 \u8c46\u74e3\u6e90 \u8fdb\u884c\u5b89\u88c5\u3002 pip3 install -r requirements.txt -i https://pypi.douban.com/simple \u5c1d\u8bd5\u542f\u52a8\u540e\u7aef\u670d\u52a1 \u670d\u52a1\u4f1a\u9ed8\u8ba4\u5360\u7528 7777 \u7aef\u53e3\uff0c\u5982\u679c\u9700\u8981\u4fee\u6539\u7aef\u53e3\u53f7\uff0c\u53ef\u4ee5\u5728 main.py \u6587\u4ef6\u4e2d\u81ea\u884c\u4fee\u6539\u3002\u4ee5\u540e\u4e5f\u53ef\u4ee5\u5728\u542f\u52a8\u7684\u65f6\u5019\u52a0\u4e0aport\u53c2\u6570\uff08\u76ee\u524d\u8fd8\u6ca1\u6709\u652f\u6301\uff09\u3002 python3 main.py \u670d\u52a1\u542f\u52a8\u540e\u6548\u679c: \u5982\u679c\u542f\u52a8\u540e\uff0c\u62a5\u9519 logs \u627e\u4e0d\u5230\u7684\u95ee\u9898\uff0c\u9700\u8981\u521b\u5efa pity/logs \u6587\u4ef6\u5939\uff0c\u56e0\u4e3agithub\u4e0d\u63a5\u53d7\u7a7a\u6587\u4ef6\uff0c\u6240\u4ee5\u4f1a\u6709\u8fd9\u4e2a\u9519\u8bef\u3002 \u83b7\u53d6\u524d\u7aef\u4ee3\u7801 \u4e0b\u8f7d\u597d \u9879\u76ee \u4ee5\u540e\uff0c\u6253\u5f00\u63a7\u5236\u53f0(cmd\u6216\u8005\u7ec8\u7aef)\uff0c\u5207\u6362\u5230pityWeb\u6839\u76ee\u5f55\u3002 \u8fd0\u884cnpm\u547d\u4ee4\u5b89\u88c5\u4f9d\u8d56: npm install \u5982\u679cnpm\u5b89\u88c5\u8f83\u6162\uff0c\u53ef\u4ee5\u6362 cnpm \uff0c\u901a\u8fc7npm\u5b89\u88c5\u597d cnpm \u4ee5\u540e\u6267\u884c\u547d\u4ee4: # \u4e0b\u9762\u662fcnpm\u5b89\u88c5\u547d\u4ee4 # npm install -g cnpm --registry=https://registry.npm.taobao.org cnpm install \u542f\u52a8\u524d\u7aef\u670d\u52a1 \u5b89\u88c5\u597d\u4f9d\u8d56\u4ee5\u540e\uff0c\u8f93\u5165\u547d\u4ee4: npm run start \u9759\u9759\u7b49\u5f85\u670d\u52a1\u542f\u52a8\uff0c\u9ed8\u8ba4\u670d\u52a1\u4f1a\u5728 8000 \u7aef\u53e3\uff0c\u5982\u679c\u7aef\u53e3\u88ab\u5360\u636e\uff0c\u5219\u4f1a\u987a\u5ef6\u81f38001\uff0c\u4ee5\u6b64\u7c7b\u63a8\u3002 \u786e\u5b9a\u540e\u7aef\u914d\u7f6e\u5730\u5740 \u6253\u5f00pityWeb/src/consts/config.js\u6587\u4ef6\uff0c\u5982\u679cURL\u7684\u503c\u4e0e\u540e\u7aef\u5730\u5740\u4fdd\u6301\u4e00\u81f4\uff0c\u5219\u6211\u4eec\u53ef\u4ee5\u5feb\u901f\u5f00\u59cb\u73a9\u8f6cpity\u4e86\u3002 \u5982\u679c\u540e\u7aef\u7aef\u53e3\u6709\u53d8\u52a8\uff0c\u5728\u6b64\u4fee\u6539URL\u5373\u53ef\u3002 \u6253\u5f00pity\u9996\u9875 \u5728\u6d4f\u89c8\u5668\u8f93\u5165: http://localhost:8000 \u5373\u53ef\u770b\u5230\u767b\u5f55\u9875\u9762\u5566\uff01 \u6ce8\u610f \u4ee5\u4e0a\u6b65\u9aa4\u90fd\u662f\u672c\u5730\u5f00\u53d1\u7528\u7684\uff0c\u7ebf\u4e0a\u90e8\u7f72\u8bf7\u770b \u7ebf\u4e0a\u90e8\u7f72 \u6587\u7ae0\u3002","title":"\u672c\u5730\u5f00\u53d1"}]}