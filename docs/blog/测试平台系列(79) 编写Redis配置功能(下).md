<section id="nice" data-tool="mdniceç¼–è¾‘å™¨" data-website="https://www.mdnice.com" style="padding: 0 10px; word-spacing: 0px; word-wrap: break-word; text-align: left; font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, 'PingFang SC', Cambria, Cochin, Georgia, Times, 'Times New Roman', serif; line-height: 1.6; letter-spacing: .034em; color: rgb(63, 63, 63); font-size: 16px; word-break: all;"><blockquote class="multiquote-1" data-tool="mdniceç¼–è¾‘å™¨" style="border: none; font-size: 0.9em; overflow: auto; overflow-scrolling: touch; background: rgba(0, 0, 0, 0.05); color: #6a737d; padding-top: 10px; padding-bottom: 10px; padding-left: 20px; padding-right: 10px; margin-bottom: 20px; margin-top: 20px; padding: 15px 20px; line-height: 27px; background-color: #FBF9FD; border-left: 4px solid #409EFF; display: block;">
<p style="padding-bottom: 8px; padding-top: 1em; margin: 0px; line-height: 26px; padding: 0px; font-size: 15px; color: rgb(89,89,89);">å¤§å®¶å¥½~æˆ‘æ˜¯<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #409EFF;">ç±³æ´›</code>ï¼<br>
æˆ‘æ­£åœ¨ä»0åˆ°1æ‰“é€ ä¸€ä¸ªå¼€æºçš„æ¥å£æµ‹è¯•å¹³å°, ä¹Ÿåœ¨ç¼–å†™ä¸€å¥—ä¸ä¹‹å¯¹åº”çš„å®Œæ•´<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #409EFF;">æ•™ç¨‹</code>ï¼Œå¸Œæœ›å¤§å®¶å¤šå¤šæ”¯æŒã€‚<br>
æ¬¢è¿å…³æ³¨æˆ‘çš„å…¬ä¼—å·<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #409EFF;">æµ‹è¯•å¼€å‘å‘è´§</code>ï¼Œè·å–æœ€æ–°æ–‡ç« æ•™ç¨‹!</p>
</blockquote>
<h3 data-tool="mdniceç¼–è¾‘å™¨" style="margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 20px; margin-top: 1.2em;"><span>ğŸ“’ </span><span class="prefix" style="display: none;"></span><span class="content" style="font-size: 17px; font-weight: bold; display: inline-block; margin-left: 8px; color: #409EFF;">å›é¡¾</span><span class="suffix" style="display: none;"></span></h3>
<p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">ä¸Šä¸€èŠ‚æˆ‘ä»¬æå‡ºäº†<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #409EFF;">ä¼˜åŒ–Daoé€»è¾‘</code>çš„æƒ³æ³•ï¼Œé‚£ä»Šå¤©å°±è¯•ç€æ¥å…‘ç°ä¹‹ï¼Œå¹¶è¿ç”¨åˆ°Redisé…ç½®ç®¡ç†çš„å¼€å‘ä¸­å»ã€‚</p>
<h3 data-tool="mdniceç¼–è¾‘å™¨" style="margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 20px; margin-top: 1.2em;"><span>ğŸ“’ </span><span class="prefix" style="display: none;"></span><span class="content" style="font-size: 17px; font-weight: bold; display: inline-block; margin-left: 8px; color: #409EFF;">åˆæ­¥æ„æ€listæ–¹æ³•</span><span class="suffix" style="display: none;"></span></h3>
<p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">æˆ‘ä»¬åœ¨dao/<strong style="font-weight: bold; line-height: 1.75em; color: rgb(74,74,74);">init</strong>.pyæ–°å»ºç±»: Mapperï¼Œä»¥åæ‰€æœ‰çš„daoç±»éƒ½ç»§æ‰¿è‡ªå®ƒã€‚</p>
<p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">æƒ³æƒ³listéœ€è¦ä»€ä¹ˆï¼Œä¸€èˆ¬éœ€è¦,<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #409EFF;">å­—æ®µ</code>ï¼Œ<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #409EFF;">å‚æ•°</code>ï¼Œ <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #409EFF;">æ˜¯likeè¿˜æ˜¯ç­‰äº</code>è¿™3ä¸ªé‡è¦çš„ä¿¡æ¯ã€‚</p>
<p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">æ˜ç™½è¿™ä¸ªä»¥åï¼Œæˆ‘ä»¬çš„ä¼ªä»£ç å°±å¥½ç¼–å†™äº†:</p>
<pre class="custom" data-tool="mdniceç¼–è¾‘å™¨" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #abb2bf; display: -webkit-box; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;"><span class="hljs-comment" style="color: #5c6370; font-style: italic; line-height: 26px;">#&nbsp;1.&nbsp;è·å–session</span><br><span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">async</span>&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">with</span>&nbsp;async_session()&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">as</span>&nbsp;session:<br>&nbsp;&nbsp;condition&nbsp;=&nbsp;[model.deleted_at&nbsp;==&nbsp;<span class="hljs-number" style="color: #d19a66; line-height: 26px;">0</span>]<br>&nbsp;&nbsp;<span class="hljs-comment" style="color: #5c6370; font-style: italic; line-height: 26px;">#&nbsp;2.&nbsp;æ ¹æ®å‚æ•°é‡Œçš„å­—æ®µï¼Œå­—æ®µå€¼æ„é€ æŸ¥è¯¢æ¡ä»¶</span><br>&nbsp;&nbsp;DatabaseHelper.where(å­—æ®µï¼Œå­—æ®µå€¼ï¼Œcondition)<br>&nbsp;&nbsp;<span class="hljs-comment" style="color: #5c6370; font-style: italic; line-height: 26px;">#&nbsp;3.&nbsp;æŸ¥è¯¢å‡ºç»“æœï¼Œåç»­ä¸åŸæ¥çš„æ–¹å¼ä¸€è‡´ï¼Œå°±ä¸å†™äº†</span><br></code></pre>
<p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">å¯ä»¥çœ‹åˆ°ï¼Œè¿™è¾¹é™¤äº†éœ€è¦ä¸Šé¢çš„3ä¸ªä¿¡æ¯ä»¥å¤–ï¼Œè¿˜éœ€è¦tryå»å†™å…¥æ—¥å¿—ï¼Œä¹Ÿå°±æ˜¯è¯´éœ€è¦æˆ‘ä»¬å¹³æ—¶ç»å¸¸åˆ›å»ºçš„logæˆå‘˜å˜é‡ï¼Œè¿˜éœ€è¦<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #409EFF;">model</code>è¿™ä¸ªç±»ï¼Œå¦åˆ™ä½ ä¸çŸ¥é“æ”¹çš„æ˜¯ä»€ä¹ˆè¡¨ã€‚</p>
<h3 data-tool="mdniceç¼–è¾‘å™¨" style="margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 20px; margin-top: 1.2em;"><span>ğŸ“’ </span><span class="prefix" style="display: none;"></span><span class="content" style="font-size: 17px; font-weight: bold; display: inline-block; margin-left: 8px; color: #409EFF;">æ€è€ƒ</span><span class="suffix" style="display: none;"></span></h3>
<p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">æˆ‘ä»¬å¹³æ—¶çš„å‚æ•°ï¼Œéƒ½æ˜¯key-valueçš„å½¢å¼ï¼Œä¸€æ—¦valueä¸ä¸ºç©ºï¼Œé‚£ä¹ˆè¯´æ˜æˆ‘ä»¬è¦æ ¹æ®è¿™ä¸ªæ¡ä»¶æ¥æŸ¥è¯¢ã€‚</p>
<p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">è€Œmodelå’Œlogï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç±»çš„è£…é¥°å™¨ï¼Œç”±å­ç±»ä¼ é€’ç»™çˆ¶ç±»ï¼ˆè¿™é‡Œä¼šç”¨åˆ°setattrå’Œgetattrï¼‰</p>
<pre class="custom" data-tool="mdniceç¼–è¾‘å™¨" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #abb2bf; display: -webkit-box; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;"><span class="hljs-class" style="line-height: 26px;"><span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">class</span>&nbsp;<span class="hljs-title" style="color: #e6c07b; line-height: 26px;">Mapper</span><span class="hljs-params" style="line-height: 26px;">(object)</span>:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;log&nbsp;=&nbsp;<span class="hljs-literal" style="color: #56b6c2; line-height: 26px;">None</span><br>&nbsp;&nbsp;&nbsp;&nbsp;model&nbsp;=&nbsp;<span class="hljs-literal" style="color: #56b6c2; line-height: 26px;">None</span><br><br><span class="hljs-meta" style="color: #61aeee; line-height: 26px;">&nbsp;&nbsp;&nbsp;&nbsp;@classmethod</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">async</span>&nbsp;<span class="hljs-function" style="line-height: 26px;"><span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">def</span>&nbsp;<span class="hljs-title" style="color: #61aeee; line-height: 26px;">list_data</span><span class="hljs-params" style="line-height: 26px;">(cls,&nbsp;**kwargs)</span>:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">try</span>:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">async</span>&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">with</span>&nbsp;async_session()&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">as</span>&nbsp;session:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="color: #5c6370; font-style: italic; line-height: 26px;">#&nbsp;æ„é€ æŸ¥è¯¢æ¡ä»¶ï¼Œé»˜è®¤æ˜¯æ•°æ®æœªè¢«åˆ é™¤</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;condition&nbsp;=&nbsp;[getattr(cls.model,&nbsp;<span class="hljs-string" style="color: #98c379; line-height: 26px;">"deleted_at"</span>)&nbsp;==&nbsp;<span class="hljs-number" style="color: #d19a66; line-height: 26px;">0</span>]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="color: #5c6370; font-style: italic; line-height: 26px;">#&nbsp;éå†å‚æ•°ï¼Œå½“å‚æ•°ä¸ä¸ºNoneçš„æ—¶å€™ä¼ é€’</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">for</span>&nbsp;k,&nbsp;v&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">in</span>&nbsp;kwargs.items():<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="color: #5c6370; font-style: italic; line-height: 26px;">#&nbsp;åˆ¤æ–­æ˜¯å¦æ˜¯likeçš„æƒ…å†µ&nbsp;<span class="hljs-doctag" style="color: #c678dd; line-height: 26px;">TODO:</span>&nbsp;è¿™é‡Œæ²¡æ”¯æŒinæŸ¥è¯¢</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;like&nbsp;=&nbsp;v&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">is</span>&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">not</span>&nbsp;<span class="hljs-literal" style="color: #56b6c2; line-height: 26px;">None</span>&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">and</span>&nbsp;len(v)&nbsp;&gt;&nbsp;<span class="hljs-number" style="color: #d19a66; line-height: 26px;">2</span>&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">and</span>&nbsp;v.startswith(<span class="hljs-string" style="color: #98c379; line-height: 26px;">"%"</span>)&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">and</span>&nbsp;v.endswith(<span class="hljs-string" style="color: #98c379; line-height: 26px;">"%"</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="color: #5c6370; font-style: italic; line-height: 26px;">#&nbsp;å¦‚æœæ˜¯likeæ¨¡å¼ï¼Œåˆ™ä½¿ç”¨Model.å­—æ®µ.like&nbsp;å¦åˆ™ç”¨&nbsp;Model.å­—æ®µ&nbsp;ç­‰äº</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DatabaseHelper.where(v,&nbsp;getattr(cls.model,&nbsp;k).like(v)&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">if</span>&nbsp;like&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">else</span>&nbsp;getattr(cls.model,&nbsp;k)&nbsp;==&nbsp;v,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;condition)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;=&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">await</span>&nbsp;session.execute(select(cls.model).where(*condition))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">return</span>&nbsp;result.scalars().all()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">except</span>&nbsp;Exception&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">as</span>&nbsp;e:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="color: #5c6370; font-style: italic; line-height: 26px;">#&nbsp;è¿™è¾¹è°ƒç”¨clsæœ¬èº«çš„logå‚æ•°ï¼Œå†™å…¥æ—¥å¿—+æŠ›å‡ºå¼‚å¸¸</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cls.log.error(<span class="hljs-string" style="color: #98c379; line-height: 26px;">f"è·å–<span class="hljs-subst" style="color: #e06c75; line-height: 26px;">{cls.model}</span>åˆ—è¡¨å¤±è´¥,&nbsp;error:&nbsp;<span class="hljs-subst" style="color: #e06c75; line-height: 26px;">{e}</span>"</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">raise</span>&nbsp;Exception(<span class="hljs-string" style="color: #98c379; line-height: 26px;">f"è·å–æ•°æ®å¤±è´¥"</span>)<br></code></pre>
<p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">æ³¨é‡Šå†™çš„æ¯”è¾ƒè¯¦ç»†ï¼Œç”±äºç°åœ¨å­—æ®µæ˜¯ä¸ªå˜é‡ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½ç”¨<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #409EFF;">model.å­—æ®µ</code>æ¥å–å€¼ï¼Œæ‰€ä»¥å–è€Œä»£ä¹‹çš„æ˜¯<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #409EFF;">getattr(model, å­—æ®µ)</code>ã€‚ä¸ç†Ÿæ‚‰çš„æœ‹å‹å¯ä»¥å»æœç´¢ä¸‹<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #409EFF;">getattr</code>ã€‚</p>
<p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">è¿™æ ·ï¼Œä¸€ä¸ªç²—ç•¥çš„listæ–¹æ³•å°±å†™å¥½äº†ï¼Œä½†æ˜¯è¿™ä¸ªæ˜¯ä¸å¸¦åˆ†é¡µçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦è¡¥å……ä¸€ä¸ªåˆ†é¡µçš„æ¨¡å¼ï¼Œå…¶å®ä¹Ÿå¾ˆç®€å•ã€‚</p>
<pre class="custom" data-tool="mdniceç¼–è¾‘å™¨" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #abb2bf; display: -webkit-box; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;"><span class="hljs-meta" style="color: #61aeee; line-height: 26px;">&nbsp;&nbsp;&nbsp;&nbsp;@classmethod</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">async</span>&nbsp;<span class="hljs-function" style="line-height: 26px;"><span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">def</span>&nbsp;<span class="hljs-title" style="color: #61aeee; line-height: 26px;">list_data_with_pagination</span><span class="hljs-params" style="line-height: 26px;">(cls,&nbsp;page,&nbsp;size,&nbsp;**kwargs)</span>:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">try</span>:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">async</span>&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">with</span>&nbsp;async_session()&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">as</span>&nbsp;session:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;condition&nbsp;=&nbsp;[getattr(cls.model,&nbsp;<span class="hljs-string" style="color: #98c379; line-height: 26px;">"deleted_at"</span>)&nbsp;==&nbsp;<span class="hljs-number" style="color: #d19a66; line-height: 26px;">0</span>]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">for</span>&nbsp;k,&nbsp;v&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">in</span>&nbsp;kwargs.items():<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;like&nbsp;=&nbsp;v&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">is</span>&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">not</span>&nbsp;<span class="hljs-literal" style="color: #56b6c2; line-height: 26px;">None</span>&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">and</span>&nbsp;len(v)&nbsp;&gt;&nbsp;<span class="hljs-number" style="color: #d19a66; line-height: 26px;">2</span>&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">and</span>&nbsp;v.startswith(<span class="hljs-string" style="color: #98c379; line-height: 26px;">"%"</span>)&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">and</span>&nbsp;v.endswith(<span class="hljs-string" style="color: #98c379; line-height: 26px;">"%"</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sql&nbsp;=&nbsp;DatabaseHelper.where(v,&nbsp;getattr(cls.model,&nbsp;k).like(v)&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">if</span>&nbsp;like&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">else</span>&nbsp;getattr(cls.model,&nbsp;k)&nbsp;==&nbsp;v,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;condition)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">return</span>&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">await</span>&nbsp;DatabaseHelper.pagination(page,&nbsp;size,&nbsp;session,&nbsp;sql)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">except</span>&nbsp;Exception&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">as</span>&nbsp;e:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cls.log.error(<span class="hljs-string" style="color: #98c379; line-height: 26px;">f"è·å–<span class="hljs-subst" style="color: #e06c75; line-height: 26px;">{cls.model}</span>åˆ—è¡¨å¤±è´¥,&nbsp;error:&nbsp;<span class="hljs-subst" style="color: #e06c75; line-height: 26px;">{e}</span>"</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">raise</span>&nbsp;Exception(<span class="hljs-string" style="color: #98c379; line-height: 26px;">f"è·å–æ•°æ®å¤±è´¥"</span>)<br></code></pre>
<p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">åŸºæœ¬ä¸Šé•¿çš„å·®ä¸å¤šï¼Œåªæ˜¯æœ€åè¿”å›é‚£é‡Œï¼Œè°ƒç”¨äº†paginationç›¸å…³æ–¹æ³•ã€‚</p>
<h3 data-tool="mdniceç¼–è¾‘å™¨" style="margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 20px; margin-top: 1.2em;"><span>ğŸ“’ </span><span class="prefix" style="display: none;"></span><span class="content" style="font-size: 17px; font-weight: bold; display: inline-block; margin-left: 8px; color: #409EFF;">çœ‹çœ‹daoè£…é¥°å™¨</span><span class="suffix" style="display: none;"></span></h3>
<figure data-tool="mdniceç¼–è¾‘å™¨" style="margin: 0; margin-top: 10px; margin-bottom: 10px; display: flex; flex-direction: column; justify-content: center; align-items: center;"><img src="https://static.pity.fun/picture/2021-11-13/1636805357249-image.png" alt="è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè¦ç”¨classmethodè€Œä¸æ˜¯staticmethodçš„åŸå› " style="display: block; margin: 0 auto; max-width: 100%; border-radius: 4px; margin-bottom: 25px;"><figcaption style="margin-top: 5px; text-align: center; color: #888; display: block; font-size: 12px; font-family: PingFangSC-Light;">è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè¦ç”¨classmethodè€Œä¸æ˜¯staticmethodçš„åŸå› </figcaption></figure>
<p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">æˆ‘ä»¬å¾ˆåï¼ŒæŠŠè¿™ä¸ªè£…é¥°å™¨å¥—åˆ°å­ç±»ä¸Šï¼Œå¹¶æŠŠmodelå’Œlogä¼ ç»™çˆ¶ç±»ã€‚æ¯•ç«Ÿæ–¹æ³•éƒ½æ˜¯åœ¨è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•ï¼Œçˆ¶ç±»æ— æ³•ç›´æ¥æ‹¿åˆ°<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #409EFF;">å­ç±»çš„æ•°æ®</code>ã€‚</p>
<figure data-tool="mdniceç¼–è¾‘å™¨" style="margin: 0; margin-top: 10px; margin-bottom: 10px; display: flex; flex-direction: column; justify-content: center; align-items: center;"><img src="https://static.pity.fun/picture/2021-11-13/1636804853140-image.png" alt="ç”¨çš„è¯ï¼Œå°±æ˜¯æŠŠmodelå’Œlogä¼ å…¥daoå‚æ•°" style="display: block; margin: 0 auto; max-width: 100%; border-radius: 4px; margin-bottom: 25px;"><figcaption style="margin-top: 5px; text-align: center; color: #888; display: block; font-size: 12px; font-family: PingFangSC-Light;">ç”¨çš„è¯ï¼Œå°±æ˜¯æŠŠmodelå’Œlogä¼ å…¥daoå‚æ•°</figcaption></figure>
<p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">è¿™æ ·å°±é¿å…äº†åœ¨è°ƒç”¨<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #409EFF;">list</code>æ–¹æ³•çš„æ—¶å€™ï¼Œè¿˜éœ€è¦ä¼ å…¥modelå’Œlogçš„å°´å°¬æƒ…å†µã€‚</p>
<h3 data-tool="mdniceç¼–è¾‘å™¨" style="margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 20px; margin-top: 1.2em;"><span>ğŸ“’ </span><span class="prefix" style="display: none;"></span><span class="content" style="font-size: 17px; font-weight: bold; display: inline-block; margin-left: 8px; color: #409EFF;">å®Œå–„å…¶ä»–æ–¹æ³•</span><span class="suffix" style="display: none;"></span></h3>
<p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">listæå®šä»¥åï¼Œå…¶ä»–çš„è¿˜ä¼šè¿œå—ï¼Ÿä½†è¿˜çœŸçš„å¥½åƒè¿˜æœ‰ç‚¹é—®é¢˜ï¼Œå› ä¸ºæˆ‘ä»¬ä¸€èˆ¬ä¼šæœ‰ä¸€äº›é‡ååˆ¤æ–­ï¼Œä½†æ²¡å…³ç³»ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä¸ªqueryæ–¹æ³•ã€‚</p>
<pre class="custom" data-tool="mdniceç¼–è¾‘å™¨" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #abb2bf; display: -webkit-box; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;"><span class="hljs-meta" style="color: #61aeee; line-height: 26px;">&nbsp;&nbsp;&nbsp;&nbsp;@classmethod</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function" style="line-height: 26px;"><span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">def</span>&nbsp;<span class="hljs-title" style="color: #61aeee; line-height: 26px;">query_wrapper</span><span class="hljs-params" style="line-height: 26px;">(cls,&nbsp;**kwargs)</span>:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;condition&nbsp;=&nbsp;[getattr(cls.model,&nbsp;<span class="hljs-string" style="color: #98c379; line-height: 26px;">"deleted_at"</span>)&nbsp;==&nbsp;<span class="hljs-number" style="color: #d19a66; line-height: 26px;">0</span>]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="color: #5c6370; font-style: italic; line-height: 26px;">#&nbsp;éå†å‚æ•°ï¼Œå½“å‚æ•°ä¸ä¸ºNoneçš„æ—¶å€™ä¼ é€’</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">for</span>&nbsp;k,&nbsp;v&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">in</span>&nbsp;kwargs.items():<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="color: #5c6370; font-style: italic; line-height: 26px;">#&nbsp;åˆ¤æ–­æ˜¯å¦æ˜¯likeçš„æƒ…å†µ&nbsp;<span class="hljs-doctag" style="color: #c678dd; line-height: 26px;">TODO:</span>&nbsp;è¿™é‡Œæ²¡æ”¯æŒinæŸ¥è¯¢</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;like&nbsp;=&nbsp;v&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">is</span>&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">not</span>&nbsp;<span class="hljs-literal" style="color: #56b6c2; line-height: 26px;">None</span>&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">and</span>&nbsp;len(v)&nbsp;&gt;&nbsp;<span class="hljs-number" style="color: #d19a66; line-height: 26px;">2</span>&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">and</span>&nbsp;v.startswith(<span class="hljs-string" style="color: #98c379; line-height: 26px;">"%"</span>)&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">and</span>&nbsp;v.endswith(<span class="hljs-string" style="color: #98c379; line-height: 26px;">"%"</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="color: #5c6370; font-style: italic; line-height: 26px;">#&nbsp;å¦‚æœæ˜¯likeæ¨¡å¼ï¼Œåˆ™ä½¿ç”¨Model.å­—æ®µ.like&nbsp;å¦åˆ™ç”¨&nbsp;Model.å­—æ®µ&nbsp;ç­‰äº</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DatabaseHelper.where(v,&nbsp;getattr(cls.model,&nbsp;k).like(v)&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">if</span>&nbsp;like&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">else</span>&nbsp;getattr(cls.model,&nbsp;k)&nbsp;==&nbsp;v,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;condition)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">return</span>&nbsp;select(cls.model).where(*condition)<br><br><span class="hljs-meta" style="color: #61aeee; line-height: 26px;">&nbsp;&nbsp;&nbsp;&nbsp;@classmethod</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">async</span>&nbsp;<span class="hljs-function" style="line-height: 26px;"><span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">def</span>&nbsp;<span class="hljs-title" style="color: #61aeee; line-height: 26px;">query_record</span><span class="hljs-params" style="line-height: 26px;">(cls,&nbsp;**kwargs)</span>:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">try</span>:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">async</span>&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">with</span>&nbsp;async_session()&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">as</span>&nbsp;session:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sql&nbsp;=&nbsp;cls.query_wrapper(**kwargs)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;=&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">await</span>&nbsp;session.execute(sql)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">return</span>&nbsp;result.scalars().first()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">except</span>&nbsp;Exception&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">as</span>&nbsp;e:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cls.log.error(<span class="hljs-string" style="color: #98c379; line-height: 26px;">f"æŸ¥è¯¢<span class="hljs-subst" style="color: #e06c75; line-height: 26px;">{cls.model}</span>å¤±è´¥,&nbsp;error:&nbsp;<span class="hljs-subst" style="color: #e06c75; line-height: 26px;">{e}</span>"</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">raise</span>&nbsp;Exception(<span class="hljs-string" style="color: #98c379; line-height: 26px;">f"æŸ¥è¯¢æ•°æ®å¤±è´¥"</span>)<br></code></pre>
<p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">ç”±äºæŸ¥è¯¢æ–¹æ³•å¤ªè¿‡äºé€šç”¨ï¼Œæ‰€ä»¥æŠ½æˆäº†query_wrapperæ–¹æ³•ã€‚</p>
<ul data-tool="mdniceç¼–è¾‘å™¨" style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;">æ­£å¸¸ç¼–å†™insertæ¥å£</section></li></ul>
<pre class="custom" data-tool="mdniceç¼–è¾‘å™¨" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #abb2bf; display: -webkit-box; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;"><span class="hljs-meta" style="color: #61aeee; line-height: 26px;">&nbsp;&nbsp;&nbsp;&nbsp;@classmethod</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">async</span>&nbsp;<span class="hljs-function" style="line-height: 26px;"><span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">def</span>&nbsp;<span class="hljs-title" style="color: #61aeee; line-height: 26px;">insert_record</span><span class="hljs-params" style="line-height: 26px;">(cls,&nbsp;model)</span>:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">try</span>:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">async</span>&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">with</span>&nbsp;async_session()&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">as</span>&nbsp;session:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">async</span>&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">with</span>&nbsp;session.begin():<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;session.add(model)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">await</span>&nbsp;session.flush()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;session.expunge(model)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">return</span>&nbsp;model<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">except</span>&nbsp;Exception&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">as</span>&nbsp;e:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cls.log.error(<span class="hljs-string" style="color: #98c379; line-height: 26px;">f"æ·»åŠ <span class="hljs-subst" style="color: #e06c75; line-height: 26px;">{cls.model}</span>è®°å½•å¤±è´¥,&nbsp;error:&nbsp;<span class="hljs-subst" style="color: #e06c75; line-height: 26px;">{e}</span>"</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">raise</span>&nbsp;Exception(<span class="hljs-string" style="color: #98c379; line-height: 26px;">f"æ·»åŠ è®°å½•å¤±è´¥"</span>)<br></code></pre>
<p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">è¿™è¾¹è¿”å›äº†modelï¼Œå¦‚æœä¸éœ€è¦ä¹Ÿå¯ä»¥ä¸ç”¨ï¼Œä½†å’±è¿˜æ˜¯ç»™è¿”å›ã€‚</p>
<ul data-tool="mdniceç¼–è¾‘å™¨" style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;">insertæ¥å£å±‚</section></li></ul>
<figure data-tool="mdniceç¼–è¾‘å™¨" style="margin: 0; margin-top: 10px; margin-bottom: 10px; display: flex; flex-direction: column; justify-content: center; align-items: center;"><img src="https://static.pity.fun/picture/2021-11-13/1636810188578-image.png" alt style="display: block; margin: 0 auto; max-width: 100%; border-radius: 4px; margin-bottom: 25px;"></figure>
<p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">å’Œä»¥å‰ä¸€æ ·ï¼Œå…ˆæŸ¥ï¼Œå¦‚æœæ²¡æœ‰å†å…³æ‰ã€‚</p>
<p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;"><strong style="font-weight: bold; line-height: 1.75em; color: rgb(74,74,74);">ä½†è¿™æ ·ä¼šäº§ç”Ÿ2ä¸ªsessionï¼Œå¼€-&gt;å…³-&gt;å¼€-&gt;å…³</strong></p>
<p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">ä½†ä¹Ÿè§£è€¦äº†æŸ¥è¯¢å’Œæ’å…¥2ä¸ªæ“ä½œã€‚</p>
<ul data-tool="mdniceç¼–è¾‘å™¨" style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;">ç¼–å†™åˆ é™¤å’Œä¿®æ”¹æ–¹æ³•</section></li></ul>
<pre class="custom" data-tool="mdniceç¼–è¾‘å™¨" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #abb2bf; display: -webkit-box; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;"><span class="hljs-meta" style="color: #61aeee; line-height: 26px;">&nbsp;&nbsp;&nbsp;&nbsp;@classmethod</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">async</span>&nbsp;<span class="hljs-function" style="line-height: 26px;"><span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">def</span>&nbsp;<span class="hljs-title" style="color: #61aeee; line-height: 26px;">update_record_by_id</span><span class="hljs-params" style="line-height: 26px;">(cls,&nbsp;user,&nbsp;model,&nbsp;not_null=False)</span>:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">try</span>:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">async</span>&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">with</span>&nbsp;async_session()&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">as</span>&nbsp;session:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">async</span>&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">with</span>&nbsp;session.begin():<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;query&nbsp;=&nbsp;cls.query_wrapper(id=model.id)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;=&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">await</span>&nbsp;session.execute(query)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;original&nbsp;=&nbsp;result.scalars().first()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">if</span>&nbsp;original&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">is</span>&nbsp;<span class="hljs-literal" style="color: #56b6c2; line-height: 26px;">None</span>:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">raise</span>&nbsp;Exception(<span class="hljs-string" style="color: #98c379; line-height: 26px;">"è®°å½•ä¸å­˜åœ¨"</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DatabaseHelper.update_model(original,&nbsp;model,&nbsp;user,&nbsp;not_null)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">await</span>&nbsp;session.flush()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;session.expunge(original)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">return</span>&nbsp;original<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">except</span>&nbsp;Exception&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">as</span>&nbsp;e:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cls.log.error(<span class="hljs-string" style="color: #98c379; line-height: 26px;">f"æ›´æ–°<span class="hljs-subst" style="color: #e06c75; line-height: 26px;">{cls.model}</span>è®°å½•å¤±è´¥,&nbsp;error:&nbsp;<span class="hljs-subst" style="color: #e06c75; line-height: 26px;">{e}</span>"</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">raise</span>&nbsp;Exception(<span class="hljs-string" style="color: #98c379; line-height: 26px;">f"æ›´æ–°è®°å½•å¤±è´¥"</span>)<br><br><span class="hljs-meta" style="color: #61aeee; line-height: 26px;">&nbsp;&nbsp;&nbsp;&nbsp;@classmethod</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">async</span>&nbsp;<span class="hljs-function" style="line-height: 26px;"><span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">def</span>&nbsp;<span class="hljs-title" style="color: #61aeee; line-height: 26px;">delete_record_by_id</span><span class="hljs-params" style="line-height: 26px;">(cls,&nbsp;user,&nbsp;id)</span>:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-string" style="color: #98c379; line-height: 26px;">"""<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;é€»è¾‘åˆ é™¤<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;user:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;id:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:return:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"""</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">try</span>:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">async</span>&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">with</span>&nbsp;async_session()&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">as</span>&nbsp;session:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">async</span>&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">with</span>&nbsp;session.begin():<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;query&nbsp;=&nbsp;cls.query_wrapper(id=id)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;=&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">await</span>&nbsp;session.execute(query)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;original&nbsp;=&nbsp;result.scalars().first()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">if</span>&nbsp;original&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">is</span>&nbsp;<span class="hljs-literal" style="color: #56b6c2; line-height: 26px;">None</span>:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">raise</span>&nbsp;Exception(<span class="hljs-string" style="color: #98c379; line-height: 26px;">"è®°å½•ä¸å­˜åœ¨"</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DatabaseHelper.delete_model(original,&nbsp;user)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">except</span>&nbsp;Exception&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">as</span>&nbsp;e:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cls.log.error(<span class="hljs-string" style="color: #98c379; line-height: 26px;">f"åˆ é™¤<span class="hljs-subst" style="color: #e06c75; line-height: 26px;">{cls.model}</span>è®°å½•å¤±è´¥,&nbsp;error:&nbsp;<span class="hljs-subst" style="color: #e06c75; line-height: 26px;">{e}</span>"</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">raise</span>&nbsp;Exception(<span class="hljs-string" style="color: #98c379; line-height: 26px;">f"åˆ é™¤è®°å½•å¤±è´¥"</span>)<br><br><span class="hljs-meta" style="color: #61aeee; line-height: 26px;">&nbsp;&nbsp;&nbsp;&nbsp;@classmethod</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">async</span>&nbsp;<span class="hljs-function" style="line-height: 26px;"><span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">def</span>&nbsp;<span class="hljs-title" style="color: #61aeee; line-height: 26px;">delete_by_id</span><span class="hljs-params" style="line-height: 26px;">(cls,&nbsp;id)</span>:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-string" style="color: #98c379; line-height: 26px;">"""<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ç‰©ç†åˆ é™¤<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;id:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:return:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"""</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">try</span>:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">async</span>&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">with</span>&nbsp;async_session()&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">as</span>&nbsp;session:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">async</span>&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">with</span>&nbsp;session.begin():<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;query&nbsp;=&nbsp;cls.query_wrapper(id=id)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;=&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">await</span>&nbsp;session.execute(query)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;original&nbsp;=&nbsp;result.scalars().first()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">if</span>&nbsp;original&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">is</span>&nbsp;<span class="hljs-literal" style="color: #56b6c2; line-height: 26px;">None</span>:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">raise</span>&nbsp;Exception(<span class="hljs-string" style="color: #98c379; line-height: 26px;">"è®°å½•ä¸å­˜åœ¨"</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;session.delete(original)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">except</span>&nbsp;Exception&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">as</span>&nbsp;e:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cls.log.error(<span class="hljs-string" style="color: #98c379; line-height: 26px;">f"é€»è¾‘åˆ é™¤<span class="hljs-subst" style="color: #e06c75; line-height: 26px;">{cls.model}</span>è®°å½•å¤±è´¥,&nbsp;error:&nbsp;<span class="hljs-subst" style="color: #e06c75; line-height: 26px;">{e}</span>"</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">raise</span>&nbsp;Exception(<span class="hljs-string" style="color: #98c379; line-height: 26px;">f"åˆ é™¤è®°å½•å¤±è´¥"</span>)<br></code></pre>
<p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">åˆ é™¤è¿™è¾¹æ”¯æŒäº†ç‰©ç†åˆ é™¤å’Œé€»è¾‘åˆ é™¤ï¼Œå½“ç„¶æˆ‘ä»¬ä¸€èˆ¬æ˜¯ç”¨<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #409EFF;">è½¯åˆ é™¤</code>ã€‚</p>
<h3 data-tool="mdniceç¼–è¾‘å™¨" style="margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 20px; margin-top: 1.2em;"><span>ğŸ“’ </span><span class="prefix" style="display: none;"></span><span class="content" style="font-size: 17px; font-weight: bold; display: inline-block; margin-left: 8px; color: #409EFF;">å®Œå–„å…¶ä»–æ¥å£</span><span class="suffix" style="display: none;"></span></h3>
<figure data-tool="mdniceç¼–è¾‘å™¨" style="margin: 0; margin-top: 10px; margin-bottom: 10px; display: flex; flex-direction: column; justify-content: center; align-items: center;"><img src="https://static.pity.fun/picture/2021-11-13/1636812976028-image.png" alt style="display: block; margin: 0 auto; max-width: 100%; border-radius: 4px; margin-bottom: 25px;"></figure>
<p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">å¯ä»¥çœ‹åˆ°åˆ é™¤å’Œä¿®æ”¹å’Œä»¥å‰æ˜¯å·®ä¸å¤šçš„(ä¹Ÿæ˜¯å†…éƒ¨è¿›è¡Œæ•°æ®æ˜¯å¦å­˜åœ¨åˆ¤æ–­)ï¼Œè¿™äº›æ­¥éª¤åšå®Œã€‚redisçš„ç®¡ç†å·¥ä½œå°±å¯ä»¥é¡ºåˆ©è¿›è¡Œäº†ï¼Œæ¥ç€æˆ‘ä»¬éœ€è¦ä¸ºä¹‹ç¼–å†™é¡µé¢å’¯ï¼</p>
<p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">ç”±äºæ˜¯å¾ˆåŸºç¡€çš„è¡¨æ ¼é¡µé¢ï¼Œæ‰€ä»¥æˆ‘ä»¬<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #409EFF;">ä¸èµ˜è¿°</code>ã€‚ä¸‹ä¸€èŠ‚æˆ‘ä»¬ä¼šåˆ©ç”¨é…ç½®çš„redisè¿æ¥ç¼–å†™redisManagerï¼Œç®¡ç†æˆ‘ä»¬çš„<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #409EFF;">è¿æ¥æ•°æ®</code>ï¼Œä¸ºä¹‹ååœ¨çº¿æ‰§è¡Œredisä»¥åŠå°†å®ƒä½œä¸ºå‰ç½®æ¡ä»¶æ‰“ä¸‹åŸºç¡€ã€‚</p>
</section>